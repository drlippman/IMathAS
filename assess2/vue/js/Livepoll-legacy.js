System.register(["./index-legacy.js?v=Dl77ZTka","./i18n-legacy.js?v=BJoyzBpV"],function(e,s){"use strict";var t,l,n,i,o,r,a,u,h,c,p,d,w,v,m,f,q,g,y,b,k,L,S,R,_,x;return{setters:[e=>{t=e.s,l=e.T,n=e.A,i=e.Q,o=e.b},e=>{r=e._,a=e.I,u=e.M,h=e.e,c=e.j,p=e.k,d=e.l,w=e.C,v=e.q,m=e.t,f=e.g,q=e.o,g=e.x,y=e.Y,b=e.G,k=e.W,L=e.F,S=e.f,R=e.m,_=e.Z,x=e.z}],execute:function(){const s={class:"subheader"},T=["aria-label"],I=["disabled","aria-label"],$=["disabled","aria-label"],P={style:{"flex-grow":"1"}},A={class:"LPres",ref:"main"},O={style:{"min-width":"10em"}},Q=["innerHTML"],U={class:"LPresbarwrap"},C={class:"LPresval"},D={key:0,class:"LPdrawgrid",ref:"main"},V=["id","width","height"],j=["id"],N={key:1,class:"LPres",ref:"main"},M={style:{"min-width":"10em"}},F={key:0},K=["id","width","height"],H=["id"],J={key:1},G={class:"LPresbarwrap"},z={class:"LPresval"},B={key:0},W={class:"home"},Y={key:1,class:"subheader"},Z={key:0,id:"livepoll_qsettings",style:{"flex-grow":"1"}},E={key:1,style:{"flex-grow":"1"}},X={key:2},ee=["aria-label"],se={key:1,class:"questionpane"};e("default",r({name:"livepoll",components:{LivepollNav:r({name:"LivepollNav",props:["qn"],components:{MenuButton:u,Icons:a},computed:{navOptions(){var e=[];e.push({onclick:()=>this.$emit("selectq",0),title:this.$t("livepoll-settings"),dispqn:0});for(const s in t.assessInfo.questions){const t=parseInt(s)+1;e.push({onclick:()=>this.$emit("selectq",t),title:this.$t("question_n",{n:t}),dispqn:t})}return e},showNextPrev(){return Object.keys(this.navOptions).length>1},dispqn(){return parseInt(this.qn)+1},curstate:()=>t.assessInfo.livepoll_status.curstate,studentCount(){return this.$t("livepoll-stucnt",{n:t.livepollStuCnt})}},methods:{selectQuestion(e){this.$emit("selectq",e)},openQuestion(){this.$emit("openq")},closeQuestion(){this.$emit("closeq")},newVersion(){this.$emit("newversion")}}},[["render",function(e,t,l,n,i,o){const r=f("menu-button"),a=f("icons");return q(),h("div",s,[c("div",{class:"flexrow",style:{"flex-grow":"1"},role:"navigation","aria-label":e.$t("regions-qnav")},[p(r,{id:"qnav",options:o.navOptions,selected:o.dispqn,searchby:"dispqn"},{default:w(({option:e})=>[v(m(e.title),1)]),_:1},8,["options","selected"]),o.showNextPrev?(q(),h("button",{key:0,onClick:t[0]||(t[0]=e=>o.selectQuestion(o.dispqn-1)),disabled:o.dispqn<=0,class:"secondarybtn",id:"qprev","aria-label":e.$t("previous")},[p(a,{name:"left"})],8,I)):d("",!0),o.showNextPrev?(q(),h("button",{key:1,onClick:t[1]||(t[1]=e=>o.selectQuestion(o.dispqn+1)),disabled:o.dispqn>=o.navOptions.length-1,class:"secondarybtn",id:"qnext","aria-label":e.$t("next")},[p(a,{name:"right"})],8,$)):d("",!0)],8,T),c("div",P,[2===o.curstate&&o.dispqn>0?(q(),h("button",{key:0,class:"primary",onClick:t[2]||(t[2]=(...e)=>o.closeQuestion&&o.closeQuestion(...e))},m(e.$t("livepoll-close_input")),1)):o.curstate>0&&o.dispqn>0?(q(),h("button",{key:1,class:"primary",onClick:t[3]||(t[3]=(...e)=>o.openQuestion&&o.openQuestion(...e))},m(e.$t("livepoll-open_input")),1)):d("",!0),(1==o.curstate||o.curstate>2)&&o.dispqn>0?(q(),h("button",{key:2,class:"secondary",onClick:t[4]||(t[4]=(...e)=>o.newVersion&&o.newVersion(...e))},[p(a,{name:"retake"}),v(" "+m(e.$t("livepoll-new_version")),1)])):d("",!0)]),c("div",null,m(o.studentCount),1)])}]]),Question:i,LivepollSettings:r({name:"LivepollSettings",computed:{showQuestionDefault:{set(e){t.livepollSettings.showQuestionDefault=e},get:()=>t.livepollSettings.showQuestionDefault},showResultsLiveDefault:{set(e){t.livepollSettings.showResultsLiveDefault=e},get:()=>t.livepollSettings.showResultsLiveDefault},showResultsAfter:{set(e){t.livepollSettings.showResultsAfter=e},get:()=>t.livepollSettings.showResultsAfter},showAnswersAfter:{set(e){t.livepollSettings.showAnswersAfter=e},get:()=>t.livepollSettings.showAnswersAfter},useTimer:{set(e){t.livepollSettings.useTimer=e},get:()=>t.livepollSettings.useTimer},questionTimelimit:{set(e){t.livepollSettings.questionTimelimit=e},get:()=>t.livepollSettings.questionTimelimit}}},[["render",function(e,s,t,l,n,i){return q(),h("div",null,[c("h2",null,m(e.$t("livepoll-settings")),1),c("p",null,[c("label",null,[g(c("input",{type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=e=>i.showQuestionDefault=e)},null,512),[[y,i.showQuestionDefault]]),v(" "+m(e.$t("livepoll-show_question_default")),1)]),s[6]||(s[6]=c("br",null,null,-1)),c("label",null,[g(c("input",{type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=e=>i.showResultsLiveDefault=e)},null,512),[[y,i.showResultsLiveDefault]]),v(" "+m(e.$t("livepoll-show_results_live_default")),1)]),s[7]||(s[7]=c("br",null,null,-1)),c("label",null,[g(c("input",{type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=e=>i.showResultsAfter=e)},null,512),[[y,i.showResultsAfter]]),v(" "+m(e.$t("livepoll-show_results_after")),1)]),s[8]||(s[8]=c("br",null,null,-1)),c("label",null,[g(c("input",{type:"checkbox","onUpdate:modelValue":s[3]||(s[3]=e=>i.showAnswersAfter=e)},null,512),[[y,i.showAnswersAfter]]),v(" "+m(e.$t("livepoll-show_answers_after")),1)]),s[9]||(s[9]=c("br",null,null,-1)),c("label",null,[g(c("input",{type:"checkbox","onUpdate:modelValue":s[4]||(s[4]=e=>i.useTimer=e)},null,512),[[y,i.useTimer]]),v(" "+m(e.$t("livepoll-use_timer")),1)]),g(c("span",null,[g(c("input",{type:"text",size:"3","onUpdate:modelValue":s[5]||(s[5]=e=>i.questionTimelimit=e)},null,512),[[k,i.questionTimelimit]]),v(" "+m(e.$t("livepoll-seconds")),1)],512),[[b,i.useTimer]])])])}]]),LivepollResults:r({name:"LivepollResults",props:["qn","showresults","showans"],components:{LivepollResultsChoices:r({name:"LivepollResultsChoices",props:["results","showans"],methods:{onUpdate(){this.$nextTick(()=>{setTimeout(window.drawPics,100),window.rendermathnode(this.$refs.main)})}},mounted(){this.onUpdate()},watch:{results:function(e,s){this.onUpdate()}}},[["render",function(e,s,t,l,n,i){return q(),h("table",A,[s[0]||(s[0]=c("caption",{class:"sr-only"},"Results",-1)),c("thead",null,[c("tr",null,[c("th",null,m(e.$t("livepoll-answer")),1),c("th",O,m(e.$t("livepoll-frequency")),1)])]),c("tbody",null,[(q(!0),h(L,null,S(t.results.choices,(e,s)=>(q(),h("tr",{key:s,class:R([t.showans?t.results.scoredata[s]>0?"LPshowcorrect":"LPshowwrong":""])},[c("td",{innerHTML:e},null,8,Q),c("td",null,[c("span",U,[c("span",{class:"LPresbar",style:_({width:Math.round(100*t.results.datatots[s]/t.results.maxfreq)+"%"})},[c("span",C,m(t.results.datatots[s]),1)],4)])])],2))),128))])],512)}]]),LivepollResultsGeneral:r({name:"LivepollResultsGeneral",props:["results","showans","itemid"],computed:{sortedKeys(){const e=this.results.datatots;return Object.keys(e).sort(function(s,t){return e[t]-e[s]})}},methods:{onUpdate(){if("draw"===this.results.qtype){for(let e=0;e<this.sortedKeys.length;e++){let s=this.sortedKeys[e].replace(/\(/g,"[").replace(/\)/g,"]");s=s.split(";;"),""!==s[0]&&(s[0]="["+s[0].replace(/;/g,"],[")+"]"),s="[["+s.join("],[")+"]]";const t="LP"+this.itemid+"-"+e;window.canvases[t]=this.results.initpts.slice(),window.canvases[t].unshift(t),window.drawla[t]=JSON.parse(s)}this.$nextTick(()=>{for(let e=0;e<this.sortedKeys.length;e++)window.imathasDraw.initCanvases("LP"+this.itemid+"-"+e)})}this.$nextTick(()=>{setTimeout(window.drawPics,100),window.rendermathnode(this.$refs.main)})}},mounted(){this.onUpdate()},watch:{results:function(e,s){this.onUpdate()}}},[["render",function(e,s,t,l,n,i){return"draw"===t.results.qtype&&0===t.results.initpts[11]?(q(),h("div",D,[(q(!0),h(L,null,S(i.sortedKeys,(e,s)=>(q(),h("div",{key:e,class:R([t.showans?t.results.scoredata[e]>0?t.results.scoredata[e]<.99?"LPshowpartial":"LPshowcorrect":"LPshowwrong":""])},[c("canvas",{class:"drawcanvas",id:"canvasLP"+t.itemid+"-"+s,width:t.results.initpts[6],height:t.results.initpts[7]},null,8,V),c("input",{type:"hidden",id:"qnLP"+t.itemid+"-"+s},null,8,j)],2))),128))],512)):(q(),h("table",N,[s[0]||(s[0]=c("caption",{class:"sr-only"},"Results",-1)),c("thead",null,[c("tr",null,[c("th",null,m(e.$t("livepoll-answer")),1),c("th",M,m(e.$t("livepoll-frequency")),1)])]),c("tbody",null,[(q(!0),h(L,null,S(i.sortedKeys,(e,s)=>(q(),h("tr",{key:e,class:R([t.showans?t.results.scoredata[e]>0?t.results.scoredata[e]<.99?"LPshowpartial":"LPshowcorrect":"LPshowwrong":""])},["draw"===t.results.qtype?(q(),h("td",F,[c("canvas",{class:"drawcanvas",id:"canvasLP"+t.itemid+"-"+s,width:t.results.initpts[6],height:t.results.initpts[7]},null,8,K),c("input",{type:"hidden",id:"qnLP"+t.itemid+"-"+s},null,8,H)])):(q(),h("td",J,m(e),1)),c("td",null,[c("span",G,[c("span",{class:"LPresbar",style:_({width:Math.round(100*t.results.datatots[e]/t.results.maxfreq)+"%"})},[c("span",z,m(t.results.datatots[e]),1)],4)])])],2))),128))])],512))}]])},computed:{qinfo(){return t.assessInfo.questions[this.qn]},numResults(){return t.livepollResults.hasOwnProperty(this.qn)?Object.keys(t.livepollResults[this.qn]).length:0},params(){const e=[];for(let s=0;s<this.qinfo.answeights.length;s++)0===s&&this.qinfo.jsparams.hasOwnProperty(this.qn)?e[s]=this.qinfo.jsparams[this.qn]:e[s]=this.qinfo.jsparams[1e3*(this.qn+1)+s];return e},results(){const e=[];for(let s=0;s<this.qinfo.answeights.length;s++){const l={},n={};if(this.params[s].hasOwnProperty("livepoll_choices"))for(let e=0;e<this.params[s].livepoll_choices.length;e++)l[e]=0,n[e]=0;const i=this.params[s].qtype,o="choices"===i||"multans"===i;if(o){let e;e="choices"===i?this.params[s].livepoll_ans.toString().split(/\s+or\s+/):this.params[s].livepoll_ans.toString().split(/\s*,\s*/);for(let s=0;s<e.length;s++)n[e[s]]=1}const r=[];let a;for(const e in t.livepollResults[this.qn]){let u=t.livepollResults[this.qn][e].ans[s];u=o?u.toString().split("|"):i.match(/calc/)||"numfunc"===i?["`"+u+"`"]:[u],"draw"===i&&(a=this.condenseDraw(u[0]),r.hasOwnProperty(a)||(r[a]=u[0]));for(let o=0;o<u.length;o++)"draw"===i&&l.hasOwnProperty(r[a])?l[r[a]]+=1:l.hasOwnProperty(u[o])?l[u[o]]+=1:(l[u[o]]=1,n[u[o]]=t.livepollResults[this.qn][e].score[s])}let u=1;for(const e in l)l[e]>u&&(u=l[e]);if(e[s]={datatots:l,scoredata:n,maxfreq:u,qtype:i},o&&(e[s].choices=this.params[s].livepoll_choices),"draw"===i){const t=this.params[s].livepoll_drawinit;for(let e=1;e<Math.min(11,t.length);e++)t[e]=Number(t[e]);e[s].initpts=t}}return e}},methods:{condenseDraw(e){if(""===e)return e;var s=e.replace(/\(/g,"[").replace(/\)/g,"]");""!==(s=s.split(";;"))[0]&&(s[0]="["+s[0].replace(/;/g,"],[")+"]"),s="[["+s.join("],[")+"]]";var t,l,n,i,o=JSON.parse(s);if(o[0].length>0)for(let r=0;r<o[0].length;r++)2===o[0][r].length&&o[0][r].sort(function(e,s){return e[0]===s[0]?e[1]-s[1]:e[0]-s[0]});else if(o.length>4&&o[4].length>0)return e;if(o[1].length>0&&o[1].sort(function(e,s){return e[0]===s[0]?e[1]-s[1]:e[0]-s[0]}),o[2].length>0&&o[2].sort(function(e,s){return e[0]===s[0]?e[1]-s[1]:e[0]-s[0]}),o.length>3&&o[3].length>0)for(let r=0;r<o[3].length;r++)5===(t=o[3][r])[0]?(t[1]===t[3]?l=[5,"x",t[1]]:(n=(t[4]-t[2])/(t[3]-t[1]),i=t[2]-n*t[1],l=[5,n.toFixed(4),i.toFixed(2)]),o[3][r]=l):5.2===t[0]?(l=t[1]===t[3]?[5.2,"x",t[1],t[2]]:[5.2,(n=(t[4]-t[2])/(t[3]-t[1])).toFixed(4),t[1],t[2]],o[3][r]=l):5.3===t[0]?(l=t[1]<t[3]||t[1]===t[3]&&t[2]<t[4]?[5.3,t[1],t[2],t[3],t[4]]:[5.3,t[3],t[4],t[1],t[2]],o[3][r]=l):6===t[0]?(l=t[1]===t[3]?[6,"x",t[1],t[2]]:[6,(n=(t[4]-t[2])/((t[3]-t[1])*(t[3]-t[1]))).toFixed(4),t[1],t[2]],o[3][r]=l):6.5===t[0]?(t[1]===t[3]?l=[6.5,"x",t[1],t[2]]:(i=t[3]>t[1]?1:-1,l=[6.5,(n=(t[4]-t[2])/Math.sqrt(Math.abs(t[3]-t[1]))).toFixed(4),i,t[1],t[2]]),o[3][r]=l):8===t[0]&&(l=t[1]===t[3]?[8,"x",t[1],t[2]]:[8,(n=(t[4]-t[2])/Math.abs(t[3]-t[1])).toFixed(4),t[1],t[2]],o[3][r]=l);return JSON.stringify(o)}}},[["render",function(e,s,t,l,n,i){const o=f("livepoll-results-choices"),r=f("livepoll-results-general");return i.qinfo&&i.qinfo.answeights?(q(),h("div",B,[c("p",null,m(e.$t("livepoll-numresults",{n:i.numResults})),1),g(c("div",null,[(q(!0),h(L,null,S(i.results,(e,s)=>(q(),h("div",{key:t.qn+"-"+s,class:"med-below"},[e.hasOwnProperty("choices")?(q(),x(o,{key:0,results:e,showans:t.showans},null,8,["results","showans"])):(q(),x(r,{key:1,results:e,showans:t.showans,itemid:t.qn+"-"+s},null,8,["results","showans","itemid"]))]))),128))],512),[[b,t.showresults&&i.numResults>0]])])):d("",!0)}]]),AssessHeader:n,Timer:l},data:function(){return{showQuestion:!0,showResults:!0,showAnswers:!0,onSettings:!1,livepollTimer:null,socket:null}},computed:{isTeacher:()=>t.assessInfo.is_teacher,curqn(){return this.onSettings?-1:parseInt(t.assessInfo.livepoll_status.curquestion)-1},curseed:()=>t.assessInfo.livepoll_status.seed,curstate:()=>t.assessInfo.livepoll_status.curstate,starttime:()=>t.assessInfo.livepoll_status.startt,timelimit:()=>t.livepollSettings.useTimer?parseInt(t.livepollSettings.questionTimelimit):t.assessInfo.livepoll_status.timelimit?parseInt(t.assessInfo.livepoll_status.timelimit):0,showAnswersLabel(){return this.curstate<3?this.$t("livepoll-show_answers_after"):this.$t("livepoll-show_answers")}},methods:{updateUsercount(e){t.livepollStuCnt=e.cnt,0===e.teachcnt&&(t.assessInfo.livepoll_status.curstate=0)},addResult(e){if(e.score=JSON.parse(e.score),e.ans=JSON.parse(e.ans),t.livepollResults.hasOwnProperty(this.curqn))t.livepollResults[this.curqn][e.user]=e;else{const s={};s[this.curqn]={},s[this.curqn][e.user]=e,t.livepollResults=Object.assign({},t.livepollResults,s)}},showHandler(e){if("showq"===e.action){if(o.clearInitValue(e.qn),-1!==e.startt.indexOf("-")){const s=e.startt.split("-");e.startt=s[0],e.timelimit=s[1]}else e.timelimit=0;t.assessInfo.livepoll_status={curstate:2,curquestion:parseInt(e.qn)+1,seed:parseInt(e.seed),startt:parseInt(e.startt),timelimit:parseInt(e.timelimit)}}else t.assessInfo.livepoll_status=Object.assign(t.assessInfo.livepoll_status,{curquestion:parseInt(e.qn)+1,curstate:parseInt(e.action),timelimit:0})},selectQuestion(e){clearTimeout(this.livepollTimer);const s=parseInt(e)-1;if(-1!==s){if(this.onSettings=!1,s!==this.curqn){this.showQuestion=t.livepollSettings.showQuestionDefault,this.showResults=t.livepollSettings.showResultsLiveDefault,this.showAnswers=t.livepollSettings.showAnswersAfter;let l=1;t.livepollResults[s]&&Object.keys(t.livepollResults[s]).length>0&&(l=this.showAnswers?4:3),s>=0&&o.setLivepollStatus({newquestion:e,newstate:l})}}else this.onSettings=!0},openInput(){o.setLivepollStatus({newquestion:this.curqn+1,newstate:2,timelimit:this.timelimit}),this.timelimit>0&&(this.livepollTimer=window.setTimeout(()=>this.closeInput(),1e3*this.timelimit))},closeInput(){clearTimeout(this.livepollTimer);const e=this.showAnswers?4:3;t.livepollSettings.showResultsAfter&&(this.showResults=!0),o.setLivepollStatus({newquestion:this.curqn+1,newstate:e})},newVersion(){o.setLivepollStatus({newquestion:this.curqn+1,newstate:1,forceregen:1}),t.livepollResults.hasOwnProperty(this.curqn)&&delete t.livepollResults[this.curqn]},updateShowAnswers(){if(this.curstate>2){const e=this.showAnswers?4:3;o.setLivepollStatus({newquestion:this.curqn+1,newstate:e})}}},mounted(){const e=t.assessInfo.livepoll_server,s=t.assessInfo.livepoll_data;let l="room="+s.room+"&now="+s.now;s.sig&&(l+="&sig="+encodeURIComponent(s.sig)),this.socket=window.io("https://"+e+":3000",{query:l}),this.socket.off(),this.socket.on("livepoll usercount",e=>this.updateUsercount(e)),t.assessInfo.is_teacher?this.socket.on("livepoll qans",e=>this.addResult(e)):this.socket.on("livepoll show",e=>this.showHandler(e))},created(){0===t.assessInfo.livepoll_status.curquestion&&this.isTeacher&&(this.onSettings=!0)}},[["render",function(e,s,t,l,n,i){const o=f("assess-header"),r=f("livepoll-nav"),a=f("timer"),u=f("livepoll-settings"),w=f("question"),k=f("livepoll-results");return q(),h("div",W,[p(o),i.isTeacher?(q(),x(r,{key:0,qn:i.curqn,onSelectq:i.selectQuestion,onOpenq:i.openInput,onCloseq:i.closeInput,onNewversion:i.newVersion},null,8,["qn","onSelectq","onOpenq","onCloseq","onNewversion"])):d("",!0),i.curstate>0&&i.curqn>-1&&(i.isTeacher||i.timelimit>0)?(q(),h("div",Y,[i.isTeacher?(q(),h("div",Z,[c("label",null,[g(c("input",{type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=s=>e.showQuestion=s)},null,512),[[y,e.showQuestion]]),v(" "+m(e.$t("livepoll-show_question")),1)]),c("label",null,[g(c("input",{type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=s=>e.showResults=s)},null,512),[[y,e.showResults]]),v(" "+m(e.$t("livepoll-show_results")),1)]),c("label",null,[g(c("input",{type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=s=>e.showAnswers=s),onChange:s[3]||(s[3]=(...e)=>i.updateShowAnswers&&i.updateShowAnswers(...e))},null,544),[[y,e.showAnswers]]),v(" "+m(i.showAnswersLabel),1)])])):(q(),h("div",E)),i.timelimit>0&&i.starttime>0?(q(),x(a,{key:2,end:1e3*(i.starttime+i.timelimit),total:i.timelimit},null,8,["end","total"])):d("",!0)])):d("",!0),!i.isTeacher&&i.curstate>0?(q(),h("div",X,[c("h2",null,m(e.$t("question_n",{n:i.curqn+1})),1)])):d("",!0),c("div",{class:"scrollpane","aria-label":e.$t("regions-questions")},[!i.isTeacher||0!==i.curstate&&-1!==i.curqn?d("",!0):(q(),x(u,{key:0,class:"questionpane"})),!i.isTeacher&&i.curstate<2?(q(),h("div",se,m(e.$t("livepoll-waiting")),1)):d("",!0),i.curqn>=0&&(i.isTeacher&&i.curstate>0||!i.isTeacher&&i.curstate>1)?g((q(),x(w,{key:2,qn:i.curqn,active:!0,state:i.curstate,seed:i.curseed},null,8,["qn","state","seed"])),[[b,e.showQuestion]]):d("",!0),i.isTeacher?(q(),x(k,{showresults:e.showResults,showans:4===i.curstate,qn:i.curqn,key:i.curqn+"-"+i.curseed},null,8,["showresults","showans","qn"])):d("",!0)],8,ee)])}]]))}}});
