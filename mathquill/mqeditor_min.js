var MQeditor=function(t){var e={layoutstyle:"auto",layout:[]},a=!1,s=null,r=null,n=null,o=MathQuill.getInterface(MathQuill.getInterface.MAX),i=["alpha","beta","chi","delta","epsilon","gamma","varphi","phi","psi","sigma","rho","theta","lambda","mu","nu","omega","tau"];function d(){try{return window.self!==window.top}catch(t){return!0}}function l(a,s,r){"string"==typeof a&&(a=document.getElementById(a));var n="boolean"==typeof s?s:"hidden"!=a.type,d=a.id,l=a.getAttribute("data-mq")||"";if(!0===n){var m=t(a).attr("type","hidden").val();e.hasOwnProperty("toMQ")&&(m=e.toMQ(m,d));var u=t("#mqinput-"+d);if(0==u.length){var h,p=t("<span/>",{id:"mqinput-"+d,class:"mathquill-math-field",text:m});if(null!==(h=a.className.match(/(ansred|ansyel|ansgrn|ansorg)/))&&p.addClass(h[0]),l.match(/chem/)&&p.addClass("mq-chem"),"string"==typeof a.style.width&&a.style.width.match(/[\d\.]+\s*\w{2,3}/))p.css("min-width",a.style.width.replace(/([\d\.]+)\s*(\w{2,3})/,function(t,e,a){return e/1.15+a}));else{var g=a.hasAttribute("size")?a.size>3?a.size/1.8:a.size:10;p.css("min-width",g+"em")}p.insertAfter(a);var q={spaceBehavesLikeTab:!0,leftRightIntoCmdGoes:"up",supSubsRequireOperand:!0,charsThatBreakOutOfSupSub:"=<>",charsThatBreakOutOfSupSubVar:"+-(",charsThatBreakOutOfSupSubOp:"+-(",restrictMismatchedBrackets:!0,handlers:{edit:y,enter:f}};e.hasOwnProperty("getLayoutstyle")?e.curlayoutstyle=e.getLayoutstyle():"auto"==e.layoutstyle?e.curlayoutstyle=b():e.curlayoutstyle=e.layoutstyle,"OSK"==e.curlayoutstyle&&(q.substituteTextarea=function(){var t;isOldiOS()?((t=document.createElement("span")).setAttribute("tabindex",0),t.setAttribute("role","textbox")):((t=document.createElement("textarea")).setAttribute("tabindex",0),t.setAttribute("inputmode","none"));return t}),l.match(/chem/)&&(q.charsThatBreakOutOfSupSubVar="",q.charsThatBreakOutOfSupSubOp="",q.autoSubscriptNumerals=!0,q.autoSubscriptBrackets=!0),l.match(/(list|ntuple)/)&&(q.charsThatBreakOutOfSupSub="=<>,"),l.match(/allowplusminus/)&&(q.quickPlusMinus=!0),q.autoOperatorNames=q.autoParenOperators="ln log abs exp sin cos tan arcsinh arccosh arctanh arcsech arccsch arccoth argsinh argcosh argtanh argsech argcsch argcoth arsinh arcosh artanh arsech arcsch arcoth arcsin arccos arctan sec csc cot arcsec arccsc arccot sinh cosh sech csch tanh coth",q.autoCommands="pi theta root sqrt ^oo degree",l.match(/logic/)&&(q.autoCommands+=" neg xor or and implies iff"),l.match(/setexp/)&&(q.autoCommands+=" nn xor uu ominus cap cup oplus");var v,w=a.getAttribute("data-mq-vars")||"";if(""!=w){w=""==w?[]:w.split(/,/);for(var x=0;x<w.length;x++){v=w[x].split(/_/);for(var O=0;O<v.length;O++)v[O].length>1&&v[O].match(/^[a-zA-Z]+$/)&&(-1!=i.indexOf(v[O].toLowerCase())?q.autoCommands+=" "+v[O]:q.autoOperatorNames+=" "+v[O]);w[x].match(/^(hat|bar|vec)\(/)&&(q.autoCommands+=" "+w[x].substring(0,3))}}a.disabled?(u=o.StaticMath(p[0]),p.addClass("disabled")):((u=o.MathField(p[0],q)).setAriaLabel(a.getAttribute("aria-label")),a.hasAttribute("aria-describedby")&&t(p).find(".mq-textarea > [tabindex=0]").attr("aria-describedby",a.getAttribute("aria-describedby")),c(p),t(p).find(".mq-textarea > [tabindex=0]").on("keydown.mqed",function(t){t.ctrlKey&&"z"===t.key?(t.preventDefault(),function(t){if(t.data.history&&t.data.historyIndex>0){t.data.historyIndex--;var e=t.data.history[t.data.historyIndex];t.data._suppressHistory=!0,t.latex(e),t.data._suppressHistory=!1}}(u)):t.ctrlKey&&"y"===t.key&&(t.preventDefault(),function(t){if(t.data.history&&t.data.historyIndex<t.data.history.length-1){t.data.historyIndex++;var e=t.data.history[t.data.historyIndex];t.data._suppressHistory=!0,t.latex(e),t.data._suppressHistory=!1}}(u))}),u.data.history=[m],u.data.historyIndex=0,u.data._suppressHistory=!1,t(a).on("change.mqed",function(t,s){if(!s){var r=a.value;e.hasOwnProperty("toMQ")&&(r=e.toMQ(r,a.id)),u.latex(r)}}))}else u.show(),(u=o(u[0]).latex(m)).data.history=[m],u.data.historyIndex=0,u.data._suppressHistory=!1;!0!==r&&u.focus()}else t(a).attr("type","text").off("change.mqed"),!0!==r&&t(a).focus(),t("#mqinput-"+d).hide()}function c(a){t(a).find(".mq-textarea > [tabindex=0]").on("focus.mqeditor",u).on("blur.mqeditor",function(){r=setTimeout(h,100);var t=o.MathField(a[0]);t&&t.data.history&&(t.data.history=[t.data.history[t.data.historyIndex]],t.data.historyIndex=0),e.hasOwnProperty("onBlur")&&e.onBlur()}),t(a).on("click.mqeditor",function(e){var a=t(e.target).closest("label");if(a.length>0)return"undefined"!==a.attr("for")&&t("#"+a.attr("for")).prop("checked",!0),e.stopPropagation(),!1})}function u(n){clearTimeout(r);var i=t(n.target).closest(".mathquill-math-field");!1===a&&(t("body").append(t("<div/>",{id:"mqeditor",class:"mqeditor"})),t("#mqeditor").on("mousedown touchstart",function(t){t.preventDefault()}),a=!0);var l=e.curlayoutstyle;if(e.hasOwnProperty("getLayoutstyle")?e.curlayoutstyle=e.getLayoutstyle():"auto"==e.layoutstyle?e.curlayoutstyle=b():e.curlayoutstyle=e.layoutstyle,"OSK"===e.curlayoutstyle){if(d()?t("#mqeditor").addClass("iframeosk").removeClass("fixedbottom"):t("#mqeditor").addClass("fixedbottom").removeClass("iframeosk"),!document.getElementById("mqe-fb-spacer")){var c=document.createElement("div");c.style.height="200px",c.id="mqe-fb-spacer",t("body").append(c)}}else t("#mqeditor").removeClass("fixedbottom iframeosk");t("#mqeditor").toggleClass("mq-chem",t(i).hasClass("mq-chem"));var m=!1;if((null===s||i[0]!=s.el()||l!==e.curlayoutstyle)&&(m=!0,null!==s&&t("#"+s.el().id.substring(8)).trigger("change",!0).triggerHandler("blur"),e.hasOwnProperty("getLayout")&&(e.layout=e.getLayout(i[0],e.curlayoutstyle)),t("#mqeditor").empty().show(),e.layout.tabs?function(e,a,s){var r=document.createElement("div");r.className="mqed-row mqed-tabrow";var n,o,i=document.createElement("div");e.appendChild(r),e.appendChild(i);for(var d=0;d<a.tabs.length;d++)if(!0===a.tabs[d].enabled){q(r,a.tabs[d],s+"-"+d),(o=document.createElement("div")).className="mqed-row mqed-tabpanel",o.id=s+"-"+d+"-tabpanel",i.appendChild(o);for(var l=0;l<a.tabs[d].tabcontent.length;l++)(n=a.tabs[d].tabcontent[l]).hasOwnProperty("flow")&&0==n.contents.length||(n.hasOwnProperty("flow")?g(o,n,s+"-"+d+"-"+l):q(o,n,s+"-"+d+"-"+l))}q(r,{s:1}),q(r,{p:"&times;",c:"close",lb:"close"}),t(e).find(".mqed-tab").first().addClass("mqed-activetab")}(document.getElementById("mqeditor"),e.layout,"mqeditor"):g(document.getElementById("mqeditor"),e.layout,"mqeditor"),t("#mqeditor .mqed-btn.rend").each(function(){o.StaticMath(this,{mouseEvents:!1})}),t("#mqeditor .mqed-tabrow").length>0)){t("#mqeditor .mqed-tabpanel").hide().first().show();var u=t("#mqeditor .mqed-tabrow + div");u.css("height",u.height())}"OSK"!==e.curlayoutstyle||d()?t("#mqeditor").show():t("#mqeditor").slideDown(50,function(){var e=t("#mqeditor").height()+5,a=t(window).height()-(i.offset().top+i.outerHeight()-t(window).scrollTop());a<e&&t(window).scrollTop(t(window).scrollTop()+(e-a))}),p(i),s=o.MathField(i[0]),t("#"+i[0].id.substring(8)).triggerHandler("focus"),e.hasOwnProperty("onShow")&&e.onShow(i[0],e.curlayoutstyle,m),t(document).trigger("mqeditor:show")}function h(a){s&&(t(document).trigger("mqeditor:hide"),"OSK"!==e.curlayoutstyle||d()?t("#mqeditor").hide():t("#mqeditor").slideUp(50),t("#"+s.el().id.substring(8)).trigger("change",!0).triggerHandler("blur"),s=null)}function p(a){if("under"==e.curlayoutstyle||d()){var s=t(a).closest(".mathquill-math-field"),r=s.offset(),n=s.outerHeight(),o=r.left;if(document.getElementById("mqeditor")){var i=document.getElementById("mqeditor").offsetWidth;o+i>document.documentElement.clientWidth&&(o=document.documentElement.clientWidth-i-5)}d()?t("#mqeditor").css("top",r.top+n+3).css("left",0):t("#mqeditor").css("top",r.top+n+3).css("left",o)}else t("#mqeditor").css("top","auto").css("left",0)}function y(a){var r=a.el();if(p(r),e.hasOwnProperty("onResize")&&e.onResize(r,e.curlayoutstyle),r.id.match(/mqinput/)){var n=a.latex();a.data._suppressHistory||(a.data.historyIndex<a.data.history.length-1&&a.data.history.splice(a.data.historyIndex+1),(0==a.data.history.length||""!=n&&a.data.history[a.data.history.length-1]!=n)&&(a.data.history.push(n),a.data.history.length>10&&a.data.history.shift(),a.data.historyIndex=a.data.history.length-1)),e.hasOwnProperty("fromMQ")&&(n=e.fromMQ(n,r.id)),t("#"+r.id.substring(8)).val(n).trigger("input"),""!=n&&t("#"+r.id.substring(8)).siblings("input[id^=qs][value=spec]").prop("checked",!0),s&&s.setAriaPostLabel(""),e.hasOwnProperty("onEdit")&&e.onEdit(r.id,n)}}function f(t){e.hasOwnProperty("onEnter")&&e.onEnter(t.el().id)}function b(){var t=document.documentElement.clientWidth;return navigator.userAgent.match(/Android/)||navigator.userAgent.match(/iPhone/)||navigator.userAgent.match(/iPad/)||t<500?"OSK":"under"}function g(t,e,a){var s=e.flow,r=100;e.hasOwnProperty("s")&&"row"==s&&(r=e.s);var n=document.createElement("div");e.hasOwnProperty("s")&&(n.style.flexGrow=e.s),e.hasOwnProperty("class")&&(n.className=e.class),e.hasOwnProperty("tabpanel")&&(n.id=e.tabpanel.id,n.style.display=e.tabpanel.hidden?"none":""),(c=document.createElement("div")).className="mqed-"+s;for(var o,i=0,d=0,l=0;l<e.contents.length;l++)if(!(o=e.contents[l]).hasOwnProperty("flow")||0!=o.contents.length){var c;if(i+(d=o.hasOwnProperty("s")?o.s:1)>r)n.appendChild(c),i=0,(c=document.createElement("div")).className="mqed-"+s;o.hasOwnProperty("flow")?g(c,o,a+"-"+l):q(c,o,a+"-"+l),i+=d}n.appendChild(c),t.appendChild(n)}function q(e,a,s){var r,o,i,d;if((o=document.createElement("div")).className="mqed-btn-cont",a.s&&(o.style.flexGrow=a.s),a.contid&&(o.id=a.contid),a.contclass&&t(o).addClass(a.contclass),e.appendChild(o),a.l||a.b||a.p){if((r=document.createElement("span")).tabIndex=0,a.l){if(a.op)r.className="mqed-btn mq-math-mode",r.innerHTML='<span class="mq-root-block"><var class="mq-operator-name">'+a.l.substring(1)+"</var></span>";else if(a.pr)r.className="mqed-btn mq-math-mode",r.innerHTML='<span class="mq-root-block">'+a.pr+"</span>";else if(a.l.match(/\\left(.)\\right(.)/)){var l=a.l.match(/\\left(.)\\right(.)/);r.className="mqed-btn mq-math-mode",r.innerHTML='<span class="mq-non-leaf"><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">'+l[1]+'</span><span class="mq-non-leaf mq-empty"></span><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">'+l[2]+"</span></span>"}else r.className="mqed-btn rend",r.innerText=a.l;i="c",d=a.l.substring(1)}else a.b?(a.r?(r.className="mqed-btn rend",r.innerHTML=a.b):(r.className="mqed-btn mq-math-mode",a.v?r.innerHTML='<span class="mq-root-block"><var>'+a.b+"</var></span>":r.innerHTML='<span class="mq-root-block"><span>'+a.b+"</span></span>"),i="t",((d=a.b).match(/^\d$/)||"."==d)&&t(r).addClass("mqed-digitkey")):(r.className="mqed-btn",r.innerHTML=a.p,i="t",d=a.p);a.c&&("shift"==(i=a.c)?t(r).addClass("mqed-shift"):"k"==i?t(r).addClass("mqed-navkey"):"close"==i&&t(r).addClass("mqed-closebtn")),a.lb&&r.setAttribute("aria-label",a.lb),a.sm&&(r.style.fontSize=100-10*a.sm+"%"),a.w&&(d=a.w),a.tabcontent&&(t(r).addClass("mqed-tab"),i="showtabpanel",d=s+"-tabpanel"),t(r).data("cmdtype",i).data("cmdval",d),t(r).on("click mousedown touchstart keydown",function(t,e){return function(a){v(a,t,e)}}(i,d)).on("touchend",function(e){setTimeout(function(){t(e.currentTarget).removeClass("mactive")},50)}).on("touchend mouseup",function(){clearTimeout(n),n=null}),o.appendChild(r)}}function v(a,r,o){if(("mousedown"!=a.type||"Backspace"===o)&&!("click"==a.type&&"Backspace"===o||"keydown"==a.type&&"Enter"!==a.key))if("touchstart"==a.type&&(a.preventDefault(),t(a.currentTarget).addClass("mactive")),"t"==r)o.match(/^[a-zA-Z]$/)&&t(a.target).closest(".mqed-tabpanel").find(".mqed-shift").hasClass("active")&&(o=o.toUpperCase()),s.typedText(o);else if("c"==r)s.cmd(o);else if("l"==r)s.latex(o);else if("w"==r){if(s.write(o),m=o.match(/bmatrix}(.*?)(\\\\|\\end{bm)/))for(var i=m[1].split(/&/).length,d=0;d<i;d++)s.keystroke("Left")}else if("k"==r)s.keystroke(o),"Backspace"===o&&(n=setTimeout(function(){v(a,r,o)},null===n?600:70));else if("m"==r)s.matrixCmd(o);else if("f"==r){if((l=s.selection())&&l.startIndex!=l.endIndex){let t=l.latex.substring(l.startIndex,l.endIndex);s.write(o+"\\left("+t+"\\right)"),s.keystroke("Left")}else o.match(/{}$/)?s.typedText(o.replace(/{}$/,"")):s.write(o)}else if("sf"==r){if((l=s.selection())&&l.startIndex!=l.endIndex){let t=l.latex.substring(l.startIndex,l.endIndex);s.write(o+"{"+t+"}")}else s.cmd(o);s.keystroke("Left")}else if("i"==r){var l,c="";if((l=s.selection())&&l.startIndex!=l.endIndex&&(c=l.latex.substring(l.startIndex,l.endIndex)),"string"==typeof o){var u=o.charAt(0),h=o.charAt(1);s.write("\\left"+u+c+"\\right"+h)}else s.write(o[0]+c+o[1]);""==c&&s.keystroke("Left")}else if("showtabpanel"==r){(p=t(a.target).closest(".mqed-btn")).closest(".mqeditor").find(".mqed-tabpanel").hide(),p.closest(".mqeditor").find(".mqed-btn.mqed-activetab").removeClass("mqed-activetab"),t("#"+o).show(),p.addClass("mqed-activetab"),e.hasOwnProperty("onTab")&&e.onTab(p[0],e.curlayoutstyle,o)}else if("shift"==r){var p=t(a.target).closest(".mqed-btn"),y=t(a.target).closest(".mqed-tabpanel"),f=!p.hasClass("active");f?p.addClass("active"):p.removeClass("active"),y.find(".mqed-btn").each(function(t,e){e.textContent.match(/^[a-zA-Z]$/)&&(e.textContent=f?e.textContent.toUpperCase():e.textContent.toLowerCase())})}else"close"==r&&s.blur()}return{setConfig:function(t){for(var a in t)e[a]=t[a]},toggleMQ:l,toggleMQAll:function(e,a){var s=a||null;t(e).each(function(t,e){l(e,s,!0)})},attachEditor:c,getLayoutstyle:b,resetEditor:function(){clearTimeout(r),t("#mqeditor").hide(),s=null}}}(jQuery);function isOldiOS(){const t=(navigator.userAgent||navigator.vendor||window.opera).match(/OS (\d+)_\d+/i);if(t&&t.length>1){return parseInt(t[1],10)<=13}return!1}