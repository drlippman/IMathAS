!function(){var d,s,i,r,m,g,b,u,v,w,x,o,a,n,c,h,f,p,q,y,O,k,t,C,j,Q,e,l,T,S,D,_,E,A,L,z,R,I,M,B,P,F,N,$,V,K,U,W,H,X,Y,G,Z,J,tt,et,nt,it,st,rt,ot,at,lt,ct,ht,ut,ft,pt,dt,mt,gt,bt,vt,wt,xt,qt,yt,Ot=window.jQuery,kt="mathquill-command-id",Ct="mathquill-block-id",jt=Math.min,Qt=Math.max;if(!Ot)throw"MathQuill requires jQuery 1.5.2+ to be loaded first";function Tt(){}function St(n){var i=n.length-1;return function(){var t=s.call(arguments,0,i),e=s.call(arguments,i);return n.apply(this,t.concat([e]))}}function Dt(t){return St(function(e,n){"function"!=typeof e&&(e=i(e));return t.call(this,function(t){return e.apply(t,[t].concat(n))})})}function _t(t){var e=s.call(arguments,1);return function(){return t.apply(this,e)}}function Et(t,e){if(!e)throw new Error("prayer failed: "+t)}function At(t){Et("a direction was passed",t===m||t===g)}function Lt(t,e,n){Et("a parent is always present",t),Et("leftward is properly set up",e?e[g]===n&&e.parent===t:t.ends[m]===n),Et("rightward is properly set up",n?n[m]===e&&n.parent===t:t.ends[g]===e)}function zt(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')}function Rt(t){return zt(),wt(t)}function It(o){var a,t,e;if(!(O<=o&&o<=k))throw"Only interface versions between "+O+" and "+k+" supported. You specified: "+o;function l(t){var e,n;return t&&t.nodeType&&(n=(e=b(t).children(".mq-root-block").attr(Ct))&&v.byId[e].controller)?a[n.KIND_OF_MQ](n):null}function n(t,e){var n,i,s;for(n in e&&e.handlers&&(e.handlers={fns:e.handlers,APIClasses:a}),e)e.hasOwnProperty(n)&&(i=e[n],s=p[n],t[n]=s?s(i):i)}for(e in a={},l.L=m,l.R=g,l.saneKeyboardEvents=C,l.config=function(t){return n(f.p,t),this},l.registerEmbed=function(t,e){if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";y[t]=e},t=a.AbstractMathQuill=r(q,function(t){t.init=function(t){this.__controller=t,this.__options=t.options,this.id=t.id,this.data=t.data},t.__mathquillify=function(t){var e,n=this.__controller,i=n.root,s=n.container;n.createTextarea(),e=s.addClass(t).contents().detach(),i.jQ=b('<span class="mq-root-block"/>').attr(Ct,i.id).appendTo(s),this.latex(e.text()),this.revert=function(){return s.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(e)}},t.config=function(t){return n(this.__options,t),this},t.el=function(){return this.__controller.container[0]},t.text=function(){return this.__controller.exportText()},t.latex=function(t){return 0<arguments.length?(this.__controller.renderLatexMath(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},t.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},t.reflow=function(){return this.__controller.root.postOrder("reflow"),this}}),l.prototype=t.prototype,a.EditableField=r(t,function(t,e){t.__mathquillify=function(){return e.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},t.focus=function(){return this.__controller.textarea.focus(),this},t.blur=function(){return this.__controller.textarea.blur(),this},t.write=function(t){return this.__controller.writeLatex(t),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},t.empty=function(){var t=this.__controller.root,e=this.__controller.cursor;return t.eachChild("postOrder","dispose"),t.ends[m]=t.ends[g]=0,t.jQ.empty(),delete e.selection,e.insAtRightEnd(t),this},t.cmd=function(t){var e,n=this.__controller.notify(),i=n.cursor;return/^\\[a-z]+$/i.test(t)&&!i.isTooDeep()?(t=t.slice(1),(e=x[t]||mt[t])&&(t=e(t),i.selection&&t.replaces(i.replaceSelection()),t.createLeftOf(i.show()),this.__controller.scrollHoriz())):i.parent.write(i,t),n.blurred&&i.hide().parent.blur(),this},t.select=function(){var t=this.__controller;for(t.notify("move").cursor.insAtRightEnd(t.root);t.cursor[m];)t.selectLeft();return this},t.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},t.matrixCmd=function(t){var e=this.__controller.notify().cursor;return e.parent.parent instanceof gt&&(t.match(/add/)?e.parent.parent.insert(t,e.parent):e.parent.parent.remove(t,e.parent)),this},t.getSelection=function(){return this.__controller.cursor.selection?this.__controller.cursor.selection.join("latex"):null},t.moveToDirEnd=function(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this},t.moveToLeftEnd=function(){return this.moveToDirEnd(m)},t.moveToRightEnd=function(){return this.moveToDirEnd(g)},t.keystroke=function(t){var e;for(t=t.replace(/^\s+|\s+$/g,"").split(/\s+/),e=0;e<t.length;e+=1)this.__controller.keystroke(t[e],{preventDefault:Tt});return this},t.typedText=function(t){for(var e=0;e<t.length;e+=1)this.__controller.typedText(t.charAt(e));return this},t.dropEmbedded=function(t,e,n){var i=t-b(window).scrollLeft(),s=e-b(window).scrollTop(),r=document.elementFromPoint(i,s);this.__controller.seek(b(r),t,e),dt().setOptions(n).createLeftOf(this.__controller.cursor)},t.clickAt=function(t,e,n){n=n||document.elementFromPoint(t,e);var i=this.__controller,s=i.root;return Ot.contains(s.jQ[0],n)||(n=s.jQ[0]),i.seek(b(n),t+pageXOffset,e+pageYOffset),i.blurred&&this.focus(),this},t.ignoreNextMousedown=function(t){return this.__controller.cursor.options.ignoreNextMousedown=t,this}}),(l.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"}).prototype=a.EditableField.prototype,h)!function(s,t){var r=a[s]=t(a);(l[s]=function(t,e){var n,i=l(t);return i instanceof r||!t||!t.nodeType?i:((n=c(r.RootBlock(),b(t),f())).KIND_OF_MQ=s,r(n).__mathquillify(e,o))}).prototype=r.prototype}(e,h[e]);return l}function Mt(t){var e,n="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" ");for(e=0;e<n.length;e+=1)!function(e){t[e]=function(t){this.controller.handle(e,t)}}(n[e]);t.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function Bt(t,e,n){return r(A,{ctrlSeq:t,htmlTemplate:"<"+e+" "+n+">&0</"+e+">"})}for(V in s=[].slice,i=St(function(n,i){return St(function(t,e){if(n in t)return t[n].apply(t,i.concat(e))})}),r=function(l,c,t){function h(t){return"object"==typeof t}function u(t){return"function"==typeof t}function f(){}return function e(n,t){var i,s,r;function o(){var t=new a;return u(t.init)&&t.init.apply(t,arguments),t}function a(){}return void 0===t&&(t=n,n=Object),o.Bare=a,i=f[l]=n[l],((s=a[l]=o[l]=o.p=new f).constructor=o).extend=function(t){return e(o,t)},(o.open=function(t){if(r={},u(t)?r=t.call(o,s,i,o,n):h(t)&&(r=t),h(r))for(var e in r)c.call(r,e)&&(s[e]=r[e]);return u(s.init)||(s.init=n),o})(t)}}("prototype",{}.hasOwnProperty),m=-1,g=1,b=r(Ot,function(t){t.insDirOf=function(t,e){return t===m?this.insertBefore(e.first()):this.insertAfter(e.last())},t.insAtDirEnd=function(t,e){return t===m?this.prependTo(e):this.appendTo(e)}}),u=r(function(t){t.parent=0,t[m]=0,t[g]=0,t.init=function(t,e,n){this.parent=t,this[m]=e,this[g]=n},this.copy=function(t){return u(t.parent,t[m],t[g])}}),v=r(function(t){t[m]=0,t[g]=0;var e=t.parent=0;this.byId={},t.init=function(){this.id=e+=1,(v.byId[this.id]=this).ends={},this.ends[m]=0,this.ends[g]=0},t.dispose=function(){delete v.byId[this.id]},t.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},t.jQ=b(),t.jQadd=function(t){return this.jQ=this.jQ.add(t)},t.jQize=function(t){var e;function i(t){var e,n;for(t.getAttribute&&(e=t.getAttribute("mathquill-command-id"),n=t.getAttribute("mathquill-block-id"),e&&v.byId[e].jQadd(t),n&&v.byId[n].jQadd(t)),t=t.firstChild;t;t=t.nextSibling)i(t)}for(t=b(t||this.html()),e=0;e<t.length;e+=1)i(t[e]);return t},t.createDir=function(t,e){At(t);return this.jQize(),this.jQ.insDirOf(t,e.jQ),e[t]=this.adopt(e.parent,e[m],e[g]),this},t.createLeftOf=function(t){return this.createDir(m,t)},t.selectChildren=function(t,e){return n(t,e)},t.bubble=Dt(function(t){var e;for(e=this;e&&!1!==t(e);e=e.parent);return this}),t.postOrder=Dt(function(n){return function t(e){e.eachChild(t),n(e)}(this),this}),t.isEmpty=function(){return 0===this.ends[m]&&0===this.ends[g]},t.isStyleBlock=function(){return!1},t.children=function(){return w(this.ends[m],this.ends[g])},t.eachChild=function(){var t=this.children();return t.each.apply(t,arguments),this},t.foldChildren=function(t,e){return this.children().fold(t,e)},t.withDirAdopt=function(t,e,n,i){return w(this,this).withDirAdopt(t,e,n,i),this},t.adopt=function(t,e,n){return w(this,this).adopt(t,e,n),this},t.disown=function(){return w(this,this).disown(),this},t.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),w=r(function(t){t.init=function(t,e,n){if(n===d&&(n=m),At(n),Et("no half-empty fragments",!t==!e),this.ends={},t){Et("withDir is passed to Fragment",t instanceof v),Et("oppDir is passed to Fragment",e instanceof v),Et("withDir and oppDir have the same parent",t.parent===e.parent),this.ends[n]=t,this.ends[-n]=e;var i=this.fold([],function(t,e){return t.push.apply(t,e.jQ.get()),t});this.jQ=this.jQ.add(i)}},t.jQ=b(),t.withDirAdopt=function(t,e,n,i){return t===m?this.adopt(e,n,i):this.adopt(e,i,n)},t.adopt=function(e,n,t){var i,s,r;return Lt(e,n,t),(i=this).disowned=!1,(s=i.ends[m])?(r=i.ends[g],n||(e.ends[m]=s),t?t[m]=r:e.ends[g]=r,i.ends[g][g]=t,i.each(function(t){t[m]=n,t.parent=e,n&&(n[g]=t),n=t}),i):this},t.disown=function(){var t,e,n=this,i=n.ends[m];return!i||n.disowned||(n.disowned=!0,t=n.ends[g],Lt(e=i.parent,i[m],i),Lt(e,t,t[g]),i[m]?i[m][g]=t[g]:e.ends[m]=t[g],t[g]?t[g][m]=i[m]:e.ends[g]=i[m]),n},t.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},t.each=Dt(function(t){var e=this,n=e.ends[m];if(!n)return e;for(;n!==e.ends[g][g]&&!1!==t(n);n=n[g]);return e}),t.fold=function(e,n){return this.each(function(t){e=n.call(this,e,t)}),e}}),x={},o={},a=r(u,function(t){t.init=function(t,e){this.parent=t,this.options=e;var n=this.jQ=this._jQ=b('<span class="mq-cursor">&#8203;</span>');this.blink=function(){n.toggleClass("mq-blink")},this.upDownCache={}},t.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[g]?this.selection&&this.selection.ends[m][m]===this[m]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[g].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=b(),this},t.withDirInsertAt=function(t,e,n,i){var s=this.parent;this.parent=e,this[t]=n,this[-t]=i,s!==e&&s.blur&&s.blur(this)},t.insDirOf=function(t,e){return At(t),this.jQ.insDirOf(t,e.jQ),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("mq-hasCursor"),this},t.insLeftOf=function(t){return this.insDirOf(m,t)},t.insRightOf=function(t){return this.insDirOf(g,t)},t.insAtDirEnd=function(t,e){return At(t),this.jQ.insAtDirEnd(t,e.jQ),this.withDirInsertAt(t,e,0,e.ends[t]),e.focus(),this},t.insAtLeftEnd=function(t){return this.insAtDirEnd(m,t)},t.insAtRightEnd=function(t){return this.insAtDirEnd(g,t)},t.jumpUpDown=function(t,e){var n,i,s=this;s.upDownCache[t.id]=u.copy(s),(n=s.upDownCache[e.id])?n[g]?s.insLeftOf(n[g]):s.insAtRightEnd(n.parent):(i=s.offset().left,e.seek(i,s))},t.offset=function(){var t=this.jQ.removeClass("mq-cursor").offset();return this.jQ.addClass("mq-cursor"),t},t.unwrapGramp=function(){var e=this.parent.parent,n=e.parent,i=e[g],t=this,s=e[m];if(e.disown().eachChild(function(t){t.isEmpty()||(t.children().adopt(n,s,i).each(function(t){t.jQ.insertBefore(e.jQ.first())}),s=t.ends[g])}),!this[g])if(this[m])this[g]=this[m][g];else for(;!this[g];){if(this.parent=this.parent[g],!this.parent){this[g]=e[g],this.parent=n;break}this[g]=this.parent.ends[m]}this[g]?this.insLeftOf(this[g]):this.insAtRightEnd(n),e.jQ.remove(),e[m].siblingDeleted&&e[m].siblingDeleted(t.options,g),e[g].siblingDeleted&&e[g].siblingDeleted(t.options,m)},t.startSelection=function(){var t,e=this.anticursor=u.copy(this),n=e.ancestors={};for(t=e;t.parent;t=t.parent)n[t.parent.id]=t},t.endSelection=function(){delete this.anticursor},t.select=function(){var t,e,n,i,s,r,o,a=this.anticursor;if(this[m]===a[m]&&this.parent===a.parent)return!1;for(t=this;t.parent;t=t.parent)if(t.parent.id in a.ancestors){e=t.parent;break}if(Et("cursor and anticursor in the same tree",e),n=a.ancestors[e.id],r=g,t[m]!==n)for(o=t;o;o=o[g])if(o[g]===n[g]){r=m,i=t,s=n;break}return r===g&&(i=n,s=t),i instanceof u&&(i=i[g]),s instanceof u&&(s=s[m]),this.hide().selection=e.selectChildren(i,s),this.insDirOf(r,this.selection.ends[r]),this.selectionChanged(),!0},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},t.deleteSelection=function(){this.selection&&(this[m]=this.selection.ends[m][m],this[g]=this.selection.ends[g][g],this.selection.remove(),this.selectionChanged(),delete this.selection)},t.replaceSelection=function(){var t=this.selection;return t&&(this[m]=t.ends[m][m],this[g]=t.ends[g][g],delete this.selection),t},t.depth=function(){for(var t=this,e=0;t=t.parent;)e+=t instanceof _?1:0;return e},t.isTooDeep=function(t){if(this.options.maxDepth!==d)return this.depth()+(t||0)>this.options.maxDepth}}),n=r(w,function(t,e){t.init=function(){e.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},t.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),e.adopt.apply(this,arguments)},t.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},t.join=function(n){return this.fold("",function(t,e){return t+e[n]()})}}),c=r(function(t){t.init=function(t,e,n){this.id=t.id,this.data={},this.root=t,this.container=e,this.options=n,(t.controller=this).cursor=t.cursor=a(t,n)},t.handle=function(t,e){var n,i=this.options.handlers;i&&i.fns[t]&&(n=i.APIClasses[this.KIND_OF_MQ](this),e===m||e===g?i.fns[t](e,n):i.fns[t](n))};var e=[];this.onNotify=function(t){e.push(t)},t.notify=function(){for(var t=0;t<e.length;t+=1)e[t].apply(this.cursor,arguments);return this}}),h={},f=r(),p={},q=r(),y={},Rt.prototype=q.p,Rt.VERSION="v0.10.1",Rt.interfaceVersion=function(t){if(1!==t)throw"Only interface version 1 supported. You specified: "+t;return(zt=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')})(),Rt},O=(Rt.getInterface=It).MIN=1,k=It.MAX=2,Rt.noConflict=function(){return window.MathQuill=t,Rt},t=window.MathQuill,window.MathQuill=Rt,qt={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"},C=function(t,r){var s,o,a=null,l=null,c=null,h=Ot(t),e=Ot(r.container||h),u=Tt;function f(t){u=t,clearTimeout(s),s=setTimeout(t)}function p(){var t,e,n,i,s;r.keystroke((n=(t=a).which||t.keyCode,i=qt[n],s=[],t.ctrlKey&&s.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&s.push("Meta"),t.altKey&&s.push("Alt"),t.shiftKey&&s.push("Shift"),e=i||String.fromCharCode(n),s.length||i?(s.push(e),s.join("-")):e),a)}function i(){if(!("selectionStart"in(t=h[0])&&t.selectionStart!==t.selectionEnd)){var t,e=h.val();1===e.length?(h.val(""),r.typedText(e)):e&&h[0].select&&h[0].select()}}function n(){var t=h.val();h.val(""),t&&r.paste(t)}return e.bind("keydown keypress input keyup focusout paste",function(t){u(t)}),o=!1,e.bind({keydown:function(t){var e,n,i;a=t,l=null,c=!1,o&&f(function(t){t&&"focusout"===t.type||!h[0].select||h[0].select(),u=Tt,clearTimeout(s)}),r.options.keyboardPassthrough?(e=t.which||t.keyCode,n=qt[e],t.ctrlKey||t.originalEvent&&t.originalEvent.metaKey?("C"==(i=String.fromCharCode(e))?r.cursor.selection&&(window.MathQuillClipboard=r.cursor.selection.join("latex")):"X"==i?r.cursor.selection&&(window.MathQuillClipboard=r.cursor.selection.join("latex"),r.cursor.deleteSelection()):"V"==i?window.MathQuillClipboard&&r.writeLatex(window.MathQuillClipboard):p(),c=!0):(n||t.originalEvent&&t.originalEvent.metaKey||t.altKey)&&(p(),c=!0)):p()},keypress:function(t){var e,n;r.options.keyboardPassthrough?(e=t.which||t.keyCode,c||(n=String.fromCharCode(e),r.typedText(n))):(a&&l&&p(),l=t,f(i))},focusout:function(){a=l=null},paste:function(t){h.focus(),f(n)}}),{select:function(t){u(),u=Tt,clearTimeout(s),h.val(t),t&&h[0].select&&h[0].select(),o=!!t}}},j=r(function(t,e,a){var n,i,s;function r(t,e){throw"Parse Error: "+e+" at "+(t=t?"'"+t+"'":"EOF")}t.init=function(t){this._=t},t.parse=function(t){return this.skip(s)._(""+t,function(t,e){return e},r)},t.or=function(s){Et("or is passed a parser",s instanceof a);var t=this;return a(function(e,n,i){return t._(e,n,function(t){return s._(e,n,i)})})},t.then=function(r){var e=this;return a(function(t,i,s){return e._(t,function(t,e){var n=r instanceof a?r:r(e);return Et("a parser is returned",n instanceof a),n._(t,i,s)},s)})},t.many=function(){var o=this;return a(function(n,t,e){for(var i=[];o._(n,s,r););return t(n,i);function s(t,e){return n=t,i.push(e),!0}function r(){return!1}})},t.times=function(h,u){arguments.length<2&&(u=h);var f=this;return a(function(n,t,e){var i,s,r=[],o=!0;for(s=0;s<h;s+=1)if(!(o=f._(n,a,l)))return e(n,i);for(;s<u&&o;s+=1)o=f._(n,a,c);return t(n,r);function a(t,e){return r.push(e),n=t,!0}function l(t,e){return i=e,n=t,!1}function c(t,e){return!1}})},t.result=function(t){return this.then(i(t))},t.atMost=function(t){return this.times(0,t)},t.atLeast=function(t){var n=this;return n.times(t).then(function(e){return n.many().map(function(t){return e.concat(t)})})},t.map=function(e){return this.then(function(t){return i(e(t))})},t.skip=function(e){return this.then(function(t){return e.result(t)})},this.string=function(s){var r=s.length,o="expected '"+s+"'";return a(function(t,e,n){var i=t.slice(0,r);return i===s?e(t.slice(r),i):n(t,o)})},n=this.regex=function(r){Et("regexp parser is anchored","^"===r.toString().charAt(1));var o="expected "+r;return a(function(t,e,n){var i,s=r.exec(t);return s?(i=s[0],e(t.slice(i.length),i)):n(t,o)})},i=a.succeed=function(n){return a(function(t,e){return e(t,n)})},a.fail=function(i){return a(function(t,e,n){return n(t,i)})},a.letter=n(/^[a-z]/i),a.letters=n(/^[a-z]*/i),a.digit=n(/^[0-9]/),a.digits=n(/^[0-9]*/),a.whitespace=n(/^\s+/),a.optWhitespace=n(/^\s*/),a.any=a(function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")}),a.all=a(function(t,e,n){return e("",t)}),s=a.eof=a(function(t,e,n){return t?n(t,"expected EOF"):e(t,t)})}),yt={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"},C=function(t,r){var n,s,o=null,a=null,l=null,c=Ot(t),e=Ot(r.container||c),i=Tt;function h(t){i=t,clearTimeout(n),n=setTimeout(t)}function u(e){h(function(t){i=Tt,clearTimeout(n),e(t)})}function f(){var t,e,n,i,s;r.keystroke((n=(t=o).which||t.keyCode,i=yt[n],s=[],t.ctrlKey&&s.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&s.push("Meta"),t.altKey&&s.push("Alt"),t.shiftKey&&s.push("Shift"),e=i||String.fromCharCode(n),s.length||i?(s.push(e),s.join("-")):e),o)}function p(){if(!("selectionStart"in(t=c[0])&&t.selectionStart!==t.selectionEnd)){var t,e=c.val();1===e.length?(c.val(""),r.typedText(e)):e&&c[0].select&&c[0].select()}}function d(){var t=c.val();c.val(""),t&&r.paste(t)}return e.bind("keydown keypress input keyup focusout paste",function(t){i(t)}),s=!1,e.bind({keydown:function(t){var e,n,i;o=t,a=null,l=!1,s&&u(function(t){t&&"focusout"===t.type||!c[0].select||c[0].select()}),r.options.keyboardPassthrough?(e=t.which||t.keyCode,n=yt[e],t.ctrlKey||t.originalEvent&&t.originalEvent.metaKey?"C"==(i=String.fromCharCode(e))?(r.cursor.selection&&(window.MathQuillClipboard=r.cursor.selection.join("latex")),l=!0):"X"==i?(r.cursor.selection&&(window.MathQuillClipboard=r.cursor.selection.join("latex"),r.cursor.deleteSelection()),l=!0):"V"==i?(window.MathQuillClipboard&&r.writeLatex(window.MathQuillClipboard),l=!0):("A"==i||n)&&(f(),l=!0):n&&"Spacebar"!==n&&(f(),l=!0)):f()},keypress:function(t){var e,n;r.options.keyboardPassthrough?(e=t.which||t.keyCode,l||(n=String.fromCharCode(e),r.typedText(n),a=t)):(o&&a&&f(),a=t,h(p))},keyup:function(t){r.options.keyboardPassthrough||o&&!a&&h(p)},focusout:function(){o=a=null},cut:function(){u(function(){r.cut()})},copy:function(){u(function(){r.copy()})},paste:function(t){c.focus(),h(d)}}),{select:function(t){i(),i=Tt,clearTimeout(n),c.val(t),t&&c[0].select&&c[0].select(),s=!!t}}},c.open(function(t,e){t.exportText=function(){return this.root.foldChildren("",function(t,e){return t+e.text()})}}),c.open(function(t){t.focusBlurEvents=function(){var t,e=this,n=e.root,i=e.cursor;e.textarea.focus(function(){e.blurred=!1,clearTimeout(t),e.container.addClass("mq-focused"),i.parent||i.insAtRightEnd(n),i.selection?(i.selection.jQ.removeClass("mq-blur"),e.selectionChanged()):i.show()}).blur(function(){e.blurred=!0,t=setTimeout(function(){n.postOrder("intentionalBlur"),i.selection&&i.selection.jQ.addClass("mq-blur"),i.hide().parent.blur(),e.container.removeClass("mq-focused")},100)}),e.blurred=!0,i.hide().parent.blur()}}),c.open(function(t){t.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this)}}),v.open(function(t){t.keystroke=function(t,e,n){var i=n.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":n.ctrlDeleteDir(m);break;case"Shift-Backspace":case"Backspace":n.backspace();break;case"Esc":case"Tab":return void n.escapeDir(g,t,e);case"Shift-Tab":case"Shift-Esc":return void n.escapeDir(m,t,e);case"End":n.notify("move").cursor.insAtRightEnd(i.parent);break;case"Ctrl-End":n.notify("move").cursor.insAtRightEnd(n.root);break;case"Shift-End":for(;i[g];)n.selectRight();break;case"Ctrl-Shift-End":for(;i[g]||i.parent!==n.root;)n.selectRight();break;case"Home":n.notify("move").cursor.insAtLeftEnd(i.parent);break;case"Ctrl-Home":n.notify("move").cursor.insAtLeftEnd(n.root);break;case"Shift-Home":for(;i[m];)n.selectLeft();break;case"Ctrl-Shift-Home":for(;i[m]||i.parent!==n.root;)n.selectLeft();break;case"Left":n.moveLeft();break;case"Shift-Left":n.selectLeft();break;case"Ctrl-Left":break;case"Right":n.moveRight();break;case"Shift-Right":n.selectRight();break;case"Ctrl-Right":break;case"Up":n.moveUp();break;case"Down":n.moveDown();break;case"Shift-Up":if(i[m])for(;i[m];)n.selectLeft();else n.selectLeft();case"Shift-Down":if(i[g])for(;i[g];)n.selectRight();else n.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":n.ctrlDeleteDir(g);break;case"Shift-Del":case"Del":n.deleteForward();break;case"Meta-A":case"Ctrl-A":for(n.notify("move").cursor.insAtRightEnd(n.root);i[m];)n.selectLeft();break;default:return}e.preventDefault(),n.scrollHoriz()},t.moveOutOf=t.moveTowards=t.deleteOutOf=t.deleteTowards=t.unselectInto=t.selectOutOf=t.selectTowards=function(){Et("overridden or never called on this node")}}),c.open(function(t){function e(t,e){var n=t.notify("upDown").cursor,i=e+"Into",s=e+"OutOf";return n[g][i]?n.insAtLeftEnd(n[g][i]):n[m][i]?n.insAtRightEnd(n[m][i]):n.parent.bubble(function(t){var e=t[s];if(e&&("function"==typeof e&&(e=t[s](n)),e instanceof v&&n.jumpUpDown(t,e),!0!==e))return!1}),t}this.onNotify(function(t){"move"!==t&&"upDown"!==t||this.show().clearSelection()}),t.escapeDir=function(t,e,n){At(t);var i=this.cursor;if(i.parent!==this.root&&n.preventDefault(),i.parent!==this.root)return i.parent.moveOutOf(t,i),this.notify("move")},p.leftRightIntoCmdGoes=function(t){if(t&&"up"!==t&&"down"!==t)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},t.moveDir=function(t){At(t);var e=this.cursor,n=e.options.leftRightIntoCmdGoes;return e.selection?e.insDirOf(t,e.selection.ends[t]):e[t]?e[t].moveTowards(t,e,n):e.parent.moveOutOf(t,e,n),this.notify("move")},t.moveLeft=function(){return this.moveDir(m)},t.moveRight=function(){return this.moveDir(g)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},this.onNotify(function(t){"upDown"!==t&&(this.upDownCache={})}),this.onNotify(function(t){"edit"===t&&this.show().deleteSelection()}),t.deleteDir=function(t){var e,n;return At(t),n=(e=this.cursor).selection,this.notify("edit"),n||(e[t]?e[t].deleteTowards(t,e):e.parent.deleteOutOf(t,e)),e[m].siblingDeleted&&e[m].siblingDeleted(e.options,g),e[g].siblingDeleted&&e[g].siblingDeleted(e.options,m),e.parent.bubble("reflow"),this},t.ctrlDeleteDir=function(t){At(t);var e=this.cursor;return!e[t]||e.selection?this.deleteDir(t):(this.notify("edit"),t===m?w(e.parent.ends[m],e[m]).remove():w(e[g],e.parent.ends[g]).remove(),e.insAtDirEnd(t,e.parent),e[m].siblingDeleted&&e[m].siblingDeleted(e.options,g),e[g].siblingDeleted&&e[g].siblingDeleted(e.options,m),e.parent.bubble("reflow"),this)},t.backspace=function(){return this.deleteDir(m)},t.deleteForward=function(){return this.deleteDir(g)},this.onNotify(function(t){"select"!==t&&this.endSelection()}),t.selectDir=function(t){var e,n=this.notify("select").cursor,i=n.selection;At(t),n.anticursor||n.startSelection(),(e=n[t])?i&&i.ends[t]===e&&n.anticursor[-t]!==e?e.unselectInto(t,n):e.selectTowards(t,n):n.parent.selectOutOf(t,n),n.clearSelection(),n.select()||n.show()},t.selectLeft=function(){return this.selectDir(m)},t.selectRight=function(){return this.selectDir(g)}}),Q=function(){var t,e,n,i,s,r,o,a,l,c,h,u,f,p,d;function m(t){var e,n=t[0]||_();for(e=1;e<t.length;e+=1)t[e].children().adopt(n,n.ends[g],0);return n}return t=j.string,e=j.regex,n=j.letter,i=j.any,s=j.optWhitespace,r=j.succeed,o=j.fail,a=n.map(function(t){return B(t)}),l=e(/^[^${}\\_^]/).map(function(t){return S(t)}),c=e(/^[^\\a-eg-zA-Z]/).or(t("\\").then(e(/^[a-z]+/i).or(e(/^\s+/).result(" ")).or(i))).then(function(t){var e=x[t];return e?e(t).parser():o("unknown command: \\"+t)}).or(a).or(l),h=t("{").then(function(){return f}).skip(t("}")),u=s.then(h.or(c.map(function(t){var e=_();return t.adopt(e,0,0),e}))),f=u.many().map(m).skip(s),p=t("[").then(u.then(function(t){return"]"!==t.join("latex")?r(t):o()}).many().map(m).skip(s)).skip(t("]")),(d=f).block=u,d.optBlock=p,d}(),c.open(function(t,e){t.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},p.maxDepth=function(t){return"number"==typeof t?t:d},t.writeLatex=function(t){var e=this.notify("edit").cursor,n=j.all,i=j.eof,s=Q.skip(i).or(n.result(!1)).parse(t);return s&&!s.isEmpty()&&s.prepareInsertionAt(e)&&(s.children().adopt(e.parent,e[m],e[g]),s.jQize().insertBefore(e.jQ),e[m]=s.ends[g],s.finalizeInsert(e.options,e),s.ends[g][g].siblingCreated&&s.ends[g][g].siblingCreated(e.options,m),s.ends[m][m].siblingCreated&&s.ends[m][m].siblingCreated(e.options,g),e.parent.bubble("reflow")),this},t.renderLatexMath=function(t){var e,n=this.root,i=this.cursor,s=(i.options,n.jQ),r=j.all,o=j.eof,a=Q.skip(o).or(r.result(!1)).parse(t);n.eachChild("postOrder","dispose"),n.ends[m]=n.ends[g]=0,a&&a.prepareInsertionAt(i)?(a.children().adopt(n,0,0),e=a.join("html"),s.html(e),n.jQize(s.children()),n.finalizeInsert(i.options)):s.empty(),delete i.selection,i.insAtRightEnd(n)},t.renderLatexText=function(t){var e,n,i,s,r,o,a,l,c=this.root,h=this.cursor;if(c.jQ.children().slice(1).remove(),c.eachChild("postOrder","dispose"),c.ends[m]=c.ends[g]=0,delete h.selection,h.show().insAtRightEnd(c),e=j.regex,n=j.string,i=j.eof,s=j.all,r=n("$").then(Q).skip(n("$").or(i)).map(function(t){var e,n=z(h);return n.createBlocks(),e=n.ends[m],t.children().adopt(e,0,0),n}),o=n("\\$").result("$").or(e(/^[^$]/)).map(S),a=r.or(o).many().skip(i).or(s.result(!1)).parse(t)){for(l=0;l<a.length;l+=1)a[l].adopt(c,c.ends[g],0);c.jQize().appendTo(c.jQ),c.finalizeInsert(h.options)}}}),c.open(function(t){f.p.ignoreNextMousedown=Tt,t.delegateMouseEvents=function(){var p=this.root.jQ;this.container.bind("mousedown.mathquill touchstart.mathquill",function(t){var i,e,n,s=b(t.target).closest(".mq-root-block"),r=v.byId[s.attr(Ct)||p.attr(Ct)],o=r.controller,a=o.cursor,l=a.blink,c=o.textareaSpan,h=o.textarea;function u(t){i=b(t.target)}function f(t){var e,n;a.anticursor||a.startSelection(),"touchmove"==t.type?(e=t.originalEvent.changedTouches[0]||t.originalEvent.touches[0],n=b(document.elementFromPoint(e.clientX,e.clientY)),Ot.contains(s[0],n[0])&&o.seek(n,e.pageX,e.pageY).cursor.select()):o.seek(i,t.pageX,t.pageY).cursor.select(),i=d}t.preventDefault(),t.target.unselectable=!0,a.options.ignoreNextMousedown(t)||(a.options.ignoreNextMousedown=Tt,o.blurred&&(o.editable||s.prepend(c),h.focus()),a.blink=Tt,"touchstart"==t.type?(e=t.originalEvent.changedTouches[0]||t.originalEvent.touches[0],n=b(document.elementFromPoint(e.clientX,e.clientY)),Ot.contains(s[0],n[0])&&o.seek(n,e.pageX,e.pageY).cursor.startSelection()):o.seek(b(t.target),t.pageX,t.pageY).cursor.startSelection(),s.bind("mousemove touchmove",u),b(t.target.ownerDocument).bind("mousemove touchmove",f).bind("mouseup touchend",function t(e){a.blink=l,a.selection||(o.editable?a.show():c.detach()),s.unbind("mousemove touchmove",u),b(e.target.ownerDocument).unbind("mousemove touchmove",f).unbind("mouseup touchend",t)}))})}}),c.open(function(t){t.seek=function(t,e,n){var i,s,r,o=this.notify("select").cursor;return t&&((i=t.attr(Ct)||t.attr(kt))||(i=(s=t.parent()).attr(Ct)||s.attr(kt))),Et("nodeId is the id of some Node that exists",r=i?v.byId[i]:this.root),o.clearSelection().show(),r.seek(e,o),this.scrollHoriz(),this}}),c.open(function(t){t.scrollHoriz=function(){var t,e,n,i,s,r=this.cursor,o=r.selection,a=this.root.jQ[0].getBoundingClientRect();if(o)if(i=(n=o.jQ[0].getBoundingClientRect()).left-(a.left+20),s=n.right-(a.right-20),o.ends[m]===r[g])if(i<0)e=i;else{if(!(0<s))return;e=n.left-s<a.left+20?i:s}else if(0<s)e=s;else{if(!(i<0))return;e=n.right-i>a.right-20?s:i}else if((t=r.jQ[0].getBoundingClientRect().left)>a.right-20)e=t-(a.right-20);else{if(!(t<a.left+20))return;e=t-(a.left+20)}this.root.jQ.stop().animate({scrollLeft:"+="+e},100)}}),c.open(function(t){f.p.substituteTextarea=function(){return b("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},t.createTextarea=function(){var t,e=this.textareaSpan=b('<span class="mq-textarea"></span>'),n=this.options.substituteTextarea();if(!n.nodeType)throw"substituteTextarea() must return a DOM element, got "+n;n=this.textarea=b(n).appendTo(e),(t=this).cursor.selectionChanged=function(){t.selectionChanged()}},t.selectionChanged=function(){var t=this;J(t.container[0]),t.textareaSelectionTimeout===d&&(t.textareaSelectionTimeout=setTimeout(function(){t.setTextareaSelection()}))},t.setTextareaSelection=function(){this.textareaSelectionTimeout=d;var t="";this.cursor.selection&&(t=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(t="$"+t+"$")),this.selectFn(t)},t.staticMathTextareaEvents=function(){var t=this,e=(t.root,t.cursor),n=t.textarea,i=t.textareaSpan;function s(){i.detach(),t.blurred=!0}this.container.prepend(Ot('<span class="mq-selectable">').text("$"+t.exportLatex()+"$")),t.blurred=!0,n.bind("cut paste",!1).bind("copy",function(){t.setTextareaSelection()}).focus(function(){t.blurred=!1}).blur(function(){e.selection&&e.selection.clear(),setTimeout(s)}),t.selectFn=function(t){n.val(t),t&&n.select()}},f.p.substituteKeyboardEvents=C,t.editablesTextareaEvents=function(){var t=this,e=t.textarea,n=t.textareaSpan,i=this.options.substituteKeyboardEvents(e,this);this.selectFn=function(t){i.select(t)},this.container.prepend(n),this.focusBlurEvents()},t.typedText=function(t){if("\n"===t)return this.handle("enter");var e=this.notify().cursor;e.parent.write(e,t),this.scrollHoriz()},t.cut=function(){var t=this,e=t.cursor;e.selection&&setTimeout(function(){t.notify("edit"),e.parent.bubble("reflow")})},t.copy=function(){this.setTextareaSelection()},t.paste=function(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}"),this.writeLatex(t).cursor.show()}}),e=r(v,function(t,e){t.finalizeInsert=function(t,e){var n=this;n.postOrder("finalizeTree",t),n.postOrder("contactWeld",e),n.postOrder("blur"),n.postOrder("reflow"),n[g].siblingCreated&&n[g].siblingCreated(t,m),n[m].siblingCreated&&n[m].siblingCreated(t,g),n.bubble("reflow")},t.prepareInsertionAt=function(t){var e,n=t.options.maxDepth;if(n!==d){if(n<(e=t.depth()))return!1;this.removeNodesDeeperThan(n-e)}return!0},t.removeNodesDeeperThan=function(n){for(var i,s=0,r=[[this,s]];r.length;)(i=r.shift())[0].children().each(function(t){var e=t instanceof _?1:0;(s=i[1]+e)<=n?r.push([t,s]):(e?t.children():t).remove()})}}),l=r(e,function(t,r){t.init=function(t,e,n){var i=this;r.init.call(i),i.ctrlSeq||(i.ctrlSeq=t),e&&(i.htmlTemplate=e),n&&(i.textTemplate=n)},t.replaces=function(t){t.disown(),this.replacedFragment=t},t.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},t.parser=function(){var t=Q.block,n=this;return t.times(n.numBlocks()).map(function(t){n.blocks=t;for(var e=0;e<t.length;e+=1)t[e].adopt(n,n.ends[g],0);return n})},t.createLeftOf=function(t){var e,n,i=this,s=i.replacedFragment;if(t.options.autoParenOperators&&!(i instanceof ut)&&!(i instanceof st)&&(t[m].isPartOfOperator&&(0===t[m][1]||t[m].jQ.hasClass("mq-last"))||(t[m].hasOwnProperty("sup")||t[m].hasOwnProperty("sub"))&&t[m][-1].isPartOfOperator)){for(e="",n=t[m];n.isPartOfOperator&&0!==n[-1]&&!n.jQ.hasClass("mq-last");)e=n.letter+e,n=n[m];e+=i.letter,0!=F._maxLength&&F.hasOwnProperty(e)||t.parent.write(t,"(")}i.createBlocks(),r.createLeftOf.call(i,t),s&&(s.adopt(i.ends[m],0,0),s.jQ.appendTo(i.ends[m].jQ),i.placeCursor(t),i.prepareInsertionAt(t)),i.finalizeInsert(t.options),i.placeCursor(t)},t.createBlocks=function(){var t,e=this,n=e.numBlocks(),i=e.blocks=Array(n);for(t=0;t<n;t+=1)(i[t]=_()).adopt(e,e.ends[g],0)},t.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[m],function(t,e){return t.isEmpty()?t:e}))},t.moveTowards=function(t,e,n){var i=n&&this[n+"Into"];e.insAtDirEnd(-t,i||this.ends[-t])},t.deleteTowards=function(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e,null)},t.selectTowards=function(t,e){e[-t]=this,e[t]=this[t]},t.selectChildren=function(){return n(this,this)},t.unselectInto=function(t,e){e.insAtDirEnd(-t,e.anticursor.ancestors[this.id])},t.seek=function(n,i){var s,r,o;function a(t){var e={};return e[m]=t.jQ.offset().left,e[g]=e[m]+t.jQ.outerWidth(),e}return r=a(s=this),n<r[m]?i.insLeftOf(s):n>r[g]?i.insRightOf(s):(o=r[m],void s.eachChild(function(t){var e=a(t);return n<e[m]?(n-o<e[m]-n?t[m]?i.insAtRightEnd(t[m]):i.insLeftOf(s):i.insAtLeftEnd(t),!1):n>e[g]?void(t[g]?o=e[g]:r[g]-n<n-e[g]?i.insRightOf(s):i.insAtRightEnd(t)):(t.seek(n,i),!1)}))},t.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},t.html=function(){var t,e,n,i=this,s=i.blocks,r=" mathquill-command-id="+i.id,o=i.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);for(Et("no unmatched angle brackets",o.join("")===this.htmlTemplate),e=o[t=0];e;e=o[t+=1])if("/>"===e.slice(-2))o[t]=e.slice(0,-2)+r+"/>";else if("<"===e.charAt(0))for(Et("not an unmatched top-level close tag","/"!==e.charAt(1)),o[t]=e.slice(0,-1)+r+">",n=1;Et("no missing close tags",e=o[t+=1]),"</"===e.slice(0,2)?n-=1:"<"===e.charAt(0)&&"/>"!==e.slice(-2)&&(n+=1),0<n;);return o.join("").replace(/>&(\d+)/g,function(t,e){return" mathquill-block-id="+s[e].id+">"+s[e].join("html")})},t.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,e){return t+"{"+(e.latex()||" ")+"}"})},t.textTemplate=[""],t.text=function(){var i=this,s=0;return i.foldChildren(i.textTemplate[s],function(t,e){s+=1;var n=e.text();return t&&"("===i.textTemplate[s]&&"("===n[0]&&")"===n.slice(-1)?t+n.slice(1,-1)+i.textTemplate[s]:t+n+(i.textTemplate[s]||"")})}}),T=r(l,function(t,i){t.init=function(t,e,n){n||(n=t&&1<t.length?t.slice(1):t),i.init.call(this,t,e,[n])},t.parser=function(){return j.succeed(this)},t.numBlocks=function(){return 0},t.replaces=function(t){t.remove()},t.createBlocks=Tt,t.moveTowards=function(t,e){e.jQ.insDirOf(t,this.jQ),e[-t]=this,e[t]=this[t]},t.deleteTowards=function(t,e){e[t]=this.remove()[t]},t.seek=function(t,e){t-this.jQ.offset().left<this.jQ.outerWidth()/2?e.insLeftOf(this):e.insRightOf(this)},t.latex=function(){return this.ctrlSeq},t.text=function(){return this.textTemplate},t.placeCursor=Tt,t.isEmpty=function(){return!0}}),S=r(T,function(t,n){t.init=function(t,e){n.init.call(this,t,"<span>"+(e||t)+"</span>")}}),D=r(T,function(t,i){t.init=function(t,e,n){i.init.call(this,t,'<span class="mq-binary-operator">'+e+"</span>",n)}}),_=r(e,function(t,i){t.join=function(n){return this.foldChildren("",function(t,e){return t+e[n]()})},t.html=function(){return this.join("html")},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[m]===this.ends[g]&&0!==this.ends[m]?this.ends[m].text():this.join("text")},t.keystroke=function(t,e,n){return!n.options.spaceBehavesLikeTab||"Spacebar"!==t&&"Shift-Spacebar"!==t||n.cursor.parent===n.root?i.keystroke.apply(this,arguments):(e.preventDefault(),void n.escapeDir("Shift-Spacebar"===t?m:g,t,e))},t.moveOutOf=function(t,e,n){!(n&&this.parent[n+"Into"])&&this[t]?e.insAtDirEnd(-t,this[t]):e.insDirOf(t,this.parent)},t.selectOutOf=function(t,e){e.insDirOf(t,this.parent)},t.deleteOutOf=function(t,e){e.unwrapGramp()},t.seek=function(t,e){var n=this.ends[g];if(!n||n.jQ.offset().left+n.jQ.outerWidth()<t)return e.insAtRightEnd(this);if(t<this.ends[m].jQ.offset().left)return e.insAtLeftEnd(this);for(;t<n.jQ.offset().left;)n=n[m];return n.seek(t,e)},t.chToCmd=function(t,e){var n;return t.match(/^[a-eg-zA-Z]$/)?B(t):/^\d$/.test(t)?I(t):e&&e.typingSlashWritesDivisionSymbol&&"/"===t?x["÷"](t):e&&e.typingAsteriskWritesTimesSymbol&&"*"===t?x["×"](t):(n=o[t]||x[t])?n(t):S(t)},t.write=function(t,e){var n=this.chToCmd(e,t.options);t.selection&&n.replaces(t.replaceSelection()),t.isTooDeep()||n.createLeftOf(t.show())},t.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},t.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}}),f.p.mouseEvents=!0,h.StaticMath=function(e){return r(e.AbstractMathQuill,function(t,n){this.RootBlock=_,t.__mathquillify=function(t,e){return this.config(t),n.__mathquillify.call(this,"mq-math-mode"),this.__options.mouseEvents&&(this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents()),this},t.init=function(){n.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],e.MathField)},t.latex=function(){var t=n.latex.apply(this,arguments);return 0<arguments.length&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],e.MathField),t}})},E=r(_,Mt),h.MathField=function(t){return r(t.EditableField,function(t,n){this.RootBlock=E,t.__mathquillify=function(t,e){return this.config(t),1<e&&(this.__controller.root.reflow=Tt),n.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})},A=r(v,function(t,s){function h(t){var e,n;if(t.jQ[0].normalize(),e=t.jQ[0].firstChild)return Et("only node in TextBlock span is Text node",3===e.nodeType),(n=L(e.data)).jQadd(e),t.children().disown(),n.adopt(t,0,0)}t.ctrlSeq="\\text",t.replaces=function(t){t instanceof w?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},t.jQadd=function(t){s.jQadd.call(this,t),this.ends[m]&&this.ends[m].jQadd(this.jQ[0].firstChild)},t.createLeftOf=function(t){var e,n=this;if(s.createLeftOf.call(this,t),n[g].siblingCreated&&n[g].siblingCreated(t.options,m),n[m].siblingCreated&&n[m].siblingCreated(t.options,g),n.bubble("reflow"),t.insAtRightEnd(n),n.replacedText)for(e=0;e<n.replacedText.length;e+=1)n.write(t,n.replacedText.charAt(e))},t.parser=function(){var e=this,t=j.string,n=j.regex,i=j.optWhitespace;return i.then(t("{")).then(n(/^[^}]*/)).skip(t("}")).map(function(t){return 0===t.length?w():(L(t).adopt(e,0,0),e)})},t.textContents=function(){return this.foldChildren("",function(t,e){return t+e.text})},t.text=function(){return'"'+this.textContents()+'"'},t.latex=function(){var t=this.textContents();return 0===t.length?"":"\\text{"+t.replace(/\\/g,"\\backslash ").replace(/[{}]/g,"\\$&")+"}"},t.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},t.moveTowards=function(t,e){e.insAtDirEnd(-t,this)},t.moveOutOf=function(t,e){e.insDirOf(t,this)},t.unselectInto=t.moveTowards,t.selectTowards=l.prototype.selectTowards,t.deleteTowards=l.prototype.deleteTowards,t.selectOutOf=function(t,e){e.insDirOf(t,this)},t.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this)},t.write=function(t,e){var n,i;t.show().deleteSelection(),"$"!==e?t[m]?t[m].appendText(e):L(e).createLeftOf(t):this.isEmpty()?(t.insRightOf(this),S("\\$","$").createLeftOf(t)):t[g]?t[m]?(n=A(),(i=this.ends[m]).disown().jQ.detach(),i.adopt(n,0,0),t.insLeftOf(this),s.createLeftOf.call(n,t)):t.insLeftOf(this):t.insRightOf(this)},t.seek=function(t,e){var n,i,s,r,o,a,l,c;for(e.hide(),n=h(this),i=this.jQ.width()/this.text.length,(s=Math.round((t-this.jQ.offset().left)/i))<=0?e.insAtLeftEnd(this):s>=n.text.length?e.insAtRightEnd(this):e.insLeftOf(n.splitRight(s)),a=o=(r=t-e.show().offset().left)&&r<0?m:g;e[o]&&0<r*a;)e[o].moveTowards(o,e),a=r,r=t-e.offset().left;o*r<-o*a&&e[-o].moveTowards(-o,e),e.anticursor?e.anticursor.parent===this&&(l=e[m]&&e[m].text.length,this.anticursorPosition===l?e.anticursor=u.copy(e):(this.anticursorPosition<l?(c=e[m].splitRight(this.anticursorPosition),e[m]=c):c=e[g].splitRight(this.anticursorPosition-l),e.anticursor=u(this,c[m],c))):this.anticursorPosition=e[m]&&e[m].text.length},t.blur=function(t){_.prototype.blur.call(this),t&&(""===this.textContents()?(this.remove(),t[m]===this?t[m]=this[m]:t[g]===this&&(t[g]=this[g])):h(this))},t.focus=_.prototype.focus}),L=r(v,function(t,e){function o(t,e){return e.charAt(t===m?0:-1+e.length)}t.init=function(t){e.init.call(this),this.text=t},t.jQadd=function(t){this.dom=t,this.jQ=b(t)},t.jQize=function(){return this.jQadd(document.createTextNode(this.text))},t.appendText=function(t){this.text+=t,this.dom.appendData(t)},t.prependText=function(t){this.text=t+this.text,this.dom.insertData(0,t)},t.insTextAtDirEnd=function(t,e){At(e),e===g?this.appendText(t):this.prependText(t)},t.splitRight=function(t){var e=L(this.text.slice(t)).adopt(this.parent,this,this[g]);return e.jQadd(this.dom.splitText(t)),this.text=this.text.slice(0,t),e},t.moveTowards=function(t,e){var n,i;return At(t),n=o(-t,this.text),(i=this[-t])?i.insTextAtDirEnd(n,t):L(n).createDir(-t,e),this.deleteTowards(t,e)},t.latex=function(){return this.text},t.deleteTowards=function(t,e){1<this.text.length?t===g?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),e[t]=this[t])},t.selectTowards=function(t,e){var n,i,s,r;return At(t),n=e.anticursor,i=o(-t,this.text),n[t]===this?(s=L(i).createDir(t,e),n[t]=s,e.insDirOf(t,s)):((r=this[-t])?r.insTextAtDirEnd(i,t):(s=L(i).createDir(-t,e)).jQ.insDirOf(-t,e.selection.jQ),1===this.text.length&&n[-t]===this&&(n[-t]=this[-t])),this.deleteTowards(t,e)}}),x.text=x.textnormal=x.textrm=x.textup=x.textmd=A,x.em=x.italic=x.italics=x.emph=x.textit=x.textsl=Bt("\\textit","i",'class="mq-text-mode"'),x.strong=x.bold=x.textbf=Bt("\\textbf","b",'class="mq-text-mode"'),x.sf=x.textsf=Bt("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),x.tt=x.texttt=Bt("\\texttt","span",'class="mq-monospace mq-text-mode"'),x.textsc=Bt("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),x.uppercase=Bt("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),x.lowercase=Bt("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"'),z=r(l,function(t,e){t.init=function(t){e.init.call(this,"$"),this.cursor=t},t.htmlTemplate='<span class="mq-math-mode">&0</span>',t.createBlocks=function(){e.createBlocks.call(this),this.ends[m].cursor=this.cursor,this.ends[m].write=function(t,e){"$"!==e?_.prototype.write.call(this,t,e):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(dir,t),S("\\$","$").createLeftOf(t.show())):t[g]?t[m]?_.prototype.write.call(this,t,e):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},t.latex=function(){return"$"+this.ends[m].latex()+"$"}}),R=r(E,function(t,e){t.keystroke=function(t){if("Spacebar"!==t&&"Shift-Spacebar"!==t)return e.keystroke.apply(this,arguments)},t.write=function(t,e){var n;(t.show().deleteSelection(),"$"===e)?z(t).createLeftOf(t):("<"===e?n="&lt;":">"===e&&(n="&gt;"),S(e,n).createLeftOf(t))}}),h.TextField=function(t){return r(t.EditableField,function(t,e){this.RootBlock=R,t.__mathquillify=function(){return e.__mathquillify.call(this,"mq-editable-field mq-text-mode")},t.latex=function(t){return 0<arguments.length?(this.__controller.renderLatexText(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})},x.notin=x.cong=x.equiv=x.oplus=x.otimes=r(D,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),x["≠"]=x.ne=x.neq=_t(D,"\\ne ","&ne;"),x["∗"]=x.ast=x.star=x.loast=x.lowast=_t(D,"\\ast ","&lowast;"),x.therefor=x.therefore=_t(D,"\\therefore ","&there4;"),x.cuz=x.because=_t(D,"\\because ","&#8757;"),x.prop=x.propto=_t(D,"\\propto ","&prop;"),x["≈"]=x.asymp=x.approx=_t(D,"\\approx ","&asymp;"),x.isin=x.in=_t(D,"\\in ","&isin;"),x.ni=x.contains=_t(D,"\\ni ","&ni;"),x.notni=x.niton=x.notcontains=x.doesnotcontain=_t(D,"\\not\\ni ","&#8716;"),x.sub=x.subset=_t(D,"\\subset ","&sub;"),x.sup=x.supset=x.superset=_t(D,"\\supset ","&sup;"),x.nsub=x.notsub=x.nsubset=x.notsubset=_t(D,"\\not\\subset ","&#8836;"),x.nsup=x.notsup=x.nsupset=x.notsupset=x.nsuperset=x.notsuperset=_t(D,"\\not\\supset ","&#8837;"),x.sube=x.subeq=x.subsete=x.subseteq=_t(D,"\\subseteq ","&sube;"),x.supe=x.supeq=x.supsete=x.supseteq=x.supersete=x.superseteq=_t(D,"\\supseteq ","&supe;"),x.nsube=x.nsubeq=x.notsube=x.notsubeq=x.nsubsete=x.nsubseteq=x.notsubsete=x.notsubseteq=_t(D,"\\not\\subseteq ","&#8840;"),x.nsupe=x.nsupeq=x.notsupe=x.notsupeq=x.nsupsete=x.nsupseteq=x.notsupsete=x.notsupseteq=x.nsupersete=x.nsuperseteq=x.notsupersete=x.notsuperseteq=_t(D,"\\not\\supseteq ","&#8841;"),x.N=x.naturals=x.Naturals=_t(S,"\\mathbb{N}","&#8469;"),x.P=x.primes=x.Primes=x.projective=x.Projective=x.probability=x.Probability=_t(S,"\\mathbb{P}","&#8473;"),x.Z=x.integers=x.Integers=_t(S,"\\mathbb{Z}","&#8484;"),x.Q=x.rationals=x.Rationals=_t(S,"\\mathbb{Q}","&#8474;"),x.R=x.reals=x.Reals=_t(S,"\\mathbb{R}","&#8477;"),x.C=x.complex=x.Complex=x.complexes=x.Complexes=x.complexplane=x.Complexplane=x.ComplexPlane=_t(S,"\\mathbb{C}","&#8450;"),x.H=x.Hamiltonian=x.quaternions=x.Quaternions=_t(S,"\\mathbb{H}","&#8461;"),x.quad=x.emsp=_t(S,"\\quad ","    "),x.qquad=_t(S,"\\qquad ","        "),x.diamond=_t(S,"\\diamond ","&#9671;"),x.bigtriangleup=_t(S,"\\bigtriangleup ","&#9651;"),x.ominus=_t(S,"\\ominus ","&#8854;"),x.uplus=_t(S,"\\uplus ","&#8846;"),x.bigtriangledown=_t(S,"\\bigtriangledown ","&#9661;"),x.sqcap=_t(S,"\\sqcap ","&#8851;"),x.triangleleft=_t(S,"\\triangleleft ","&#8882;"),x.sqcup=_t(S,"\\sqcup ","&#8852;"),x.triangleright=_t(S,"\\triangleright ","&#8883;"),x.odot=x.circledot=_t(S,"\\odot ","&#8857;"),x.bigcirc=_t(S,"\\bigcirc ","&#9711;"),x.dagger=_t(S,"\\dagger ","&#0134;"),x.ddagger=_t(S,"\\ddagger ","&#135;"),x.wr=_t(S,"\\wr ","&#8768;"),x.amalg=_t(S,"\\amalg ","&#8720;"),x.models=_t(S,"\\models ","&#8872;"),x.prec=_t(S,"\\prec ","&#8826;"),x.succ=_t(S,"\\succ ","&#8827;"),x.preceq=_t(S,"\\preceq ","&#8828;"),x.succeq=_t(S,"\\succeq ","&#8829;"),x.simeq=_t(S,"\\simeq ","&#8771;"),x.mid=_t(S,"\\mid ","&#8739;"),x.ll=_t(S,"\\ll ","&#8810;"),x.gg=_t(S,"\\gg ","&#8811;"),x.parallel=_t(S,"\\parallel ","&#8741;"),x.nparallel=_t(S,"\\nparallel ","&#8742;"),x.bowtie=_t(S,"\\bowtie ","&#8904;"),x.sqsubset=_t(S,"\\sqsubset ","&#8847;"),x.sqsupset=_t(S,"\\sqsupset ","&#8848;"),x.smile=_t(S,"\\smile ","&#8995;"),x.sqsubseteq=_t(S,"\\sqsubseteq ","&#8849;"),x.sqsupseteq=_t(S,"\\sqsupseteq ","&#8850;"),x.doteq=_t(S,"\\doteq ","&#8784;"),x.frown=_t(S,"\\frown ","&#8994;"),x.vdash=_t(S,"\\vdash ","&#8870;"),x.dashv=_t(S,"\\dashv ","&#8867;"),x.nless=_t(S,"\\nless ","&#8814;"),x.ngtr=_t(S,"\\ngtr ","&#8815;"),x.longleftarrow=_t(S,"\\longleftarrow ","&#8592;"),x.longrightarrow=_t(S,"\\longrightarrow ","&#8594;"),x.Longleftarrow=_t(S,"\\Longleftarrow ","&#8656;"),x.Longrightarrow=_t(S,"\\Longrightarrow ","&#8658;"),x.longleftrightarrow=_t(S,"\\longleftrightarrow ","&#8596;"),x.updownarrow=_t(S,"\\updownarrow ","&#8597;"),x.Longleftrightarrow=_t(S,"\\Longleftrightarrow ","&#8660;"),x.Updownarrow=_t(S,"\\Updownarrow ","&#8661;"),x.mapsto=_t(S,"\\mapsto ","&#8614;"),x.nearrow=_t(S,"\\nearrow ","&#8599;"),x.hookleftarrow=_t(S,"\\hookleftarrow ","&#8617;"),x.hookrightarrow=_t(S,"\\hookrightarrow ","&#8618;"),x.searrow=_t(S,"\\searrow ","&#8600;"),x.leftharpoonup=_t(S,"\\leftharpoonup ","&#8636;"),x.rightharpoonup=_t(S,"\\rightharpoonup ","&#8640;"),x.swarrow=_t(S,"\\swarrow ","&#8601;"),x.leftharpoondown=_t(S,"\\leftharpoondown ","&#8637;"),x.rightharpoondown=_t(S,"\\rightharpoondown ","&#8641;"),x.nwarrow=_t(S,"\\nwarrow ","&#8598;"),x.ldots=_t(S,"\\ldots ","&#8230;"),x.cdots=_t(S,"\\cdots ","&#8943;"),x.vdots=_t(S,"\\vdots ","&#8942;"),x.ddots=_t(S,"\\ddots ","&#8945;"),x.surd=_t(S,"\\surd ","&#8730;"),x.triangle=_t(S,"\\triangle ","&#9651;"),x.ell=_t(S,"\\ell ","&#8467;"),x.top=_t(S,"\\top ","&#8868;"),x.flat=_t(S,"\\flat ","&#9837;"),x.natural=_t(S,"\\natural ","&#9838;"),x.sharp=_t(S,"\\sharp ","&#9839;"),x.wp=_t(S,"\\wp ","&#8472;"),x.bot=_t(S,"\\bot ","&#8869;"),x.clubsuit=_t(S,"\\clubsuit ","&#9827;"),x.diamondsuit=_t(S,"\\diamondsuit ","&#9826;"),x.heartsuit=_t(S,"\\heartsuit ","&#9825;"),x.spadesuit=_t(S,"\\spadesuit ","&#9824;"),x.parallelogram=_t(S,"\\parallelogram ","&#9649;"),x.square=_t(S,"\\square ","&#11036;"),x.oint=_t(S,"\\oint ","&#8750;"),x.bigcap=_t(S,"\\bigcap ","&#8745;"),x.bigcup=_t(S,"\\bigcup ","&#8746;"),x.bigsqcup=_t(S,"\\bigsqcup ","&#8852;"),x.bigvee=_t(S,"\\bigvee ","&#8744;"),x.bigwedge=_t(S,"\\bigwedge ","&#8743;"),x.bigodot=_t(S,"\\bigodot ","&#8857;"),x.bigotimes=_t(S,"\\bigotimes ","&#8855;"),x.bigoplus=_t(S,"\\bigoplus ","&#8853;"),x.biguplus=_t(S,"\\biguplus ","&#8846;"),x.lfloor=_t(S,"\\lfloor ","&#8970;"),x.rfloor=_t(S,"\\rfloor ","&#8971;"),x.lceil=_t(S,"\\lceil ","&#8968;"),x.rceil=_t(S,"\\rceil ","&#8969;"),x.opencurlybrace=x.lbrace=_t(S,"\\lbrace ","{"),x.closecurlybrace=x.rbrace=_t(S,"\\rbrace ","}"),x.lbrack=_t(S,"["),x.rbrack=_t(S,"]"),x.slash=_t(S,"/"),x.vert=_t(S,"|"),x.perp=x.perpendicular=_t(S,"\\perp ","&perp;"),x.nabla=x.del=_t(S,"\\nabla ","&nabla;"),x.hbar=_t(S,"\\hbar ","&#8463;"),x.AA=x.Angstrom=x.angstrom=_t(S,"\\text\\AA ","&#8491;"),x.ring=x.circ=x.circle=_t(S,"\\circ ","&#8728;"),x.bull=x.bullet=_t(S,"\\bullet ","&bull;"),x.setminus=x.smallsetminus=_t(S,"\\setminus ","&#8726;"),x.not=x["¬"]=x.neg=_t(S,"\\neg ","&not;"),x["…"]=x.dots=x.ellip=x.hellip=x.ellipsis=x.hellipsis=_t(S,"\\dots ","&hellip;"),x.converges=x.darr=x.dnarr=x.dnarrow=x.downarrow=_t(S,"\\downarrow ","&darr;"),x.dArr=x.dnArr=x.dnArrow=x.Downarrow=_t(S,"\\Downarrow ","&dArr;"),x.diverges=x.uarr=x.uparrow=_t(S,"\\uparrow ","&uarr;"),x.uArr=x.Uparrow=_t(S,"\\Uparrow ","&uArr;"),x.to=_t(D,"\\to ","&rarr;"),x.rarr=x.rightarrow=_t(S,"\\rightarrow ","&rarr;"),x.implies=_t(D,"\\Rightarrow ","&rArr;"),x.rArr=x.Rightarrow=_t(S,"\\Rightarrow ","&rArr;"),x.gets=_t(D,"\\gets ","&larr;"),x.larr=x.leftarrow=_t(S,"\\leftarrow ","&larr;"),x.impliedby=_t(D,"\\Leftarrow ","&lArr;"),x.lArr=x.Leftarrow=_t(S,"\\Leftarrow ","&lArr;"),x.harr=x.lrarr=x.leftrightarrow=_t(S,"\\leftrightarrow ","&harr;"),x.iff=_t(D,"\\Leftrightarrow ","&hArr;"),x.hArr=x.lrArr=x.Leftrightarrow=_t(S,"\\Leftrightarrow ","&hArr;"),x.Re=x.Real=x.real=_t(S,"\\Re ","&real;"),x.Im=x.imag=x.image=x.imagin=x.imaginary=x.Imaginary=_t(S,"\\Im ","&image;"),x.part=x.partial=_t(S,"\\partial ","&part;"),x.infty=x.infin=x.infinity=_t(S,"\\infty ","&infin;"),x.pounds=_t(S,"\\pounds ","&pound;"),x.alef=x.alefsym=x.aleph=x.alephsym=_t(S,"\\aleph ","&alefsym;"),x.xist=x.xists=x.exist=x.exists=_t(S,"\\exists ","&exist;"),x.nexists=x.nexist=_t(S,"\\nexists ","&#8708;"),x.and=x.land=x.wedge=_t(D,"\\wedge ","&and;"),x.or=x.lor=x.vee=_t(D,"\\vee ","&or;"),x.o=x.O=x.empty=x.emptyset=x.oslash=x.Oslash=x.nothing=x.varnothing=_t(D,"\\varnothing ","&empty;"),x.cup=x.union=_t(D,"\\cup ","&cup;"),x.cap=x.intersect=x.intersection=_t(D,"\\cap ","&cap;"),x.deg=x.degree=_t(S,"\\degree ","&deg;"),x.ang=x.angle=_t(S,"\\angle ","&ang;"),x.measuredangle=_t(S,"\\measuredangle ","&#8737;"),I=r(S,function(t,e){t.createLeftOf=function(t){t.options.autoSubscriptNumerals&&t.parent!==t.parent.parent.sub&&(t[m]instanceof M&&!1!==t[m].isItalic||t[m]instanceof st&&t[m][m]instanceof M&&!1!==t[m][m].isItalic)?(x._().createLeftOf(t),e.createLeftOf.call(this,t),t.insRightOf(t.parent.parent)):e.createLeftOf.call(this,t)}}),M=r(T,function(t,n){t.init=function(t,e){n.init.call(this,t,"<var>"+(e||t)+"</var>")},t.text=function(){var t=this.ctrlSeq;return this.isPartOfOperator?"\\"==t[0]?t=t.slice(1,t.length):" "==t[t.length-1]&&(t=t.slice(0,-1)):(!this[m]||this[m]instanceof M||this[m]instanceof D||"\\ "===this[m].ctrlSeq||(t="*"+t),!this[g]||this[g]instanceof D||this[g]instanceof st||(t+="*")),t}}),f.p.autoCommands={_maxLength:0},p.autoCommands=function(t){var e,n,i,s,r;if(!/^\^?[a-z]+(?: \^?[a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},s=i=0;s<e.length;s+=1){if((r=e[s]).length<2)throw'autocommand "'+r+'" not minimum length of 2';if(x[r]===$)throw'"'+r+'" is a built-in operator name';n[r]=1,i=Qt(i,r.length)}return n._maxLength=i,n},B=r(M,function(t,o){function d(t){return!t||t instanceof D||t instanceof rt}t.init=function(t){return o.init.call(this,this.letter=t)},t.createLeftOf=function(t){var e,n,i,s,r;if(o.createLeftOf.apply(this,arguments),0<(n=(e=t.options.autoCommands)._maxLength)){for(i="",s=this,r=0;s instanceof B&&s.ctrlSeq===s.letter&&r<n;)i=s.letter+i,s=s[m],r+=1;for(r=0;i.length;){if(e.hasOwnProperty(i)||0==r&&e.hasOwnProperty("^"+i)){for(r=1,s=this;r<i.length;r+=1,s=s[m]);return w(s,this).remove(),t[m]=s[m],x[i](i).createLeftOf(t)}r++,i=i.slice(1)}}},t.italicize=function(t){return this.isItalic=t,this.isPartOfOperator=!t,this.jQ.toggleClass("mq-operator-name",!t),this},t.finalizeTree=t.siblingDeleted=t.siblingCreated=function(t,e){e!==m&&this[g]instanceof B||this.autoUnItalicize(t)},t.autoUnItalicize=function(t){var e,n,i,s,r,o,a,l,c,h,u,f,p=t.autoOperatorNames;if(0!==p._maxLength){for(e=this.letter,n=this[m];n instanceof B;n=n[m])e=n.letter+e;for(i=this[g];i instanceof B;i=i[g])e+=i.letter;w(n[g]||this.parent.ends[m],i[m]||this.parent.ends[g]).each(function(t){t.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),t.ctrlSeq=t.letter});t:for(s=0,r=n[g]||this.parent.ends[m];s<e.length;s+=1,r=r[g])for(o=jt(p._maxLength,e.length-s);0<o;o-=1)if(a=e.slice(s,s+o),p.hasOwnProperty(a)){for(l=0,c=r;l<o;l+=1,c=c[g])c.italicize(!1),h=c;u=P.hasOwnProperty(a),r.ctrlSeq=(u?"\\":"\\operatorname{")+r.ctrlSeq,h.ctrlSeq+=u?" ":"}",N.hasOwnProperty(a)&&h[m][m][m].jQ.addClass("mq-last"),d(r[m])||r.jQ.addClass("mq-first"),d(h[g])||(h[g]instanceof st?((f=h[g]).siblingCreated=f.siblingDeleted=function(){f.jQ.toggleClass("mq-after-operator-name",!(f[g]instanceof ut))})():h.jQ.toggleClass("mq-last",!(h[g]instanceof ut))),s+=o-1,r=h;continue t}}}}),P={},F=f.p.autoOperatorNames={_maxLength:9},N={limsup:1,liminf:1,projlim:1,injlim:1},function(){var t,e,n,i,s="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" ");for(t=0;t<s.length;t+=1)P[s[t]]=F[s[t]]=1;for(e="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "),t=0;t<e.length;t+=1)P[e[t]]=1;for(n="sin cos tan sec cosec csc cotan cot ctg".split(" "),t=0;t<n.length;t+=1)F[n[t]]=F["arc"+n[t]]=F[n[t]+"h"]=F["ar"+n[t]+"h"]=F["arc"+n[t]+"h"]=1;for(i="gcf hcf lcm proj span".split(" "),t=0;t<i.length;t+=1)F[i[t]]=1}(),p.autoOperatorNames=function(t){var e,n,i,s,r;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},s=i=0;s<e.length;s+=1){if((r=e[s]).length<2)throw'"'+r+'" not minimum length of 2';n[r]=1,i=Qt(i,r.length)}return n._maxLength=i,n},$=r(T,function(t,e){t.init=function(t){this.ctrlSeq=t},t.createLeftOf=function(t){var e,n=this.ctrlSeq;for(e=0;e<n.length;e+=1)B(n.charAt(e)).createLeftOf(t)},t.parser=function(){var t,e=this.ctrlSeq,n=_();for(t=0;t<e.length;t+=1)B(e.charAt(t)).adopt(n,n.ends[g],0);return j.succeed(n.children())}}),F)F.hasOwnProperty(V)&&(x[V]=$);for(nt in x.operatorname=r(l,function(t){t.createLeftOf=Tt,t.numBlocks=function(){return 1},t.parser=function(){return Q.block.map(function(t){return t.children()})}}),x.f=r(B,function(t,e){t.init=function(){T.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')},t.italicize=function(t){return this.jQ.html("f").toggleClass("mq-f",t),e.italicize.apply(this,arguments)}}),x[" "]=x.space=_t(S,"\\ ","&nbsp;"),x["'"]=x.prime=_t(S,"'","&prime;"),x["″"]=x.dprime=_t(S,"″","&Prime;"),x.backslash=_t(S,"\\backslash ","\\"),o["\\"]||(o["\\"]=x.backslash),x.$=_t(S,"\\$","$"),K=r(T,function(t,n){t.init=function(t,e){n.init.call(this,t,'<span class="mq-nonSymbola">'+(e||t)+"</span>")}}),x["@"]=K,x["&"]=_t(K,"\\&","&amp;"),x["%"]=_t(K,"\\%","%"),x.alpha=x.beta=x.gamma=x.delta=x.zeta=x.eta=x.theta=x.iota=x.kappa=x.mu=x.nu=x.xi=x.rho=x.sigma=x.tau=x.chi=x.psi=x.omega=r(M,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),x.phi=_t(M,"\\phi ","&#981;"),x.phiv=x.varphi=_t(M,"\\varphi ","&phi;"),x.epsilon=_t(M,"\\epsilon ","&#1013;"),x.epsiv=x.varepsilon=_t(M,"\\varepsilon ","&epsilon;"),x.piv=x.varpi=_t(M,"\\varpi ","&piv;"),x.sigmaf=x.sigmav=x.varsigma=_t(M,"\\varsigma ","&sigmaf;"),x.thetav=x.vartheta=x.thetasym=_t(M,"\\vartheta ","&thetasym;"),x.upsilon=x.upsi=_t(M,"\\upsilon ","&upsilon;"),x.gammad=x.Gammad=x.digamma=_t(M,"\\digamma ","&#989;"),x.kappav=x.varkappa=_t(M,"\\varkappa ","&#1008;"),x.rhov=x.varrho=_t(M,"\\varrho ","&#1009;"),x.pi=x["π"]=_t(K,"\\pi ","&pi;"),x.lambda=_t(K,"\\lambda ","&lambda;"),x.Upsilon=x.Upsi=x.upsih=x.Upsih=_t(T,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),x.Gamma=x.Delta=x.Theta=x.Lambda=x.Xi=x.Pi=x.Sigma=x.Phi=x.Psi=x.Omega=x.forall=r(S,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),U=r(l,function(t){t.init=function(t){this.latex=t},t.createLeftOf=function(t){var e=Q.parse(this.latex);e.children().adopt(t.parent,t[m],t[g]),t[m]=e.ends[g],e.jQize().insertBefore(t.jQ),e.finalizeInsert(t.options,t),e.ends[g][g].siblingCreated&&e.ends[g][g].siblingCreated(t.options,m),e.ends[m][m].siblingCreated&&e.ends[m][m].siblingCreated(t.options,g),t.parent.bubble("reflow")},t.parser=function(){var t=Q.parse(this.latex).children();return j.succeed(t)}}),x["¹"]=_t(U,"^1"),x["²"]=_t(U,"^2"),x["³"]=_t(U,"^3"),x["¼"]=_t(U,"\\frac14"),x["½"]=_t(U,"\\frac12"),x["¾"]=_t(U,"\\frac34"),W=r(D,function(t){t.init=S.prototype.init,t.contactWeld=t.siblingCreated=t.siblingDeleted=function(t,e){if(e!==g)return this.jQ[0].className=function t(e){return e[m]?e[m]instanceof D||/^[,;:\(\[]$/.test(e[m].ctrlSeq)?"":"mq-binary-operator":e.parent&&e.parent.parent&&e.parent.parent.isStyleBlock()?t(e.parent.parent):""}(this),this}}),x["+"]=_t(W,"+","+"),x["–"]=x["-"]=_t(W,"-","&minus;"),x["±"]=x.pm=x.plusmn=x.plusminus=_t(W,"\\pm ","&plusmn;"),x.mp=x.mnplus=x.minusplus=_t(W,"\\mp ","&#8723;"),o["*"]=x.sdot=x.cdot=_t(D,"\\cdot ","&middot;","*"),H=r(D,function(t,i){t.init=function(t,e){this.data=t;var n=(this.strict=e)?"Strict":"";i.init.call(this,t["ctrlSeq"+n],t["html"+n],t["text"+n])},t.swap=function(t){var e=(this.strict=t)?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+e],this.jQ.html(this.data["html"+e]),this.textTemplate=[this.data["text"+e]]},t.deleteTowards=function(t,e){if(t===m&&!this.strict)return this.swap(!0),void this.bubble("reflow");i.deleteTowards.apply(this,arguments)}}),X={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},Y={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"},x["<"]=x.lt=_t(H,X,!0),x[">"]=x.gt=_t(H,Y,!0),x["≤"]=x.le=x.leq=_t(H,X,!1),x["≥"]=x.ge=x.geq=_t(H,Y,!1),G=r(D,function(t,e){t.init=function(){e.init.call(this,"=","=")},t.createLeftOf=function(t){if(t[m]instanceof H&&t[m].strict)return t[m].swap(!1),void t[m].bubble("reflow");e.createLeftOf.apply(this,arguments)}}),x["="]=G,x["×"]=x.times=_t(D,"\\times ","&times;","[x]"),x["÷"]=x.div=x.divide=x.divides=_t(D,"\\div ","&divide;","[/]"),o["~"]=x.sim=_t(D,"\\sim ","~","~"),J=Tt,tt=document.createElement("div").style,{transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1})if(nt in tt){et=nt;break}function Pt(t){var e=this.parent,n=t;do{if(n[g])return t.insLeftOf(e);n=n.parent.parent}while(n!==e);t.insRightOf(e)}function Ft(t,e){t.jQadd=function(){e.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},t.reflow=function(){var t=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));Z(this.delimjQs,jt(1+.2*(t-1),1.2),1.2*t)}}function Nt(t,e){e=e||t;var n=ft[t],i=ft[e];o[t]=_t(ut,m,t,n,e,i),o[n]=_t(ut,g,t,n,e,i)}for(xt in Z=et?function(t,e,n){t.css(et,"scale("+e+","+n+")")}:"filter"in tt?(J=function(t){t.className=t.className},function(t,e,n){var i,s;function r(){t.css("marginRight",(i.width()-1)*(e-1)/e+"px")}e/=1+(n-1)/2,t.css("fontSize",n+"em"),t.hasClass("mq-matrixed-container")||t.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>'),i=t.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')"),r(),s=setInterval(r),b(window).load(function(){clearTimeout(s),r()})}):function(t,e,n){t.css("fontSize",n+"em")},it=r(l,function(t,i){t.init=function(t,e,n){i.init.call(this,t,"<"+e+" "+n+">&0</"+e+">")}}),x.mathrm=_t(it,"\\mathrm","span",'class="mq-roman mq-font"'),x.mathit=_t(it,"\\mathit","i",'class="mq-font"'),x.mathbf=_t(it,"\\mathbf","b",'class="mq-font"'),x.mathsf=_t(it,"\\mathsf","span",'class="mq-sans-serif mq-font"'),x.mathtt=_t(it,"\\mathtt","span",'class="mq-monospace mq-font"'),x.underline=_t(it,"\\underline","span",'class="mq-non-leaf mq-underline"'),x.overline=x.bar=_t(it,"\\overline","span",'class="mq-non-leaf mq-overline"'),x.overrightarrow=_t(it,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),x.overleftarrow=_t(it,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"'),x.overleftrightarrow=_t(it,"\\overleftrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-both"'),x.overarc=_t(it,"\\overarc","span",'class="mq-non-leaf mq-overarc"'),x.dot=r(l,function(t,e){t.init=function(){e.init.call(this,"\\dot",'<span class="mq-non-leaf"><span class="mq-dot-recurring-inner"><span class="mq-dot-recurring">&#x2d9;</span><span class="mq-empty-box">&0</span></span></span>')}}),x.textcolor=r(l,function(t,s){t.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>'},t.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},t.parser=function(){var e=this,t=j.optWhitespace,n=j.string,i=j.regex;return t.then(n("{")).then(i(/^[#\w\s.,()%-]*/)).skip(n("}")).then(function(t){return e.setColor(t),s.parser.call(e)})},t.isStyleBlock=function(){return!0}}),x.class=r(l,function(t,i){t.parser=function(){var e=this,t=j.string,n=j.regex;return j.optWhitespace.then(t("{")).then(n(/^[-\w\s\\\xA0-\xFF]*/)).skip(t("}")).then(function(t){return e.cls=t||"",e.htmlTemplate='<span class="mq-class '+t+'">&0</span>',i.parser.call(e)})},t.latex=function(){return"\\class{"+this.cls+"}{"+this.blocks[0].latex()+"}"},t.isStyleBlock=function(){return!0}}),st=r(l,function(t,i){t.ctrlSeq="_{...}^{...}",t.createLeftOf=function(t){if(this.replacedFragment||t[m]||!t.options.supSubsRequireOperand)return i.createLeftOf.apply(this,arguments)},t.contactWeld=function(t){var i,e,n,s,r,o;for(i=m;i;i=i===m&&g)if(this[i]instanceof st){for(e="sub";e;e="sub"===e&&"sup")n=this[e],s=this[i][e],n&&(s?n.isEmpty()?o=u(s,0,s.ends[m]):(n.jQ.children().insAtDirEnd(-i,s.jQ),r=n.children().disown(),o=u(s,r.ends[g],s.ends[m]),i===m?r.adopt(s,s.ends[g],0):r.adopt(s,0,s.ends[m])):this[i].addBlock(n.disown()),this.placeCursor=function(e,n){return function(t){t.insAtDirEnd(-i,e||n)}}(s,n));this.remove(),t&&t[m]===this&&(i===g&&o?o[m]?t.insRightOf(o[m]):t.insAtLeftEnd(o.parent):t.insRightOf(this[i]));break}},f.p.charsThatBreakOutOfSupSub="",t.finalizeTree=function(){this.ends[m].write=function(t,e){if(t.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===e)return;var n=this.chToCmd(e,t.options);return n instanceof T?t.deleteSelection():t.clearSelection().insRightOf(this.parent),n.createLeftOf(t.show())}t[m]&&!t[g]&&!t.selection&&-1<t.options.charsThatBreakOutOfSupSub.indexOf(e)&&(t.insRightOf(this.parent)," "==e)||(t[m]&&!t[g]&&!t.selection&&this.parent[m]instanceof M&&(!1!==this.parent[m].isItalic&&"e"!==this.parent[m].letter&&-1<t.options.charsThatBreakOutOfSupSubVar.indexOf(e)||this.parent[m].isPartOfOperator&&-1<t.options.charsThatBreakOutOfSupSubOp.indexOf(e))&&t.insRightOf(this.parent),_.p.write.apply(this,arguments))}},t.moveTowards=function(t,e,n){e.options.autoSubscriptNumerals&&!this.sup?e.insDirOf(t,this):i.moveTowards.apply(this,arguments)},t.deleteTowards=function(t,e){if(e.options.autoSubscriptNumerals&&this.sub){var n=this.sub.ends[-t];n instanceof T?n.remove():n&&n.deleteTowards(t,e.insAtDirEnd(-t,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(m,e.insAtLeftEnd(this.sub)),this.sup&&e.insDirOf(-t,this))}else i.deleteTowards.apply(this,arguments)},t.latex=function(){function t(t,e){var n=e&&e.latex();return e?t+(1===n.length?n:"{"+(n||" ")+"}"):""}return t("_",this.sub)+t("^",this.sup)},t.addBlock=function(t){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=b('<span class="mq-sup"/>').append(t.jQ.children()).attr(Ct,t.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=b('<span class="mq-sub"></span>').append(t.jQ.children()).attr(Ct,t.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var e=0;e<2;e+=1)!function(i,s,r,o){i[s].deleteOutOf=function(t,e){if(e.insDirOf(this[t]?-t:t,this.parent),!this.isEmpty()){var n=this.ends[t];this.children().disown().withDirAdopt(t,e.parent,e[t],e[-t]).jQ.insDirOf(-t,e.jQ),e[-t]=n}i.supsub=r,delete i[s],delete i[o+"Into"],i[r][o+"OutOf"]=Pt,delete i[r].deleteOutOf,"sub"===s&&b(i.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,"sub sup".split(" ")[e],"sup sub".split(" ")[e],"down up".split(" ")[e])},t.reflow=function(){var t,e,n,i,s=this.jQ,r=s.prev();r.length&&(t=s.children(".mq-sup")).length&&(e=parseInt(t.css("font-size")),n=t.offset().top+t.height()-r.offset().top-.7*e,i=parseInt(t.css("margin-bottom")),t.css("margin-bottom",i+n))}}),x.subscript=x._=r(st,function(t,e){t.supsub="sub",t.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["_"],t.finalizeTree=function(){this.downInto=this.sub=this.ends[m],this.sub.upOutOf=Pt,e.finalizeTree.call(this)}}),x.superscript=x.supscript=x["^"]=r(st,function(t,e){t.supsub="sup",t.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',t.textTemplate=["^"],t.finalizeTree=function(){this.upInto=this.sup=this.ends[g],this.sup.downOutOf=Pt,e.finalizeTree.call(this)}}),rt=r(l,function(t,e){t.init=function(t,e){var n='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+e+'</big><span class="mq-from"><span>&0</span></span></span>';T.prototype.init.call(this,t,n)},t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments),t.options.sumStartsWithNEquals&&(B("n").createLeftOf(t),G().createLeftOf(t))},t.latex=function(){function t(t){return 1===t.length?t:"{"+(t||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[m].latex())+"^"+t(this.ends[g].latex())},t.parser=function(){var t,e=j.string,n=j.optWhitespace,i=j.succeed,s=Q.block,r=this,o=r.blocks=[_(),_()];for(t=0;t<o.length;t+=1)o[t].adopt(r,r.ends[g],0);return n.then(e("_").or(e("^"))).then(function(t){var e=o["_"===t?0:1];return s.then(function(t){return t.children().adopt(e,e.ends[g],0),i(r)})}).many().result(r)},t.finalizeTree=function(){this.downInto=this.ends[m],this.upInto=this.ends[g],this.ends[m].upOutOf=this.ends[g],this.ends[g].downOutOf=this.ends[m]}}),x["∑"]=x.sum=x.summation=_t(rt,"\\sum ","&sum;"),x["∏"]=x.prod=x.product=_t(rt,"\\prod ","&prod;"),x.coprod=x.coproduct=_t(rt,"\\coprod ","&#8720;"),x["∫"]=x.int=x.integral=r(rt,function(t,e){t.init=function(){T.prototype.init.call(this,"\\int ",'<span class="mq-int mq-non-leaf"><big>&int;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},t.createLeftOf=l.p.createLeftOf}),ot=x.frac=x.dfrac=x.cfrac=x.fraction=r(l,function(t,e){t.ctrlSeq="\\frac",t.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["(",")/(",")"],t.finalizeTree=function(){this.upInto=this.ends[g].upOutOf=this.ends[m],this.downInto=this.ends[m].downOutOf=this.ends[g]}}),at=x.over=o["/"]=r(ot,function(t,n){t.createLeftOf=function(t){if(!this.replacedFragment){for(var e=t[m];e&&!(e instanceof D||e instanceof(x.text||Tt)||e instanceof rt||"\\ "===e.ctrlSeq||/^[,;:]$/.test(e.ctrlSeq));)e=e[m];e instanceof rt&&e[g]instanceof st&&(e=e[g])[g]instanceof st&&e[g].ctrlSeq!=e.ctrlSeq&&(e=e[g]),e===t[m]||t.isTooDeep(1)||(this.replaces(w(e[g]||t.parent.ends[m],t[m])),t[m]=e)}n.createLeftOf.call(this,t)}}),lt=x.sqrt=x["√"]=r(l,function(t,e){t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.parser=function(){return Q.optBlock.then(function(n){return Q.block.map(function(t){var e=ct();return e.blocks=[n,t],n.adopt(e,0,0),t.adopt(e,n,0),e})}).or(e.parser.call(this))},t.reflow=function(){var t=this.ends[g].jQ;Z(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),x.hat=r(l,function(t,e){t.ctrlSeq="\\hat",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-hat-prefix">^</span><span class="mq-hat-stem">&0</span></span>',t.textTemplate=["hat(",")"]}),ct=x.root=x.nthroot=r(lt,function(t,e){t.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',t.textTemplate=["sqrt[","](",")"],t.latex=function(){return"\\sqrt["+this.ends[m].latex()+"]{"+this.ends[g].latex()+"}"}}),ht=r(l,function(t,s){t.init=function(t,e,n){var i='<span class="mq-non-leaf"><span class="mq-diacritic-above">'+e+'</span><span class="mq-diacritic-stem">&0</span></span>';s.init.call(this,t,i,n)}}),x.vec=_t(ht,"\\vec","&rarr;",["vec(",")"]),x.tilde=_t(ht,"\\tilde","~",["tilde(",")"]),ut=r(r(l,Ft),function(t,r){t.init=function(t,e,n,i,s){r.init.call(this,"\\left"+i,d,[e,n]),this.side=t,this.sides={},this.sides[m]={ch:e,ctrlSeq:i},this.sides[g]={ch:n,ctrlSeq:s}},t.numBlocks=function(){return 1},t.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===g?" mq-ghost":"")+'">'+this.sides[m].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===m?" mq-ghost":"")+'">'+this.sides[g].ch+"</span></span>",r.html.call(this)},t.latex=function(){return"\\left"+this.sides[m].ctrlSeq+this.ends[m].latex()+"\\right"+this.sides[g].ctrlSeq},t.matchBrack=function(t,e,n){return n instanceof ut&&n.side&&n.side!==-e&&(!t.restrictMismatchedBrackets||ft[this.sides[this.side].ch]===n.sides[n.side].ch||{"(":"]","[":")"}[this.sides[m].ch]===n.sides[g].ch)&&n},t.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side],t.delimjQs.eq(this.side===m?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},t.createLeftOf=function(t){var e,n,i;this.replacedFragment||(e=t.options,n="|"===this.sides[m].ch?this.matchBrack(e,g,t[g])||this.matchBrack(e,m,t[m])||this.matchBrack(e,0,t.parent.parent):this.matchBrack(e,-this.side,t[-this.side])||this.matchBrack(e,-this.side,t.parent.parent)),n?(i=this.side=-n.side,this.closeOpposing(n),n===t.parent.parent&&t[i]&&w(t[i],t.parent.ends[i],-i).disown().withDirAdopt(-i,n.parent,n,n[i]).jQ.insDirOf(i,n.jQ),n.bubble("reflow")):(i=(n=this).side,n.replacedFragment?n.side=0:t[-i]&&(n.replaces(w(t[-i],t.parent.ends[-i],i)),t[-i]=0),r.createLeftOf.call(n,t)),i===m?t.insAtLeftEnd(n.ends[m]):t.insRightOf(n)},t.placeCursor=Tt,t.unwrap=function(){this.ends[m].children().disown().adopt(this.parent,this,this[g]).jQ.insertAfter(this.jQ),this.remove()},t.deleteSide=function(t,e,n){var i,s,r,o=this.parent,a=this[t],l=o.ends[t];if(t===this.side)return this.unwrap(),void(a?n.insDirOf(-t,a):n.insAtDirEnd(t,o));if(i=n.options,s=!this.side,this.side=-t,this.matchBrack(i,t,this.ends[m].ends[this.side]))this.closeOpposing(this.ends[m].ends[this.side]),r=this.ends[m].ends[t],this.unwrap(),r.siblingCreated&&r.siblingCreated(n.options,t),a?n.insDirOf(-t,a):n.insAtDirEnd(t,o);else{if(this.matchBrack(i,t,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(e&&s)return this.unwrap(),void(a?n.insDirOf(-t,a):n.insAtDirEnd(t,o));this.sides[t]={ch:ft[this.sides[this.side].ch],ctrlSeq:ft[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(t===m?0:1).addClass("mq-ghost").html(this.sides[t].ch)}a?(r=this.ends[m].ends[t],w(a,l,-t).disown().withDirAdopt(-t,this.ends[m],r,0).jQ.insAtDirEnd(t,this.ends[m].jQ.removeClass("mq-empty")),r.siblingCreated&&r.siblingCreated(n.options,t),n.insDirOf(-t,a)):e?n.insDirOf(t,this):n.insAtDirEnd(t,this.ends[m])}},t.deleteTowards=function(t,e){this.deleteSide(-t,!1,e)},t.finalizeTree=function(){this.ends[m].deleteOutOf=function(t,e){this.parent.deleteSide(t,!0,e)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===m?1:0).removeClass("mq-ghost"),this.side=0}},t.siblingCreated=function(t,e){e===-this.side&&this.finalizeTree()}}),ft={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "},Nt("("),Nt("["),Nt("{","\\{"),x.langle=_t(ut,m,"&lang;","&rang;","\\langle ","\\rangle "),x.rangle=_t(ut,g,"&lang;","&rang;","\\langle ","\\rangle "),o["|"]=_t(ut,m,"|","|","|","|"),x.lVert=_t(ut,m,"&#8741;","&#8741;","\\lVert ","\\rVert "),x.rVert=_t(ut,g,"&#8741;","&#8741;","\\lVert ","\\rVert "),x.left=r(l,function(t){t.parser=function(){var t=j.regex,e=j.string,n=(j.succeed,j.optWhitespace);return n.then(t(/^(?:[([|]|\\\{|\\langle(?![a-zA-Z])|\\lVert(?![a-zA-Z]))/)).then(function(s){var r="\\"===s.charAt(0)?s.slice(1):s;return"\\langle"==s&&(r="&lang;",s+=" "),"\\lVert"==s&&(r="&#8741;",s+=" "),Q.then(function(i){return e("\\right").skip(n).then(t(/^(?:[\])|]|\\\}|\\rangle(?![a-zA-Z])|\\rVert(?![a-zA-Z]))/)).map(function(t){var e,n="\\"===t.charAt(0)?t.slice(1):t;return"\\rangle"==t&&(n="&rang;",t+=" "),"\\rVert"==t&&(n="&#8741;",t+=" "),(e=ut(0,r,n,s,t)).blocks=[i],i.adopt(e,0,0),e})})})}}),x.right=r(l,function(t){t.parser=function(){return j.fail("unmatched \\right")}}),pt=x.binom=x.binomial=r(r(l,Ft),function(t,e){t.ctrlSeq="\\binom",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',t.textTemplate=["choose(",",",")"]}),x.choose=r(pt,function(t){t.createLeftOf=at.prototype.createLeftOf}),x.editable=x.MathQuillMathField=r(l,function(t,s){t.ctrlSeq="\\MathQuillMathField",t.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',t.parser=function(){var e=this,t=j.string,n=j.regex,i=j.succeed;return t("[").then(n(/^[a-z][a-z0-9]*/i)).skip(t("]")).map(function(t){e.name=t}).or(i()).then(s.parser.call(e))},t.finalizeTree=function(t){var e=c(this.ends[m],this.jQ,t);e.KIND_OF_MQ="MathField",e.editable=!0,e.createTextarea(),e.editablesTextareaEvents(),e.cursor.insAtRightEnd(e.root),Mt(e.root)},t.registerInnerField=function(t,e){t.push(t[this.name]=e(this.ends[m].controller))},t.latex=function(){return this.ends[m].latex()},t.text=function(){return this.ends[m].text()}}),dt=x.embed=r(T,function(t,e){t.setOptions=function(t){function e(){return""}return this.text=t.text||e,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||e,this},t.parser=function(){var n=this,t=j.string,i=j.regex,s=j.succeed;return t("{").then(i(/^[a-z][a-z0-9]*/i)).skip(t("}")).then(function(e){return t("[").then(i(/^[-\w\s]*/)).skip(t("]")).or(s()).map(function(t){return n.setOptions(y[e](t))})})}}),mt={},x.begin=r(l,function(t,e){t.parser=function(){var e=j.string,t=j.regex;return e("{").then(t(/^[a-z]+/i)).skip(e("}")).then(function(t){return(mt[t]?mt[t]().parser():j.fail("unknown environment type: "+t)).skip(e("\\end{"+t+"}"))})}}),gt=r(l,function(t,e){t.template=[["\\begin{","}"],["\\end{","}"]],t.wrappers=function(){return[t.template[0].join(this.environment),t.template[1].join(this.environment)]}}),bt=mt.matrix=r(gt,function(t,r){var i="&",o="\\\\";t.parentheses={left:null,right:null},t.environment="matrix",t.reflow=function(){var t=this.jQ.children("table"),e=t.outerHeight()/+t.css("fontSize").slice(0,-2),n=this.jQ.children(".mq-paren");n.length&&Z(n,jt(1+.2*(e-1),1.2),1.05*e)},t.latex=function(){var e,n="";return this.eachChild(function(t){void 0!==e&&(n+=e!==t.row?o:i),e=t.row,n+=t.latex()}),this.wrappers().join(n)},t.html=function(){var e,n=[],i="",s=0;function t(t){return t?'<span class="mq-scaled mq-paren">'+t+"</span>":""}return this.eachChild(function(t){e!==t.row&&(e=t.row,i+="<tr>$tds</tr>",n[e]=[]),n[e].push("<td>&"+s+++"</td>")}),this.htmlTemplate='<span class="mq-matrix mq-non-leaf">'+t(this.parentheses.left)+'<table class="mq-non-leaf">'+i.replace(/\$tds/g,function(){return n.shift().join("")})+"</table>"+t(this.parentheses.right)+"</span>",r.html.call(this)},t.createBlocks=function(){this.blocks=[vt(0,this),vt(0,this),vt(1,this),vt(1,this)]},t.parser=function(){var r=this,t=j.optWhitespace,e=j.string;return t.then(e(i).or(e(o)).or(Q.block)).many().skip(t).then(function(t){var e,n=[],i=0;function s(){r.blocks.push(vt(i,r,n)),n=[]}for(r.blocks=[],e=0;e<t.length;e+=1)t[e]instanceof _?n.push(t[e]):(s(),t[e]===o&&(i+=1));return s(),r.autocorrect(),j.succeed(r)})},t.finalizeTree=function(){var t=this.jQ.find("table");t.toggleClass("mq-rows-1",1===t.find("tr").length),this.relink()},t.getEntryPoint=function(t,e,n){return"up"===n?t===m?this.blocks[this.rowSize-1]:this.blocks[0]:t===m?this.blocks[this.blocks.length-1]:this.blocks[this.blocks.length-this.rowSize]},t.atExitPoint=function(t,e){var n=this.blocks.indexOf(e.parent);return t===m?n%this.rowSize==0:(n+1)%this.rowSize==0},t.moveTowards=function(t,e,n){var i=n&&this.getEntryPoint(t,e,n);e.insAtDirEnd(-t,i||this.ends[-t])},t.relink=function(){var t,e,n,i,s=this.blocks,r=[];for(this.rowSize=s.length,i=0;i<s.length;i+=1)t!==(n=s[i]).row&&(1===n.row&&(this.rowSize=e),r[t=n.row]=[],e=0),(r[t][e]=n)[g]=s[i+1],n[m]=s[i-1],r[t-1]&&r[t-1][e]&&(n.upOutOf=r[t-1][e],r[t-1][e].downOutOf=n),e+=1;this.ends[m]=s[0],this.ends[g]=s[s.length-1]},t.autocorrect=function(t){var e,n,i,s,r,o,a=[];for(t=[],e=this.blocks,o=0;o<e.length;o+=1)t[r=e[o].row]=t[r]||[],t[r].push(e[o]),a[r]=t[r].length;if((n=Math.max.apply(null,a))!==Math.min.apply(null,a)){for(o=0;o<t.length;o+=1)for(i=n-t[o].length;i;)s=n*o+t[o].length,e.splice(s,0,vt(o,this)),i-=1;this.relink()}},t.deleteCell=function(e){var n,i,s=[],r=[],o=[],a=[],l=this.blocks;function t(t){var e,n=[];for(e=0;e<t.length;e+=1)t[e].isEmpty()&&n.push(t[e]);return n.length===t.length}function c(t){for(var e=0;e<t.length;e+=1)-1<l.indexOf(t[e])&&(t[e].remove(),l.splice(l.indexOf(t[e]),1))}this.eachChild(function(t){n!==t.row&&(n=t.row,s[n]=[],i=0),r[i]=r[i]||[],r[i].push(t),s[n].push(t),t===e&&(o=s[n],a=r[i]),i+=1}),t(o)&&1<a.length&&(n=s.indexOf(o),this.eachChild(function(t){t.row>n&&(t.row-=1)}),c(o),this.jQ.find("tr").eq(n).remove()),t(a)&&1<o.length&&c(a),this.finalizeTree()},t.deleteRow=function(e){var n,i,s=[],r=[],o=[],a=[],l=this.blocks;this.eachChild(function(t){n!==t.row&&(n=t.row,s[n]=[],i=0),r[i]=r[i]||[],r[i].push(t),s[n].push(t),t===e&&(o=s[n],a=r[i]),i+=1}),1<a.length&&(!function(t){for(var e=0;e<t.length;e+=1)-1<l.indexOf(t[e])&&(t[e].remove(),l.splice(l.indexOf(t[e]),1))}(o),this.jQ.find("tr").eq(n).remove()),this.finalizeTree()},t.deleteColumn=function(e){var n,i,s=[],r=[],o=[],a=[],l=this.blocks;this.eachChild(function(t){n!==t.row&&(n=t.row,s[n]=[],i=0),r[i]=r[i]||[],r[i].push(t),s[n].push(t),t===e&&(o=s[n],a=r[i]),i+=1}),1<o.length&&function(t){for(var e=0;e<t.length;e+=1)-1<l.indexOf(t[e])&&(t[e].remove(),l.splice(l.indexOf(t[e]),1))}(a),this.finalizeTree()},t.addRow=function(e){var t,n,i,s=[],r=[],o=[],a=b("<tr></tr>"),l=e.row,c=0;for(this.eachChild(function(t){t.row<=l&&s.push(t),t.row===l&&(t===e&&(n=c),c+=1),t.row>l&&(t.row+=1,o.push(t))}),i=0;i<c;i+=1)(t=vt(l+1)).parent=this,r.push(t),t.jQ=b('<td class="mq-empty">').attr(Ct,t.id).appendTo(a);return this.jQ.find("tr").eq(l).after(a),this.blocks=s.concat(r,o),r[n]},t.addColumn=function(e){var n,t,i,s=[],r=[];for(this.eachChild(function(t){s[t.row]=s[t.row]||[],s[t.row].push(t),t===e&&(n=s[t.row].length)}),i=0;i<s.length;i+=1)(t=vt(i)).parent=this,r.push(t),s[i].splice(n,0,t),t.jQ=b('<td class="mq-empty">').attr(Ct,t.id);return this.jQ.find("tr").each(function(t){b(this).find("td").eq(n-1).after(s[t][n].jQ)}),this.blocks=[].concat.apply([],s),r[e.row]},t.insert=function(t,e){var n=this[t](e);this.cursor=this.cursor||this.parent.cursor,this.finalizeTree(),this.bubble("reflow").cursor.insAtRightEnd(n)},t.remove=function(t,e){this[t](e);this.cursor=this.cursor||this.parent.cursor,this.finalizeTree(),this.bubble("reflow")},t.backspace=function(t,e,n,i){var s=t[e];if(t.isEmpty()){for(this.deleteCell(t);s&&s[e]&&-1===this.blocks.indexOf(s);)s=s[e];s&&n.insAtDirEnd(-e,s),1===this.blocks.length&&this.blocks[0].isEmpty()&&(i(),this.finalizeTree()),this.bubble("edited")}}}),mt.pmatrix=r(bt,function(t,e){t.environment="pmatrix",t.parentheses={left:"(",right:")"}}),mt.bmatrix=r(bt,function(t,e){t.environment="bmatrix",t.parentheses={left:"[",right:"]"}}),mt.Bmatrix=r(bt,function(t,e){t.environment="Bmatrix",t.parentheses={left:"{",right:"}"}}),mt.vmatrix=r(bt,function(t,e){t.environment="vmatrix",t.parentheses={left:"|",right:"|"}}),mt.Vmatrix=r(bt,function(t,e){t.environment="Vmatrix",t.parentheses={left:"&#8214;",right:"&#8214;"}}),vt=r(_,function(t,s){t.init=function(t,e,n){if(s.init.call(this),this.row=t,e&&this.adopt(e,e.ends[g],0),n)for(var i=0;i<n.length;i++)n[i].children().adopt(this,this.ends[g],0)},t.keystroke=function(t,e,n){switch(t){case"Shift-Spacebar":return e.preventDefault(),this.parent.insert("addColumn",this);case"Shift-Enter":return this.parent.insert("addRow",this)}return s.keystroke.apply(this,arguments)},t.deleteOutOf=function(t,e){var n=this,i=arguments;this.parent.backspace(this,t,e,function(){return s.deleteOutOf.apply(n,i)})},t.moveOutOf=function(t,e,n){!(n&&this.parent.atExitPoint(t,e))&&this[t]?e.insAtDirEnd(-t,this[t]):e.insDirOf(t,this.parent)}}),o["\\"]=r(l,function(t,i){t.ctrlSeq="\\",t.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},t.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',t.textTemplate=["\\"],t.createBlocks=function(){i.createBlocks.call(this),this.ends[m].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[m].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[m].write=function(t,e){t.show().deleteSelection(),e.match(/[a-z]/i)?S(e).createLeftOf(t):(this.parent.renderCommand(t),"\\"===e&&this.isEmpty()||t.parent.write(t,e))},this.ends[m].keystroke=function(t,e,n){return"Tab"===t||"Enter"===t||"Spacebar"===t?(this.parent.renderCommand(n.cursor),void e.preventDefault()):i.keystroke.apply(this,arguments)}},t.createLeftOf=function(t){if(i.createLeftOf.call(this,t),this._replacedFragment){var e=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(t){return b(t.target=e).trigger(t),!1}).insertBefore(this.jQ).add(this.jQ)}},t.latex=function(){return"\\"+this.ends[m].latex()+" "},t.renderCommand=function(t){var e,n;this.jQ=this.jQ.last(),this.remove(),this[g]?t.insLeftOf(this[g]):t.insAtRightEnd(this.parent),(e=this.ends[m].latex())||(e=" "),(n=x[e]||mt[e])?(n=n(e),this._replacedFragment&&n.replaces(this._replacedFragment),n.createLeftOf(t)):((n=A()).replaces(e),n.createLeftOf(t),t.insRightOf(n),this._replacedFragment&&this._replacedFragment.remove())}}),p.addCommands=function(t){for(var e in t){if(x.hasOwnProperty(e))throw'"'+e+'" is a built-in operator name';if(3!=t[e].length)throw'"'+e+'" does not have the required number of elements';if("VanillaSymbol"==t[e][0])x[e]=_t(S,t[e][1],t[e][2]);else if("BinarySymbol"==t[e][0])x[e]=_t(BinarySymbol,t[e][1],t[e][2]);else{if("Variable"!=t[e][0])throw'"'+e+'" is using an unsupported symbol type';x[e]=_t(M,t[e][1],t[e][2])}}},wt=It(1))!function(t,e){"function"==typeof e?(Rt[t]=function(){return zt(),e.apply(this,arguments)}).prototype=e.prototype:Rt[t]=e}(xt,wt[xt])}();
