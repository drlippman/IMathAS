var canvases=new Array,drawla=new Array,imathasDraw=function($){var clickcnt,lastdrawmouseup,mouseintarget,normslider,drawexport,mouseisdown=!1,targets=new Array,imgs=new Array,targetOuts=new Array,a11ytargets=new Array,lines=new Array,dots=new Array,odots=new Array,tplines=new Array,tptypes=new Array,ineqlines=new Array,ineqtypes=new Array,curLine=null,drawstyle=[],drawlocky=[],curTPcurve=null,curIneqcurve=null,ineqcolors=["rgb(0,0,255)","rgb(255,0,0)","rgb(0,255,0)"],ineqacolors=["rgba(0,0,255,.4)","rgba(255,0,0,.4)","rgba(0,255,0,.4)"],asymcolor="rgb(0,200,0)",dragObj=null,oldpointpos=null,curTarget=null,curCursor=null,nocanvaswarning=!1,hasTouch=!1,didMultiTouch=!1,clickmightbenewcurve=!1,hasTouchTimer=null,tpModeN={5:2,5.2:2,5.3:2,5.4:2,6:2,6.1:2,6.3:2,6.5:2,6.6:2,7:2,7.2:2,7.4:2,7.5:2,8:2,8.2:2,8.3:2,8.4:2,8.5:3,8.6:3,9:2,9.1:2,10:3,10.2:3,10.3:3,10.4:3},tpHasAsymp={7.4:1,7.5:1,8.2:1,8.5:1,8.6:1};function reset(){clearAllDrawListners(),targets.length=0,imgs.length=0,targetOuts.length=0,a11ytargets.length=0,lines.length=0,dots.length=0,odots.length=0,tplines.length=0,tptypes.length=0,ineqlines.length=0,ineqtypes.length=0,drawstyle.length=0,drawlocky.length=0,curIneqcurve=curTPcurve=dragObj=curLine=curTarget=null}function clearcanvas(e){lines[e].length=0,dots[e].length=0,odots[e].length=0,tplines[e].length=0,tptypes[e].length=0,ineqlines[e].length=0,ineqtypes[e].length=0,curTarget=e,drawTarget(),dragObj=curLine=curTarget=null}function clearlastline(e){0<lines[e].length&&(lines[e].length=lines[e].length-1),curTarget=e,drawTarget(),dragObj=curLine=curTarget=null}function addA11yTarget(e,t){var r,n,a,i,s,g,u,l,o,c,d,T,p,h,m,y,w,f,v=e[0];for(a11ytargets.push(v),r=e[1].substr(9).split(","),n=e[2],a=e[3],(i=e[4])==(s=e[5])&&(i=-1,s=1),g=e[6],u=e[7],l=e[8],o=document.getElementById("a11ydraw"+v),targetOuts[v]=document.getElementById("qn"+v),targets[v]={el:o,xmin:n,xmax:a,ymin:i,ymax:s,imgborder:g,imgwidth:u,imgheight:l},targets[v].pixperx=(u-2*g)/(a-n),targets[v].pixpery=i==s?1:(l-2*g)/(s-i),"inequality"==r[0]?(c=r.shift(),0==r.length?r=["line"]:"both"==r[0]&&(r=["line","parab"])):"twopoint"==r[0]?(c=r.shift(),0==r.length&&(r=["line","parab","abs","circle","dot"])):"numberline"==r[0]?(c="basic",r.shift()):c="basic",targets[v].afgroup=c,d={inequality:{line:[{mode:10,descr:_("Linear inequality with solid line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")},{mode:10.2,descr:_("Linear inequality with dashed line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")}],parab:[{mode:10.3,descr:_("Parabolic inequality with solid line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")},{mode:10.4,descr:_("Parabolic inequality with dashed line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")}]},twopoint:{line:[{mode:5,descr:_("Line"),inN:2,input:_("Enter two points on the line")}],lineseg:[{mode:5.3,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],ray:[{mode:5.2,descr:_("Ray"),inN:2,input:_("Enter the starting point of the ray and another point on the ray")}],parab:[{mode:6,descr:_("Parabola"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],horizparab:[{mode:6.1,descr:_("Parabola opening right or left"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],cubic:[{mode:6.3,descr:_("Cubic"),inN:2,input:_("Enter the inflection point, then another point on the cubic")}],cuberoot:[{mode:6.6,descr:_("Cube root"),inN:2,input:_("Enter the inflection point of the cube root, then another point on the graph")}],abs:[{mode:8,descr:_("Absolute value"),inN:2,input:_("Enter the corner point of the absolute value, then another point on the graph")}],rational:[{mode:8.2,descr:_("Rational"),inN:2,input:_("Enter the point where the vertical and horizontal asymptote cross, then a point on the graph")}],exp:[{mode:8.3,descr:_("Exponential"),inN:2,input:_("Enter two points on the graph")}],log:[{mode:8.4,descr:_("Logarithm"),inN:2,input:_("Enter two points on the graph")}],genexp:[{mode:8.5,descr:_("Shifted Exponential"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],genlog:[{mode:8.6,descr:_("Shifted Logarithm"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],circle:[{mode:7,descr:_("Circle"),inN:2,input:_("Enter the center point of the circle, then a point on the graph")}],ellipse:[{mode:7.2,descr:_("Ellipse"),inN:2,input:_("Enter the center point of the ellipse, then a point offset from the center by the horizontal radius and vertical radius")}],hyperbola:[{mode:7.4,descr:_("Vertical hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the co-vertex and y is the y-coordinate of the vertex")},{mode:7.5,descr:_("Horizontal hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the vertex and y is the y-coordinate of the co-vertex")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],trig:[{mode:9,descr:_("Cosine"),inN:2,input:_("Enter a point at the start of a phase, then a point half a phase further")},{mode:9.2,descr:_("Sine"),inN:2,input:_("Enter a point at the start of a phase, then a point a quarter phase further")}],vector:[{mode:5.4,descr:_("Vector"),inN:2,input:_("Enter the starting and ending point of the vector")}]},basic:{line:[{mode:0,descr:_("Lines"),inN:"list",input:_("Enter list of points to connect with lines")}],lineseg:[{mode:.5,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],freehand:[{mode:.7,descr:_("Freehand"),inN:"list",input:_("Enter list of points to connect with lines")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],polygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter list of points to place dots connected with lines"),dotline:1}],closedpolygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter list of points to place dots connected with lines"),dotline:2}]}},p=[],h=[],m=[],w=0;w<r.length;w++)if(d[c].hasOwnProperty(r[w]))for(0==w&&(T=d[c][r[w]][0].mode),f=0;f<d[c][r[w]].length;f++)m[d[c][r[w]][f].mode]=d[c][r[w]][f],p.push(d[c][r[w]][f].mode),y='<option value="'+d[c][r[w]][f].mode+'"',y+=' data-af="'+r[w]+'">'+d[c][r[w]][f].descr+"</option>",h.push(y);if(targets[v].defmode=T,targets[v].inputmodes=p,targets[v].selects=h,targets[v].moderef=m,null==t&&lines.hasOwnProperty(v)){for(w=0;w<lines[v].length;w++)adda11ydraw(v,0,pixcoordstopointlist(lines[v][w],v));for(w=0;w<dots[v].length;w++)adda11ydraw(v,1,pixcoordstopointlist(dots[v][w],v));for(w=0;w<odots[v].length;w++)adda11ydraw(v,2,pixcoordstopointlist(odots[v][w],v));for(w=0;w<tplines[v].length;w++)adda11ydraw(v,tptypes[v][w],pixcoordstopointlist(tplines[v][w][0],v)+","+pixcoordstopointlist(tplines[v][w][1],v));for(w=0;w<ineqlines[v].length;w++)adda11ydraw(v,ineqtypes[v][w],pixcoordstopointlist(ineqlines[v][w][0],v)+","+pixcoordstopointlist(ineqlines[v][w][1],v)+","+pixcoordstopointlist(ineqlines[v][w][2],v))}else if(null!=t)for(w=0;w<t.length;w++)adda11ydraw(v,t[w][0],t[w][1].replace(/\[/g,"(").replace(/\]/g,")"))}function adda11ydraw(e,t,r){var n,a=targets[e],i=t||a.defmode,s=r||"";a.afgroup;for(j in html='<select aria-label="'+_("Drawing element type")+'" onchange="imathasDraw.changea11ydraw(this,\''+e+"')\">",a.selects)html+=a.selects[j];html+="</select><br/>",html+='<span class="a11ydrawinstr"></span><br/>',html+='<input type="text" aria-label="'+_("Point list")+'" value="'+s+'"/>',html+='<button type="button" class="imgbutton" onclick="imathasDraw.removea11ydraw(this)">',html+=_("Remove")+"</button>",n=$("<li>",{class:"a11ydrawrow"}).html(html),$(a.el).append(n),n.find("select").val(i),n.find(".a11ydrawinstr").text(a.moderef[i].input),r||n.find("select").focus()}function removea11ydraw(e){$(e).parent().remove()}function changea11ydraw(e,t){var r=$(e).val(),n=targets[t].moderef[r];$(e).parent().find(".a11ydrawinstr").text(n.input)}function pixcoordstopointlist(e,t){var r=targets[t],n=(e[0]-r.imgborder)/r.pixperx+r.xmin,a=(r.imgheight-e[1]-r.imgborder)/r.pixpery+r.ymin;return"("+(n=Math.round(100*n)/100)+","+(a=Math.round(100*a)/100)+")"}function encodea11ydraw(){var i,tarnum,thistarg,lines,dots,odots,tplines,tpineq,saveinput,afgroup;for(i=0;i<a11ytargets.length;i++)tarnum=a11ytargets[i],thistarg=targets[tarnum],lines=[],dots=[],odots=[],tplines=[],tpineq=[],saveinput=[],afgroup=targets[tarnum].afgroup,$("#a11ydraw"+tarnum).find(".a11ydrawrow").each(function(i,el){var outpts,mode=$(el).find("select").val(),input=$(el).find("input").val();for(saveinput.push("["+mode+',"'+input+'"]'),input=input.replace(/[\(\)]/g,"").split(/\s*,\s*/),outpts=[],i=1;i<input.length;i+=2){try{input[i-1]=eval(prepWithMath(mathjs(input[i-1])))}catch(e){input[i-1]=NaN}try{input[i]=eval(prepWithMath(mathjs(input[i])))}catch(e){input[i]=NaN}input[i-1]=(input[i-1]-thistarg.xmin)*thistarg.pixperx+thistarg.imgborder,input[i]=thistarg.imgheight-(input[i]-thistarg.ymin)*thistarg.pixpery-thistarg.imgborder,outpts.push(Math.round(input[i-1])+","+Math.round(input[i]))}1==mode?dots.push("("+outpts.join("),(")+")"):2==mode?odots.push("("+outpts.join("),(")+")"):mode<1?lines.push("("+outpts.join("),(")+")"):5<=mode&&mode<10&&2==outpts.length?tplines.push("("+mode+","+outpts.join(",")+")"):10<=mode&&3==outpts.length&&tpineq.push("("+mode+","+outpts.join(",")+")")}),targetOuts[tarnum].value=lines.join(";")+";;"+dots.join(",")+";;"+odots.join(",")+";;"+tplines.join(",")+";;"+tpineq.join(",")+";;"+saveinput.join(",")}function addTarget(t,e,r,n,a,i,s,g,u,l,o,c,d,T,p){var h,m=document.getElementById(e);$(m).is(":hidden")&&$(m).on("mouseover.imathasdrawwait touchstart.imathasdrawwait",function(){$(m).off("mouseover.imathasdrawwait touchstart.imathasdrawwait"),initCanvases(t)}),m.style.userSelect="none",m.style.webkitUserSelect="none",m.style.MozUserSelect="none",h=getPosition(m),targets[t]={el:m,left:h.x,top:h.y,width:m.offsetWidth,height:m.offsetHeight,xmin:a,xmax:i,ymin:s,ymax:g,imgborder:u,imgwidth:l,imgheight:o,mode:c,dotline:d},"string"==typeof p&&-1!=p.indexOf(":")?(p=p.split(":"),targets[t].snaptogridx=+p[0],targets[t].snaptogridy=+p[1]):(targets[t].snaptogridx=p,targets[t].snaptogridy=p),targets[t].pixperx=(l-2*u)/(i-a),targets[t].pixpery=s==g?1:(o-2*u)/(g-s),targetOuts[t]=document.getElementById(n),null==lines[t]&&(lines[t]=new Array),null==dots[t]&&(dots[t]=new Array),null==odots[t]&&(odots[t]=new Array),null==tplines[t]&&(tplines[t]=new Array),null==tptypes[t]&&(tptypes[t]=new Array),null==ineqlines[t]&&(ineqlines[t]=new Array),null==ineqtypes[t]&&(ineqtypes[t]=new Array),drawstyle[t]=5<=c?1:0,drawlocky[t]=T,imgs[t]=new Image,imgs[t].onload=function(){var e=curTarget;curTarget=t,drawTarget(),curTarget=e},imgs[t].src=r}function settool(e,t,r){var n,a=document.getElementById("drawtools"+t),i=a.getElementsByTagName("span");for(n=0;n<i.length;n++)i[n].className="";for(i=a.getElementsByTagName("img"),n=0;n<i.length;n++)i[n].className="";e.className="sel",setDrawMode(t,r),curTarget=t,drawTarget()}function setDrawMode(e,t){targets[e].mode=t}function setDotLine(e,t){targets[e].dotline=t}function drawTarget(e,t){var r,n,a,i,s,g,u,l,o,c,d,T,p,h,m,y,w,f,v,b,q,x,M,O,L,j,P,I,E,_,k,B,N,C,$,S,A,D,W,R,H,U,z,F,Y,X,V,Q,G,J,K,Z,ee,te;try{r=targets[curTarget].el.getContext("2d")}catch(e){nocanvaswarning||(nocanvaswarning=!0,alert("Your browser does not support drawing answer entry.  Please try again using Internet Explorer 6+ (Windows), FireFox 1.5+ (Win/Mac), Safari 1.3+ (Mac), Opera 9+ (Win/Mac), or Camino (Mac)"))}for(r.fillStyle="rgb(0,0,255)",r.lineWidth=2,r.strokeStyle="rgb(0,0,255)",r.clearRect(0,0,targets[curTarget].imgwidth,targets[curTarget].imgheight),r.drawImage(imgs[curTarget],0,0),r.beginPath(),n=0;n<ineqlines[curTarget].length;n++){for(a=n%3,r.strokeStyle=ineqcolors[a],r.fillStyle=ineqcolors[a],l=u=g=s=i=null,3==ineqlines[curTarget][n].length?(s=ineqlines[curTarget][n][1][0],u=ineqlines[curTarget][n][1][1],g=ineqlines[curTarget][n][2][0],l=ineqlines[curTarget][n][2][1]):2==ineqlines[curTarget][n].length?(s=ineqlines[curTarget][n][1][0],u=ineqlines[curTarget][n][1][1],g=e,l=t):curIneqcurve==n&&null!=e&&1==ineqlines[curTarget][n].length&&(s=e,u=t),null!=g&&(r.save(),r.fillStyle=ineqacolors[a],r.beginPath(),ineqtypes[curTarget][n]<=10.2?(s!=ineqlines[curTarget][n][0][0]&&(i=(u-ineqlines[curTarget][n][0][1])/(s-ineqlines[curTarget][n][0][0])),Math.abs(s-ineqlines[curTarget][n][0][0])<1||100<Math.abs(i)?(r.moveTo(ineqlines[curTarget][n][0][0],0),r.lineTo(ineqlines[curTarget][n][0][0],targets[curTarget].imgheight),s<g?(r.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight),r.lineTo(targets[curTarget].imgwidth,0)):(r.lineTo(0,targets[curTarget].imgheight),r.lineTo(0,0))):(o=i*(g-s)+u,c=ineqlines[curTarget][n][0][1]-i*ineqlines[curTarget][n][0][0],d=ineqlines[curTarget][n][0][1]+i*(targets[curTarget].imgwidth-ineqlines[curTarget][n][0][0]),r.moveTo(0,c),r.lineTo(targets[curTarget].imgwidth,d),o<l?(r.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight),r.lineTo(0,targets[curTarget].imgheight)):(r.lineTo(targets[curTarget].imgwidth,0),r.lineTo(0,0))),r.closePath()):shadeParabola(r,ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],s,u,g,l,targets[curTarget].imgwidth,targets[curTarget].imgheight),r.fill(),r.restore()),r.beginPath(),null!=s&&(ineqtypes[curTarget][n]<=10.2?(s!=ineqlines[curTarget][n][0][0]&&(i=(u-ineqlines[curTarget][n][0][1])/(s-ineqlines[curTarget][n][0][0])),Math.abs(s-ineqlines[curTarget][n][0][0])<1||100<Math.abs(i)?10.2==ineqtypes[curTarget][n]?null!=dragObj&&10<=dragObj.mode&&dragObj.mode<11&&dragObj.num==n&&0==dragObj.subnum?(r.dashedLine(ineqlines[curTarget][n][1][0],ineqlines[curTarget][n][1][1],ineqlines[curTarget][n][1][0],targets[curTarget].imgheight),r.dashedLine(ineqlines[curTarget][n][1][0],ineqlines[curTarget][n][1][1],ineqlines[curTarget][n][1][0],0)):(r.dashedLine(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],ineqlines[curTarget][n][0][0],targets[curTarget].imgheight),r.dashedLine(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],ineqlines[curTarget][n][0][0],0)):(r.moveTo(ineqlines[curTarget][n][0][0],0),r.lineTo(ineqlines[curTarget][n][0][0],targets[curTarget].imgheight),r.stroke()):(c=ineqlines[curTarget][n][0][1]-i*ineqlines[curTarget][n][0][0],d=ineqlines[curTarget][n][0][1]+i*(targets[curTarget].imgwidth-ineqlines[curTarget][n][0][0]),10.2==ineqtypes[curTarget][n]?null!=dragObj&&10<=dragObj.mode&&dragObj.mode<11&&dragObj.num==n&&0==dragObj.subnum?(r.dashedLine(ineqlines[curTarget][n][1][0],ineqlines[curTarget][n][1][1],targets[curTarget].imgwidth,d),r.dashedLine(ineqlines[curTarget][n][1][0],ineqlines[curTarget][n][1][1],0,c)):(r.dashedLine(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],targets[curTarget].imgwidth,d),r.dashedLine(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],0,c)):(r.moveTo(0,c),r.lineTo(targets[curTarget].imgwidth,d),r.stroke()))):10.3==ineqtypes[curTarget][n]?(s!=ineqlines[curTarget][n][0][0]&&(u==ineqlines[curTarget][n][0][1]?(r.moveTo(0,u),r.lineTo(targets[curTarget].imgwidth,u)):(T=(u-ineqlines[curTarget][n][0][1])/((s-ineqlines[curTarget][n][0][0])*(s-ineqlines[curTarget][n][0][0])),y=u>ineqlines[curTarget][n][0][1]?(p=Math.sqrt((targets[curTarget].imgheight-ineqlines[curTarget][n][0][1])/T)+ineqlines[curTarget][n][0][0],h=-1*Math.sqrt((targets[curTarget].imgheight-ineqlines[curTarget][n][0][1])/T)+ineqlines[curTarget][n][0][0],m=ineqlines[curTarget][n][0][1]-(targets[curTarget].imgheight-ineqlines[curTarget][n][0][1]),targets[curTarget].imgheight):(p=Math.sqrt((0-ineqlines[curTarget][n][0][1])/T)+ineqlines[curTarget][n][0][0],h=-1*Math.sqrt((0-ineqlines[curTarget][n][0][1])/T)+ineqlines[curTarget][n][0][0],m=2*ineqlines[curTarget][n][0][1],0),v=(w=p+2/3*(ineqlines[curTarget][n][0][0]-p))+(h-p)/3,b=f=y+2/3*(m-y),r.moveTo(p,y),r.bezierCurveTo(w,f,v,b,h,y))),r.stroke()):s!=ineqlines[curTarget][n][0][0]&&dashedParabola(r,ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],s,u,targets[curTarget].imgwidth,targets[curTarget].imgheight)),r.beginPath(),q=0;q<ineqlines[curTarget][n].length;q++)2==q?(r.arc(ineqlines[curTarget][n][q][0],ineqlines[curTarget][n][q][1],4,0,2*Math.PI,!0),r.fill()):r.fillRect(ineqlines[curTarget][n][q][0]-3,ineqlines[curTarget][n][q][1]-3,6,6);1==ineqlines[curTarget][n].length&&null!=s&&r.fillRect(s-3,u-3,6,6),r.beginPath()}for(r.fillStyle="rgb(0,0,255)",1==drawlocky[curTarget]?r.lineWidth=4:r.lineWidth=2,r.strokeStyle="rgb(0,0,255)",n=0;n<tplines[curTarget].length;n++){if(5<=tptypes[curTarget][n]&&tptypes[curTarget][n]<6)u=s=i=null,2==tplines[curTarget][n].length?(s=tplines[curTarget][n][1][0],u=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(s=e,u=t),null!=s&&(5.3==tptypes[curTarget][n]||5.4==tptypes[curTarget][n]?(r.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),r.lineTo(s,u),5.4==tptypes[curTarget][n]&&(x=[s-tplines[curTarget][n][0][0],u-tplines[curTarget][n][0][1]],1e-4<(O=Math.sqrt(x[0]*x[0]+x[1]*x[1]))&&(M=[-(x=[x[0]/O,x[1]/O])[1],x[0]],r.moveTo(s-15*x[0]-4*M[0],u-15*x[1]-5*M[1]),r.lineTo(s,u),r.moveTo(s-15*x[0]+4*M[0],u-15*x[1]+5*M[1]),r.lineTo(s,u)))):(s!=tplines[curTarget][n][0][0]&&(i=(u-tplines[curTarget][n][0][1])/(s-tplines[curTarget][n][0][0])),Math.abs(s-tplines[curTarget][n][0][0])<1||100<Math.abs(i)?5.2==tptypes[curTarget][n]?(r.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),u>tplines[curTarget][n][0][1]?r.lineTo(tplines[curTarget][n][0][0],targets[curTarget].imgheight):r.lineTo(tplines[curTarget][n][0][0],0)):(r.moveTo(tplines[curTarget][n][0][0],0),r.lineTo(tplines[curTarget][n][0][0],targets[curTarget].imgheight)):(c=tplines[curTarget][n][0][1]-i*tplines[curTarget][n][0][0],d=tplines[curTarget][n][0][1]+i*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0]),c=tplines[curTarget][n][0][1]-i*tplines[curTarget][n][0][0],d=tplines[curTarget][n][0][1]+i*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0]),5.2==tptypes[curTarget][n]?(r.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),s>tplines[curTarget][n][0][0]?r.lineTo(targets[curTarget].imgwidth,d):r.lineTo(0,c)):(r.moveTo(0,c),r.lineTo(targets[curTarget].imgwidth,d)))));else if(6==tptypes[curTarget][n]||6.1==tptypes[curTarget][n])s=u=null,2==tplines[curTarget][n].length?(s=tplines[curTarget][n][1][0],u=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(s=e,u=t),null!=s&&(6==tptypes[curTarget][n]?u==tplines[curTarget][n][0][1]?(r.moveTo(0,u),r.lineTo(targets[curTarget].imgwidth,u)):s==tplines[curTarget][n][0][0]?(r.moveTo(s,tplines[curTarget][n][0][1]),u>tplines[curTarget][n][0][1]?r.lineTo(s,targets[curTarget].imgheight):r.lineTo(s,0)):(T=(u-tplines[curTarget][n][0][1])/((s-tplines[curTarget][n][0][0])*(s-tplines[curTarget][n][0][0])),y=u>tplines[curTarget][n][0][1]?(p=Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][n][0][1])/T)+tplines[curTarget][n][0][0],h=-1*Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][n][0][1])/T)+tplines[curTarget][n][0][0],m=tplines[curTarget][n][0][1]-(targets[curTarget].imgheight-tplines[curTarget][n][0][1]),targets[curTarget].imgheight):(p=Math.sqrt((0-tplines[curTarget][n][0][1])/T)+tplines[curTarget][n][0][0],h=-1*Math.sqrt((0-tplines[curTarget][n][0][1])/T)+tplines[curTarget][n][0][0],m=2*tplines[curTarget][n][0][1],0),v=(w=p+2/3*(tplines[curTarget][n][0][0]-p))+(h-p)/3,b=f=y+2/3*(m-y),r.moveTo(p,y),r.bezierCurveTo(w,f,v,b,h,y)):6.1==tptypes[curTarget][n]&&(s==tplines[curTarget][n][0][0]?(r.moveTo(s,0),r.lineTo(s,targets[curTarget].imgheight)):u==tplines[curTarget][n][0][1]?(r.moveTo(tplines[curTarget][n][0][0],u),s>tplines[curTarget][n][0][0]?r.lineTo(targets[curTarget].imgwidth,u):r.lineTo(0,u)):(T=(s-tplines[curTarget][n][0][0])/((u-tplines[curTarget][n][0][1])*(u-tplines[curTarget][n][0][1])),j=s>tplines[curTarget][n][0][0]?(p=Math.sqrt((targets[curTarget].imgwidth-tplines[curTarget][n][0][0])/T)+tplines[curTarget][n][0][1],h=-1*Math.sqrt((targets[curTarget].imgwidth-tplines[curTarget][n][0][0])/T)+tplines[curTarget][n][0][1],L=tplines[curTarget][n][0][0]-(targets[curTarget].imgwidth-tplines[curTarget][n][0][0]),targets[curTarget].imgwidth):(p=Math.sqrt((0-tplines[curTarget][n][0][0])/T)+tplines[curTarget][n][0][1],h=-1*Math.sqrt((0-tplines[curTarget][n][0][0])/T)+tplines[curTarget][n][0][1],L=2*tplines[curTarget][n][0][0],0),b=(f=p+2/3*(tplines[curTarget][n][0][1]-p))+(h-p)/3,v=w=j+2/3*(L-j),r.moveTo(j,p),r.bezierCurveTo(w,f,v,b,j,h))));else if(6.5==tptypes[curTarget][n]){if(s=u=null,2==tplines[curTarget][n].length?(s=tplines[curTarget][n][1][0],u=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(s=e,u=t),null!=s&&s!=tplines[curTarget][n][0][0])if(u==tplines[curTarget][n][0][1])r.moveTo(tplines[curTarget][n][0][0],u),s>tplines[curTarget][n][0][0]?r.lineTo(targets[curTarget].imgwidth,u):r.lineTo(0,u);else for(P=s<tplines[curTarget][n][0][0]?-1:1,T=(u-tplines[curTarget][n][0][1])/Math.sqrt(P*(s-tplines[curTarget][n][0][0])),r.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),E=tplines[curTarget][n][0][0],I=tplines[curTarget][n][0][1];E+=3*P,r.lineTo(E,T*Math.sqrt(P*(E-tplines[curTarget][n][0][0]))+tplines[curTarget][n][0][1]),0<E&&E<targets[curTarget].imgwidth&&0<I&&I<targets[curTarget].imgheight;);}else if(6.3==tptypes[curTarget][n]){if(s=u=null,2==tplines[curTarget][n].length?(s=tplines[curTarget][n][1][0],u=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(s=e,u=t),null!=s&&s!=tplines[curTarget][n][0][0])if(u==tplines[curTarget][n][0][1])r.moveTo(0,u),r.lineTo(targets[curTarget].imgwidth,u);else for(T=(u-tplines[curTarget][n][0][1])/safepow(s-tplines[curTarget][n][0][0],3),E=I=0;E<targets[curTarget].imgwidth+4;E+=1)(I=T*safepow(E-tplines[curTarget][n][0][0],3)+tplines[curTarget][n][0][1])<-100&&(I=-100),I>targets[curTarget].imgheight+100&&(I=targets[curTarget].imgheight+100),0==E?r.moveTo(E,I):r.lineTo(E,I)}else if(6.6==tptypes[curTarget][n]){if(s=u=null,2==tplines[curTarget][n].length?(s=tplines[curTarget][n][1][0],u=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(s=e,u=t),null!=s&&s!=tplines[curTarget][n][0][0])if(u==tplines[curTarget][n][0][1])r.moveTo(0,u),r.lineTo(targets[curTarget].imgwidth,u);else for(T=(u-tplines[curTarget][n][0][1])/safepow(s-tplines[curTarget][n][0][0],1/3),E=I=0;E<targets[curTarget].imgwidth+4;E+=1)(I=T*safepow(E-tplines[curTarget][n][0][0],1/3)+tplines[curTarget][n][0][1])<-100&&(I=-100),I>targets[curTarget].imgheight+100&&(I=targets[curTarget].imgheight+100),0==E?r.moveTo(E,I):r.lineTo(E,I)}else if(7<=tptypes[curTarget][n]&&tptypes[curTarget][n]<8){if(s=u=null,2==tplines[curTarget][n].length?(s=tplines[curTarget][n][1][0],u=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(s=e,u=t),null!=s&&(s!=tplines[curTarget][n][0][0]||u!=tplines[curTarget][n][0][1]))if(7==tptypes[curTarget][n])_=Math.sqrt((s-tplines[curTarget][n][0][0])*(s-tplines[curTarget][n][0][0])+(u-tplines[curTarget][n][0][1])*(u-tplines[curTarget][n][0][1])),r.arc(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],_,0,2*Math.PI,!0);else if(7.2==tptypes[curTarget][n])k=Math.abs(s-tplines[curTarget][n][0][0]),B=Math.abs(u-tplines[curTarget][n][0][1]),(curTPcurve==n||null!=dragObj&&dragObj.num==n)&&(r.strokeStyle="rgb(0,255,255)",r.lineWidth=1,r.dashedLine(s,u,s-2*(s-tplines[curTarget][n][0][0]),u,5),r.dashedLine(s,u,s,u-2*(u-tplines[curTarget][n][0][1]),5),r.dashedLine(s,u-2*(u-tplines[curTarget][n][0][1]),s-2*(s-tplines[curTarget][n][0][0]),u-2*(u-tplines[curTarget][n][0][1]),5),r.dashedLine(s-2*(s-tplines[curTarget][n][0][0]),u,s-2*(s-tplines[curTarget][n][0][0]),u-2*(u-tplines[curTarget][n][0][1]),5),r.lineWidth=2),r.strokeStyle="rgb(0,0,255)",r.save(),r.beginPath(),r.translate(tplines[curTarget][n][0][0]-k,tplines[curTarget][n][0][1]-B),r.scale(k,B),r.arc(1,1,1,0,2*Math.PI,!1),r.restore();else if(7.4==tptypes[curTarget][n]){for(N=Math.abs(s-tplines[curTarget][n][0][0]),C=Math.abs(u-tplines[curTarget][n][0][1]),$=Math.abs(C/N),r.strokeStyle=asymcolor,r.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],targets[curTarget].imgwidth,tplines[curTarget][n][0][1]+$*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0])),r.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],targets[curTarget].imgwidth,tplines[curTarget][n][0][1]-$*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0])),r.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],0,tplines[curTarget][n][0][1]-$*tplines[curTarget][n][0][0]),r.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],0,tplines[curTarget][n][0][1]+$*tplines[curTarget][n][0][0]),(curTPcurve==n||null!=dragObj&&dragObj.num==n)&&(r.strokeStyle="rgb(0,255,255)",r.lineWidth=1,r.dashedLine(s,u,s-2*(s-tplines[curTarget][n][0][0]),u,5),r.dashedLine(s,u,s,u-2*(u-tplines[curTarget][n][0][1]),5),r.dashedLine(s,u-2*(u-tplines[curTarget][n][0][1]),s-2*(s-tplines[curTarget][n][0][0]),u-2*(u-tplines[curTarget][n][0][1]),5),r.dashedLine(s-2*(s-tplines[curTarget][n][0][0]),u,s-2*(s-tplines[curTarget][n][0][0]),u-2*(u-tplines[curTarget][n][0][1]),5),r.lineWidth=2),r.beginPath(),r.strokeStyle="rgb(0,0,255)",E=0;E<targets[curTarget].imgwidth+4;E+=3)(I=tplines[curTarget][n][0][1]+Math.sqrt((Math.pow(E-tplines[curTarget][n][0][0],2)/(N*N)+1)*C*C))<-100&&(I=-100),I>targets[curTarget].imgheight+100&&(I=targets[curTarget].imgheight+100),0==E?r.moveTo(E,I):r.lineTo(E,I);for(r.stroke(),r.beginPath(),E=0;E<targets[curTarget].imgwidth+4;E+=3)(I=tplines[curTarget][n][0][1]-Math.sqrt((Math.pow(E-tplines[curTarget][n][0][0],2)/(N*N)+1)*C*C))<-100&&(I=-100),I>targets[curTarget].imgheight+100&&(I=targets[curTarget].imgheight+100),0==E?r.moveTo(E,I):r.lineTo(E,I)}else if(7.5==tptypes[curTarget][n]){for(C=Math.abs(s-tplines[curTarget][n][0][0]),N=Math.abs(u-tplines[curTarget][n][0][1]),$=Math.abs(N/C),r.strokeStyle=asymcolor,r.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],targets[curTarget].imgwidth,tplines[curTarget][n][0][1]+$*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0])),r.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],targets[curTarget].imgwidth,tplines[curTarget][n][0][1]-$*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0])),r.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],0,tplines[curTarget][n][0][1]-$*tplines[curTarget][n][0][0]),r.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],0,tplines[curTarget][n][0][1]+$*tplines[curTarget][n][0][0]),(curTPcurve==n||null!=dragObj&&dragObj.num==n)&&(r.strokeStyle="rgb(0,255,255)",r.lineWidth=1,r.dashedLine(s,u,s-2*(s-tplines[curTarget][n][0][0]),u,5),r.dashedLine(s,u,s,u-2*(u-tplines[curTarget][n][0][1]),5),r.dashedLine(s,u-2*(u-tplines[curTarget][n][0][1]),s-2*(s-tplines[curTarget][n][0][0]),u-2*(u-tplines[curTarget][n][0][1]),5),r.dashedLine(s-2*(s-tplines[curTarget][n][0][0]),u,s-2*(s-tplines[curTarget][n][0][0]),u-2*(u-tplines[curTarget][n][0][1]),5),r.lineWidth=2),r.beginPath(),r.strokeStyle="rgb(0,0,255)",I=0;I<targets[curTarget].imgwidth+4;I+=3)(E=tplines[curTarget][n][0][0]+Math.sqrt((Math.pow(I-tplines[curTarget][n][0][1],2)/(N*N)+1)*C*C))<-100&&(E=-100),E>targets[curTarget].imgwidth+100&&(E=targets[curTarget].imgwidth+100),0==I?r.moveTo(E,I):r.lineTo(E,I);for(r.stroke(),r.beginPath(),I=0;I<targets[curTarget].imgwidth+4;I+=3)(E=tplines[curTarget][n][0][0]-Math.sqrt((Math.pow(I-tplines[curTarget][n][0][1],2)/(N*N)+1)*C*C))<-100&&(E=-100),E>targets[curTarget].imgwidth+100&&(E=targets[curTarget].imgwidth+100),0==I?r.moveTo(E,I):r.lineTo(E,I)}}else if(8==tptypes[curTarget][n])u=s=i=null,2==tplines[curTarget][n].length?(s=tplines[curTarget][n][1][0],u=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(s=e,u=t),null!=s&&(s!=tplines[curTarget][n][0][0]&&(i=(u-tplines[curTarget][n][0][1])/(s-tplines[curTarget][n][0][0]),s<tplines[curTarget][n][0][0]&&(i*=-1)),Math.abs(s-tplines[curTarget][n][0][0])<1||100<Math.abs(i)?(r.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),u>tplines[curTarget][n][0][1]?r.lineTo(tplines[curTarget][n][0][0],targets[curTarget].imgheight):r.lineTo(tplines[curTarget][n][0][0],0)):(c=tplines[curTarget][n][0][1]+i*tplines[curTarget][n][0][0],d=tplines[curTarget][n][0][1]+i*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0]),r.moveTo(0,c),r.lineTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),r.lineTo(targets[curTarget].imgwidth,d)));else if(8.3==tptypes[curTarget][n]){if(s=u=null,2==tplines[curTarget][n].length?(s=tplines[curTarget][n][1][0],u=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(s=e,u=t),null!=s&&s!=tplines[curTarget][n][0][0])if(u==tplines[curTarget][n][0][1])r.moveTo(0,u),r.lineTo(targets[curTarget].imgwidth,u);else if(0<(A=(S=targets[curTarget].ymax*targets[curTarget].pixpery+targets[curTarget].imgborder)-tplines[curTarget][n][0][1])*(D=S-u)&&s!=tplines[curTarget][n][0][0])for(W=safepow(D/A,1/(s-tplines[curTarget][n][0][0])),T=D/safepow(W,s),r.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),E=I=0;E<targets[curTarget].imgwidth+4;E+=3)(I=S-T*safepow(W,E))<-100&&(I=-100),I>targets[curTarget].imgheight+100&&(I=targets[curTarget].imgheight+100),0==E?r.moveTo(E,I):r.lineTo(E,I)}else if(8.4==tptypes[curTarget][n]){if(s=u=null,2==tplines[curTarget][n].length?(s=tplines[curTarget][n][1][0],u=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(s=e,u=t),null!=s&&s!=tplines[curTarget][n][0][0]&&u!=tplines[curTarget][n][0][1]&&0<(H=(R=-targets[curTarget].xmin*targets[curTarget].pixperx+targets[curTarget].imgborder)-tplines[curTarget][n][0][0])*(U=R-s)&&u!=tplines[curTarget][n][0][1])for(W=safepow(U/H,1/(u-tplines[curTarget][n][0][1])),T=U/safepow(W,u),r.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),I=I=0;I<targets[curTarget].imgheight+4;I+=3)(E=R-T*safepow(W,I))<-100&&(E=-100),E>targets[curTarget].imgwidth+100&&(E=targets[curTarget].imgwidth+100),0==I?r.moveTo(E,I):r.lineTo(E,I)}else if(8.5==tptypes[curTarget][n]){if(g=l=s=u=null,3==tplines[curTarget][n].length?(s=tplines[curTarget][n][1][0],u=tplines[curTarget][n][1][1],g=tplines[curTarget][n][2][0],l=tplines[curTarget][n][2][1]):2==tplines[curTarget][n].length?(s=tplines[curTarget][n][1][0],u=tplines[curTarget][n][1][1],g=e,l=t):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(s=e,u=t),z=tplines[curTarget][n][0][1],r.strokeStyle=asymcolor,r.dashedLine(5,z,targets[curTarget].imgwidth,z),r.beginPath(),r.strokeStyle="rgb(0,0,255)",null!=g&&g!=s)if(l==u)r.moveTo(0,l),r.lineTo(targets[curTarget].imgwidth,l);else if(0<(D=z-u)*(F=z-l)&&g!=s)for(W=safepow(F/D,1/(g-s)),T=F/safepow(W,g),r.moveTo(s,u),E=I=0;E<targets[curTarget].imgwidth+4;E+=3)(I=z-T*safepow(W,E))<-100&&(I=-100),I>targets[curTarget].imgheight+100&&(I=targets[curTarget].imgheight+100),0==E?r.moveTo(E,I):r.lineTo(E,I)}else if(8.6==tptypes[curTarget][n]){if(g=l=s=u=null,3==tplines[curTarget][n].length?(s=tplines[curTarget][n][1][0],u=tplines[curTarget][n][1][1],g=tplines[curTarget][n][2][0],l=tplines[curTarget][n][2][1]):2==tplines[curTarget][n].length?(s=tplines[curTarget][n][1][0],u=tplines[curTarget][n][1][1],g=e,l=t):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(s=e,u=t),Y=tplines[curTarget][n][0][0],r.strokeStyle=asymcolor,r.dashedLine(Y,5,Y,targets[curTarget].imgheight),r.beginPath(),r.strokeStyle="rgb(0,0,255)",null!=g&&g!=s&&l!=u&&0<(U=s-Y)*(X=g-Y))for(W=safepow(X/U,1/(l-u)),T=X/safepow(W,l),r.moveTo(s,u),I=E=0;I<targets[curTarget].imgheight+4;I+=3)(E=Y+T*safepow(W,I))<-100&&(E=-100),E>targets[curTarget].imgwidth+100&&(E=targets[curTarget].imgwidth+100),0==I?r.moveTo(E,I):r.lineTo(E,I)}else if(8.2==tptypes[curTarget][n]){if(s=u=null,2==tplines[curTarget][n].length?(s=tplines[curTarget][n][1][0],u=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(s=e,u=t),r.strokeStyle=asymcolor,r.dashedLine(5,tplines[curTarget][n][0][1],targets[curTarget].imgwidth,tplines[curTarget][n][0][1]),r.dashedLine(tplines[curTarget][n][0][0],5,tplines[curTarget][n][0][0],targets[curTarget].imgheight),r.beginPath(),r.strokeStyle="rgb(0,0,255)",null!=s&&s!=tplines[curTarget][n][0][0]&&u!=tplines[curTarget][n][0][1]){for(T=(u-tplines[curTarget][n][0][1])*(s-tplines[curTarget][n][0][0]),E=tplines[curTarget][n][0][0]-1;-4<E;E-=3)(I=T/(E-tplines[curTarget][n][0][0])+tplines[curTarget][n][0][1])<-100&&(I=-100),I>targets[curTarget].imgheight+100&&(I=targets[curTarget].imgheight+100),E==tplines[curTarget][n][0][0]-1?r.moveTo(E,I):r.lineTo(E,I);for(E=tplines[curTarget][n][0][0]+1;E<targets[curTarget].imgwidth+4;E+=3)(I=T/(E-tplines[curTarget][n][0][0])+tplines[curTarget][n][0][1])<-100&&(I=-100),I>targets[curTarget].imgheight+100&&(I=targets[curTarget].imgheight+100),E==tplines[curTarget][n][0][0]+1?r.moveTo(E,I):r.lineTo(E,I);r.stroke()}}else if((9==tptypes[curTarget][n]||9.1==tptypes[curTarget][n])&&(s=u=null,2==tplines[curTarget][n].length?(s=tplines[curTarget][n][1][0],u=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(s=e,u=t),null!=s&&s!=tplines[curTarget][n][0][0]))if(u==tplines[curTarget][n][0][1])r.moveTo(0,u),r.lineTo(targets[curTarget].imgwidth,u);else for(9==tptypes[curTarget][n]?(V=-1*Math.abs(u-tplines[curTarget][n][0][1])/2,Q=(u+tplines[curTarget][n][0][1])/2,T=Math.PI/Math.abs(s-tplines[curTarget][n][0][0]),G=u<tplines[curTarget][n][0][1]?s:tplines[curTarget][n][0][0]):9.1==tptypes[curTarget][n]&&(V=-1*Math.abs(u-tplines[curTarget][n][0][1]),Q=tplines[curTarget][n][0][1],T=.5*Math.PI/Math.abs(s-tplines[curTarget][n][0][0]),G=u<tplines[curTarget][n][0][1]?s:s+2*Math.abs(s-tplines[curTarget][n][0][0])),E=I=0;E<targets[curTarget].imgwidth+4;E+=3)I=V*Math.cos(T*(E-G))+Q,0==E?r.moveTo(E,I):r.lineTo(E,I);r.stroke(),r.beginPath()}for(null===curTPcurve&&tpHasAsymp.hasOwnProperty(targets[curTarget].mode)&&(r.strokeStyle="rgb(200,200,200)",8.5==targets[curTarget].mode?r.dashedLine(5,t,targets[curTarget].imgwidth,t):8.6==targets[curTarget].mode?r.dashedLine(e,5,e,targets[curTarget].imgwidth):8.2==targets[curTarget].mode?(r.dashedLine(5,t,targets[curTarget].imgwidth,t),r.dashedLine(e,5,e,targets[curTarget].imgheight)):7.4!=targets[curTarget].mode&&7.5!=targets[curTarget].mode||(r.dashedLine(e,t,targets[curTarget].imgwidth,t+(targets[curTarget].imgwidth-e)),r.dashedLine(e,t,targets[curTarget].imgwidth,t-(targets[curTarget].imgwidth-e)),r.dashedLine(e,t,0,t-e),r.dashedLine(e,t,0,t+e)),r.beginPath(),r.strokeStyle="rgb(0,0,255)"),r.fillStyle="rgba(0,0,255,.5)",n=0;n<lines[curTarget].length;n++){for(r.beginPath(),q=0;q<lines[curTarget][n].length;q++)0==q?(r.moveTo(lines[curTarget][n][q][0],lines[curTarget][n][q][1]),J=lines[curTarget][n][q][0],K=lines[curTarget][n][q][1]):(r.lineTo(lines[curTarget][n][q][0],lines[curTarget][n][q][1]),Z=lines[curTarget][n][q][0],ee=lines[curTarget][n][q][1]);if(n==curLine&&null!=e&&(r.lineTo(e,t),Z=e,ee=t),te=.02*targets[curTarget].imgwidth,1==drawlocky[curTarget]&&Z>.98*targets[curTarget].imgwidth?(r.moveTo(Z,ee),r.lineTo(Z-te,ee+te),r.moveTo(Z,ee),r.lineTo(Z-te,ee-te)):1==drawlocky[curTarget]&&J>.98*targets[curTarget].imgwidth&&(r.moveTo(J,K),r.lineTo(J-te,K+te),r.moveTo(J,K),r.lineTo(J-te,K-te)),1==drawlocky[curTarget]&&Z<.02*targets[curTarget].imgwidth?(r.moveTo(Z,ee),r.lineTo(Z+te,ee+te),r.moveTo(Z,ee),r.lineTo(Z+te,ee-te)):1==drawlocky[curTarget]&&J<.02*targets[curTarget].imgwidth&&(r.moveTo(J,K),r.lineTo(J+te,K+te),r.moveTo(J,K),r.lineTo(J+te,K-te)),r.stroke(),1<targets[curTarget].dotline){if(lines[curTarget][n].length-1<1)continue;if(Math.pow(Z-J,2)+Math.pow(ee-K,2)<25){for(r.moveTo(lines[curTarget][n][0][0],lines[curTarget][n][0][1]),q=1;q<lines[curTarget][n].length;q++)r.lineTo(lines[curTarget][n][q][0],lines[curTarget][n][q][1]);r.closePath(),r.fill()}}}for(r.fillStyle="rgb(0,0,255)",r.beginPath(),n=0;n<dots[curTarget].length;n++)r.moveTo(dots[curTarget][n][0]+5,dots[curTarget][n][1]),r.arc(dots[curTarget][n][0],dots[curTarget][n][1],5,0,2*Math.PI,!0);if(r.fill(),0<targets[curTarget].dotline){for(r.beginPath(),n=0;n<lines[curTarget].length;n++)for(q=0;q<lines[curTarget][n].length;q++)(0==q||25<Math.pow(lines[curTarget][n][q][0]-lines[curTarget][n][q-1][0],2)+Math.pow(lines[curTarget][n][q][1]-lines[curTarget][n][q-1][1],2))&&(r.moveTo(lines[curTarget][n][q][0]+5,lines[curTarget][n][q][1]),r.arc(lines[curTarget][n][q][0],lines[curTarget][n][q][1],5,0,2*Math.PI,!0));r.fill()}for(r.fillStyle="rgb(255,255,255)",r.beginPath(),n=0;n<odots[curTarget].length;n++)r.moveTo(odots[curTarget][n][0]+5,odots[curTarget][n][1]),r.arc(odots[curTarget][n][0],odots[curTarget][n][1],4,0,2*Math.PI,!0);for(targets[curTarget].mode<3?r.fill():r.stroke(),r.lineWidth=2,r.beginPath(),n=0;n<odots[curTarget].length;n++)r.moveTo(odots[curTarget][n][0]+5,odots[curTarget][n][1]),r.arc(odots[curTarget][n][0],odots[curTarget][n][1],4,0,2*Math.PI,!0);for(r.stroke(),n=0;n<tplines[curTarget].length;n++)if(tptypes[curTarget][n]==targets[curTarget].mode){for(r.fillStyle="rgb(255,0,0)",q=0;q<tplines[curTarget][n].length;q++)r.fillRect(tplines[curTarget][n][q][0]-3,tplines[curTarget][n][q][1]-3,6,6);tplines[curTarget][n].length<tpModeN[targets[curTarget].mode]&&null!=e&&curTPcurve==n&&r.fillRect(e-3,t-3,6,6),r.fillStyle="rgb(0,0,255)"}encodeDraw()}function deleteCurve(e,t){1==e?dots[curTarget].splice(t,1):2==e?odots[curTarget].splice(t,1):0<=e&&e<1?lines[curTarget].splice(t,1):5<=e&&e<10?(tplines[curTarget].splice(t,1),tptypes[curTarget].splice(t,1),curTPcurve=null):10<=e&&e<11&&(ineqlines[curTarget].splice(t,1),ineqtypes[curTarget].splice(t,1),curIneqcurve=null),drawTarget()}function encodeDraw(){var e,t,r,n,a,i,s="",g=[];for(e=0;e<lines[curTarget].length;e++)for(lines[curTarget][e].length,g=0==targets[curTarget].dotline?pathsimplify(lines[curTarget][e]):lines[curTarget][e],0!=e&&(s+=";"),t=0;t<g.length;t++)0!=t&&(s+=","),s+="("+g[t][0]+","+g[t][1]+")";for(s+=";;",e=0;e<dots[curTarget].length;e++)0!=e&&(s+=","),s+="("+dots[curTarget][e][0]+","+dots[curTarget][e][1]+")";for(s+=";;",e=0;e<odots[curTarget].length;e++)0!=e&&(s+=","),s+="("+odots[curTarget][e][0]+","+odots[curTarget][e][1]+")";for(s+=";;",r=[],n="",e=0;e<tplines[curTarget].length;e++)if(tplines[curTarget][e].length==tpModeN[tptypes[curTarget][e]]){for(n="("+tptypes[curTarget][e],t=0;t<tplines[curTarget][e].length;t++)n+=","+tplines[curTarget][e][t][0]+","+tplines[curTarget][e][t][1];r.push(n+")")}for(s+=r.join(","),s+=";;",a=[],e=0;e<ineqlines[curTarget].length;e++)2<ineqlines[curTarget][e].length&&a.push("("+ineqtypes[curTarget][e]+","+ineqlines[curTarget][e][0][0]+","+ineqlines[curTarget][e][0][1]+","+ineqlines[curTarget][e][1][0]+","+ineqlines[curTarget][e][1][1]+","+ineqlines[curTarget][e][2][0]+","+ineqlines[curTarget][e][2][1]+")");s+=a.join(","),targetOuts[curTarget].value!=s&&(i=""!=targetOuts[curTarget].value||";;;;;;;;"!=s,targetOuts[curTarget].value=s,i&&$(targetOuts[curTarget]).trigger("change"))}function drawMouseDown(e){var t,r,n,a;if(clickcnt++,clearAllDrawListners(),hasTouch&&1<e.originalEvent.touches.length)return didMultiTouch=!0,$(document).on("touchend.imathasdraw",drawMouseUp),!0;if(hasTouch?(window.clearTimeout(hasTouchTimer),$(document).off("mousemove.imathasdraw"),$(".drawcanvas").on("touchstart.imathasdraw",function(e){hasTouch=!0,drawMouseDown(e)}),$(".drawcanvas").on("touchmove.imathasdraw",drawMouseMove),$(document).on("touchend.imathasdraw",drawMouseUp),$(document).on("touchcancel.imathasdraw",drawMouseUp)):($(document).on("mousemove.imathasdraw",drawMouseMove),$(document).on("mouseup.imathasdraw",drawMouseUp)),t=mouseCoords(e),null==curTarget||null==curLine&&null==curTPcurve&&null==curIneqcurve)for(i in targets)if((r=getPosition(targets[i].el)).x<t.x&&r.x+targets[i].width>t.x&&r.y<t.y&&r.y+targets[i].height>t.y){curTarget=i;break}if(null!=curTarget)if(e.preventDefault(),mouseisdown=!0,r=getPosition(targets[curTarget].el),-1<(n={x:t.x-r.x,y:t.y-r.y}).x&&n.x<targets[curTarget].width&&-1<n.y&&n.y<targets[curTarget].height){if(0<targets[curTarget].snaptogridx&&(n=snaptogrid(n,curTarget)),1==drawlocky[curTarget]&&(n.y=targets[curTarget].imgheight/2),null!=(a=findnearpoint(curTarget,n))){if(-1==targets[curTarget].mode)return void deleteCurve(a[0],a[1]);null!=curLine&&a[0]<1&&curLine!=a[1]||null!=curTPcurve&5<=a[0]&&a[0]<10&&curTPcurve!=a[1]?a=null:null!=curIneqcurve&&10<=a[0]&&a[0]<11&&curIneqcurve!=a[1]&&(a=null)}null==a?(setCursor("pendown"),1==targets[curTarget].mode?(dots[curTarget].push([n.x,n.y]),dragObj={mode:1,num:dots[curTarget].length-1}):2==targets[curTarget].mode?(odots[curTarget].push([n.x,n.y]),dragObj={mode:2,num:odots[curTarget].length-1}):0==targets[curTarget].mode||.7==targets[curTarget].mode?null==curLine?(lines[curTarget].push([[n.x,n.y]]),curLine=lines[curTarget].length-1):lines[curTarget][curLine].push([n.x,n.y]):.5==targets[curTarget].mode?null==curLine?(lines[curTarget].push([[n.x,n.y]]),curLine=lines[curTarget].length-1):(lines[curTarget][curLine].push([n.x,n.y]),dragObj=curLine=null):5<=targets[curTarget].mode&&targets[curTarget].mode<10?null==curTPcurve?(tplines[curTarget].push([[n.x,n.y]]),curTPcurve=tplines[curTarget].length-1,tptypes[curTarget][curTPcurve]=targets[curTarget].mode,mouseisdown=!1):(tplines[curTarget][curTPcurve].push([n.x,n.y]),tplines[curTarget][curTPcurve].length==tpModeN[targets[curTarget].mode]&&(dragObj={mode:targets[curTarget].mode,num:curTPcurve,subnum:1},curTPcurve=null)):10<=targets[curTarget].mode&&targets[curTarget].mode<11&&(null==curIneqcurve?(ineqlines[curTarget].push([[n.x,n.y]]),curIneqcurve=ineqlines[curTarget].length-1,ineqtypes[curTarget][curIneqcurve]=targets[curTarget].mode,mouseisdown=!1):(ineqlines[curTarget][curIneqcurve].push([n.x,n.y]),2==ineqlines[curTarget][curIneqcurve].length?dragObj={mode:targets[curTarget].mode,num:curIneqcurve,subnum:1}:3==ineqlines[curTarget][curIneqcurve].length&&(dragObj={mode:targets[curTarget].mode,num:curIneqcurve,subnum:2},curIneqcurve=null)))):(0==a[0]||.5==a[0]?null==curLine?(setCursor("move"),dragObj={mode:targets[curTarget].mode,num:a[1],subnum:a[2]},oldpointpos=lines[curTarget][a[1]][a[2]],a[2]==lines[curTarget][a[1]].length-1&&0==targets[curTarget].mode?curLine=a[1]:0==a[2]&&0==targets[curTarget].mode&&(curLine=a[1],lines[curTarget][curLine].reverse(),dragObj.subnum=lines[curTarget][curLine].length-1)):a[1]==curLine&&a[2]==lines[curTarget][a[1]].length-1?(lines[curTarget][curLine].length<2&&lines[curTarget].splice(curLine,1),curLine=null):1<targets[curTarget].dotline&&a[1]==curLine&&0==a[2]?(lines[curTarget][curLine].push(lines[curTarget][curLine][0]),curLine=null):(setCursor("pendown"),lines[curTarget][curLine].push([n.x,n.y])):1==a[0]?(setCursor("move"),dragObj={mode:1,num:a[1]}):2==a[0]?(setCursor("move"),dragObj={mode:2,num:a[1]}):5<=a[0]&&a[0]<10?(setCursor("move"),dragObj={mode:a[0],num:a[1],subnum:a[2]},oldpointpos=tplines[curTarget][a[1]][a[2]]):10<=a[0]&&a[0]<11&&(setCursor("move"),dragObj={mode:a[0],num:a[1],subnum:a[2]},oldpointpos=ineqlines[curTarget][a[1]][a[2]]),clickmightbenewcurve=!0),drawTarget()}else null!=curLine&&(lines[curTarget][curLine].length<2&&lines[curTarget].splice(curLine,1),setCursor("pen")),null!=curTPcurve&&(tplines[curTarget][curTPcurve].length<tpModeN[targets[curTarget].mode]&&(tplines[curTarget].splice(curTPcurve,1),tptypes[curTarget].splice(curTPcurve,1)),setCursor("pen")),null!=curIneqcurve&&(ineqlines[curTarget][curIneqcurve].length<3&&(ineqlines[curTarget].splice(curIneqcurve,1),ineqtypes[curTarget].splice(curIneqcurve,1)),setCursor("pen")),dragObj=curIneqcurve=curTPcurve=curLine=null,drawTarget(),curTarget=null}function findnearpoint(e,t){var r,n,a;if(hasTouch?(r=Math.max(15*window.innerWidth/screen.width,15),r*=r):r=-1==targets[e].mode?50:25,0==targets[e].mode||.5==targets[e].mode||-1==targets[e].mode)for(n=0;n<lines[e].length;n++)for(a=lines[e][n].length-1;0<=a;a--)if(Math.pow(lines[e][n][a][0]-t.x,2)+Math.pow(lines[e][n][a][1]-t.y,2)<r)return[-1==targets[e].mode?0:targets[e].mode,n,a];if(1==targets[e].mode||-1==targets[e].mode)for(n=0;n<dots[e].length;n++)if(Math.pow(dots[e][n][0]-t.x,2)+Math.pow(dots[e][n][1]-t.y,2)<r)return[1,n];if(2==targets[e].mode||-1==targets[e].mode)for(n=0;n<odots[e].length;n++)if(Math.pow(odots[e][n][0]-t.x,2)+Math.pow(odots[e][n][1]-t.y,2)<r)return[2,n];if(5<=targets[e].mode&&targets[e].mode<10||-1==targets[e].mode)for(n=0;n<tplines[e].length;n++)for(a=tplines[e][n].length-1;0<=a;a--)if((tptypes[e][n]==targets[e].mode||-1==targets[e].mode)&&Math.pow(tplines[e][n][a][0]-t.x,2)+Math.pow(tplines[e][n][a][1]-t.y,2)<r)return[tptypes[e][n],n,a];if(10<=targets[e].mode&&targets[e].mode<11||-1==targets[e].mode)for(n=0;n<ineqlines[e].length;n++)for(a=ineqlines[e][n].length-1;0<=a;a--)if((ineqtypes[e][n]==targets[e].mode||-1==targets[e].mode)&&Math.pow(ineqlines[e][n][a][0]-t.x,2)+Math.pow(ineqlines[e][n][a][1]-t.y,2)<r)return[ineqtypes[e][n],n,a];return null}function drawMouseUp(e){var t,r,n,a=mouseCoords(e);mouseisdown=!1,null!=curTarget&&(t=getPosition(targets[curTarget].el),r={x:a.x-t.x,y:a.y-t.y},0<targets[curTarget].snaptogridx&&(r=snaptogrid(r,curTarget)),n=-1<r.x&&r.x<targets[curTarget].width&&-1<r.y&&r.y<targets[curTarget].height,1==clickmightbenewcurve&&(5<=targets[curTarget].mode&&targets[curTarget].mode<10?(tplines[curTarget].push([[r.x,r.y]]),curTPcurve=tplines[curTarget].length-1,tptypes[curTarget][curTPcurve]=targets[curTarget].mode):10<=targets[curTarget].mode&&targets[curTarget].mode<11&&(ineqlines[curTarget].push([[r.x,r.y]]),curIneqcurve=ineqlines[curTarget].length-1,ineqtypes[curTarget][curIneqcurve]=targets[curTarget].mode)),null!=lastdrawmouseup&&a.x==lastdrawmouseup.x&&a.y==lastdrawmouseup.y&&null!=curLine&&null==dragObj&&(lines[curTarget][curLine].length<2&&lines[curTarget].splice(curLine,1),dragObj=curLine=null,drawTarget()),null!=curLine&&null==dragObj&&(.5==targets[curTarget].mode&&1<lines[curTarget][curLine].length?(dragobj=curLine=null,drawTarget()):.7==targets[curTarget].mode&&(dragobj=curLine=null,drawTarget())),null!=curTPcurve&&1==tplines[curTarget][curTPcurve].length&&(didMultiTouch||!n?(tplines[curTarget].splice(curTPcurve,1),tptypes[curTarget].splice(curTPcurve,1),curTPcurve=null,drawTarget()):null==findnearpoint(curTarget,r)&&(tplines[curTarget][curTPcurve].push([r.x,r.y]),curTPcurve=null,drawTarget())),null!=curIneqcurve&&1==ineqlines[curTarget][curIneqcurve].length&&(didMultiTouch||!n?(ineqlines[curTarget].splice(curIneqcurve,1),ineqtypes[curTarget].splice(curIneqcurve,1),curIneqcurve=null,drawTarget()):null==findnearpoint(curTarget,r)&&(ineqlines[curTarget][curIneqcurve].push([r.x,r.y]),drawTarget())),setCursor(null==curLine&&null==curTPcurve?"move":"pen"),void 0!==e&&e.preventDefault()),lastdrawmouseup=a,null!=curTarget&&null!=dragObj&&(t=getPosition(targets[curTarget].el),-1<r.x&&r.x<targets[curTarget].width&&-1<r.y&&r.y<targets[curTarget].height?(0==dragObj.mode&&1<targets[curTarget].dotline&&(0!=dragObj.subnum&&dragObj.subnum!=lines[curTarget][dragObj.num].length-1||Math.pow(lines[curTarget][dragObj.num][0][0]-lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][0],2)+Math.pow(lines[curTarget][dragObj.num][0][1]-lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][1],2)<25&&(0==dragObj.subnum?(lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][0]=lines[curTarget][dragObj.num][0][0],lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][1]=lines[curTarget][dragObj.num][0][1]):(lines[curTarget][dragObj.num][0][0]=lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][0],lines[curTarget][dragObj.num][0][1]=lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][1]),curLine=null,drawTarget())),dragObj=null):(1==drawlocky[curTarget]&&(r.y=targets[curTarget].imgheight/2),1==dragObj.mode?dots[curTarget].splice(dragObj.num,1):2==dragObj.mode?odots[curTarget].splice(dragObj.num,1):.5==dragObj.mode?lines[curTarget].splice(dragObj.num,1):0==dragObj.mode?lines[curTarget][dragObj.num][dragObj.subnum]=oldpointpos:5<=dragObj.mode&&dragObj.mode<10?(tplines[curTarget].splice(dragObj.num,1),tptypes[curTarget].splice(dragObj.num,1),curTPcurve=null):10<=dragObj.mode&&dragObj.mode<11&&(ineqlines[curTarget].splice(dragObj.num,1),ineqtypes[curTarget].splice(dragObj.num,1),curIneqcurve=null),dragObj=null,drawTarget())),didMultiTouch=!1,hasTouch?hasTouchTimer=window.setTimeout(function(){hasTouch=!1,clearAllDrawListners(),$(document).on("mousemove.imathasdraw",drawMouseMove),$(".drawcanvas").on("touchstart.imathasdraw",function(e){hasTouch=!0,drawMouseDown(e)}),$(document).on("mousedown.imathasdraw",drawMouseDown)},350):(clearAllDrawListners(),$(document).on("mousemove.imathasdraw",drawMouseMove),$(".drawcanvas").on("touchstart.imathasdraw",function(e){hasTouch=!0,drawMouseDown(e)}),$(document).on("mousedown.imathasdraw",drawMouseDown))}function drawMouseMove(e){var t,r,n,a,s,g=null;for(i in clickmightbenewcurve=!1,t=mouseCoords(e),targets)if((r=getPosition(targets[i].el)).x<t.x&&r.x+targets[i].width>t.x&&r.y<t.y&&r.y+targets[i].height>t.y){g=i;break}if(null!=g?(r=getPosition(targets[mouseintarget=g].el),n={x:t.x-r.x,y:t.y-r.y},0<targets[g].snaptogridx&&(n=snaptogrid(n,g)),1==drawlocky[g]&&(n.y=targets[g].imgheight/2),-1<n.x&&n.x<targets[g].width&&-1<n.y&&n.y<targets[g].height&&null==dragObj&&null==curLine&&(null==(a=findnearpoint(g,n))?setCursor("pen",g):-1!=targets[g].mode&&setCursor("move",g))):null!=mouseintarget&&-1!=mouseintarget&&(null!=curTarget?drawTarget():(curTarget=mouseintarget,drawTarget(),curTarget=null),mouseintarget=-1),null!=curTarget){if(e.originalEvent.touches&&1<e.originalEvent.touches.length)return didMultiTouch=!0;if(void 0!==e&&e.preventDefault(),r=getPosition(targets[curTarget].el),n={x:t.x-r.x,y:t.y-r.y},0<targets[curTarget].snaptogridx&&(n=snaptogrid(n,curTarget)),1==drawlocky[curTarget]&&(n.y=targets[curTarget].imgheight/2),-1<n.x&&n.x<targets[curTarget].width&&-1<n.y&&n.y<targets[curTarget].height){if(null==dragObj){if(mouseisdown&&-1==targets[curTarget].mode)return void(null!=(a=findnearpoint(curTarget,n))&&deleteCurve(a[0],a[1]));null!=curLine?!mouseisdown||0!=targets[curTarget].mode&&.7!=targets[curTarget].mode?mouseisdown&&.5==targets[curTarget].mode?0==(s=lines[curTarget][curLine].length-1)?25<Math.pow(lines[curTarget][curLine][s][0]-n.x,2)+Math.pow(lines[curTarget][curLine][s][1]-n.y,2)?(lines[curTarget][curLine].push([n.x,n.y]),drawTarget()):drawTarget(n.x,n.y):(lines[curTarget][curLine][s]=[n.x,n.y],drawTarget()):drawTarget(n.x,n.y):(s=lines[curTarget][curLine].length-1,25<Math.pow(lines[curTarget][curLine][s][0]-n.x,2)+Math.pow(lines[curTarget][curLine][s][1]-n.y,2)?(lines[curTarget][curLine].push([n.x,n.y]),drawTarget()):drawTarget(n.x,n.y)):null!=curTPcurve||null!=curIneqcurve?mouseisdown?drawTarget():drawTarget(n.x,n.y):null==(a=findnearpoint(curTarget,n))?(setCursor("pen"),tpHasAsymp.hasOwnProperty(targets[curTarget].mode)&&null!==g&&drawTarget(n.x,n.y)):(drawTarget(),-1!=targets[curTarget].mode&&setCursor("move"))}else setCursor("move"),0==dragObj.mode||.5==dragObj.mode?lines[curTarget][dragObj.num][dragObj.subnum]=[n.x,n.y]:1==dragObj.mode?dots[curTarget][dragObj.num]=[n.x,n.y]:2==dragObj.mode?odots[curTarget][dragObj.num]=[n.x,n.y]:5<=dragObj.mode&&dragObj.mode<10?tplines[curTarget][dragObj.num][dragObj.subnum]=[n.x,n.y]:10<=dragObj.mode&&dragObj.mode<11&&(ineqlines[curTarget][dragObj.num][dragObj.subnum]=[n.x,n.y]),drawTarget();return!1}null==curIneqcurve||mouseisdown||drawTarget()}else null!=g&&-1!=mouseintarget&&(curTarget=g,tpHasAsymp.hasOwnProperty(targets[curTarget].mode)&&drawTarget(n.x,n.y),curTarget=null)}function setCursor(e,t){targets[t=t||curTarget].cursor!=e&&(targets[t].el.style.cursor="move"==e?e:"url("+imasroot+"/img/"+e+".cur), auto",targets[t].cursor=e)}function mouseCoords(e){var t,r,n,a,i;return e=e||window.event,hasTouch?{x:(t=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0]).pageX,y:t.pageY}:e.pageX||e.pageY?{x:e.pageX,y:e.pageY}:(r=document.documentElement,n=document.body,i=r&&(r.scrollTop||r.scrollLeft)?(a=r.scrollLeft,r.scrollTop):n?(a=n.scrollLeft,n.scrollTop):a=0,{x:e.clientX+a,y:e.clientY+i})}function snaptogrid(e,t){var r=e.x-targets[t].imgborder+targets[t].xmin*targets[t].pixperx,n=e.y-targets[t].imgborder-targets[t].ymax*targets[t].pixpery;return{x:r=Math.round(Math.round(r/(targets[t].pixperx*targets[t].snaptogridx))*targets[t].pixperx*targets[t].snaptogridx+targets[t].imgborder-targets[t].xmin*targets[t].pixperx),y:n=Math.round(Math.round(n/(targets[t].pixpery*targets[t].snaptogridy))*targets[t].pixpery*targets[t].snaptogridy+targets[t].imgborder+targets[t].ymax*targets[t].pixpery)}}function getMouseOffset(e,t){var r=getPosition(e),n=mouseCoords(t);return{x:n.x-r.x,y:n.y-r.y}}function getPosition(e){if(e.className.match(/hidden/))return{x:-1e4,y:-1e4};var t=$(e).offset();return{x:t.left,y:t.top}}function clearAllDrawListners(){$(document).off("mousedown.imathasdraw").off("mousemove.imathasdraw").off("mouseup.imathasdraw"),$(document).off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw"),$(".drawcanvas").off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw")}function initCanvases(e){var t,r,n,a;clearAllDrawListners(),$(document).on("mousemove.imathasdraw",drawMouseMove),$(".drawcanvas").on("touchstart.imathasdraw",function(e){hasTouch=!0,drawMouseDown(e)}),$(document).on("mousedown.imathasdraw",drawMouseDown);try{CanvasRenderingContext2D.prototype.dashedLine=function(e,t,r,n,a){var i,s,g,u,l,o;for(null==a&&(a=10),this.beginPath(),this.moveTo(e,t),s=n-t,u=(i=r-e)/(g=Math.sqrt(i*i+s*s)/a),l=s/g,g=Math.floor(g),o=0;o++<g&&-1<t&&t<targets[curTarget].imgheight+1&&-1<e&&e<targets[curTarget].imgwidth+1;)e+=u,t+=l,this[o%2==0?"moveTo":"lineTo"](e,t);this[o%2==0?"moveTo":"lineTo"](r,n),this.stroke(),this.closePath()}}catch(e){}for(t in canvases)if(void 0===e||e==t){if((r=null)!=drawla[t]&&2<drawla[t].length){if(lines[canvases[t][0]]=drawla[t][0],dots[canvases[t][0]]=drawla[t][1],odots[canvases[t][0]]=drawla[t][2],tptypes[canvases[t][0]]=[],tplines[canvases[t][0]]=[],3<drawla[t].length&&0<drawla[t][3].length)for(n=0;n<drawla[t][3].length;n++)for(tptypes[canvases[t][0]][n]=drawla[t][3][n][0],tplines[canvases[t][0]][n]=[],a=0;a<tpModeN[tptypes[canvases[t][0]][n]];a++)tplines[canvases[t][0]][n].push(drawla[t][3][n].slice(1+2*a,3+2*a));if(ineqtypes[canvases[t][0]]=[],ineqlines[canvases[t][0]]=[],4<drawla[t].length&&0<drawla[t][4].length)for(n=0;n<drawla[t][4].length;n++)ineqtypes[canvases[t][0]][n]=drawla[t][4][n][0],ineqlines[canvases[t][0]][n]=[drawla[t][4][n].slice(1,3),drawla[t][4][n].slice(3,5),drawla[t][4][n].slice(5)];5<drawla[t].length&&(r=drawla[t][5])}"a11ydraw"==canvases[t][1].substr(0,8)?addA11yTarget(canvases[t],r):addTarget(canvases[t][0],"canvas"+canvases[t][0],imasroot+"/filter/graph/imgs/"+canvases[t][1],"qn"+canvases[t][0],canvases[t][2],canvases[t][3],canvases[t][4],canvases[t][5],canvases[t][6],canvases[t][7],canvases[t][8],canvases[t][9],canvases[t][10],canvases[t][11],canvases[t][12])}}function addnormslider(e,t){-1==arraysearch(e,normslider.idnums)?(normslider.idnums.push(e),!0===t&&slideronpageload(e)):slideronpageload(e)}function slideronpageload(e){var t,r;for(r=0;r<normslider.idnums.length;r++)void 0!==e&&e!=normslider.idnums[r]||(initnormslider(t=normslider.idnums[r]),$("#slid1"+t).on("touchstart.normslider mousedown.normslider",onsliderstart),$("#slid2"+t).on("touchstart.normslider mousedown.normslider",onsliderstart))}function initnormslider(e){var t,r,n,a,i=document.getElementById("qn"+e).value;n=(a=i.match(/\(-oo,([\-\d\.]+)\)U\(([\-\d\.]+),oo\)/))?(t=3,r=a[1],a[2]):(a=i.match(/\(-oo,([\-\d\.]+)\)/))?(t=0,r=a[1],2.5):(a=i.match(/\(([\-\d\.]+),oo\)/))?(r=a[t=1],2.5):(a=i.match(/\(([\-\d\.]+),([\-\d\.]+)\)/))?(t=2,r=a[1],a[2]):(t=0,r=-1.5,2.5),document.getElementById("slid1"+e).style.left=60*r+250-6+"px",document.getElementById("slid2"+e).style.left=60*n+250-6+"px",document.getElementById("shaderegions"+e).selectedIndex=t,normslider.curslider.type=document.getElementById("shaderegions"+e).value,chgnormtype(e)}function onsliderstart(e){(e=e||window.event).originalEvent.touches&&0<e.originalEvent.touches.length?(hasTouch=!0,$(document).on("touchmove.normslider",onsliderchange),$(document).on("touchend.normslider",onsliderstop)):($(document).on("mousemove.normslider",onsliderchange),$(document).on("mouseup.normslider",onsliderstop)),normslider.curslider.el=e.target||e.srcElement,normslider.curslider.id=normslider.curslider.el.id.substring(5),normslider.curslider.type=document.getElementById("shaderegions"+normslider.curslider.id).value,normslider.curslider.outnode=document.getElementById(normslider.outputid),normslider.curslider.startpos=getMouseOffset(normslider.curslider.el,e),normslider.curslider.el.parentNode.style.cursor="pointer";getPosition(normslider.curslider.el.parentNode);return e.preventDefault&&e.preventDefault(),!1}function onsliderchange(e){var t,r,n=normslider.curslider.id;if(e=e||window.event,!((t=getMouseOffset(normslider.curslider.el.parentNode,e)).x<5||t.x>normslider.curslider.el.parentNode.offsetWidth-5||t.y<5||t.y>normslider.curslider.el.parentNode.offsetHeight-5))return r=6*Math.round((t.x-normslider.curslider.startpos.x-10)/6)+10,normslider.curslider.el.style.left=r+"px",normupdatevalues(n),e.preventDefault&&e.preventDefault(),!1}function onsliderstop(e){null!==normslider.curslider.el&&(hasTouch=!1,$(document).off("touchmove.normslider touchend.normslider"),$(document).off("mousemove.normslider mouseup.normslider"),normslider.curslider.el.parentNode.style.cursor="",normslider.curslider.el=null)}function normupdatevalues(e){var t,r,n,a,i,s,g,u=parseInt(document.getElementById("slid1"+e).style.left)+6,l=parseInt(document.getElementById("slid2"+e).style.left)+6,o=Math.min(u,l),c=Math.max(u,l);"2O"==normslider.curslider.type?document.getElementById("normleft"+e).style.width=o+1+"px":"1L"==normslider.curslider.type?document.getElementById("normleft"+e).style.width=u+1+"px":"2B"==normslider.curslider.type&&(document.getElementById("normleft"+e).style.left=o+"px",document.getElementById("normleft"+e).style.width=c-o+1+"px"),"2O"==normslider.curslider.type?document.getElementById("normright"+e).style.width=500-c+"px":"1R"==normslider.curslider.type&&(document.getElementById("normright"+e).style.width=500-u+"px"),t=((u-10)/60-4).toFixed(1),r=((l-10)/60-4).toFixed(1),(n=document.getElementById("slid1txt"+e)).innerHTML=t,n.style.left=u-6+"px",(a=document.getElementById("slid2txt"+e)).innerHTML=r,a.style.left=l-6+"px",i=Math.min(t,r),s=Math.max(t,r),"2O"==normslider.curslider.type?g="(-oo,"+i+")U("+s+",oo)":"2B"==normslider.curslider.type?g="("+i+","+s+")":"1L"==normslider.curslider.type?g="(-oo,"+t+")":"1R"==normslider.curslider.type&&(g="("+t+",oo)"),document.getElementById("qn"+e).value=g}function chgnormtype(e){var t,r,n,a,i=document.getElementById("shaderegions"+e).value;normslider.curslider.type=i,t=parseInt(document.getElementById("slid1"+e).style.left)+6,r=parseInt(document.getElementById("slid2"+e).style.left)+6,n=Math.min(t,r),a=Math.max(t,r),"1R"==i||"1L"==i?(document.getElementById("slid2"+e).style.display="none",document.getElementById("slid2txt"+e).style.display="none","1R"==i?(document.getElementById("normleft"+e).style.display="none",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normright"+e).style.width=500-t+"px"):(document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.display="",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normleft"+e).style.width=t+"px")):"2O"==i?(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normright"+e).style.width=500-a+"px",document.getElementById("normleft"+e).style.width=n+"px"):"2B"==i&&(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.left=n+"px",document.getElementById("normleft"+e).style.width=a-n+"px"),normupdatevalues(e)}function dashedParabola(e,t,r,n,a,i,s){var g,u,l,o,c,d,T,p,h,m,y,w,f;if(a==r)e.moveTo(0,a),e.dashedLine(0,a,i,a);else{for(l=0,r<a&&(l=s),o=(g=(a-r)/((n-t)*(n-t)))*t*t+r-l,d=(-(u=-2*g*t)-(c=Math.sqrt(u*u-4*g*o)))/(2*g),o+=l,(T=(-u+c)/(2*g))<d&&(p=d,d=T,T=p),m=(h=8)*h,y=t,w=r,f=0;d-5<y&&-5<y;)f%2==0?e.moveTo(y,w):e.lineTo(y,w),w=g*(y-=Math.min(Math.sqrt(m/(1+Math.pow(2*g*(y-t),2))),Math.sqrt(h/Math.abs(g))))*y+u*y+o,f++;for(y=t,w=r,f=0;y<T+5&&y<i+5;)f%2==0?e.moveTo(y,w):e.lineTo(y,w),w=g*(y+=Math.min(Math.sqrt(m/(1+Math.pow(2*g*(y-t),2))),Math.sqrt(h/Math.abs(g))))*y+u*y+o,f++}e.stroke()}function shadeParabola(e,t,r,n,a,i,s,g,u){var l,o,c,d,T,p,h,m,y,w,f,v,b,q,x,M;e.beginPath(),a==r?(e.moveTo(0,a),e.lineTo(g,a),s<r?(e.lineTo(g,0),e.lineTo(0,0)):(e.lineTo(g,u),e.lineTo(0,u))):(c=0,r<a&&(c=u),d=(l=(a-r)/((n-t)*(n-t)))*t*t+r-c,h=l*(p=(-(o=-2*l*t)-(T=Math.sqrt(o*o-4*l*d)))/(2*l))*p+o*p+(d+=c),(m=(-o+T)/(2*l))<p&&(w=p,p=m,m=w),x=(f=2*l*(p-t))*(q=((v=(y=h)-f*p)-(y-(b=-f)*m))/(b-f))+v,l<0&&s<l*i*i+o*i+d||0<l&&l*i*i+o*i+d<s?(e.moveTo(p,h),e.quadraticCurveTo(q,x,m,y)):(M=u,Math.abs(h-u)<2&&(M=0),e.moveTo(0,h),e.lineTo(p,h),e.quadraticCurveTo(q,x,m,y),e.lineTo(g,y),e.lineTo(g,M),e.lineTo(0,M))),e.closePath()}return clickcnt=0,lastdrawmouseup=null,mouseintarget=-1,"undefined"!=typeof initstack?initstack.push(initCanvases):$(function(){initCanvases()}),normslider={idnums:[],curslider:{el:null,startpos:[0,0],outnode:null}},"undefined"!=typeof initstack&&initstack.push(slideronpageload),drawexport={reset:reset,initCanvases:initCanvases,clearcanvas:clearcanvas,clearlastline:clearlastline,settool:settool,addnormslider:addnormslider,chgnormtype:chgnormtype,adda11ydraw:adda11ydraw,changea11ydraw:changea11ydraw,encodea11ydraw:encodea11ydraw,removea11ydraw:removea11ydraw},drawexport}(jQuery);!function(){"use strict";function a(e,t){var r=e.length-1,n=[e[0]];return function e(t,r,n,a,i){var s,g,u,l,o,c,d,T,p,h,m,y=a;for(g=r+1;g<n;g++)l=t[g],o=t[r],c=t[n],m=h=p=T=d=void 0,T=o[0],p=o[1],h=c[0]-T,m=c[1]-p,0===h&&0===m||(1<(d=((l[0]-T)*h+(l[1]-p)*m)/(h*h+m*m))?(T=c[0],p=c[1]):0<d&&(T+=h*d,p+=m*d)),y<(u=(h=l[0]-T)*h+(m=l[1]-p)*m)&&(s=g,y=u);a<y&&(1<s-r&&e(t,r,s,a,i),i.push(t[s]),1<n-s&&e(t,s,n,a,i))}(e,0,r,t,n),n.push(e[r]),n}window.pathsimplify=function(e,t,r){if(e.length<=2)return e;var n=void 0!==t?t*t:1;return e=a(e=r?e:function(e,t){var r,n,a,i,s,g,u,l=e[0],o=[l];for(n=1,a=e.length;n<a;n++)r=e[n],s=l,0,g=(i=r)[0]-s[0],u=i[1]-s[1],t<g*g+u*u&&(o.push(r),l=r);return l!==r&&o.push(r),o}(e,n),n)}}();
var AutoSuggestIdCounter,autoSuggestLists,autoSuggestObjects,initstack=[],loadedscripts=[],callbackstack={},imathasAssess=function($){var LivePreviews,MQsyntaxtimer,greekletters,onlyAscii,allParams={};function clearparams(e){var t;for(t in e)delete allParams[t]}function init(e,t){var a,i,r,n,s,c;for(a in e)if(!isNaN(parseInt(a))){if(allParams[a]=e[a],(i=e[a]).helper&&i.qtype.match(/^(calc|numfunc|string|interval)/)&&(n=document.getElementById("qn"+a),s=i.qtype,i.calcformat&&(s+=","+i.calcformat),i.displayformat&&(s+=","+i.displayformat),i.matrixsize?(s+=",matrixsized",$("input[id^=qn"+a+"-]").attr("data-mq",s)):n.setAttribute("data-mq",s),i.vars&&n.setAttribute("data-mq-vars",i.vars),t&&(i.matrixsize?MQeditor.toggleMQAll("input[id^=qn"+a+"-]",!0,!0):MQeditor.toggleMQ(n,!0,!0),$("#pbtn"+a).hide())),i.preview&&(c=a,document.getElementById("pbtn"+a).addEventListener("click",function(){showPreview(c)}),i.qtype.match(/matrix/)||(LivePreviews.hasOwnProperty(a)&&delete LivePreviews[a],setupLivePreview(a,t),document.getElementById("qn"+a).addEventListener("keyup",updateLivePreview),t&&showSyntaxCheckMQ(a))),"debit"===i.format?document.getElementById("qn"+a).addEventListener("keyup",editdebit):"credit"===i.format?(document.getElementById("qn"+a).addEventListener("keyup",editcredit),initcreditboxes()):"normslider"===i.format&&imathasDraw.addnormslider(a,!0),i.autosuggest&&(!autoSuggestLists.hasOwnProperty(i.autosuggest)&&i.hasOwnProperty(i.autosuggest)&&(autoSuggestLists[i.autosuggest]=i[i.autosuggest]),autoSuggestLists.hasOwnProperty(i.autosuggest)&&(autoSuggestObjects[a]=new AutoSuggest(document.getElementById("qn"+a),autoSuggestLists[i.autosuggest]))),i.tip)if(n=document.getElementById("qn"+a+"-0"))for(r=0;document.getElementById("qn"+a+"-"+r);)setupTips("qn"+a+"-"+r,i.tip,i.longtip),r++;else setupTips("qn"+a,i.tip,i.longtip);"draw"===i.qtype&&setupDraw(a),"file"===i.qtype&&initFileAlt(document.getElementById("qn"+a)),"multans"===i.qtype&&initMultAns(a),i.usetinymce&&initeditor("textareas","mceEditor"),initEnterHandler(a)}if(initShowAnswer2(),initqsclickchange(),initClearScoreMarkers(),e.scripts){!function e(t,a){var i;if("code"==t[a][0]){try{window.eval(t[a][1])}catch(e){console.log("Error executing question script:"+t[a][1])}t.length>a+1&&e(t,a+1)}else-1==loadedscripts.indexOf(t[a][1])?jQuery.getScript(t[a][1]).always(function(){loadedscripts.push(t[a][1]),t.length>a+1&&e(t,a+1)}):t.length>a+1&&e(t,a+1);if(t.length<=a+1){for(i=0;i<initstack.length;i++)initstack[i]();initstack.length=0}}(e.scripts,0)}}function setupTips(e,t,a){var i,r=document.getElementById(e);r.setAttribute("data-tip",t),i=e.substr(2).split(/-/)[0],document.getElementById("tips"+i)||$("body").append($("<div>",{class:"hidden",id:"tips"+i}).html(a)),r.setAttribute("aria-label",t),r.setAttribute("aria-describedby","tips"+i),r.addEventListener("focus",function(){showehdd(e,t,i)}),r.addEventListener("blur",hideeh),r.addEventListener("click",function(){reshrinkeh(e)})}function clearTips(){hideAllEhTips()}function initqsclickchange(){$("input[id^=qs][value=spec]").each(function(e,t){$(t).siblings("input[type=text]").off("keyup.qsclickchange").on("keyup.qsclickchange",function(e){8!=e.keyCode&&46!=e.keyCode&&$(t).prop("checked",!0)})})}function clearScoreMarkers(e){var t,a,i=e.currentTarget;null!==(t=i.className.match(/(ansgrn|ansred|ansyel)/))?($(i).removeClass(t[0]),"hidden"==i.type&&$("#mqinput-"+i.id).removeClass(t[0])):0<(a=$(i).closest("[id^=qnwrap]")).length&&null!==(t=a[0].className.match(/(ansgrn|ansred|ansyel)/))&&(a.removeClass(t[0]),a.find(".scoremarker").remove())}function initClearScoreMarkers(){$("input[id^=qn]").off("input.clearmarkers").on("input.clearmarkers",clearScoreMarkers),$("input[id^=qs],select[id^=qn]").off("change.clearmarkers").on("change.clearmarkers",clearScoreMarkers)}function initEnterHandler(e){$("input[type=text][name=qn"+e+"]").off("keydown.enterhandler").on("keydown.enterhandler",function(e){if(13==e.which){e.preventDefault();var t=$(this).closest(".questionwrap").find(".submitbtnwrap .primary");t.is(":disabled")||t.trigger("click")}})}function handleMQenter(e){var t=$("#"+e).closest(".questionwrap").find(".submitbtnwrap .primary");t.is(":disabled")||t.trigger("click")}function initShowAnswer2(){$("input.sabtn + span.hidden, input.sabtn + div.hidden").each(function(e,t){var a,i,r,n,s,c=t.id.substring(3),l=c;if(-1!==l.indexOf("-")&&(l=1e3*(+(a=l.split("-"))[0]+1)+ +a[1]),i=$("<span>",{class:"keywrap"}).append($("<button>",{type:"button","aria-controls":"ans"+c,"aria-expanded":"false",class:"keybtn","aria-label":_("View Key"),title:_("View Key")}).on("click",function(e){var t="true"==e.currentTarget.getAttribute("aria-expanded");e.currentTarget.setAttribute("aria-expanded",t?"false":"true"),$("#ans"+c).toggle(!t)}).html('<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>')),0<$(t).closest(".autoshowans").length){if(0<(r=$("#qnwrap"+l)).length)return $(t).prev(".sabtn").remove(),i.append($(t).hide().removeClass("hidden")).addClass("inwrap"),void r.append(i);if(0<(n=$("#mqinput-qn"+l+",input[type=text]#qn"+l+",select#qn"+l)).length)return $(t).prev(".sabtn").remove(),i.append($(t).hide().removeClass("hidden")),void n.after(i)}s=$(t).parent(),i.append($(t).hide().removeClass("hidden")),s.empty().append(i)}),$("input.dsbtn + div.hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),$("input.dsbtn").each(function(){var e=$(this).siblings("div:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",e).off("click.sashow").on("click.sashow",function(){$(this).attr("aria-expanded",!0).siblings("div:first-of-type").attr("aria-expanded",!0).attr("aria-hidden",!1).removeClass("hidden")})})}function initShowAnswer(){$("input.sabtn + span.hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),$("input.sabtn").each(function(){var e=$(this).siblings("span:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",e).off("click.sashow").on("click.sashow",function(){$(this).attr("aria-expanded",!0).siblings("span:first-of-type").attr("aria-expanded",!0).attr("aria-hidden",!1).removeClass("hidden")})}),$("input.dsbtn + div.hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),$("input.dsbtn").each(function(){var e=$(this).siblings("div:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",e).off("click.sashow").on("click.sashow",function(){$(this).attr("aria-expanded",!0).siblings("div:first-of-type").attr("aria-expanded",!0).attr("aria-hidden",!1).removeClass("hidden")})})}function setupDraw(e){var t,a,i=document.getElementById("qn"+e).value,r=i.split(";;"),n=[];for(t=0;t<r.length;t++)if(5==t?r[t]="["+r[t].replace(/&quot;/g,'"')+"]":(r[t]="["+r[t].replace(/\(/g,"[").replace(/\)/g,"]")+"]",0==t&&2<r[t].length&&(r[t]="["+r[t].replace(/;/g,"],[")+"]")),""===r[t])n[t]=[];else try{n[t]=JSON.parse(r[t])}catch(e){n[t]=[]}window.drawla[e]=n,window.canvases[e]=allParams[e].canvas,imathasDraw.initCanvases(e),document.getElementById("drawtools"+e).addEventListener("click",function(e){var t,a,i,r=e.target;r.hasAttribute("data-drawaction")&&(t=r.getAttribute("data-drawaction"),a=r.getAttribute("data-qn"),"clearcanvas"===t?imathasDraw.clearcanvas(a):"settool"===t&&(i=r.getAttribute("data-val"),imathasDraw.settool(r,a,i)))}),(a=document.getElementById("qn"+e).parentNode.querySelector(".a11ydrawadd"))&&a.addEventListener("click",function(e){var t=e.target.getAttribute("data-qn");imathasDraw.adda11ydraw(t)})}function initMultAns(e){var t,a=$("#qnwrap"+e).find("label:last").text().match(/none\s+of/i);a&&(t=$('input[name^="qn'+e+'["]')).on("change",function(){this.checked&&this.value==t.length-1?t.not(":last").prop("checked",!1):this.checked&&t.last().prop("checked",!1)})}function isBlank(e){return!e||0===e.length||/^\s*$/.test(e)}function editdebit(e){var t=e.target,a=$("#qn"+(t.id.substr(2)-1));!isBlank(t.value)&&a.hasClass("iscredit")&&(a.css("padding-left"),a.is("select")?a.css("margin-right",20):a.width(""),a.css("padding-left",""),a.removeClass("iscredit"))}function editcredit(e){var t,a=e.target,i=$("#qn"+(a.id.substr(2)-2));isBlank(a.value)||i.hasClass("iscredit")||(t=parseInt(i.css("padding-left")),i.is("select")?i.css("margin-right",0):i.width(i.width()-20),i.css("padding-left",20+t),i.addClass("iscredit"))}function initcreditboxes(){$(".creditbox").each(function(e,t){editcredit({target:t})})}function setupLivePreview(i,e){LivePreviews.hasOwnProperty(i)||("MathJax"==mathRenderer||"Katex"==mathRenderer?(LivePreviews[i]={delay:"MathJax"==mathRenderer?100:0,finaldelay:1e3,preview:null,buffer:null,timeout:null,finaltimeout:null,mjRunning:!1,mjPending:!1,oldText:null,Init:function(e){$("#p"+i).css("positive","relative").append('<span id="lpbuf1'+i+'" style="visibility:hidden;position:absolute;"></span>').append('<span id="lpbuf2'+i+'" style="visibility:hidden;position:absolute;"></span>'),this.preview=document.getElementById("lpbuf1"+i),this.buffer=document.getElementById("lpbuf2"+i),e||showPreview(i)},SwapBuffers:function(){var e=this.preview,t=this.buffer;this.buffer=e,this.preview=t,e.style.visibility="hidden",e.style.position="absolute",t.style.position="",t.style.visibility=""},Update:function(e){this.timeout&&clearTimeout(this.timeout),this.finaltimeout&&clearTimeout(this.finaltimeout),this.timeout=setTimeout(this.callback,this.delay),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(e){this.buffer.innerHTML=this.oldtext=e,this.mjRunning=!0,this.RenderBuffer()},RenderBuffer:function(){"MathJax"==mathRenderer?MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.buffer],["PreviewDone",this]):"Katex"==mathRenderer&&(renderMathInElement(this.buffer),"undefined"!=typeof MathJax&&MathJax.version&&0<$(this.buffer).children(".mj").length?MathJax.Hub.Queue(["PreviewDone",this]):this.PreviewDone())},DoFinalPreview:function(){$("#pbtn"+i).trigger("click")},preformat:function(e){var t=allParams[i].qtype,a=allParams[i].calcformat;return preformat(i,e,t,a)},CreatePreview:function(){if(this.timeout=null,!this.mjPending){var e=document.getElementById("qn"+i).value;e!==this.oldtext&&(this.mjRunning?(this.mjPending=!0,MathJax.Hub.Queue(["CreatePreview",this])):(this.oldtext=e,this.buffer.innerHTML="`"+this.preformat(e)+"`",this.mjRunning=!0,this.RenderBuffer()))}},PreviewDone:function(){this.mjRunning=this.mjPending=!1,this.SwapBuffers(),updateehpos()}},"undefined"!=typeof MathJax?(LivePreviews[i].callback=MathJax.Callback(["CreatePreview",LivePreviews[i]]),LivePreviews[i].callback.autoReset=!0):LivePreviews[i].callback=function(){LivePreviews[i].CreatePreview()},LivePreviews[i].Init(e)):LivePreviews[i]={finaldelay:1e3,finaltimeout:null,Update:function(e){this.finaltimeout&&clearTimeout(this.finaltimeout),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(e){var t=document.getElementById("p"+i);t.innerHTML=e,rendermathnode(t)},DoFinalPreview:function(){$("#pbtn"+i).trigger("click")}})}function updateLivePreview(e){var t=e.target.id.substr(2);setupLivePreview(t),LivePreviews[t].Update()}function clearLivePreviewTimeouts(){for(var e in LivePreviews)clearTimeout(LivePreviews[e].finaltimeout)}function normalizemathunicode(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/[\x00-\x09\x0B\x0C\x0E-\x1F\x7F]/g,"")).replace(/\u2013|\u2014|\u2015|\u2212/g,"-")).replace(/\u2044|\u2215/g,"/")).replace(/∞/g,"oo").replace(/≤/g,"<=").replace(/≥/g,">=").replace(/∪/g,"U")).replace(/±/g,"+-").replace(/÷/g,"/").replace(/·|✕|×|⋅/g,"*")).replace(/√/g,"sqrt").replace(/∛/g,"root(3)")).replace(/²/g,"^2").replace(/³/g,"^3")).replace(/\u2329/g,"<").replace(/\u232a/g,">")).replace(/₀/g,"_0").replace(/₁/g,"_1").replace(/₂/g,"_2").replace(/₃/g,"_3")).replace(/\bOO\b/i,"oo")).replace(/θ/,"theta").replace(/ϕ/,"phi").replace(/φ/,"phi").replace(/π/,"pi").replace(/σ/,"sigma").replace(/μ/,"mu")).replace(/α/,"alpha").replace(/β/,"beta").replace(/γ/,"gamma").replace(/δ/,"delta").replace(/ε/,"epsilon").replace(/κ/,"kappa")).replace(/λ/,"lambda").replace(/ρ/,"rho").replace(/τ/,"tau").replace(/χ/,"chi").replace(/ω/,"omega")).replace(/Ω/,"Omega").replace(/Γ/,"Gamma").replace(/Φ/,"Phi").replace(/Δ/,"Delta").replace(/Σ/,"Sigma")}function showPreview(e){var t,a=allParams[e],i="",r=processByType(e);r.str&&(i="`"+r.str+"`"),r.dispvalstr&&""!=r.dispvalstr&&-1!=a.calcformat.indexOf("showval")&&(i+=(""==i?"":" = ")+"`"+r.dispvalstr+"`"),r.err&&""!=r.err&&""!=r.str&&(i+="``"==i?"":". <span class=noticetext>"+r.err+"</span>"),LivePreviews.hasOwnProperty(e)?LivePreviews[e].RenderNow(i):((t=document.getElementById("p"+e)).innerHTML=i,rendermathnode(t))}function syntaxCheckMQ(e,t){clearTimeout(MQsyntaxtimer);var a=parseInt(e.replace(/\D/g,""));MQsyntaxtimer=setTimeout(function(){showSyntaxCheckMQ(a)},1e3)}function showSyntaxCheckMQ(e){var t,a=processByType(e),i="";a.err&&""!=a.err&&""!=a.str&&(i+="<span class=noticetext>"+a.err+"</span>"),LivePreviews.hasOwnProperty(e)?((t=document.getElementById("p"+e).firstChild).innerHTML=i,t.style.visibility="",t.style.position=""):(t=document.getElementById("p"+e)).innerHTML=i}function preSubmitForm(e){var t,a,i,r;for(a in allParams)!1!==(t=preSubmit(a))&&((i=document.getElementById("qn"+a+"-val"))?i.value=t:((r=document.createElement("input")).type="hidden",r.name="qn"+a+"-val",r.value=t,e.appendChild(r)))}function preSubmit(e){var t=processByType(e);return!!t.submitstr&&t.submitstr}function preSubmitString(e,t){var a,i=parseInt(e.substr(2));return allParams.hasOwnProperty(i)&&(a=allParams[i],t=(t=normalizemathunicode(t)).replace(/^\s+/,"").replace(/\s+$/,""),"numfunc"==a.qtype&&(t=AMnumfuncPrepVar(i,t)[3])),t}function processByType(e){var t,a,i,r;if(!allParams.hasOwnProperty(e))return!1;if(a={},"draw"==(t=allParams[e]).qtype)return imathasDraw.encodea11ydraw(),{};if("choices"==t.qtype||"multans"==t.qtype||"matching"==t.qtype)return{};if(t.hasOwnProperty("matrixsize"))a=processSizedMatrix(e);else{if(!(i=document.getElementById("qn"+e)))return!1;if((r=(r=normalizemathunicode(r=i.value)).replace(/^\s+/,"").replace(/\s+$/,"")).match(/^\s*$/))return{str:"",displvalstr:"",submitstr:""};if(r.match(/^\s*DNE\s*$/i))return{str:"DNE",displvalstr:"",submitstr:"DNE"};if(r.match(/^\s*oo\s*$/i))return{str:"oo",displvalstr:"",submitstr:"oo"};if(r.match(/^\s*-oo\s*$/i))return{str:"-oo",displvalstr:"",submitstr:"-oo"};switch(t.qtype){case"calculated":a=processCalculated(r,t.calcformat);break;case"interval":case"calcinterval":a=processCalcInterval(r,t.calcformat,t.vars);break;case"calcntuple":a=processCalcNtuple(r,t.calcformat);break;case"calccomplex":a=processCalcComplex(r,t.calcformat);break;case"calcmatrix":a=processCalcMatrix(r,t.calcformat);break;case"numfunc":a=processNumfunc(e,r,t.calcformat);break;case"matrix":(a=processCalcMatrix(r,"")).dispvalstr=""}a.str=preformat(e,r,t.qtype,t.calcformat)}return a}function preformat(e,t,a,i){return t=normalizemathunicode(t),a.match(/interval/)?i.match(/inequality/)?(t=t.replace(/<=/g," le ").replace(/>=/g," ge ").replace(/</g," lt ").replace(/>/g," gt ")).match(/all\s*real/i)&&(t="text("+t+")"):t=t.replace(/U/g,"uu"):"numfunc"==a?t=AMnumfuncPrepVar(e,t)[1]:"calcntuple"==a?t=t.replace(/<+/g,"(:").replace(/>+/g,":)"):"calculated"==a&&(-1==i.indexOf("list")&&-1==i.indexOf("set")&&(t=t.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),-1!=i.indexOf("scinot")&&(t=t.replace(/(x|X|\u00D7)/,"xx"))),t=t.replace(/[^\u0000-\u007f]/g,"?")}function AMnumfuncPrepVar(e,t){var i,a,r,n,s,c,l,o,d,u,h,p=allParams[e].vars.slice(),g=p.join("|"),m=allParams[e].fvars.join("|");for(p.push("DNE"),g.match(/lambda/)&&(t=t.replace(/lamda/,"lambda")),i=[],a=(a=t).replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root)/g,functoindex),t=t.replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root)/g,functoindex),r=0;r<p.length;r++)if("varE"==p[r])t=t.replace("E","varE"),a=a.replace("E","varE");else for(i[r]=!1,n=0;n<p.length;n++)if(r!=n&&p[n].toLowerCase()==p[r].toLowerCase()&&p[n]!=p[r]){i[r]=!0;break}for(t=(t=t.replace(new RegExp("("+g+")","gi"),function(e,t){for(var a=0;a<p.length;a++)if(p[a]==t||!i[a]&&p[a].toLowerCase()==t.toLowerCase())return"@v"+a+"@"})).replace(/@v(\d+)@/g,function(e,t){return p[t]}),a=(a=(a=a.replace(new RegExp("("+g+")","gi"),function(e,t){for(var a=0;a<p.length;a++)if(p[a]==t||!i[a]&&p[a].toLowerCase()==t.toLowerCase())return"@v"+a+"@"})).replace(/(@v(\d+)@|\d+(\.\d+)?)!/g,"{:$&:}")).replace(/@v(\d+)@/g,function(e,t){return p[t]}),s=t,c=new Array,r=0;r<p.length;r++)1<p[r].length&&(o=!1,-1!=greekletters.indexOf(p[r].toLowerCase())&&(o=!0),p[r].match(/^\w+_\w+$/)?(l=i[r]?"g":"gi",d=new RegExp(/^(\w+)_(\w+)$/,l).exec(p[r]),u=new RegExp(d[1]+"_\\("+d[2]+"\\)",l),a=a.replace(u,p[r]),t=t.replace(u,p[r]),s=s.replace(u,p[r]),1<d[1].length&&-1==greekletters.indexOf(d[1].toLowerCase())&&(d[1]='"'+d[1]+'"'),1<d[2].length&&-1==greekletters.indexOf(d[2].toLowerCase())&&(d[2]='"'+d[2]+'"'),a=a.replace(new RegExp(d[0],l),d[1]+"_"+d[2]),t=t.replace(new RegExp(d[0],"g"),"repvars"+r),p[r]="repvars"+r):o||"varE"==p[r]||c.push(p[r]));return 0<c.length&&(vltq=c.join("|"),h=new RegExp("("+vltq+")","g"),a=a.replace(h,'"$1"')),a=(a=a.replace("varE","E")).replace(/@(\d+)@/g,indextofunc),t=t.replace(/@(\d+)@/g,indextofunc),s=s.replace(/@(\d+)@/g,indextofunc),g.match(/\bf\b/)&&!m.match(/\bf\b/)&&(a=(a=a.replace(/([^a-zA-Z])f\^([\d\.]+)([^\d\.])/g,"$1f^$2{::}$3")).replace(/([^a-zA-Z])f\(/g,"$1f{::}(")),g.match(/\bg\b/)&&!m.match(/\bg\b/)&&(a=(a=a.replace(/([^a-zA-Z])g\^([\d\.]+)([^\d\.])/g,"$1g^$2{::}$3")).replace(/([^a-zA-Z])g\(/g,"$1g{::}(")),[t,a,p.join("|"),s]}function processCalculated(e,t){var a,i,r,n,s,c;for(e=e.replace(/=/,""),a=-1!=t.indexOf("list")?e.split(/,/):-1!=t.indexOf("set")?e.replace(/[\{\}]/g,"").split(/,/):[e],i="",n=[],s=0;s<a.length;s++)str=a[s],i+=singlevalsyntaxcheck(str,t),i+=syntaxcheckexpr(str,t),i+=(r=singlevaleval(str,t))[1],n.push(r[0]);return c=n.join(", "),-1!=t.indexOf("set")&&(c="{"+c+"}"),{err:i,dispvalstr:c,submitstr:n.join(",")}}function processCalcInterval(e,t,a){var r,n,s,c,l,o,d,u,h,p,g,m;if(-1!=t.indexOf("inequality")){if(1<(r=ineqtointerval(e=e.replace(/or/g," or "),a)).length)return{err:"wrongvar"==r[1]?_("you may have used the wrong variable"):_("invalid inequality notation")};e=r[0]}if(n=[],s=[],c=[],l="U",-1!=t.indexOf("list")){for(l=",",o=0,d=1;d<e.length-1;d++)","==e.charAt(d)&&(")"!=e.charAt(d-1)&&"]"!=e.charAt(d-1)||"("!=e.charAt(d+1)&&"["!=e.charAt(d+1)||(n.push(e.substring(o,d)),o=d+1));n.push(e.substring(o))}else n=e.split(/\s*U\s*/i);for(u="",m=[],i=0;i<n.length;i++){if(h=n[i],sm=h.charAt(0),em=h.charAt(h.length-1),2!=(p=(p=h.substring(1,h.length-1)).split(/,/)).length||"("!=sm&&"["!=sm||")"!=em&&"]"!=em){-1!=t.indexOf("inequality")?u+=_("invalid inequality notation")+". ":u+=_("invalid interval notation")+". ";break}for(j=0;j<2;j++)u+=singlevalsyntaxcheck(p[j],t),u+=syntaxcheckexpr(p[j],t),p[j].match(/^\s*\-?oo\s*$/)?m[j]=p[j]:(u+=(g=singlevaleval(p[j],t))[1],m[j]=g[0]);s[i]=sm+m[0]+","+m[1]+em,-1!=t.indexOf("inequality")&&(m[0].toString().match(/oo/)?m[1].toString().match(/oo/)?c[i]="RR":c[i]=a+("]"==em?"le":"lt")+m[1]:m[1].toString().match(/oo/)?c[i]=a+("["==sm?"ge":"gt")+m[0]:c[i]=m[0]+("["==sm?"le":"lt")+a+("]"==em?"le":"lt")+m[1])}return-1!=t.indexOf("inequality")?{err:u,dispvalstr:c.join(' "or" '),submitstr:s.join(l)}:{err:u,dispvalstr:s.join(" uu "),submitstr:s.join(l)}}function processCalcNtuple(e,t){var a,i,r="",n=0,s=0,c="",l=!0,o=NaN;for((e=(e=e.replace(/(\s+,\s+|,\s+|\s+,)/,",")).replace(/<<(.*)>>/,"<$1>")).charAt(0).match(/[\(\[\<\{]/)||(l=!1),i=0;i<e.length;i++)a=!1,0==n&&(r+=e.charAt(i),s=i+1,","==e.charAt(i)&&(e.substring(i+1).match(/^\s*[\(\[\<\{]/)&&e.substring(0,i).match(/[\)\]\>\}]\s*$/)||(l=!1))),e.charAt(i).match(/[\(\[\<\{]/)?n++:e.charAt(i).match(/[\)\]\>\}]/)&&(n--,a=!0),(0==n&&a||1==n&&","==e.charAt(i))&&(sub=e.substring(s,i).replace(/^\s+/,"").replace(/\s+$/,""),"oo"==sub||"-oo"==sub?r+=sub:(c+=singlevalsyntaxcheck(sub,t),c+=syntaxcheckexpr(sub,t),c+=(o=singlevaleval(sub,t))[1],r+=o[0]),r+=e.charAt(i),s=i+1);return 0!=n&&(l=!1),0==l&&(c=_("Invalid notation")+". "+c),{err:c,dispvalstr:r,submitstr:r}}function processCalcComplex(e,t){var a,i,r,n,s,c,l="",o=e.split(","),d="",u="",h=[];for(s=0;s<o.length;s++)d=o[s].replace(/^\s+/,"").replace(/\s+$/,""),-1==t.indexOf("sloppycomplex")&&("string"==typeof(c=parsecomplex(o[s]))?l+=c:(l+=singlevalsyntaxcheck(c[0],t),l+=singlevalsyntaxcheck(c[1],t))),syntaxcheckexpr(d,t),a=scopedeval("var i=0;"+(n=prepWithMath(mathjs(d,"i")))),i=scopedeval("var i=1;"+n),r=scopedeval("var i=-1;"+n),"synerr"!=a&&"synerr"!=i||(l+=_("syntax incomplete"),a=NaN),isNaN(a)||"Infinity"==a||isNaN(i)||isNaN(r)||"Infinity"==i||(i-=a,u=Math.abs(a)<1e-16?"":a,u+=Math.abs(i)<1e-16?"":(0<i&&""!=u?"+":"")+i+"i",h.push(u));return{err:l,dispvalstr:h.join(", "),submitstr:h.join(",")}}function processSizedMatrix(e){var t,a,i,r,n,s,c,l,o=allParams[e],d=o.matrixsize,u="";for(o.calcformat&&(u=o.calcformat),t=[],a=[],i=[],s="",c=r=0;c<d[0];c++){for(t[c]=[],a[c]=[],l=0;l<d[1];l++)s+=syntaxcheckexpr(n=normalizemathunicode(n=document.getElementById("qn"+e+"-"+r).value),u),s+=singlevalsyntaxcheck(n,u),t[c][l]=n,res=singlevaleval(n,u),s+=res[1],a[c][l]=res[0],i.push(res[0]),r++;t[c]="("+t[c].join(",")+")",a[c]="("+a[c].join(",")+")"}return{err:s,str:"["+t.join(",")+"]",dispvalstr:"calcmatrix"==o.qtype?"["+a.join(",")+"]":"",submitstr:i.join("|")}}function processCalcMatrix(e,t){var a,i,r,n,s,c,l,o,d,u,h,p=!0;for(((e=(e=(e=e.replace(/\[/g,"(")).replace(/\]/g,")")).replace(/\s+/g,"")).length<2||"("!==e.charAt(0)||")"!==e.charAt(e.length-1))&&(p=!1),e=e.substring(1,e.length-1),a="",i=[],s=n=r=0;s<e.length;s++)"("==e.charAt(s)?n++:")"==e.charAt(s)?n--:","==e.charAt(s)&&0==n&&(i.push(e.substring(r+1,s-1)),r=s+1);for(i.push(e.substring(r+1,e.length-1)),c=-1,0!==n&&(p=!1),d=[],u=[],s=0;s<i.length;s++){for(d[s]=[],l=i[s].split(","),-1<c&&l.length!=c&&(p=!1),c=l.length,h=0;h<l.length;h++)a+=syntaxcheckexpr(o=l[h].replace(/^\s+/,"").replace(/\s+$/,""),t),a+=singlevalsyntaxcheck(o,t),res=singlevaleval(o,t),a+=res[1],d[s][h]=res[0],u.push(res[0]);d[s]="("+d[s].join(",")+")"}return p||(a=_("Invalid matrix format")+". "),{err:a,dispvalstr:"["+d.join(",")+"]",submitstr:u.join("|")}}function processNumfunc(e,t,a){var i,r,n,s,c,l,o=allParams[e],d=o.vars,u=o.fvars,h=o.domain,p=a.match(/equation/),g="",m=AMnumfuncPrepVar(e,t),f=m[0];for(f=f.replace(/,/g,"").replace(/^\s+/,"").replace(/\s+$/,""),i=m[2].split("|"),t.match(/=/)?(p?1<t.match(/=/g).length&&(g+=_("syntax error: your equation should only contain one equal sign")):g+=_("syntax error: you gave an equation, not an expression"),f=f.replace(/(.*)=(.*)/,"$1-($2)")):p&&(g+=_("syntax error: this is not an equation")),0<u.length&&(reg=new RegExp("("+u.join("|")+")\\(","g"),f=f.replace(reg,"$1*sin($1+")),f=prepWithMath(mathjs(f,i.join("|"))),n=l=0;n<20;n++){for(s="var DNE=1;",r=0;r<i.length-1;r++)c=h[r][2]?Math.floor(Math.random()*(h[r][0]-h[r][1]+1)+h[r][0]):Math.random()*(h[r][0]-h[r][1])+h[r][0],s+="var "+i[r]+"="+c+";";if("synerr"!==scopedeval(s+f)){l++;break}}return 0===l&&(g+=_("syntax error")+". "),{err:g+=syntaxcheckexpr(t,"",d.join("|"))}}function simplifyVariable(e){return e.replace(/[^\w_\^\-+]/g,"")}function ineqtointerval(e,t){var a,i,r,n,s,c=simplifyVariable(t);if((e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")).match(/all\s*real/i))return["(-oo,oo)"];if(e.match(/DNE/))return["DNE"];for(r=[],n=e.split(/\s*or\s*/),s=0;s<n.length;s++)if(str=n[s],a=str.match(/^(.*?)(<=?|>=?)(.*?)(<=?|>=?)(.*?)$/)){if(simplifyVariable(a[3])!=c)return["","wrongvar"];if(a[2].charAt(0)!=a[4].charAt(0))return["","invalid"];i="<"==a[2].charAt(0)?("<"==a[2]?"(":"[")+a[1]+","+a[5]+("<"==a[4]?")":"]"):(">"==a[2]?"(":"[")+a[1]+","+a[5]+(">"==a[4]?")":"]"),r.push(i)}else{if(!(a=str.match(/^(.*?)(<=?|>=?)(.*?)$/)))return["","invalid"];if(simplifyVariable(a[1])==c)i="<"==a[2].charAt(0)?"(-oo,"+a[3]+("<"==a[2]?")":"]"):(">"==a[2]?"(":"[")+a[3]+",oo)",r.push(i);else{if(simplifyVariable(a[3])!=c)return["","wrongvar"];i="<"==a[2].charAt(0)?("<"==a[2]?"(":"[")+a[1]+",oo)":"(-oo,"+a[1]+(">"==a[2]?")":"]"),r.push(i)}}return[r.join("U")]}function parsecomplex(e){var t,a,i,r,n,s,c,l;if(l=(e=(e=(e=(e=e.replace(/\s/,"")).replace(/\((\d+\*?i|i)\)\/(\d+)/g,"$1/$2")).replace(/sin/,"s$n")).replace(/pi/,"p$")).length,2<e.split("i").length)return _("error - more than 1 i in expression");if(-1==(n=e.indexOf("i")))t=e,a="0";else{for(r=0,c=n-1;0<c;c--)if(")"==(i=e.charAt(c)))r++;else if("("==i)r--;else if(("+"==i||"-"==i)&&0==r)break;if(c<0&&(c=0),0!=r)return _("error - invalid form");for(r=0,s=n+1;s<l;s++)if("("==(i=e.charAt(s)))r++;else if(")"==i)r--;else if(("+"==i||"-"==i)&&0==r)break;if(0!=r)return _("error - invalid form");if(0<n-c&&0<s-n&&(s==l||0==c)){if(s==l)t=e.substr(0,c),a=e.substr(c,n-c);else{if(0!=c)return _("error - invalid form");t=e.substr(s),a=e.substr(0,n)}a=(a=(a+="*"+e.substr(n+1+("*"==e.charAt(n+1)?1:0),s-n-1)).replace("-*","-1*").replace("+*","+1*")).replace(/(\+|-)1\*(.+)/g,"$1$2")}else if(1<n-c)a=e.substr(c,n-c),t=e.substr(0,c)+e.substr(n+1);else if(1<s-n)if(0<n){if("+"!=e.charAt(n-1)&&"-"!=e.charAt(n-1))return _("error - invalid form");a=e.charAt(n-1)+e.substr(n+1+("*"==e.charAt(n+1)?1:0),s-n-1),t=e.substr(0,n-1)+e.substr(s)}else a=e.substr(n+1,s-n-1),t=e.substr(0,n)+e.substr(s);else a="+"==e.charAt(c)?"1":"-"==e.charAt(c)?"-1":0==n?"1":e.charAt(c),t=(0<n?e.substr(0,c):"")+e.substr(n+1);""==t&&(t="0"),"/"==a.charAt(0)?a="1"+a:"+"!=a.charAt(0)&&"-"!=a.charAt(0)||"/"!=a.charAt(1)||(a=a.charAt(0)+"1"+a.substr(1)),"*"==a.charAt(a.length-1)&&(a=a.substr(0,a.length-1)),"+"==a.charAt(0)&&(a=a.substr(1)),"+"==t.charAt(0)&&(t=t.substr(1))}return[t=(t=t.replace("s$n","sin")).replace("p$","pi"),a=(a=(a=a.replace("s$n","sin")).replace("p$","pi")).replace(/\*\//g,"/")]}function singlevalsyntaxcheck(e,t){if((e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")).match(/DNE/i))return"";if(e.match(/-?oo$/)||e.match(/-?oo\W/))return"";if(e.match(/,/))return _("Invalid use of a comma.");if(-1!=t.indexOf("allowmixed")&&e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/))return"";if(-1!=t.indexOf("fracordec")){if(!(e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2").replace(/\s/g,"")).match(/^\-?\(?\d+\s*\/\s*\-?\d+\)?$/)&&!e.match(/^\-?\d+$/)&&!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/))return _(" invalid entry format")+". "}else if(-1!=t.indexOf("fraction")||-1!=t.indexOf("reducedfraction")){if(!(e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2").replace(/\s/g,"")).match(/^\(?\-?\(?\d+\)?\/\(?\d+\)?$/)&&!e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)&&!e.match(/^\s*?\-?\d+\s*$/))return _("not a valid fraction")+". "}else if(-1!=t.indexOf("mixednumber")){if(!(e.match(/^\(?\-?\s*\(?\d+\)?\/\(?\d+\)?$/)||e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)||e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/)||e.match(/^\s*\-?\s*\d+\s*$/)))return _("not a valid mixed number")+". ";e=e.replace(/_/," ")}else if(-1!=t.indexOf("scinot")){if(!(e=(e=e.replace(/\s/g,"")).replace(/(x|X|\u00D7)/,"xx")).match(/^\-?[1-9](\.\d*)?(\*|xx)10\^(\(?\-?\d+\)?)$/)){if(-1==t.indexOf("scinotordec"))return _("not valid scientific notation")+". ";if(!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/))return _("not valid decimal or scientific notation")+". "}}else if(-1!=t.indexOf("decimal")&&-1==t.indexOf("nodecimal")){if(!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/))return _(" not a valid integer or decimal number")+". "}else if(!onlyAscii.test(e))return _("Your answer contains an unrecognized symbol")+". ";return""}function syntaxcheckexpr(e,t,a){var i,r,n,s,c,l="";for(-1!=t.indexOf("notrig")&&e.match(/(sin|cos|tan|cot|sec|csc)/i)?l+=_("no trig functions allowed")+". ":-1!=t.indexOf("nodecimal")&&-1!=e.indexOf(".")?l+=_("no decimals allowed")+". ":-1==t.indexOf("mixed")&&e.match(/\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/)&&(l+=_("mixed numbers are not allowed")+". "),s=n=r=i=0;s<e.length;s++)"("==e.charAt(s)?i++:")"==e.charAt(s)?i--:"["==e.charAt(s)?r++:"]"==e.charAt(s)?r--:"|"==e.charAt(s)&&(n=1-n);if(0==i&&0==r||(l+=" ("+_("unmatched parens")+"). "),0!=n&&(l+=" ("+_("unmatched absolute value bars")+"). "),reg=a?new RegExp("(sqrt|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*("+a+"|\\d+)","i"):new RegExp("(sqrt|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*(\\d+)","i"),errstuff=e.match(reg),null!=errstuff&&(l+="["+_("use function notation")+" - "+_("use $1 instead of $2",errstuff[1]+"("+errstuff[2]+")",errstuff[0])+"]. "),a&&(reg=new RegExp("(repvars\\d+|arc|sqrt|root|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs|pi|sign|DNE|e|oo|"+a+")","ig"),e.replace(reg,"").match(/[a-zA-Z]/)&&(l+=_(" Check your variables - you might be using an incorrect one")+". ")),2<(e.match(/\|/g)||[]).length)for(c=/\|.*?\|\s*(.|$)/g;match=c.exec(e);)if(""!=match[1]&&match[1].match(/[^+\-\*\/\^\)]/)){l+=_(" You may want to use abs(x) instead of |x| for absolute values to avoid ambiguity")+". ";break}return e.match(/%/)&&!e.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(l+=_(" Do not use the percent symbol, %")+". "),l}function singlevaleval(e,t){(e=e.replace(/,/,"")).match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(e=e.replace(/%/,"")+"/100"),-1!=t.indexOf("mixed")&&(e=e.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),-1!=t.indexOf("scinot")&&(e=e.replace("xx","*"));try{var a=scopedmatheval(e);return""===a?[NaN,_("syntax incomplete")+". "]:[a,""]}catch(e){return[NaN,_("syntax incomplete")+". "]}}function scopedeval(c){try{return eval(c)}catch(e){return"synerr"}}function scopedmatheval(c){if(c.match(/^\s*[a-df-zA-Z]\s*$/))return"";try{return eval(prepWithMath(mathjs(c)))}catch(e){return""}}return LivePreviews=[],MQsyntaxtimer=null,greekletters=["alpha","beta","chi","delta","epsilon","gamma","varphi","phi","psi","sigma","rho","theta","lambda","mu","nu","omega","tau"],onlyAscii=/^[\u0000-\u007f]*$/,{init:init,clearparams:clearparams,preSubmitForm:preSubmitForm,preSubmit:preSubmit,preSubmitString:preSubmitString,clearLivePreviewTimeouts:clearLivePreviewTimeouts,syntaxCheckMQ:syntaxCheckMQ,clearTips:clearTips,handleMQenter:handleMQenter}}(jQuery);function prepWithMath(e){return e=(e=(e=e.replace(/\b(abs|acos|asin|atan|ceil|floor|cos|sin|tan|sqrt|exp|max|min|pow)\(/g,"Math.$1(")).replace(/\(E\)/g,"(Math.E)")).replace(/\((PI|pi)\)/g,"(Math.PI)")}function toggleinlinebtn(e,t){var a,i=document.getElementById(t),r=document.getElementById(e);"none"==r.style.display?(r.style.display="",r.setAttribute("aria-hidden",!1),i.setAttribute("aria-expanded",!0)):(r.style.display="none",r.setAttribute("aria-hidden",!0),i.setAttribute("aria-expanded",!1)),a=i.innerHTML,i.innerHTML=a.match(/\[\+\]/)?a.replace(/\[\+\]/,"[-]"):a.replace(/\[\-\]/,"[+]")}function AutoSuggest(e,t){var a,r,n,s,c,l,o=this;this.elem=e,this.suggestions=t,this.eligible=new Array,this.inputText=null,this.highlighted=-1,this.div=document.getElementById("autosuggest"),null==this.div&&(this.div=document.createElement("div"),this.div.id="autosuggest",document.getElementsByTagName("body")[0].appendChild(this.div),this.div.appendChild(document.createElement("ul"))),a=9,r=27,n=38,s=40,c=13,e.setAttribute("autocomplete","off"),e.id||(l="autosuggest"+AutoSuggestIdCounter,AutoSuggestIdCounter++,e.id=l),e.onkeydown=function(e){var t=o.getKeyCode(e);switch(t){case a:o.useSuggestion("tab");break;case c:return o.useSuggestion("enter"),!1;case r:o.hideDiv();break;case n:0<o.highlighted&&o.highlighted--,o.changeHighlight(t);break;case s:o.highlighted<o.eligible.length-1&&o.highlighted++,o.changeHighlight(t)}},e.onkeyup=function(e){switch(o.getKeyCode(e)){case a:case r:case n:case s:return;default:1<this.value.length?(o.inputText=this.value,o.getEligible(),0<o.eligible.length?o.highlighted=0:o.highlighted=-1,o.createDiv(),o.positionDiv(),o.showDiv()):(o.hideDiv(),0==this.value.length&&(o.inputText=""))}},e.onblur=function(e){setTimeout(o.hideDiv,100)},this.useSuggestion=function(e){-1<this.highlighted&&(this.elem.value=this.eligible[this.highlighted]),this.hideDiv()},this.showDiv=function(){this.div.style.display="block"},this.hideDiv=function(){o.div.style.display="none",o.highlighted=-1},this.changeHighlight=function(){var e,t=this.div.getElementsByTagName("LI");for(i in t)e=t[i],this.highlighted==i?e.className="selected":e.className=""},this.positionDiv=function(){var e=this.elem,t=findPos(e);t[1]+=e.offsetHeight,this.div.style.left=t[0]+"px",this.div.style.top=t[1]+"px"},this.createDiv=function(){var e,t,a,r=document.createElement("ul");for(i in this.eligible)e=this.eligible[i],t=document.createElement("li"),(a=document.createElement("a")).href="#",a.onclick=function(){return!1},a.innerHTML=e,t.appendChild(a),o.highlighted==i&&(t.className="selected"),r.appendChild(t);this.div.replaceChild(r,this.div.childNodes[0]),r.onmouseover=function(e){for(var t,a=o.getEventSource(e);a.parentNode&&"LI"!=a.tagName.toUpperCase();)a=a.parentNode;for(i in t=o.div.getElementsByTagName("LI"))if(t[i]==a){o.highlighted=i;break}o.changeHighlight()},r.onclick=function(e){return o.useSuggestion("click"),o.hideDiv(),o.cancelEvent(e),!1},this.div.className="suggestion_list",this.div.style.position="absolute"},this.getEligible=function(){var e,t;if(this.eligible=new Array,-1==this.inputText.indexOf(" "))for(i in e=new RegExp("\\b"+this.inputText.toLowerCase()),this.suggestions)(t=this.suggestions[i]).toLowerCase().match(e)&&(this.eligible[this.eligible.length]=t,i)},this.getKeyCode=function(e){return e?e.keyCode:window.event?window.event.keyCode:void 0},this.getEventSource=function(e){return e?e.target:window.event?window.event.srcElement:void 0},this.cancelEvent=function(e){e&&(e.preventDefault(),e.stopPropagation()),window.event&&(window.event.returnValue=!1)}}AutoSuggestIdCounter=0,autoSuggestLists={},autoSuggestObjects={},document.write=function(){};
var ehcurel=null,ehclosetimer=0,ehddclosetimer=0,curehdd=null,eecurel=null;function showeh(e){var l,t,d;null==eecurel&&(unhideeh(0),l=document.getElementById(e),t=document.getElementById("eh"),e!=ehcurel?(ehcurel=e,d=findPos(l),t.style.display="block",t.style.left=d[0]+"px",t.style.top=d[1]+l.offsetHeight+"px"):(t.style.display="none",ehcurel=null),l.focus())}function reshrinkeh(e){null==eecurel&&e==ehcurel&&(document.getElementById("ehdd").style.display="block",document.getElementById("eh").style.display="none",ehcurel=null,curehdd=e,unhideeh(0))}function unhideeh(e){ehcancelclosetimer()}function hideeh(e){null==ehcurel?ehddclosetimer=window.setTimeout(function(){curehdd=null,document.getElementById("ehdd").style.display="none"},250):ehclosetimer=window.setTimeout(reallyhideeh,250)}function reallyhideeh(){document.getElementById("eh").style.display="none",ehcurel=null}function ehcancelclosetimer(){ehclosetimer&&(window.clearTimeout(ehclosetimer),ehclosetimer=null)}function hideAllEhTips(){ehclosetimer&&(window.clearTimeout(ehclosetimer),ehclosetimer=null),ehddclosetimer&&(window.clearTimeout(ehddclosetimer),ehddclosetimer=null),curehdd=null,document.getElementById("ehdd").style.display="none",document.getElementById("eh").style.display="none"}function showehdd(e,l,t){var d,n,c;null!=eecurel&&eecurel==e||null!=document.getElementById("tips"+t)&&(ehddclosetimer&&e!=curehdd&&(window.clearTimeout(ehddclosetimer),ehddclosetimer=null),e!=ehcurel&&(d=document.getElementById("ehdd"),n=document.getElementById(e),c=findPos(n),document.getElementById("ehddtext").innerHTML=l,document.getElementById("eh").innerHTML=document.getElementById("tips"+t).innerHTML,d.style.display="block",d.style.left=c[0]+"px",d.style.top=c[1]+n.offsetHeight+"px"),curehdd=e)}function updateehpos(){var e,l,t,d;(curehdd||ehcurel)&&(e=document.getElementById("eh"),l=document.getElementById("ehdd"),t=document.getElementById(curehdd||ehcurel),d=findPos(t),e.style.left=d[0]+"px",e.style.top=d[1]+t.offsetHeight+"px",l.style.left=d[0]+"px",l.style.top=d[1]+t.offsetHeight+"px")}
var arcsech,arccsch,arccoth,sign,logten,sinn,cosn,tann,cscn,secn,cotn,funcstoindexarr,pi=Math.PI,ln=Math.log,e=Math.E,arcsin=Math.asin,arccos=Math.acos,arctan=Math.atan,sec=function(c){return 1/Math.cos(c)},csc=function(c){return 1/Math.sin(c)},cot=function(c){return 1/Math.tan(c)},arcsec=function(c){return arccos(1/c)},arccsc=function(c){return arcsin(1/c)},arccot=function(c){return arctan(1/c)},sinh=function(c){return(Math.exp(c)-Math.exp(-c))/2},cosh=function(c){return(Math.exp(c)+Math.exp(-c))/2},tanh=function(c){return(Math.exp(c)-Math.exp(-c))/(Math.exp(c)+Math.exp(-c))},sech=function(c){return 1/cosh(c)},csch=function(c){return 1/sinh(c)},coth=function(c){return 1/tanh(c)},arcsinh=function(c){return ln(c+Math.sqrt(c*c+1))},arccosh=function(c){return ln(c+Math.sqrt(c*c-1))},arctanh=function(c){return ln((1+c)/(1-c))/2};function factorial(c,n){null==n&&(n=1);for(var t=c-n;0<t;t-=n)c*=t;return c<0?NaN:0==c?1:c}function C(c,n){var t,r=1;for(t=0;t<n;t++)r*=(c-t)/(n-t);return r}function matchtolower(c){return c.toLowerCase()}function nthroot(c,n){return safepow(n,1/c)}function nthlogten(c,n){return Math.log(n)/Math.log(c)}function functoindex(c){for(var n=0;n<funcstoindexarr.length;n++)if(funcstoindexarr[n]==c)return"@"+n+"@"}function indextofunc(c,n){return funcstoindexarr[n]}function safepow(c,n){if(c<0&&Math.floor(n)!=n){for(var t=3;t<50;t+=2)if(Math.abs(Math.round(t*n)-t*n)<1e-6)return Math.round(t*n)%2==0?Math.pow(Math.abs(c),n):-1*Math.pow(Math.abs(c),n);return Math.sqrt(-1)}return Math.pow(c,n)}function mathjs(c,n){var r,a,t,e,o,s,h;if(c=(c=(c=(c=(c=(c=(c=c.replace("[","(")).replace("]",")")).replace(/root\s*(\d+)/,"root($1)")).replace(/\|(.*?)\|/g,"abs($1)")).replace(/arc(sin|cos|tan|sec|csc|cot|sinh|cosh|tanh|sech|csch|coth)/gi,"$1^-1")).replace(/(Sin|Cos|Tan|Sec|Csc|Cot|Arc|Abs|Log|Exp|Ln|Sqrt)/gi,matchtolower)).replace(/(sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root)/g,functoindex),null!=n&&""!=n){for((r=n.split("|")).push("pi"),r.sort(function(c,n){return n.length-c.length}),n=r.join("|"),a=[],t=0;t<r.length;t++)for(a[t]=!1,e=0;e<r.length;e++)if(t!=e&&r[e].toLowerCase()==r[t].toLowerCase()&&r[e]!=r[t]){a[t]=!0;break}c=c.replace(new RegExp("("+n+")","gi"),function(c,n){for(var t=0;t<r.length;t++)if(r[t]==n||!a[t]&&r[t].toLowerCase()==n.toLowerCase())return"(@v"+t+"@)"})}else c=c.replace(/pi/g,"(pi)");for(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=c.replace(/([0-9])E([\-0-9])/g,"$1(EE)$2")).replace(/e/g,"(E)")).replace(/@(\d+)@/g,indextofunc)).replace(/log_([a-zA-Z\d\.]+)\s*\(/g,"nthlog($1,")).replace(/log_\(([a-zA-Z\/\d\.]+)\)\s*\(/g,"nthlog($1,")).replace(/log_(\(@v\d+@\))\s*\(/g,"nthlog($1,")).replace(/log/g,"logten")).replace(/(sin|cos|tan|sec|csc|cot|sinh|cosh|tanh|sech|csch|coth)\^(-1|\(-1\))/g,"arc$1")).replace(/(sin|cos|tan|sec|csc|cot)\^(\d+)\s*\(/g,"$1n($2,")).replace(/(sin|cos|tan|sec|csc|cot)\^\((\d+)\)\s*\(/g,"$1n($2,")).replace(/root\s*\((\d+)\)\s*\(/g,"nthroot($1,")).replace(/([0-9])\s+([0-9])/g,"$1*$2")).replace(/#/g,"")).replace(/\s/g,""),null!=n&&""!=n&&(c=c.replace(/@v(\d+)@/g,function(c,n){return r[n]})),c=(c=(c=(c=c.replace(/([0-9])([\(a-zA-Z])/g,"$1*$2")).replace(/(!)([0-9\(a-zA-Z])/g,"$1*$2")).replace(/\)([\(0-9a-zA-Z]|\.\d+)/g,")*$1")).replace(/([0-9])\*\(EE\)\*?([\-0-9])/g,"$1e$2");-1!=(t=c.indexOf("!"));){if(0==t)return"Error: missing argument";if(e=t-1,"0"<=(s=c.charAt(e))&&s<="9"){for(e--;0<=e&&"0"<=(s=c.charAt(e))&&s<="9";)e--;if("."==s)for(e--;0<=e&&"0"<=(s=c.charAt(e))&&s<="9";)e--}else if(")"==s){for(h=1,e--;0<=e&&0<h;)"("==(s=c.charAt(e))?h--:")"==s&&h++,e--;for(;0<=e&&("a"<=(s=c.charAt(e))&&s<="z"||"A"<=s&&s<="Z");)e--}else{if(!("a"<=s&&s<="z"||"A"<=s&&s<="Z"))return"Error: incorrect syntax in "+c+" at position "+e;for(e--;0<=e&&("a"<=(s=c.charAt(e))&&s<="z"||"A"<=s&&s<="Z");)e--}c=c.slice(0,e+1)+"factorial("+c.slice(e+1,t)+")"+c.slice(t+1)}for(;-1!=(t=c.lastIndexOf("^"));){if(0==t)return"Error: missing argument";if(e=t-1,"0"<=(s=c.charAt(e))&&s<="9"){for(e--;0<=e&&"0"<=(s=c.charAt(e))&&s<="9";)e--;if("."==s)for(e--;0<=e&&"0"<=(s=c.charAt(e))&&s<="9";)e--}else if(")"==s){for(h=1,e--;0<=e&&0<h;)"("==(s=c.charAt(e))?h--:")"==s&&h++,e--;for(;0<=e&&("a"<=(s=c.charAt(e))&&s<="z"||"A"<=s&&s<="Z");)e--}else{if(!("a"<=s&&s<="z"||"A"<=s&&s<="Z"))return"Error: incorrect syntax in "+c+" at position "+e;for(e--;0<=e&&("a"<=(s=c.charAt(e))&&s<="z"||"A"<=s&&s<="Z");)e--}if(t==c.length-1)return"Error: missing argument";if(o=t+1,s=c.charAt(o),nch=c.charAt(o+1),"0"<=s&&s<="9"||"-"==s&&"("!=nch||"."==s){for(o++;o<c.length&&"0"<=(s=c.charAt(o))&&s<="9";)o++;if("."==s)for(o++;o<c.length&&"0"<=(s=c.charAt(o))&&s<="9";)o++}else if("("==s||"-"==s&&"("==nch)for("-"==s&&o++,h=1,o++;o<c.length&&0<h;)"("==(s=c.charAt(o))?h++:")"==s&&h--,o++;else{if(!("a"<=s&&s<="z"||"A"<=s&&s<="Z"))return"Error: incorrect syntax in "+c+" at position "+o;for(o++;o<c.length&&("a"<=(s=c.charAt(o))&&s<="z"||"A"<=s&&s<="Z");)o++;if("("==s&&c.slice(t+1,o).match(/^(sinn|cosn|tann|secn|cscn|cotn|sin|cos|tan|sec|csc|cot|logten|nthlogten|log|ln|exp|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|sqrt|abs|nthroot|factorial|safepow)$/))for(h=1,o++;o<c.length&&0<h;)"("==(s=c.charAt(o))?h++:")"==s&&h--,o++}c=c.slice(0,e+1)+"safepow("+c.slice(e+1,t)+","+c.slice(t+1,o)+")"+c.slice(o)}return c}sech=function(c){return 1/cosh(c)},csch=function(c){return 1/sinh(c)},coth=function(c){return 1/tanh(c)},arcsech=function(c){return arccosh(1/c)},arccsch=function(c){return arcsinh(1/c)},arccoth=function(c){return arctanh(1/c)},sign=function(c){return 0==c?0:c<0?-1:1},logten=function(c){return Math.LOG10E*Math.log(c)},sinn=function(c,n){return Math.pow(Math.sin(n),c)},cosn=function(c,n){return Math.pow(Math.cos(n),c)},tann=function(c,n){return Math.pow(Math.tan(n),c)},cscn=function(c,n){return 1/Math.pow(Math.sin(n),c)},secn=function(c,n){return 1/Math.pow(Math.cos(n),c)},cotn=function(c,n){return 1/Math.pow(Math.tan(n),c)},funcstoindexarr="sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root|arcsin|arccos|arctan|arcsec|arccsc|arccot|arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth".split("|");
var AMtoMQ=function(){var r,v,c,g,s=".",x=0,m=1,y=2,$=3,h=4,q=5,f=6,b=7,A=8,_=9,d=10,t={input:"sqrt",tag:"msqrt",output:"sqrt",tex:null,ttype:m},u={input:"root",tag:"mroot",output:"root",tex:null,ttype:y},e={input:"frac",tag:"mfrac",output:"/",tex:null,ttype:y},n={input:"/",tag:"mfrac",output:"/",tex:null,ttype:$},p={input:"stackrel",tag:"mover",output:"stackrel",tex:null,ttype:y},l={input:"_",tag:"msub",output:"_",tex:null,ttype:$},a={input:"^",tag:"msup",output:"^",tex:null,ttype:$},o={input:"text",tag:"mtext",output:"text",tex:null,ttype:d},i={input:"mbox",tag:"mtext",output:"mbox",tex:null,ttype:d},O={input:'"',tag:"mtext",output:"mbox",tex:null,ttype:d},w=[{input:"alpha",tag:"mi",output:"α",tex:null,ttype:x},{input:"beta",tag:"mi",output:"β",tex:null,ttype:x},{input:"chi",tag:"mi",output:"χ",tex:null,ttype:x},{input:"delta",tag:"mi",output:"δ",tex:null,ttype:x},{input:"Delta",tag:"mo",output:"Δ",tex:null,ttype:x},{input:"epsi",tag:"mi",output:"ε",tex:"epsilon",ttype:x},{input:"varepsilon",tag:"mi",output:"ɛ",tex:null,ttype:x},{input:"eta",tag:"mi",output:"η",tex:null,ttype:x},{input:"gamma",tag:"mi",output:"γ",tex:null,ttype:x},{input:"Gamma",tag:"mo",output:"Γ",tex:null,ttype:x},{input:"iota",tag:"mi",output:"ι",tex:null,ttype:x},{input:"kappa",tag:"mi",output:"κ",tex:null,ttype:x},{input:"lambda",tag:"mi",output:"λ",tex:null,ttype:x},{input:"Lambda",tag:"mo",output:"Λ",tex:null,ttype:x},{input:"mu",tag:"mi",output:"μ",tex:null,ttype:x},{input:"nu",tag:"mi",output:"ν",tex:null,ttype:x},{input:"omega",tag:"mi",output:"ω",tex:null,ttype:x},{input:"Omega",tag:"mo",output:"Ω",tex:null,ttype:x},{input:"phi",tag:"mi",output:"φ",tex:null,ttype:x},{input:"varphi",tag:"mi",output:"ϕ",tex:null,ttype:x},{input:"Phi",tag:"mo",output:"Φ",tex:null,ttype:x},{input:"pi",tag:"mi",output:"π",tex:null,ttype:x},{input:"Pi",tag:"mo",output:"Π",tex:null,ttype:x},{input:"psi",tag:"mi",output:"ψ",tex:null,ttype:x},{input:"Psi",tag:"mi",output:"Ψ",tex:null,ttype:x},{input:"rho",tag:"mi",output:"ρ",tex:null,ttype:x},{input:"sigma",tag:"mi",output:"σ",tex:null,ttype:x},{input:"Sigma",tag:"mo",output:"Σ",tex:null,ttype:x},{input:"tau",tag:"mi",output:"τ",tex:null,ttype:x},{input:"theta",tag:"mi",output:"θ",tex:null,ttype:x},{input:"vartheta",tag:"mi",output:"ϑ",tex:null,ttype:x},{input:"Theta",tag:"mo",output:"Θ",tex:null,ttype:x},{input:"upsilon",tag:"mi",output:"υ",tex:null,ttype:x},{input:"xi",tag:"mi",output:"ξ",tex:null,ttype:x},{input:"Xi",tag:"mo",output:"Ξ",tex:null,ttype:x},{input:"zeta",tag:"mi",output:"ζ",tex:null,ttype:x},{input:"*",tag:"mo",output:"⋅",tex:"cdot",ttype:x},{input:"xx",tag:"mo",output:"×",tex:"times",ttype:x},{input:"-:",tag:"mo",output:"÷",tex:"div",ttype:x},{input:"sum",tag:"mo",output:"∑",tex:null,ttype:b},{input:"nn",tag:"mo",output:"∩",tex:"cap",ttype:x},{input:"uu",tag:"mo",output:"∪",tex:"cup",ttype:x},{input:"U",tag:"mo",output:"∪",tex:"cup",ttype:x},{input:"!=",tag:"mo",output:"≠",tex:"ne",ttype:x},{input:"lt",tag:"mo",output:"<",tex:null,ttype:x},{input:"gt",tag:"mo",output:">",tex:null,ttype:x},{input:"<=",tag:"mo",output:"≤",tex:"le",ttype:x},{input:"lt=",tag:"mo",output:"≤",tex:"leq",ttype:x},{input:"gt=",tag:"mo",output:"≥",tex:"geq",ttype:x},{input:">=",tag:"mo",output:"≥",tex:"ge",ttype:x},{input:"geq",tag:"mo",output:"≥",tex:null,ttype:x},{input:"in",tag:"mo",output:"∈",tex:null,ttype:x},{input:"sub",tag:"mo",output:"⊂",tex:"subset",ttype:x},{input:"sube",tag:"mo",output:"⊆",tex:"subseteq",ttype:x},{input:"(",tag:"mo",output:"(",tex:null,ttype:h},{input:")",tag:"mo",output:")",tex:null,ttype:q},{input:"[",tag:"mo",output:"[",tex:null,ttype:h},{input:"]",tag:"mo",output:"]",tex:null,ttype:q},{input:"{",tag:"mo",output:"{",tex:"{",ttype:h,notexcopy:!0},{input:"}",tag:"mo",output:"}",tex:"}",ttype:q,notexcopy:!0},{input:"|",tag:"mo",output:"|",tex:null,ttype:_},{input:"(:",tag:"mo",output:"〈",tex:"langle",ttype:h},{input:":)",tag:"mo",output:"〉",tex:"rangle",ttype:q},{input:"<<",tag:"mo",output:"〈",tex:"langle",ttype:h},{input:">>",tag:"mo",output:"〉",tex:"rangle",ttype:q},{input:"int",tag:"mo",output:"∫",tex:null,ttype:x},{input:"+-",tag:"mo",output:"±",tex:"pm",ttype:x},{input:"O/",tag:"mo",output:"∅",tex:"emptyset",ttype:x},{input:"oo",tag:"mo",output:"∞",tex:"infty",ttype:x},{input:"rarr",tag:"mo",output:"→",tex:"rightarrow",ttype:x},{input:"->",tag:"mo",output:"→",tex:"to",ttype:x},{input:"RR",tag:"mo",output:"ℝ",tex:"mathbb{R}",ttype:x,notexcopy:!0},{input:"f",tag:"mi",output:"f",tex:null,ttype:m,func:!0,val:!0},{input:"sin",tag:"mo",output:"sin",tex:null,ttype:m,func:!0},{input:"cos",tag:"mo",output:"cos",tex:null,ttype:m,func:!0},{input:"tan",tag:"mo",output:"tan",tex:null,ttype:m,func:!0},{input:"arcsin",tag:"mo",output:"arcsin",tex:null,ttype:m,func:!0},{input:"arccos",tag:"mo",output:"arccos",tex:null,ttype:m,func:!0},{input:"arctan",tag:"mo",output:"arctan",tex:null,ttype:m,func:!0},{input:"sinh",tag:"mo",output:"sinh",tex:null,ttype:m,func:!0},{input:"cosh",tag:"mo",output:"cosh",tex:null,ttype:m,func:!0},{input:"tanh",tag:"mo",output:"tanh",tex:null,ttype:m,func:!0},{input:"cot",tag:"mo",output:"cot",tex:null,ttype:m,func:!0},{input:"coth",tag:"mo",output:"coth",tex:null,ttype:m,func:!0},{input:"sech",tag:"mo",output:"sech",tex:null,ttype:m,func:!0},{input:"csch",tag:"mo",output:"csch",tex:null,ttype:m,func:!0},{input:"sec",tag:"mo",output:"sec",tex:null,ttype:m,func:!0},{input:"csc",tag:"mo",output:"csc",tex:null,ttype:m,func:!0},{input:"log",tag:"mo",output:"log",tex:null,ttype:m,func:!0},{input:"ln",tag:"mo",output:"ln",tex:null,ttype:m,func:!0},{input:"abs",tag:"mo",output:"abs",tex:null,ttype:m},{input:"Sin",tag:"mo",output:"sin",tex:null,ttype:m,func:!0},{input:"Cos",tag:"mo",output:"cos",tex:null,ttype:m,func:!0},{input:"Tan",tag:"mo",output:"tan",tex:null,ttype:m,func:!0},{input:"Arcsin",tag:"mo",output:"arcsin",tex:null,ttype:m,func:!0},{input:"Arccos",tag:"mo",output:"arccos",tex:null,ttype:m,func:!0},{input:"Arctan",tag:"mo",output:"arctan",tex:null,ttype:m,func:!0},{input:"Sinh",tag:"mo",output:"sinh",tex:null,ttype:m,func:!0},{input:"Sosh",tag:"mo",output:"cosh",tex:null,ttype:m,func:!0},{input:"Tanh",tag:"mo",output:"tanh",tex:null,ttype:m,func:!0},{input:"Cot",tag:"mo",output:"cot",tex:null,ttype:m,func:!0},{input:"Sec",tag:"mo",output:"sec",tex:null,ttype:m,func:!0},{input:"Csc",tag:"mo",output:"csc",tex:null,ttype:m,func:!0},{input:"Log",tag:"mo",output:"log",tex:null,ttype:m,func:!0},{input:"Ln",tag:"mo",output:"ln",tex:null,ttype:m,func:!0},{input:"Abs",tag:"mo",output:"abs",tex:null,ttype:m,func:!0},t,u,e,n,p,l,a,{input:"Sqrt",tag:"msqrt",output:"sqrt",tex:null,ttype:m},{input:"hat",tag:"mover",output:"^",tex:null,ttype:m,acc:!0},{input:"bar",tag:"mover",output:"¯",tex:"overline",ttype:m,acc:!0},{input:"vec",tag:"mover",output:"→",tex:null,ttype:m,acc:!0},o,i,O];function R(t,u){return t.input>u.input?1:-1}function S(t,u){var e,n;for(e="\\"==t.charAt(u)&&"\\"!=t.charAt(u+1)&&" "!=t.charAt(u+1)?t.slice(u+1):t.slice(u),n=0;n<e.length&&e.charCodeAt(n)<=32;n+=1);return e.slice(n)}function z(t,u,e){var n,p,l;if(0==e){for(e=-1,n=t.length;e+1<n;)t[p=e+n>>1]<u?e=p:n=p;return n}for(l=e;l<t.length&&t[l]<u;l++);return l}function D(t){var u,e,n,p,l,a=0,o="",i=!0;for(p=1;p<=t.length&&i;p++)e=t.slice(0,p),(a=z(r,e,a))<r.length&&t.slice(0,r[a].length)==r[a]&&(p=(o=r[u=a]).length),i=a<r.length&&t.slice(0,r[a].length)>=r[a];if(c=g,""!=o)return g=w[u].ttype,w[u];for(g=x,a=1,e=t.slice(0,1),l=!0;"0"<=e&&e<="9"&&a<=t.length;)e=t.slice(a,a+1),a++;if(e==s&&"0"<=(e=t.slice(a,a+1))&&e<="9")for(l=!1,a++;"0"<=e&&e<="9"&&a<=t.length;)e=t.slice(a,a+1),a++;return n=l&&1<a||2<a?(e=t.slice(0,a-1),"mn"):(a=2,((e=t.slice(0,1))<"A"||"Z"<e)&&(e<"a"||"z"<e)?"mo":"mi"),"-"==e&&c==$?(g=$,{input:e,tag:n,output:e,ttype:m,func:!0,val:!0}):{input:e,tag:n,output:e,ttype:x,val:!0}}function E(t){var u,e;return"{"==t.charAt(0)&&"}"==t.charAt(t.length-1)&&(e=0,"\\left"==(u=t.substr(1,5))?"("==(u=t.charAt(6))||"["==u||"{"==u?e=7:"\\lbrace"==(u=t.substr(6,7))&&(e=13):"("!=(u=t.charAt(1))&&"["!=u||(e=2),0<e&&("\\right)}"==(u=t.substr(t.length-8))||"\\right]}"==u||"\\right.}"==u?t=(t="{"+t.substr(e)).substr(0,t.length-8)+"}":"\\rbrace}"==u&&(t=(t="{"+t.substr(e)).substr(0,t.length-14)+"}"))),t}function N(t){return pre="boolean"==typeof t.val&&t.val?"":"\\",null==t.tex?pre+t.input:pre+t.tex}function Z(t){return null==t.tex?t.input:"\\"+t.tex}function C(t){var u,e,n,p,l,a,o,i="";if(null==(u=D(t=S(t,0)))||u.ttype==q&&0<v)return[null,t];switch(u.ttype==A&&(u=D(t=u.output+S(t,u.input.length))),u.ttype){case b:case x:return t=S(t,u.input.length),"\\"==(l=N(u)).charAt(0)||"mo"==u.tag?[l,t]:["{"+l+"}",t];case h:return(v++,e=k(t=S(t,u.input.length),!0),v--,e[0].match(/bmatrix/))?[e[0].substring(0,e[0].length-7),e[1]]:("\\right"==e[a=0].substr(0,6)&&(")"==(p=e[0].charAt(6))||"]"==p||"}"==p?a=6:"."==p?a=7:"\\rbrace"==(p=e[0].substr(6,7))&&(a=13)),[0<a?(e[0]=e[0].substr(a),"boolean"==typeof u.invisible&&u.invisible?"{"+e[0]+"}":"{"+Z(u)+e[0]+"}"):"boolean"==typeof u.invisible&&u.invisible?"{\\left."+e[0]+"}":"{\\left"+Z(u)+e[0]+"}",e[1]]);case d:return u!=O&&(t=S(t,u.input.length)),-1==(n="{"==t.charAt(0)?t.indexOf("}"):"("==t.charAt(0)?t.indexOf(")"):"["==t.charAt(0)?t.indexOf("]"):u==O?t.slice(1).indexOf('"')+1:0)&&(n=t.length),[i+="\\text{"+(p=t.slice(1,n))+"}",t=S(t,n+1)];case m:return null==(e=C(t=S(t,u.input.length)))[0]?["{"+N(u)+"}",t]:"boolean"==typeof u.func&&u.func?"^"==(p=t.charAt(0))||"_"==p||"/"==p||"|"==p||","==p||1==u.input.length&&u.input.match(/\w/)&&"("!=p?["{"+N(u)+"}",t]:["{"+N(u)+"{"+e[0]+"}}",e[1]]:(e[0]=E(e[0]),"sqrt"==u.input?["\\sqrt{"+e[0]+"}",e[1]]:"abs"==u.input?["\\left|{"+e[0]+"}\\right|",e[1]]:"cancel"==u.input?["\\cancel{"+e[0]+"}",e[1]]:void 0!==u.rewriteleftright?["{\\left"+u.rewriteleftright[0]+e[0]+"\\right"+u.rewriteleftright[1]+"}",e[1]]:"boolean"==typeof u.acc&&u.acc?[N(u)+"{"+e[0]+"}",e[1]]:["{"+N(u)+"{"+e[0]+"}}",e[1]]);case y:return null==(e=C(t=S(t,u.input.length)))[0]?["{"+N(u)+"}",t]:(e[0]=E(e[0]),null==(o=C(e[1]))[0]?["{"+N(u)+"}",t]:(o[0]=E(o[0]),[i="color"==u.input?"{\\color{"+e[0].replace(/[\{\}]/g,"")+"}"+o[0]+"}":"root"==u.input?"{\\sqrt["+e[0]+"]{"+o[0]+"}}":"{"+N(u)+"{"+e[0]+"}{"+o[0]+"}}",o[1]]));case $:return t=S(t,u.input.length),[u.output,t];case f:return t=S(t,u.input.length),["{\\quad\\text{"+u.input+"}\\quad}",t];case _:return v++,e=k(t=S(t,u.input.length),!1),v--,p="","|"==(p=e[0].charAt(e[0].length-1))?["{\\left|"+e[0]+"}",e[1]]:["{\\mid}",t];default:return t=S(t,u.input.length),["{"+N(u)+"}",t]}}function M(t){var u,e,n,p,l,a;return e=D(t=S(t,0)),p=(l=C(t))[0],(u=D(t=l[1])).ttype==$&&"/"!=u.input&&(null==(l=C(t=S(t,u.input.length)))[0]?l[0]="{}":l[0]=E(l[0]),t=l[1],"_"==u.input?"^"==(n=D(t)).input?((a=C(t=S(t,n.input.length)))[0]=E(a[0]),t=a[1],p="{"+p,p+="_{"+l[0]+"}",p+="^{"+a[0]+"}",p+="}"):p+="_{"+l[0]+"}":p=p+"^{"+l[0]+"}",void 0!==e.func&&e.func&&(n=D(t)).ttype!=$&&n.ttype!=q&&(p="{"+p+(l=M(t))[0]+"}",t=l[1])),[p,t]}function k(t,u){for(var e,n,p,l,a,o,i,r,c,g,s,x,m,y,h,f,b,A="",d=!1;n=(p=M(t=S(t,0)))[0],(e=D(t=p[1])).ttype==$&&"/"==e.input?(null==(p=M(t=S(t,e.input.length)))[0]?p[0]="{}":p[0]=E(p[0]),t=p[1],n="\\frac{"+(n=E(n))+"}",A+=n+="{"+p[0]+"}",e=D(t)):null!=n&&(A+=n),(e.ttype!=q&&(e.ttype!=_||u)||0==v)&&null!=e&&""!=e.output;);if(e.ttype==q||e.ttype==_){if(2<(a=A.length)&&"{"==A.charAt(0)&&0<A.indexOf(",")&&(")"==(o=A.charAt(a-2))||"]"==o)&&("("==(i=A.charAt(6))&&")"==o&&"}"!=e.output||"["==i&&"]"==o)){for(r="\\begin{bmatrix}",(c=new Array).push(0),g=!0,(x=[])[s=0]=[0],y=m=0,l=1;l<a-1;l++)A.charAt(l)==i&&s++,A.charAt(l)==o&&0==--s&&","==A.charAt(l+2)&&"{"==A.charAt(l+3)&&(c.push(l+2),x[m=l+2]=[l+2]),"["!=A.charAt(l)&&"("!=A.charAt(l)&&"{"!=A.charAt(l)||y++,"]"!=A.charAt(l)&&")"!=A.charAt(l)&&"}"!=A.charAt(l)||y--,","==A.charAt(l)&&1==y&&x[m].push(l);if(c.push(a),h=-1,0==s&&0<c.length)for(l=0;l<c.length-1;l++){if(0<l&&(r+="\\\\"),0==l)if(1==x[c[l]].length)f=[A.substr(c[l]+7,c[l+1]-c[l]-15)];else{for(f=[A.substring(c[l]+7,x[c[l]][1])],b=2;b<x[c[l]].length;b++)f.push(A.substring(x[c[l]][b-1]+1,x[c[l]][b]));f.push(A.substring(x[c[l]][x[c[l]].length-1]+1,c[l+1]-8))}else if(1==x[c[l]].length)f=[A.substr(c[l]+8,c[l+1]-c[l]-16)];else{for(f=[A.substring(c[l]+8,x[c[l]][1])],b=2;b<x[c[l]].length;b++)f.push(A.substring(x[c[l]][b-1]+1,x[c[l]][b]));f.push(A.substring(x[c[l]][x[c[l]].length-1]+1,c[l+1]-8))}0<h&&f.length!=h?g=!1:-1==h&&(h=f.length),r+=f.join("&")}r+="\\end{bmatrix}",g&&(A=r)}t=S(t,e.input.length),d=("boolean"==typeof e.invisible&&e.invisible?A+="\\right.":A+=n="\\right"+Z(e),!0)}return 0<v&&!d&&(A+="\\right."),[A,t]}return r=[],function(){var t,u=[];for(t=0;t<w.length;t++)!w[t].tex||"boolean"==typeof w[t].notexcopy&&w[t].notexcopy||(u[u.length]={input:w[t].tex,tag:w[t].tag,output:w[t].output,ttype:w[t].ttype,acc:w[t].acc||!1});for((w=w.concat(u)).sort(R),t=0;t<w.length;t++)r[t]=w[t].input}(),function(t){return v=0,null==(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/(&nbsp;|\u00a0|&#160;)/g,"")).replace(/^\s*<([^<].*?[^>])>\s*$/,"<<$1>>")).replace(/&gt;/g,">")).replace(/&lt;/g,"<")).replace(/\s*\bor\b\s*/g,'" or "')).replace(/all\s+real\s+numbers/g,'"all real numbers"')).replace(/(\)|\])\s*u\s*(\(|\[)/g,"$1U$2")).replace(/DNE/g,'"DNE"')).match(/\S/)?"":k(t.replace(/^\s+/g,""),!1)[0]}}();function MQtoAM(t,u){var e,n,p,l,a,o;if(t=t.replace(/\\:/g," "),u)t=t.replace(/\\Re/g,"RR");else{for(;-1!=(o=t.lastIndexOf("\\left|"));)t=-1!=(n=t.indexOf("\\right|",o+1))?(p=t.substring(0,o).match(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|ln|log|exp|sin|cos|tan|sec|csc|cot)(\^\d+)?$/),(t=t.substring(0,n)+")"+(p?")":"")+t.substring(n+7)).substring(0,o)+(p?"(":"")+"abs("+t.substring(o+6)):t.substring(0,o)+"|"+t.substring(o+6);t=(t=(t=(t=(t=t.replace(/\\text{\s*or\s*}/g," or ")).replace(/\\text{all\s+real\s+numbers}/g,"all real numbers")).replace(/\\text{DNE}/g,"DNE")).replace(/\\varnothing/g,"DNE")).replace(/\\Re/g,"all real numbers")}for(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/\\begin{.?matrix}(.*?)\\end{.?matrix}/g,function(t,u){return"[("+u.replace(/\\\\/g,"),(").replace(/&/g,",")+")]"})).replace(/\\le(?!f)/g,"<=")).replace(/\\ge/g,">=")).replace(/\\approx/g,"~~")).replace(/(\\arrow|\\rightarrow)/g,"rarr")).replace(/\\cup/g,"U")).replace(/\\left\\{/g,"lbrace").replace(/\\right\\}/g,"rbrace")).replace(/\\left/g,"")).replace(/\\right/g,"")).replace(/\\langle/g,"<<")).replace(/\\rangle/g,">>")).replace(/\\cdot/g,"*")).replace(/\\infty/g,"oo")).replace(/\\nthroot/g,"root")).replace(/\\/g,"")).replace(/sqrt\[(.*?)\]/g,"root($1)")).replace(/(\d)frac/g,"$1 frac");-1!=(o=t.indexOf("frac{"));){for(e=1,l=o+5;0<e&&l<t.length-1;)l++,"{"==(a=t.charAt(l))?e++:"}"==a&&e--;t=0==e?t.substring(0,o)+"("+t.substring(o+5,l)+")/"+t.substring(l+1):t.substring(0,o)+t.substring(o+4)}return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/_(\d)(\d)/g,"_$1 $2")).replace(/\^(\d)(\d)/g,"^$1 $2")).replace(/_{([\d\.]+)}\^/g,"_$1^")).replace(/_{([\d\.]+)}([^\^])/g,"_$1 $2")).replace(/_{([\d\.]+)}$/g,"_$1")).replace(/{/g,"(").replace(/}/g,")")).replace(/lbrace/g,"{").replace(/rbrace/g,"}")).replace(/\(([\d\.]+)\)\/\(([\d\.]+)\)/g,"$1/$2")).replace(/\/\(([\d\.]+)\)/g,"/$1")).replace(/\(([\d\.]+)\)\//g,"$1/")).replace(/\/\(([\a-zA-Z])\)/g,"/$1")).replace(/\(([\a-zA-Z])\)\//g,"$1/")).replace(/\^\(-1\)/g,"^-1")).replace(/\^\((-?[\d\.]+)\)/g,"^$1")).replace(/\/\(([\a-zA-Z])\^([\d\.]+)\)/g,"/$1^$2")).replace(/\(([\a-zA-Z])\^([\d\.]+)\)\//g,"$1^$2/")}
var MQeditor=function(h){var y={layoutstyle:"auto",layout:[]},u={},f=null,l=null,p=null,g=MathQuill.getInterface(MathQuill.getInterface.MAX);function n(n,t,e){var a,o,s,l,i,r,d,c;"string"==typeof n&&(n=document.getElementById(n)),a="boolean"==typeof t?t:"hidden"!=n.type,o=n.id,!0===a?(s=h(n).attr("type","hidden").val(),y.hasOwnProperty("toMQ")&&(s=y.toMQ(s)),0==(l=h("#mqinput-"+o)).length?(i=h("<span/>",{id:"mqinput-"+o,class:"mathquill-math-field",text:s}),null!==(r=n.className.match(/(ansred|ansyel|ansgrn)/))&&i.addClass(r[0]),d=n.hasAttribute("size")?3<n.size?n.size/1.8:n.size:10,i.css("min-width",d+"em"),i.insertAfter(n),c={handlers:{edit:q,enter:w}},y.hasOwnProperty("getLayoutstyle")?y.curlayoutstyle=y.getLayoutstyle():"auto"==y.layoutstyle?y.curlayoutstyle=v():y.curlayoutstyle=y.layoutstyle,"OSK"==y.curlayoutstyle&&(c.substituteTextarea=function(){var t=document.createElement("span");return t.setAttribute("tabindex",0),t},c.keyboardPassthrough=!0),n.disabled?(l=g.StaticMath(i[0]),i.addClass("disabled")):(l=g.MathField(i[0],c).config(u),b(i),h(n).on("change",function(t,e){if(!e){var a=n.value;y.hasOwnProperty("toMQ")&&(a=y.toMQ(a)),l.latex(a)}}))):(l.show(),l=g(l[0]).latex(s)),!0!==e&&l.focus()):(h(n).attr("type","text"),!0!==e&&h(n).focus(),h("#mqinput-"+o).hide())}function b(t){h(t).find(".mq-textarea > *").on("focus.mqeditor",e).on("blur.mqeditor",function(){l=setTimeout(a,100)}),h(t).on("click.mqeditor",function(t){var e=h(t.target).closest("label");if(0<e.length)return"undefined"!==e.attr("for")&&h("#"+e.attr("for")).prop("checked",!0),t.stopPropagation(),!1})}function e(t){var a,e,n,o,s;clearTimeout(l),a=h(t.target).closest(".mathquill-math-field"),null===f&&(h("body").append(h("<div/>",{id:"mqeditor",class:"mqeditor"})),h("#mqeditor").on("mousedown touchstart",function(t){t.preventDefault()})),e=y.curlayoutstyle,y.hasOwnProperty("getLayoutstyle")?y.curlayoutstyle=y.getLayoutstyle():"auto"==y.layoutstyle?y.curlayoutstyle=v():y.curlayoutstyle=y.layoutstyle,"OSK"===y.curlayoutstyle?(h("#mqeditor").addClass("fixedbottom"),document.getElementById("mqe-fb-spacer")||((n=document.createElement("div")).style.height="200px",n.id="mqe-fb-spacer",h("body").append(n))):h("#mqeditor").removeClass("fixedbottom"),o=!1,null!==f&&a[0]==f.el()&&e===y.curlayoutstyle||(o=!0,null!==f&&h("#"+f.el().id.substring(8)).trigger("change",!0),y.hasOwnProperty("getLayout")&&(y.layout=y.getLayout(a[0],y.curlayoutstyle)),h("#mqeditor").empty().show(),(y.layout.tabs?function(t,e,a){var n,o,s,l,i,r,d=document.createElement("div");d.className="mqed-row mqed-tabrow";n=document.createElement("div"),l=0;t.appendChild(d),t.appendChild(n);for(i=0;i<e.tabs.length;i++)if(!0===e.tabs[i].enabled)for(l++,k(d,e.tabs[i],a+"-"+i),(s=document.createElement("div")).className="mqed-row mqed-tabpanel",s.id=a+"-"+i+"-tabpanel",n.appendChild(s),r=0;r<e.tabs[i].tabcontent.length;r++)(o=e.tabs[i].tabcontent[r]).hasOwnProperty("flow")&&0==o.contents.length||(o.hasOwnProperty("flow")?C:k)(s,o,a+"-"+i+"-"+r);1<l?h(t).find(".mqed-tab").first().addClass("mqed-activetab"):h(d).hide()}:C)(document.getElementById("mqeditor"),y.layout,"mqeditor"),h("#mqeditor .mqed-btn.rend").each(function(){g.StaticMath(this,{mouseEvents:!1})}),0<h("#mqeditor .mqed-tabrow").length&&(h("#mqeditor .mqed-tabpanel").hide().first().show(),(s=h("#mqeditor .mqed-tabrow + div")).css("height",s.height()))),"OSK"===y.curlayoutstyle?h("#mqeditor").slideDown(50,function(){var t=h("#mqeditor").height()+5,e=h(window).height()-(a.offset().top+a.outerHeight()-h(window).scrollTop());e<t&&h(window).scrollTop(h(window).scrollTop()+(t-e))}):h("#mqeditor").show(),i(a),f=g.MathField(a[0]),h("#"+a[0].id.substring(8)).triggerHandler("focus"),y.hasOwnProperty("onShow")&&y.onShow(a[0],y.curlayoutstyle,o)}function a(t){"OSK"===y.curlayoutstyle?h("#mqeditor").slideUp(50):h("#mqeditor").hide(),h("#"+f.el().id.substring(8)).trigger("change",!0)}function i(t){var e,a,n,o,s;"under"==y.curlayoutstyle?(a=(e=h(t).closest(".mathquill-math-field")).offset(),n=e.outerHeight(),o=a.left,document.getElementById("mqeditor")&&o+(s=document.getElementById("mqeditor").offsetWidth)>document.documentElement.clientWidth&&(o=document.documentElement.clientWidth-s-5),h("#mqeditor").css("top",a.top+n+3).css("left",o)):h("#mqeditor").css("top","auto").css("left",0)}function q(t){var e,a=t.el();i(a),a.id.match(/mqinput/)&&(e=t.latex(),y.hasOwnProperty("fromMQ")&&(e=y.fromMQ(e)),h("#"+a.id.substring(8)).val(e).trigger("input"),""!=e&&h("#"+a.id.substring(8)).siblings("input[id^=qs][value=spec]").prop("checked",!0),y.hasOwnProperty("onEdit")&&y.onEdit(a.id,e))}function w(t){y.hasOwnProperty("onEnter")&&y.onEnter(t.el().id)}function v(){var t=document.documentElement.clientWidth;return navigator.userAgent.match(/Android/)||navigator.userAgent.match(/iPhone/)||navigator.userAgent.match(/iPad/)||t<500?"OSK":"under"}function C(t,e,a){var n,o,s,l,i,r,d=e.flow,c=100;for(e.hasOwnProperty("s")&&"row"==d&&(c=e.s),n=document.createElement("div"),e.hasOwnProperty("s")&&(n.style.flexGrow=e.s),e.hasOwnProperty("class")&&(n.className=e.class),e.hasOwnProperty("tabpanel")&&(n.id=e.tabpanel.id,n.style.display=e.tabpanel.hidden?"none":""),(o=document.createElement("div")).className="mqed-"+d,r=i=s=0;r<e.contents.length;r++)(l=e.contents[r]).hasOwnProperty("flow")&&0==l.contents.length||(c<s+(i=l.hasOwnProperty("s")?l.s:1)&&(n.appendChild(o),s=0,(o=document.createElement("div")).className="mqed-"+d),(l.hasOwnProperty("flow")?C:k)(o,l,a+"-"+r),s+=i);n.appendChild(o),t.appendChild(n)}function k(t,e,a){var n,o,s,l,i,r;(o=document.createElement("div")).className="mqed-btn-cont",e.s&&(o.style.flexGrow=e.s),e.contid&&(o.id=e.contid),e.contclass&&h(o).addClass(e.contclass),t.appendChild(o),(e.l||e.b||e.p)&&((n=document.createElement("span")).tabIndex=0,e.l?(n.className="mqed-btn rend",n.innerText=e.l,s="c",l=e.l.substring(1)):e.b?(n.className="mqed-btn rend",n.innerHTML=e.b,s="t",!(l=e.b).match(/^\d$/)&&"."!=l||h(n).addClass("mqed-digitkey")):(n.className="mqed-btn",n.innerHTML=e.p,s="t",l=e.p),e.c&&("shift"==(s=e.c)?h(n).addClass("mqed-shift"):"k"==s&&h(n).addClass("mqed-navkey")),e.sm&&(n.style.fontSize=100-10*e.sm+"%"),e.w&&(l=e.w),e.tabcontent&&(h(n).addClass("mqed-tab"),s="showtabpanel",l=a+"-tabpanel"),h(n).data("cmdtype",s).data("cmdval",l),h(n).on("click mousedown touchstart keydown",(i=s,r=l,function(t){!function t(e,a,n){var o,s,l,i,r,d,c,u;if(("mousedown"!=e.type||"Backspace"===n)&&!("click"==e.type&&"Backspace"===n||"keydown"==e.type&&"Enter"!==e.key))if("touchstart"==e.type&&(e.preventDefault(),h(e.currentTarget).addClass("mactive")),"t"==a)n.match(/^[a-zA-Z]$/)&&h(e.target).closest(".mqed-tabpanel").find(".mqed-shift").hasClass("active")&&(n=n.toUpperCase()),f.typedText(n);else if("c"==a)f.cmd(n);else if("l"==a)f.latex(n);else if("w"==a){if(f.write(n),m=n.match(/bmatrix}(.*?)(\\\\|\\end{bm)/))for(o=m[1].split(/&/).length,s=0;s<o;s++)f.keystroke("Left")}else"k"==a?(f.keystroke(n),"Backspace"===n&&(p=setTimeout(function(){t(e,a,n)},null===p?600:70))):"m"==a?f.matrixCmd(n):"f"==a?(l=f.getSelection())?(f.write(n+"\\left("+l+"\\right)"),f.keystroke("Left")):n.match(/{}$/)?f.typedText(n.replace(/{}$/,"")):f.write(n):"sf"==a?((l=f.getSelection())?f.write(n+"{"+l+"}"):f.cmd(n),f.keystroke("Left")):"i"==a?(l=(l=f.getSelection())||"","string"==typeof n?(i=n.charAt(0),r=n.charAt(1),f.write("\\left"+i+l+"\\right"+r)):f.write(n[0]+l+n[1]),""==l&&f.keystroke("Left")):"showtabpanel"==a?((d=h(e.target).closest(".mqed-btn")).closest(".mqeditor").find(".mqed-tabpanel").hide(),d.closest(".mqeditor").find(".mqed-btn.mqed-activetab").removeClass("mqed-activetab"),h("#"+n).show(),d.addClass("mqed-activetab"),y.hasOwnProperty("onTab")&&y.onTab(d[0],y.curlayoutstyle,n)):"shift"==a&&(d=h(e.target).closest(".mqed-btn"),c=h(e.target).closest(".mqed-tabpanel"),(u=!d.hasClass("active"))?d.addClass("active"):d.removeClass("active"),c.find(".mqed-btn").each(function(t,e){var a=e.textContent;a.match(/^[a-zA-Z]$/)&&(e.textContent=u?e.textContent.toUpperCase():e.textContent.toLowerCase())}))}(t,i,r)})).on("touchend",function(t){setTimeout(function(){h(t.currentTarget).removeClass("mactive")},50)}).on("touchend mouseup",function(){clearTimeout(p),p=null}),o.appendChild(n))}return{setConfig:function(t){for(var e in t)y[e]=t[e]},setMQconfig:function(t){u=t},toggleMQ:n,toggleMQAll:function(t,e){var a=e||null;h(t).each(function(t,e){n(e,a,!0)})},attachEditor:b,getLayoutstyle:v,resetEditor:function(){clearTimeout(l),h("#mqeditor").hide()}}}(jQuery);
var MQ,myMQeditor=function(w){var b={tabs:[{p:"Basic",enabled:!0,tabcontent:[{flow:"row",s:2,contents:[{l:"\\left(\\right)",c:"i",w:"()"},{l:"x^{}",c:"t",w:"^",nb:1},{l:"\\pi",nb:1},{l:"\\sqrt{}",c:"c",w:"sqrt",nb:1},{l:"\\infty"},{l:"\\sqrt[n]{}",c:"c",w:"nthroot",nb:1},{p:"DNE",sm:2},{l:"\\left|\\right|",c:"i",w:"||"}]},{s:.1},{flow:"row",s:4,contents:[{b:"7"},{b:"8"},{b:"9"},{l:"\\frac{}{}",c:"t",w:"/"},{b:"4"},{b:"5"},{b:"6"},{b:"*"},{b:"1"},{b:"2"},{b:"3"},{b:"-"},{b:"0"},{b:"."},{s:1},{b:"+"}]},{s:.1},{flow:"row",s:2,contents:[{s:.5},{b:"&uarr;",c:"k",w:"Up"},{s:.5},{b:"&larr;",c:"k",w:"Left"},{b:"&rarr;",c:"k",w:"Right"},{s:.5},{b:"&darr;",c:"k",w:"Down"},{s:.5},{b:"&#x232B;",s:2,c:"k",w:"Backspace"}]}]},{p:"Funcs",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\log",c:"f"},{l:"\\ln",c:"f"},{l:"\\log_{}",c:"f"},{l:"e^{}",c:"t",w:"e^"}]}]},{p:"Trig",enabled:!1,tabcontent:[{flow:"row",s:6,contents:[{l:"\\sin",c:"f"},{l:"\\cos",c:"f"},{l:"\\tan",c:"f"},{l:"\\sec",c:"f"},{l:"\\csc",c:"f"},{l:"\\cot",c:"f"},{l:"\\sin^{-1}",c:"f"},{l:"\\cos^{-1}",c:"f"},{l:"\\tan^{-1}",c:"f"},{l:"\\sinh",c:"f"},{l:"\\cosh",c:"f"},{l:"\\tanh",c:"f"}]}]},{p:"Inequality",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\lt"},{l:"\\gt"},{l:"\\le"},{l:"\\ge"},{p:"or",c:"w",w:"\\text{ or }"},{p:"DNE",sm:2},{p:"all reals",c:"w",w:"\\text{all reals}",s:2}]}]},{p:"Interval",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\left(\\right)",c:"i",w:"()"},{l:"\\left[\\right]",c:"i",w:"[]"},{l:"\\left(\\right]",c:"i",w:"(]"},{l:"\\left[\\right)",c:"i",w:"[)"},{l:"\\infty"},{l:"-\\infty",c:"w"},{l:"\\cup"},{s:1}]}]},{p:"Matrix",sm:1,enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{p:"2×2",c:"w",w:"\\begin{bmatrix}&\\\\&\\end{bmatrix}"},{p:"2×3",c:"w",w:"\\begin{bmatrix}&&\\\\&&\\end{bmatrix}"},{p:"3×3",c:"w",w:"\\begin{bmatrix}&&\\\\&&\\\\&&\\end{bmatrix}"},{p:"3×4",c:"w",w:"\\begin{bmatrix}&&&\\\\&&&\\\\&&&\\end{bmatrix}"},{p:"+Col",c:"m",w:"addColumn"},{p:"-Col",c:"m",w:"deleteColumn"},{p:"+Row",c:"m",w:"addRow"},{p:"-Row",c:"m",w:"deleteRow"}]}]},{p:"=<%",enabled:!0,tabcontent:[{flow:"row",s:5,contents:[{p:"[",s:.5},{p:"]",s:.5},{p:"{",s:.5},{p:"}",s:.5},{p:"(",s:.5},{p:")",s:.5},{l:"\\left\\langle\\right\\rangle",c:"i",w:["\\left\\langle","\\right\\rangle"]},{l:"\\left|\\right|",c:"i",w:"||"},{p:"="},{l:"\\lt"},{l:"\\gt"},{l:"\\le"},{l:"\\ge"},{p:"%"},{p:","},{p:"*"},{p:"!"},{p:"?"}]}]},{p:"ABC",enabled:!0,tabcontent:[{flow:"row",s:10,contents:[{p:"q"},{p:"w"},{p:"e"},{p:"r"},{p:"t"},{p:"y"},{p:"u"},{p:"i"},{p:"o"},{p:"p"},{s:.5},{p:"a"},{p:"s"},{p:"d"},{p:"f"},{p:"g"},{p:"h"},{p:"j"},{p:"k"},{p:"l"},{s:.5},{b:"&#8679;",c:"shift",s:1.5},{p:"z"},{p:"x"},{p:"c"},{p:"v"},{p:"b"},{p:"n"},{p:"m"},{b:"&#x232B;",c:"k",w:"Backspace",s:1.5},{p:"%"},{p:","},{p:"Space",s:5,c:"t",w:" "},{p:"."},{b:"&larr;",c:"k",w:"Left"},{b:"&rarr;",c:"k",w:"Right"}]}]}]},i={tabs:[{p:"Basic",enabled:!0,tabcontent:[{flow:"row",s:5,contents:[{l:"\\frac{}{}",c:"t",w:"/"},{l:"x^{}",c:"t",w:"^",nb:1},{l:"x_{}",c:"t",w:"_",nb:1},{l:"\\sqrt{}",c:"c",w:"sqrt",nb:1},{l:"\\sqrt[n]{}",c:"c",w:"nthroot",nb:1},{l:"\\left(\\right)",c:"i",w:"()"},{l:"\\left|\\right|",c:"i",w:"||"},{l:"\\pi",nb:1},{l:"\\infty"},{p:"DNE",sm:2}]},{s:.1},{flow:"row",s:2,contents:[{b:"&uarr;",c:"k",w:"Up"},{b:"&darr;",c:"k",w:"Down"},{b:"&larr;",c:"k",w:"Left"},{b:"&rarr;",c:"k",w:"Right"},{b:"&#x232B;",s:2,c:"k",w:"Backspace"}]}]},{p:"Funcs",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\log",c:"f"},{l:"\\ln",c:"f"},{l:"\\log_{}",c:"f"},{l:"e^{}",c:"t",w:"e^"}]}]},{p:"Trig",enabled:!1,tabcontent:[{flow:"row",s:6,contents:[{l:"\\sin",c:"f"},{l:"\\cos",c:"f"},{l:"\\tan",c:"f"},{l:"\\sec",c:"f"},{l:"\\csc",c:"f"},{l:"\\cot",c:"f"},{l:"\\sin^{-1}",c:"f"},{l:"\\cos^{-1}",c:"f"},{l:"\\tan^{-1}",c:"f"},{l:"\\sinh",c:"f"},{l:"\\cosh",c:"f"},{l:"\\tanh",c:"f"}]}]},{p:"Inequality",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\lt"},{l:"\\gt"},{l:"\\le"},{l:"\\ge"},{p:"or",c:"w",w:"\\text{ or }"},{p:"DNE",sm:2},{p:"all reals",c:"w",w:"\\text{all reals}",s:2}]}]},{p:"Interval",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\left(\\right)",c:"i",w:"()"},{l:"\\left[\\right]",c:"i",w:"[]"},{l:"\\left(\\right]",c:"i",w:"(]"},{l:"\\left[\\right)",c:"i",w:"[)"},{l:"\\infty"},{l:"-\\infty",c:"w",w:"-\\infty"},{l:"\\cup"},{s:1}]}]},{p:"Matrix",sm:1,enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{p:"2×2",c:"w",w:"\\begin{bmatrix}&\\\\&\\end{bmatrix}"},{p:"2×3",c:"w",w:"\\begin{bmatrix}&&\\\\&&\\end{bmatrix}"},{p:"3×3",c:"w",w:"\\begin{bmatrix}&&\\\\&&\\\\&&\\end{bmatrix}"},{p:"3×4",c:"w",w:"\\begin{bmatrix}&&&\\\\&&&\\\\&&&\\end{bmatrix}"},{p:"+Col",c:"m",w:"addColumn"},{p:"-Col",c:"m",w:"deleteColumn"},{p:"+Row",c:"m",w:"addRow"},{p:"-Row",c:"m",w:"deleteRow"}]}]}]};return{getLayout:function(t,e){var n,a,c,l,s=t.id.substring(8),o=w("#"+s),r=o.attr("data-mq-vars")||"";return r=""==r?[]:r.split(/,/),a=(n=o.attr("data-mq")).split(/,/)[0],c=[],"OSK"===e?(c=w.extend(!0,[],b),n.match(/\bdecimal/)&&"numfunc"!=a?(c.tabs[0].tabcontent[0].s=1,c.tabs[0].tabcontent[0].contents=[{l:"\\infty"},{p:"DNE",sm:2}],c.tabs[0].tabcontent[2]={flow:"row",s:4,contents:[{b:"7"},{b:"8"},{b:"9"},{s:1},{b:"4"},{b:"5"},{b:"6"},{s:1},{b:"1"},{b:"2"},{b:"3"},{b:"-"},{b:"0"},{b:"."},n.match(/(list|set)/)?{b:","}:{s:1},"calcntuple"===a&&!n.match(/vector/)||n.match(/point/)?{l:"\\left(\\right)",c:"t",w:"("}:{s:1}]}):n.match(/(fraction|mixednumber|fracordec)/)&&"numfunc"!=a?(c.tabs[0].tabcontent[0].s=1,c.tabs[0].tabcontent[0].contents=[{l:"\\frac{n}{}",c:"t",w:"/"},{b:"\\frac{}{}",c:"c",w:"\\frac"},{l:"\\infty"},{p:"DNE",sm:2}],c.tabs[0].tabcontent[2]={flow:"row",s:4,contents:[{b:"7"},{b:"8"},{b:"9"},{s:1},{b:"4"},{b:"5"},{b:"6"},{s:1},{b:"1"},{b:"2"},{b:"3"},{b:"-"},{b:"0"},n.match(/fracordec/)?{b:"."}:{s:1},n.match(/(list|set)/)?{b:","}:{s:1},"calcntuple"===a&&!n.match(/vector/)||n.match(/point/)?{l:"\\left(\\right)",c:"t",w:"("}:{s:1}]}):(n.match(/(list|set)/)||a.match(/(interval|string|ntuple)/)?c.tabs[0].tabcontent[2].contents[14]={b:","}:n.match(/equation/)&&(c.tabs[0].tabcontent[2].contents[14]={b:"="}),n.match(/nodecimal/)&&(c.tabs[0].tabcontent[2].contents[13]={s:1})),0<r.length&&("basic"==(l=function(t){var e,n,a,c;for(e=1,n=[],a=0;a<t.length;a++)t[a]=t[a].replace(/alpha|beta|chi|delta|epsilon|gamma|varphi|phi|psi|sigma|rho|theta|lambda|mu|nu|omega|tau/i,"\\$&"),"\\"!=t[a].charAt(0)&&t[a].length>e&&(e=t[a].length),n.push({b:t[a],c:"w"});c=Math.min(8,Math.max(4,Math.ceil(t.length/4)));t.length%c!=0&&n.push({s:c-t.length%c});return{format:t.length<5&&e<4?"basic":"tab",btns:n,perrow:c}}(r)).format?c.tabs[0].tabcontent.unshift({flow:"row",s:1,contents:l.btns},{s:.1}):c.tabs.splice(1,0,{p:"Vars",enabled:!0,tabcontent:[{flow:"row",s:l.perrow,contents:l.btns}]}))):(c=w.extend(!0,[],i),n.match(/\bdecimal/)?(c.tabs[0].tabcontent[0].s=3,c.tabs[0].tabcontent[0].contents=[{l:"\\infty"},{p:"DNE",sm:2},"calcntuple"===a&&!n.match(/vector/)||n.match(/point/)?{l:"\\left(\\right)",c:"t",w:"("}:{s:1}]):n.match(/(fraction|mixednumber|fracordec)/)&&(c.tabs[0].tabcontent[0].s=4,c.tabs[0].tabcontent[0].contents=[{l:"\\frac{n}{}",c:"t",w:"/"},{l:"\\frac{}{}",c:"c",w:"\\frac"},{l:"\\infty"},{p:"DNE",sm:2}],("calcntuple"===a&&!n.match(/vector/)||n.match(/point/))&&c.tabs[0].tabcontent[0].contents.push({l:"\\left(\\right)",c:"t",w:"("},{s:3}))),n.match(/(fraction|mixednumber|fracordec|\bdecimal)/)||(c.tabs[1].enabled=!0,n.match(/notrig/)||(c.tabs[2].enabled=!0)),a.match(/interval/)?n.match(/inequality/)?c.tabs[3].enabled=!0:c.tabs[4].enabled=!0:"calcmatrix"!=a||n.match(/matrixsized/)?n.match(/set/)?c.tabs[0].tabcontent.unshift({flow:"row",s:1,contents:[{l:"\\lbrace{\\rbrace}",c:"i",w:["\\left\\{","\\right\\}"]}]},{s:.1}):a.match(/complex/)?c.tabs[0].tabcontent.unshift({flow:"row",s:1,contents:[{b:"i"}]},{s:.1}):n.match(/vector/)&&c.tabs[0].tabcontent.unshift({flow:"row",s:1,contents:[{l:"\\left\\langle\\right\\rangle",c:"i",w:["\\left\\langle","\\right\\rangle"]}]},{s:.1}):c.tabs[5].enabled=!0,c},onShow:function(t,e,n){var a,c,l,s,o,r,b,i;n&&"under"===e&&(a=t.id.substring(8),(c=w("#"+a))[0].hasAttribute("data-tip")&&(s=(l=w("#mqeditor .mqed-tabpanel").first()).children("div").last().position().left-12,o=c.attr("data-tip"),r=document.createElement("div"),w(r).html(o),c[0].hasAttribute("aria-describedby")&&(b=c[0].getAttribute("aria-describedby"),document.getElementById(b).textContent!=o&&(i=w("<a>",{href:"#",text:_("[more..]")}).on("click",function(t){return t.preventDefault(),w(t.target).parent().html(w("#"+b).html()),!1}),w(r).append(" ").append(i))),l.parent().css("height","auto").append(w("<div>",{width:s,class:"mqed-tipholder"}).append(r))))},onTab:function(t,e,n){"under"===e&&(n.match(/mqeditor-0-tabpanel/)?w(".mqed-tipholder").show():w(".mqed-tipholder").hide())}}}(jQuery);MQeditor.setConfig({getLayout:myMQeditor.getLayout,onShow:myMQeditor.onShow,onTab:myMQeditor.onTab,toMQ:AMtoMQ,fromMQ:MQtoAM,onEdit:imathasAssess.syntaxCheckMQ,onEnter:imathasAssess.handleMQenter}),(MQ=MathQuill.getInterface(MathQuill.getInterface.MAX)).config({spaceBehavesLikeTab:!0,leftRightIntoCmdGoes:"up",supSubsRequireOperand:!0,charsThatBreakOutOfSupSub:"=<>",charsThatBreakOutOfSupSubVar:"+-(",charsThatBreakOutOfSupSubOp:"+-(",restrictMismatchedBrackets:!0,autoCommands:"pi theta root sqrt ^oo",autoParenOperators:!0,addCommands:{oo:["VanillaSymbol","\\infty ","&infin;"]}});
