var canvases=new Array,drawla=new Array,imathasDraw=function($){var mouseisdown=!1,targets=new Array,imgs=new Array,targetOuts=new Array,lines=new Array,dots=new Array,odots=new Array,tplines=new Array,tptypes=new Array,ineqlines=new Array,ineqtypes=new Array,curLine=null,drawstyle=[],drawlocky=[],curTPcurve=null,curIneqcurve=null,ineqcolors=["rgb(0,0,255)","rgb(255,0,0)","rgb(0,255,0)"],ineqacolors=["rgba(0,0,255,.4)","rgba(255,0,0,.4)","rgba(0,255,0,.4)"],asymcolor="rgb(0,200,0)",dragObj=null,oldpointpos=null,curTarget=null,curCursor=null,nocanvaswarning=!1,hasTouch=!1,didMultiTouch=!1,clickmightbenewcurve=!1,hasTouchTimer=null,tpModeN={5:2,5.1:2,5.2:2,5.3:2,5.4:2,6:2,6.1:2,6.2:2,6.3:2,6.5:2,6.6:2,7:2,7.2:2,7.4:2,7.5:2,8:2,8.2:2,8.3:2,8.4:2,8.5:3,8.6:3,9:2,9.1:2,10:3,10.2:3,10.3:3,10.4:3},tpHasAsymp={7.4:1,7.5:1,8.2:1,8.5:1,8.6:1};function reset(){clearAllDrawListners(),targets.length=0,imgs.length=0,targetOuts.length=0,lines.length=0,dots.length=0,odots.length=0,tplines.length=0,tptypes.length=0,ineqlines.length=0,ineqtypes.length=0,drawstyle.length=0,drawlocky.length=0,curTarget=null,curLine=null,dragObj=null,curTPcurve=null,curIneqcurve=null}function clearcanvas(e,t){targetOuts[e]&&targetOuts[e].disabled&&!t||lines.hasOwnProperty(e)&&(lines[e].length=0,dots[e].length=0,odots[e].length=0,tplines[e].length=0,tptypes[e].length=0,ineqlines[e].length=0,ineqtypes[e].length=0,curTarget=e,"canvas"==targets[e].type&&drawTarget(),curTarget=null,curLine=null,dragObj=null)}function clearlastline(e){lines[e].length>0&&(lines[e].length=lines[e].length-1),curTarget=e,drawTarget(),curTarget=null,curLine=null,dragObj=null}function addA11yTarget(e,t,r){var a=e[0],n=e[13].split(","),i=!0;"noprev"==n[n.length-1]&&(i=!1,n.pop());var s=e[2],l=e[3],u=e[4],g=e[5];u==g&&(u=-1,g=1);var o=e[6],c=e[7],d=e[8],T=document.getElementById("a11ydraw"+a);if(null==T){var p=document.getElementById("canvas"+a);if(p&&!i){var h=$("<div>").append($("<p>",{text:_("Drawn Elements:")}));(T=document.createElement("ul")).setAttribute("id","allydraw"+a),h.append(T),$(p).replaceWith(h)}}targetOuts[a]=document.getElementById("qn"+a);var m,y=!!document.getElementById("a11ydrawnew"+a);targetOuts[a].disabled&&(y&&(document.getElementById("a11ydrawnew"+a).disabled=!0),$(".a11ydrawadd[data-qn="+a+"]").prop("disabled",!0)),targets[a]={type:"a11y",el:T,vispreview:i,xmin:s,xmax:l,ymin:u,ymax:g,imgborder:o,imgwidth:c,imgheight:d},i&&(targets[a].canv=document.getElementById("canvas"+a)),targets[a].pixperx=(c-2*o)/(l-s),targets[a].pixpery=u==g?1:(d-2*o)/(g-u),"inequality"==n[0]?(m=n.shift(),0==n.length?n=["line"]:"both"==n[0]&&(n=["line","parab"])):"twopoint"==n[0]?(m=n.shift(),0==n.length&&(n=["line","parab","abs","circle","dot"])):"numberline"==n[0]?(m="basic",n.shift()):m="basic",targets[a].afgroup=m;var v={inequality:{line:[{mode:10,descr:_("Linear inequality with solid line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")},{mode:10.2,descr:_("Linear inequality with dashed line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")}],parab:[{mode:10.3,descr:_("Parabolic inequality with solid line"),inN:3,input:_("Enter the vertex, then another point on the parabola, then a third point in the shaded region")},{mode:10.4,descr:_("Parabolic inequality with dashed line"),inN:3,input:_("Enter the vertex, then another point on the parabola, then a third point in the shaded region")}],abs:[{mode:10.5,descr:_("Absolute value inequality with solid line"),inN:3,input:_("Enter the corner point of the absolute value, then another point on the graph, then a third point in the shaded region")},{mode:10.6,descr:_("Absolute value inequality with dashed line"),inN:3,input:_("Enter the corner point of the absolute value, then another point on the graph, then a third point in the shaded region")}]},twopoint:{line:[{mode:5,descr:_("Line"),inN:2,input:_("Enter two points on the line")}],dashline:[{mode:5.1,descr:_("Dashed Line"),inN:2,input:_("Enter two points on the dashed line")}],lineseg:[{mode:5.3,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],ray:[{mode:5.2,descr:_("Ray"),inN:2,input:_("Enter the starting point of the ray and another point on the ray")}],parab:[{mode:6,descr:_("Parabola"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],horizparab:[{mode:6.1,descr:_("Parabola opening right or left"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],halfparab:[{mode:6.2,descr:_("Half Parabola"),inN:2,input:_("Enter the vertex, then another point on the half parabola")}],cubic:[{mode:6.3,descr:_("Cubic"),inN:2,input:_("Enter the inflection point, then another point on the cubic")}],sqrt:[{mode:6.5,descr:_("Square root"),inN:2,input:_("Enter the starting point of the square root, then another point on the graph")}],cuberoot:[{mode:6.6,descr:_("Cube root"),inN:2,input:_("Enter the inflection point of the cube root, then another point on the graph")}],abs:[{mode:8,descr:_("Absolute value"),inN:2,input:_("Enter the corner point of the absolute value, then another point on the graph")}],rational:[{mode:8.2,descr:_("Rational"),inN:2,input:_("Enter the point where the vertical and horizontal asymptote cross, then a point on the graph")}],exp:[{mode:8.3,descr:_("Exponential"),inN:2,input:_("Enter two points on the graph")}],log:[{mode:8.4,descr:_("Logarithm"),inN:2,input:_("Enter two points on the graph")}],genexp:[{mode:8.5,descr:_("Shifted Exponential"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],genlog:[{mode:8.6,descr:_("Shifted Logarithm"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],circle:[{mode:7,descr:_("Circle"),inN:2,input:_("Enter the center point of the circle, then a point on the graph")}],ellipse:[{mode:7.2,descr:_("Ellipse"),inN:2,input:_("Enter the center point of the ellipse, then a point offset from the center by the horizontal radius and vertical radius")}],hyperbola:[{mode:7.4,descr:_("Vertical hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the co-vertex and y is the y-coordinate of the vertex")},{mode:7.5,descr:_("Horizontal hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the vertex and y is the y-coordinate of the co-vertex")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],trig:[{mode:9,descr:_("Cosine"),inN:2,input:_("Enter a point at the start of a phase, then a point half a phase further")},{mode:9.1,descr:_("Sine"),inN:2,input:_("Enter a point at the start of a phase, then a point a quarter phase further")}],vector:[{mode:5.4,descr:_("Vector"),inN:2,input:_("Enter the starting and ending point of the vector")}]},basic:{line:[{mode:0,descr:_("Lines"),inN:"list",input:_("Enter a list of points to connect with lines")}],lineseg:[{mode:.5,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],freehand:[{mode:.7,descr:_("Freehand"),inN:"list",input:_("Enter a list of points to connect with lines")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],polygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter a list of points for dots to connect with lines"),dotline:1}],closedpolygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter a list of points for dots to connect with lines"),dotline:2}]}};null==lines[a]&&(lines[a]=new Array),null==dots[a]&&(dots[a]=new Array),null==odots[a]&&(odots[a]=new Array),null==tplines[a]&&(tplines[a]=new Array),null==tptypes[a]&&(tptypes[a]=new Array),null==ineqlines[a]&&(ineqlines[a]=new Array),null==ineqtypes[a]&&(ineqtypes[a]=new Array);for(var f,w,b=[],q=[],x=[],M=0;M<n.length;M++)if(v[m].hasOwnProperty(n[M])){0==M&&(f=v[m][n[M]][0].mode);for(var O=0;O<v[m][n[M]].length;O++)x[v[m][n[M]][O].mode]=v[m][n[M]][O],b.push(v[m][n[M]][O].mode),w='<option value="'+v[m][n[M]][O].mode+'"',w+=' data-af="'+n[M]+'">'+v[m][n[M]][O].descr+"</option>",q.push(w)}if(y&&(document.getElementById("a11ydrawnew"+a).innerHTML=q),targets[a].defmode=f,targets[a].inputmodes=b,targets[a].selects=q,targets[a].moderef=x,y||!i)if(null==t&&lines.hasOwnProperty(a)){for(M=0;M<lines[a].length;M++)adda11ydraw(a,0,pixcoordstopointlist(lines[a][M],a));for(M=0;M<dots[a].length;M++)adda11ydraw(a,1,pixcoordstopointlist(dots[a][M],a));for(M=0;M<odots[a].length;M++)adda11ydraw(a,2,pixcoordstopointlist(odots[a][M],a));for(M=0;M<tplines[a].length;M++)adda11ydraw(a,tptypes[a][M],pixcoordstopointlist(tplines[a][M][0],a)+","+pixcoordstopointlist(tplines[a][M][1],a));for(M=0;M<ineqlines[a].length;M++)adda11ydraw(a,ineqtypes[a][M],pixcoordstopointlist(ineqlines[a][M][0],a)+","+pixcoordstopointlist(ineqlines[a][M][1],a)+","+pixcoordstopointlist(ineqlines[a][M][2],a))}else if(null!=t)for(M=0;M<t.length;M++)adda11ydraw(a,t[M][0],t[M][1].replace(/\[/g,"(").replace(/\]/g,")"));i&&initBackground(targets[a].canv,a,r,c,d,!0)}function adda11ydraw(e,t,r){var a=targets[e],n=t||document.getElementById("a11ydrawnew"+e).value,i=r||"",s=(a.afgroup,a.el.getElementsByTagName("li").length+1),l=targetOuts[e].disabled?" disabled ":"",u='<span class="sr-only draweln">'+_("Drawing element ")+s+"</span>";html=u,html+=a.moderef[n].descr+".<br/>",html+='<label><span class="a11ydrawinstr"></span><br/>',html+='<input type="text" value="'+i+'" data-n="'+a.moderef[n].inN+'" '+l,html+='onblur="imathasDraw.updatea11ydraw(this)"/></label>',html+='<button type="button" class="imgbutton" onclick="imathasDraw.removea11ydraw(this)"'+l+">",html+=_("Remove")+" "+u+"</button>";var g=$("<li>",{class:"a11ydrawrow","data-mode":n}).html(html);$(a.el).append(g),g.find(".a11ydrawinstr").text(a.moderef[n].input),r||g.find("input").focus()}function removea11ydraw(e){setariastatus(_("Removed drawing element"));var t=$(e).closest("ul");$(e).parent().remove(),t.find("li").each((function(e,t){var r=_("Drawing element ")+(e+1);$(t).find(".draweln").html(r)})),t.prev().focus(),encodea11ydraw(t.attr("id").substring(8))}function changea11ydraw(e,t){var r=$(e).val(),a=targets[t].moderef[r];$(e).closest("li").find(".a11ydrawinstr").text(a.input),encodea11ydraw()}function updatea11ydraw(e){var t=0,r=e.value.trim();"("==r.charAt(0)&&")"==r.slice(-1)||(t|=1);var a=r.slice(1,-1).split(/\)\s*,\s*\(/),n=e.getAttribute("data-n");n.match(/\d/)&&a.length!=parseInt(n)&&(t|=2);for(var i=0;i<a.length;i++){var s=a[i].split(/,/);2!=s.length&&(t|=1);for(var l=0;l<s.length;l++)0==s[l].trim().length&&(t|=1)}if("noticetext"==e.parentNode.parentNode.lastChild.className&&e.parentNode.parentNode.removeChild(e.parentNode.parentNode.lastChild),t){e.setAttribute("aria-invalid",!0);var u=document.createElement("span");u.id=uniqid("a11ydrawerr"),u.className="noticetext",1&~t?(u.innerHTML="<br>"+_("Error: Incorrect number of points. Expecting ")+n,setariastatus(_("Error: Incorrect number of points"))):(u.innerHTML="<br>"+_("Error: Invalid format for points. Give points as open parenthesis number comma number close parenthesis. Separate points with a comma."),setariastatus(_("Error: Invalid format for points"))),e.parentNode.parentNode.appendChild(u),e.setAttribute("aria-describedby",u.id)}else e.removeAttribute("aria-invalid"),e.removeAttribute("aria-describedby"),setariastatus("");encodea11ydraw(parseInt($(e).closest(".a11ydraw").attr("id").substring(8)))}function pixcoordstopointlist(e,t){var r,a,n=targets[t];return r=(e[0]-n.imgborder)/n.pixperx+n.xmin,a=(n.imgheight-e[1]-n.imgborder)/n.pixpery+n.ymin,"("+(r=Math.round(100*r)/100)+","+(a=Math.round(100*a)/100)+")"}function encodea11ydraw(qn){void 0===qn&&(qn=-1);var oldCurTarget=curTarget;for(var tarnum in targets)if(!(qn>-1&&qn!=tarnum)){var thistarg=targets[tarnum];if("a11y"==thistarg.type){qn>-1&&qn==tarnum&&(curTarget=tarnum),lines[tarnum].length=0,dots[tarnum].length=0,odots[tarnum].length=0,tplines[tarnum].length=0,tptypes[tarnum].length=0,ineqlines[tarnum].length=0,ineqtypes[tarnum].length=0;var enclines=[],encdots=[],encodots=[],enctplines=[],enctpineq=[],saveinput=[],afgroup=targets[tarnum].afgroup;$("#a11ydraw"+tarnum).find(".a11ydrawrow").each((function(i,el){var input=$(el).find("input").val(),mode=el.getAttribute("data-mode"),expectedn=$(el).find("input").attr("data-n");saveinput.push("["+mode+',"'+input+'"]'),input=input.replace(/[\(\)]/g,"").split(/\s*,\s*/);for(var outpts=[],outptsraw=[],i=1;i<input.length;i+=2){if("oo"===input[i-1])input[i-1]=thistarg.imgwidth-2*thistarg.imgborder-1;else if("-oo"===input[i-1])input[i-1]=1;else try{input[i-1]=eval(prepWithMath(mathjs(input[i-1])))}catch(e){input[i-1]=NaN}try{input[i]=eval(prepWithMath(mathjs(input[i])))}catch(e){input[i]=NaN}input[i-1]=(input[i-1]-thistarg.xmin)*thistarg.pixperx+thistarg.imgborder,input[i]=thistarg.imgheight-(input[i]-thistarg.ymin)*thistarg.pixpery-thistarg.imgborder,outpts.push(Math.round(input[i-1])+","+Math.round(input[i])),outptsraw.push([input[i-1],input[i]])}"list"!==expectedn&&expectedn!=outpts.length||(1==mode?(encdots.push("("+outpts.join("),(")+")"),dots[tarnum].push(outptsraw)):2==mode?(encodots.push("("+outpts.join("),(")+")"),odots[tarnum].push(outptsraw)):mode<1?(enclines.push("("+outpts.join("),(")+")"),lines[tarnum].push(outptsraw)):mode>=5&&mode<10?(enctplines.push("("+mode+","+outpts.join(",")+")"),tplines[tarnum].push(outptsraw),tptypes[tarnum].push(mode)):mode>=10&&(enctpineq.push("("+mode+","+outpts.join(",")+")"),ineqlines[tarnum].push(outptsraw),ineqtypes[tarnum].push(mode)))})),targetOuts[tarnum].value=enclines.join(";")+";;"+encdots.join(",")+";;"+encodots.join(",")+";;"+enctplines.join(",")+";;"+enctpineq.join(",")+";;"+saveinput.join(","),$(targetOuts[tarnum]).trigger("input").trigger("change")}}qn>-1&&targets[qn].vispreview&&drawTarget(null,null,!0),curTarget=oldCurTarget}function addTarget(e,t,r,a,n,i,s,l,u,g,o,c,d,T,p){var h=document.getElementById(t);$(h).is(":hidden")&&$(h).on("mouseover.imathasdrawwait touchstart.imathasdrawwait",(function(){$(h).off("mouseover.imathasdrawwait touchstart.imathasdrawwait"),initCanvases(e)})),h.style.userSelect="none",h.style.webkitUserSelect="none",h.style.MozUserSelect="none";var m=getPosition(h);targets[e]={type:"canvas",el:h,left:m.x,top:m.y,width:h.offsetWidth,height:h.offsetHeight,xmin:n,xmax:i,ymin:s,ymax:l,imgborder:u,imgwidth:g,imgheight:o,mode:c,dotline:d},"string"==typeof p&&-1!=p.indexOf(":")?(p=p.split(":"),targets[e].snaptogridx=1*p[0],targets[e].snaptogridy=1*p[1]):(targets[e].snaptogridx=1*p,targets[e].snaptogridy=1*p),targets[e].pixperx=(g-2*u)/(i-n),targets[e].pixpery=s==l?1:(o-2*u)/(l-s),targetOuts[e]=document.getElementById(a),null==lines[e]&&(lines[e]=new Array),null==dots[e]&&(dots[e]=new Array),null==odots[e]&&(odots[e]=new Array),null==tplines[e]&&(tplines[e]=new Array),null==tptypes[e]&&(tptypes[e]=new Array),null==ineqlines[e]&&(ineqlines[e]=new Array),null==ineqtypes[e]&&(ineqtypes[e]=new Array),drawstyle[e]=c>=5?1:0,drawlocky[e]=T,initBackground(h,e,r,g,o,!1)}function initBackground(e,t,r,a,n,i){if(r.match(/initPicture/)){0==$(e).closest(".drawcanvasholder").length&&($(e).removeClass("drawcanvas").wrap($("<div>",{class:"drawcanvas",style:"position:relative;width:"+a+"px;height:"+n+"px"})).wrap($("<div>",{class:"drawcanvasholder",style:"position:absolute;top:0;left:0;z-index:2"})),$(e).closest(".drawcanvas").prepend($("<div>",{class:"canvasbg",style:"position:absolute;top:0;left:0"}).append($("<embed>",{"data-nomag":1,type:"image/svg+xml",align:"middle",width:a,height:n,script:r}).attr("width",a).attr("height",n)))),imgs[t]=null;var s=curTarget;curTarget=t,drawTarget(null,null,i),setTimeout((function(){window.drawPics($(e).closest(".drawcanvas")[0])}),30),curTarget=s}else if(""!==r)imgs[t]=new Image,imgs[t].onload=function(){var e=curTarget;curTarget=t,drawTarget(null,null,i),curTarget=e},imgs[t].src=r;else{imgs[t]=null;s=curTarget;curTarget=t,drawTarget(null,null,i),curTarget=s}}function settool(e,t,r){for(var a=document.getElementById("drawtools"+t),n=a.getElementsByTagName("span"),i=0;i<n.length;i++)n[i].className="";n=a.getElementsByTagName("img");for(i=0;i<n.length;i++)n[i].className="";e.className="sel",setDrawMode(t,r),curTarget=t,drawTarget()}function setDrawMode(e,t){targets[e].mode=t}function setDotLine(e,t){targets[e].dotline=t}function drawTarget(e,t,r){try{if(targets[curTarget].canv)var a=targets[curTarget].canv.getContext("2d");else a=targets[curTarget].el.getContext("2d")}catch(e){nocanvaswarning||(nocanvaswarning=!0,alert("Your browser does not support drawing answer entry.  Please try again using Internet Explorer 6+ (Windows), FireFox 1.5+ (Win/Mac), Safari 1.3+ (Mac), Opera 9+ (Win/Mac), or Camino (Mac)"))}a.fillStyle="rgb(0,0,255)",a.lineWidth=2,a.strokeStyle="rgb(0,0,255)",a.clearRect(0,0,targets[curTarget].imgwidth,targets[curTarget].imgheight),null!==imgs[curTarget]&&a.drawImage(imgs[curTarget],0,0),a.beginPath();for(var n=0;n<ineqlines[curTarget].length;n++){var i=n%3;a.strokeStyle=ineqcolors[i],a.fillStyle=ineqcolors[i];var s=null,l=null,u=null,g=null,o=null;if(3==ineqlines[curTarget][n].length?(l=ineqlines[curTarget][n][1][0],g=ineqlines[curTarget][n][1][1],u=ineqlines[curTarget][n][2][0],o=ineqlines[curTarget][n][2][1]):2==ineqlines[curTarget][n].length?(l=ineqlines[curTarget][n][1][0],g=ineqlines[curTarget][n][1][1],u=e,o=t):curIneqcurve==n&&null!=e&&1==ineqlines[curTarget][n].length&&(l=e,g=t),null!=u){if(a.save(),a.fillStyle=ineqacolors[i],a.beginPath(),ineqtypes[curTarget][n]<=10.2){if(l!=ineqlines[curTarget][n][0][0])s=(g-ineqlines[curTarget][n][0][1])/(l-ineqlines[curTarget][n][0][0]);if(Math.abs(l-ineqlines[curTarget][n][0][0])<1||Math.abs(s)>100)a.moveTo(ineqlines[curTarget][n][0][0],0),a.lineTo(ineqlines[curTarget][n][0][0],targets[curTarget].imgheight),u>l?(a.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight),a.lineTo(targets[curTarget].imgwidth,0),a.closePath()):(a.lineTo(0,targets[curTarget].imgheight),a.lineTo(0,0),a.closePath());else{var c=s*(u-l)+g,d=ineqlines[curTarget][n][0][1]-s*ineqlines[curTarget][n][0][0],T=ineqlines[curTarget][n][0][1]+s*(targets[curTarget].imgwidth-ineqlines[curTarget][n][0][0]);a.moveTo(0,d),a.lineTo(targets[curTarget].imgwidth,T),o>c?(a.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight),a.lineTo(0,targets[curTarget].imgheight),a.closePath()):(a.lineTo(targets[curTarget].imgwidth,0),a.lineTo(0,0),a.closePath())}}else if(ineqtypes[curTarget][n]<=10.4)shadeParabola(a,ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],l,g,u,o,targets[curTarget].imgwidth,targets[curTarget].imgheight);else if(Math.abs(l-ineqlines[curTarget][n][0][0])>1){s=(g-ineqlines[curTarget][n][0][1])/(l-ineqlines[curTarget][n][0][0]);l<ineqlines[curTarget][n][0][0]&&(s*=-1);c=s*Math.abs(u-ineqlines[curTarget][n][0][0])+ineqlines[curTarget][n][0][1],d=ineqlines[curTarget][n][0][1]+s*ineqlines[curTarget][n][0][0],T=ineqlines[curTarget][n][0][1]+s*(targets[curTarget].imgwidth-ineqlines[curTarget][n][0][0]);o>c?(a.moveTo(targets[curTarget].imgwidth,targets[curTarget].imgheight),a.lineTo(0,targets[curTarget].imgheight)):(a.moveTo(targets[curTarget].imgwidth,0),a.lineTo(0,0)),a.lineTo(0,d),a.lineTo(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1]),a.lineTo(targets[curTarget].imgwidth,T)}a.fill(),a.restore()}if(a.beginPath(),null!=l)if(ineqtypes[curTarget][n]<=10.2){if(l!=ineqlines[curTarget][n][0][0])s=(g-ineqlines[curTarget][n][0][1])/(l-ineqlines[curTarget][n][0][0]);if(Math.abs(l-ineqlines[curTarget][n][0][0])<1||Math.abs(s)>100)10.2==ineqtypes[curTarget][n]?null!=dragObj&&dragObj.mode>=10&&dragObj.mode<11&&dragObj.num==n&&0==dragObj.subnum?(a.dashedLine(ineqlines[curTarget][n][1][0],ineqlines[curTarget][n][1][1],ineqlines[curTarget][n][1][0],targets[curTarget].imgheight),a.dashedLine(ineqlines[curTarget][n][1][0],ineqlines[curTarget][n][1][1],ineqlines[curTarget][n][1][0],0)):(a.dashedLine(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],ineqlines[curTarget][n][0][0],targets[curTarget].imgheight),a.dashedLine(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],ineqlines[curTarget][n][0][0],0)):(a.moveTo(ineqlines[curTarget][n][0][0],0),a.lineTo(ineqlines[curTarget][n][0][0],targets[curTarget].imgheight),a.stroke());else{d=ineqlines[curTarget][n][0][1]-s*ineqlines[curTarget][n][0][0],T=ineqlines[curTarget][n][0][1]+s*(targets[curTarget].imgwidth-ineqlines[curTarget][n][0][0]);10.2==ineqtypes[curTarget][n]?null!=dragObj&&dragObj.mode>=10&&dragObj.mode<11&&dragObj.num==n&&0==dragObj.subnum?(a.dashedLine(ineqlines[curTarget][n][1][0],ineqlines[curTarget][n][1][1],targets[curTarget].imgwidth,T),a.dashedLine(ineqlines[curTarget][n][1][0],ineqlines[curTarget][n][1][1],0,d)):(a.dashedLine(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],targets[curTarget].imgwidth,T),a.dashedLine(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],0,d)):(a.moveTo(0,d),a.lineTo(targets[curTarget].imgwidth,T),a.stroke())}}else if(ineqtypes[curTarget][n]<=10.4)if(10.3==ineqtypes[curTarget][n]){if(l!=ineqlines[curTarget][n][0][0])if(g==ineqlines[curTarget][n][0][1])a.moveTo(0,g),a.lineTo(targets[curTarget].imgwidth,g);else{var p=(g-ineqlines[curTarget][n][0][1])/((l-ineqlines[curTarget][n][0][0])*(l-ineqlines[curTarget][n][0][0]));if(g>ineqlines[curTarget][n][0][1])var h=Math.sqrt((targets[curTarget].imgheight-ineqlines[curTarget][n][0][1])/p)+ineqlines[curTarget][n][0][0],m=-1*Math.sqrt((targets[curTarget].imgheight-ineqlines[curTarget][n][0][1])/p)+ineqlines[curTarget][n][0][0],y=ineqlines[curTarget][n][0][1]-(targets[curTarget].imgheight-ineqlines[curTarget][n][0][1]),v=targets[curTarget].imgheight;else h=Math.sqrt((0-ineqlines[curTarget][n][0][1])/p)+ineqlines[curTarget][n][0][0],m=-1*Math.sqrt((0-ineqlines[curTarget][n][0][1])/p)+ineqlines[curTarget][n][0][0],y=2*ineqlines[curTarget][n][0][1],v=0;var f=(j=h+2/3*(ineqlines[curTarget][n][0][0]-h))+(m-h)/3,w=E=v+2/3*(y-v);a.moveTo(h,v),a.bezierCurveTo(j,E,f,w,m,v)}a.stroke()}else l!=ineqlines[curTarget][n][0][0]&&dashedParabola(a,ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],l,g,targets[curTarget].imgwidth,targets[curTarget].imgheight);else if(l!=ineqlines[curTarget][n][0][0]){s=(g-ineqlines[curTarget][n][0][1])/(l-ineqlines[curTarget][n][0][0]);l<ineqlines[curTarget][n][0][0]&&(s*=-1);d=ineqlines[curTarget][n][0][1]+s*ineqlines[curTarget][n][0][0],T=ineqlines[curTarget][n][0][1]+s*(targets[curTarget].imgwidth-ineqlines[curTarget][n][0][0]);10.6==ineqtypes[curTarget][n]?(null!=dragObj&&dragObj.mode>=10&&dragObj.mode<11&&dragObj.num==n&&dragObj.subnum,a.dashedLine(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],targets[curTarget].imgwidth,T),a.dashedLine(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],0,d)):(a.moveTo(0,d),a.lineTo(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1]),a.lineTo(targets[curTarget].imgwidth,T),a.stroke())}if(ineqtypes[curTarget][n]==targets[curTarget].mode){a.beginPath();for(var b=0;b<ineqlines[curTarget][n].length;b++)2==b?(a.arc(ineqlines[curTarget][n][b][0],ineqlines[curTarget][n][b][1],4,0,2*Math.PI,!0),a.fill()):a.fillRect(ineqlines[curTarget][n][b][0]-3,ineqlines[curTarget][n][b][1]-3,6,6);1==ineqlines[curTarget][n].length&&null!=l&&a.fillRect(l-3,g-3,6,6)}a.beginPath()}a.fillStyle="rgb(0,0,255)",1==drawlocky[curTarget]?a.lineWidth=4:a.lineWidth=2,a.strokeStyle="rgb(0,0,255)";for(n=0;n<tplines[curTarget].length;n++){if(tptypes[curTarget][n]>=5&&tptypes[curTarget][n]<6){var q;s=null,l=null,g=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l)if(5.3==tptypes[curTarget][n]||5.4==tptypes[curTarget][n]){if(a.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),a.lineTo(l,g),5.4==tptypes[curTarget][n]){var x=[l-tplines[curTarget][n][0][0],g-tplines[curTarget][n][0][1]],M=Math.sqrt(x[0]*x[0]+x[1]*x[1]);M>1e-4&&(q=[-(x=[x[0]/M,x[1]/M])[1],x[0]],a.moveTo(l-15*x[0]-4*q[0],g-15*x[1]-5*q[1]),a.lineTo(l,g),a.moveTo(l-15*x[0]+4*q[0],g-15*x[1]+5*q[1]),a.lineTo(l,g))}}else{if(l!=tplines[curTarget][n][0][0])s=(g-tplines[curTarget][n][0][1])/(l-tplines[curTarget][n][0][0]);if(Math.abs(l-tplines[curTarget][n][0][0])<1||Math.abs(s)>100)5.1==tptypes[curTarget][n]?a.dashedLine(tplines[curTarget][n][0][0],0,tplines[curTarget][n][0][0],targets[curTarget].imgheight):5.2==tptypes[curTarget][n]?(a.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),g>tplines[curTarget][n][0][1]?a.lineTo(tplines[curTarget][n][0][0],targets[curTarget].imgheight):a.lineTo(tplines[curTarget][n][0][0],0)):(a.moveTo(tplines[curTarget][n][0][0],0),a.lineTo(tplines[curTarget][n][0][0],targets[curTarget].imgheight));else{d=tplines[curTarget][n][0][1]-s*tplines[curTarget][n][0][0],T=tplines[curTarget][n][0][1]+s*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0]),d=tplines[curTarget][n][0][1]-s*tplines[curTarget][n][0][0],T=tplines[curTarget][n][0][1]+s*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0]);5.1==tptypes[curTarget][n]?(a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],targets[curTarget].imgwidth,T),a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],0,d)):5.2==tptypes[curTarget][n]?(a.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),l>tplines[curTarget][n][0][0]?a.lineTo(targets[curTarget].imgwidth,T):a.lineTo(0,d)):(a.moveTo(0,d),a.lineTo(targets[curTarget].imgwidth,T))}}}else if(6==tptypes[curTarget][n]||6.1==tptypes[curTarget][n]||6.2==tptypes[curTarget][n]){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l)if(6==tptypes[curTarget][n])if(g==tplines[curTarget][n][0][1])a.moveTo(0,g),a.lineTo(targets[curTarget].imgwidth,g);else if(l==tplines[curTarget][n][0][0])a.moveTo(l,tplines[curTarget][n][0][1]),g>tplines[curTarget][n][0][1]?a.lineTo(l,targets[curTarget].imgheight):a.lineTo(l,0);else{p=(g-tplines[curTarget][n][0][1])/((l-tplines[curTarget][n][0][0])*(l-tplines[curTarget][n][0][0]));if(g>tplines[curTarget][n][0][1])h=Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][n][0][1])/p)+tplines[curTarget][n][0][0],m=-1*Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][n][0][1])/p)+tplines[curTarget][n][0][0],y=tplines[curTarget][n][0][1]-(targets[curTarget].imgheight-tplines[curTarget][n][0][1]),v=targets[curTarget].imgheight;else h=Math.sqrt((0-tplines[curTarget][n][0][1])/p)+tplines[curTarget][n][0][0],m=-1*Math.sqrt((0-tplines[curTarget][n][0][1])/p)+tplines[curTarget][n][0][0],y=2*tplines[curTarget][n][0][1],v=0;f=(j=h+2/3*(tplines[curTarget][n][0][0]-h))+(m-h)/3,w=E=v+2/3*(y-v);a.moveTo(h,v),a.bezierCurveTo(j,E,f,w,m,v)}else if(6.1==tptypes[curTarget][n])if(l==tplines[curTarget][n][0][0])a.moveTo(l,0),a.lineTo(l,targets[curTarget].imgheight);else if(g==tplines[curTarget][n][0][1])a.moveTo(tplines[curTarget][n][0][0],g),l>tplines[curTarget][n][0][0]?a.lineTo(targets[curTarget].imgwidth,g):a.lineTo(0,g);else{p=(l-tplines[curTarget][n][0][0])/((g-tplines[curTarget][n][0][1])*(g-tplines[curTarget][n][0][1]));if(l>tplines[curTarget][n][0][0]){h=Math.sqrt((targets[curTarget].imgwidth-tplines[curTarget][n][0][0])/p)+tplines[curTarget][n][0][1],m=-1*Math.sqrt((targets[curTarget].imgwidth-tplines[curTarget][n][0][0])/p)+tplines[curTarget][n][0][1];var O=tplines[curTarget][n][0][0]-(targets[curTarget].imgwidth-tplines[curTarget][n][0][0]),L=targets[curTarget].imgwidth}else h=Math.sqrt((0-tplines[curTarget][n][0][0])/p)+tplines[curTarget][n][0][1],m=-1*Math.sqrt((0-tplines[curTarget][n][0][0])/p)+tplines[curTarget][n][0][1],O=2*tplines[curTarget][n][0][0],L=0;w=(E=h+2/3*(tplines[curTarget][n][0][1]-h))+(m-h)/3,f=j=L+2/3*(O-L);a.moveTo(L,h),a.bezierCurveTo(j,E,f,w,L,m)}else if(6.2==tptypes[curTarget][n])if(g==tplines[curTarget][n][0][1])a.moveTo(tplines[curTarget][n][0][0],g),a.lineTo(l<tplines[curTarget][n][0][0]?0:targets[curTarget].imgwidth,g);else if(l==tplines[curTarget][n][0][0])a.moveTo(l,tplines[curTarget][n][0][1]),g>tplines[curTarget][n][0][1]?a.lineTo(l,targets[curTarget].imgheight):a.lineTo(l,0);else{p=(g-tplines[curTarget][n][0][1])/((l-tplines[curTarget][n][0][0])*(l-tplines[curTarget][n][0][0])),tplines[curTarget][n][0][0];if(g>tplines[curTarget][n][0][1]){var P=Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][n][0][1])/p);v=targets[curTarget].imgheight}else P=Math.sqrt((0-tplines[curTarget][n][0][1])/p),v=0;l<tplines[curTarget][n][0][0]&&(P*=-1);var j=tplines[curTarget][n][0][0]+1/3*P,E=tplines[curTarget][n][0][1];f=tplines[curTarget][n][0][0]+2/3*P,w=tplines[curTarget][n][0][1]+1/3*p*P*P;a.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),a.bezierCurveTo(j,E,f,w,tplines[curTarget][n][0][0]+P,v)}}else if(6.5==tptypes[curTarget][n]){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l&&l!=tplines[curTarget][n][0][0])if(g==tplines[curTarget][n][0][1])a.moveTo(tplines[curTarget][n][0][0],g),l>tplines[curTarget][n][0][0]?a.lineTo(targets[curTarget].imgwidth,g):a.lineTo(0,g);else{var I=l<tplines[curTarget][n][0][0]?-1:1;p=(g-tplines[curTarget][n][0][1])/Math.sqrt(I*(l-tplines[curTarget][n][0][0]));a.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),N=tplines[curTarget][n][0][0],_=tplines[curTarget][n][0][1];do{N+=3*I,_=p*Math.sqrt(I*(N-tplines[curTarget][n][0][0]))+tplines[curTarget][n][0][1],a.lineTo(N,_)}while(N>0&&N<targets[curTarget].imgwidth&&_>0&&_<targets[curTarget].imgheight)}}else if(6.3==tptypes[curTarget][n]){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l&&l!=tplines[curTarget][n][0][0])if(g==tplines[curTarget][n][0][1])a.moveTo(0,g),a.lineTo(targets[curTarget].imgwidth,g);else{p=(g-tplines[curTarget][n][0][1])/safepow(l-tplines[curTarget][n][0][0],3);for(var _=0,N=0;N<targets[curTarget].imgwidth+4;N+=1)(_=p*safepow(N-tplines[curTarget][n][0][0],3)+tplines[curTarget][n][0][1])<-100&&(_=-100),_>targets[curTarget].imgheight+100&&(_=targets[curTarget].imgheight+100),0==N?a.moveTo(N,_):a.lineTo(N,_)}}else if(6.6==tptypes[curTarget][n]){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l&&l!=tplines[curTarget][n][0][0])if(g==tplines[curTarget][n][0][1])a.moveTo(0,g),a.lineTo(targets[curTarget].imgwidth,g);else for(p=(g-tplines[curTarget][n][0][1])/safepow(l-tplines[curTarget][n][0][0],1/3),_=0,N=0;N<targets[curTarget].imgwidth+4;N+=1)(_=p*safepow(N-tplines[curTarget][n][0][0],1/3)+tplines[curTarget][n][0][1])<-100&&(_=-100),_>targets[curTarget].imgheight+100&&(_=targets[curTarget].imgheight+100),0==N?a.moveTo(N,_):a.lineTo(N,_)}else if(tptypes[curTarget][n]>=7&&tptypes[curTarget][n]<8){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l&&(l!=tplines[curTarget][n][0][0]||g!=tplines[curTarget][n][0][1]))if(7==tptypes[curTarget][n]){var B=Math.abs(l-tplines[curTarget][n][0][0]),k=Math.abs(g-tplines[curTarget][n][0][1]),$=B/targets[curTarget].pixperx,C=k/targets[curTarget].pixpery,A=Math.sqrt($*$+C*C);a.save(),a.beginPath();var D=A*targets[curTarget].pixperx,S=A*targets[curTarget].pixpery;a.translate(tplines[curTarget][n][0][0]-D,tplines[curTarget][n][0][1]-S),a.scale(D,S),a.arc(1,1,1,0,2*Math.PI,!1),a.restore()}else if(7.2==tptypes[curTarget][n]){D=Math.abs(l-tplines[curTarget][n][0][0]),S=Math.abs(g-tplines[curTarget][n][0][1]);(curTPcurve==n||null!=dragObj&&dragObj.num==n)&&(a.strokeStyle="rgb(0,255,255)",a.lineWidth=1,a.dashedLine(l,g,l-2*(l-tplines[curTarget][n][0][0]),g,5),a.dashedLine(l,g,l,g-2*(g-tplines[curTarget][n][0][1]),5),a.dashedLine(l,g-2*(g-tplines[curTarget][n][0][1]),l-2*(l-tplines[curTarget][n][0][0]),g-2*(g-tplines[curTarget][n][0][1]),5),a.dashedLine(l-2*(l-tplines[curTarget][n][0][0]),g,l-2*(l-tplines[curTarget][n][0][0]),g-2*(g-tplines[curTarget][n][0][1]),5),a.lineWidth=2),a.strokeStyle="rgb(0,0,255)",a.save(),a.beginPath(),a.translate(tplines[curTarget][n][0][0]-D,tplines[curTarget][n][0][1]-S),a.scale(D,S),a.arc(1,1,1,0,2*Math.PI,!1),a.restore()}else if(7.4==tptypes[curTarget][n]){var W=Math.abs(l-tplines[curTarget][n][0][0]),R=Math.abs(g-tplines[curTarget][n][0][1]),H=Math.abs(R/W);a.strokeStyle=asymcolor,a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],targets[curTarget].imgwidth,tplines[curTarget][n][0][1]+H*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0])),a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],targets[curTarget].imgwidth,tplines[curTarget][n][0][1]-H*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0])),a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],0,tplines[curTarget][n][0][1]-H*tplines[curTarget][n][0][0]),a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],0,tplines[curTarget][n][0][1]+H*tplines[curTarget][n][0][0]),(curTPcurve==n||null!=dragObj&&dragObj.num==n)&&(a.strokeStyle="rgb(0,255,255)",a.lineWidth=1,a.dashedLine(l,g,l-2*(l-tplines[curTarget][n][0][0]),g,5),a.dashedLine(l,g,l,g-2*(g-tplines[curTarget][n][0][1]),5),a.dashedLine(l,g-2*(g-tplines[curTarget][n][0][1]),l-2*(l-tplines[curTarget][n][0][0]),g-2*(g-tplines[curTarget][n][0][1]),5),a.dashedLine(l-2*(l-tplines[curTarget][n][0][0]),g,l-2*(l-tplines[curTarget][n][0][0]),g-2*(g-tplines[curTarget][n][0][1]),5),a.lineWidth=2),a.beginPath(),a.strokeStyle="rgb(0,0,255)";for(N=0;N<targets[curTarget].imgwidth+4;N+=3)(_=tplines[curTarget][n][0][1]+Math.sqrt((Math.pow(N-tplines[curTarget][n][0][0],2)/(W*W)+1)*R*R))<-100&&(_=-100),_>targets[curTarget].imgheight+100&&(_=targets[curTarget].imgheight+100),0==N?a.moveTo(N,_):a.lineTo(N,_);a.stroke(),a.beginPath();for(N=0;N<targets[curTarget].imgwidth+4;N+=3)(_=tplines[curTarget][n][0][1]-Math.sqrt((Math.pow(N-tplines[curTarget][n][0][0],2)/(W*W)+1)*R*R))<-100&&(_=-100),_>targets[curTarget].imgheight+100&&(_=targets[curTarget].imgheight+100),0==N?a.moveTo(N,_):a.lineTo(N,_)}else if(7.5==tptypes[curTarget][n]){R=Math.abs(l-tplines[curTarget][n][0][0]),W=Math.abs(g-tplines[curTarget][n][0][1]),H=Math.abs(W/R);a.strokeStyle=asymcolor,a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],targets[curTarget].imgwidth,tplines[curTarget][n][0][1]+H*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0])),a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],targets[curTarget].imgwidth,tplines[curTarget][n][0][1]-H*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0])),a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],0,tplines[curTarget][n][0][1]-H*tplines[curTarget][n][0][0]),a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],0,tplines[curTarget][n][0][1]+H*tplines[curTarget][n][0][0]),(curTPcurve==n||null!=dragObj&&dragObj.num==n)&&(a.strokeStyle="rgb(0,255,255)",a.lineWidth=1,a.dashedLine(l,g,l-2*(l-tplines[curTarget][n][0][0]),g,5),a.dashedLine(l,g,l,g-2*(g-tplines[curTarget][n][0][1]),5),a.dashedLine(l,g-2*(g-tplines[curTarget][n][0][1]),l-2*(l-tplines[curTarget][n][0][0]),g-2*(g-tplines[curTarget][n][0][1]),5),a.dashedLine(l-2*(l-tplines[curTarget][n][0][0]),g,l-2*(l-tplines[curTarget][n][0][0]),g-2*(g-tplines[curTarget][n][0][1]),5),a.lineWidth=2),a.beginPath(),a.strokeStyle="rgb(0,0,255)";for(_=0;_<targets[curTarget].imgwidth+4;_+=3)(N=tplines[curTarget][n][0][0]+Math.sqrt((Math.pow(_-tplines[curTarget][n][0][1],2)/(W*W)+1)*R*R))<-100&&(N=-100),N>targets[curTarget].imgwidth+100&&(N=targets[curTarget].imgwidth+100),0==_?a.moveTo(N,_):a.lineTo(N,_);a.stroke(),a.beginPath();for(_=0;_<targets[curTarget].imgwidth+4;_+=3)(N=tplines[curTarget][n][0][0]-Math.sqrt((Math.pow(_-tplines[curTarget][n][0][1],2)/(W*W)+1)*R*R))<-100&&(N=-100),N>targets[curTarget].imgwidth+100&&(N=targets[curTarget].imgwidth+100),0==_?a.moveTo(N,_):a.lineTo(N,_)}}else if(8==tptypes[curTarget][n]){s=null,l=null,g=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l){if(l!=tplines[curTarget][n][0][0]){s=(g-tplines[curTarget][n][0][1])/(l-tplines[curTarget][n][0][0]);l<tplines[curTarget][n][0][0]&&(s*=-1)}if(Math.abs(l-tplines[curTarget][n][0][0])<1||Math.abs(s)>100)a.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),g>tplines[curTarget][n][0][1]?a.lineTo(tplines[curTarget][n][0][0],targets[curTarget].imgheight):a.lineTo(tplines[curTarget][n][0][0],0);else{d=tplines[curTarget][n][0][1]+s*tplines[curTarget][n][0][0],T=tplines[curTarget][n][0][1]+s*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0]);a.moveTo(0,d),a.lineTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),a.lineTo(targets[curTarget].imgwidth,T)}}}else if(8.3==tptypes[curTarget][n]){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l&&l!=tplines[curTarget][n][0][0])if(g==tplines[curTarget][n][0][1])a.moveTo(0,g),a.lineTo(targets[curTarget].imgwidth,g);else{var z=targets[curTarget].ymax*targets[curTarget].pixpery+targets[curTarget].imgborder,U=z-tplines[curTarget][n][0][1];if(U*(G=z-g)>0&&l!=tplines[curTarget][n][0][0]){var F=safepow(G/U,1/(l-tplines[curTarget][n][0][0]));p=G/safepow(F,l);a.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]);for(_=0,N=0;N<targets[curTarget].imgwidth+4;N+=3)(_=z-p*safepow(F,N))<-100&&(_=-100),_>targets[curTarget].imgheight+100&&(_=targets[curTarget].imgheight+100),0==N?a.moveTo(N,_):a.lineTo(N,_)}}}else if(8.4==tptypes[curTarget][n]){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l&&l!=tplines[curTarget][n][0][0]&&g!=tplines[curTarget][n][0][1]){var Y=-targets[curTarget].xmin*targets[curTarget].pixperx+targets[curTarget].imgborder,X=Y-tplines[curTarget][n][0][0];if(X*(K=Y-l)>0&&g!=tplines[curTarget][n][0][1]){F=safepow(K/X,1/(g-tplines[curTarget][n][0][1])),p=K/safepow(F,g);a.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]);for(_=0,_=0;_<targets[curTarget].imgheight+4;_+=3)(N=Y-p*safepow(F,_))<-100&&(N=-100),N>targets[curTarget].imgwidth+100&&(N=targets[curTarget].imgwidth+100),0==_?a.moveTo(N,_):a.lineTo(N,_)}}}else if(8.5==tptypes[curTarget][n]){g=null,l=null,o=null,u=null;3==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1],u=tplines[curTarget][n][2][0],o=tplines[curTarget][n][2][1]):2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1],u=e,o=t):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t);var V=tplines[curTarget][n][0][1];if(a.strokeStyle=asymcolor,a.dashedLine(5,V,targets[curTarget].imgwidth,V),a.beginPath(),a.strokeStyle="rgb(0,0,255)",null!=u&&u!=l)if(o==g)a.moveTo(0,o),a.lineTo(targets[curTarget].imgwidth,o);else{var G,J=V-o;if((G=V-g)*J>0&&u!=l){F=safepow(J/G,1/(u-l)),p=J/safepow(F,u);a.moveTo(l,g);for(_=0,N=0;N<targets[curTarget].imgwidth+4;N+=3)(_=V-p*safepow(F,N))<-100&&(_=-100),_>targets[curTarget].imgheight+100&&(_=targets[curTarget].imgheight+100),0==N?a.moveTo(N,_):a.lineTo(N,_)}}}else if(8.6==tptypes[curTarget][n]){g=null,l=null,o=null,u=null;3==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1],u=tplines[curTarget][n][2][0],o=tplines[curTarget][n][2][1]):2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1],u=e,o=t):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t);var Q=tplines[curTarget][n][0][0];if(a.strokeStyle=asymcolor,a.dashedLine(Q,5,Q,targets[curTarget].imgheight),a.beginPath(),a.strokeStyle="rgb(0,0,255)",null!=u&&u!=l&&o!=g){var K,Z=u-Q;if((K=l-Q)*Z>0){F=safepow(Z/K,1/(o-g)),p=Z/safepow(F,o);a.moveTo(l,g);for(N=0,_=0;_<targets[curTarget].imgheight+4;_+=3)(N=Q+p*safepow(F,_))<-100&&(N=-100),N>targets[curTarget].imgwidth+100&&(N=targets[curTarget].imgwidth+100),0==_?a.moveTo(N,_):a.lineTo(N,_)}}}else if(8.2==tptypes[curTarget][n]){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),a.strokeStyle=asymcolor,a.dashedLine(5,tplines[curTarget][n][0][1],targets[curTarget].imgwidth,tplines[curTarget][n][0][1]),a.dashedLine(tplines[curTarget][n][0][0],5,tplines[curTarget][n][0][0],targets[curTarget].imgheight),a.beginPath(),a.strokeStyle="rgb(0,0,255)",null!=l&&l!=tplines[curTarget][n][0][0]&&g!=tplines[curTarget][n][0][1]){for(p=(g-tplines[curTarget][n][0][1])*(l-tplines[curTarget][n][0][0]),N=tplines[curTarget][n][0][0]-1;N>-4;N-=3)(_=p/(N-tplines[curTarget][n][0][0])+tplines[curTarget][n][0][1])<-100&&(_=-100),_>targets[curTarget].imgheight+100&&(_=targets[curTarget].imgheight+100),N==tplines[curTarget][n][0][0]-1?a.moveTo(N,_):a.lineTo(N,_);for(N=tplines[curTarget][n][0][0]+1;N<targets[curTarget].imgwidth+4;N+=3)(_=p/(N-tplines[curTarget][n][0][0])+tplines[curTarget][n][0][1])<-100&&(_=-100),_>targets[curTarget].imgheight+100&&(_=targets[curTarget].imgheight+100),N==tplines[curTarget][n][0][0]+1?a.moveTo(N,_):a.lineTo(N,_);a.stroke()}}else if(9==tptypes[curTarget][n]||9.1==tptypes[curTarget][n]){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l&&l!=tplines[curTarget][n][0][0])if(g==tplines[curTarget][n][0][1])a.moveTo(0,g),a.lineTo(targets[curTarget].imgwidth,g);else{if(9==tptypes[curTarget][n])var ee=-1*Math.abs(g-tplines[curTarget][n][0][1])/2,te=(g+tplines[curTarget][n][0][1])/2,re=(p=Math.PI/Math.abs(l-tplines[curTarget][n][0][0]),g<tplines[curTarget][n][0][1]?l:tplines[curTarget][n][0][0]);else if(9.1==tptypes[curTarget][n])ee=-1*Math.abs(g-tplines[curTarget][n][0][1]),te=tplines[curTarget][n][0][1],p=.5*Math.PI/Math.abs(l-tplines[curTarget][n][0][0]),re=g<tplines[curTarget][n][0][1]?l:l+2*Math.abs(l-tplines[curTarget][n][0][0]);for(_=0,N=0;N<targets[curTarget].imgwidth+4;N+=3)_=ee*Math.cos(p*(N-re))+te,0==N?a.moveTo(N,_):a.lineTo(N,_)}}a.stroke(),a.beginPath()}var ae,ne,ie,se;null===curTPcurve&&tpHasAsymp.hasOwnProperty(targets[curTarget].mode)&&(a.strokeStyle="rgb(200,200,200)",8.5==targets[curTarget].mode?a.dashedLine(5,t,targets[curTarget].imgwidth,t):8.6==targets[curTarget].mode?a.dashedLine(e,5,e,targets[curTarget].imgwidth):8.2==targets[curTarget].mode?(a.dashedLine(5,t,targets[curTarget].imgwidth,t),a.dashedLine(e,5,e,targets[curTarget].imgheight)):7.4!=targets[curTarget].mode&&7.5!=targets[curTarget].mode||(a.dashedLine(e,t,targets[curTarget].imgwidth,t+(targets[curTarget].imgwidth-e)),a.dashedLine(e,t,targets[curTarget].imgwidth,t-(targets[curTarget].imgwidth-e)),a.dashedLine(e,t,0,t-e),a.dashedLine(e,t,0,t+e)),a.beginPath(),a.strokeStyle="rgb(0,0,255)"),a.fillStyle="rgba(0,0,255,.5)";for(n=0;n<lines[curTarget].length;n++){a.beginPath();for(b=0;b<lines[curTarget][n].length;b++)0==b?(a.moveTo(lines[curTarget][n][b][0],lines[curTarget][n][b][1]),ae=lines[curTarget][n][b][0],ne=lines[curTarget][n][b][1]):(a.lineTo(lines[curTarget][n][b][0],lines[curTarget][n][b][1]),ie=lines[curTarget][n][b][0],se=lines[curTarget][n][b][1]);n==curLine&&null!=e&&(a.lineTo(e,t),ie=e,se=t);var le=.02*targets[curTarget].imgwidth;if(1==drawlocky[curTarget]&&ie>.98*targets[curTarget].imgwidth?(a.moveTo(ie,se),a.lineTo(ie-le,se+le),a.moveTo(ie,se),a.lineTo(ie-le,se-le)):1==drawlocky[curTarget]&&ae>.98*targets[curTarget].imgwidth&&(a.moveTo(ae,ne),a.lineTo(ae-le,ne+le),a.moveTo(ae,ne),a.lineTo(ae-le,ne-le)),1==drawlocky[curTarget]&&ie<.02*targets[curTarget].imgwidth?(a.moveTo(ie,se),a.lineTo(ie+le,se+le),a.moveTo(ie,se),a.lineTo(ie+le,se-le)):1==drawlocky[curTarget]&&ae<.02*targets[curTarget].imgwidth&&(a.moveTo(ae,ne),a.lineTo(ae+le,ne+le),a.moveTo(ae,ne),a.lineTo(ae+le,ne-le)),a.stroke(),targets[curTarget].dotline>1){if(lines[curTarget][n].length-1<1)continue;if(Math.pow(ie-ae,2)+Math.pow(se-ne,2)<25){a.moveTo(lines[curTarget][n][0][0],lines[curTarget][n][0][1]);for(b=1;b<lines[curTarget][n].length;b++)a.lineTo(lines[curTarget][n][b][0],lines[curTarget][n][b][1]);a.closePath(),a.fill()}}}a.fillStyle="rgb(0,0,255)",a.beginPath();for(n=0;n<dots[curTarget].length;n++)a.moveTo(dots[curTarget][n][0]+5,dots[curTarget][n][1]),a.arc(dots[curTarget][n][0],dots[curTarget][n][1],5,0,2*Math.PI,!0);if(a.fill(),targets[curTarget].dotline>0){a.beginPath();for(n=0;n<lines[curTarget].length;n++)for(b=0;b<lines[curTarget][n].length;b++)(0==b||Math.pow(lines[curTarget][n][b][0]-lines[curTarget][n][b-1][0],2)+Math.pow(lines[curTarget][n][b][1]-lines[curTarget][n][b-1][1],2)>25)&&(a.moveTo(lines[curTarget][n][b][0]+5,lines[curTarget][n][b][1]),a.arc(lines[curTarget][n][b][0],lines[curTarget][n][b][1],5,0,2*Math.PI,!0));a.fill()}a.fillStyle="rgb(255,255,255)",a.beginPath();for(n=0;n<odots[curTarget].length;n++)a.moveTo(odots[curTarget][n][0]+5,odots[curTarget][n][1]),a.arc(odots[curTarget][n][0],odots[curTarget][n][1],4,0,2*Math.PI,!0);targets[curTarget].mode<3?a.fill():a.stroke(),a.lineWidth=2,a.beginPath();for(n=0;n<odots[curTarget].length;n++)a.moveTo(odots[curTarget][n][0]+5,odots[curTarget][n][1]),a.arc(odots[curTarget][n][0],odots[curTarget][n][1],4,0,2*Math.PI,!0);a.stroke();for(n=0;n<tplines[curTarget].length;n++)if(tptypes[curTarget][n]==targets[curTarget].mode){a.fillStyle="rgb(255,0,0)";for(b=0;b<tplines[curTarget][n].length;b++)a.fillRect(tplines[curTarget][n][b][0]-3,tplines[curTarget][n][b][1]-3,6,6);tplines[curTarget][n].length<tpModeN[targets[curTarget].mode]&&null!=e&&curTPcurve==n&&a.fillRect(e-3,t-3,6,6),a.fillStyle="rgb(0,0,255)"}!0!==r&&encodeDraw()}function deleteCurve(e,t){1==e?dots[curTarget].splice(t,1):2==e?odots[curTarget].splice(t,1):e>=0&&e<1?lines[curTarget].splice(t,1):e>=5&&e<10?(tplines[curTarget].splice(t,1),tptypes[curTarget].splice(t,1),curTPcurve=null):e>=10&&e<11&&(ineqlines[curTarget].splice(t,1),ineqtypes[curTarget].splice(t,1),curIneqcurve=null),drawTarget()}function roundToDec(e,t){return Math.round(e)}function encodeDraw(){for(var e="",t=[],r=0;r<lines[curTarget].length;r++){lines[curTarget][r].length;t=0==targets[curTarget].dotline?pathsimplify(lines[curTarget][r]):lines[curTarget][r],0!=r&&(e+=";");for(var a=0;a<t.length;a++)0!=a&&(e+=","),e+="("+roundToDec(t[a][0],4)+","+roundToDec(t[a][1],4)+")"}e+=";;";for(r=0;r<dots[curTarget].length;r++)0!=r&&(e+=","),e+="("+roundToDec(dots[curTarget][r][0],4)+","+roundToDec(dots[curTarget][r][1],4)+")";e+=";;";for(r=0;r<odots[curTarget].length;r++)0!=r&&(e+=","),e+="("+roundToDec(odots[curTarget][r][0],4)+","+roundToDec(odots[curTarget][r][1],4)+")";e+=";;";var n=[],i="";for(r=0;r<tplines[curTarget].length;r++)if(tplines[curTarget][r].length==tpModeN[tptypes[curTarget][r]]){i="("+tptypes[curTarget][r];for(a=0;a<tplines[curTarget][r].length;a++)i+=","+roundToDec(tplines[curTarget][r][a][0],4)+","+roundToDec(tplines[curTarget][r][a][1],4);n.push(i+")")}e+=n.join(","),e+=";;";var s=[];for(r=0;r<ineqlines[curTarget].length;r++)ineqlines[curTarget][r].length>2&&s.push("("+ineqtypes[curTarget][r]+","+roundToDec(ineqlines[curTarget][r][0][0],4)+","+roundToDec(ineqlines[curTarget][r][0][1],4)+","+roundToDec(ineqlines[curTarget][r][1][0],4)+","+roundToDec(ineqlines[curTarget][r][1][1],4)+","+roundToDec(ineqlines[curTarget][r][2][0],4)+","+roundToDec(ineqlines[curTarget][r][2][1],4)+")");if(e+=s.join(","),targetOuts[curTarget].value!=e){var l=""!=targetOuts[curTarget].value||";;;;;;;;"!=e;targetOuts[curTarget].value=e,l&&$(targetOuts[curTarget]).trigger("input").trigger("change")}}var clickcnt=0;function drawMouseDown(e){if(clickcnt++,clearAllDrawListners(),hasTouch&&e.originalEvent.touches.length>1)return didMultiTouch=!0,$(document).on("touchend.imathasdraw",drawMouseUp),!0;hasTouch?(window.clearTimeout(hasTouchTimer),$(document).off("mousemove.imathasdraw"),$(".drawcanvas").on("touchstart.imathasdraw",(function(e){hasTouch=!0,drawMouseDown(e)})),$(".drawcanvas").on("touchmove.imathasdraw",drawMouseMove),$(document).on("touchend.imathasdraw",drawMouseUp),$(document).on("touchcancel.imathasdraw",drawMouseUp)):($(document).on("mousemove.imathasdraw",drawMouseMove),$(document).on("mouseup.imathasdraw",drawMouseUp));var t=mouseCoords(e);if(null==curTarget||null==curLine&&null==curTPcurve&&null==curIneqcurve)for(i in targets){if(!$(targets[i].el).is(":hidden")&&"canvas"==targets[i].type)if((r=getPosition(targets[i].el)).x<t.x&&r.x+targets[i].width>t.x&&r.y<t.y&&r.y+targets[i].height>t.y&&e.target==targets[i].el){curTarget=i;break}}if(null!=curTarget){if(targetOuts[curTarget].disabled)return;e.preventDefault(),mouseisdown=!0;var r=getPosition(targets[curTarget].el),a={x:t.x-r.x,y:t.y-r.y};if(a.x>-1&&a.x<targets[curTarget].width&&a.y>-1&&a.y<targets[curTarget].height){targets[curTarget].snaptogridx>0&&(a=snaptogrid(a,curTarget)),1==drawlocky[curTarget]&&(a.y=targets[curTarget].imgheight/2);var n=findnearpoint(curTarget,a);if(null!=n){if(-1==targets[curTarget].mode)return void deleteCurve(n[0],n[1]);(null!=curLine&&n[0]<1&&curLine!=n[1]||null!=curTPcurve&n[0]>=5&&n[0]<10&&curTPcurve!=n[1]||null!=curIneqcurve&&n[0]>=10&&n[0]<11&&curIneqcurve!=n[1])&&(n=null)}null==n?(setCursor("pendown"),1==targets[curTarget].mode?(dots[curTarget].push([a.x,a.y]),dragObj={mode:1,num:dots[curTarget].length-1}):2==targets[curTarget].mode?(odots[curTarget].push([a.x,a.y]),dragObj={mode:2,num:odots[curTarget].length-1}):0==targets[curTarget].mode||.7==targets[curTarget].mode?null==curLine?(lines[curTarget].push([[a.x,a.y]]),curLine=lines[curTarget].length-1):lines[curTarget][curLine].push([a.x,a.y]):.5==targets[curTarget].mode?null==curLine?(lines[curTarget].push([[a.x,a.y]]),curLine=lines[curTarget].length-1):(lines[curTarget][curLine].push([a.x,a.y]),curLine=null,dragObj=null):targets[curTarget].mode>=5&&targets[curTarget].mode<10?null==curTPcurve?(tplines[curTarget].push([[a.x,a.y]]),curTPcurve=tplines[curTarget].length-1,tptypes[curTarget][curTPcurve]=targets[curTarget].mode,mouseisdown=!1):(tplines[curTarget][curTPcurve].push([a.x,a.y]),tplines[curTarget][curTPcurve].length==tpModeN[targets[curTarget].mode]?(dragObj={mode:targets[curTarget].mode,num:curTPcurve,subnum:tpModeN[targets[curTarget].mode]-1},curTPcurve=null):mouseisdown=!1):targets[curTarget].mode>=10&&targets[curTarget].mode<11&&(null==curIneqcurve?(ineqlines[curTarget].push([[a.x,a.y]]),curIneqcurve=ineqlines[curTarget].length-1,ineqtypes[curTarget][curIneqcurve]=targets[curTarget].mode,mouseisdown=!1):(ineqlines[curTarget][curIneqcurve].push([a.x,a.y]),2==ineqlines[curTarget][curIneqcurve].length?dragObj={mode:targets[curTarget].mode,num:curIneqcurve,subnum:1}:3==ineqlines[curTarget][curIneqcurve].length&&(dragObj={mode:targets[curTarget].mode,num:curIneqcurve,subnum:2},curIneqcurve=null)))):0==n[0]||.5==n[0]?null==curLine?(setCursor("move"),dragObj={mode:targets[curTarget].mode,num:n[1],subnum:n[2]},oldpointpos=lines[curTarget][n[1]][n[2]],n[2]==lines[curTarget][n[1]].length-1&&0==targets[curTarget].mode?curLine=n[1]:0==n[2]&&0==targets[curTarget].mode&&(curLine=n[1],lines[curTarget][curLine].reverse(),dragObj.subnum=lines[curTarget][curLine].length-1),clickmightbenewcurve=!0):n[1]==curLine&&n[2]==lines[curTarget][n[1]].length-1?(lines[curTarget][curLine].length<2&&lines[curTarget].splice(curLine,1),curLine=null):targets[curTarget].dotline>1&&n[1]==curLine&&0==n[2]?(lines[curTarget][curLine].push(lines[curTarget][curLine][0]),curLine=null):(setCursor("pendown"),lines[curTarget][curLine].push([a.x,a.y])):1==n[0]?(setCursor("move"),dragObj={mode:1,num:n[1]}):2==n[0]?(setCursor("move"),dragObj={mode:2,num:n[1]}):n[0]>=5&&n[0]<10?null==curTPcurve&&(setCursor("move"),dragObj={mode:n[0],num:n[1],subnum:n[2]},oldpointpos=tplines[curTarget][n[1]][n[2]],clickmightbenewcurve=!0):n[0]>=10&&n[0]<11&&null==curIneqcurve&&(setCursor("move"),dragObj={mode:n[0],num:n[1],subnum:n[2]},oldpointpos=ineqlines[curTarget][n[1]][n[2]],clickmightbenewcurve=!0),drawTarget()}else null!=curLine&&(lines[curTarget][curLine].length<2&&lines[curTarget].splice(curLine,1),setCursor("pen")),null!=curTPcurve&&(tplines[curTarget][curTPcurve].length<tpModeN[targets[curTarget].mode]&&(tplines[curTarget].splice(curTPcurve,1),tptypes[curTarget].splice(curTPcurve,1)),setCursor("pen")),null!=curIneqcurve&&(ineqlines[curTarget][curIneqcurve].length<3&&(ineqlines[curTarget].splice(curIneqcurve,1),ineqtypes[curTarget].splice(curIneqcurve,1)),setCursor("pen")),curLine=null,curTPcurve=null,curIneqcurve=null,dragObj=null,drawTarget(),curTarget=null}}function findnearpoint(e,t){if(hasTouch){var r=Math.max(15*window.innerWidth/screen.width,15);r*=r}else if(-1==targets[e].mode)r=50;else r=25;if(0==targets[e].mode||.5==targets[e].mode||-1==targets[e].mode)for(var a=lines[e].length-1;a>=0;a--)for(var n=lines[e][a].length-1;n>=0;n--){if(Math.pow(lines[e][a][n][0]-t.x,2)+Math.pow(lines[e][a][n][1]-t.y,2)<r)return[-1==targets[e].mode?0:targets[e].mode,a,n]}if(1==targets[e].mode||-1==targets[e].mode)for(a=dots[e].length-1;a>=0;a--)if(Math.pow(dots[e][a][0]-t.x,2)+Math.pow(dots[e][a][1]-t.y,2)<r)return[1,a];if(2==targets[e].mode||-1==targets[e].mode)for(a=odots[e].length-1;a>=0;a--)if(Math.pow(odots[e][a][0]-t.x,2)+Math.pow(odots[e][a][1]-t.y,2)<r)return[2,a];if(targets[e].mode>=5&&targets[e].mode<10||-1==targets[e].mode)for(a=tplines[e].length-1;a>=0;a--)for(n=tplines[e][a].length-1;n>=0;n--){if(tptypes[e][a]==targets[e].mode||-1==targets[e].mode)if(Math.pow(tplines[e][a][n][0]-t.x,2)+Math.pow(tplines[e][a][n][1]-t.y,2)<r)return[tptypes[e][a],a,n]}if(targets[e].mode>=10&&targets[e].mode<11||-1==targets[e].mode)for(a=ineqlines[e].length-1;a>=0;a--)for(n=ineqlines[e][a].length-1;n>=0;n--){if(ineqtypes[e][a]==targets[e].mode||-1==targets[e].mode)if(Math.pow(ineqlines[e][a][n][0]-t.x,2)+Math.pow(ineqlines[e][a][n][1]-t.y,2)<r)return[ineqtypes[e][a],a,n]}return null}var lastdrawmouseup=null;function drawMouseUp(e){var t=mouseCoords(e);if(mouseisdown=!1,null!=curTarget){if(targetOuts[curTarget].disabled)return;var r=getPosition(targets[curTarget].el),a={x:t.x-r.x,y:t.y-r.y};targets[curTarget].snaptogridx>0&&(a=snaptogrid(a,curTarget));var n=a.x>-1&&a.x<targets[curTarget].width&&a.y>-1&&a.y<targets[curTarget].height;1==clickmightbenewcurve&&(targets[curTarget].mode>=5&&targets[curTarget].mode<10?(tplines[curTarget].push([[a.x,a.y]]),curTPcurve=tplines[curTarget].length-1,tptypes[curTarget][curTPcurve]=targets[curTarget].mode):targets[curTarget].mode>=10&&targets[curTarget].mode<11&&(ineqlines[curTarget].push([[a.x,a.y]]),curIneqcurve=ineqlines[curTarget].length-1,ineqtypes[curTarget][curIneqcurve]=targets[curTarget].mode)),null!=lastdrawmouseup&&t.x==lastdrawmouseup.x&&t.y==lastdrawmouseup.y&&null!=curLine&&null==dragObj&&(lines[curTarget][curLine].length<2&&lines[curTarget].splice(curLine,1),curLine=null,dragObj=null,drawTarget()),null!=curLine&&null==dragObj&&(.5==targets[curTarget].mode&&lines[curTarget][curLine].length>1||.7==targets[curTarget].mode)&&(curLine=null,dragobj=null,drawTarget()),null!=curTPcurve&&tplines[curTarget][curTPcurve].length<tpModeN[targets[curTarget].mode]&&(didMultiTouch||!n?(tplines[curTarget].splice(curTPcurve,1),tptypes[curTarget].splice(curTPcurve,1),curTPcurve=null,drawTarget()):null==findnearpoint(curTarget,a)&&(tplines[curTarget][curTPcurve].push([a.x,a.y]),tplines[curTarget][curTPcurve].length==tpModeN[targets[curTarget].mode]&&(curTPcurve=null),drawTarget())),null!=curIneqcurve&&1==ineqlines[curTarget][curIneqcurve].length&&(didMultiTouch||!n?(ineqlines[curTarget].splice(curIneqcurve,1),ineqtypes[curTarget].splice(curIneqcurve,1),curIneqcurve=null,drawTarget()):null==findnearpoint(curTarget,a)&&(ineqlines[curTarget][curIneqcurve].push([a.x,a.y]),drawTarget())),setCursor(null==curLine&&null==curTPcurve?"move":"pen"),void 0!==e&&e.preventDefault()}if(lastdrawmouseup=t,null!=curTarget&&null!=dragObj){r=getPosition(targets[curTarget].el);a.x>-1&&a.x<targets[curTarget].width&&a.y>-1&&a.y<targets[curTarget].height?(0==dragObj.mode&&targets[curTarget].dotline>1&&(0!=dragObj.subnum&&dragObj.subnum!=lines[curTarget][dragObj.num].length-1||Math.pow(lines[curTarget][dragObj.num][0][0]-lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][0],2)+Math.pow(lines[curTarget][dragObj.num][0][1]-lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][1],2)<25&&(0==dragObj.subnum?(lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][0]=lines[curTarget][dragObj.num][0][0],lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][1]=lines[curTarget][dragObj.num][0][1]):(lines[curTarget][dragObj.num][0][0]=lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][0],lines[curTarget][dragObj.num][0][1]=lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][1]),curLine=null,drawTarget())),dragObj=null):(1==drawlocky[curTarget]&&(a.y=targets[curTarget].imgheight/2),1==dragObj.mode?dots[curTarget].splice(dragObj.num,1):2==dragObj.mode?odots[curTarget].splice(dragObj.num,1):.5==dragObj.mode?lines[curTarget].splice(dragObj.num,1):0==dragObj.mode?lines[curTarget][dragObj.num][dragObj.subnum]=oldpointpos:dragObj.mode>=5&&dragObj.mode<10?(tplines[curTarget].splice(dragObj.num,1),tptypes[curTarget].splice(dragObj.num,1),curTPcurve=null):dragObj.mode>=10&&dragObj.mode<11&&(ineqlines[curTarget].splice(dragObj.num,1),ineqtypes[curTarget].splice(dragObj.num,1),curIneqcurve=null),dragObj=null,drawTarget())}didMultiTouch=!1,hasTouch?hasTouchTimer=window.setTimeout((function(){hasTouch=!1,clearAllDrawListners(),$(document).on("mousemove.imathasdraw",drawMouseMove),$(".drawcanvas").on("touchstart.imathasdraw",(function(e){hasTouch=!0,drawMouseDown(e)})),$(document).on("mousedown.imathasdraw",drawMouseDown)}),350):(clearAllDrawListners(),$(document).on("mousemove.imathasdraw",drawMouseMove),$(".drawcanvas").on("touchstart.imathasdraw",(function(e){hasTouch=!0,drawMouseDown(e)})),$(document).on("mousedown.imathasdraw",drawMouseDown))}var mouseintarget=-1;function drawMouseMove(e){var t=null;clickmightbenewcurve=!1;var r=mouseCoords(e);for(i in targets){if(!$(targets[i].el).is(":hidden")&&"canvas"==targets[i].type)if((a=getPosition(targets[i].el)).x<r.x&&a.x+targets[i].width>r.x&&a.y<r.y&&a.y+targets[i].height>r.y&&e.target==targets[i].el){t=i;break}}if(null!=t){if(targetOuts[t].disabled)return;mouseintarget=t;var a=getPosition(targets[t].el),n={x:r.x-a.x,y:r.y-a.y};if(targets[t].snaptogridx>0&&(n=snaptogrid(n,t)),1==drawlocky[t]&&(n.y=targets[t].imgheight/2),n.x>-1&&n.x<targets[t].width&&n.y>-1&&n.y<targets[t].height)if(null==dragObj)if(null==curLine)null==(l=findnearpoint(t,n))?setCursor("pen",t):-1!=targets[t].mode&&setCursor("move",t)}else null!=mouseintarget&&-1!=mouseintarget&&(null!=curTarget?drawTarget():(curTarget=mouseintarget,drawTarget(),curTarget=null),mouseintarget=-1);if(null!=curTarget){if(e.originalEvent.touches&&e.originalEvent.touches.length>1)return didMultiTouch=!0,!0;void 0!==e&&e.preventDefault();a=getPosition(targets[curTarget].el),n={x:r.x-a.x,y:r.y-a.y};if(targets[curTarget].snaptogridx>0&&(n=snaptogrid(n,curTarget)),1==drawlocky[curTarget]&&(n.y=targets[curTarget].imgheight/2),n.x>-1&&n.x<targets[curTarget].width&&n.y>-1&&n.y<targets[curTarget].height){if(null==dragObj){if(mouseisdown&&-1==targets[curTarget].mode)return void(null!=(l=findnearpoint(curTarget,n))&&deleteCurve(l[0],l[1]));if(null!=curLine)if(!mouseisdown||0!=targets[curTarget].mode&&.7!=targets[curTarget].mode)if(mouseisdown&&.5==targets[curTarget].mode){if(0==(s=lines[curTarget][curLine].length-1))Math.pow(lines[curTarget][curLine][s][0]-n.x,2)+Math.pow(lines[curTarget][curLine][s][1]-n.y,2)>25?(lines[curTarget][curLine].push([n.x,n.y]),drawTarget()):drawTarget(n.x,n.y);else lines[curTarget][curLine][s]=[n.x,n.y],drawTarget()}else drawTarget(n.x,n.y);else{var s=lines[curTarget][curLine].length-1;Math.pow(lines[curTarget][curLine][s][0]-n.x,2)+Math.pow(lines[curTarget][curLine][s][1]-n.y,2)>25?(lines[curTarget][curLine].push([n.x,n.y]),drawTarget()):drawTarget(n.x,n.y)}else if(null!=curTPcurve)mouseisdown?drawTarget():drawTarget(n.x,n.y);else if(null!=curIneqcurve)mouseisdown?drawTarget():drawTarget(n.x,n.y);else{var l;null==(l=findnearpoint(curTarget,n))?(setCursor("pen"),tpHasAsymp.hasOwnProperty(targets[curTarget].mode)&&null!==t&&drawTarget(n.x,n.y)):(drawTarget(),-1!=targets[curTarget].mode&&setCursor("move"))}}else setCursor("move"),0==dragObj.mode||.5==dragObj.mode?lines[curTarget][dragObj.num][dragObj.subnum]=[n.x,n.y]:1==dragObj.mode?dots[curTarget][dragObj.num]=[n.x,n.y]:2==dragObj.mode?odots[curTarget][dragObj.num]=[n.x,n.y]:dragObj.mode>=5&&dragObj.mode<10?tplines[curTarget][dragObj.num][dragObj.subnum]=[n.x,n.y]:dragObj.mode>=10&&dragObj.mode<11&&(ineqlines[curTarget][dragObj.num][dragObj.subnum]=[n.x,n.y]),drawTarget();return!1}null==curIneqcurve||mouseisdown||drawTarget()}else null!=t&&-1!=mouseintarget&&(curTarget=t,tpHasAsymp.hasOwnProperty(targets[curTarget].mode)&&drawTarget(n.x,n.y),curTarget=null)}function setCursor(e,t){targets[t=t||curTarget].cursor!=e&&("move"==e?targets[t].el.style.cursor=e:"pen"==e?targets[t].el.style.cursor="url("+staticroot+"/img/penup.svg) 0 0, auto":"pendown"==e&&(targets[t].el.style.cursor="url("+staticroot+"/img/pendown.svg) 0 20, auto"),targets[t].cursor=e)}function mouseCoords(e){if(e=e||window.event,hasTouch){var t=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0];return{x:t.pageX,y:t.pageY}}if(e.pageX||e.pageY)return{x:e.pageX,y:e.pageY};var r=document.documentElement,a=document.body;if(r&&(r.scrollTop||r.scrollLeft))var n=r.scrollLeft,i=r.scrollTop;else if(a)n=a.scrollLeft,i=a.scrollTop;else n=0,i=0;return{x:e.clientX+n,y:e.clientY+i}}function snaptogrid(e,t){var r=e.x-targets[t].imgborder+targets[t].xmin*targets[t].pixperx,a=e.y-targets[t].imgborder-targets[t].ymax*targets[t].pixpery;return{x:r=Math.round(Math.round(r/(targets[t].pixperx*targets[t].snaptogridx))*targets[t].pixperx*targets[t].snaptogridx+targets[t].imgborder-targets[t].xmin*targets[t].pixperx),y:a=Math.round(Math.round(a/(targets[t].pixpery*targets[t].snaptogridy))*targets[t].pixpery*targets[t].snaptogridy+targets[t].imgborder+targets[t].ymax*targets[t].pixpery)}}function getMouseOffset(e,t){var r=getPosition(e),a=mouseCoords(t);return{x:a.x-r.x,y:a.y-r.y}}function getPosition(e){if(e.className.match(/hidden/))return{x:-1e4,y:-1e4};var t=$(e).offset();return{x:t.left,y:t.top}}function clearAllDrawListners(){$(document).off("mousedown.imathasdraw").off("mousemove.imathasdraw").off("mouseup.imathasdraw"),$(document).off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw"),$(".drawcanvas").off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw")}function initCanvases(e){clearAllDrawListners(),$(document).on("mousemove.imathasdraw",drawMouseMove),$(".drawcanvas").on("touchstart.imathasdraw",(function(e){hasTouch=!0,drawMouseDown(e)})),$(document).on("mousedown.imathasdraw",drawMouseDown);try{CanvasRenderingContext2D.prototype.dashedLine=function(e,t,r,a,n){null==n&&(n=10),t<0&&t!=a?(e-=t*(r-e)/(a-t),t=0):t>targets[curTarget].imgheight&&t!=a&&(e+=(targets[curTarget].imgheight-t)*(r-e)/(a-t),t=targets[curTarget].imgheight),this.beginPath(),this.moveTo(e,t);var i=r-e,s=a-t,l=Math.sqrt(i*i+s*s)/n,u=i/l,g=s/l;l=Math.floor(l);for(var o=0;o++<l&&t>-1&&t<targets[curTarget].imgheight+1&&e>-1&&e<targets[curTarget].imgwidth+1;)e+=u,t+=g,this[o%2==0?"moveTo":"lineTo"](e,t);this[o%2==0?"moveTo":"lineTo"](r,a),this.stroke(),this.closePath()}}catch(e){}for(var t in canvases)if(void 0===e||e==t){var r=null;if(null!=drawla[t]&&drawla[t].length>2){if(lines[canvases[t][0]]=drawla[t][0],dots[canvases[t][0]]=drawla[t][1],odots[canvases[t][0]]=drawla[t][2],tptypes[canvases[t][0]]=[],tplines[canvases[t][0]]=[],drawla[t].length>3&&drawla[t][3].length>0)for(var a=0;a<drawla[t][3].length;a++){tptypes[canvases[t][0]][a]=drawla[t][3][a][0],tplines[canvases[t][0]][a]=[];for(var n=0;n<tpModeN[tptypes[canvases[t][0]][a]];n++)tplines[canvases[t][0]][a].push(drawla[t][3][a].slice(1+2*n,3+2*n))}if(ineqtypes[canvases[t][0]]=[],ineqlines[canvases[t][0]]=[],drawla[t].length>4&&drawla[t][4].length>0)for(a=0;a<drawla[t][4].length;a++)ineqtypes[canvases[t][0]][a]=drawla[t][4][a][0],ineqlines[canvases[t][0]][a]=[drawla[t][4][a].slice(1,3),drawla[t][4][a].slice(3,5),drawla[t][4][a].slice(5)];drawla[t].length>5&&(r=drawla[t][5])}else null!=drawla[t]&&"[[]]"==JSON.stringify(drawla[t])&&clearcanvas(canvases[t][0],!0);var i="";canvases[t][1].match(/initPicture/)?i=canvases[t][1]:""!==canvases[t][1]&&(i=imasroot+"/filter/graph/imgs/"+canvases[t][1]),""!==canvases[t][13]?addA11yTarget(canvases[t],r,i):addTarget(canvases[t][0],"canvas"+canvases[t][0],i,"qn"+canvases[t][0],canvases[t][2],canvases[t][3],canvases[t][4],canvases[t][5],canvases[t][6],canvases[t][7],canvases[t][8],canvases[t][9],canvases[t][10],canvases[t][11],canvases[t][12])}}"undefined"!=typeof initstack?initstack.push(initCanvases):$((function(){initCanvases()}));var normslider={idnums:[],curslider:{el:null,startpos:[0,0],outnode:null}};function addnormslider(e,t){-1==arraysearch(e,normslider.idnums)?(normslider.idnums.push(e),!0===t&&slideronpageload(e)):slideronpageload(e)}function slideronpageload(e){for(var t,r=0;r<normslider.idnums.length;r++)void 0!==e&&e!=normslider.idnums[r]||(initnormslider(t=normslider.idnums[r]),$("#slid1"+t).on("touchstart.normslider mousedown.normslider",onsliderstart),$("#slid2"+t).on("touchstart.normslider mousedown.normslider",onsliderstart))}function initnormslider(e){var t,r,a,n,i=document.getElementById("qn"+e).value;(n=i.match(/\(-oo,([\-\d\.]+)\)U\(([\-\d\.]+),oo\)/))?(t=3,r=n[1],a=n[2]):(n=i.match(/\(-oo,([\-\d\.]+)\)/))?(t=0,r=n[1],a=2.5):(n=i.match(/\(([\-\d\.]+),oo\)/))?(t=1,r=n[1],a=2.5):(n=i.match(/\(([\-\d\.]+),([\-\d\.]+)\)/))?(t=2,r=n[1],a=n[2]):(t=0,r=-1.5,a=2.5),document.getElementById("slid1"+e).style.left=60*r+250-6+"px",document.getElementById("slid2"+e).style.left=60*a+250-6+"px",document.getElementById("shaderegions"+e).selectedIndex=t,normslider.curslider.type=document.getElementById("shaderegions"+e).value,chgnormtype(e)}function onsliderstart(e){(e=e||window.event).originalEvent.touches&&e.originalEvent.touches.length>0?(hasTouch=!0,$(document).on("touchmove.normslider",onsliderchange),$(document).on("touchend.normslider",onsliderstop)):($(document).on("mousemove.normslider",onsliderchange),$(document).on("mouseup.normslider",onsliderstop)),normslider.curslider.el=e.target||e.srcElement,normslider.curslider.id=normslider.curslider.el.id.substring(5),normslider.curslider.type=document.getElementById("shaderegions"+normslider.curslider.id).value,normslider.curslider.outnode=document.getElementById(normslider.outputid),normslider.curslider.startpos=getMouseOffset(normslider.curslider.el,e),normslider.curslider.el.parentNode.style.cursor="pointer";getPosition(normslider.curslider.el.parentNode);return e.preventDefault&&e.preventDefault(),!1}function onsliderchange(e){var t=normslider.curslider.id;e=e||window.event;var r=getMouseOffset(normslider.curslider.el.parentNode,e);if(!(r.x<5||r.x>normslider.curslider.el.parentNode.offsetWidth-5||r.y<5||r.y>normslider.curslider.el.parentNode.offsetHeight-5)){var a=6*Math.round((r.x-normslider.curslider.startpos.x-10)/6)+10;return normslider.curslider.el.style.left=a+"px",normupdatevalues(t),e.preventDefault&&e.preventDefault(),!1}}function onsliderstop(e){null!==normslider.curslider.el&&(hasTouch=!1,$(document).off("touchmove.normslider touchend.normslider"),$(document).off("mousemove.normslider mouseup.normslider"),normslider.curslider.el.parentNode.style.cursor="",normslider.curslider.el=null)}function normupdatevalues(e){var t=parseInt(document.getElementById("slid1"+e).style.left)+6,r=parseInt(document.getElementById("slid2"+e).style.left)+6,a=Math.min(t,r),n=Math.max(t,r);"2O"==normslider.curslider.type?document.getElementById("normleft"+e).style.width=a+1+"px":"1L"==normslider.curslider.type?document.getElementById("normleft"+e).style.width=t+1+"px":"2B"==normslider.curslider.type&&(document.getElementById("normleft"+e).style.left=a+"px",document.getElementById("normleft"+e).style.width=n-a+1+"px"),"2O"==normslider.curslider.type?document.getElementById("normright"+e).style.width=500-n+"px":"1R"==normslider.curslider.type&&(document.getElementById("normright"+e).style.width=500-t+"px");var i=((t-10)/60-4).toFixed(1),s=((r-10)/60-4).toFixed(1),l=document.getElementById("slid1txt"+e);l.innerHTML=i,l.style.left=t-6+"px";var u=document.getElementById("slid2txt"+e);u.innerHTML=s,u.style.left=r-6+"px";var g=Math.min(i,s),o=Math.max(i,s);if("2O"==normslider.curslider.type)var c="(-oo,"+g+")U("+o+",oo)";else if("2B"==normslider.curslider.type)c="("+g+","+o+")";else if("1L"==normslider.curslider.type)c="(-oo,"+i+")";else if("1R"==normslider.curslider.type)c="("+i+",oo)";document.getElementById("qn"+e).value=c,$("#qn"+e).trigger("input").trigger("change")}function chgnormtype(e){var t=document.getElementById("shaderegions"+e).value;normslider.curslider.type=t;var r=parseInt(document.getElementById("slid1"+e).style.left)+6,a=parseInt(document.getElementById("slid2"+e).style.left)+6,n=Math.min(r,a),i=Math.max(r,a);"1R"==t||"1L"==t?(document.getElementById("slid2"+e).style.display="none",document.getElementById("slid2txt"+e).style.display="none","1R"==t?(document.getElementById("normleft"+e).style.display="none",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normright"+e).style.width=500-r+"px"):(document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.display="",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normleft"+e).style.width=r+"px")):"2O"==t?(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normright"+e).style.width=500-i+"px",document.getElementById("normleft"+e).style.width=n+"px"):"2B"==t&&(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.left=n+"px",document.getElementById("normleft"+e).style.width=i-n+"px"),normupdatevalues(e)}function dashedParabola(e,t,r,a,n,i,s){if(n==r)e.moveTo(0,n),e.dashedLine(0,n,i,n);else{var l=(n-r)/((a-t)*(a-t)),u=-2*l*t,g=0;n>r&&(g=s);var o=l*t*t+r-g,c=Math.sqrt(u*u-4*l*o),d=(-u-c)/(2*l),T=(-u+c)/(2*l);o+=g;if(T<d){var p=d;d=T,T=p}for(var h=t,m=r,y=0;h>d-5&&h>-5;)y%2==0?e.moveTo(h,m):e.lineTo(h,m),m=l*(h-=Math.min(Math.sqrt(64/(1+Math.pow(2*l*(h-t),2))),Math.sqrt(8/Math.abs(l))))*h+u*h+o,y++;for(h=t,m=r,y=0;h<T+5&&h<i+5;)y%2==0?e.moveTo(h,m):e.lineTo(h,m),m=l*(h+=Math.min(Math.sqrt(64/(1+Math.pow(2*l*(h-t),2))),Math.sqrt(8/Math.abs(l))))*h+u*h+o,y++}e.stroke()}function shadeParabola(e,t,r,a,n,i,s,l,u){if(e.beginPath(),n==r)e.moveTo(0,n),e.lineTo(l,n),s<r?(e.lineTo(l,0),e.lineTo(0,0)):(e.lineTo(l,u),e.lineTo(0,u));else{var g=(n-r)/((a-t)*(a-t)),o=-2*g*t,c=0;n>r&&(c=u);var d=g*t*t+r-c,T=Math.sqrt(o*o-4*g*d),p=(-o-T)/(2*g),h=g*p*p+o*p+(d+=c),m=(-o+T)/(2*g),y=h;if(m<p){var v=p;p=m,m=v}var f=2*g*(p-t),w=h-f*p,b=-f,q=(w-(y-b*m))/(b-f),x=f*q+w;if(g<0&&s<g*i*i+o*i+d||g>0&&s>g*i*i+o*i+d)e.moveTo(p,h),e.quadraticCurveTo(q,x,m,y);else{var M=u;Math.abs(h-u)<2&&(M=0),e.moveTo(0,h),e.lineTo(p,h),e.quadraticCurveTo(q,x,m,y),e.lineTo(l,y),e.lineTo(l,M),e.lineTo(0,M)}}e.closePath()}"undefined"!=typeof initstack&&initstack.push(slideronpageload);var drawexport={reset:reset,initCanvases:initCanvases,clearcanvas:clearcanvas,clearlastline:clearlastline,settool:settool,addnormslider:addnormslider,chgnormtype:chgnormtype,adda11ydraw:adda11ydraw,changea11ydraw:changea11ydraw,encodea11ydraw:encodea11ydraw,updatea11ydraw:updatea11ydraw,removea11ydraw:removea11ydraw};return drawexport}(jQuery);!function(){"use strict";function e(e,t,r){var a=t[0],n=t[1],i=r[0]-a,s=r[1]-n;if(0!==i||0!==s){var l=((e[0]-a)*i+(e[1]-n)*s)/(i*i+s*s);l>1?(a=r[0],n=r[1]):l>0&&(a+=i*l,n+=s*l)}return(i=e[0]-a)*i+(s=e[1]-n)*s}function t(r,a,n,i,s){for(var l,u=i,g=a+1;g<n;g++){var o=e(r[g],r[a],r[n]);o>u&&(l=g,u=o)}u>i&&(l-a>1&&t(r,a,l,i,s),s.push(r[l]),n-l>1&&t(r,l,n,i,s))}function r(e,r){var a=e.length-1,n=[e[0]];return t(e,0,a,r,n),n.push(e[a]),n}window.pathsimplify=function(e,t,a){if(e.length<=2)return e;var n=void 0!==t?t*t:1;return e=r(e=a?e:function(e,t){for(var r,a,n,i,s,l=e[0],u=[l],g=1,o=e.length;g<o;g++)r=e[g],n=l,i=void 0,s=void 0,i=(a=r)[0]-n[0],s=a[1]-n[1],i*i+s*s>t&&(u.push(r),l=r);return l!==r&&u.push(r),u}(e,n),n)}}();var initstack=[],loadedscripts=[],scriptqueue=[],processingscriptsqueue=!1,callbackstack={};"undefined"==typeof commasep&&(commasep=!0);var imathasAssess=function($){var allParams={},allKekule={};function clearparams(e){var t;for(t in e)delete allParams[t]}function toMQwVars(e,t){var a=t.substr(2).split(/-/)[0],r=allParams[a].qtype;("numfunc"===r||"calcinterval"===r&&-1!=allParams[a].calcformat.indexOf("inequality"))&&(e=AMnumfuncPrepVar(a,e)[1]);var i=!(r.match(/matrix/)||"string"===r);return AMtoMQ(e,t,i)}function fromMQwText(e,t){return e=(e=MQtoAM(e)).replace(/\(text\((.*?)\)\)/g,"($1)").replace(/text\((.*?)\)/g," $1 ")}function init(e,t,a){var r,i,n,s;for(r in MQeditor.setConfig({toMQ:toMQwVars,fromMQ:fromMQwText}),0==$("#arialive").length&&$("body").append($("<p>",{id:"arialive","aria-live":"assertive","aria-atomic":"true",class:"sr-only"})),e)if(!isNaN(parseInt(r))){if(allParams[r]=e[r],(i=e[r]).helper&&i.qtype.match(/^(calc|numfunc|string|interval|matrix|chemeqn|complexmatrix|alg)/)){if(!(n=document.getElementById("qn"+r))&&!i.matrixsize)continue;s=i.qtype,i.calcformat&&(s+=","+i.calcformat),i.displayformat&&(s+=","+i.displayformat),i.matrixsize?(s+=",matrixsized",$("input[id^=qn"+r+"-]").attr("data-mq",s),i.vars&&$("input[id^=qn"+r+"-]").attr("data-mq-vars",i.vars)):(n.setAttribute("data-mq",s),i.vars&&n.setAttribute("data-mq-vars",i.vars)),t&&(i.matrixsize?MQeditor.toggleMQAll("input[id^=qn"+r+"-]",!0,!0):MQeditor.toggleMQ(n,!0,!0),$("#pbtn"+r).hide())}if(i.preview?(document.getElementById("pbtn"+r).addEventListener("click",function(e){return function(){showPreview(e)}}(r)),1!=i.preview||i.qtype.match(/matrix/)||(LivePreviews.hasOwnProperty(r)&&delete LivePreviews[r],setupLivePreview(r,t),document.getElementById("qn"+r).addEventListener("keyup",updateLivePreview),t&&showSyntaxCheckMQ(r))):i.matrixsize?$("input[id^=qn"+r+"-]").on("input",function(e){return function(){syntaxCheckMQ(e)}}(r)):document.getElementById("qn"+r)&&document.getElementById("qn"+r).addEventListener("keyup",function(e){return function(){syntaxCheckMQ(e)}}(r)),"debit"===i.format?document.getElementById("qn"+r).addEventListener("keyup",editdebit):"credit"===i.format?(document.getElementById("qn"+r).addEventListener("keyup",editcredit),initcreditboxes()):"normslider"===i.format&&imathasDraw.addnormslider(r,!0),i.autosuggest&&(!autoSuggestLists.hasOwnProperty(i.autosuggest)&&i.hasOwnProperty(i.autosuggest)&&(autoSuggestLists[i.autosuggest]=i[i.autosuggest]),autoSuggestLists.hasOwnProperty(i.autosuggest)&&(autoSuggestObjects[r]=new AutoSuggest(document.getElementById("qn"+r),autoSuggestLists[i.autosuggest]))),i.tip)if(n=document.getElementById("qn"+r+"-0"))for(u=0;document.getElementById("qn"+r+"-"+u);)setupTips("qn"+r+"-"+u,i.tip,i.longtip),u++;else setupTips("qn"+r,i.tip,i.longtip);if("draw"===i.qtype&&setupDraw(r),"file"===i.qtype&&initFileAlt(document.getElementById("qn"+r)),"multans"===i.qtype&&initMultAns(r),"molecule"===i.qtype&&initMolecule(r),i.usetinymce)if(document.getElementById("qn"+r).disabled&&!document.getElementById("tinyprev"+r)){var l=$("#qn"+r).val(),c=$("<div>",{id:"tinyprev"+r,class:"introtext"});c.html(l),$("#qn"+r).hide().after(c)}else{var o={};i.nopaste&&(o.paste_preprocess=function(e,t){t.content=""}),o.valid_classes="gridded,centered,attach",initeditor("selector","#qn"+r+".mceEditor",null,!1,(function(e){e.on("blur",(function(e){tinymce.triggerSave(),jQuery(e.target.targetElm).triggerHandler("change")})).on("focus",(function(e){jQuery(e.target.targetElm).triggerHandler("focus")}))}),o)}"essay"==i.qtype&&$("#qnwrap"+r+".introtext img").on("click",rotateimg),initEnterHandler(r),$("input[id^=qn"+r+"]:not([type=file])").attr("maxlength",8e3)}if(initDupRubrics(),initShowAnswer2(),a&&setScoreMarkers(a),initqsclickchange(),initClearScoreMarkers(),e.scripts){for(var u in e.scripts)"code"==e.scripts[u][0]?scriptqueue.push(e.scripts[u]):-1==loadedscripts.indexOf(e.scripts[u][1])&&(scriptqueue.push(e.scripts[u]),loadedscripts.push(e.scripts[u][1]));scriptqueue.length>0&&!1===processingscriptsqueue&&processScriptQueue()}}function processScriptQueue(){if(processingscriptsqueue=!0,0!=scriptqueue.length){var e=scriptqueue.shift();if("code"==e[0]){try{window.eval(e[1])}catch(t){console.log("Error executing question script:"+e[1])}processScriptQueueNext()}else jQuery.getScript(e[1]).always((function(){processScriptQueueNext()}))}}function processScriptQueueNext(){for(var e=0;e<initstack.length;e++)initstack[e]();initstack.length=0,0==scriptqueue.length?processingscriptsqueue=!1:processScriptQueue()}function setupTips(e,t,a){var r=document.getElementById(e);if(r){r.setAttribute("data-tip",t);var i=e.substr(2).split(/-/)[0];document.getElementById("tips"+i)||$("body").append($("<div>",{class:"hidden",id:"tips"+i}).html(a)),r.setAttribute("aria-describedby","tips"+i),r.addEventListener("focus",(function(){showehdd(e,t,i)})),r.addEventListener("blur",hideeh),r.addEventListener("click",(function(){reshrinkeh(e)}))}}function clearTips(){hideAllEhTips()}function initqsclickchange(){$("input[id^=qs][value=spec]").each((function(e,t){$(t).siblings("input[type=text]").off("keyup.qsclickchange").on("keyup.qsclickchange",(function(e){8!=e.keyCode&&46!=e.keyCode&&$(t).prop("checked",!0)}))}))}function clearScoreMarkers(e){var t,a=e.currentTarget;if(null!==(t=a.className.match(/(ansgrn|ansred|ansyel|ansorg)/)))$(a).removeClass(t[0]),$(a).nextAll(".scoremarker.sr-only").first().remove(),"ansorg"==t[0]&&$(a).nextAll(".scoremarker").first().remove(),"select"==a.tagName.toLowerCase()&&$(a).nextAll("svg.scoremarker").first().remove(),"hidden"==a.type&&$("#mqinput-"+a.id).removeClass(t[0]);else{var r=$(a).closest("[id^=qnwrap]");r.length>0&&null!==(t=r[0].className.match(/(ansgrn|ansred|ansyel|ansorg)/))&&(r.removeClass(t[0]),r.find(".scoremarker").remove())}}function setScoreMarkers(e){var t='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="green" stroke-width="3" fill="none" role="img" aria-hidden=true>';t+='<polyline points="20 6 9 17 4 12"></polyline></svg>',t+='<span class="sr-only scoremarker">'+_("Correct")+"</span>";var a='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="rgb(255,187,0)" stroke-width="3" fill="none" role="img" aria-hidden=true>';a+='<path d="M 5.3,10.6 9,14.2 18.5,4.6 21.4,7.4 9,19.8 2.7,13.5 z" /></svg>',a+='<span class="sr-only scoremarker">'+_("Partially correct")+"</span>";var r='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="rgb(153,0,0)" stroke-width="3" fill="none" role="img" aria-hidden=true>';r+='<path d="M18 6 L6 18 M6 6 L18 18" /></svg>',r+='<span class="sr-only scoremarker">'+_("Incorrect")+"</span>";var i='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="rgb(255,85,0)" stroke-width="3" fill="none" role="img" aria-hidden=true>';i+='<path d="M18 6 L6 18 M6 6 L18 18" /></svg>',i+='<span class="sr-only scoremarker">'+_("Incorrect, wrong format")+"</span>",$(e).find(".scoremarker").remove(),$(e).find("div.ansgrn,table.ansgrn").append(t),$(e).find("div.ansyel,table.ansyel").append(a),$(e).find("div.ansred,table.ansred").append(r),$(e).find("div.ansorg,table.ansorg").append(i),$(e).find("select.ansgrn").after(t),$(e).find("select.ansyel").after(a),$(e).find("select.ansred").after(r),$(e).find("select.ansorg").after(i),$(e).find("span[id^=mqinput-].ansgrn,input[type=text].ansgrn").after('<span class="scoremarker sr-only">'+_("Correct")+"</span>"),$(e).find("span[id^=mqinput-].ansyel,input[type=text].ansyel").after('<span class="scoremarker sr-only">'+_("Partially correct")+"</span>"),$(e).find("span[id^=mqinput-].ansred,input[type=text].ansred").after('<span class="scoremarker sr-only">'+_("Incorrect")+"</span>"),$(e).find("span[id^=mqinput-].ansorg,input[type=text].ansorg").after('<span class="scoremarker sr-only">'+_("Incorrect, wrong format")+"</span>"),$(e).find("span[id^=mqinput-].ansorg,input[type=text].ansorg").after($("<span>",{role:"button",class:"scoremarker",tabindex:0,"aria-label":_("Incorrect, wrong format"),"data-tip":_("Your answer is equivalent to the correct answer, but is not simplified or is in the wrong format"),"data-tooltipclass":"dropdown-pane tooltip-pane"}).on("mouseover focus",(function(){tipshow(this)})).on("mouseleave blur",tipout).html('<svg style="vertical-align:middle;margin-left:3px;" viewBox="0 0 24 24" width="18" height="18" stroke="rgb(255,85,0)" stroke-width="2" stroke-linecap="round" fill="none" role="img" aria-hidden=true><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12" y2="16"></line></svg>'))}function initClearScoreMarkers(){$("input[id^=qn]").off("input.clearmarkers").on("input.clearmarkers",clearScoreMarkers),$("input[id^=qs],select[id^=qn]").off("change.clearmarkers").on("change.clearmarkers",clearScoreMarkers)}function initEnterHandler(e){$("input[type=text][name=qn"+e+"]").off("keydown.enterhandler").on("keydown.enterhandler",(function(e){if(13==e.which){var t=$(this).closest(".questionwrap").find(".submitbtnwrap .primary");t.length>0&&e.preventDefault(),t.is(":disabled")||t.trigger("click")}}))}function handleMQenter(e){var t=$("#"+e).closest(".questionwrap").find(".submitbtnwrap .primary");t.is(":disabled")||t.trigger("click")}function initDupRubrics(){$(".rubriclink").each((function(e,t){$(t).removeClass("rubriclink");var a=t.id.substring(16);if(-1!==a.indexOf("-")){var r=a.split("-");a=1e3*(1*r[0]+1)+1*r[1]}var i=$("#mqinput-qn"+a+",input[type=text]#qn"+a+",select#qn"+a+",textarea#qn"+a+",div.introtext#qnwrap"+a);i.length>0&&(i.after(t),$(t).show())}))}function initShowAnswer2(){$("input.sabtn + span.hidden, input.sabtn + div.hidden").each((function(e,t){var a,r=t.id.substring(3),i=r;if(-1!==i.indexOf("-")){var n=i.split("-");i=1e3*(1*n[0]+1)+1*n[1],a=_("Question ")+(1*n[0]+1)+_(" Part ")+(1*n[1]+1)}else a=_("Question ")+(1*i+1);var s=$("<span>",{class:"keywrap"}).append($("<button>",{type:"button","aria-controls":"ans"+r,"aria-expanded":"false",class:"keybtn","aria-label":_("View Key for ")+a,title:_("View Key")}).on("click",(function(e){var t="true"==e.currentTarget.getAttribute("aria-expanded");e.currentTarget.setAttribute("aria-expanded",t?"false":"true"),$("#ans"+r).toggleClass("hidden",t),t||$("#ans"+r).attr("tabindex","-1").focus(),sendLTIresizemsg()})).html('<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>'));if($(t).closest(".autoshowans").length>0){var l=$("#qnwrap"+i);if(l.length>0)return $(t).prev(".sabtn").remove(),s.append($(t)).addClass("inwrap"),void l.append(s);var c=$("#mqinput-qn"+i+",input[type=text]#qn"+i+",select#qn"+i+",textarea#qn"+i);if(c.length>0)return $(t).prev(".sabtn").remove(),s.append($(t)),void c.after(s)}var o=$(t).parent();s.append($(t)),o.empty().append(s)})),$("input.dsbtn + div.hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),$("input.dsbtn").each((function(){var e=$(this).siblings("div:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",e).off("click.sashow").on("click.sashow",(function(){var e="true"==$(this).attr("aria-expanded");$(this).attr("aria-expanded",!e).siblings("div:first-of-type").attr("aria-expanded",!e).attr("aria-hidden",e).toggleClass("hidden",e),sendLTIresizemsg()}))}))}function initShowAnswer(){$("input.sabtn + span.hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),$("input.sabtn").each((function(){var e=$(this).siblings("span:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",e).off("click.sashow").on("click.sashow",(function(){$(this).attr("aria-expanded",!0).siblings("span:first-of-type").attr("aria-expanded",!0).attr("aria-hidden",!1).removeClass("hidden")}))})),$("input.dsbtn + div.hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),$("input.dsbtn").each((function(){var e=$(this).siblings("div:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",e).off("click.sashow").on("click.sashow",(function(){$(this).attr("aria-expanded",!0).siblings("div:first-of-type").attr("aria-expanded",!0).attr("aria-hidden",!1).removeClass("hidden")}))}))}function setupDraw(e){var t,a=document.getElementById("qn"+e).value.split(";;"),r=[];for(t=0;t<a.length;t++)if(5==t?a[t]="["+a[t].replace(/&quot;/g,'"')+"]":(a[t]="["+a[t].replace(/\(/g,"[").replace(/\)/g,"]")+"]",0==t&&a[t].length>2&&(a[t]="["+a[t].replace(/;/g,"],[")+"]")),""===a[t])r[t]=[];else try{r[t]=JSON.parse(a[t])}catch(e){r[t]=[]}window.drawla[e]=r,window.canvases[e]=allParams[e].canvas,imathasDraw.initCanvases(e);var i=document.getElementById("drawtools"+e);i&&i.addEventListener("click",(function(e){var t=e.target;if(t.hasAttribute("data-drawaction")){var a=t.getAttribute("data-drawaction"),r=t.getAttribute("data-qn");if("clearcanvas"===a)imathasDraw.clearcanvas(r);else if("settool"===a){var i=t.getAttribute("data-val");imathasDraw.settool(t,r,i)}}})),$("#qn"+e).parent().find(".a11ydrawadd:not(.inited)").off("click.adda11ydraw").on("click.adda11ydraw",(function(e){var t=e.target.getAttribute("data-qn");$(e.target).addClass("inited"),imathasDraw.adda11ydraw(t)}))}function initMultAns(e){if("hasnone"==$("#qnwrap"+e).attr("data-multans")){var t=$('input[name^="qn'+e+'["]');t.on("change",(function(){this.checked&&this.value==t.length-1?t.not(":last").prop("checked",!1):this.checked&&t.last().prop("checked",!1)}))}}function initMolecule(e){if("undefined"!=typeof Kekule){if(allKekule[e]=new Kekule.Editor.Composer(document.getElementById("chemdraw"+e)),allKekule[e].setEnableOperHistory(!0).setEnableLoadNewFile(!1).setEnableCreateNewDoc(!1).setAllowCreateNewChild(!1).setCommonToolButtons(["undo","redo","copy","cut","paste","zoomIn","reset","zoomOut"]).setChemToolButtons(["manipulate","erase","bond","atomAndFormula","ring","charge"]).setStyleToolComponentNames([]),"condensed"===allParams[e].displayformat){var t=new Kekule.Render.Render2DConfigs;t.getMoleculeDisplayConfigs().setDefMoleculeDisplayType(Kekule.Render.MoleculeDisplayType.CONDENSED),allKekule[e].setRenderConfigs(t)}allKekule[e].getEditor().on("editObjsUpdated",(function(t){processMolecule(e)})),allParams[e].chemla&&(allKekule[e].setChemObj(Kekule.IO.loadFormatData(allParams[e].chemla,"cml")),window.setTimeout((function(){let t=allKekule[e].getEditor();t.scrollClientToObject(t.getChemObj().getChildren())}),100));var a=document.getElementById("chemsa"+e);if(a){var r=new Kekule.ChemWidget.Viewer(a,null,Kekule.Render.RendererType.R2D);r.setEnableToolbar(!1).setPadding(20).setChemObj(Kekule.IO.loadFormatData(a.getAttribute("data-cmldata"),"cml")),"condensed"===allParams[e].displayformat&&r.setMoleculeDisplayType(Kekule.Render.Molecule2DDisplayType.CONDENSED)}}else{var i=e;setTimeout(function(){initMolecule(i)}.bind(this),100)}}function isBlank(e){return!e||0===e.length||/^\s*$/.test(e)}function editdebit(e){var t=e.target,a=$(t).closest("tr").find("input").first();if(!isBlank(t.value)&&a.hasClass("iscredit")){a.css("padding-left");a.is("select")?a.css("margin-right",20):a.width(""),a.css("padding-left",""),a.removeClass("iscredit")}}function editcredit(e){var t=e.target,a=$(t).closest("tr").find("input").first();if(!isBlank(t.value)&&!a.hasClass("iscredit")){var r=parseInt(a.css("padding-left"));a.is("select")?a.css("margin-right",0):a.width(a.width()-20),a.css("padding-left",20+r),a.addClass("iscredit")}}function initcreditboxes(){$(".creditbox").each((function(e,t){editcredit({target:t})}))}var LivePreviews=[];function setupLivePreview(e,t){if("MathJax"!=mathRenderer||window.MathJax&&(window.MathJax.Hub||window.MathJax.typesetPromise))LivePreviews.hasOwnProperty(e)||("MathJax"==mathRenderer||"Katex"==mathRenderer?(LivePreviews[e]={delay:"MathJax"==mathRenderer?100:0,finaldelay:1e3,preview:null,buffer:null,timeout:null,finaltimeout:null,mjRunning:!1,mjPending:!1,oldText:null,mjPromise:null,Init:function(t){$("#p"+e).css("positive","relative").append('<span id="lpbuf1'+e+'" style="visibility:hidden;position:absolute;"></span>').append('<span id="lpbuf2'+e+'" style="visibility:hidden;position:absolute;"></span>'),this.preview=document.getElementById("lpbuf1"+e),this.buffer=document.getElementById("lpbuf2"+e),"MathJax"==mathRenderer&&MathJax.typesetPromise&&(this.mjPromise=Promise.resolve()),t||showPreview(e)},SwapBuffers:function(){var e=this.preview,t=this.buffer;this.buffer=e,this.preview=t,e.style.visibility="hidden",e.style.position="absolute",t.style.position="",t.style.visibility=""},Update:function(e){this.timeout&&clearTimeout(this.timeout),this.finaltimeout&&clearTimeout(this.finaltimeout),this.timeout=setTimeout(this.callback,this.delay),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(e,t){this.oldtext=e,this.buffer.innerHTML=t?e:this.preformat(e),this.mjRunning=!0,this.RenderBuffer()},RenderBuffer:function(){"MathJax"==mathRenderer?MathJax.typesetPromise&&this.mjPromise?this.mjPromise=this.mjPromise.then(function(){MathJax.typesetPromise([this.buffer]).then(this.PreviewDone.bind(this))}.bind(this)):2===parseInt(MathJax.version)&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.buffer],["PreviewDone",this]):"Katex"==mathRenderer&&(renderMathInElement(this.buffer),"undefined"!=typeof MathJax&&MathJax.Hub&&!MathJax.typesetPromise&&$(this.buffer).children(".mj").length>0?MathJax.Hub.Queue(["PreviewDone",this]):this.PreviewDone())},DoFinalPreview:function(){$("#pbtn"+e).trigger("click")},preformat:function(t){var a=allParams[e].qtype,r=allParams[e].calcformat;return preformat(e,t,a,r)},CreatePreview:function(){if(this.timeout=null,!this.mjPending){var t=document.getElementById("qn"+e).value;t!==this.oldtext&&(this.mjRunning?(this.mjPending=!0,this.mjPromise?this.mjPromise=this.mjPromise.then(this.CreatePreview().bind(this)):MathJax.Hub&&2===parseInt(MathJax.version)&&MathJax.Hub.Queue(["CreatePreview",this])):(this.oldtext=t,this.buffer.innerHTML="`"+htmlEntities(this.preformat(t))+"`",this.mjRunning=!0,this.RenderBuffer()))}},PreviewDone:function(){this.mjRunning=this.mjPending=!1,this.SwapBuffers(),updateehpos()}},"undefined"==typeof MathJax||MathJax.typesetPromise?LivePreviews[e].callback=function(){LivePreviews[e].CreatePreview()}:(LivePreviews[e].callback=MathJax.Callback(["CreatePreview",LivePreviews[e]]),LivePreviews[e].callback.autoReset=!0),LivePreviews[e].Init(t)):LivePreviews[e]={finaldelay:1e3,finaltimeout:null,Update:function(e){this.finaltimeout&&clearTimeout(this.finaltimeout),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(t){var a=document.getElementById("p"+e);a.innerHTML=htmlEntities(t),rendermathnode(a)},DoFinalPreview:function(){$("#pbtn"+e).trigger("click")}});else{var a=e,r=t;setTimeout(100,(function(){setupLivePreview(a,r)}))}}function updateLivePreview(e){var t=e.target.id.substr(2);setupLivePreview(t),LivePreviews[t].Update()}function clearLivePreviewTimeouts(){for(var e in LivePreviews)clearTimeout(LivePreviews[e].finaltimeout)}function normalizemathunicode(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/[\x00-\x09\x0B\x0C\x0E-\x1F\x7F]/g,"")).replace(/\u2013|\u2014|\u2015|\u2212/g,"-")).replace(/\u2044|\u2215/g,"/")).replace(//g,"oo").replace(//g,"<=").replace(//g,">=").replace(//g,"U")).replace(//g,"+-").replace(//g,"/").replace(/|||/g,"*")).replace(//g,"sqrt").replace(//g,"root(3)")).replace(//g,"^0").replace(//g,"^1").replace(//g,"^2").replace(//g,"^3").replace(//g,"^4").replace(//g,"^5").replace(//g,"^6").replace(//g,"^7").replace(//g,"^8").replace(//g,"^9")).replace(/\u2329/g,"<").replace(/\u232a/g,">")).replace(//g,"_0").replace(//g,"_1").replace(//g,"_2").replace(//g,"_3")).replace(/\b(OO|infty)\b/gi,"oo").replace(//g,"degree")).replace(//g,"theta").replace(//g,"phi").replace(//g,"phi").replace(//g,"pi").replace(//g,"sigma").replace(//g,"mu")).replace(//g,"alpha").replace(//g,"beta").replace(//g,"gamma").replace(//g,"delta").replace(//g,"epsilon").replace(//g,"kappa")).replace(//g,"lambda").replace(//g,"rho").replace(//g,"tau").replace(//g,"chi").replace(//g,"omega")).replace(//g,"Omega").replace(//g,"Gamma").replace(//g,"Phi").replace(//g,"Delta").replace(//g,"Sigma")).replace(/&(ZeroWidthSpace|nbsp);/g," ").replace(/\u200B/g," ")).replace(/degree\s+s\b/g,"degree")).replace(/\(\((-?\d+)\)\)/g,"($1)")}function htmlEntities(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;")}function showPreview(e){var t=allParams[e],a="",r=processByType(e);if(r.str&&(a+="`"+htmlEntities(r.str)+"`"),r.dispvalstr&&""!=r.dispvalstr&&-1!=t.calcformat.indexOf("showval")&&(a+=(""==a?"":" &asymp; ")+"`"+htmlEntities(r.dispvalstr)+"`"),r.err&&""!=r.err&&""!=r.str&&(a+="``"==a?"":". <span class=noticetext>"+r.err+"</span>"),LivePreviews.hasOwnProperty(e))LivePreviews[e].RenderNow(a,!0);else{var i=document.getElementById("p"+e);i.innerHTML=a,rendermathnode(i)}a11ypreview(a)}function a11ypreview(e){var t=$("<div>",{class:"inactive"}).html(e).appendTo("body")[0];rendermathnode(t,(function(){var e=document.getElementById("arialive");e.innerHTML="",t.className="",$(t).find("[aria-label]").each((function(e,t){$(t).html($(t).attr("aria-label"))})),e.appendChild(t)}))}var MQsyntaxtimer=null;function syntaxCheckMQ(e,t){clearTimeout(MQsyntaxtimer);var a=parseInt(e.replace(/.*qn(\d+)\b.*/g,"$1"));MQsyntaxtimer=setTimeout((function(){showSyntaxCheckMQ(a)}),1e3)}function showSyntaxCheckMQ(e){var t=allParams[e],a=processByType(e),r="";if(a.dispvalstr&&""!=a.dispvalstr&&"NaN"!=a.dispvalstr&&t.calcformat&&-1!=t.calcformat.indexOf("showval")&&(r+="`"+htmlEntities(a.str)+"`","calcmatrix"==t.qtype||"calccomplexmatrix"==t.qtype||"calcinterval"==t.qtype&&t.calcformat.match(/inequality/)?r+=" &asymp; `"+htmlEntities(a.dispvalstr)+"` ":r+=" &asymp; "+htmlEntities(a.dispvalstr)+" "),a.err&&""!=a.err&&""!=a.str&&(r+="<span class=noticetext>"+a.err+"</span>"),!LivePreviews.hasOwnProperty(e)||"MathJax"!=mathRenderer&&"Katex"!=mathRenderer){var i=document.getElementById("p"+e);i&&(i.innerHTML=r,rendermathnode(i))}else LivePreviews[e].RenderNow(r,!0);document.getElementById("qn"+e)?a11ypreview("`"+htmlEntities(document.getElementById("qn"+e).value)+"` "+r):a11ypreview(r)}function preSubmitForm(e){var t;for(var a in allParams){var r;if(!1!==(t=preSubmit(a)))if(r=document.getElementById("qn"+a+"-val"))r.value=t;else{var i=document.createElement("input");i.type="hidden",i.name="qn"+a+"-val",i.value=t,e.appendChild(i)}}}function preSubmit(e){var t=processByType(e);return!!t.submitstr&&t.submitstr}function preSubmitString(e,t){var a=parseInt(e.substr(2));if(!allParams.hasOwnProperty(a))return t;var r=allParams[a];return t=(t=normalizemathunicode(t)).replace(/^\s+/,"").replace(/\s+$/,""),"numfunc"==r.qtype&&"qs"!=e.substr(0,2)&&(t=AMnumfuncPrepVar(a,t)[3]),t.length>3e4&&(t=t.substr(0,3e4)),t}function processByType(e){if(!allParams.hasOwnProperty(e))return!1;var t=allParams[e],a={};if("draw"==t.qtype)return imathasDraw.encodea11ydraw(),{};if("choices"==t.qtype||"multans"==t.qtype||"matching"==t.qtype)return{};if(t.hasOwnProperty("matrixsize"))a=processSizedMatrix(e);else{if("molecule"==t.qtype)return processMolecule(e),{};var r=document.getElementById("qn"+e);if(!r)return!1;var i=r.value;if((i=(i=normalizemathunicode(i)).replace(/^\s+/,"").replace(/\s+$/,"")).match(/^\s*$/))return{str:"",displvalstr:"",submitstr:""};if(i.match(/^\s*DNE\s*$/i))return{str:"DNE",displvalstr:"",submitstr:"DNE"};if(i.match(/^\s*oo\s*$/i))return{str:"oo",displvalstr:"",submitstr:"oo"};if(i.match(/^\s*\+oo\s*$/i))return{str:"+oo",displvalstr:"",submitstr:"+oo"};if(i.match(/^\s*-oo\s*$/i))return{str:"-oo",displvalstr:"",submitstr:"-oo"};switch(t.qtype){case"number":a=processNumber(i,t.calcformat);break;case"calculated":a=processCalculated(i,t.calcformat);break;case"interval":case"calcinterval":a=processCalcInterval(i,t.calcformat,t.vars);break;case"ntuple":case"calcntuple":case"complexntuple":case"calccomplexntuple":case"algntuple":a=processCalcNtuple(e,i,t.calcformat,t.qtype);break;case"complex":case"calccomplex":a=processCalcComplex(i,t.calcformat);break;case"numfunc":a=processNumfunc(e,i,t.calcformat);break;case"matrix":case"complexmatrix":case"calcmatrix":case"calccomplexmatrix":case"algmatrix":a=processCalcMatrix(e,i,t.calcformat,t.qtype)}a.str=preformat(e,i,t.qtype,t.calcformat)}return a}function preformat(e,t,a,r){return t=normalizemathunicode(t),a.match(/interval/)?r.match(/inequality/)?(t=(t=AMnumfuncPrepVar(e,t)[1]).replace(/<=/g," le ").replace(/>=/g," ge ").replace(/</g," lt ").replace(/>/g," gt ")).match(/all\s*real/i)&&(t="text("+t+")"):t=t.replace(/U/g,"uu"):"numfunc"==a?t=AMnumfuncPrepVar(e,t)[1]:"calcntuple"==a?t=t.replace(/<+/g,"(:").replace(/>+/g,":)"):"calculated"==a&&(-1==r.indexOf("list")&&-1==r.indexOf("set")&&commasep&&(t=t.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),-1!=r.indexOf("scinot")&&(t=t.replace(/(x|X|\u00D7)/,"xx"))),t=t.replace(/[^\u0000-\u007f]/g,"?")}var greekletters=["alpha","beta","chi","delta","epsilon","gamma","varphi","phi","psi","sigma","rho","theta","lambda","mu","nu","omega","tau"];function AMnumfuncPrepVar(e,t){var a,r="",i=(a="string"==typeof allParams[e].vars?[allParams[e].vars]:allParams[e].vars.slice()).map(escapeRegExp).join("|");allParams[e].fvars&&(r=allParams[e].fvars.map(escapeRegExp).join("|")),a.push("DNE"),i.match(/lambda/)&&(t=t.replace(/lamda/,"lambda"));var n=[],s=t;s=s.replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|argsinh|argcosh|argtanh|argsech|argcsch|argcoth|arsinh|arcosh|artanh|arsech|arcsch|arcoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root|pi)/g,functoindex),t=t.replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|argsinh|argcosh|argtanh|argsech|argcsch|argcoth|arsinh|arcosh|artanh|arsech|arcsch|arcoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root|pi)/g,functoindex);for(var l=0;l<a.length;l++)if(a[l].match(/\(.+\)/)&&(t=t.replace(/\(\((.*?)\)\)/g,"($1)")),"E"==a[l]||"e"==a[l])n[l]=!0;else{n[l]=allParams[e].calcformat.match(/casesensitivevars/);for(var c=0;c<a.length;c++)if(l!=c&&a[c].toLowerCase()==a[l].toLowerCase()&&a[c]!=a[l]){n[l]=!0;break}}t=t.replace(new RegExp("("+i+")","gi"),(function(e,t){for(var r=0;r<a.length;r++)if(a[r]==t||!n[r]&&a[r].toLowerCase()==t.toLowerCase())return"@v"+r+"@";return t})),t=t.replace(/@v(\d+)@/g,(function(e,t){return a[t]})),s=s.replace(new RegExp("("+i+")","gi"),(function(e,t){for(var r=0;r<a.length;r++)if(a[r]==t||!n[r]&&a[r].toLowerCase()==t.toLowerCase())return"@v"+r+"@";return t})),s=(s=(s=(s=s.replace(/(@v\d+@)(@v\d+@)/g,"$1 $2")).replace(/(@v\d+@)(@v\d+@)/g,"$1 $2")).replace(/(@v(\d+)@|\d+(\.\d+)?)!(?!=)/g,"{:$&:}")).replace(/@v(\d+)@/g,(function(e,t){return a[t]}));var o,u=t,d=new Array;for(l=0;l<a.length;l++)if(a[l].length>1){var p=!1;if(-1!=greekletters.indexOf(a[l].toLowerCase())&&(p=!0),a[l].match(/^\w+_\w+$/)){o=n[l]?"g":"gi";var h=new RegExp(/^(\w+)_(\w+)$/,o).exec(a[l]),m=new RegExp(h[1]+"_\\("+h[2]+"\\)",o);s=s.replace(m,a[l]),t=t.replace(m,a[l]),u=(u=u.replace(new RegExp(h[0],o),h[1]+"_"+h[2])).replace(new RegExp(h[1]+"_\\("+h[2]+"\\)",o),h[1]+"_("+h[2]+")"),h[1].length>1&&-1==greekletters.indexOf(h[1].toLowerCase())&&(h[1]='"'+h[1]+'"'),h[2].length>1&&-1==greekletters.indexOf(h[2].toLowerCase())&&(h[2]='"'+h[2]+'"'),s=s.replace(new RegExp(h[0],o),h[1]+"_"+h[2]),t=t.replace(new RegExp(h[0],"g")," repvars"+l),a[l]="repvars"+l}else!p&&a[l].replace(/[^\w_]/g,"").length>1&&d.push(a[l]);(a[l].match(/[^\w_]/)||a[l].match(/^(break|case|catch|continue|debugger|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|this|throw|try|typeof|var|void|while|and with)$/))&&(t=t.replace(new RegExp(escapeRegExp(a[l]),"g")," repvars"+l),a[l]="repvars"+l)}if(d.length>0){vltq=d.join("|");var g=new RegExp("("+vltq+")","g");s=s.replace(g,'"$1"')}return s=(s=s.replace(/(@\d+@)/g," $1")).replace(/@(\d+)@/g,indextofunc),t=t.replace(/@(\d+)@/g,indextofunc),u=u.replace(/@(\d+)@/g,indextofunc),i.match(/\bf\b/)&&!r.match(/\bf\b/)&&(s=(s=s.replace(/([^a-zA-Z])f\^([\d\.]+)([^\d\.])/g,"$1f^$2{::}$3")).replace(/([^a-zA-Z])f\(/g,"$1f{::}(")),i.match(/\bg\b/)&&!r.match(/\bg\b/)&&(s=(s=s.replace(/([^a-zA-Z])g\^([\d\.]+)([^\d\.])/g,"$1g^$2{::}$3")).replace(/([^a-zA-Z])g\(/g,"$1g{::}(")),[t,s,a.join("|"),u]}function roundForDisp(e){return Array.isArray(e)?e.map(roundForDisp):"number"==typeof e?Math.abs(e)<1?e.toPrecision(4).replace(/\.?0+$/,""):e.toFixed(4).replace(/\.?0+$/,""):e}function processNumber(e,t){var a,r="";if(e=e.replace(/^\s+|\s+$/g,""),-1!==t.indexOf("set")&&("{"!==e.charAt(0)||"}"!==e.substr(-1)?r+=_("Invalid set notation"):e=e.slice(1,-1)),-1!==t.indexOf("list")||-1!==t.indexOf("set"))var i=e.split(/\s*,\s*/);else{!commasep&&e.match(/,/)&&(r+=_("Invalid use of a comma."));i=[e.replace(/,/g,"")]}for(var n=0;n<i.length;n++)if(a=i[n],-1!=t.indexOf("units")){_("Units must be given as [decimal number]*[unit]^[power]*[unit]^[power].../[unit]^[power]*[unit]^[power]...");if(a.match(/^\s*(-?\s*\d+\.?\d*|-?\s*\.\d+|-?\s*\d\.?\d*\s*(E|\*\s*10\s*\^)\s*[\-\+]?\d+)/)||(r+=_("Answer must start with a number. ")),a.match(/\b(sq|square|cu|cubic|squared|cubed)\s*\^\s*[\-\+]?\s*\d+/)&&(r+=_("Invalid base for exponent. "),a=a.replace(/\^/,"")),a.match(/\b(sq|square|cu|cubic)\s+per\b/)&&(r+=_('Missing unit before "per". '),a=a.replace(/per\b/,"")),a.match(/\bper\s+(squared|cubed)/)&&(r+=_('Missing unit after "per". '),a=a.replace(/\bper/,"")),(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=a.replace(/([a-zA-Z]\w*\s*)(\^\s*[\-\+]?\s*\d+\s*)(?:squared|cubed)\b/g,"$1")).replace(/(?:sq|square|cu|cubic)\s+([a-zA-Z]\w*)/g,"$1")).replace(/([a-zA-Z]\w*)\s+(?:squared|cubed)/g,"$1")).replace(/\sper\s/g,"/")).replace(/^\s*(-?\s*\d\.?\d*\s*(E|\*\s*10\s*\^)\s*[\-\+]?\d+|-?\s*\d+\.?\d*|-?\s*\.\d+)\s*[\-\*]?\s*/,"")).replace(/\s*\-\s*([a-zA-Z])/g,"*$1")).replace(/\*\*/g,"^")).replace(/\s*(\/|\^|\-)\s*/g,"$1")).replace(/\(\s*(.*?)\s*\)\s*\//,"$1/").replace(/\/\s*\(\s*(.*?)\s*\)/,"/$1")).replace(/\s*[\*\s]\s*/g,"*")).replace(/([a-zA-Z]\w*)\^[\-\+]?\d+/g,"$1")).match(/\^/)&&(r+=_("Invalid exponents. "),a=a.replace(/\^/g,"")),(a.match(/\//g)||[]).length>1&&(r+=_("Only one division symbol allowed in the units. ")),(a=a.replace(/\//g,"*").replace(/^\s*\*/,"").trim()).length>0)for(var s="(yotta|zetta|exa|peta|tera|giga|mega|kilo|hecto|deka|deca|deci|centi|milli|micro|nano|pico|fempto|atto|zepto|yocto)",l="(Y|Z|E|P|T|G|M|k|h|da|d|c|m|u|n|p|f|a|z|y)",c=/^(m|meter|metre|micron|angstrom|fermi|in|inch|inches|ft|foot|feet|mi|mile|furlong|yd|yard|s|sec|second|min|minute|h|hr|hour|day|week|mo|month|yr|year|fortnight|acre|ha|hectare|b|barn|L|liter|litre|cc|gal|gallon|cup|pt|pint|qt|quart|tbsp|tablespoon|tsp|teaspoon|rad|radian|deg|degree|arcminute|arcsecond|grad|gradian|knot|kt|c|mph|kph|g|gram|gramme|t|tonne|Hz|hertz|rev|revolution|cycle|N|newton|kip|dyn|dyne|lb|pound|lbf|ton|J|joule|erg|lbft|ftlb|cal|calorie|eV|electronvolt|Wh|Btu|therm|W|watt|hp|horsepower|Pa|pascal|atm|atmosphere|bar|Torr|mmHg|umHg|cmWater|psi|ksi|Mpsi|C|coulomb|V|volt|farad|F|ohm|amp|ampere|A|T|tesla|G|gauss|Wb|weber|H|henry|lm|lumen|lx|lux|amu|dalton|Da|me|mol|mole|Ci|curie|R|roentgen|sr|steradian|Bq|becquerel|ls|lightsecond|ly|lightyear|AU|au|parsec|pc|solarmass|solarradius|degF|degC|degK|K)$/,o=new RegExp("^"+l+"?(m|ft|s|b|cc|g|t|N|dyn|J|cal|eV|Wh|W|hp|Pa|C|V|F|A|T|G|Wb|H|lm|lx|Da|mol|M|Ci|sr|Bq|ls|ly|pc)$"),u=new RegExp("^(inch|inches|lbft|ftlb|solarmass|solarradius)$","i"),d=new RegExp("^"+l+"?(L|Hz|Btu)$","i"),p=new RegExp("^"+s+"?(fermi|foot|feet|sec|hertz|horsepower|Torr|gauss|lux)$","i"),h=new RegExp("^(micron|mile|furlong|yard|minute|hour|day|week|month|year|fortnight|acre|hectare|gallon|cup|pint|quart|tablespoon|teaspoon|radian|degree|gradian|knot|revolution|cycle|kip|lb|therm|atmosphere|roentgen)s?$","i"),m=new RegExp("^"+s+"?(meter|metre|angstrom|second|barn|liter|litre|arcminute|arcsecond|gram|gramme|tonne|newton|dyne|pound|ton|joule|erg|calorie|electronvolt|watt|pascal|coulomb|volt|farad|ohm|amp|ampere|tesla|weber|henry|lumen|dalton|mole|curie|steradian|becquerel|lightsecond|lightyear|parsec)s?$","i"),g=a.split(/\s*\*\s*/),f=0;f<g.length;f++){unitsregexmatch=g[f].match(d);let e=!1;if(unitsregexmatch&&void 0!==unitsregexmatch[1])new RegExp("^"+l+"$").test(unitsregexmatch[1])||(e=!0);(c.test(g[f])||o.test(g[f])||u.test(g[f])||d.test(g[f])||p.test(g[f])||h.test(g[f])||m.test(g[f]))&&!e||(r+=_("Unknown unit ")+'"'+g[f]+'". ')}else r+=_("Missing units")}else-1!=t.indexOf("integer")?a.match(/^\s*\-?\d+\s*$/)||(r+=_("This is not an integer.")):a.match(/^\s*(\+|\-)?(\d+\.?\d*|\.\d+|\d*\.?\d*\s*E\s*[\-\+]?\d+)\s*$/)||(r+=_("This is not a decimal or integer value."));return{err:r,dispvalstr:e}}function processCalculated(e,t){if(-1!=t.indexOf("allowplusminus")&&(e=e.replace(/(.*?)\+\-(.*?)(,|$)/g,"$1+$2,$1-$2$3")),-1!=t.indexOf("list"))var a=e.split(/,/);else if(-1!=t.indexOf("set"))a=e.replace(/[\{\}]/g,"").split(/,/);else a=[e];for(var r,i="",n=[],s=0;s<a.length;s++)str=a[s],i+=singlevalsyntaxcheck(str,t),i+=syntaxcheckexpr(str,t),i+=(r=singlevaleval(str,t))[1],n.push(r[0]);var l=roundForDisp(n).join(", ");return-1!=t.indexOf("set")&&(l="{"+l+"}"),{err:i,dispvalstr:l,submitstr:n.join(",")}}function processCalcInterval(e,t,a){if(e=e.replace(/cup/g,"U"),-1!=t.indexOf("inequality")){var r=ineqtointerval(e=e.replace(/or/g," or "),a);if(r.length>1)return{err:"wrongvar"==r[1]?_("you may have used the wrong variable"):_("invalid inequality notation")};e=r[0]}var n=[],s=[],l=[],c="U";if(-1!=t.indexOf("list")){e=e.replace(/\s*,\s*/g,",").replace(/(^,|,$)/g,""),c=",";for(var o=0,u=1;u<e.length-1;u++)","==e.charAt(u)&&(")"!=e.charAt(u-1)&&"]"!=e.charAt(u-1)||"("!=e.charAt(u+1)&&"["!=e.charAt(u+1)||(n.push(e.substring(o,u)),o=u+1));n.push(e.substring(o))}else n=e.split(/\s*U\s*/i);var d,p,h,m="",g=[],f=[];for(i=0;i<n.length;i++){if(d=n[i],sm=d.charAt(0),em=d.charAt(d.length-1),2!=(p=(p=d.substring(1,d.length-1)).split(/,/)).length||"("!=sm&&"["!=sm||")"!=em&&"]"!=em){-1!=t.indexOf("inequality")?m+=_("invalid inequality notation")+". ":m+=_("invalid interval notation")+". ";break}for(j=0;j<2;j++)-1!=t.indexOf("decimal")&&p[j].match(/[\d\.]e\-?\d/)&&(p[j]=p[j].replace(/e/,"E")),m+=singlevalsyntaxcheck(p[j],t),m+=syntaxcheckexpr(p[j],t),p[j].match(/^\s*\-?\+?oo\s*$/)?g[j]=p[j]:(m+=(h=singlevaleval(p[j],t))[1],g[j]=h[0]);f=roundForDisp(g),s[i]=sm+g[0]+","+g[1]+em,-1!=t.indexOf("inequality")?g[0].toString().match(/oo/)?g[1].toString().match(/oo/)?l[i]="RR":l[i]=a+("]"==em?" le ":" lt ")+f[1]:g[1].toString().match(/oo/)?l[i]=a+("["==sm?" ge ":" gt ")+f[0]:l[i]=f[0]+("["==sm?" le ":" lt ")+a+("]"==em?" le ":" lt ")+f[1]:l[i]=sm+f[0]+","+f[1]+em}return-1!=t.indexOf("inequality")?{err:m,dispvalstr:l.join(' "or" '),submitstr:s.join(c)}:{err:m,dispvalstr:l.join(" uu "),submitstr:s.join(c)}}function processCalcNtuple(e,t,a,r){var i,n="",s="",l=0,c=0,o="",u=!0,d=NaN;(t=(t=(t=normalizemathunicode(t)).replace(/(\s+,\s+|,\s+|\s+,)/g,",").replace(/(^,|,$)/g,"")).replace(/<<(.*?)>>/g,"<$1>")).charAt(0).match(/[\(\[\<\{]/)||(u=!1);for(var p=0;p<t.length;p++)i=!1,0==l&&(n+=t.charAt(p),s+=t.charAt(p),c=p+1,","==t.charAt(p)?t.substring(p+1).match(/^\s*[\(\[\<\{]/)&&t.substring(0,p).match(/[\)\]\>\}]\s*$/)||(u=!1):p>0&&","!=t.charAt(p-1)&&(u=!1)),t.charAt(p).match(/[\(\[\<\{]/)?l++:t.charAt(p).match(/[\)\]\>\}]/)&&(l--,i=!0),(0==l&&i||1==l&&","==t.charAt(p))&&(sub=t.substring(c,p).replace(/^\s+/,"").replace(/\s+$/,""),""==sub&&(u=!1),r.match(/complex/)?(o+=(d=evalcheckcomplex(sub,a)).err,s+=d.outstrdisp,s+=t.charAt(p),d.outstr&&(n+=d.outstr,n+=t.charAt(p))):"algntuple"===r?o+=(d=processNumfunc(e,sub,a)).err:(o+=singlevalsyntaxcheck(sub,a),o+=syntaxcheckexpr(sub,a),o+=(d=singlevaleval(sub,a))[1],n+=d[0],s+=roundForDisp(d[0]),n+=t.charAt(p),s+=t.charAt(p)),c=p+1);return 0!=l&&(u=!1),0==u&&(o=_("Invalid notation")+". "+o),"algntuple"===r&&(s=""),a.match(/generalcomplex/)&&(n=""),{err:o,dispvalstr:s,submitstr:n}}function processCalcComplex(e,t){-1!=t.indexOf("allowplusminus")&&(e=e.replace(/(.*?)\+\-(.*?)(,|$)/g,"$1+$2,$1-$2$3"));for(var a,r="",i=e.split(","),n=[],s=[],l=0;l<i.length;l++)r+=(a=evalcheckcomplex(i[l],t)).err,s.push(a.outstrdisp),a.outstr&&n.push(a.outstr);return-1!=t.indexOf("generalcomplex")?{err:r,dispvalstr:s.join(", ")}:{err:r,dispvalstr:s.join(", "),submitstr:n.join(",")}}function processSizedMatrix(e){var t=allParams[e],a=t.matrixsize,r="";t.calcformat&&(r=t.calcformat);for(var i,n,s=[],l=[],c=[],o=0,u="",d=0;d<a[0];d++){s[d]=[],l[d]=[];for(var p=0;p<a[1];p++)i=normalizemathunicode(i=document.getElementById("qn"+e+"-"+o).value),t.qtype.match(/complex/)?(u+=(n=evalcheckcomplex(i,r)).err,l[d][p]=n.outstrdisp,n.outstr&&c.push(n.outstr)):"algmatrix"===t.qtype?u+=(n=processNumfunc(e,i,r)).err:(""!==i&&(u+=syntaxcheckexpr(i,r),u+=singlevalsyntaxcheck(i,r)),s[d][p]=i,u+=(n=singlevaleval(i,r))[1],l[d][p]=n[0],c.push(n[0])),o++;s[d]="("+s[d].join(",")+")",l[d]="("+roundForDisp(l[d]).join(",")+")"}return{err:u,str:"["+s.join(",")+"]",dispvalstr:t.qtype.match(/calc/)?"["+l.join(",")+"]":"",submitstr:c.join("|")}}function processCalcMatrix(e,t,a,r){var i=!0;((t=(t=(t=t.replace(/\[/g,"(")).replace(/\]/g,")")).replace(/\s+/g,"")).length<2||"("!==t.charAt(0)||")"!==t.charAt(t.length-1))&&(i=!1),t=t.substring(1,t.length-1);for(var n="",s="",l=[],c=0,o=0,u=0;u<t.length;u++)"("==t.charAt(u)?o++:")"==t.charAt(u)?o--:","==t.charAt(u)&&0==o&&(l.push(t.substring(c+1,u-1)),c=u+1);0==c&&"("!=t.charAt(0)?l.push(t):l.push(t.substring(c+1,t.length-1));var d,p,h,m=-1;0!==o&&(i=!1);var g=[],f=[];for(u=0;u<l.length;u++){g[u]=[],d=l[u].split(","),m>-1&&d.length!=m&&(i=!1),m=d.length;for(var v=0;v<d.length;v++)""==(p=d[v].replace(/^\s+/,"").replace(/\s+$/,""))?(s=_("No elements of the matrix should be left blank."),g[u][v]="",f.push("")):"algmatrix"===r?n+=(h=processNumfunc(e,p,a)).err:r.match(/complex/)?(n+=(h=evalcheckcomplex(p,a)).err,g[u][v]=h.outstrdisp,h.outstr&&f.push(h.outstr)):(n+=syntaxcheckexpr(p,a),n+=singlevalsyntaxcheck(p,a),n+=(h=singlevaleval(p,a))[1],g[u][v]=roundForDisp(h[0]),f.push(h[0]));g[u]="("+g[u].join(",")+")"}return i||(n=_("Invalid matrix format")+". "),{err:n+=s,dispvalstr:"["+g.join(",")+"]",submitstr:f.join("|")}}function processNumfunc(e,t,a){var r,i,n,s,l,c,o=allParams[e],u=o.vars,d=o.fvars,p=o.domain,h=a.match(/equation/),m=a.match(/inequality/),g="",f=AMnumfuncPrepVar(e,t);a.match(/list/)?i=f[0].split(/,/):(!commasep&&f[0].match(/,/)&&(g+=_("Invalid use of a comma.")),i=[f[0]]);for(var v=0,y=0;y<i.length;y++){r=(r=i[y]).replace(/,/g,"").replace(/^\s+/,"").replace(/\s+$/,"").replace(/degree/g,"");var x=f[2].split("|");if(r.match(/(<=|>=|<|>|!=)/)?(m?r.match(/(<=|>=|<|>|!=)/g).length>1?g+=_("syntax error: your inequality should only contain one inequality symbol")+". ":r.match(/(^(<|>|!))|(=|>|<)$/)&&(g+=_("syntax error: your inequality should have expressions on both sides")+". "):g+=h?_("syntax error: you gave an inequality, not an equation")+". ":_("syntax error: you gave an inequality, not an expression")+". ",r=r.replace(/(.*)(<=|>=|<|>|!=)(.*)/,"$1-($3)")):r.match(/=/)?(m&&!h?g+=_("syntax error: you gave an equation, not an inequality")+". ":h?r.match(/=/g).length>1?g+=_("syntax error: your equation should only contain one equal sign")+". ":r.match(/(^=)|(=$)/)&&(g+=_("syntax error: your equation should have expressions on both sides")+". "):g+=_("syntax error: you gave an equation, not an expression")+". ",r=r.replace(/(.*)=(.*)/,"$1-($2)")):h&&m?g+=_("syntax error: this is not an equation or inequality")+". ":h?g+=_("syntax error: this is not an equation")+". ":m&&(g+=_("syntax error: this is not an inequality")+". "),!a.match(/generalcomplex/)){for(d.length>0&&(reg=new RegExp("("+d.join("|")+")\\(","g"),r=(r=(r=r.replace(/\w+/g,functoindex)).replace(reg,"$1*sin($1+")).replace(/@(\d+)@/g,indextofunc)),r=prepWithMath(mathjs(r,x.join("|"))),v=0,s=0;s<20;s++){for(l="var DNE=1;",n=0;n<x.length-1;n++)c=p[n][2]?Math.floor(p[n][0]+(p[n][1]-p[n][0])*s/20):p[n][0]+(p[n][1]-p[n][0])*s/20,l+="var "+x[n]+"="+c+";";if("synerr"!==scopedeval(l+r)){v++;break}}0===v&&(g+=_("syntax error")+". ")}g+=syntaxcheckexpr(f[0],a+",isnumfunc",u.map(escapeRegExp).join("|"))}return{err:g}}function processMolecule(e){var t=allKekule[e].exportObjs(Kekule.Molecule)[0];if(void 0===t)document.getElementById("qn"+e).value="";else{var a=Kekule.IO.saveFormatData(t,"smi"),r=Kekule.IO.saveFormatData(t,"cml");document.getElementById("qn"+e).value=a+"~~~"+r}}function simplifyVariable(e){return e.replace(/[^\w_\^\-+]/g,"")}function ineqtointerval(e,t){var a=simplifyVariable(t);if(commasep&&(e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),e.match(/all\s*real/i))return["(-oo,oo)"];if(e.match(/DNE/))return["DNE"];var r,i,n=[],s=e.split(/\s*or\s*/);if(1==s.length&&e.match(/!=/)){var l=e.split(/!=/);return 2!=l.length?["","invalid"]:simplifyVariable(l[0])!=a?["","wrongvar"]:["(-oo,"+l[1]+")U("+l[1]+",oo)"]}for(var c=0;c<s.length;c++)if(str=s[c],r=str.match(/^(.*?)(<=?|>=?)(.*?)(<=?|>=?)(.*?)$/)){if(simplifyVariable(r[3])!=a)return["","wrongvar"];if(r[2].charAt(0)!=r[4].charAt(0))return["","invalid"];if(""==r[1].trim()||""==r[5].trim())return["","invalid"];i="<"==r[2].charAt(0)?("<"==r[2]?"(":"[")+r[1]+","+r[5]+("<"==r[4]?")":"]"):(">"==r[4]?"(":"[")+r[5]+","+r[1]+(">"==r[2]?")":"]"),n.push(i)}else{if(!(r=str.match(/^(.*?)(<=?|>=?)(.*?)$/)))return["","invalid"];if(simplifyVariable(r[1])==a)i="<"==r[2].charAt(0)?"(-oo,"+r[3]+("<"==r[2]?")":"]"):(">"==r[2]?"(":"[")+r[3]+",oo)",n.push(i);else{if(simplifyVariable(r[3])!=a)return["","wrongvar"];i="<"==r[2].charAt(0)?("<"==r[2]?"(":"[")+r[1]+",oo)":"(-oo,"+r[1]+(">"==r[2]?")":"]"),n.push(i)}}var o=n.join("U");return o.match(/[\(\[],|,[\)\]]/)?["","invalid"]:[o]}function evalcheckcomplex(e,t){var a="",r="",i="";if(e=e.replace(/^\s+/,"").replace(/\s+$/,""),-1!=t.indexOf("allowjcomplex")&&(e=e.replace(/j/g,"i")),a+=syntaxcheckexpr(e,t),-1!=t.indexOf("generalcomplex"))return{err:a,outstrdisp:e};if(-1==t.indexOf("sloppycomplex")){var n=parsecomplex(e);"string"==typeof n?a+=n:(a+=singlevalsyntaxcheck(n[0],t),a+=singlevalsyntaxcheck(n[1],t))}if(""!==e){var s=prepWithMath(mathjs(e,"i")),l=scopedeval("var i=0;"+s),c=scopedeval("var i=1;"+s),o=scopedeval("var i=-1;"+s);"synerr"!=l&&"synerr"!=c||(a+=_("syntax incomplete"),l=NaN),isNaN(l)||"Infinity"==l||isNaN(c)||isNaN(o)||"Infinity"==c||(c-=l,r=Math.abs(l)<1e-16?"":l,i=Math.abs(l)<1e-16?"":roundForDisp(l),r+=Math.abs(c)<1e-16?"":(c>0&&""!=r?"+":"")+c+"i",i+=Math.abs(c)<1e-16?"":(c>0&&""!=r?"+":"")+roundForDisp(c)+"i")}return{err:a,outstrdisp:i,outstr:r}}function parsecomplex(e){var t,a,r,i,n,s,l,c=(e=(e=(e=(e=e.replace(/\s/,"")).replace(/\((\d+\*?i|i)\)\/(\d+)/g,"$1/$2")).replace(/sin/g,"s$n")).replace(/pi/g,"p$")).length;if(e.split("i").length>2)return _("error - more than 1 i in expression");if(-1==(n=e.indexOf("i")))t=e,a="0";else{for(i=0,l=n-1;l>0;l--)if(")"==(r=e.charAt(l)))i++;else if("("==r)i--;else if(("+"==r||"-"==r)&&0==i)break;if(l<0&&(l=0),0!=i)return _("error - invalid form");for(i=0,s=n+1;s<c;s++)if("("==(r=e.charAt(s)))i++;else if(")"==r)i--;else if(("+"==r||"-"==r)&&0==i)break;if(0!=i)return _("error - invalid form");if(n-l>0&&s-n>0&&(s==c||0==l)){if(s==c)t=e.substr(0,l),a=e.substr(l,n-l);else{if(0!=l)return _("error - invalid form");t=e.substr(s),a=e.substr(0,n)}a=(a=(a+="*"+e.substr(n+1+("*"==e.charAt(n+1)?1:0),s-n-1)).replace("-*","-1*").replace("+*","+1*")).replace(/(\+|-)1\*(.+)/g,"$1$2")}else if(n-l>1)a=e.substr(l,n-l),t=e.substr(0,l)+e.substr(n+1);else if(s-n>1)if(n>0){if("+"!=e.charAt(n-1)&&"-"!=e.charAt(n-1))return _("error - invalid form");a=e.charAt(n-1)+e.substr(n+1+("*"==e.charAt(n+1)?1:0),s-n-1),t=e.substr(0,n-1)+e.substr(s)}else a=e.substr(n+1,s-n-1),t=e.substr(0,n)+e.substr(s);else a="+"==e.charAt(l)?"1":"-"==e.charAt(l)?"-1":0==n?"1":e.charAt(l),t=(n>0?e.substr(0,l):"")+e.substr(n+1);""==t&&(t="0"),"/"==a.charAt(0)?a="1"+a:"+"!=a.charAt(0)&&"-"!=a.charAt(0)||"/"!=a.charAt(1)||(a=a.charAt(0)+"1"+a.substr(1)),"*"==a.charAt(a.length-1)&&(a=a.substr(0,a.length-1)),"+"==a.charAt(0)&&(a=a.substr(1)),"+"==t.charAt(0)&&(t=t.substr(1))}return[t=(t=t.replace(/s\$n/g,"sin")).replace(/p\$/g,"pi"),a=(a=(a=a.replace(/s\$n/g,"sin")).replace(/p\$/g,"pi")).replace(/\*\//g,"/")]}var onlyAscii=/^[\u0000-\u007f]*$/;function singlevalsyntaxcheck(e,t){if(commasep&&(e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),e.match(/DNE/i))return"";if(e.match(/-?\+?oo$/)||e.match(/-?\+?oo\W/))return"";if(e.match(/,/))return _("Invalid use of a comma.");if(-1!=t.indexOf("allowmixed")&&e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/))return"";if(-1!=t.indexOf("fracordec")){if(!((e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2").replace(/\s/g,"")).match(/^\(?\-?\(?\d+\)?\/\(?\d+\)?$/)||e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)||e.match(/^\-?\d+$/)||e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/)))return _(" invalid entry format")+". "}else if(-1!=t.indexOf("fraction")||-1!=t.indexOf("reducedfraction")){if(!(e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2").replace(/\s/g,"")).match(/^\(?\-?\(?\d+\)?\/\(?\-?\d+\)?$/)&&!e.match(/^\s*?\-?\d+\s*$/))return _("not a valid fraction")+". "}else if(-1!=t.indexOf("mixednumber")){if(!(e.match(/^\(?\-?\s*\(?\d+\)?\/\(?\d+\)?$/)||e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)||e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/)||e.match(/^\s*\-?\s*\d+\s*$/)))return _("not a valid mixed number")+". ";e=e.replace(/_/," ")}else if(-1!=t.indexOf("scinot")){if(!(e=(e=e.replace(/\s/g,"")).replace(/(xx|x|X|\u00D7)/,"xx")).match(/^\-?[1-9](\.\d*)?(\*|xx)10\^(\(?\(?\-?\d+\)?\)?)$/)){if(-1==t.indexOf("scinotordec"))return _("not valid scientific notation")+". ";if(!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)([eE]\-?\d+)?$/))return _("not valid decimal or scientific notation")+". "}}else if(-1!=t.indexOf("decimal")&&-1==t.indexOf("nodecimal")){if(!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)([eE]\-?\d+)?$/))return _(" not a valid integer or decimal number")+". "}else if(-1!=t.indexOf("integer")){if(!e.match(/^\s*\-?\d+(\.0*)?\s*$/))return _(" not an integer number")+". "}else if(!onlyAscii.test(e))return _("Your answer contains an unrecognized symbol")+". ";return""}function syntaxcheckexpr(e,t,a){var r="";-1!=t.indexOf("notrig")&&e.match(/(sin|cos|tan|cot|sec|csc)/i)?r+=_("no trig functions allowed")+". ":-1!=t.indexOf("nodecimal")&&-1!=e.indexOf(".")?r+=_("no decimals allowed")+". ":-1==t.indexOf("mixed")&&e.match(/\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/)?r+=_("mixed numbers are not allowed")+". ":-1==t.indexOf("allowdegrees")&&e.match(/degree/)&&(r+=_("no degree symbols allowed")+". ");for(var i=0,n=0,s=0,l=0;l<e.length;l++)"("==e.charAt(l)?i++:")"==e.charAt(l)?i--:"["==e.charAt(l)?n++:"]"==e.charAt(l)?n--:"|"==e.charAt(l)&&(s=1-s);if(0==i&&0==n||(r+=" ("+_("unmatched parens")+"). "),0!=s&&(r+=" ("+_("unmatched absolute value bars")+"). "),reg=a?new RegExp("(sqrt|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*("+a+"|\\d+)","i"):new RegExp("(sqrt|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*(\\d+)","i"),errstuff=e.match(reg),null!=errstuff&&(r+="["+_("use function notation")+" - "+_("use $1 instead of $2",errstuff[1]+"("+errstuff[2]+")",errstuff[0])+"]. "),a)if(t.match(/casesensitivevars/)){(c="degree|arc|arg|ar|sqrt|root|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs|pi|sign|DNE|e|oo".split("|")).sort((function(e,t){return t.length-e.length}));let t=new RegExp("("+c.join("|")+")","ig");(c=a.split("|")).sort((function(e,t){return t.length-e.length}));let i=new RegExp("("+c.join("|")+")","g");e.replace(/repvars\d+/g,"").replace(t,"").replace(i,"").match(/[a-zA-Z]/)&&(r+=_(" Check your variables - you might be using an incorrect one")+". ")}else{var c;(c="degree|arc|arg|ar|sqrt|root|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs|pi|sign|DNE|e|oo".split("|").concat(a.split("|"))).sort((function(e,t){return t.length-e.length}));let t=new RegExp("("+c.join("|")+")","ig");e.replace(/repvars\d+/g,"").replace(t,"").match(/[a-zA-Z]/)&&(r+=_(" Check your variables - you might be using an incorrect one")+". ")}if((e.match(/\|/g)||[]).length>2)for(var o=/\|.*?\|\s*(.|$)/g;match=o.exec(e);)if(""!=match[1]&&match[1].match(/[^+\-\*\/\^\)]/)){r+=_(" You may want to use abs(x) instead of |x| for absolute values to avoid ambiguity")+". ";break}return e.match(/\(\s*\)/)&&(r+=_(" Empty function input or parentheses")+". "),e.match(/%/)&&!e.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(r+=_(" Do not use the percent symbol, %")+". "),e.match(/=/)&&!t.match(/isnumfunc/)&&(r+=_("You gave an equation, not an expression")+". "),r}function singlevaleval(e,t){if(commasep&&(e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),e.match(/,/))return[NaN,_("syntax incomplete")+". "];e.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(e=e.replace(/%/g,"")+"/100"),-1!=t.indexOf("mixed")&&(e=e.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),-1!=t.indexOf("allowxtimes")&&(e=e.replace(/(xx|x|X|\u00D7)/,"*")),-1!=t.indexOf("scinot")&&(e=e.replace("xx","*"));try{var a=scopedmatheval(e);return""===a||void 0===a?[NaN,_("syntax incomplete")+". "]:[a,""]}catch(e){return[NaN,_("syntax incomplete")+". "]}}function escapeRegExp(e){return e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function scopedeval(c){try{return eval(c)}catch(e){return"synerr"}}function scopedmatheval(c){if(c.match(/^\s*[a-df-zA-Z]\s*$/))return"";try{return eval(prepWithMath(mathjs(c)))}catch(e){return""}}return{init:init,clearparams:clearparams,preSubmitForm:preSubmitForm,preSubmit:preSubmit,preSubmitString:preSubmitString,clearLivePreviewTimeouts:clearLivePreviewTimeouts,syntaxCheckMQ:syntaxCheckMQ,clearTips:clearTips,handleMQenter:handleMQenter}}(jQuery);function prepWithMath(e){return e=(e=(e=e.replace(/\b(abs|acos|asin|atan|ceil|floor|cos|sin|tan|sqrt|exp|max|min|pow)\(/g,"Math.$1(")).replace(/\(E\)/g,"(Math.E)")).replace(/\((PI|pi)\)/g,"(Math.PI)")}function toggleinlinebtn(e,t){var a=document.getElementById(t),r=document.getElementById(e);"none"==r.style.display?(r.style.display="",r.setAttribute("aria-hidden",!1),a.setAttribute("aria-expanded",!0)):(r.style.display="none",r.setAttribute("aria-hidden",!0),a.setAttribute("aria-expanded",!1));var i=a.innerHTML;a.innerHTML=i.match(/\[\+\]/)?i.replace(/\[\+\]/,"[-]"):i.replace(/\[\-\]/,"[+]"),sendLTIresizemsg()}var seqgroupcollapsed={};function setupSeqPartToggles(e){if(e.id&&e.id.match(/questionwrap/)){var t=parseInt(e.id.substr(12)),a=$(e).find(".seqsep");if(seqgroupcollapsed[t]&&1!=a.length||(seqgroupcollapsed[t]={}),a.length>1)for(var r=0;r<a.length-1;r++)$(a[r]).next().attr("id","seqgrp"+t+"-"+r),seqgroupcollapsed[t][r]&&$(a[r]).next().hide(),$(a[r]).prepend($("<button>",{class:"plain slim",style:"color: inherit","aria-expanded":!seqgroupcollapsed[t][r],"aria-controls":"seqgrp"+t+"-"+r,"aria-label":seqgroupcollapsed[t][r]?_("Expand"):_("Collapse"),html:seqgroupcollapsed[t][r]?"&#x25B6;":"&#x25BC;",type:"button",click:function(e){var t="true"==this.getAttribute("aria-expanded"),a=this.getAttribute("aria-controls");t?(this.setAttribute("aria-expanded","false"),this.setAttribute("aria-label",_("Expand")),this.innerHTML="&#x25B6;"):(this.setAttribute("aria-expanded","true"),this.setAttribute("aria-label",_("Collapse")),this.innerHTML="&#x25BC;"),$("#"+a).slideToggle(300);var r=a.substr(6).split("-");seqgroupcollapsed[r[0]][r[1]]=t,sendLTIresizemsg()}}))}}function AutoSuggest(e,t){var a=this;this.elem=e,this.suggestions=t,this.eligible=new Array,this.inputText=null,this.highlighted=-1,this.div=document.getElementById("autosuggest"),null==this.div&&(this.div=document.createElement("div"),this.div.id="autosuggest",document.getElementsByTagName("body")[0].appendChild(this.div),this.div.appendChild(document.createElement("ul")));if(e.setAttribute("autocomplete","off"),!e.id){var r="autosuggest"+AutoSuggestIdCounter;AutoSuggestIdCounter++,e.id=r}e.onkeydown=function(e){var t=a.getKeyCode(e);switch(t){case 9:a.useSuggestion("tab");break;case 13:return a.highlighted>-1&&e.stopImmediatePropagation(),a.useSuggestion("enter"),!1;case 27:a.hideDiv();break;case 38:a.highlighted>0&&a.highlighted--,a.changeHighlight(t);break;case 40:a.highlighted<a.eligible.length-1&&a.highlighted++,a.changeHighlight(t)}},e.onkeyup=function(e){switch(a.getKeyCode(e)){case 9:case 27:case 38:case 40:return;default:this.value.length>1?(a.inputText=this.value,a.getEligible(),a.eligible.length>0?a.highlighted=0:a.highlighted=-1,a.createDiv(),a.positionDiv(),a.showDiv()):(a.hideDiv(),0==this.value.length&&(a.inputText=""))}},e.onblur=function(e){a.hideDiv()},this.useSuggestion=function(e){this.highlighted>-1?(this.elem.value=this.eligible[this.highlighted],this.hideDiv()):this.hideDiv()},this.showDiv=function(){this.div.style.display="block"},this.hideDiv=function(){a.div.style.display="none",a.highlighted=-1},this.changeHighlight=function(){var e=this.div.getElementsByTagName("LI");for(i in e){var t=e[i];this.highlighted==i?t.className="selected":t.className=""}},this.positionDiv=function(){var e=this.elem,t=findPos(e);t[1]+=e.offsetHeight,this.div.style.left=t[0]+"px",this.div.style.top=t[1]+"px"},this.createDiv=function(){var e=document.createElement("ul");for(i in this.eligible){var t=this.eligible[i],r=document.createElement("li"),n=document.createElement("a");n.href="#",n.onclick=function(){return!1},n.innerHTML=t,r.appendChild(n),a.highlighted==i&&(r.className="selected"),e.appendChild(r)}this.div.replaceChild(e,this.div.childNodes[0]),this.setHighlight=function(e){for(var t=a.getEventSource(e);t.parentNode&&"LI"!=t.tagName.toUpperCase();)t=t.parentNode;var r=a.div.getElementsByTagName("LI");for(i in r){if(r[i]==t){a.highlighted=i;break}}a.changeHighlight()},e.onmouseover=a.setHighlight,e.onmousedown=e.ontouchstart=function(e){return a.setHighlight(e),a.useSuggestion("click"),a.hideDiv(),a.cancelEvent(e),!1},this.div.className="suggestion_list",this.div.style.position="absolute"},this.getEligible=function(){this.eligible=new Array;if(-1==this.inputText.indexOf(" ")){var e=new RegExp("\\b"+this.inputText.toLowerCase());for(i in this.suggestions){var t=this.suggestions[i];t.toLowerCase().match(e)&&(this.eligible[this.eligible.length]=t,i+",")}}},this.getKeyCode=function(e){return e?e.keyCode:window.event?window.event.keyCode:void 0},this.getEventSource=function(e){return e?e.target:window.event?window.event.srcElement:void 0},this.cancelEvent=function(e){e&&(e.preventDefault(),e.stopPropagation()),window.event&&(window.event.returnValue=!1)}}var AutoSuggestIdCounter=0,autoSuggestLists={},autoSuggestObjects={};document.write=function(){};var ehcurel=null,ehclosetimer=0,ehddclosetimer=0,curehdd=null,eecurel=null;function showeh(e){if(null==eecurel){unhideeh(0);var t=document.getElementById(e),l=document.getElementById("eh");if(e!=ehcurel){ehcurel=e;var d=jQuery(t).offset();l.style.display="block",l.style.left=d.left+"px",l.style.top=d.top+t.offsetHeight+"px",document.getElementById("ehdd").style.display="none"}else l.style.display="none",ehcurel=null;e.match(/mqinput/)?MQ(t).focus():t.focus()}}function reshrinkeh(e){null==eecurel&&e==ehcurel&&(document.getElementById("ehdd").style.display="block",document.getElementById("eh").style.display="none",ehcurel=null,curehdd=e,unhideeh(0))}function unhideeh(e){ehcancelclosetimer()}function hideeh(e){null==ehcurel?ehddclosetimer=window.setTimeout((function(){curehdd=null,document.getElementById("ehdd").style.display="none"}),250):ehclosetimer=window.setTimeout(reallyhideeh,250)}function reallyhideeh(){document.getElementById("eh").style.display="none",ehcurel=null}function ehcancelclosetimer(){ehclosetimer&&(window.clearTimeout(ehclosetimer),ehclosetimer=null)}function hideAllEhTips(){ehclosetimer&&(window.clearTimeout(ehclosetimer),ehclosetimer=null),ehddclosetimer&&(window.clearTimeout(ehddclosetimer),ehddclosetimer=null),curehdd=null,document.getElementById("ehdd").style.display="none",document.getElementById("eh").style.display="none"}function showehdd(e,t,l){if((null==eecurel||eecurel!=e)&&null!=document.getElementById("tips"+l)){if(ehddclosetimer&&e!=curehdd&&(window.clearTimeout(ehddclosetimer),ehddclosetimer=null),e!=ehcurel){var d=document.getElementById("ehdd"),n=document.getElementById(e),o=jQuery(n).offset();document.getElementById("ehddtext").innerHTML=t,document.getElementById("eh").innerHTML=document.getElementById("tips"+l).innerHTML,d.style.display="block",d.style.left=o.left+"px",d.style.top=o.top+n.offsetHeight+"px"}curehdd=e}}function updateehpos(){if(curehdd||ehcurel){var e=document.getElementById("eh"),t=document.getElementById("ehdd"),l=document.getElementById(curehdd||ehcurel),d=jQuery(l).offset();e.style.left=d.left+"px",e.style.top=d.top+l.offsetHeight+"px",t.style.left=d.left+"px",t.style.top=d.top+l.offsetHeight+"px"}}var pi=Math.PI,ln=Math.log,e=Math.E,arcsin=Math.asin,arccos=Math.acos,arctan=Math.atan,sec=function(r){return 1/Math.cos(r)},csc=function(r){return 1/Math.sin(r)},cot=function(r){return 1/Math.tan(r)},arcsec=function(r){return arccos(1/r)},arccsc=function(r){return arcsin(1/r)},arccot=function(r){return arctan(1/r)},sinh=function(r){return(Math.exp(r)-Math.exp(-r))/2},cosh=function(r){return(Math.exp(r)+Math.exp(-r))/2},tanh=function(r){return(Math.exp(r)-Math.exp(-r))/(Math.exp(r)+Math.exp(-r))},sech=function(r){return 1/cosh(r)},csch=function(r){return 1/sinh(r)},coth=function(r){return 1/tanh(r)},arcsinh=function(r){return ln(r+Math.sqrt(r*r+1))},arccosh=function(r){return ln(r+Math.sqrt(r*r-1))},arctanh=function(r){return ln((1+r)/(1-r))/2},arcsech=(sech=function(r){return 1/cosh(r)},csch=function(r){return 1/sinh(r)},coth=function(r){return 1/tanh(r)},function(r){return arccosh(1/r)}),arccsch=function(r){return arcsinh(1/r)},arccoth=function(r){return arctanh(1/r)},sign=function(r){return 0==r?0:r<0?-1:1},logten=function(r){return Math.LOG10E*Math.log(r)},sinn=function(r,c){return Math.pow(Math.sin(c),r)},cosn=function(r,c){return Math.pow(Math.cos(c),r)},tann=function(r,c){return Math.pow(Math.tan(c),r)},cscn=function(r,c){return 1/Math.pow(Math.sin(c),r)},secn=function(r,c){return 1/Math.pow(Math.cos(c),r)},cotn=function(r,c){return 1/Math.pow(Math.tan(c),r)},lnn=function(r,c){return Math.pow(Math.log(c),r)};function factorial(r,c){null==c&&(c=1);for(var t=r-c;t>0;t-=c)r*=t;return r<0?NaN:0==r?1:r}function C(r,c){for(var t=1,n=0;n<c;n++)t*=(r-n)/(c-n);return t}function matchtolower(r){return r.toLowerCase()}function nthroot(r,c){return safepow(c,1/r)}function nthlogten(r,c){return Math.log(c)/Math.log(r)}var funcstoindexarr="sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root|arcsin|arccos|arctan|arcsec|arccsc|arccot|arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|argsinh|argcosh|argtanh|argsech|argcsch|argcoth|arsinh|arcosh|artanh|arsech|arcsch|arcoth|pi".split("|");function functoindex(r){for(var c=0;c<funcstoindexarr.length;c++)if(funcstoindexarr[c]==r)return"@"+c+"@";return r}function indextofunc(r,c){return funcstoindexarr[c]}function safepow(r,c){if(r<0&&Math.floor(c)!=c){for(var t=3;t<50;t+=2)if(Math.abs(Math.round(t*c)-t*c)<1e-6)return Math.round(t*c)%2==0?Math.pow(Math.abs(r),c):-1*Math.pow(Math.abs(r),c);return Math.sqrt(-1)}return Math.pow(r,c)}function mathjs(r,c){if(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=r.replace(/(\+\s*-|-\s*\+)/g,"-").replace(/-\s*-/g,"+")).replace(/\[/g,"(")).replace(/\]/g,")")).replace(/\b00+\./g,"0.")).replace(/root\s*(\d+)/,"root($1)")).replace(/\|(.*?)\|/g,"abs($1)")).replace(/arc(sin|cos|tan|sec|csc|cot|sinh|cosh|tanh|sech|csch|coth)/gi,"$1^-1")).replace(/(ar|arg)(sinh|cosh|tanh|sech|csch|coth)/gi,"$2^-1")).replace(/(Sin|Cos|Tan|Sec|Csc|Cot|Arc|Abs|Log|Exp|Ln|Sqrt)/gi,matchtolower)).replace(/(sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root)/g,functoindex),null!=c&&""!=c){var t=c.split("|");t.push("pi"),t.sort((function(r,c){return c.length-r.length})),c=t.join("|");for(var n=[],a=0;a<t.length;a++)if(n[a]=!1,"E"==t[a]||"e"==t[a])n[a]=!0;else for(var e=0;e<t.length;e++)if(a!=e&&t[e].toLowerCase()==t[a].toLowerCase()&&t[e]!=t[a]){n[a]=!0;break}r=r.replace(new RegExp("("+c+")","gi"),(function(r,c){for(var a=0;a<t.length;a++)if(t[a]==c||!n[a]&&t[a].toLowerCase()==c.toLowerCase())return"(@v"+a+"@)";return c}))}else r=r.replace(/pi/g,"(pi)");var o,s,h;for(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=r.replace(/([0-9])E([\-0-9])/g,"$1(EE)$2")).replace(/\*?\s*degrees?/g,"*((pi)/180)")).replace(/div/,"/")).replace(/e/g,"(E)")).replace(/@(\d+)@/g,indextofunc)).replace(/log_([a-zA-Z\d\.]+)\s*\(/g,"nthlog($1,")).replace(/log_\(([a-zA-Z\/\d\.]+)\)\s*\(/g,"nthlog(($1),")).replace(/log_(\(@v\d+@\))\s*\(/g,"nthlog($1,")).replace(/log/g,"logten")).replace(/(sin|cos|tan|sec|csc|cot|sinh|cosh|tanh|sech|csch|coth)\^(-1|\(-1\))/g,"arc$1")).replace(/(sin|cos|tan|sec|csc|cot|ln)\^(\d+)\s*\(/g,"$1n($2,")).replace(/(sin|cos|tan|sec|csc|cot|ln)\^\((\d+)\)\s*\(/g,"$1n($2,")).replace(/root\s*\(([a-zA-Z\/\d\.]+)\)\s*\(/g,"nthroot(($1),")).replace(/root\s*\(\((@v\d+@)\)\)\s*\(/g,"nthroot($1,")).replace(/([0-9]\.?)\s+([0-9])/g,"$1*$2")).replace(/#/g,"")).replace(/\s/g,""),null!=c&&""!=c&&(r=r.replace(/@v(\d+)@/g,(function(r,c){return t[c]}))),r=(r=(r=(r=r.replace(/([0-9]\.?)([\(a-zA-Z])/g,"$1*$2")).replace(/(!)([0-9\(a-zA-Z])/g,"$1*$2")).replace(/\)([\(0-9a-zA-Z]|\.\d+)/g,")*$1")).replace(/([0-9])\*\(EE\)\*?([\-0-9])/g,"$1e$2");-1!=(a=r.indexOf("!"));){if(0==a)return"Error: missing argument";if(e=a-1,(s=r.charAt(e))>="0"&&s<="9"||"."==s){for(e--;e>=0&&(s=r.charAt(e))>="0"&&s<="9";)e--;if("."==s)for(e--;e>=0&&(s=r.charAt(e))>="0"&&s<="9";)e--}else if(")"==s){for(h=1,e--;e>=0&&h>0;)"("==(s=r.charAt(e))?h--:")"==s&&h++,e--;for(;e>=0&&((s=r.charAt(e))>="a"&&s<="z"||s>="A"&&s<="Z");)e--}else{if(!(s>="a"&&s<="z"||s>="A"&&s<="Z"))return"Error: incorrect syntax in "+r+" at position "+e;for(e--;e>=0&&((s=r.charAt(e))>="a"&&s<="z"||s>="A"&&s<="Z");)e--}r=r.slice(0,e+1)+"factorial("+r.slice(e+1,a)+")"+r.slice(a+1)}for(;-1!=(a=r.lastIndexOf("^"));){if(0==a)return"Error: missing argument";if(e=a-1,(s=r.charAt(e))>="0"&&s<="9"||"."==s){for(e--;e>=0&&(s=r.charAt(e))>="0"&&s<="9";)e--;if("."==s)for(e--;e>=0&&(s=r.charAt(e))>="0"&&s<="9";)e--}else if(")"==s){for(h=1,e--;e>=0&&h>0;)"("==(s=r.charAt(e))?h--:")"==s&&h++,e--;for(;e>=0&&((s=r.charAt(e))>="a"&&s<="z"||s>="A"&&s<="Z");)e--}else{if(!(s>="a"&&s<="z"||s>="A"&&s<="Z"))return"Error: incorrect syntax in "+r+" at position "+e;for(e--;e>=0&&((s=r.charAt(e))>="a"&&s<="z"||s>="A"&&s<="Z");)e--}if(a==r.length-1)return"Error: missing argument";if(o=a+1,s=r.charAt(o),nch=r.charAt(o+1),s>="0"&&s<="9"||"-"==s&&"("!=nch||"."==s){for(o++;o<r.length&&(s=r.charAt(o))>="0"&&s<="9";)o++;if("."==s)for(o++;o<r.length&&(s=r.charAt(o))>="0"&&s<="9";)o++}else if("("==s||"-"==s&&"("==nch)for("-"==s&&o++,h=1,o++;o<r.length&&h>0;)"("==(s=r.charAt(o))?h++:")"==s&&h--,o++;else{if(!(s>="a"&&s<="z"||s>="A"&&s<="Z"))return"Error: incorrect syntax in "+r+" at position "+o;for(o++;o<r.length&&((s=r.charAt(o))>="a"&&s<="z"||s>="A"&&s<="Z");)o++;if("("==s&&r.slice(a+1,o).match(/^(sinn|cosn|tann|secn|cscn|cotn|sin|cos|tan|sec|csc|cot|logten|nthlogten|log|ln|exp|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|sqrt|abs|nthroot|factorial|safepow)$/))for(h=1,o++;o<r.length&&h>0;)"("==(s=r.charAt(o))?h++:")"==s&&h--,o++}r=r.slice(0,e+1)+"safepow("+r.slice(e+1,a)+","+r.slice(a+1,o)+")"+r.slice(o)}return r}var AMtoMQ=function(){var t={input:'"',tag:"mtext",output:"mbox",tex:null,ttype:10},e=[{input:"alpha",tag:"mi",output:"",tex:null,ttype:0},{input:"beta",tag:"mi",output:"",tex:null,ttype:0},{input:"chi",tag:"mi",output:"",tex:null,ttype:0},{input:"delta",tag:"mi",output:"",tex:null,ttype:0},{input:"Delta",tag:"mo",output:"",tex:null,ttype:0},{input:"epsi",tag:"mi",output:"",tex:"epsilon",ttype:0},{input:"varepsilon",tag:"mi",output:"",tex:null,ttype:0},{input:"eta",tag:"mi",output:"",tex:null,ttype:0},{input:"gamma",tag:"mi",output:"",tex:null,ttype:0},{input:"Gamma",tag:"mo",output:"",tex:null,ttype:0},{input:"iota",tag:"mi",output:"",tex:null,ttype:0},{input:"kappa",tag:"mi",output:"",tex:null,ttype:0},{input:"lambda",tag:"mi",output:"",tex:null,ttype:0},{input:"Lambda",tag:"mo",output:"",tex:null,ttype:0},{input:"mu",tag:"mi",output:"",tex:null,ttype:0},{input:"nu",tag:"mi",output:"",tex:null,ttype:0},{input:"omega",tag:"mi",output:"",tex:null,ttype:0},{input:"Omega",tag:"mo",output:"",tex:null,ttype:0},{input:"phi",tag:"mi",output:"",tex:null,ttype:0},{input:"varphi",tag:"mi",output:"",tex:null,ttype:0},{input:"Phi",tag:"mo",output:"",tex:null,ttype:0},{input:"pi",tag:"mi",output:"",tex:null,ttype:0},{input:"Pi",tag:"mo",output:"",tex:null,ttype:0},{input:"psi",tag:"mi",output:"",tex:null,ttype:0},{input:"Psi",tag:"mi",output:"",tex:null,ttype:0},{input:"rho",tag:"mi",output:"",tex:null,ttype:0},{input:"sigma",tag:"mi",output:"",tex:null,ttype:0},{input:"Sigma",tag:"mo",output:"",tex:null,ttype:0},{input:"tau",tag:"mi",output:"",tex:null,ttype:0},{input:"theta",tag:"mi",output:"",tex:null,ttype:0},{input:"vartheta",tag:"mi",output:"",tex:null,ttype:0},{input:"Theta",tag:"mo",output:"",tex:null,ttype:0},{input:"upsilon",tag:"mi",output:"",tex:null,ttype:0},{input:"xi",tag:"mi",output:"",tex:null,ttype:0},{input:"Xi",tag:"mo",output:"",tex:null,ttype:0},{input:"zeta",tag:"mi",output:"",tex:null,ttype:0},{input:"*",tag:"mo",output:"",tex:"cdot",ttype:0},{input:"-:",tag:"mo",output:"",tex:"div",ttype:0},{input:"sum",tag:"mo",output:"",tex:null,ttype:7},{input:"^^",tag:"mo",output:"",tex:"wedge",ttype:0},{input:"xor",tag:"mo",output:"",tex:"oplus",ttype:0},{input:"oplus",tag:"mo",output:"",tex:"oplus",ttype:0},{input:"ominus",tag:"mo",output:"",tex:"ominus",ttype:0},{input:"neg",tag:"mo",output:"",tex:"neg",ttype:0},{input:"vv",tag:"mo",output:"",tex:"vee",ttype:0},{input:"nn",tag:"mo",output:"",tex:"cap",ttype:0},{input:"uu",tag:"mo",output:"",tex:"cup",ttype:0},{input:"xx",tex:"times",ttype:0},{input:"!=",tag:"mo",output:"",tex:"ne",ttype:0},{input:"<=",tag:"mo",output:"",tex:"le",ttype:0},{input:">=",tag:"mo",output:"",tex:"ge",ttype:0},{input:"geq",tag:"mo",output:"",tex:null,ttype:0},{input:"in",tag:"mo",output:"",tex:null,ttype:0},{input:"sub",tag:"mo",output:"",tex:"subset",ttype:0},{input:"sube",tag:"mo",output:"",tex:"subseteq",ttype:0},{input:"(",tag:"mo",output:"(",tex:null,ttype:4},{input:")",tag:"mo",output:")",tex:null,ttype:5},{input:"[",tag:"mo",output:"[",tex:null,ttype:4},{input:"]",tag:"mo",output:"]",tex:null,ttype:5},{input:"{",tag:"mo",output:"{",tex:"{",ttype:4,notexcopy:!0},{input:"}",tag:"mo",output:"}",tex:"}",ttype:5,notexcopy:!0},{input:"|",tag:"mo",output:"|",tex:null,ttype:9},{input:"(:",tag:"mo",output:"",tex:"langle",ttype:4},{input:":)",tag:"mo",output:"",tex:"rangle",ttype:5},{input:"<<",tag:"mo",output:"",tex:"langle",ttype:4},{input:">>",tag:"mo",output:"",tex:"rangle",ttype:5},{input:"{:",tag:"mo",output:"{:",tex:null,ttype:4,invisible:!0},{input:":}",tag:"mo",output:":}",tex:null,ttype:5,invisible:!0},{input:"int",tag:"mo",output:"",tex:null,ttype:0},{input:"+-",tag:"mo",output:"",tex:"pm",ttype:0},{input:"O/",tag:"mo",output:"",tex:"emptyset",ttype:0},{input:"oo",tag:"mo",output:"",tex:"infty",ttype:0},{input:"rarr",tag:"mo",output:"",tex:"rightarrow",ttype:0},{input:"->",tag:"mo",output:"",tex:"to",ttype:0},{input:"=>",tag:"mo",output:"",tex:"implies",ttype:0},{input:"<=>",tag:"mo",output:"",tex:"iff",ttype:0},{input:"rightleftharpoons",tag:"mo",output:"",tex:null,ttype:0},{input:"RR",tag:"mo",output:"",tex:"mathbb{R}",ttype:0,notexcopy:!0},{input:"f",tag:"mi",output:"f",tex:null,ttype:1,func:!0,val:!0},{input:"degree",tag:"mo",tex:null,ttype:0},{input:"degrees",output:"degree",ttype:8},{input:"sin",tag:"mo",output:"sin",tex:null,ttype:1,func:!0},{input:"cos",tag:"mo",output:"cos",tex:null,ttype:1,func:!0},{input:"tan",tag:"mo",output:"tan",tex:null,ttype:1,func:!0},{input:"arcsin",tag:"mo",output:"arcsin",tex:null,ttype:1,func:!0},{input:"arccos",tag:"mo",output:"arccos",tex:null,ttype:1,func:!0},{input:"arctan",tag:"mo",output:"arctan",tex:null,ttype:1,func:!0},{input:"arcsec",tag:"mo",output:"arcsec",tex:null,ttype:1,func:!0},{input:"arccsc",tag:"mo",output:"arccsc",tex:null,ttype:1,func:!0},{input:"arccot",tag:"mo",output:"arccot",tex:null,ttype:1,func:!0},{input:"sinh",tag:"mo",output:"sinh",tex:null,ttype:1,func:!0},{input:"cosh",tag:"mo",output:"cosh",tex:null,ttype:1,func:!0},{input:"tanh",tag:"mo",output:"tanh",tex:null,ttype:1,func:!0},{input:"cot",tag:"mo",output:"cot",tex:null,ttype:1,func:!0},{input:"coth",tag:"mo",output:"coth",tex:null,ttype:1,func:!0},{input:"sech",tag:"mo",output:"sech",tex:null,ttype:1,func:!0},{input:"csch",tag:"mo",output:"csch",tex:null,ttype:1,func:!0},{input:"sec",tag:"mo",output:"sec",tex:null,ttype:1,func:!0},{input:"csc",tag:"mo",output:"csc",tex:null,ttype:1,func:!0},{input:"log",tag:"mo",output:"log",tex:null,ttype:1,func:!0},{input:"ln",tag:"mo",output:"ln",tex:null,ttype:1,func:!0},{input:"abs",tag:"mo",output:"abs",tex:null,ttype:1},{input:"Sin",tag:"mo",output:"sin",tex:null,ttype:1,func:!0},{input:"Cos",tag:"mo",output:"cos",tex:null,ttype:1,func:!0},{input:"Tan",tag:"mo",output:"tan",tex:null,ttype:1,func:!0},{input:"Arcsin",tag:"mo",output:"arcsin",tex:null,ttype:1,func:!0},{input:"Arccos",tag:"mo",output:"arccos",tex:null,ttype:1,func:!0},{input:"Arctan",tag:"mo",output:"arctan",tex:null,ttype:1,func:!0},{input:"Sinh",tag:"mo",output:"sinh",tex:null,ttype:1,func:!0},{input:"Sosh",tag:"mo",output:"cosh",tex:null,ttype:1,func:!0},{input:"Tanh",tag:"mo",output:"tanh",tex:null,ttype:1,func:!0},{input:"Cot",tag:"mo",output:"cot",tex:null,ttype:1,func:!0},{input:"Sec",tag:"mo",output:"sec",tex:null,ttype:1,func:!0},{input:"Csc",tag:"mo",output:"csc",tex:null,ttype:1,func:!0},{input:"Log",tag:"mo",output:"log",tex:null,ttype:1,func:!0},{input:"Ln",tag:"mo",output:"ln",tex:null,ttype:1,func:!0},{input:"Abs",tag:"mo",output:"abs",tex:null,ttype:1,func:!0},{input:"sqrt",tag:"msqrt",output:"sqrt",tex:null,ttype:1},{input:"root",tag:"mroot",output:"root",tex:null,ttype:2},{input:"frac",tag:"mfrac",output:"/",tex:null,ttype:2},{input:"/",tag:"mfrac",output:"/",tex:null,ttype:3},{input:"stackrel",tag:"mover",output:"stackrel",tex:null,ttype:2},{input:"_",tag:"msub",output:"_",tex:null,ttype:3},{input:"^",tag:"msup",output:"^",tex:null,ttype:3},{input:"Sqrt",tag:"msqrt",output:"sqrt",tex:null,ttype:1},{input:"hat",tag:"mover",output:"^",tex:null,ttype:1,acc:!0},{input:"bar",tag:"mover",output:"",tex:"overline",ttype:1,acc:!0},{input:"vec",tag:"mover",output:"",tex:null,ttype:1,acc:!0},{input:"text",tag:"mtext",output:"text",tex:null,ttype:10},{input:"mbox",tag:"mtext",output:"mbox",tex:null,ttype:10},t];function u(t,e){return t.input>e.input?1:-1}var p,n,l,a=[];function r(t,e){var u;u="\\"==t.charAt(e)&&"\\"!=t.charAt(e+1)&&" "!=t.charAt(e+1)?t.slice(e+1):t.slice(e);for(var p=0;p<u.length&&u.charCodeAt(p)<=32;p+=1);return u.slice(p)}function o(t,e,u){if(0==u){var p,n;for(u=-1,p=t.length;u+1<p;)t[n=u+p>>1]<e?u=n:p=n;return p}for(var l=u;l<t.length&&t[l]<e;l++);return l}function i(t){for(var u,p,r,i=0,c="",g=!0,s=1;s<=t.length&&g;s++)p=t.slice(0,s),(i=o(a,p,i))<a.length&&t.slice(0,a[i].length)==a[i]&&(u=i,s=(c=a[i]).length),g=i<a.length&&t.slice(0,a[i].length)>=a[i];if(n=l,""!=c)return l=e[u].ttype,e[u];l=0,i=1,p=t.slice(0,1);for(var m=!0;"0"<=p&&p<="9"&&i<=t.length;)p=t.slice(i,i+1),i++;if("."==p&&(p=t.slice(i,i+1),i++,"0"<=p&&p<="9"))for(m=!1;"0"<=p&&p<="9"&&i<=t.length;)p=t.slice(i,i+1),i++;return m&&i>1||i>2?(p=t.slice(0,i-1),r="mn"):(i=2,r=("A">(p=t.slice(0,1))||p>"Z")&&("a">p||p>"z")?"mo":"mi"),"-"==p&&" "!==t.charAt(1)&&3==n?(l=3,{input:p,tag:r,output:p,ttype:1,func:!0,val:!0}):{input:p,tag:r,output:p,ttype:0,val:!0}}function c(t){var e;if("{"==t.charAt(0)&&"}"==t.charAt(t.length-1)){var u=0;"\\left"==(e=t.substr(1,5))?"("==(e=t.charAt(6))||"["==e||"{"==e?u=7:"\\lbrace"==(e=t.substr(6,7))&&(u=13):"("!=(e=t.charAt(1))&&"["!=e||(u=2),u>0&&("\\right)}"==(e=t.substr(t.length-8))||"\\right]}"==e||"\\right.}"==e?t=(t="{"+t.substr(u)).substr(0,t.length-8)+"}":"\\rbrace}"==e&&(t=(t="{"+t.substr(u)).substr(0,t.length-14)+"}"))}return t}function g(t){return"boolean"==typeof t.val&&t.val?pre="":pre="\\",null==t.tex?pre+t.input:pre+t.tex}function s(t){return null==t.tex?t.input:"\\"+t.tex}function m(e){var u,n,l,a,o="";if(null==(u=i(e=r(e,0)))||5==u.ttype&&p>0)return[null,e];switch(8==u.ttype&&(u=i(e=u.output+r(e,u.input.length))),u.ttype){case 7:case 0:e=r(e,u.input.length);var x=g(u);return"\\"==x.charAt(0)||"mo"==u.tag?[x,e]:["{"+x+"}",e];case 4:if(p++,l=h(e=r(e,u.input.length),!0),p--,l[0].match(/bmatrix/))return[n=l[0].substring(0,l[0].length-7),l[1]];var y=0;return"\\right"==l[0].substr(0,6)&&(")"==(b=l[0].charAt(6))||"]"==b||"}"==b?y=6:"."==b?y=7:"\\rbrace"==(b=l[0].substr(6,7))&&(y=13)),y>0?(l[0]=l[0].substr(y),n="boolean"==typeof u.invisible&&u.invisible?"{"+l[0]+"}":"{"+s(u)+l[0]+"}"):n="boolean"==typeof u.invisible&&u.invisible?"{"+l[0]+"}":"{\\left"+s(u)+l[0]+"}",[n,l[1]];case 10:return u!=t&&(e=r(e,u.input.length)),-1==(a="{"==e.charAt(0)?e.indexOf("}"):"("==e.charAt(0)?e.indexOf(")"):"["==e.charAt(0)?e.indexOf("]"):u==t?e.slice(1).indexOf('"')+1:0)&&(a=e.length),[o+="\\text{"+(b=e.slice(1,a))+"}",e=r(e,a+1)];case 1:return null==(l=m(e=r(e,u.input.length)))[0]?["{"+g(u)+"}",e]:"boolean"==typeof u.func&&u.func?"^"==(b=e.charAt(0))||"_"==b||"/"==b||"|"==b||","==b||1==u.input.length&&u.input.match(/\w/)&&"("!=b?["{"+g(u)+"}",e]:[n="{"+g(u)+"{"+l[0]+"}}",l[1]]:(l[0]=c(l[0]),"sqrt"==u.input?["\\sqrt{"+l[0]+"}",l[1]]:"abs"==u.input?["\\left|{"+l[0]+"}\\right|",l[1]]:"cancel"==u.input?["\\cancel{"+l[0]+"}",l[1]]:void 0!==u.rewriteleftright?["{\\left"+u.rewriteleftright[0]+l[0]+"\\right"+u.rewriteleftright[1]+"}",l[1]]:"boolean"==typeof u.acc&&u.acc?[g(u)+"{"+l[0]+"}",l[1]]:["{"+g(u)+"{"+l[0]+"}}",l[1]]);case 2:if(null==(l=m(e=r(e,u.input.length)))[0])return["{"+g(u)+"}",e];l[0]=c(l[0]);var f=m(l[1]);return null==f[0]?["{"+g(u)+"}",e]:(f[0]=c(f[0]),[o="color"==u.input?"{\\color{"+l[0].replace(/[\{\}]/g,"")+"}"+f[0]+"}":"root"==u.input?"{\\sqrt["+l[0]+"]{"+f[0]+"}}":"{"+g(u)+"{"+l[0]+"}{"+f[0]+"}}",f[1]]);case 3:return e=r(e,u.input.length),[u.output,e];case 6:return e=r(e,u.input.length),["{\\quad\\text{"+u.input+"}\\quad}",e];case 9:p++,l=h(e=r(e,u.input.length),!1),p--;var b="";return"|"==(b=l[0].charAt(l[0].length-1))?[n="{\\left|"+l[0]+"}",l[1]]:[n="{\\mid}",e];default:return e=r(e,u.input.length),["{"+g(u)+"}",e]}}function x(t){var e,u,p,n,l;if(u=i(t=r(t,0)),n=(l=m(t))[0],3==(e=i(t=l[1])).ttype&&"/"!=e.input){if(null==(l=m(t=r(t,e.input.length)))[0]?l[0]="{}":l[0]=c(l[0]),t=l[1],"_"==e.input)if("^"==(p=i(t)).input){var a=m(t=r(t,p.input.length));a[0]=c(a[0]),t=a[1],n="{"+n,n+="_{"+l[0]+"}",n+="^{"+a[0]+"}",n+="}"}else n+="_{"+l[0]+"}";else n=n+"^{"+l[0]+"}";void 0!==u.func&&u.func&&3!=(p=i(t)).ttype&&5!=p.ttype&&(n="{"+n+(l=x(t))[0]+"}",t=l[1])}return[n,t]}var y=!0;function h(t,e){var u,n,l,a,o="",g=!1;do{n=(l=x(t=r(t,0)))[0],3==(u=i(t=l[1])).ttype&&"/"==u.input?(null==(l=x(t=r(t,u.input.length)))[0]?l[0]="{}":l[0]=c(l[0]),t=l[1],n="\\frac{"+(n=c(n))+"}",o+=n+="{"+l[0]+"}",u=i(t)):null!=n&&(o+=n)}while((5!=u.ttype&&(9!=u.ttype||e)||0==p)&&null!=u&&""!=u.output);if(5==u.ttype||9==u.ttype){var m=o.length;if(y&&m>2&&"{"==o.charAt(0)&&o.indexOf(",")>0){var h=o.charAt(m-2);if(")"==h||"]"==h){var f=o.charAt(6);if("("==f&&")"==h&&"}"!=u.output||"["==f&&"]"==h){var b="\\begin{bmatrix}",v=new Array;v.push(0);var d=!0,A=0,$=[];$[0]=[0];var w=0,_=0;for(a=1;a<m-1;a++)o.charAt(a)==f&&A++,o.charAt(a)==h&&0==--A&&","==o.charAt(a+2)&&"{"==o.charAt(a+3)&&(v.push(a+2),$[w=a+2]=[a+2]),"["!=o.charAt(a)&&"("!=o.charAt(a)&&"{"!=o.charAt(a)||_++,"]"!=o.charAt(a)&&")"!=o.charAt(a)&&"}"!=o.charAt(a)||_--,","==o.charAt(a)&&1==_&&$[w].push(a);v.push(m);var q=-1;if(0==A&&v.length>0)for(a=0;a<v.length-1;a++){if(a>0&&(b+="\\\\"),0==a)if(1==$[v[a]].length)var O=[o.substr(v[a]+7,v[a+1]-v[a]-15)];else{O=[o.substring(v[a]+7,$[v[a]][1])];for(var E=2;E<$[v[a]].length;E++)O.push(o.substring($[v[a]][E-1]+1,$[v[a]][E]));O.push(o.substring($[v[a]][$[v[a]].length-1]+1,v[a+1]-8))}else if(1==$[v[a]].length)O=[o.substr(v[a]+8,v[a+1]-v[a]-16)];else{for(O=[o.substring(v[a]+8,$[v[a]][1])],E=2;E<$[v[a]].length;E++)O.push(o.substring($[v[a]][E-1]+1,$[v[a]][E]));O.push(o.substring($[v[a]][$[v[a]].length-1]+1,v[a+1]-8))}q>0&&O.length!=q?d=!1:-1==q&&(q=O.length),b+=O.join("&")}b+="\\end{bmatrix}",d&&(o=b)}}}t=r(t,u.input.length),"boolean"==typeof u.invisible&&u.invisible||(o+=n="\\right"+s(u)),g=!0}return p>0&&!g&&(o+="\\right)"),[o,t]}return function(){var t,p=[];for(t=0;t<e.length;t++)!e[t].tex||"boolean"==typeof e[t].notexcopy&&e[t].notexcopy||(p[p.length]={input:e[t].tex,tag:e[t].tag,output:e[t].output,ttype:e[t].ttype,acc:e[t].acc||!1});for((e=e.concat(p)).sort(u),t=0;t<e.length;t++)a[t]=e[t].input}(),function(t,e,u){return p=0,!0===u&&(y=!1),t=t.replace(/(&nbsp;|\u00a0|&#160;|{::})/g,""),document.getElementById(e)&&document.getElementById(e).getAttribute("data-mq").match(/(ntuple|string)/)&&(t=t.replace(/<([^<].*?,.*?[^>])>/g,"<<$1>>")),t=(t=(t=(t=(t=(t=t.replace(/&gt;/g,">")).replace(/&lt;/g,"<")).replace(/\s*\bor\b\s*/g,'" or "')).replace(/all\s+real\s+numbers/g,'"all real numbers"')).replace(/(\)|\])\s*u\s*(\(|\[)/g,"$1U$2")).replace(/\bDNE\b/gi,'"DNE"'),document.getElementById(e)&&document.getElementById(e).getAttribute("data-mq").match(/interval/)&&(t=t.replace(/\bU\b/g,"cup")),null==t.match(/\S/)?"":h(t.replace(/^\s+/g,""),!1)[0]}}();function MQtoAM(t,e){var u,p,n,l,a,r;if(t=(t=t.replace(/\\:/g," ")).replace(/\\operatorname{(\w+)}/g," $1"),e)t=t.replace(/\\Re/g,"RR");else{for(;-1!=(r=t.lastIndexOf("\\left|"));)-1!=(p=t.indexOf("\\right|",r+1))?(n=t.substring(0,r).match(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|ln|log|exp|sin|cos|tan|sec|csc|cot)(\^\d+)?$/),t=(t=t.substring(0,p)+")"+(n?")":"")+t.substring(p+7)).substring(0,r)+(n?"(":"")+"abs("+t.substring(r+6)):t=t.substring(0,r)+"|"+t.substring(r+6);t=(t=(t=(t=(t=t.replace(/\\text{\s*or\s*}/g," or ")).replace(/\\text{all\s+real\s+numbers}/g,"all real numbers")).replace(/\\text{DNE}/g,"DNE")).replace(/\\varnothing/g,"DNE")).replace(/\\Re/g,"all real numbers")}for(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/\\begin{.?matrix}(.*?)\\end{.?matrix}/g,(function(t,e){return"[("+e.replace(/\\\\/g,"),(").replace(/&/g,",")+")]"}))).replace(/\\le(?=(\b|\d))/g,"<=")).replace(/\\ge(?=(\b|\d))/g,">=")).replace(/\\ne(?=(\b|\d))/g,"!=")).replace(/\+\-/g,"+ -")).replace(/\\pm/g,"+-")).replace(/\\approx/g,"~~")).replace(/(\\arrow|\\rightarrow)/g,"rarr")).replace(/\\rightleftharpoons/g,"rightleftharpoons")).replace(/\\sim/g,"~")).replace(/\\vee/g,"vv").replace(/\\wedge/g," ^^ ")).replace(/\\Rightarrow/g,"=>").replace(/\\Leftrightarrow/g,"<=>")).replace(/\\times/g,"xx")).replace(/\\left\\{/g,"lbrace").replace(/\\right\\}/g,"rbrace")).replace(/\\left/g,"")).replace(/\\right/g,"")).replace(/\\langle/g,"<<")).replace(/\\rangle/g,">>")).replace(/\\cdot/g,"*")).replace(/\\infty/g,"oo")).replace(/\\nthroot/g,"root")).replace(/\\mid/g,"|")).replace(/\\/g,"")).replace(/sqrt\[(.*?)\]/g,"root($1)")).replace(/(\d)frac/g,"$1 frac")).replace(/degree/g,"degree ");-1!=(r=t.indexOf("frac{"));){for(u=1,l=r+5;u>0&&l<t.length-1;)l++,"{"==(a=t.charAt(l))?u++:"}"==a&&u--;t=0==u?t.substring(0,r)+"("+t.substring(r+5,l)+")/"+t.substring(l+1):t.substring(0,r)+t.substring(r+4)}return(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/_(\w)(\w)/g,"_$1 $2")).replace(/(\^|_)([+\-])([^\^])/g,"$1$2 $3")).replace(/\^(\w)(\w)/g,"^$1 $2")).replace(/_{([\d\.]+)}\^/g,"_$1^")).replace(/_{([\d\.]+)}([^\^])/g,"_$1 $2")).replace(/_{([\d\.]+)}$/g,"_$1")).replace(/_{(\w+)}$/g,"_($1)")).replace(/{/g,"(").replace(/}/g,")")).replace(/lbrace/g,"{").replace(/rbrace/g,"}")).replace(/\(([\d\.]+)\)\/\(([\d\.]+)\)/g,"$1/$2 ")).replace(/\/\(([\d\.]+)\)/g,"/$1")).replace(/\(([\d\.]+)\)\//g,"$1/")).replace(/\/\(([a-zA-Z])\)/g,"/$1")).replace(/\(([a-zA-Z])\)\//g,"$1/")).replace(/\^\((-?[\d\.]+)\)(\d)/g,"^$1 $2")).replace(/\^\(-1\)/g,"^-1")).replace(/\^\((-?[\d\.]+)\)/g,"^$1")).replace(/\/\(([a-zA-Z])\^([\d\.]+)\)/g,"/$1^$2 ")).replace(/\(([a-zA-Z])\^([\d\.]+)\)\//g,"$1^$2/")).replace(/text\(([^)]*)\)/g,"$1")).replace(/\(\s*(\w)/g,"($1").replace(/(\w)\s*\)/g,"$1)")).replace(/^\s+|\s+$/g,"")}var MQeditor=function(t){var e={layoutstyle:"auto",layout:[]},a={},s=!1,n=null,o=null,r=null,l=MathQuill.getInterface(MathQuill.getInterface.MAX),i=["alpha","beta","chi","delta","epsilon","gamma","varphi","phi","psi","sigma","rho","theta","lambda","mu","nu","omega","tau"];function c(){try{return window.self!==window.top}catch(t){return!0}}function d(s,n,o){"string"==typeof s&&(s=document.getElementById(s));var r="boolean"==typeof n?n:"hidden"!=s.type,c=s.id,d=s.getAttribute("data-mq")||"";if(!0===r){var m=t(s).attr("type","hidden").val();e.hasOwnProperty("toMQ")&&(m=e.toMQ(m,c));var h=t("#mqinput-"+c);if(0==h.length){var p,f=t("<span/>",{id:"mqinput-"+c,class:"mathquill-math-field",text:m,"aria-label":s.getAttribute("aria-label")});if(null!==(p=s.className.match(/(ansred|ansyel|ansgrn|ansorg)/))&&f.addClass(p[0]),d.match(/chem/)&&f.addClass("mq-chem"),"string"==typeof s.style.width&&s.style.width.match(/[\d\.]+\s*\w{2,3}/))f.css("min-width",s.style.width.replace(/([\d\.]+)\s*(\w{2,3})/,(function(t,e,a){return e/1.15+a})));else{var b=s.hasAttribute("size")?s.size>3?s.size/1.8:s.size:10;f.css("min-width",b+"em")}f.insertAfter(s);var v={handlers:{edit:y,enter:g}};e.hasOwnProperty("getLayoutstyle")?e.curlayoutstyle=e.getLayoutstyle():"auto"==e.layoutstyle?e.curlayoutstyle=q():e.curlayoutstyle=e.layoutstyle,"OSK"==e.curlayoutstyle&&(v.substituteTextarea=function(){var t=document.createElement("span");return t.setAttribute("tabindex",0),t},v.keyboardPassthrough=!0),d.match(/chem/)&&(v.charsThatBreakOutOfSupSubVar="",v.charsThatBreakOutOfSupSubOp="",v.autoSubscriptNumerals=!0),d.match(/(list|ntuple)/)&&(v.charsThatBreakOutOfSupSub="=<>,"),d.match(/allowplusminus/)&&(v.quickplusminus=!0),v.autoOperatorNames=v.autoParenOperators="ln log abs exp sin cos tan arcsinh arccosh arctanh arcsech arccsch arccoth argsinh argcosh argtanh argsech argcsch argcoth arsinh arcosh artanh arsech arcsch arcoth arcsin arccos arctan sec csc cot arcsec arccsc arccot sinh cosh sech csch tanh coth",v.autoCommands="pi theta root sqrt ^oo degree",d.match(/logic/)&&(v.autoCommands+=" neg xor or and implies iff"),d.match(/setexp/)&&(v.autoCommands+=" nn xor uu ominus cap cup oplus");var w,C=s.getAttribute("data-mq-vars")||"";if(""!=C){C=""==C?[]:C.split(/,/);for(var k=0;k<C.length;k++){w=C[k].split(/_/);for(var O=0;O<w.length;O++)w[O].length>1&&w[O].match(/^[a-zA-Z]+$/)&&(-1!=i.indexOf(w[O].toLowerCase())?v.autoCommands+=" "+w[O]:v.autoOperatorNames+=" "+w[O])}}s.disabled?(h=l.StaticMath(f[0]),f.addClass("disabled")):(h=l.MathField(f[0],v).config(a),u(f),t(s).on("change.mqed",(function(t,a){if(!a){var n=s.value;e.hasOwnProperty("toMQ")&&(n=e.toMQ(n,s.id)),h.latex(n)}})))}else h.show(),h=l(h[0]).latex(m);!0!==o&&h.focus()}else t(s).attr("type","text").off("change.mqed"),!0!==o&&t(s).focus(),t("#mqinput-"+c).hide()}function u(a){t(a).find(".mq-textarea > *").on("focus.mqeditor",h).on("blur.mqeditor",(function(){o=setTimeout(p,100),e.hasOwnProperty("onBlur")&&e.onBlur()})),t(a).on("click.mqeditor",(function(e){var a=t(e.target).closest("label");if(a.length>0)return"undefined"!==a.attr("for")&&t("#"+a.attr("for")).prop("checked",!0),e.stopPropagation(),!1}))}function h(a){clearTimeout(o);var r=t(a.target).closest(".mathquill-math-field");!1===s&&(t("body").append(t("<div/>",{id:"mqeditor",class:"mqeditor"})),t("#mqeditor").on("mousedown touchstart",(function(t){t.preventDefault()})),s=!0);var i=e.curlayoutstyle;if(e.hasOwnProperty("getLayoutstyle")?e.curlayoutstyle=e.getLayoutstyle():"auto"==e.layoutstyle?e.curlayoutstyle=q():e.curlayoutstyle=e.layoutstyle,"OSK"===e.curlayoutstyle){if(c()?t("#mqeditor").addClass("iframeosk").removeClass("fixedbottom"):t("#mqeditor").addClass("fixedbottom").removeClass("iframeosk"),!document.getElementById("mqe-fb-spacer")){var d=document.createElement("div");d.style.height="200px",d.id="mqe-fb-spacer",t("body").append(d)}}else t("#mqeditor").removeClass("fixedbottom iframeosk");t("#mqeditor").toggleClass("mq-chem",t(r).hasClass("mq-chem"));var m=!1;if((null===n||r[0]!=n.el()||i!==e.curlayoutstyle)&&(m=!0,null!==n&&t("#"+n.el().id.substring(8)).trigger("change",!0),e.hasOwnProperty("getLayout")&&(e.layout=e.getLayout(r[0],e.curlayoutstyle)),t("#mqeditor").empty().show(),e.layout.tabs?function(e,a,s){var n=document.createElement("div");n.className="mqed-row mqed-tabrow";var o,r,l=document.createElement("div");e.appendChild(n),e.appendChild(l);for(var i=0;i<a.tabs.length;i++)if(!0===a.tabs[i].enabled){v(n,a.tabs[i],s+"-"+i),(r=document.createElement("div")).className="mqed-row mqed-tabpanel",r.id=s+"-"+i+"-tabpanel",l.appendChild(r);for(var c=0;c<a.tabs[i].tabcontent.length;c++)(o=a.tabs[i].tabcontent[c]).hasOwnProperty("flow")&&0==o.contents.length||(o.hasOwnProperty("flow")?b(r,o,s+"-"+i+"-"+c):v(r,o,s+"-"+i+"-"+c))}v(n,{s:1}),v(n,{p:"&times;",c:"close",lb:"close"}),t(e).find(".mqed-tab").first().addClass("mqed-activetab")}(document.getElementById("mqeditor"),e.layout,"mqeditor"):b(document.getElementById("mqeditor"),e.layout,"mqeditor"),t("#mqeditor .mqed-btn.rend").each((function(){l.StaticMath(this,{mouseEvents:!1})})),t("#mqeditor .mqed-tabrow").length>0)){t("#mqeditor .mqed-tabpanel").hide().first().show();var u=t("#mqeditor .mqed-tabrow + div");u.css("height",u.height())}"OSK"!==e.curlayoutstyle||c()?t("#mqeditor").show():t("#mqeditor").slideDown(50,(function(){var e=t("#mqeditor").height()+5,a=t(window).height()-(r.offset().top+r.outerHeight()-t(window).scrollTop());a<e&&t(window).scrollTop(t(window).scrollTop()+(e-a))})),f(r),n=l.MathField(r[0]),t("#"+r[0].id.substring(8)).triggerHandler("focus"),e.hasOwnProperty("onShow")&&e.onShow(r[0],e.curlayoutstyle,m),t(document).trigger("mqeditor:show")}function p(a){n&&(t(document).trigger("mqeditor:hide"),"OSK"!==e.curlayoutstyle||c()?t("#mqeditor").hide():t("#mqeditor").slideUp(50),t("#"+n.el().id.substring(8)).trigger("change",!0),n=null)}function f(a){if("under"==e.curlayoutstyle||c()){var s=t(a).closest(".mathquill-math-field"),n=s.offset(),o=s.outerHeight(),r=n.left;if(document.getElementById("mqeditor")){var l=document.getElementById("mqeditor").offsetWidth;r+l>document.documentElement.clientWidth&&(r=document.documentElement.clientWidth-l-5)}c()?t("#mqeditor").css("top",n.top+o+3).css("left",0):t("#mqeditor").css("top",n.top+o+3).css("left",r)}else t("#mqeditor").css("top","auto").css("left",0)}function y(a){var s=a.el();if(f(s),e.hasOwnProperty("onResize")&&e.onResize(s,e.curlayoutstyle),s.id.match(/mqinput/)){var n=a.latex();e.hasOwnProperty("fromMQ")&&(n=e.fromMQ(n,s.id)),t("#"+s.id.substring(8)).val(n).trigger("input"),""!=n&&t("#"+s.id.substring(8)).siblings("input[id^=qs][value=spec]").prop("checked",!0),e.hasOwnProperty("onEdit")&&e.onEdit(s.id,n)}}function g(t){e.hasOwnProperty("onEnter")&&e.onEnter(t.el().id)}function q(){var t=document.documentElement.clientWidth;return navigator.userAgent.match(/Android/)||navigator.userAgent.match(/iPhone/)||navigator.userAgent.match(/iPad/)||t<500?"OSK":"under"}function b(t,e,a){var s=e.flow,n=100;e.hasOwnProperty("s")&&"row"==s&&(n=e.s);var o=document.createElement("div");e.hasOwnProperty("s")&&(o.style.flexGrow=e.s),e.hasOwnProperty("class")&&(o.className=e.class),e.hasOwnProperty("tabpanel")&&(o.id=e.tabpanel.id,o.style.display=e.tabpanel.hidden?"none":""),(d=document.createElement("div")).className="mqed-"+s;for(var r,l=0,i=0,c=0;c<e.contents.length;c++)if(!(r=e.contents[c]).hasOwnProperty("flow")||0!=r.contents.length){var d;if(l+(i=r.hasOwnProperty("s")?r.s:1)>n)o.appendChild(d),l=0,(d=document.createElement("div")).className="mqed-"+s;r.hasOwnProperty("flow")?b(d,r,a+"-"+c):v(d,r,a+"-"+c),l+=i}o.appendChild(d),t.appendChild(o)}function v(e,a,s){var n,o,l,i;if((o=document.createElement("div")).className="mqed-btn-cont",a.s&&(o.style.flexGrow=a.s),a.contid&&(o.id=a.contid),a.contclass&&t(o).addClass(a.contclass),e.appendChild(o),a.l||a.b||a.p){if((n=document.createElement("span")).tabIndex=0,a.l){if(a.op)n.className="mqed-btn mq-math-mode",n.innerHTML='<span class="mq-root-block"><var class="mq-operator-name">'+a.l.substring(1)+"</var></span>";else if(a.pr)n.className="mqed-btn mq-math-mode",n.innerHTML='<span class="mq-root-block">'+a.pr+"</span>";else if(a.l.match(/\\left(.)\\right(.)/)){var c=a.l.match(/\\left(.)\\right(.)/);n.className="mqed-btn mq-math-mode",n.innerHTML='<span class="mq-non-leaf"><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">'+c[1]+'</span><span class="mq-non-leaf mq-empty"></span><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">'+c[2]+"</span></span>"}else n.className="mqed-btn rend",n.innerText=a.l;l="c",i=a.l.substring(1)}else a.b?(a.r?(n.className="mqed-btn rend",n.innerHTML=a.b):(n.className="mqed-btn mq-math-mode",a.v?n.innerHTML='<span class="mq-root-block"><var>'+a.b+"</var></span>":n.innerHTML='<span class="mq-root-block"><span>'+a.b+"</span></span>"),l="t",((i=a.b).match(/^\d$/)||"."==i)&&t(n).addClass("mqed-digitkey")):(n.className="mqed-btn",n.innerHTML=a.p,l="t",i=a.p);a.c&&("shift"==(l=a.c)?t(n).addClass("mqed-shift"):"k"==l?t(n).addClass("mqed-navkey"):"close"==l&&t(n).addClass("mqed-closebtn")),a.lb&&n.setAttribute("aria-label",a.lb),a.sm&&(n.style.fontSize=100-10*a.sm+"%"),a.w&&(i=a.w),a.tabcontent&&(t(n).addClass("mqed-tab"),l="showtabpanel",i=s+"-tabpanel"),t(n).data("cmdtype",l).data("cmdval",i),t(n).on("click mousedown touchstart keydown",function(t,e){return function(a){w(a,t,e)}}(l,i)).on("touchend",(function(e){setTimeout((function(){t(e.currentTarget).removeClass("mactive")}),50)})).on("touchend mouseup",(function(){clearTimeout(r),r=null})),o.appendChild(n)}}function w(a,s,o){if(("mousedown"!=a.type||"Backspace"===o)&&!("click"==a.type&&"Backspace"===o||"keydown"==a.type&&"Enter"!==a.key))if("touchstart"==a.type&&(a.preventDefault(),t(a.currentTarget).addClass("mactive")),"t"==s)o.match(/^[a-zA-Z]$/)&&t(a.target).closest(".mqed-tabpanel").find(".mqed-shift").hasClass("active")&&(o=o.toUpperCase()),n.typedText(o);else if("c"==s)n.cmd(o);else if("l"==s)n.latex(o);else if("w"==s){if(n.write(o),m=o.match(/bmatrix}(.*?)(\\\\|\\end{bm)/))for(var l=m[1].split(/&/).length,i=0;i<l;i++)n.keystroke("Left")}else if("k"==s)n.keystroke(o),"Backspace"===o&&(r=setTimeout((function(){w(a,s,o)}),null===r?600:70));else if("m"==s)n.matrixCmd(o);else if("f"==s){(c=n.getSelection())?(n.write(o+"\\left("+c+"\\right)"),n.keystroke("Left")):o.match(/{}$/)?n.typedText(o.replace(/{}$/,"")):n.write(o)}else if("sf"==s){(c=n.getSelection())?n.write(o+"{"+c+"}"):n.cmd(o),n.keystroke("Left")}else if("i"==s){var c;if((c=n.getSelection())||(c=""),"string"==typeof o){var d=o.charAt(0),u=o.charAt(1);n.write("\\left"+d+c+"\\right"+u)}else n.write(o[0]+c+o[1]);""==c&&n.keystroke("Left")}else if("showtabpanel"==s){(h=t(a.target).closest(".mqed-btn")).closest(".mqeditor").find(".mqed-tabpanel").hide(),h.closest(".mqeditor").find(".mqed-btn.mqed-activetab").removeClass("mqed-activetab"),t("#"+o).show(),h.addClass("mqed-activetab"),e.hasOwnProperty("onTab")&&e.onTab(h[0],e.curlayoutstyle,o)}else if("shift"==s){var h=t(a.target).closest(".mqed-btn"),p=t(a.target).closest(".mqed-tabpanel"),f=!h.hasClass("active");f?h.addClass("active"):h.removeClass("active"),p.find(".mqed-btn").each((function(t,e){e.textContent.match(/^[a-zA-Z]$/)&&(e.textContent=f?e.textContent.toUpperCase():e.textContent.toLowerCase())}))}else"close"==s&&n.blur()}return{setConfig:function(t){for(var a in t)e[a]=t[a]},setMQconfig:function(t){a=t},toggleMQ:d,toggleMQAll:function(e,a){var s=a||null;t(e).each((function(t,e){d(e,s,!0)}))},attachEditor:u,getLayoutstyle:q,resetEditor:function(){clearTimeout(o),t("#mqeditor").hide(),n=null}}}(jQuery);var myMQeditor=function(a){var s={tabs:[{p:"Basic",enabled:!0,tabcontent:[{flow:"row",s:2,contents:[{l:"\\left(\\right)",c:"i",w:"()",pr:'<span class="mq-non-leaf"><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">(</span><span class="mq-non-leaf mq-empty"></span><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">)</span></span>'},{l:"x^{}",c:"t",w:"^",nb:1,pr:'<var>x</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup mq-empty"></span></span>'},{l:"\\pi",nb:1,pr:'<span class="mq-nonSymbola"></span>'},{l:"\\sqrt{}",c:"c",w:"sqrt",nb:1,pr:'<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix" style="transform: scale(1, 0.955556);"></span><span class="mq-non-leaf mq-sqrt-stem mq-empty"></span></span>'},{l:"x_{}",c:"t",w:"_",nb:1,pr:'<var>x</var><span class="mq-supsub mq-non-leaf"><span class="mq-sub mq-empty"></span></span>'},{l:"\\sqrt[n]{}",c:"c",w:"nthroot",nb:1,pr:'<sup class="mq-nthroot mq-non-leaf"><var>n</var></sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled" style="transform: scale(1, 0.955556);"></span><span class="mq-sqrt-stem mq-non-leaf mq-empty"></span></span>'},{p:"DNE",sm:2},{l:"\\left|\\right|",c:"i",w:"||"}]},{s:.1},{flow:"row",s:4,contents:[{b:"7"},{b:"8"},{b:"9"},{l:"\\frac{}{}",c:"t",w:"/",pr:'<span class="mq-fraction mq-non-leaf"><span class="mq-numerator mq-empty"></span><span class="mq-denominator mq-empty"></span><span style="display:inline-block;width:0">&#8203;</span></span>'},{b:"4"},{b:"5"},{b:"6"},{b:"*"},{b:"1"},{b:"2"},{b:"3"},{b:"-"},{b:"0"},{b:"."},{s:1},{b:"+"}]},{s:.1},{flow:"row",s:2,contents:[{s:.5},{b:"&uarr;",c:"k",w:"Up"},{s:.5},{b:"&larr;",c:"k",w:"Left"},{b:"&rarr;",c:"k",w:"Right"},{s:.5},{b:"&darr;",c:"k",w:"Down"},{s:.5},{b:"&#x232B;",s:2,c:"k",w:"Backspace"}]}]},{p:"Funcs",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\log",c:"f",op:1},{l:"\\ln",c:"f",op:1},{l:"\\log_{}",c:"f",pr:'<var class="mq-operator-name">log</var><span class="mq-supsub mq-non-leaf"><span class="mq-sub mq-empty"></span></span>'},{l:"e^{}",c:"t",w:"e^",pr:'<var>e</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup mq-empty"></span></span>'}]}]},{p:"Trig",enabled:!1,tabcontent:[{flow:"row",s:6,contents:[{l:"\\sin",c:"f",op:1},{l:"\\cos",c:"f",op:1},{l:"\\tan",c:"f",op:1},{l:"\\sec",c:"f",op:1},{l:"\\csc",c:"f",op:1},{l:"\\cot",c:"f",op:1},{l:"\\sin^{-1}",c:"f",pr:'<var class="mq-operator-name">sin</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">1</span></span>'},{l:"\\cos^{-1}",c:"f",pr:'<var class="mq-operator-name">cos</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">1</span></span>'},{l:"\\tan^{-1}",c:"f",pr:'<var class="mq-operator-name">tan</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">1</span></span>'},{l:"\\sinh",c:"f",op:1},{l:"\\cosh",c:"f",op:1},{l:"\\tanh",c:"f",op:1},{l:"\\pi",nb:1,pr:'<span class="mq-nonSymbola"></span>'},{s:1},{s:4}]}]},{p:"Inequality",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\lt",pr:'<span class="mq-binary-operator">&lt;</span>'},{l:"\\gt",pr:'<span class="mq-binary-operator">&gt;</span>'},{l:"\\le",pr:'<span class="mq-binary-operator">&le;</span>'},{l:"\\ge",pr:'<span class="mq-binary-operator">&ge;</span>'},{l:"\\ne",pr:'<span class="mq-binary-operator">&ne;</span>'},{p:"or",c:"w",w:"\\text{ or }"},{p:"DNE",sm:2},{p:"all reals",c:"w",w:"\\text{all reals}",sm:2}]}]},{p:"Interval",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\left(\\right)",c:"i",w:"()"},{l:"\\left[\\right]",c:"i",w:"[]"},{l:"\\left(\\right]",c:"i",w:"(]"},{l:"\\left[\\right)",c:"i",w:"[)"},{l:"\\infty",pr:"<span></span>"},{l:"-\\infty",c:"w",w:"-\\infty",pr:"<span></span>"},{l:"\\cup",pr:'<span class="mq-binary-operator"></span>'},{s:1}]}]},{p:"Matrix",sm:1,enabled:!1,tabcontent:[{flow:"row",s:6,contents:[{p:"21",c:"w",w:"\\begin{bmatrix}\\\\\\end{bmatrix}"},{p:"22",c:"w",w:"\\begin{bmatrix}&\\\\&\\end{bmatrix}"},{p:"23",c:"w",w:"\\begin{bmatrix}&&\\\\&&\\end{bmatrix}"},{p:"31",c:"w",w:"\\begin{bmatrix}\\\\\\\\\\end{bmatrix}"},{p:"33",c:"w",w:"\\begin{bmatrix}&&\\\\&&\\\\&&\\end{bmatrix}"},{p:"34",c:"w",w:"\\begin{bmatrix}&&&\\\\&&&\\\\&&&\\end{bmatrix}"},{p:"+Col",c:"m",w:"addColumn"},{p:"-Col",c:"m",w:"deleteColumn"},{p:"+Row",c:"m",w:"addRow"},{p:"-Row",c:"m",w:"deleteRow"}]}]},{p:"=<%",enabled:!0,tabcontent:[{flow:"row",s:5,contents:[{p:"[",s:.5},{p:"]",s:.5},{p:"{",s:.5},{p:"}",s:.5},{p:"(",s:.5},{p:")",s:.5},{l:"\\left\\langle\\right\\rangle",c:"i",w:["\\left\\langle","\\right\\rangle"]},{l:"\\left|\\right|",c:"i",w:"||"},{p:"="},{l:"\\lt",pr:'<span class="mq-binary-operator">&lt;</span>'},{l:"\\gt",pr:'<span class="mq-binary-operator">&gt;</span>'},{l:"\\le",pr:'<span class="mq-binary-operator">&le;</span>'},{l:"\\ge",pr:'<span class="mq-binary-operator">&ge;</span>'},{p:"%"},{p:","},{l:"\\infty",pr:"<span></span>"},{p:"!"},{p:"?"}]}]},{p:"ABC",enabled:!0,tabcontent:[{flow:"row",s:10,contents:[{p:"q"},{p:"w"},{p:"e"},{p:"r"},{p:"t"},{p:"y"},{p:"u"},{p:"i"},{p:"o"},{p:"p"},{s:.5},{p:"a"},{p:"s"},{p:"d"},{p:"f"},{p:"g"},{p:"h"},{p:"j"},{p:"k"},{p:"l"},{s:.5},{b:"&#8679;",c:"shift",s:1.5},{p:"z"},{p:"x"},{p:"c"},{p:"v"},{p:"b"},{p:"n"},{p:"m"},{b:"&#x232B;",c:"k",w:"Backspace",s:1.5},{p:"%"},{p:","},{p:"Space",s:5,c:"t",w:" "},{p:"."},{b:"&larr;",c:"k",w:"Left"},{b:"&rarr;",c:"k",w:"Right"}]}]}]},n={tabs:[{p:"Basic",enabled:!0,tabcontent:[{flow:"row",s:5,contents:[{l:"\\frac{}{}",c:"t",w:"/",pr:'<span class="mq-fraction mq-non-leaf"><span class="mq-numerator mq-empty"></span><span class="mq-denominator mq-empty"></span><span style="display:inline-block;width:0">&#8203;</span></span>'},{l:"x^{}",c:"t",w:"^",nb:1,pr:'<var>x</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup mq-empty"></span></span>'},{l:"x_{}",c:"t",w:"_",nb:1,pr:'<var>x</var><span class="mq-supsub mq-non-leaf"><span class="mq-sub mq-empty"></span></span>'},{l:"\\sqrt{}",c:"c",w:"sqrt",nb:1,pr:'<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix" style="transform: scale(1, 0.955556);"></span><span class="mq-non-leaf mq-sqrt-stem mq-empty"></span></span>'},{l:"\\sqrt[n]{}",c:"c",w:"nthroot",nb:1,pr:'<sup class="mq-nthroot mq-non-leaf"><var>n</var></sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled" style="transform: scale(1, 0.955556);"></span><span class="mq-sqrt-stem mq-non-leaf mq-empty"></span></span>'},{l:"\\left(\\right)",c:"i",w:"()"},{l:"\\left|\\right|",c:"i",w:"||"},{l:"\\pi",nb:1,pr:'<span class="mq-nonSymbola"></span>'},{l:"\\infty",pr:"<span></span>"},{p:"DNE",sm:2}]},{s:.1},{flow:"row",s:2,contents:[{b:"&uarr;",c:"k",w:"Up"},{b:"&darr;",c:"k",w:"Down"},{b:"&larr;",c:"k",w:"Left"},{b:"&rarr;",c:"k",w:"Right"},{b:"&#x232B;",s:2,c:"k",w:"Backspace"}]}]},{p:"Funcs",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\log",c:"f",op:1},{l:"\\ln",c:"f",op:1},{l:"\\log_{}",c:"f",pr:'<var class="mq-operator-name">log</var><span class="mq-supsub mq-non-leaf"><span class="mq-sub mq-empty"></span></span>'},{l:"e^{}",c:"t",w:"e^",pr:'<var>e</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup mq-empty"></span></span>'}]}]},{p:"Trig",enabled:!1,tabcontent:[{flow:"row",s:6,contents:[{l:"\\sin",c:"f",op:1},{l:"\\cos",c:"f",op:1},{l:"\\tan",c:"f",op:1},{l:"\\sec",c:"f",op:1},{l:"\\csc",c:"f",op:1},{l:"\\cot",c:"f",op:1},{l:"\\sin^{-1}",c:"f",pr:'<var class="mq-operator-name">sin</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">1</span></span>'},{l:"\\cos^{-1}",c:"f",pr:'<var class="mq-operator-name">cos</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">1</span></span>'},{l:"\\tan^{-1}",c:"f",pr:'<var class="mq-operator-name">tan</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">1</span></span>'},{l:"\\sinh",c:"f",op:1},{l:"\\cosh",c:"f",op:1},{l:"\\tanh",c:"f",op:1},{l:"\\pi",nb:1,pr:'<span class="mq-nonSymbola"></span>'},{s:1},{s:4}]}]},{p:"Inequality",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\lt",pr:'<span class="mq-binary-operator">&lt;</span>'},{l:"\\gt",pr:'<span class="mq-binary-operator">&gt;</span>'},{l:"\\le",pr:'<span class="mq-binary-operator">&le;</span>'},{l:"\\ge",pr:'<span class="mq-binary-operator">&ge;</span>'},{l:"\\ne",pr:'<span class="mq-binary-operator">&ne;</span>'},{p:"or",c:"w",w:"\\text{ or }"},{p:"DNE",sm:2},{p:"all reals",c:"w",w:"\\text{all reals}",sm:2}]}]},{p:"Interval",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\left(\\right)",c:"i",w:"()"},{l:"\\left[\\right]",c:"i",w:"[]"},{l:"\\left(\\right]",c:"i",w:"(]"},{l:"\\left[\\right)",c:"i",w:"[)"},{l:"\\infty",pr:"<span></span>"},{l:"-\\infty",c:"w",w:"-\\infty",pr:"<span></span>"},{l:"\\cup",pr:'<span class="mq-binary-operator"></span>'},{s:1}]}]},{p:"Matrix",sm:1,enabled:!1,tabcontent:[{flow:"row",s:6,contents:[{p:"21",c:"w",w:"\\begin{bmatrix}\\\\\\end{bmatrix}"},{p:"22",c:"w",w:"\\begin{bmatrix}&\\\\&\\end{bmatrix}"},{p:"23",c:"w",w:"\\begin{bmatrix}&&\\\\&&\\end{bmatrix}"},{p:"31",c:"w",w:"\\begin{bmatrix}\\\\\\\\\\end{bmatrix}"},{p:"33",c:"w",w:"\\begin{bmatrix}&&\\\\&&\\\\&&\\end{bmatrix}"},{p:"34",c:"w",w:"\\begin{bmatrix}&&&\\\\&&&\\\\&&&\\end{bmatrix}"},{p:"+Col",c:"m",w:"addColumn"},{p:"-Col",c:"m",w:"deleteColumn"},{p:"+Row",c:"m",w:"addRow"},{p:"-Row",c:"m",w:"deleteRow"}]}]}]};return{getLayout:function(t,p){var e=t.id.substring(8),l=a("#"+e),r=l.attr("data-mq-vars")||"";r=""==r?[]:r.split(/,/);var c=l.attr("data-mq"),o=c.split(/,/)[0],m=[];if("OSK"===p?(m=a.extend(!0,[],s),c.match(/\bdecimal/)&&"numfunc"!=o?(m.tabs[0].tabcontent[0].s=1,m.tabs[0].tabcontent[0].contents=[{l:"\\infty",pr:"<span></span>"},{p:"DNE",sm:2}],m.tabs[0].tabcontent[2]={flow:"row",s:4,contents:[{b:"7"},{b:"8"},{b:"9"},{s:1},{b:"4"},{b:"5"},{b:"6"},{s:1},{b:"1"},{b:"2"},{b:"3"},{b:"-"},{b:"0"},{b:"."},c.match(/(list|set\b)/)||o.match(/(ntuple|interval)/)?{b:","}:{s:1},"calcntuple"===o&&!c.match(/vector/)||c.match(/point/)?{l:"\\left(\\right)",c:"t",w:"("}:{s:1}]}):c.match(/(fraction|mixednumber|fracordec)/)&&"numfunc"!=o?(m.tabs[0].tabcontent[0].s=1,m.tabs[0].tabcontent[0].contents=[{l:"\\frac{n}{}",c:"t",w:"/",pr:'<span class="mq-fraction mq-non-leaf"><span class="mq-numerator"><var>n</var></span><span class="mq-denominator mq-empty"></span><span style="display:inline-block;width:0">&#8203;</span></span>'},{l:"\\frac{}{}",c:"c",w:"\\frac",pr:'<span class="mq-fraction mq-non-leaf"><span class="mq-numerator mq-empty"></span><span class="mq-denominator mq-empty"></span><span style="display:inline-block;width:0">&#8203;</span></span>'},{l:"\\infty",pr:"<span></span>"},{p:"DNE",sm:2}],m.tabs[0].tabcontent[2]={flow:"row",s:4,contents:[{b:"7"},{b:"8"},{b:"9"},{s:1},{b:"4"},{b:"5"},{b:"6"},{s:1},{b:"1"},{b:"2"},{b:"3"},{b:"-"},{b:"0"},c.match(/fracordec/)?{b:"."}:{s:1},c.match(/(list|set\b)/)||o.match(/(ntuple|interval)/)?{b:","}:{s:1},"calcntuple"===o&&!c.match(/vector/)||c.match(/point/)?{l:"\\left(\\right)",c:"t",w:"("}:o.match(/complex/)?{b:"+"}:{s:1}]}):(c.match(/(list|set\b)/)||o.match(/(interval|string|ntuple)/)?m.tabs[0].tabcontent[2].contents[14]={b:","}:c.match(/equation/)&&(m.tabs[0].tabcontent[2].contents[14]={b:"="}),c.match(/nodecimal/)&&(m.tabs[0].tabcontent[2].contents[13]={s:1})),c.match(/allowplusminus/)&&(m.tabs[6].tabcontent[0].contents[17]={l:"\\pm",pr:'<span class="mq-binary-operator">&plusmn;</span>'}),c.match(/inequality/)&&(m.tabs[3].p="Ineq")):(m=a.extend(!0,[],n),c.match(/\bdecimal/)?(m.tabs[0].tabcontent[0].s=3,m.tabs[0].tabcontent[0].contents=[{l:"\\infty",pr:"<span></span>"},{p:"DNE",sm:2},"calcntuple"===o&&!c.match(/vector/)||c.match(/point/)?{l:"\\left(\\right)",c:"t",w:"("}:{s:1}]):c.match(/(fraction|mixednumber|fracordec)/)&&(m.tabs[0].tabcontent[0].s=4,m.tabs[0].tabcontent[0].contents=[{l:"\\frac{n}{}",c:"t",w:"/",pr:'<span class="mq-fraction mq-non-leaf"><span class="mq-numerator"><var>n</var></span><span class="mq-denominator mq-empty"></span><span style="display:inline-block;width:0">&#8203;</span></span>'},{l:"\\frac{}{}",c:"c",w:"\\frac",pr:'<span class="mq-fraction mq-non-leaf"><span class="mq-numerator mq-empty"></span><span class="mq-denominator mq-empty"></span><span style="display:inline-block;width:0">&#8203;</span></span>'},{l:"\\infty",pr:"<span></span>"},{p:"DNE",sm:2}],("calcntuple"===o&&!c.match(/vector/)||c.match(/point/))&&m.tabs[0].tabcontent[0].contents.push({l:"\\left(\\right)",c:"t",w:"("},{s:3}))),"numfunc"==o&&c.match(/inequality/)&&(m.tabs[3].enabled=!0,m.tabs[3].tabcontent[0].contents.splice(5,3),m.tabs[3].tabcontent[0].s=5),c.match(/(fraction|mixednumber|fracordec|\bdecimal|logic|setexp|chemeqn)/)||(m.tabs[1].enabled=!0,c.match(/notrig/)||(m.tabs[2].enabled=!0,c.match(/allowdegrees/)&&(m.tabs[2].tabcontent[0].contents[13]={l:"\\degree"}))),o.match(/interval/)?c.match(/inequality/)?m.tabs[3].enabled=!0:m.tabs[4].enabled=!0:!o.match(/matrix/)&&!c.match(/matrix/)||c.match(/matrixsized/)?c.match(/set\b/)?m.tabs[0].tabcontent.unshift({flow:"row",s:1,contents:[{l:"\\lbrace{\\rbrace}",c:"i",w:["\\left\\{","\\right\\}"]}]},{s:.1}):o.match(/complex/)?m.tabs[0].tabcontent.unshift({flow:"row",s:1,contents:[{b:c.match(/allowjcomplex/)?"j":"i",v:1}]},{s:.1}):c.match(/vector/)&&m.tabs[0].tabcontent.unshift({flow:"row",s:1,contents:[{l:"\\left\\langle\\right\\rangle",c:"i",w:["\\left\\langle","\\right\\rangle"]}]},{s:.1}):m.tabs[5].enabled=!0,c.match(/logic/)&&(m.tabs[0].p="Logic",m.tabs[0].tabcontent[0].contents=[{l:"\\vee",pr:'<span class="mq-binary-operator"></span>'},{l:"\\wedge",pr:'<span class="mq-binary-operator"></span>'},{l:"\\oplus",pr:'<span class="mq-binary-operator"></span>'},{l:"\\left(\\right)",c:"i",w:"()",pr:'<span class="mq-non-leaf"><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">(</span><span class="mq-non-leaf mq-empty"></span><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">)</span></span>'},{l:"\\neg",pr:""},{b:"~"},{l:"\\implies",pr:'<span class="mq-binary-operator"></span>'},{l:"\\iff",pr:'<span class="mq-binary-operator"></span>'}],"OSK"!==p&&(m.tabs[0].tabcontent[0].s=4)),c.match(/setexp/)&&(m.tabs[0].p="Set Exp",m.tabs[0].tabcontent[0].contents=[{l:"\\cup",pr:'<span class="mq-binary-operator"></span>'},{l:"\\cap",pr:'<span class="mq-binary-operator"></span>'},{l:"\\^c",c:"w",pr:'<span class="mq-non-leaf mq-empty"></span><sup class="mq-binary-operator">c</sup>'},{l:"\\ominus",pr:'<span class="mq-binary-operator"></span>'},{l:"\\left(\\right)",c:"i",w:"()",pr:'<span class="mq-non-leaf"><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">(</span><span class="mq-non-leaf mq-empty"></span><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">)</span></span>'}],"OSK"!==p&&(m.tabs[0].tabcontent[0].s=3)),"chemeqn"==o&&(m.tabs[0].tabcontent[0].contents=[{l:"x_{}",c:"t",w:"_",nb:1,pr:'<var>x</var><span class="mq-supsub mq-non-leaf"><span class="mq-sub mq-empty"></span></span>'},{l:"x^{}",c:"t",w:"^",nb:1,pr:'<var>x</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup mq-empty"></span></span>'},{l:"\\left(\\right)",c:"i",w:"()",pr:'<span class="mq-non-leaf"><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">(</span><span class="mq-non-leaf mq-empty"></span><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">)</span></span>'}],c.match(/reaction/)&&m.tabs[0].tabcontent[0].contents.push({l:"\\to",pr:'<span class="mq-binary-operator"></span>'},{l:"\\rightleftharpoons",pr:'<span class="mq-binary-operator"></span>'}),"OSK"!==p&&(m.tabs[0].tabcontent[0].s=3)),r.length>0){var i=function(a,s){for(var n,t=1,p=[],e="OSK"==s?4:2,l=0;l<a.length;l++){n=a[l].split(/_/);for(var r=0;r<n.length;r++)n[r]=n[r].replace(/\b(alpha|beta|chi|delta|epsilon|gamma|varphi|phi|psi|sigma|rho|theta|lambda|mu|nu|omega|tau)\b/i,"\\$&");a[l]=n.join("_"),("\\"!=a[l].charAt(0)||n.length>1)&&a[l].length>t&&(t=a[l].length),a[l]=a[l].replace(/_(\w{2,})/,"_{$1}"),1==a[l].length?p.push({b:a[l],c:"w",v:1}):p.push({l:a[l].replace(/(\\)?([a-zA-Z0-9]{2,})/g,(function(a,s,n){return s?a:"\\text{"+n+"}"})),w:a[l],c:"w",r:1})}var c=Math.min(8,Math.max(4,Math.ceil(a.length/4)));a.length%c!=0&&p.push({s:c-a.length%c});return{format:a.length<=e&&t<4?"basic":"tab",btns:p,perrow:c}}(r,p);"basic"==i.format?m.tabs[0].tabcontent.unshift({flow:"row",s:1,contents:i.btns},{s:.1}):m.tabs.splice(1,0,{p:"chemeqn"==o?"Atoms":"Vars",enabled:!0,tabcontent:[{flow:"row",s:i.perrow,contents:i.btns}]})}return m},onShow:function(s,n,t){if(t&&"under"===n){var p=s.id.substring(8);if((i=a("#"+p))[0].hasAttribute("data-tip")){var e=a("#mqeditor .mqed-tabpanel").first(),l=e.children("div").last().position().left-12,r=i.attr("data-tip"),c=document.createElement("div");if(a(c).html(r),i[0].hasAttribute("aria-describedby")){var o=i[0].getAttribute("aria-describedby");if(document.getElementById(o).textContent!=r){var m=a("<a>",{href:"#",text:_("[more..]")}).on("click touchstart",(function(s){return s.preventDefault(),a(s.target).parent().html(a("#"+o).html()),!1}));a(c).append(" ").append(m)}}e.parent().css("height","auto").append(a("<div>",{width:l,class:"mqed-tipholder"}).append(c))}}else if(t&&"OSK"===n){var i;p=s.id.substring(8);if((i=a("#"+p))[0].hasAttribute("data-tip")){var b=p.substr(2).split(/-/)[0];reshrinkeh(s.id),showehdd(s.id,i[0].getAttribute("data-tip"),b)}}},onBlur:function(){hideeh()},onResize:function(a,s){"OSK"===s&&updateehpos()},onTab:function(s,n,t){"under"===n&&(t.match(/mqeditor-0-tabpanel/)?a(".mqed-tipholder").show():a(".mqed-tipholder").hide())}}}(jQuery);MQeditor.setConfig({getLayout:myMQeditor.getLayout,onShow:myMQeditor.onShow,onBlur:myMQeditor.onBlur,onResize:myMQeditor.onResize,onTab:myMQeditor.onTab,toMQ:AMtoMQ,fromMQ:MQtoAM,onEdit:imathasAssess.syntaxCheckMQ,onEnter:imathasAssess.handleMQenter});var MQ=MathQuill.getInterface(MathQuill.getInterface.MAX);MQ.config({spaceBehavesLikeTab:!0,leftRightIntoCmdGoes:"up",supSubsRequireOperand:!0,charsThatBreakOutOfSupSub:"=<>",charsThatBreakOutOfSupSubVar:"+-(",charsThatBreakOutOfSupSubOp:"+-(",restrictMismatchedBrackets:!0,autoCommands:"pi theta root sqrt ^oo degree",autoParenOperators:!0,addCommands:{oo:["VanillaSymbol","\\infty ","&infin;"],xor:["VanillaSymbol","\\oplus ","&oplus;"],uu:["VanillaSymbol","\\cup ","&cup;"],nn:["VanillaSymbol","\\cap ","&cap;"],rightleftharpoons:["BinaryOperator","\\rightleftharpoons ","&rlhar;"]}});