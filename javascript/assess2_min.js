var canvases=new Array,drawla=new Array,imathasDraw=function(e){var t=!1,n=new Array,l=new Array,o=new Array,a=new Array,r=new Array,h=new Array,s=new Array,d=new Array,m=new Array,u=new Array,g=null,p=[],c=[],f=null,v=null,y=["rgb(0,0,255)","rgb(255,0,0)","rgb(0,255,0)"],w=["rgba(0,0,255,.4)","rgba(255,0,0,.4)","rgba(0,255,0,.4)"],x="rgb(0,200,0)",b=null,T=null,M=null,E=!1,I=!1,N=!1,L=!1,B=null,P=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),q={5:2,5.1:2,5.2:2,5.3:2,5.4:2,6:2,6.1:2,6.2:2,6.3:2,6.5:2,6.6:2,6.7:3,7:2,7.2:2,7.4:2,7.5:2,8:2,8.2:2,8.3:2,8.4:2,8.5:3,8.6:3,9:2,9.1:2,9.2:3,10:3,10.2:3,10.3:3,10.4:3},S={7.4:1,7.5:1,8.2:1,8.5:1,8.6:1};function k(e,t){o[e]&&o[e].disabled&&!t||a.hasOwnProperty(e)&&(a[e].length=0,r[e].length=0,h[e].length=0,s[e].length=0,d[e].length=0,m[e].length=0,u[e].length=0,M=e,"canvas"==n[e].type&&D(),M=null,g=null,b=null)}function A(t,i,l){var g=t[0],p=t[13].split(","),c=!0;"noprev"==p[p.length-1]&&(c=!1,p.pop());var f=t[2],v=t[3],y=t[4],w=t[5];y==w&&(y=-1,w=1);var x=t[6],b=t[7],T=t[8],M=document.getElementById("a11ydraw"+g);if(null==M){var E=document.getElementById("canvas"+g);if(E&&!c){var I=e("<div>").append(e("<p>",{text:_("Drawn Elements:")}));(M=document.createElement("ul")).setAttribute("id","allydraw"+g),I.append(M),e(E).replaceWith(I)}}o[g]=document.getElementById("qn"+g);var N,L=!!document.getElementById("a11ydrawnew"+g);o[g].disabled&&(L&&(document.getElementById("a11ydrawnew"+g).disabled=!0),e(".a11ydrawadd[data-qn="+g+"]").prop("disabled",!0)),n[g]={type:"a11y",el:M,vispreview:c,xmin:f,xmax:v,ymin:y,ymax:w,imgborder:x,imgwidth:b,imgheight:T},c&&(n[g].canv=document.getElementById("canvas"+g)),n[g].pixperx=(b-2*x)/(v-f),n[g].pixpery=y==w?1:(T-2*x)/(w-y),n[g].isnumberline="numberline"==p[0],"inequality"==p[0]?(N=p.shift(),0==p.length?p=["line"]:"both"==p[0]&&(p=["line","parab"])):"twopoint"==p[0]?(N=p.shift(),0==p.length&&(p=["line","parab","abs","circle","dot"])):"numberline"==p[0]?(N="numberline",p.shift()):N="basic",n[g].afgroup=N;var B={inequality:{line:[{mode:10,descr:_("Linear inequality with solid line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")},{mode:10.2,descr:_("Linear inequality with dashed line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")}],parab:[{mode:10.3,descr:_("Parabolic inequality with solid line"),inN:3,input:_("Enter the vertex, then another point on the parabola, then a third point in the shaded region")},{mode:10.4,descr:_("Parabolic inequality with dashed line"),inN:3,input:_("Enter the vertex, then another point on the parabola, then a third point in the shaded region")}],abs:[{mode:10.5,descr:_("Absolute value inequality with solid line"),inN:3,input:_("Enter the corner point of the absolute value, then another point on the graph, then a third point in the shaded region")},{mode:10.6,descr:_("Absolute value inequality with dashed line"),inN:3,input:_("Enter the corner point of the absolute value, then another point on the graph, then a third point in the shaded region")}]},twopoint:{line:[{mode:5,descr:_("Line"),inN:2,input:_("Enter two points on the line")}],dashedline:[{mode:5.1,descr:_("Dashed Line"),inN:2,input:_("Enter two points on the dashed line")}],lineseg:[{mode:5.3,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],ray:[{mode:5.2,descr:_("Ray"),inN:2,input:_("Enter the starting point of the ray and another point on the ray")}],parab:[{mode:6,descr:_("Parabola"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],"3pointparab":[{mode:6.7,descr:_("Parabola"),inN:3,input:_("Enter three points on the parabola")}],horizparab:[{mode:6.1,descr:_("Parabola opening right or left"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],halfparab:[{mode:6.2,descr:_("Half Parabola"),inN:2,input:_("Enter the vertex, then another point on the half parabola")}],cubic:[{mode:6.3,descr:_("Cubic"),inN:2,input:_("Enter the inflection point, then another point on the cubic")}],sqrt:[{mode:6.5,descr:_("Square root"),inN:2,input:_("Enter the starting point of the square root, then another point on the graph")}],cuberoot:[{mode:6.6,descr:_("Cube root"),inN:2,input:_("Enter the inflection point of the cube root, then another point on the graph")}],abs:[{mode:8,descr:_("Absolute value"),inN:2,input:_("Enter the corner point of the absolute value, then another point on the graph")}],rational:[{mode:8.2,descr:_("Rational"),inN:2,input:_("Enter the point where the vertical and horizontal asymptote cross, then a point on the graph")}],exp:[{mode:8.3,descr:_("Exponential"),inN:2,input:_("Enter two points on the graph")}],log:[{mode:8.4,descr:_("Logarithm"),inN:2,input:_("Enter two points on the graph")}],genexp:[{mode:8.5,descr:_("Shifted Exponential"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],genlog:[{mode:8.6,descr:_("Shifted Logarithm"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],circle:[{mode:7,descr:_("Circle"),inN:2,input:_("Enter the center point of the circle, then a point on the graph")}],ellipse:[{mode:7.2,descr:_("Ellipse"),inN:2,input:_("Enter the center point of the ellipse, then a point offset from the center by the horizontal radius and vertical radius")}],hyperbola:[{mode:7.4,descr:_("Vertical hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the co-vertex and y is the y-coordinate of the vertex")},{mode:7.5,descr:_("Horizontal hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the vertex and y is the y-coordinate of the co-vertex")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],trig:[{mode:9,descr:_("Cosine"),inN:2,input:_("Enter a point at the start of a phase, then a point half a phase further")},{mode:9.1,descr:_("Sine"),inN:2,input:_("Enter a point at the start of a phase, then a point a quarter phase further")}],tan:[{mode:9.2,descr:_("Tangent"),inN:3,input:_("Enter the inflection point of the tangent, then a point on a vertical asymptote, then a point on the graph")}],vector:[{mode:5.4,descr:_("Vector"),inN:2,input:_("Enter the starting and ending point of the vector")}]},basic:{line:[{mode:0,descr:_("Lines"),inN:"list",input:_("Enter a list of points to connect with lines")}],lineseg:[{mode:.5,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],freehand:[{mode:.7,descr:_("Freehand"),inN:"list",input:_("Enter a list of points to connect with lines")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],polygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter a list of points for dots to connect with lines"),dotline:1}],closedpolygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter a list of points for dots to connect with lines"),dotline:2}]},numberline:{lineseg:[{mode:.5,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending values of the line segment, separated by a comma")},{mode:.8,descr:_("Ray to the left"),inN:1,input:_("Enter the value the ray goes left from")},{mode:.9,descr:_("Ray to the right"),inN:1,input:_("Enter the value the ray goes right from")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the value of the solid dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the value of the open dot")}]}};null==a[g]&&(a[g]=new Array),null==r[g]&&(r[g]=new Array),null==h[g]&&(h[g]=new Array),null==s[g]&&(s[g]=new Array),null==d[g]&&(d[g]=new Array),null==m[g]&&(m[g]=new Array),null==u[g]&&(u[g]=new Array);for(var P,q,S=[],k=[],A=[],O=0;O<p.length;O++)if(B[N].hasOwnProperty(p[O])){0==O&&(P=B[N][p[O]][0].mode);for(var R=0;R<B[N][p[O]].length;R++)A[B[N][p[O]][R].mode]=B[N][p[O]][R],S.push(B[N][p[O]][R].mode),q='<option value="'+B[N][p[O]][R].mode+'"',q+=' data-af="'+p[O]+'">'+B[N][p[O]][R].descr+"</option>",k.push(q)}if(L&&(document.getElementById("a11ydrawnew"+g).innerHTML=k),n[g].defmode=P,n[g].inputmodes=S,n[g].selects=k,n[g].moderef=A,L||!c)if(null==i&&a.hasOwnProperty(g)){for(O=0;O<a[g].length;O++)C(g,0,W(a[g][O],g));for(O=0;O<r[g].length;O++)C(g,1,W(r[g][O],g));for(O=0;O<h[g].length;O++)C(g,2,W(h[g][O],g));for(O=0;O<s[g].length;O++)C(g,d[g][O],W(s[g][O][0],g)+","+W(s[g][O][1],g));for(O=0;O<m[g].length;O++)C(g,u[g][O],W(m[g][O][0],g)+","+W(m[g][O][1],g)+","+W(m[g][O][2],g))}else if(null!=i)for(O=0;O<i.length;O++)C(g,i[O][0],i[O][1].replace(/\[/g,"(").replace(/\]/g,")"));c&&j(n[g].canv,g,l,b,T,!0)}function C(t,i,l){var a=n[t],r=i||document.getElementById("a11ydrawnew"+t).value,h=l||"",s=(a.afgroup,a.el.getElementsByTagName("li").length+1),d=o[t].disabled?" disabled ":"",m='<span class="sr-only draweln">'+_("Drawing element ")+s+"</span>";html=m,html+=a.moderef[r].descr+".<br/>",html+='<label><span class="a11ydrawinstr"></span><br/>',html+='<input type="text" value="'+h+'" data-n="'+a.moderef[r].inN+'" '+d,html+='onblur="imathasDraw.updatea11ydraw(this)"/></label>',html+='<button type="button" class="imgbutton" onclick="imathasDraw.removea11ydraw(this)"'+d+">",html+=_("Remove")+" "+m+"</button>";var u=e("<li>",{class:"a11ydrawrow","data-mode":r}).html(html);e(a.el).append(u),u.find(".a11ydrawinstr").text(a.moderef[r].input),l||u.find("input").focus()}function W(e,t){var i,l,o=n[t];return i=(e[0]-o.imgborder)/o.pixperx+o.xmin,l=(o.imgheight-e[1]-o.imgborder)/o.pixpery+o.ymin,"("+(i=Math.round(100*i)/100)+","+(l=Math.round(100*l)/100)+")"}function O(t){void 0===t&&(t=-1);var i=M;for(var l in n)if(!(t>-1&&t!=l)){var g=n[l];if("a11y"==g.type){t>-1&&t==l&&(M=l),a[l].length=0,r[l].length=0,h[l].length=0,s[l].length=0,d[l].length=0,m[l].length=0,u[l].length=0;var p=[],c=[],f=[],v=[],y=[],w=[];n[l].afgroup;e("#a11ydraw"+l).find(".a11ydrawrow").each(function(t,i){var o=e(i).find("input").val(),x=i.getAttribute("data-mode"),b=e(i).find("input").attr("data-n");.8!=x&&.9!=x||b++,w.push("["+x+',"'+o+'"]');var T=[],M=[];if(n[l].isnumberline&&!o.match(/\(/)){var E=g.imgheight-(0-g.ymin)*g.pixpery-g.imgborder;o=o.split(/\s*,\s*/);for(t=0;t<o.length;t+=1){if("oo"===o[t])o[t]=g.xmax;else if("-oo"===o[t])o[t]=g.xmin;else try{o[t]=evalMathParser(o[t])}catch(e){o[t]=NaN}if(o[t]=(o[t]-g.xmin)*g.pixperx+g.imgborder,.8==x&&1==o.length){T.push(Math.round(0)+","+Math.round(E)),M.push([0,E])}if(T.push(Math.round(o[t])+","+Math.round(E)),M.push([o[t],E]),.9==x&&1==o.length){var _=g.imgwidth;T.push(Math.round(_)+","+Math.round(E)),M.push([_,E])}}}else{o=o.replace(/[\(\)]/g,"").split(/\s*,\s*/);for(t=1;t<o.length;t+=2){if("oo"===o[t-1])o[t-1]=g.xmax;else if("-oo"===o[t-1])o[t-1]=g.xmin;else try{o[t-1]=evalMathParser(o[t-1])}catch(e){o[t-1]=NaN}try{o[t]=evalMathParser(o[t])}catch(e){o[t]=NaN}o[t-1]=(o[t-1]-g.xmin)*g.pixperx+g.imgborder,o[t]=g.imgheight-(o[t]-g.ymin)*g.pixpery-g.imgborder,T.push(Math.round(o[t-1])+","+Math.round(o[t])),M.push([o[t-1],o[t]])}}"list"!==b&&b!=T.length||(1==x?(c.push("("+T.join("),(")+")"),r[l].push(M)):2==x?(f.push("("+T.join("),(")+")"),h[l].push(M)):x<1?(p.push("("+T.join("),(")+")"),a[l].push(M)):x>=5&&x<10?(v.push("("+x+","+T.join(",")+")"),s[l].push(M),d[l].push(x)):x>=10&&(y.push("("+x+","+T.join(",")+")"),m[l].push(M),u[l].push(x)))}),o[l].value=p.join(";")+";;"+c.join(",")+";;"+f.join(",")+";;"+v.join(",")+";;"+y.join(",")+";;"+w.join(","),e(o[l]).trigger("input").trigger("change")}}t>-1&&n[t].vispreview&&D(null,null,!0),M=i}function R(t,i,l,g,f,v,y,w,x,b,T,M,E,_,I){var N=document.getElementById(i);e(N).is(":hidden")&&e(N).on("mouseover.imathasdrawwait touchstart.imathasdrawwait",function(){e(N).off("mouseover.imathasdrawwait touchstart.imathasdrawwait"),te(t)}),N.style.userSelect="none",N.style.webkitUserSelect="none",N.style.MozUserSelect="none";var L=$(N);n[t]={type:"canvas",el:N,left:L.x,top:L.y,width:N.offsetWidth,height:N.offsetHeight,xmin:f,xmax:v,ymin:y,ymax:w,imgborder:x,imgwidth:b,imgheight:T,mode:M,dotline:E},"string"==typeof I&&-1!=I.indexOf(":")?(I=I.split(":"),n[t].snaptogridx=1*I[0],n[t].snaptogridy=1*I[1]):(n[t].snaptogridx=1*I,n[t].snaptogridy=1*I),n[t].pixperx=(b-2*x)/(v-f),n[t].pixpery=y==w?1:(T-2*x)/(w-y),o[t]=document.getElementById(g),null==a[t]&&(a[t]=new Array),null==r[t]&&(r[t]=new Array),null==h[t]&&(h[t]=new Array),null==s[t]&&(s[t]=new Array),null==d[t]&&(d[t]=new Array),null==m[t]&&(m[t]=new Array),null==u[t]&&(u[t]=new Array),p[t]=M>=5?1:0,c[t]=_,j(N,t,l,b,T,!1)}function j(t,n,i,o,a,r){if(i.match(/initPicture/)){0==e(t).closest(".drawcanvasholder").length&&(e(t).removeClass("drawcanvas").wrap(e("<div>",{class:"drawcanvas",style:"position:relative;width:"+o+"px;height:"+a+"px"})).wrap(e("<div>",{class:"drawcanvasholder",style:"position:absolute;top:0;left:0;z-index:2"})),e(t).closest(".drawcanvas").prepend(e("<div>",{class:"canvasbg",style:"position:absolute;top:0;left:0"}).append(e("<embed>",{"data-nomag":1,type:"image/svg+xml",align:"middle",width:o,height:a,script:i}).attr("width",o).attr("height",a)))),l[n]=null;var h=M;M=n,D(null,null,r),setTimeout(function(){window.drawPics(e(t).closest(".drawcanvas")[0])},30),M=h}else if(""!==i)l[n]=new Image,l[n].onload=function(){var e=M;M=n,D(null,null,r),M=e},l[n].src=i;else{l[n]=null;h=M;M=n,D(null,null,r),M=h}}function D(t,i,p){try{if(n[M].canv)var T=n[M].canv.getContext("2d");else T=n[M].el.getContext("2d")}catch(e){E||(E=!0,alert("Your browser does not support drawing answer entry.  Please try again using Internet Explorer 6+ (Windows), FireFox 1.5+ (Win/Mac), Safari 1.3+ (Mac), Opera 9+ (Win/Mac), or Camino (Mac)"))}T.fillStyle="rgb(0,0,255)",T.lineWidth=2,T.strokeStyle="rgb(0,0,255)",T.clearRect(0,0,n[M].imgwidth,n[M].imgheight),null!==l[M]&&T.drawImage(l[M],0,0),T.beginPath();for(var _=0;_<m[M].length;_++){var I=_%3;T.strokeStyle=y[I],T.fillStyle=y[I];var N=null,L=null,B=null,P=null,k=null;if(3==m[M][_].length?(L=m[M][_][1][0],P=m[M][_][1][1],B=m[M][_][2][0],k=m[M][_][2][1]):2==m[M][_].length?(L=m[M][_][1][0],P=m[M][_][1][1],B=t,k=i):v==_&&null!=t&&1==m[M][_].length&&(L=t,P=i),null!=B){if(T.save(),T.fillStyle=w[I],T.beginPath(),u[M][_]<=10.2){if(L!=m[M][_][0][0])N=(P-m[M][_][0][1])/(L-m[M][_][0][0]);if(Math.abs(L-m[M][_][0][0])<1||Math.abs(N)>100)T.moveTo(m[M][_][0][0],0),T.lineTo(m[M][_][0][0],n[M].imgheight),B>L?(T.lineTo(n[M].imgwidth,n[M].imgheight),T.lineTo(n[M].imgwidth,0),T.closePath()):(T.lineTo(0,n[M].imgheight),T.lineTo(0,0),T.closePath());else{var A=N*(B-L)+P,C=m[M][_][0][1]-N*m[M][_][0][0],W=m[M][_][0][1]+N*(n[M].imgwidth-m[M][_][0][0]);T.moveTo(0,C),T.lineTo(n[M].imgwidth,W),k>A?(T.lineTo(n[M].imgwidth,n[M].imgheight),T.lineTo(0,n[M].imgheight),T.closePath()):(T.lineTo(n[M].imgwidth,0),T.lineTo(0,0),T.closePath())}}else if(u[M][_]<=10.4)me(T,m[M][_][0][0],m[M][_][0][1],L,P,B,k,n[M].imgwidth,n[M].imgheight);else if(Math.abs(L-m[M][_][0][0])>1){N=(P-m[M][_][0][1])/(L-m[M][_][0][0]);L<m[M][_][0][0]&&(N*=-1);A=N*Math.abs(B-m[M][_][0][0])+m[M][_][0][1],C=m[M][_][0][1]+N*m[M][_][0][0],W=m[M][_][0][1]+N*(n[M].imgwidth-m[M][_][0][0]);k>A?(T.moveTo(n[M].imgwidth,n[M].imgheight),T.lineTo(0,n[M].imgheight)):(T.moveTo(n[M].imgwidth,0),T.lineTo(0,0)),T.lineTo(0,C),T.lineTo(m[M][_][0][0],m[M][_][0][1]),T.lineTo(n[M].imgwidth,W)}T.fill(),T.restore()}if(T.beginPath(),null!=L)if(u[M][_]<=10.2){if(L!=m[M][_][0][0])N=(P-m[M][_][0][1])/(L-m[M][_][0][0]);if(Math.abs(L-m[M][_][0][0])<1||Math.abs(N)>100)10.2==u[M][_]?null!=b&&b.mode>=10&&b.mode<11&&b.num==_&&0==b.subnum?(T.dashedLine(m[M][_][1][0],m[M][_][1][1],m[M][_][1][0],n[M].imgheight),T.dashedLine(m[M][_][1][0],m[M][_][1][1],m[M][_][1][0],0)):(T.dashedLine(m[M][_][0][0],m[M][_][0][1],m[M][_][0][0],n[M].imgheight),T.dashedLine(m[M][_][0][0],m[M][_][0][1],m[M][_][0][0],0)):(T.moveTo(m[M][_][0][0],0),T.lineTo(m[M][_][0][0],n[M].imgheight),T.stroke());else{C=m[M][_][0][1]-N*m[M][_][0][0],W=m[M][_][0][1]+N*(n[M].imgwidth-m[M][_][0][0]);10.2==u[M][_]?null!=b&&b.mode>=10&&b.mode<11&&b.num==_&&0==b.subnum?(T.dashedLine(m[M][_][1][0],m[M][_][1][1],n[M].imgwidth,W),T.dashedLine(m[M][_][1][0],m[M][_][1][1],0,C)):(T.dashedLine(m[M][_][0][0],m[M][_][0][1],n[M].imgwidth,W),T.dashedLine(m[M][_][0][0],m[M][_][0][1],0,C)):(T.moveTo(0,C),T.lineTo(n[M].imgwidth,W),T.stroke())}}else if(u[M][_]<=10.4)if(10.3==u[M][_]){if(L!=m[M][_][0][0])if(P==m[M][_][0][1])T.moveTo(0,P),T.lineTo(n[M].imgwidth,P);else{var O=(P-m[M][_][0][1])/((L-m[M][_][0][0])*(L-m[M][_][0][0]));if(P>m[M][_][0][1])var R=Math.sqrt((n[M].imgheight-m[M][_][0][1])/O)+m[M][_][0][0],j=-1*Math.sqrt((n[M].imgheight-m[M][_][0][1])/O)+m[M][_][0][0],D=m[M][_][0][1]-(n[M].imgheight-m[M][_][0][1]),z=n[M].imgheight;else R=Math.sqrt((0-m[M][_][0][1])/O)+m[M][_][0][0],j=-1*Math.sqrt((0-m[M][_][0][1])/O)+m[M][_][0][0],D=2*m[M][_][0][1],z=0;var F=(Z=R+2/3*(m[M][_][0][0]-R))+(j-R)/3,Y=$=z+2/3*(D-z);T.moveTo(R,z),T.bezierCurveTo(Z,$,F,Y,j,z)}T.stroke()}else L!=m[M][_][0][0]&&de(T,m[M][_][0][0],m[M][_][0][1],L,P,n[M].imgwidth,n[M].imgheight);else if(L!=m[M][_][0][0]){N=(P-m[M][_][0][1])/(L-m[M][_][0][0]);L<m[M][_][0][0]&&(N*=-1);C=m[M][_][0][1]+N*m[M][_][0][0],W=m[M][_][0][1]+N*(n[M].imgwidth-m[M][_][0][0]);10.6==u[M][_]?(null!=b&&b.mode>=10&&b.mode<11&&b.num==_&&b.subnum,T.dashedLine(m[M][_][0][0],m[M][_][0][1],n[M].imgwidth,W),T.dashedLine(m[M][_][0][0],m[M][_][0][1],0,C)):(T.moveTo(0,C),T.lineTo(m[M][_][0][0],m[M][_][0][1]),T.lineTo(n[M].imgwidth,W),T.stroke())}if(u[M][_]==n[M].mode){T.beginPath();for(var U=0;U<m[M][_].length;U++)2==U?(T.arc(m[M][_][U][0],m[M][_][U][1],4,0,2*Math.PI,!0),T.fill()):T.fillRect(m[M][_][U][0]-3,m[M][_][U][1]-3,6,6);1==m[M][_].length&&null!=L&&T.fillRect(L-3,P-3,6,6)}T.beginPath()}T.fillStyle="rgb(0,0,255)",1==c[M]?T.lineWidth=4:T.lineWidth=2,T.strokeStyle="rgb(0,0,255)";for(_=0;_<s[M].length;_++){if(d[M][_]>=5&&d[M][_]<6){var X;N=null,L=null,P=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L)if(5.3==d[M][_]||5.4==d[M][_]){if(T.moveTo(s[M][_][0][0],s[M][_][0][1]),T.lineTo(L,P),5.4==d[M][_]){var V=[L-s[M][_][0][0],P-s[M][_][0][1]],G=Math.sqrt(V[0]*V[0]+V[1]*V[1]);G>1e-4&&(X=[-(V=[V[0]/G,V[1]/G])[1],V[0]],T.moveTo(L-15*V[0]-4*X[0],P-15*V[1]-5*X[1]),T.lineTo(L,P),T.moveTo(L-15*V[0]+4*X[0],P-15*V[1]+5*X[1]),T.lineTo(L,P))}}else{if(L!=s[M][_][0][0])N=(P-s[M][_][0][1])/(L-s[M][_][0][0]);if(Math.abs(L-s[M][_][0][0])<1||Math.abs(N)>100)5.1==d[M][_]?T.dashedLine(s[M][_][0][0],0,s[M][_][0][0],n[M].imgheight):5.2==d[M][_]?(T.moveTo(s[M][_][0][0],s[M][_][0][1]),P>s[M][_][0][1]?T.lineTo(s[M][_][0][0],n[M].imgheight):T.lineTo(s[M][_][0][0],0)):(T.moveTo(s[M][_][0][0],0),T.lineTo(s[M][_][0][0],n[M].imgheight));else{C=s[M][_][0][1]-N*s[M][_][0][0],W=s[M][_][0][1]+N*(n[M].imgwidth-s[M][_][0][0]),C=s[M][_][0][1]-N*s[M][_][0][0],W=s[M][_][0][1]+N*(n[M].imgwidth-s[M][_][0][0]);5.1==d[M][_]?(T.dashedLine(s[M][_][0][0],s[M][_][0][1],n[M].imgwidth,W),T.dashedLine(s[M][_][0][0],s[M][_][0][1],0,C)):5.2==d[M][_]?(T.moveTo(s[M][_][0][0],s[M][_][0][1]),L>s[M][_][0][0]?T.lineTo(n[M].imgwidth,W):T.lineTo(0,C)):(T.moveTo(0,C),T.lineTo(n[M].imgwidth,W))}}}else if(6==d[M][_]||6.1==d[M][_]||6.2==d[M][_]){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L)if(6==d[M][_])if(P==s[M][_][0][1])T.moveTo(0,P),T.lineTo(n[M].imgwidth,P);else if(L==s[M][_][0][0])T.moveTo(L,s[M][_][0][1]),P>s[M][_][0][1]?T.lineTo(L,n[M].imgheight):T.lineTo(L,0);else{O=(P-s[M][_][0][1])/((L-s[M][_][0][0])*(L-s[M][_][0][0]));if(P>s[M][_][0][1])R=Math.sqrt((n[M].imgheight-s[M][_][0][1])/O)+s[M][_][0][0],j=-1*Math.sqrt((n[M].imgheight-s[M][_][0][1])/O)+s[M][_][0][0],D=s[M][_][0][1]-(n[M].imgheight-s[M][_][0][1]),z=n[M].imgheight;else R=Math.sqrt((0-s[M][_][0][1])/O)+s[M][_][0][0],j=-1*Math.sqrt((0-s[M][_][0][1])/O)+s[M][_][0][0],D=2*s[M][_][0][1],z=0;F=(Z=R+2/3*(s[M][_][0][0]-R))+(j-R)/3,Y=$=z+2/3*(D-z);T.moveTo(R,z),T.bezierCurveTo(Z,$,F,Y,j,z)}else if(6.1==d[M][_])if(L==s[M][_][0][0])T.moveTo(L,0),T.lineTo(L,n[M].imgheight);else if(P==s[M][_][0][1])T.moveTo(s[M][_][0][0],P),L>s[M][_][0][0]?T.lineTo(n[M].imgwidth,P):T.lineTo(0,P);else{O=(L-s[M][_][0][0])/((P-s[M][_][0][1])*(P-s[M][_][0][1]));if(L>s[M][_][0][0]){R=Math.sqrt((n[M].imgwidth-s[M][_][0][0])/O)+s[M][_][0][1],j=-1*Math.sqrt((n[M].imgwidth-s[M][_][0][0])/O)+s[M][_][0][1];var J=s[M][_][0][0]-(n[M].imgwidth-s[M][_][0][0]),Q=n[M].imgwidth}else R=Math.sqrt((0-s[M][_][0][0])/O)+s[M][_][0][1],j=-1*Math.sqrt((0-s[M][_][0][0])/O)+s[M][_][0][1],J=2*s[M][_][0][0],Q=0;Y=($=R+2/3*(s[M][_][0][1]-R))+(j-R)/3,F=Z=Q+2/3*(J-Q);T.moveTo(Q,R),T.bezierCurveTo(Z,$,F,Y,Q,j)}else if(6.2==d[M][_])if(P==s[M][_][0][1])T.moveTo(s[M][_][0][0],P),T.lineTo(L<s[M][_][0][0]?0:n[M].imgwidth,P);else if(L==s[M][_][0][0])T.moveTo(L,s[M][_][0][1]),P>s[M][_][0][1]?T.lineTo(L,n[M].imgheight):T.lineTo(L,0);else{O=(P-s[M][_][0][1])/((L-s[M][_][0][0])*(L-s[M][_][0][0])),s[M][_][0][0];if(P>s[M][_][0][1]){var K=Math.sqrt((n[M].imgheight-s[M][_][0][1])/O);z=n[M].imgheight}else K=Math.sqrt((0-s[M][_][0][1])/O),z=0;L<s[M][_][0][0]&&(K*=-1);var Z=s[M][_][0][0]+1/3*K,$=s[M][_][0][1];F=s[M][_][0][0]+2/3*K,Y=s[M][_][0][1]+1/3*O*K*K;T.moveTo(s[M][_][0][0],s[M][_][0][1]),T.bezierCurveTo(Z,$,F,Y,s[M][_][0][0]+K,z)}}else if(6.7==d[M][_]){P=null,L=null,k=null,B=null;if(3==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1],B=s[M][_][2][0],k=s[M][_][2][1]):2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1],B=t,k=i):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=B&&ee!=L&&L!=B){var ee=s[M][_][0][0];if((Me=s[M][_][0][1])==P&&k==P)T.moveTo(0,k),T.lineTo(n[M].imgwidth,k);else{var te=-(ce=(P-Me)/(L-ee)-(fe=(ee*(k-P)+L*(Me-k)+B*(P-Me))/((ee-L)*(ee-B)*(L-B)))*(ee+L))/(2*fe),ne=(4*fe*(Me-fe*ee*ee-ce*ee)-ce*ce)/(4*fe);if(fe>0)R=Math.sqrt((n[M].imgheight-ne)/fe)+te,j=-1*Math.sqrt((n[M].imgheight-ne)/fe)+te,D=ne-(n[M].imgheight-ne),z=n[M].imgheight;else R=Math.sqrt((0-ne)/fe)+te,j=-1*Math.sqrt((0-ne)/fe)+te,D=2*ne,z=0;F=(Z=R+2/3*(te-R))+(j-R)/3,Y=$=z+2/3*(D-z);T.moveTo(R,z),T.bezierCurveTo(Z,$,F,Y,j,z)}}}else if(6.5==d[M][_]){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L&&L!=s[M][_][0][0])if(P==s[M][_][0][1])T.moveTo(s[M][_][0][0],P),L>s[M][_][0][0]?T.lineTo(n[M].imgwidth,P):T.lineTo(0,P);else{var ie=L<s[M][_][0][0]?-1:1;O=(P-s[M][_][0][1])/Math.sqrt(ie*(L-s[M][_][0][0]));T.moveTo(s[M][_][0][0],s[M][_][0][1]),oe=s[M][_][0][0],le=s[M][_][0][1];do{oe+=3*ie,le=O*Math.sqrt(ie*(oe-s[M][_][0][0]))+s[M][_][0][1],T.lineTo(oe,le)}while(oe>0&&oe<n[M].imgwidth&&le>0&&le<n[M].imgheight)}}else if(6.3==d[M][_]){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L&&L!=s[M][_][0][0])if(P==s[M][_][0][1])T.moveTo(0,P),T.lineTo(n[M].imgwidth,P);else{O=(P-s[M][_][0][1])/safepow(L-s[M][_][0][0],3);for(var le=0,oe=0;oe<n[M].imgwidth+4;oe+=1)(le=O*safepow(oe-s[M][_][0][0],3)+s[M][_][0][1])<-100&&(le=-100),le>n[M].imgheight+100&&(le=n[M].imgheight+100),0==oe?T.moveTo(oe,le):T.lineTo(oe,le)}}else if(6.6==d[M][_]){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L&&L!=s[M][_][0][0])if(P==s[M][_][0][1])T.moveTo(0,P),T.lineTo(n[M].imgwidth,P);else for(O=(P-s[M][_][0][1])/safepow(L-s[M][_][0][0],1/3),le=0,oe=0;oe<n[M].imgwidth+4;oe+=1)(le=O*safepow(oe-s[M][_][0][0],1/3)+s[M][_][0][1])<-100&&(le=-100),le>n[M].imgheight+100&&(le=n[M].imgheight+100),0==oe?T.moveTo(oe,le):T.lineTo(oe,le)}else if(d[M][_]>=7&&d[M][_]<8){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L&&(L!=s[M][_][0][0]||P!=s[M][_][0][1]))if(7==d[M][_]){var ae=Math.abs(L-s[M][_][0][0]),re=Math.abs(P-s[M][_][0][1]),he=ae/n[M].pixperx,se=re/n[M].pixpery,ue=Math.sqrt(he*he+se*se);T.save(),T.beginPath();var ge=ue*n[M].pixperx,pe=ue*n[M].pixpery;T.translate(s[M][_][0][0]-ge,s[M][_][0][1]-pe),T.scale(ge,pe),T.arc(1,1,1,0,2*Math.PI,!1),T.restore()}else if(7.2==d[M][_]){ge=Math.abs(L-s[M][_][0][0]),pe=Math.abs(P-s[M][_][0][1]);(f==_||null!=b&&b.num==_)&&(T.strokeStyle="rgb(0,255,255)",T.lineWidth=1,T.dashedLine(L,P,L-2*(L-s[M][_][0][0]),P,5),T.dashedLine(L,P,L,P-2*(P-s[M][_][0][1]),5),T.dashedLine(L,P-2*(P-s[M][_][0][1]),L-2*(L-s[M][_][0][0]),P-2*(P-s[M][_][0][1]),5),T.dashedLine(L-2*(L-s[M][_][0][0]),P,L-2*(L-s[M][_][0][0]),P-2*(P-s[M][_][0][1]),5),T.lineWidth=2),T.strokeStyle="rgb(0,0,255)",T.save(),T.beginPath(),T.translate(s[M][_][0][0]-ge,s[M][_][0][1]-pe),T.scale(ge,pe),T.arc(1,1,1,0,2*Math.PI,!1),T.restore()}else if(7.4==d[M][_]){var ce=Math.abs(L-s[M][_][0][0]),fe=Math.abs(P-s[M][_][0][1]),ve=Math.abs(fe/ce);T.strokeStyle=x,T.dashedLine(s[M][_][0][0],s[M][_][0][1],n[M].imgwidth,s[M][_][0][1]+ve*(n[M].imgwidth-s[M][_][0][0])),T.dashedLine(s[M][_][0][0],s[M][_][0][1],n[M].imgwidth,s[M][_][0][1]-ve*(n[M].imgwidth-s[M][_][0][0])),T.dashedLine(s[M][_][0][0],s[M][_][0][1],0,s[M][_][0][1]-ve*s[M][_][0][0]),T.dashedLine(s[M][_][0][0],s[M][_][0][1],0,s[M][_][0][1]+ve*s[M][_][0][0]),(f==_||null!=b&&b.num==_)&&(T.strokeStyle="rgb(0,255,255)",T.lineWidth=1,T.dashedLine(L,P,L-2*(L-s[M][_][0][0]),P,5),T.dashedLine(L,P,L,P-2*(P-s[M][_][0][1]),5),T.dashedLine(L,P-2*(P-s[M][_][0][1]),L-2*(L-s[M][_][0][0]),P-2*(P-s[M][_][0][1]),5),T.dashedLine(L-2*(L-s[M][_][0][0]),P,L-2*(L-s[M][_][0][0]),P-2*(P-s[M][_][0][1]),5),T.lineWidth=2),T.beginPath(),T.strokeStyle="rgb(0,0,255)";for(oe=0;oe<n[M].imgwidth+4;oe+=3)(le=s[M][_][0][1]+Math.sqrt((Math.pow(oe-s[M][_][0][0],2)/(ce*ce)+1)*fe*fe))<-100&&(le=-100),le>n[M].imgheight+100&&(le=n[M].imgheight+100),0==oe?T.moveTo(oe,le):T.lineTo(oe,le);T.stroke(),T.beginPath();for(oe=0;oe<n[M].imgwidth+4;oe+=3)(le=s[M][_][0][1]-Math.sqrt((Math.pow(oe-s[M][_][0][0],2)/(ce*ce)+1)*fe*fe))<-100&&(le=-100),le>n[M].imgheight+100&&(le=n[M].imgheight+100),0==oe?T.moveTo(oe,le):T.lineTo(oe,le)}else if(7.5==d[M][_]){fe=Math.abs(L-s[M][_][0][0]),ce=Math.abs(P-s[M][_][0][1]),ve=Math.abs(ce/fe);T.strokeStyle=x,T.dashedLine(s[M][_][0][0],s[M][_][0][1],n[M].imgwidth,s[M][_][0][1]+ve*(n[M].imgwidth-s[M][_][0][0])),T.dashedLine(s[M][_][0][0],s[M][_][0][1],n[M].imgwidth,s[M][_][0][1]-ve*(n[M].imgwidth-s[M][_][0][0])),T.dashedLine(s[M][_][0][0],s[M][_][0][1],0,s[M][_][0][1]-ve*s[M][_][0][0]),T.dashedLine(s[M][_][0][0],s[M][_][0][1],0,s[M][_][0][1]+ve*s[M][_][0][0]),(f==_||null!=b&&b.num==_)&&(T.strokeStyle="rgb(0,255,255)",T.lineWidth=1,T.dashedLine(L,P,L-2*(L-s[M][_][0][0]),P,5),T.dashedLine(L,P,L,P-2*(P-s[M][_][0][1]),5),T.dashedLine(L,P-2*(P-s[M][_][0][1]),L-2*(L-s[M][_][0][0]),P-2*(P-s[M][_][0][1]),5),T.dashedLine(L-2*(L-s[M][_][0][0]),P,L-2*(L-s[M][_][0][0]),P-2*(P-s[M][_][0][1]),5),T.lineWidth=2),T.beginPath(),T.strokeStyle="rgb(0,0,255)";for(le=0;le<n[M].imgwidth+4;le+=3)(oe=s[M][_][0][0]+Math.sqrt((Math.pow(le-s[M][_][0][1],2)/(ce*ce)+1)*fe*fe))<-100&&(oe=-100),oe>n[M].imgwidth+100&&(oe=n[M].imgwidth+100),0==le?T.moveTo(oe,le):T.lineTo(oe,le);T.stroke(),T.beginPath();for(le=0;le<n[M].imgwidth+4;le+=3)(oe=s[M][_][0][0]-Math.sqrt((Math.pow(le-s[M][_][0][1],2)/(ce*ce)+1)*fe*fe))<-100&&(oe=-100),oe>n[M].imgwidth+100&&(oe=n[M].imgwidth+100),0==le?T.moveTo(oe,le):T.lineTo(oe,le)}}else if(8==d[M][_]){N=null,L=null,P=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L){if(L!=s[M][_][0][0]){N=(P-s[M][_][0][1])/(L-s[M][_][0][0]);L<s[M][_][0][0]&&(N*=-1)}if(Math.abs(L-s[M][_][0][0])<1||Math.abs(N)>100)T.moveTo(s[M][_][0][0],s[M][_][0][1]),P>s[M][_][0][1]?T.lineTo(s[M][_][0][0],n[M].imgheight):T.lineTo(s[M][_][0][0],0);else{C=s[M][_][0][1]+N*s[M][_][0][0],W=s[M][_][0][1]+N*(n[M].imgwidth-s[M][_][0][0]);T.moveTo(0,C),T.lineTo(s[M][_][0][0],s[M][_][0][1]),T.lineTo(n[M].imgwidth,W)}}}else if(8.3==d[M][_]){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L&&L!=s[M][_][0][0])if(P==s[M][_][0][1])T.moveTo(0,P),T.lineTo(n[M].imgwidth,P);else{var ye=n[M].ymax*n[M].pixpery+n[M].imgborder,we=ye-s[M][_][0][1];if(we*(Ee=ye-P)>0&&L!=s[M][_][0][0]){var xe=safepow(Ee/we,1/(L-s[M][_][0][0]));O=Ee/safepow(xe,L);T.moveTo(s[M][_][0][0],s[M][_][0][1]);for(le=0,oe=0;oe<n[M].imgwidth+4;oe+=3)(le=ye-O*safepow(xe,oe))<-100&&(le=-100),le>n[M].imgheight+100&&(le=n[M].imgheight+100),0==oe?T.moveTo(oe,le):T.lineTo(oe,le)}}}else if(8.4==d[M][_]){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L&&L!=s[M][_][0][0]&&P!=s[M][_][0][1]){var be=-n[M].xmin*n[M].pixperx+n[M].imgborder,Te=be-s[M][_][0][0];if(Te*(Ie=be-L)>0&&P!=s[M][_][0][1]){xe=safepow(Ie/Te,1/(P-s[M][_][0][1])),O=Ie/safepow(xe,P);T.moveTo(s[M][_][0][0],s[M][_][0][1]);for(le=0,le=0;le<n[M].imgheight+4;le+=3)(oe=be-O*safepow(xe,le))<-100&&(oe=-100),oe>n[M].imgwidth+100&&(oe=n[M].imgwidth+100),0==le?T.moveTo(oe,le):T.lineTo(oe,le)}}}else if(8.5==d[M][_]){P=null,L=null,k=null,B=null;3==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1],B=s[M][_][2][0],k=s[M][_][2][1]):2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1],B=t,k=i):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i);var Me=s[M][_][0][1];if(T.strokeStyle=x,T.dashedLine(5,Me,n[M].imgwidth,Me),T.beginPath(),T.strokeStyle="rgb(0,0,255)",null!=B&&B!=L)if(k==P)T.moveTo(0,k),T.lineTo(n[M].imgwidth,k);else{var Ee,_e=Me-k;if((Ee=Me-P)*_e>0&&B!=L){xe=safepow(_e/Ee,1/(B-L)),O=_e/safepow(xe,B);T.moveTo(L,P);for(le=0,oe=0;oe<n[M].imgwidth+4;oe+=3)(le=Me-O*safepow(xe,oe))<-100&&(le=-100),le>n[M].imgheight+100&&(le=n[M].imgheight+100),0==oe?T.moveTo(oe,le):T.lineTo(oe,le)}}}else if(8.6==d[M][_]){P=null,L=null,k=null,B=null;3==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1],B=s[M][_][2][0],k=s[M][_][2][1]):2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1],B=t,k=i):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i);ee=s[M][_][0][0];if(T.strokeStyle=x,T.dashedLine(ee,5,ee,n[M].imgheight),T.beginPath(),T.strokeStyle="rgb(0,0,255)",null!=B&&B!=L&&k!=P){var Ie,Ne=B-ee;if((Ie=L-ee)*Ne>0){xe=safepow(Ne/Ie,1/(k-P)),O=Ne/safepow(xe,k);T.moveTo(L,P);for(oe=0,le=0;le<n[M].imgheight+4;le+=3)(oe=ee+O*safepow(xe,le))<-100&&(oe=-100),oe>n[M].imgwidth+100&&(oe=n[M].imgwidth+100),0==le?T.moveTo(oe,le):T.lineTo(oe,le)}}}else if(8.2==d[M][_]){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),T.strokeStyle=x,T.dashedLine(5,s[M][_][0][1],n[M].imgwidth,s[M][_][0][1]),T.dashedLine(s[M][_][0][0],5,s[M][_][0][0],n[M].imgheight),T.beginPath(),T.strokeStyle="rgb(0,0,255)",null!=L&&L!=s[M][_][0][0]&&P!=s[M][_][0][1]){for(O=(P-s[M][_][0][1])*(L-s[M][_][0][0]),oe=s[M][_][0][0]-1;oe>-4;oe-=3)(le=O/(oe-s[M][_][0][0])+s[M][_][0][1])<-100&&(le=-100),le>n[M].imgheight+100&&(le=n[M].imgheight+100),oe==s[M][_][0][0]-1?T.moveTo(oe,le):T.lineTo(oe,le);for(oe=s[M][_][0][0]+1;oe<n[M].imgwidth+4;oe+=3)(le=O/(oe-s[M][_][0][0])+s[M][_][0][1])<-100&&(le=-100),le>n[M].imgheight+100&&(le=n[M].imgheight+100),oe==s[M][_][0][0]+1?T.moveTo(oe,le):T.lineTo(oe,le);T.stroke()}}else if(9==d[M][_]||9.1==d[M][_]){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L&&L!=s[M][_][0][0])if(P==s[M][_][0][1])T.moveTo(0,P),T.lineTo(n[M].imgwidth,P);else{if(9==d[M][_])var Le=-1*Math.abs(P-s[M][_][0][1])/2,Be=(P+s[M][_][0][1])/2,Pe=(O=Math.PI/Math.abs(L-s[M][_][0][0]),P<s[M][_][0][1]?L:s[M][_][0][0]);else if(9.1==d[M][_])Le=-1*Math.abs(P-s[M][_][0][1]),Be=s[M][_][0][1],O=.5*Math.PI/Math.abs(L-s[M][_][0][0]),Pe=P<s[M][_][0][1]?L:L+2*Math.abs(L-s[M][_][0][0]);for(le=0,oe=0;oe<n[M].imgwidth+4;oe+=3)le=Le*Math.cos(O*(oe-Pe))+Be,0==oe?T.moveTo(oe,le):T.lineTo(oe,le)}}else if(9.2==d[M][_]){P=null,L=null,k=null,B=null;3==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1],B=s[M][_][2][0],k=s[M][_][2][1]):2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1],B=t,k=i):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i);ee=s[M][_][0][0],Me=s[M][_][0][1];var qe=[];if(null!=L&&Math.abs(L-ee)>2){T.strokeStyle=x;Be=Me,Pe=ee;for(var Se=2*Math.round(Math.abs(L-ee)),ke=0;L+Se*ke<n[M].imgwidth;)T.dashedLine(L+Se*ke,0,L+Se*ke,n[M].imgheight),qe.push(L+Se*ke),ke++;for(ke=-1;L+Se*ke>0;)T.dashedLine(L+Se*ke,0,L+Se*ke,n[M].imgheight),qe.push(L+Se*ke),ke--;if(T.beginPath(),T.strokeStyle="rgb(0,0,255)",null!=B&&B!=L&&B!=ee&&k!=Me&&Math.round(Math.abs(2*(B-ee)))%Se!=0){O=Math.PI/Se,Le=(k-Me)/Math.tan(O*(B-ee));qe.push(n[M].imgwidth+1),qe.sort(function(e,t){return e-t});for(var Ae,Ce=0,We=0;We<qe.length;We++){Ae=qe[We],We>0&&(Ce=qe[We-1]+1);for(oe=Ce;oe<Ae;oe+=1)le=Le*Math.tan(O*(oe-Pe))+Be,(We>0&&oe==Ce||We<qe.length-1&&Ae-oe<=1)&&(le>Me&&le<n[M].imgheight?le=n[M].imgheight:le<Me&&le>0&&(le=0)),oe==Ce?T.moveTo(oe,le):T.lineTo(oe,le)}}}}T.stroke(),T.beginPath()}var Oe,Re,je,De;null===f&&S.hasOwnProperty(n[M].mode)&&(T.strokeStyle="rgb(200,200,200)",8.5==n[M].mode?T.dashedLine(5,i,n[M].imgwidth,i):8.6==n[M].mode?T.dashedLine(t,5,t,n[M].imgwidth):8.2==n[M].mode?(T.dashedLine(5,i,n[M].imgwidth,i),T.dashedLine(t,5,t,n[M].imgheight)):7.4!=n[M].mode&&7.5!=n[M].mode||(T.dashedLine(t,i,n[M].imgwidth,i+(n[M].imgwidth-t)),T.dashedLine(t,i,n[M].imgwidth,i-(n[M].imgwidth-t)),T.dashedLine(t,i,0,i-t),T.dashedLine(t,i,0,i+t)),T.beginPath(),T.strokeStyle="rgb(0,0,255)"),T.fillStyle="rgba(0,0,255,.5)";for(_=0;_<a[M].length;_++){T.beginPath();for(U=0;U<a[M][_].length;U++)0==U?(T.moveTo(a[M][_][U][0],a[M][_][U][1]),Oe=a[M][_][U][0],Re=a[M][_][U][1]):(T.lineTo(a[M][_][U][0],a[M][_][U][1]),je=a[M][_][U][0],De=a[M][_][U][1]);_==g&&null!=t&&(T.lineTo(t,i),je=t,De=i);var ze=.02*n[M].imgwidth;if(1==c[M]&&je>.98*n[M].imgwidth?(T.moveTo(je,De),T.lineTo(je-ze,De+ze),T.moveTo(je,De),T.lineTo(je-ze,De-ze)):1==c[M]&&Oe>.98*n[M].imgwidth&&(T.moveTo(Oe,Re),T.lineTo(Oe-ze,Re+ze),T.moveTo(Oe,Re),T.lineTo(Oe-ze,Re-ze)),1==c[M]&&je<.02*n[M].imgwidth?(T.moveTo(je,De),T.lineTo(je+ze,De+ze),T.moveTo(je,De),T.lineTo(je+ze,De-ze)):1==c[M]&&Oe<.02*n[M].imgwidth&&(T.moveTo(Oe,Re),T.lineTo(Oe+ze,Re+ze),T.moveTo(Oe,Re),T.lineTo(Oe+ze,Re-ze)),T.stroke(),n[M].dotline>1){if(a[M][_].length-1<1)continue;if(Math.pow(je-Oe,2)+Math.pow(De-Re,2)<25){T.moveTo(a[M][_][0][0],a[M][_][0][1]);for(U=1;U<a[M][_].length;U++)T.lineTo(a[M][_][U][0],a[M][_][U][1]);T.closePath(),T.fill()}}}T.fillStyle="rgb(0,0,255)",T.beginPath();for(_=0;_<r[M].length;_++)T.moveTo(r[M][_][0]+5,r[M][_][1]),T.arc(r[M][_][0],r[M][_][1],5,0,2*Math.PI,!0);if(T.fill(),n[M].dotline>0){T.beginPath();for(_=0;_<a[M].length;_++)for(U=0;U<a[M][_].length;U++)(0==U||Math.pow(a[M][_][U][0]-a[M][_][U-1][0],2)+Math.pow(a[M][_][U][1]-a[M][_][U-1][1],2)>25)&&(T.moveTo(a[M][_][U][0]+5,a[M][_][U][1]),T.arc(a[M][_][U][0],a[M][_][U][1],5,0,2*Math.PI,!0));T.fill()}T.fillStyle="rgb(255,255,255)",T.beginPath();for(_=0;_<h[M].length;_++)T.moveTo(h[M][_][0]+5,h[M][_][1]),T.arc(h[M][_][0],h[M][_][1],4,0,2*Math.PI,!0);n[M].mode<3?T.fill():T.stroke(),T.lineWidth=2,T.beginPath();for(_=0;_<h[M].length;_++)T.moveTo(h[M][_][0]+5,h[M][_][1]),T.arc(h[M][_][0],h[M][_][1],4,0,2*Math.PI,!0);T.stroke();for(_=0;_<s[M].length;_++)if(d[M][_]==n[M].mode){T.fillStyle="rgb(255,0,0)";for(U=0;U<s[M][_].length;U++)T.fillRect(s[M][_][U][0]-3,s[M][_][U][1]-3,6,6);s[M][_].length<q[n[M].mode]&&null!=t&&f==_&&T.fillRect(t-3,i-3,6,6),T.fillStyle="rgb(0,0,255)"}!0!==p&&function(){for(var t="",i=[],l=0;l<a[M].length;l++){a[M][l].length;i=0==n[M].dotline?pathsimplify(a[M][l]):a[M][l],0!=l&&(t+=";");for(var g=0;g<i.length;g++)0!=g&&(t+=","),t+="("+H(i[g][0],4)+","+H(i[g][1],4)+")"}t+=";;";for(l=0;l<r[M].length;l++)0!=l&&(t+=","),t+="("+H(r[M][l][0],4)+","+H(r[M][l][1],4)+")";t+=";;";for(l=0;l<h[M].length;l++)0!=l&&(t+=","),t+="("+H(h[M][l][0],4)+","+H(h[M][l][1],4)+")";t+=";;";var p=[],c="";for(l=0;l<s[M].length;l++)if(s[M][l].length==q[d[M][l]]){c="("+d[M][l];for(g=0;g<s[M][l].length;g++)c+=","+H(s[M][l][g][0],4)+","+H(s[M][l][g][1],4);p.push(c+")")}t+=p.join(","),t+=";;";var f=[];for(l=0;l<m[M].length;l++)m[M][l].length>2&&f.push("("+u[M][l]+","+H(m[M][l][0][0],4)+","+H(m[M][l][0][1],4)+","+H(m[M][l][1][0],4)+","+H(m[M][l][1][1],4)+","+H(m[M][l][2][0],4)+","+H(m[M][l][2][1],4)+")");if(t+=f.join(","),o[M].value!=t){var v=""!=o[M].value||";;;;;;;;"!=t;o[M].value=t,v&&e(o[M]).trigger("input").trigger("change")}}()}function z(e,t){1==e?r[M].splice(t,1):2==e?h[M].splice(t,1):e>=0&&e<1?a[M].splice(t,1):e>=5&&e<10?(s[M].splice(t,1),d[M].splice(t,1),f=null):e>=10&&e<11&&(m[M].splice(t,1),u[M].splice(t,1),v=null),D()}function H(e,t){return Math.round(e)}function F(l){if(ee(),I&&l.originalEvent.touches.length>1)return N=!0,e(document).on("touchend.imathasdraw",X),!0;I?(window.clearTimeout(B),e(document).off("mousemove.imathasdraw"),e(".drawcanvas").on("touchstart.imathasdraw",function(e){I=!0,F(e)}),e(".drawcanvas").on("touchmove.imathasdraw",G),e(document).on("touchend.imathasdraw",X),e(document).on("touchcancel.imathasdraw",X)):(e(document).on("mousemove.imathasdraw",G),e(document).on("mouseup.imathasdraw",X));var p=Q(l);if(null==M||null==g&&null==f&&null==v)for(i in n){if(!e(n[i].el).is(":hidden")&&"canvas"==n[i].type)if((y=$(n[i].el)).x<p.x&&y.x+n[i].width>p.x&&y.y<p.y&&y.y+n[i].height>p.y&&l.target==n[i].el){M=i;break}}if(null!=M){if(o[M].disabled)return;l.preventDefault(),t=!0;var y=$(n[M].el),w={x:p.x-y.x,y:p.y-y.y};if(w.x>-1&&w.x<n[M].width&&w.y>-1&&w.y<n[M].height){n[M].snaptogridx>0&&(w=K(w,M)),1==c[M]&&(w.y=n[M].imgheight/2);var x=Y(M,w);if(null!=x){if(-1==n[M].mode)return void z(x[0],x[1]);(null!=g&&x[0]<1&&g!=x[1]||null!=f&x[0]>=5&&x[0]<10&&f!=x[1]||null!=v&&x[0]>=10&&x[0]<11&&v!=x[1])&&(x=null)}null==x?(J("pendown"),1==n[M].mode?(r[M].push([w.x,w.y]),b={mode:1,num:r[M].length-1}):2==n[M].mode?(h[M].push([w.x,w.y]),b={mode:2,num:h[M].length-1}):0==n[M].mode||.7==n[M].mode?null==g?(a[M].push([[w.x,w.y]]),g=a[M].length-1):a[M][g].push([w.x,w.y]):.5==n[M].mode?null==g?(a[M].push([[w.x,w.y]]),g=a[M].length-1):(a[M][g].push([w.x,w.y]),g=null,b=null):n[M].mode>=5&&n[M].mode<10?null==f?(s[M].push([[w.x,w.y]]),f=s[M].length-1,d[M][f]=n[M].mode,t=!1):(s[M][f].push([w.x,w.y]),s[M][f].length==q[n[M].mode]?(b={mode:n[M].mode,num:f,subnum:q[n[M].mode]-1},f=null):t=!1):n[M].mode>=10&&n[M].mode<11&&(null==v?(m[M].push([[w.x,w.y]]),v=m[M].length-1,u[M][v]=n[M].mode,t=!1):(m[M][v].push([w.x,w.y]),2==m[M][v].length?b={mode:n[M].mode,num:v,subnum:1}:3==m[M][v].length&&(b={mode:n[M].mode,num:v,subnum:2},v=null)))):0==x[0]||.5==x[0]?null==g?(J("move"),b={mode:n[M].mode,num:x[1],subnum:x[2]},T=a[M][x[1]][x[2]],x[2]==a[M][x[1]].length-1&&0==n[M].mode?g=x[1]:0==x[2]&&0==n[M].mode&&(g=x[1],a[M][g].reverse(),b.subnum=a[M][g].length-1),L=!0):x[1]==g&&x[2]==a[M][x[1]].length-1?(a[M][g].length<2&&a[M].splice(g,1),g=null):n[M].dotline>1&&x[1]==g&&0==x[2]?(a[M][g].push(a[M][g][0]),g=null):(J("pendown"),a[M][g].push([w.x,w.y])):1==x[0]?(J("move"),b={mode:1,num:x[1]}):2==x[0]?(J("move"),b={mode:2,num:x[1]}):x[0]>=5&&x[0]<10?null==f&&(J("move"),b={mode:x[0],num:x[1],subnum:x[2]},T=s[M][x[1]][x[2]],L=!0):x[0]>=10&&x[0]<11&&null==v&&(J("move"),b={mode:x[0],num:x[1],subnum:x[2]},T=m[M][x[1]][x[2]],L=!0),D()}else null!=g&&(a[M][g].length<2&&a[M].splice(g,1),J("pen")),null!=f&&(s[M][f].length<q[n[M].mode]&&(s[M].splice(f,1),d[M].splice(f,1)),J("pen")),null!=v&&(m[M][v].length<3&&(m[M].splice(v,1),u[M].splice(v,1)),J("pen")),g=null,f=null,v=null,b=null,D(),M=null}}function Y(e,t){if(I){var i=Math.max(15*window.innerWidth/screen.width,15);i*=i}else if(-1==n[e].mode)i=50;else i=25;if(0==n[e].mode||.5==n[e].mode||-1==n[e].mode)for(var l=a[e].length-1;l>=0;l--)for(var o=a[e][l].length-1;o>=0;o--){if(Math.pow(a[e][l][o][0]-t.x,2)+Math.pow(a[e][l][o][1]-t.y,2)<i)return[-1==n[e].mode?0:n[e].mode,l,o]}if(1==n[e].mode||-1==n[e].mode)for(l=r[e].length-1;l>=0;l--)if(Math.pow(r[e][l][0]-t.x,2)+Math.pow(r[e][l][1]-t.y,2)<i)return[1,l];if(2==n[e].mode||-1==n[e].mode)for(l=h[e].length-1;l>=0;l--)if(Math.pow(h[e][l][0]-t.x,2)+Math.pow(h[e][l][1]-t.y,2)<i)return[2,l];if(n[e].mode>=5&&n[e].mode<10||-1==n[e].mode)for(l=s[e].length-1;l>=0;l--)for(o=s[e][l].length-1;o>=0;o--){if(d[e][l]==n[e].mode||-1==n[e].mode)if(Math.pow(s[e][l][o][0]-t.x,2)+Math.pow(s[e][l][o][1]-t.y,2)<i)return[d[e][l],l,o]}if(n[e].mode>=10&&n[e].mode<11||-1==n[e].mode)for(l=m[e].length-1;l>=0;l--)for(o=m[e][l].length-1;o>=0;o--){if(u[e][l]==n[e].mode||-1==n[e].mode)if(Math.pow(m[e][l][o][0]-t.x,2)+Math.pow(m[e][l][o][1]-t.y,2)<i)return[u[e][l],l,o]}return null}var U=null;function X(i){var l=Q(i);if(t=!1,null!=M){if(o[M].disabled)return;var p=$(n[M].el),y={x:l.x-p.x,y:l.y-p.y};n[M].snaptogridx>0&&(y=K(y,M));var w=y.x>-1&&y.x<n[M].width&&y.y>-1&&y.y<n[M].height;1==L&&(n[M].mode>=5&&n[M].mode<10?(s[M].push([[y.x,y.y]]),f=s[M].length-1,d[M][f]=n[M].mode):n[M].mode>=10&&n[M].mode<11&&(m[M].push([[y.x,y.y]]),v=m[M].length-1,u[M][v]=n[M].mode)),null!=U&&l.x==U.x&&l.y==U.y&&null!=g&&null==b&&(a[M][g].length<2&&a[M].splice(g,1),g=null,b=null,D()),null!=g&&null==b&&(.5==n[M].mode&&a[M][g].length>1||.7==n[M].mode)&&(g=null,dragobj=null,D()),null!=f&&s[M][f].length<q[n[M].mode]&&(N||!w?(s[M].splice(f,1),d[M].splice(f,1),f=null,D()):null==Y(M,y)&&(s[M][f].push([y.x,y.y]),s[M][f].length==q[n[M].mode]&&(f=null),D())),null!=v&&1==m[M][v].length&&(N||!w?(m[M].splice(v,1),u[M].splice(v,1),v=null,D()):null==Y(M,y)&&(m[M][v].push([y.x,y.y]),D())),J(null==g&&null==f?"move":"pen"),void 0!==i&&i.preventDefault()}if(U=l,null!=M&&null!=b){p=$(n[M].el);y.x>-1&&y.x<n[M].width&&y.y>-1&&y.y<n[M].height?(0==b.mode&&n[M].dotline>1&&(0!=b.subnum&&b.subnum!=a[M][b.num].length-1||Math.pow(a[M][b.num][0][0]-a[M][b.num][a[M][b.num].length-1][0],2)+Math.pow(a[M][b.num][0][1]-a[M][b.num][a[M][b.num].length-1][1],2)<25&&(0==b.subnum?(a[M][b.num][a[M][b.num].length-1][0]=a[M][b.num][0][0],a[M][b.num][a[M][b.num].length-1][1]=a[M][b.num][0][1]):(a[M][b.num][0][0]=a[M][b.num][a[M][b.num].length-1][0],a[M][b.num][0][1]=a[M][b.num][a[M][b.num].length-1][1]),g=null,D())),b=null):(1==c[M]&&(y.y=n[M].imgheight/2),1==b.mode?r[M].splice(b.num,1):2==b.mode?h[M].splice(b.num,1):.5==b.mode?a[M].splice(b.num,1):0==b.mode?a[M][b.num][b.subnum]=T:b.mode>=5&&b.mode<10?(s[M].splice(b.num,1),d[M].splice(b.num,1),f=null):b.mode>=10&&b.mode<11&&(m[M].splice(b.num,1),u[M].splice(b.num,1),v=null),b=null,D())}N=!1,I?B=window.setTimeout(function(){I=!1,ee(),e(document).on("mousemove.imathasdraw",G),e(".drawcanvas").on("touchstart.imathasdraw",function(e){I=!0,F(e)}),e(document).on("mousedown.imathasdraw",F)},350):(ee(),e(document).on("mousemove.imathasdraw",G),e(".drawcanvas").on("touchstart.imathasdraw",function(e){I=!0,F(e)}),e(document).on("mousedown.imathasdraw",F))}var V=-1;function G(l){var d=null;L=!1;var u=Q(l);for(i in n){if(!e(n[i].el).is(":hidden")&&"canvas"==n[i].type)if((p=$(n[i].el)).x<u.x&&p.x+n[i].width>u.x&&p.y<u.y&&p.y+n[i].height>u.y&&l.target==n[i].el){d=i;break}}if(null!=d){if(o[d].disabled)return;V=d;var p=$(n[d].el),y={x:u.x-p.x,y:u.y-p.y};if(n[d].snaptogridx>0&&(y=K(y,d)),1==c[d]&&(y.y=n[d].imgheight/2),y.x>-1&&y.x<n[d].width&&y.y>-1&&y.y<n[d].height)if(null==b)if(null==g)null==(x=Y(d,y))?J("pen",d):-1!=n[d].mode&&J("move",d)}else null!=V&&-1!=V&&(null!=M?D():(M=V,D(),M=null),V=-1);if(null!=M){if(l.originalEvent.touches&&l.originalEvent.touches.length>1)return N=!0,!0;void 0!==l&&l.preventDefault();p=$(n[M].el),y={x:u.x-p.x,y:u.y-p.y};if(n[M].snaptogridx>0&&(y=K(y,M)),1==c[M]&&(y.y=n[M].imgheight/2),y.x>-1&&y.x<n[M].width&&y.y>-1&&y.y<n[M].height){if(null==b){if(t&&-1==n[M].mode)return void(null!=(x=Y(M,y))&&z(x[0],x[1]));if(null!=g)if(!t||0!=n[M].mode&&.7!=n[M].mode)if(t&&.5==n[M].mode){if(0==(w=a[M][g].length-1))Math.pow(a[M][g][w][0]-y.x,2)+Math.pow(a[M][g][w][1]-y.y,2)>25?(a[M][g].push([y.x,y.y]),D()):D(y.x,y.y);else a[M][g][w]=[y.x,y.y],D()}else D(y.x,y.y);else{var w=a[M][g].length-1;Math.pow(a[M][g][w][0]-y.x,2)+Math.pow(a[M][g][w][1]-y.y,2)>25?(a[M][g].push([y.x,y.y]),D()):D(y.x,y.y)}else if(null!=f)t?D():D(y.x,y.y);else if(null!=v)t?D():D(y.x,y.y);else{var x;null==(x=Y(M,y))?(J("pen"),S.hasOwnProperty(n[M].mode)&&null!==d&&D(y.x,y.y)):(D(),-1!=n[M].mode&&J("move"))}}else J("move"),0==b.mode||.5==b.mode?a[M][b.num][b.subnum]=[y.x,y.y]:1==b.mode?r[M][b.num]=[y.x,y.y]:2==b.mode?h[M][b.num]=[y.x,y.y]:b.mode>=5&&b.mode<10?s[M][b.num][b.subnum]=[y.x,y.y]:b.mode>=10&&b.mode<11&&(m[M][b.num][b.subnum]=[y.x,y.y]),D();return!1}null==v||t||D()}else null!=d&&-1!=V&&(M=d,S.hasOwnProperty(n[M].mode)&&D(y.x,y.y),M=null)}function J(e,t){if(n[t=t||M].cursor!=e){var i=P?"png":"svg";"move"==e?n[t].el.style.cursor=e:"pen"==e?n[t].el.style.cursor="url("+staticroot+"/img/penup."+i+") 0 0, auto":"pendown"==e&&(n[t].el.style.cursor="url("+staticroot+"/img/pendown."+i+") 0 20, auto"),n[t].cursor=e}}function Q(e){if(e=e||window.event,I){var t=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0];return{x:t.pageX,y:t.pageY}}if(e.pageX||e.pageY)return{x:e.pageX,y:e.pageY};var n=document.documentElement,i=document.body;if(n&&(n.scrollTop||n.scrollLeft))var l=n.scrollLeft,o=n.scrollTop;else if(i)l=i.scrollLeft,o=i.scrollTop;else l=0,o=0;return{x:e.clientX+l,y:e.clientY+o}}function K(e,t){var i=e.x-n[t].imgborder+n[t].xmin*n[t].pixperx,l=e.y-n[t].imgborder-n[t].ymax*n[t].pixpery;return{x:i=Math.round(Math.round(i/(n[t].pixperx*n[t].snaptogridx))*n[t].pixperx*n[t].snaptogridx+n[t].imgborder-n[t].xmin*n[t].pixperx),y:l=Math.round(Math.round(l/(n[t].pixpery*n[t].snaptogridy))*n[t].pixpery*n[t].snaptogridy+n[t].imgborder+n[t].ymax*n[t].pixpery)}}function Z(e,t){var n=$(e),i=Q(t);return{x:i.x-n.x,y:i.y-n.y}}function $(t){if(t.className.match(/hidden/))return{x:-1e4,y:-1e4};var n=e(t).offset();return{x:n.left,y:n.top}}function ee(){e(document).off("mousedown.imathasdraw").off("mousemove.imathasdraw").off("mouseup.imathasdraw"),e(document).off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw"),e(".drawcanvas").off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw")}function te(t){ee(),e(document).on("mousemove.imathasdraw",G),e(".drawcanvas").on("touchstart.imathasdraw",function(e){I=!0,F(e)}),e(document).on("mousedown.imathasdraw",F);try{CanvasRenderingContext2D.prototype.dashedLine=function(e,t,i,l,o){null==o&&(o=10),t<0&&t!=l?(e-=t*(i-e)/(l-t),t=0):t>n[M].imgheight&&t!=l&&(e+=(n[M].imgheight-t)*(i-e)/(l-t),t=n[M].imgheight),this.beginPath(),this.moveTo(e,t);var a=i-e,r=l-t,h=Math.sqrt(a*a+r*r)/o,s=a/h,d=r/h;h=Math.floor(h);for(var m=0;m++<h&&t>-1&&t<n[M].imgheight+1&&e>-1&&e<n[M].imgwidth+1;)e+=s,t+=d,this[m%2==0?"moveTo":"lineTo"](e,t);this[m%2==0?"moveTo":"lineTo"](i,l),this.stroke(),this.closePath()}}catch(e){}for(var i in canvases)if(void 0===t||t==i){var l=null;if(null!=drawla[i]&&drawla[i].length>2){if(a[canvases[i][0]]=drawla[i][0],r[canvases[i][0]]=drawla[i][1],h[canvases[i][0]]=drawla[i][2],d[canvases[i][0]]=[],s[canvases[i][0]]=[],drawla[i].length>3&&drawla[i][3].length>0)for(var o=0;o<drawla[i][3].length;o++){d[canvases[i][0]][o]=drawla[i][3][o][0],s[canvases[i][0]][o]=[];for(var g=0;g<q[d[canvases[i][0]][o]];g++)s[canvases[i][0]][o].push(drawla[i][3][o].slice(1+2*g,3+2*g))}if(u[canvases[i][0]]=[],m[canvases[i][0]]=[],drawla[i].length>4&&drawla[i][4].length>0)for(o=0;o<drawla[i][4].length;o++)u[canvases[i][0]][o]=drawla[i][4][o][0],m[canvases[i][0]][o]=[drawla[i][4][o].slice(1,3),drawla[i][4][o].slice(3,5),drawla[i][4][o].slice(5)];drawla[i].length>5&&(l=drawla[i][5])}else null!=drawla[i]&&"[[]]"==JSON.stringify(drawla[i])&&k(canvases[i][0],!0);var p="";canvases[i][1].match(/initPicture/)?p=canvases[i][1]:""!==canvases[i][1]&&(p=imasroot+"/filter/graph/imgs/"+canvases[i][1]),""!==canvases[i][13]?A(canvases[i],l,p):R(canvases[i][0],"canvas"+canvases[i][0],p,"qn"+canvases[i][0],canvases[i][2],canvases[i][3],canvases[i][4],canvases[i][5],canvases[i][6],canvases[i][7],canvases[i][8],canvases[i][9],canvases[i][10],canvases[i][11],canvases[i][12])}}"undefined"!=typeof initstack?initstack.push(te):e(function(){te()});var ne={idnums:[],curslider:{el:null,startpos:[0,0],outnode:null}};function ie(t){for(var n,i=0;i<ne.idnums.length;i++)void 0!==t&&t!=ne.idnums[i]||(le(n=ne.idnums[i]),e("#slid1"+n).on("touchstart.normslider mousedown.normslider",oe),e("#slid2"+n).on("touchstart.normslider mousedown.normslider",oe))}function le(e){var t,n,i,l,o=document.getElementById("qn"+e).value;(l=o.match(/\(-oo,([\-\d\.]+)\)U\(([\-\d\.]+),oo\)/))?(t=3,n=l[1],i=l[2]):(l=o.match(/\(-oo,([\-\d\.]+)\)/))?(t=0,n=l[1],i=2.5):(l=o.match(/\(([\-\d\.]+),oo\)/))?(t=1,n=l[1],i=2.5):(l=o.match(/\(([\-\d\.]+),([\-\d\.]+)\)/))?(t=2,n=l[1],i=l[2]):(t=0,n=-1.5,i=2.5),document.getElementById("slid1"+e).style.left=60*n+250-6+"px",document.getElementById("slid2"+e).style.left=60*i+250-6+"px",document.getElementById("shaderegions"+e).selectedIndex=t,ne.curslider.type=document.getElementById("shaderegions"+e).value,se(e)}function oe(t){(t=t||window.event).originalEvent.touches&&t.originalEvent.touches.length>0?(I=!0,e(document).on("touchmove.normslider",ae),e(document).on("touchend.normslider",re)):(e(document).on("mousemove.normslider",ae),e(document).on("mouseup.normslider",re)),ne.curslider.el=t.target||t.srcElement,ne.curslider.id=ne.curslider.el.id.substring(5),ne.curslider.type=document.getElementById("shaderegions"+ne.curslider.id).value,ne.curslider.outnode=document.getElementById(ne.outputid),ne.curslider.startpos=Z(ne.curslider.el,t),ne.curslider.el.parentNode.style.cursor="pointer";$(ne.curslider.el.parentNode);return t.preventDefault&&t.preventDefault(),!1}function ae(e){var t=ne.curslider.id;e=e||window.event;var n=Z(ne.curslider.el.parentNode,e);if(!(n.x<5||n.x>ne.curslider.el.parentNode.offsetWidth-5||n.y<5||n.y>ne.curslider.el.parentNode.offsetHeight-5)){var i=6*Math.round((n.x-ne.curslider.startpos.x-10)/6)+10;return ne.curslider.el.style.left=i+"px",he(t),e.preventDefault&&e.preventDefault(),!1}}function re(t){null!==ne.curslider.el&&(I=!1,e(document).off("touchmove.normslider touchend.normslider"),e(document).off("mousemove.normslider mouseup.normslider"),ne.curslider.el.parentNode.style.cursor="",ne.curslider.el=null)}function he(t){var n=parseInt(document.getElementById("slid1"+t).style.left)+6,i=parseInt(document.getElementById("slid2"+t).style.left)+6,l=Math.min(n,i),o=Math.max(n,i);"2O"==ne.curslider.type?document.getElementById("normleft"+t).style.width=l+1+"px":"1L"==ne.curslider.type?document.getElementById("normleft"+t).style.width=n+1+"px":"2B"==ne.curslider.type&&(document.getElementById("normleft"+t).style.left=l+"px",document.getElementById("normleft"+t).style.width=o-l+1+"px"),"2O"==ne.curslider.type?document.getElementById("normright"+t).style.width=500-o+"px":"1R"==ne.curslider.type&&(document.getElementById("normright"+t).style.width=500-n+"px");var a=((n-10)/60-4).toFixed(1),r=((i-10)/60-4).toFixed(1),h=document.getElementById("slid1txt"+t);h.innerHTML=a,h.style.left=n-6+"px";var s=document.getElementById("slid2txt"+t);s.innerHTML=r,s.style.left=i-6+"px";var d=Math.min(a,r),m=Math.max(a,r);if("2O"==ne.curslider.type)var u="(-oo,"+d+")U("+m+",oo)";else if("2B"==ne.curslider.type)u="("+d+","+m+")";else if("1L"==ne.curslider.type)u="(-oo,"+a+")";else if("1R"==ne.curslider.type)u="("+a+",oo)";document.getElementById("qn"+t).value=u,e("#qn"+t).trigger("input").trigger("change")}function se(e){var t=document.getElementById("shaderegions"+e).value;ne.curslider.type=t;var n=parseInt(document.getElementById("slid1"+e).style.left)+6,i=parseInt(document.getElementById("slid2"+e).style.left)+6,l=Math.min(n,i),o=Math.max(n,i);"1R"==t||"1L"==t?(document.getElementById("slid2"+e).style.display="none",document.getElementById("slid2txt"+e).style.display="none","1R"==t?(document.getElementById("normleft"+e).style.display="none",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normright"+e).style.width=500-n+"px"):(document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.display="",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normleft"+e).style.width=n+"px")):"2O"==t?(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normright"+e).style.width=500-o+"px",document.getElementById("normleft"+e).style.width=l+"px"):"2B"==t&&(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.left=l+"px",document.getElementById("normleft"+e).style.width=o-l+"px"),he(e)}function de(e,t,n,i,l,o,a){if(l==n)e.moveTo(0,l),e.dashedLine(0,l,o,l);else{var r=(l-n)/((i-t)*(i-t)),h=-2*r*t,s=0;l>n&&(s=a);var d=r*t*t+n-s,m=Math.sqrt(h*h-4*r*d),u=(-h-m)/(2*r),g=(-h+m)/(2*r);d+=s;if(g<u){var p=u;u=g,g=p}for(var c=t,f=n,v=0;c>u-5&&c>-5;)v%2==0?e.moveTo(c,f):e.lineTo(c,f),f=r*(c-=Math.min(Math.sqrt(64/(1+Math.pow(2*r*(c-t),2))),Math.sqrt(8/Math.abs(r))))*c+h*c+d,v++;for(c=t,f=n,v=0;c<g+5&&c<o+5;)v%2==0?e.moveTo(c,f):e.lineTo(c,f),f=r*(c+=Math.min(Math.sqrt(64/(1+Math.pow(2*r*(c-t),2))),Math.sqrt(8/Math.abs(r))))*c+h*c+d,v++}e.stroke()}function me(e,t,n,i,l,o,a,r,h){if(e.beginPath(),l==n)e.moveTo(0,l),e.lineTo(r,l),a<n?(e.lineTo(r,0),e.lineTo(0,0)):(e.lineTo(r,h),e.lineTo(0,h));else{var s=(l-n)/((i-t)*(i-t)),d=-2*s*t,m=0;l>n&&(m=h);var u=s*t*t+n-m,g=Math.sqrt(d*d-4*s*u),p=(-d-g)/(2*s),c=s*p*p+d*p+(u+=m),f=(-d+g)/(2*s),v=c;if(f<p){var y=p;p=f,f=y}var w=2*s*(p-t),x=c-w*p,b=-w,T=(x-(v-b*f))/(b-w),M=w*T+x;if(s<0&&a<s*o*o+d*o+u||s>0&&a>s*o*o+d*o+u)e.moveTo(p,c),e.quadraticCurveTo(T,M,f,v);else{var E=h;Math.abs(c-h)<2&&(E=0),e.moveTo(0,c),e.lineTo(p,c),e.quadraticCurveTo(T,M,f,v),e.lineTo(r,v),e.lineTo(r,E),e.lineTo(0,E)}}e.closePath()}return"undefined"!=typeof initstack&&initstack.push(ie),{reset:function(){ee(),n.length=0,l.length=0,o.length=0,a.length=0,r.length=0,h.length=0,s.length=0,d.length=0,m.length=0,u.length=0,p.length=0,c.length=0,M=null,g=null,b=null,f=null,v=null},initCanvases:te,clearcanvas:k,clearlastline:function(e){a[e].length>0&&(a[e].length=a[e].length-1),M=e,D(),M=null,g=null,b=null},settool:function(e,t,i){for(var l=document.getElementById("drawtools"+t),o=l.getElementsByTagName("span"),a=0;a<o.length;a++)o[a].className="";for(o=l.getElementsByTagName("img"),a=0;a<o.length;a++)o[a].className="";e.className="sel",function(e,t){n[e].mode=t}(t,i),M=t,D()},addnormslider:function(e,t){-1==arraysearch(e,ne.idnums)?(ne.idnums.push(e),!0===t&&ie(e)):ie(e)},chgnormtype:se,adda11ydraw:C,changea11ydraw:function(t,i){var l=e(t).val(),o=n[i].moderef[l];e(t).closest("li").find(".a11ydrawinstr").text(o.input),O()},encodea11ydraw:O,updatea11ydraw:function(t){var i,l=parseInt(e(t).closest(".a11ydraw").attr("id").substring(8)),o=0,a=t.value.trim();if(n[l].isnumberline)i=a.split(/\s*,\s*/);else{"("==a.charAt(0)&&")"==a.slice(-1)||(o|=1),i=a.slice(1,-1).split(/\)\s*,\s*\(/);for(var r=0;r<i.length;r++){var h=i[r].split(/,/);2!=h.length&&(o|=1);for(var s=0;s<h.length;s++)0==h[s].trim().length&&(o|=1)}}var d=t.getAttribute("data-n");if(d.match(/\d/)&&i.length!=parseInt(d)&&(o|=2),"noticetext"==t.parentNode.parentNode.lastChild.className&&t.parentNode.parentNode.removeChild(t.parentNode.parentNode.lastChild),o){t.setAttribute("aria-invalid",!0);var m=document.createElement("span");m.id=uniqid("a11ydrawerr"),m.className="noticetext",1&~o?(m.innerHTML="<br>"+_("Error: Incorrect number of points. Expecting ")+d,setariastatus(_("Error: Incorrect number of points"))):(m.innerHTML="<br>"+_("Error: Invalid format for points. Give points as open parenthesis number comma number close parenthesis. Separate points with a comma."),setariastatus(_("Error: Invalid format for points"))),t.parentNode.parentNode.appendChild(m),t.setAttribute("aria-describedby",m.id)}else t.removeAttribute("aria-invalid"),t.removeAttribute("aria-describedby"),setariastatus("");O(l)},removea11ydraw:function(t){setariastatus(_("Removed drawing element"));var n=e(t).closest("ul");e(t).parent().remove(),n.find("li").each(function(t,n){var i=_("Drawing element ")+(t+1);e(n).find(".draweln").html(i)}),n.prev().focus(),O(n.attr("id").substring(8))}}}(jQuery);!function(){"use strict";function e(e,t){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i}function t(e,t,n){var i=t[0],l=t[1],o=n[0]-i,a=n[1]-l;if(0!==o||0!==a){var r=((e[0]-i)*o+(e[1]-l)*a)/(o*o+a*a);r>1?(i=n[0],l=n[1]):r>0&&(i+=o*r,l+=a*r)}return(o=e[0]-i)*o+(a=e[1]-l)*a}function n(e,i,l,o,a){for(var r,h=o,s=i+1;s<l;s++){var d=t(e[s],e[i],e[l]);d>h&&(r=s,h=d)}h>o&&(r-i>1&&n(e,i,r,o,a),a.push(e[r]),l-r>1&&n(e,r,l,o,a))}function i(e,t){var i=e.length-1,l=[e[0]];return n(e,0,i,t,l),l.push(e[i]),l}window.pathsimplify=function(t,n,l){if(t.length<=2)return t;var o=void 0!==n?n*n:1;return t=i(t=l?t:function(t,n){for(var i,l=t[0],o=[l],a=1,r=t.length;a<r;a++)e(i=t[a],l)>n&&(o.push(i),l=i);return l!==i&&o.push(i),o}(t,o),o)}}();var initstack=[],loadedscripts=[],scriptqueue=[],processingscriptsqueue=!1,callbackstack={};"undefined"==typeof commasep&&(commasep=!0);var imathasAssess=function(e){var t={},a={};function r(e,a){var r=a.substr(2).split(/-/)[0],i=t[r].qtype;("numfunc"===i||"calcinterval"===i&&-1!=t[r].calcformat.indexOf("inequality"))&&(e=T(r,e)[1]);var n=!(i.match(/matrix/)||"string"===i);return AMtoMQ(e,a,n)}function n(e,t){return e=(e=MQtoAM(e)).replace(/\(text\((.*?)\)\)/g,"($1)").replace(/text\((.*?)\)/g," $1 ")}function s(){if(processingscriptsqueue=!0,0!=scriptqueue.length){var e=scriptqueue.shift();if("code"==e[0]){try{window.eval(e[1])}catch(t){console.log("Error executing question script:"+e[1])}l()}else jQuery.getScript(e[1]).always(function(){l()})}}function l(){for(var e=0;e<initstack.length;e++)initstack[e]();initstack.length=0,0==scriptqueue.length?processingscriptsqueue=!1:s()}function o(t,a,r){var i=document.getElementById(t);if(i){i.setAttribute("data-tip",a);var n=t.substr(2).split(/-/)[0];document.getElementById("tips"+n)||e("body").append(e("<div>",{class:"hidden",id:"tips"+n}).html(r)),i.setAttribute("aria-describedby","tips"+n),e("#mqinput-"+t).find(".mq-textarea > [tabindex=0]").attr("aria-describedby","tips"+n),i.addEventListener("focus",function(){showehdd(t,a,n)}),i.addEventListener("blur",hideeh),i.addEventListener("click",function(){reshrinkeh(t)})}}function c(t){var a,r=t.currentTarget;if(null!==(a=r.className.match(/(ansgrn|ansred|ansyel|ansorg)/)))e(r).removeClass(a[0]),e(r).nextAll(".scoremarker.sr-only").first().remove(),"ansorg"==a[0]&&e(r).nextAll(".scoremarker").first().remove(),"select"==r.tagName.toLowerCase()&&e(r).nextAll("svg.scoremarker").first().remove(),"hidden"==r.type&&e("#mqinput-"+r.id).removeClass(a[0]);else{var i=e(r).closest("[id^=qnwrap]");i.length>0&&null!==(a=i[0].className.match(/(ansgrn|ansred|ansyel|ansorg)/))&&(i.removeClass(a[0]),i.find(".scoremarker").remove())}}function u(t){e("input[type=text][name=qn"+t+"]").off("keydown.enterhandler").on("keydown.enterhandler",function(t){if(13==t.which){var a=e(this).closest(".questionwrap").find(".submitbtnwrap .primary");a.length>0&&t.preventDefault(),a.is(":disabled")||a.trigger("click")}})}function d(a){var r,i=document.getElementById("qn"+a).value.split(";;"),n=[];for(r=0;r<i.length;r++)if(5==r?i[r]="["+i[r].replace(/&quot;/g,'"')+"]":(i[r]="["+i[r].replace(/\(/g,"[").replace(/\)/g,"]")+"]",0==r&&i[r].length>2&&(i[r]="["+i[r].replace(/;/g,"],[")+"]")),""===i[r])n[r]=[];else try{n[r]=JSON.parse(i[r])}catch(e){n[r]=[]}window.drawla[a]=n,window.canvases[a]=t[a].canvas,imathasDraw.initCanvases(a);var s=document.getElementById("drawtools"+a);s&&s.addEventListener("click",function(e){var t=e.target;if(t.hasAttribute("data-drawaction")){var a=t.getAttribute("data-drawaction"),r=t.getAttribute("data-qn");if("clearcanvas"===a)imathasDraw.clearcanvas(r);else if("settool"===a){var i=t.getAttribute("data-val");imathasDraw.settool(t,r,i)}}}),e("#qn"+a).parent().find(".a11ydrawadd:not(.inited)").off("click.adda11ydraw").on("click.adda11ydraw",function(t){var a=t.target.getAttribute("data-qn");e(t.target).addClass("inited"),imathasDraw.adda11ydraw(a)})}function p(t){if("hasnone"==e("#qnwrap"+t).attr("data-multans")){var a=e('input[name^="qn'+t+'["]');a.on("change",function(){this.checked&&this.value==a.length-1?a.not(":last").prop("checked",!1):this.checked&&a.last().prop("checked",!1)})}}function h(e){if("undefined"!=typeof Kekule){if(a[e]=new Kekule.Editor.Composer(document.getElementById("chemdraw"+e)),a[e].setEnableOperHistory(!0).setEnableLoadNewFile(!1).setEnableCreateNewDoc(!1).setAllowCreateNewChild(!1).setCommonToolButtons(["undo","redo","copy","cut","paste","zoomIn","reset","zoomOut"]).setChemToolButtons(["manipulate","erase","bond","atomAndFormula","ring","charge"]).setStyleToolComponentNames([]),"condensed"===t[e].displayformat){var r=new Kekule.Render.Render2DConfigs;r.getMoleculeDisplayConfigs().setDefMoleculeDisplayType(Kekule.Render.MoleculeDisplayType.CONDENSED),a[e].setRenderConfigs(r)}a[e].getEditor().on("editObjsUpdated",function(t){R(e)}),t[e].chemla&&(a[e].setChemObj(Kekule.IO.loadFormatData(t[e].chemla,"cml")),window.setTimeout(function(){let t=a[e].getEditor();t.scrollClientToObject(t.getChemObj().getChildren())},100));var i=document.getElementById("chemsa"+e);if(i){var n=new Kekule.ChemWidget.Viewer(i,null,Kekule.Render.RendererType.R2D);n.setEnableToolbar(!1).setPadding(20).setChemObj(Kekule.IO.loadFormatData(i.getAttribute("data-cmldata"),"cml")),"condensed"===t[e].displayformat&&n.setMoleculeDisplayType(Kekule.Render.Molecule2DDisplayType.CONDENSED)}}else{var s=e;setTimeout(function(){h(s)}.bind(this),100)}}function g(e){return!e||0===e.length||/^\s*$/.test(e)}function m(t){var a=t.target,r=e(a).closest("tr").find("input").first();if(!g(a.value)&&r.hasClass("iscredit")){r.css("padding-left");r.is("select")?r.css("margin-right",20):r.width(""),r.css("padding-left",""),r.removeClass("iscredit")}}function f(t){var a=t.target,r=e(a).closest("tr").find("input").first();if(!g(a.value)&&!r.hasClass("iscredit")){var i=parseInt(r.css("padding-left"));r.is("select")?r.css("margin-right",0):r.width(r.width()-20),r.css("padding-left",20+i),r.addClass("iscredit")}}function v(){e(".creditbox").each(function(e,t){f({target:t})})}var b=[];function y(a,r){if("MathJax"!=mathRenderer||window.MathJax&&(window.MathJax.Hub||window.MathJax.typesetPromise))b.hasOwnProperty(a)||("MathJax"==mathRenderer||"Katex"==mathRenderer?(b[a]={delay:"MathJax"==mathRenderer?100:0,finaldelay:1e3,preview:null,buffer:null,timeout:null,finaltimeout:null,mjRunning:!1,mjPending:!1,oldText:null,mjPromise:null,Init:function(t){e("#p"+a).css("positive","relative").append('<span id="lpbuf1'+a+'" style="visibility:hidden;position:absolute;"></span>').append('<span id="lpbuf2'+a+'" style="visibility:hidden;position:absolute;"></span>'),this.preview=document.getElementById("lpbuf1"+a),this.buffer=document.getElementById("lpbuf2"+a),"MathJax"==mathRenderer&&MathJax.typesetPromise&&(this.mjPromise=Promise.resolve()),t||k(a)},SwapBuffers:function(){var e=this.preview,t=this.buffer;this.buffer=e,this.preview=t,e.style.visibility="hidden",e.style.position="absolute",t.style.position="",t.style.visibility=""},Update:function(e){this.timeout&&clearTimeout(this.timeout),this.finaltimeout&&clearTimeout(this.finaltimeout),this.timeout=setTimeout(this.callback,this.delay),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(e,t){this.oldtext=e,this.buffer.innerHTML=t?e:this.preformat(e),this.mjRunning=!0,this.RenderBuffer()},RenderBuffer:function(){"MathJax"==mathRenderer?MathJax.typesetPromise&&this.mjPromise?this.mjPromise=this.mjPromise.then(function(){MathJax.typesetPromise([this.buffer]).then(this.PreviewDone.bind(this))}.bind(this)):2===parseInt(MathJax.version)&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.buffer],["PreviewDone",this]):"Katex"==mathRenderer&&(renderMathInElement(this.buffer),"undefined"!=typeof MathJax&&MathJax.Hub&&!MathJax.typesetPromise&&e(this.buffer).children(".mj").length>0?MathJax.Hub.Queue(["PreviewDone",this]):this.PreviewDone())},DoFinalPreview:function(){e("#pbtn"+a).trigger("click")},preformat:function(e){var r=t[a].qtype,i=t[a].calcformat;return I(a,e,r,i)},CreatePreview:function(){if(this.timeout=null,!this.mjPending){var e=document.getElementById("qn"+a).value;e!==this.oldtext&&(this.mjRunning?(this.mjPending=!0,this.mjPromise?this.mjPromise=this.mjPromise.then(this.CreatePreview().bind(this)):MathJax.Hub&&2===parseInt(MathJax.version)&&MathJax.Hub.Queue(["CreatePreview",this])):(this.oldtext=e,this.buffer.innerHTML="`"+q(this.preformat(e))+"`",this.mjRunning=!0,this.RenderBuffer()))}},PreviewDone:function(){this.mjRunning=this.mjPending=!1,this.SwapBuffers(),updateehpos()}},"undefined"==typeof MathJax||MathJax.typesetPromise?b[a].callback=function(){b[a].CreatePreview()}:(b[a].callback=MathJax.Callback(["CreatePreview",b[a]]),b[a].callback.autoReset=!0),b[a].Init(r)):b[a]={finaldelay:1e3,finaltimeout:null,Update:function(e){this.finaltimeout&&clearTimeout(this.finaltimeout),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(e){var t=document.getElementById("p"+a);t.innerHTML=q(e),rendermathnode(t)},DoFinalPreview:function(){e("#pbtn"+a).trigger("click")}});else{var i=a,n=r;setTimeout(100,function(){y(i,n)})}}function x(e){var t=e.target.id.substr(2);y(t),b[t].Update()}function w(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/[\x00-\x09\x0B\x0C\x0E-\x1F\x7F]/g,"")).replace(/\u2013|\u2014|\u2015|\u2212/g,"-")).replace(/\u2044|\u2215/g,"/")).replace(//g,"oo").replace(//g,"<=").replace(//g,">=").replace(//g,"U")).replace(//g,"+-").replace(//g,"/").replace(/|||/g,"*")).replace(//g,"sqrt").replace(//g,"root(3)")).replace(//g,"^0").replace(//g,"^1").replace(//g,"^2").replace(//g,"^3").replace(//g,"^4").replace(//g,"^5").replace(//g,"^6").replace(//g,"^7").replace(//g,"^8").replace(//g,"^9")).replace(/\u2329/g,"<").replace(/\u232a/g,">")).replace(//g,"_0").replace(//g,"_1").replace(//g,"_2").replace(//g,"_3")).replace(/\b(OO|infty)\b/gi,"oo").replace(//g,"degree")).replace(//g,"theta").replace(//g,"phi").replace(//g,"phi").replace(//g,"pi").replace(//g,"sigma").replace(//g,"mu")).replace(//g,"alpha").replace(//g,"beta").replace(//g,"gamma").replace(//g,"delta").replace(//g,"epsilon").replace(//g,"kappa")).replace(//g,"lambda").replace(//g,"rho").replace(//g,"tau").replace(//g,"chi").replace(//g,"omega")).replace(//g,"Omega").replace(//g,"Gamma").replace(//g,"Phi").replace(//g,"Delta").replace(//g,"Sigma")).replace(/&(ZeroWidthSpace|nbsp);/g," ").replace(/\u200B/g," ")).replace(/degree\s+s\b/g,"degree")).replace(/\(\((-?\d+)\)\)/g,"($1)")}function q(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;")}function k(e){var a=t[e],r="",i=C(e);if(i.str&&(r+="`"+q(i.str)+"`"),i.dispvalstr&&""!=i.dispvalstr&&-1!=a.calcformat.indexOf("showval")&&(r+=(""==r?"":" &asymp; ")+"`"+q(i.dispvalstr)+"`"),i.err&&""!=i.err&&""!=i.str&&(r+="``"==r?"":". <span class=noticetext>"+i.err+"</span>"),b.hasOwnProperty(e))b[e].RenderNow(r,!0);else{var n=document.getElementById("p"+e);n.innerHTML=r,rendermathnode(n)}$(r)}function $(t){var a=e("<div>",{class:"inactive"}).html(t).appendTo("body")[0];rendermathnode(a,function(){var t=document.getElementById("arialive");t.innerHTML="",a.className="",e(a).find("[aria-label]").each(function(t,a){e(a).html(e(a).attr("aria-label"))}),t.appendChild(a)})}var E=null;function A(e,t){clearTimeout(E);var a=parseInt(e.replace(/.*qn(\d+)\b.*/g,"$1"));E=setTimeout(function(){M(a)},1e3)}function M(e){var a=t[e],r=C(e),i="",n=" ";if(r.dispvalstr&&""!=r.dispvalstr&&"NaN"!=r.dispvalstr&&a.calcformat&&-1!=a.calcformat.indexOf("showval")&&(i+="`"+q(r.str)+"`","calcmatrix"==a.qtype||"calccomplexmatrix"==a.qtype||"calcinterval"==a.qtype&&a.calcformat.match(/inequality/)?i+=" &asymp; `"+q(r.dispvalstr)+"` ":i+=" &asymp; "+q(r.dispvalstr)+" "),r.err&&""!=r.err&&""!=r.str&&(i+="<span class=noticetext>"+r.err+"</span>",n+=r.err),!b.hasOwnProperty(e)||"MathJax"!=mathRenderer&&"Katex"!=mathRenderer){var s=document.getElementById("p"+e);s&&(s.innerHTML=i,rendermathnode(s))}else b[e].RenderNow(i,!0);if(document.getElementById("qn"+e)){var l=MathQuill.getInterface(MathQuill.getInterface.MAX),o=document.getElementById("mqinput-qn"+e);if(-1==o.className.indexOf("disabled"))l.MathField(o).setAriaPostLabel(n,5)}else $(i)}function O(e){var t=C(e);return!!t.submitstr&&t.submitstr}function C(e){if(!t.hasOwnProperty(e))return!1;var a=t[e],r={};if("draw"==a.qtype)return imathasDraw.encodea11ydraw(),{};if("choices"==a.qtype||"multans"==a.qtype||"matching"==a.qtype)return{};if(a.hasOwnProperty("matrixsize"))r=function(e){var a=t[e],r=a.matrixsize,i="";a.calcformat&&(i=a.calcformat);for(var n,s,l=[],o=[],c=[],u=0,d="",p=0;p<r[0];p++){l[p]=[],o[p]=[];for(var h=0;h<r[1];h++)n=w(n=document.getElementById("qn"+e+"-"+u).value),a.qtype.match(/complex/)?(d+=(s=z(n,i)).err,o[p][h]=s.outstrdisp,s.outstr&&c.push(s.outstr)):"algmatrix"===a.qtype?d+=(s=N(e,n,i)).err:(""!==n&&(d+=Q(n,i),d+=K(n,i)),l[p][h]=n,d+=(s=F(n,i))[1],o[p][h]=s[0],c.push(s[0])),u++;l[p]="("+l[p].join(",")+")",o[p]="("+P(o[p]).join(",")+")"}return{err:d,str:"["+l.join(",")+"]",dispvalstr:a.qtype.match(/calc/)?"["+o.join(",")+"]":"",submitstr:c.join("|")}}(e);else{if("molecule"==a.qtype)return R(e),{};var n=document.getElementById("qn"+e);if(!n)return!1;var s=n.value;if((s=(s=w(s)).replace(/^\s+/,"").replace(/\s+$/,"")).match(/^\s*$/))return{str:"",displvalstr:"",submitstr:""};if(s.match(/^\s*DNE\s*$/i))return{str:"DNE",displvalstr:"",submitstr:"DNE"};if(s.match(/^\s*oo\s*$/i))return{str:"oo",displvalstr:"",submitstr:"oo"};if(s.match(/^\s*\+oo\s*$/i))return{str:"+oo",displvalstr:"",submitstr:"+oo"};if(s.match(/^\s*-oo\s*$/i))return{str:"-oo",displvalstr:"",submitstr:"-oo"};switch(a.qtype){case"number":r=function(e,t){var a,r="";e=e.replace(/^\s+|\s+$/g,""),-1!==t.indexOf("set")&&("{"!==e.charAt(0)||"}"!==e.substr(-1)?r+=_("Invalid set notation"):e=e.slice(1,-1));if(-1!==t.indexOf("list")||-1!==t.indexOf("set"))var i=e.split(/\s*,\s*/);else{!commasep&&e.match(/,/)&&(r+=_("Invalid use of a comma."));i=[e.replace(/,/g,"")]}for(var n=0;n<i.length;n++)if(a=i[n],-1!=t.indexOf("units")){_("Units must be given as [decimal number]*[unit]^[power]*[unit]^[power].../[unit]^[power]*[unit]^[power]...");if(a.match(/^\s*(-?\s*\d+\.?\d*|-?\s*\.\d+|-?\s*\d\.?\d*\s*(E|\*\s*10\s*\^)\s*[\-\+]?\d+)/)||(r+=_("Answer must start with a number. ")),a.match(/\b(sq|square|cu|cubic|squared|cubed)\s*\^\s*[\-\+]?\s*\d+/)&&(r+=_("Invalid base for exponent. "),a=a.replace(/\^/,"")),a.match(/\b(sq|square|cu|cubic)\s+per\b/)&&(r+=_('Missing unit before "per". '),a=a.replace(/per\b/,"")),a.match(/\bper\s+(squared|cubed)/)&&(r+=_('Missing unit after "per". '),a=a.replace(/\bper/,"")),(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=a.replace(/([a-zA-Z]\w*\s*)(\^\s*[\-\+]?\s*\d+\s*)(?:squared|cubed)\b/g,"$1")).replace(/(?:sq|square|cu|cubic)\s+([a-zA-Z]\w*)/g,"$1")).replace(/([a-zA-Z]\w*)\s+(?:squared|cubed)/g,"$1")).replace(/\sper\s/g,"/")).replace(/^\s*(-?\s*\d\.?\d*\s*(E|\*\s*10\s*\^)\s*[\-\+]?\d+|-?\s*\d+\.?\d*|-?\s*\.\d+)\s*[\-\*]?\s*/,"")).replace(/\s*\-\s*([a-zA-Z])/g,"*$1")).replace(/\*\*/g,"^")).replace(/\s*(\/|\^|\-)\s*/g,"$1")).replace(/\(\s*(.*?)\s*\)\s*\//,"$1/").replace(/\/\s*\(\s*(.*?)\s*\)/,"/$1")).replace(/\s*[\*\s]\s*/g,"*")).replace(/([a-zA-Z]\w*)\^[\-\+]?\d+/g,"$1")).match(/\^/)&&(r+=_("Invalid exponents. "),a=a.replace(/\^/g,"")),(a.match(/\//g)||[]).length>1&&(r+=_("Only one division symbol allowed in the units. ")),(a=a.replace(/\//g,"*").replace(/^\s*\*/,"").trim()).length>0)for(var s="(yotta|zetta|exa|peta|tera|giga|mega|kilo|hecto|deka|deca|deci|centi|milli|micro|nano|pico|fempto|atto|zepto|yocto)",l="(Y|Z|E|P|T|G|M|k|h|da|d|c|m|u|n|p|f|a|z|y)",o=/^(m|meter|metre|micron|angstrom|fermi|in|inch|inches|ft|foot|feet|mi|mile|furlong|yd|yard|s|sec|second|min|minute|h|hr|hour|day|week|mo|month|yr|year|fortnight|acre|ha|hectare|b|barn|L|liter|litre|cc|gal|gallon|cup|pt|pint|qt|quart|tbsp|tablespoon|tsp|teaspoon|rad|radian|deg|degree|arcminute|arcsecond|grad|gradian|knot|kt|c|mph|kph|g|gram|gramme|t|tonne|Hz|hertz|rev|revolution|cycle|N|newton|kip|dyn|dyne|lb|pound|lbf|ton|J|joule|erg|lbft|ftlb|cal|calorie|eV|electronvolt|Wh|Btu|therm|W|watt|hp|horsepower|Pa|pascal|atm|atmosphere|bar|Torr|mmHg|umHg|cmWater|psi|ksi|Mpsi|C|coulomb|V|volt|farad|F|ohm|amp|ampere|A|T|tesla|G|gauss|Wb|weber|H|henry|lm|lumen|lx|lux|amu|dalton|Da|me|mol|mole|Ci|curie|R|roentgen|sr|steradian|Bq|becquerel|ls|lightsecond|ly|lightyear|AU|au|parsec|pc|solarmass|solarradius|degF|degC|degK|K)$/,c="(inch|inches|lbft|ftlb|solarmass|solarradius)",u="(L|Hz|Btu)",d="(fermi|foot|feet|sec|hertz|horsepower|Torr|gauss|lux)",p="(micron|mile|furlong|yard|minute|hour|day|week|month|year|fortnight|acre|hectare|gallon|cup|pint|quart|tablespoon|teaspoon|radian|degree|gradian|knot|revolution|cycle|kip|lb|therm|atmosphere|roentgen)",h="(meter|metre|angstrom|second|barn|liter|litre|arcminute|arcsecond|gram|gramme|tonne|newton|dyne|pound|ton|joule|erg|calorie|electronvolt|watt|pascal|coulomb|volt|farad|ohm|amp|ampere|tesla|weber|henry|lumen|dalton|mole|curie|steradian|becquerel|lightsecond|lightyear|parsec)",g=new RegExp("^"+l+"?"+"(m|ft|s|b|cc|g|t|N|dyn|J|cal|eV|Wh|W|hp|Pa|C|V|F|A|T|G|Wb|H|lm|lx|Da|mol|M|Ci|sr|Bq|ls|ly|pc)"+"$"),m=new RegExp("^"+c+"$","i"),f=new RegExp("^"+l+"?"+u+"$","i"),v=new RegExp("^"+s+"?"+d+"$","i"),b=new RegExp("^"+p+"s?$","i"),y=new RegExp("^"+s+"?"+h+"s?$","i"),x=a.split(/\s*\*\s*/),w=0;w<x.length;w++){unitsregexmatch=x[w].match(f);let e=!1;if(unitsregexmatch&&void 0!==unitsregexmatch[1])new RegExp("^"+l+"$").test(unitsregexmatch[1])||(e=!0);(o.test(x[w])||g.test(x[w])||m.test(x[w])||f.test(x[w])||v.test(x[w])||b.test(x[w])||y.test(x[w]))&&!e||(r+=_("Unknown unit ")+'"'+x[w]+'". ')}else r+=_("Missing units")}else-1!=t.indexOf("integer")?a.match(/^\s*\-?\d+\s*$/)||(r+=_("This is not an integer.")):a.match(/^\s*(\+|\-)?(\d+\.?\d*|\.\d+|\d*\.?\d*\s*E\s*[\-\+]?\d+)\s*$/)||(r+=_("This is not a decimal or integer value."));return{err:r,dispvalstr:e}}(s,a.calcformat);break;case"calculated":r=B(s,a.calcformat);break;case"interval":case"calcinterval":r=function(e,t,a){if(e=e.replace(/cup/g,"U"),-1!=t.indexOf("inequality")){var r=H(e=e.replace(/or/g," or "),a);if(r.length>1)return{err:"wrongvar"==r[1]?_("you may have used the wrong variable"):_("invalid inequality notation")};e=r[0]}var n=[],s=[],l=[],o="U";if(-1!=t.indexOf("list")){e=e.replace(/\s*,\s*/g,",").replace(/(^,|,$)/g,""),o=",";for(var c=0,u=1;u<e.length-1;u++)","==e.charAt(u)&&(")"!=e.charAt(u-1)&&"]"!=e.charAt(u-1)||"("!=e.charAt(u+1)&&"["!=e.charAt(u+1)||(n.push(e.substring(c,u)),c=u+1));n.push(e.substring(c))}else n=e.split(/\s*U\s*/i);var d,p,h,g="",m=[],f=[];for(i=0;i<n.length;i++){if(d=n[i],sm=d.charAt(0),em=d.charAt(d.length-1),2!=(p=(p=d.substring(1,d.length-1)).split(/,/)).length||"("!=sm&&"["!=sm||")"!=em&&"]"!=em){-1!=t.indexOf("inequality")?g+=_("invalid inequality notation")+". ":g+=_("invalid interval notation")+". ";break}for(j=0;j<2;j++)-1!=t.indexOf("decimal")&&p[j].match(/[\d\.]e\-?\d/)&&(p[j]=p[j].replace(/e/,"E")),g+=K(p[j],t),g+=Q(p[j],t),p[j].match(/^\s*\-?\+?oo\s*$/)?m[j]=p[j]:(g+=(h=F(p[j],t))[1],m[j]=h[0]);f=P(m),s[i]=sm+m[0]+","+m[1]+em,-1!=t.indexOf("inequality")?m[0].toString().match(/oo/)?m[1].toString().match(/oo/)?l[i]="RR":l[i]=a+("]"==em?" le ":" lt ")+f[1]:m[1].toString().match(/oo/)?l[i]=a+("["==sm?" ge ":" gt ")+f[0]:l[i]=f[0]+("["==sm?" le ":" lt ")+a+("]"==em?" le ":" lt ")+f[1]:l[i]=sm+f[0]+","+f[1]+em}return-1!=t.indexOf("inequality")?{err:g,dispvalstr:l.join(' "or" '),submitstr:s.join(o)}:{err:g,dispvalstr:l.join(" uu "),submitstr:s.join(o)}}(s,a.calcformat,a.vars);break;case"ntuple":case"calcntuple":case"complexntuple":case"calccomplexntuple":case"algntuple":r=function(e,t,a,r){var i,n="",s="",l=0,o=0,c="",u=!0,d=NaN;(t=(t=(t=w(t)).replace(/(\s+,\s+|,\s+|\s+,)/g,",").replace(/(^,|,$)/g,"")).replace(/<<(.*?)>>/g,"<$1>")).charAt(0).match(/[\(\[\<\{]/)||(u=!1);for(var p=0;p<t.length;p++)i=!1,0==l&&(n+=t.charAt(p),s+=t.charAt(p),o=p+1,","==t.charAt(p)?t.substring(p+1).match(/^\s*[\(\[\<\{]/)&&t.substring(0,p).match(/[\)\]\>\}]\s*$/)||(u=!1):p>0&&","!=t.charAt(p-1)&&(u=!1)),t.charAt(p).match(/[\(\[\<\{]/)?l++:t.charAt(p).match(/[\)\]\>\}]/)&&(l--,i=!0),(0==l&&i||1==l&&","==t.charAt(p))&&(sub=t.substring(o,p).replace(/^\s+/,"").replace(/\s+$/,""),""==sub&&(u=!1),r.match(/complex/)?(c+=(d=z(sub,a)).err,s+=d.outstrdisp,s+=t.charAt(p),d.outstr&&(n+=d.outstr,n+=t.charAt(p))):"algntuple"===r?c+=(d=N(e,sub,a)).err:(c+=K(sub,a),c+=Q(sub,a),c+=(d=F(sub,a))[1],n+=d[0],s+=P(d[0]),n+=t.charAt(p),s+=t.charAt(p)),o=p+1);0!=l&&(u=!1);0==u&&(c=_("Invalid notation")+". "+c);"algntuple"===r&&(s="");a.match(/generalcomplex/)&&(n="");return{err:c,dispvalstr:s,submitstr:n}}(e,s,a.calcformat,a.qtype);break;case"complex":case"calccomplex":r=function(e,t){-1!=t.indexOf("allowplusminus")&&(e=e.replace(/(.*?)\+\-(.*?)(,|$)/g,"$1+$2,$1-$2$3"));for(var a,r="",i=e.split(","),n=[],s=[],l=0;l<i.length;l++)r+=(a=z(i[l],t)).err,s.push(a.outstrdisp),a.outstr&&n.push(a.outstr);return-1!=t.indexOf("generalcomplex")?{err:r,dispvalstr:s.join(", ")}:{err:r,dispvalstr:s.join(", "),submitstr:n.join(",")}}(s,a.calcformat);break;case"numfunc":r=N(e,s,a.calcformat);break;case"matrix":case"complexmatrix":case"calcmatrix":case"calccomplexmatrix":case"algmatrix":r=L(e,s,a.calcformat,a.qtype)}r.str=I(e,s,a.qtype,a.calcformat)}return r}function I(e,t,a,r){return t=w(t),a.match(/interval/)?r.match(/inequality/)?(t=(t=T(e,t)[1]).replace(/<=/g," le ").replace(/>=/g," ge ").replace(/</g," lt ").replace(/>/g," gt ")).match(/all\s*real/i)&&(t="text("+t+")"):t=t.replace(/U/g,"uu"):"numfunc"==a?t=T(e,t)[1]:"calcntuple"==a?t=t.replace(/<+/g,"(:").replace(/>+/g,":)"):"calculated"==a&&(-1==r.indexOf("list")&&-1==r.indexOf("set")&&commasep&&(t=t.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),-1!=r.indexOf("scinot")&&(t=t.replace(/(x|X|\u00D7)/,"xx"))),t=t.replace(/[^\u0000-\u007f]/g,"?")}var D=["alpha","beta","chi","delta","epsilon","gamma","varphi","phi","psi","sigma","rho","theta","lambda","mu","nu","omega","tau"];function T(e,a){var r,i="",n=(r="string"==typeof t[e].vars?[t[e].vars]:t[e].vars.slice()).map(U).join("|");t[e].fvars&&(i=t[e].fvars.map(U).join("|")),r.push("DNE"),n.match(/lambda/)&&(a=a.replace(/lamda/,"lambda"));var s=[],l=a;l=l.replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|argsinh|argcosh|argtanh|argsech|argcsch|argcoth|arsinh|arcosh|artanh|arsech|arcsch|arcoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root|pi)/g,functoindex),a=a.replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|argsinh|argcosh|argtanh|argsech|argcsch|argcoth|arsinh|arcosh|artanh|arsech|arcsch|arcoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root|pi)/g,functoindex);for(var o=0;o<r.length;o++)if(r[o].match(/\(.+\)/)&&(a=a.replace(/\(\(([^\(]*?)\)\)/g,"($1)")),"E"==r[o]||"e"==r[o])s[o]=!0;else{s[o]=t[e].calcformat.match(/casesensitivevars/);for(var c=0;c<r.length;c++)if(o!=c&&r[c].toLowerCase()==r[o].toLowerCase()&&r[c]!=r[o]){s[o]=!0;break}}a=a.replace(new RegExp("("+n+")","gi"),function(e,t){for(var a=0;a<r.length;a++)if(r[a]==t||!s[a]&&r[a].toLowerCase()==t.toLowerCase())return"@v"+a+"@";return t}),a=a.replace(/@v(\d+)@/g,function(e,t){return r[t]}),l=l.replace(new RegExp("("+n+")","gi"),function(e,t){for(var a=0;a<r.length;a++)if(r[a]==t||!s[a]&&r[a].toLowerCase()==t.toLowerCase())return"@v"+a+"@";return t}),l=(l=(l=(l=l.replace(/(@v\d+@)(@v\d+@)/g,"$1 $2")).replace(/(@v\d+@)(@v\d+@)/g,"$1 $2")).replace(/(@v(\d+)@|\d+(\.\d+)?)!(?!=)/g,"{:$&:}")).replace(/@v(\d+)@/g,function(e,t){return r[t]});var u,d=a,p=new Array;for(o=0;o<r.length;o++)if(r[o].length>1){var h=!1;if(-1!=D.indexOf(r[o].toLowerCase())&&(h=!0),r[o].match(/^\w+_\w+$/)){u=s[o]?"g":"gi";var g=new RegExp(/^(\w+)_(\w+)$/,u).exec(r[o]),m=new RegExp(g[1]+"_\\("+g[2]+"\\)",u);l=l.replace(m,r[o]),a=a.replace(m,r[o]),d=(d=d.replace(new RegExp(g[0],u),g[1]+"_"+g[2])).replace(new RegExp(g[1]+"_\\("+g[2]+"\\)",u),g[1]+"_("+g[2]+")"),g[1].length>1&&-1==D.indexOf(g[1].toLowerCase())&&(g[1]='"'+g[1]+'"'),g[2].length>1&&-1==D.indexOf(g[2].toLowerCase())&&(g[2]='"'+g[2]+'"'),l=l.replace(new RegExp(g[0],u),g[1]+"_"+g[2]),a=a.replace(new RegExp(g[0],"g")," repvars"+o),r[o]="repvars"+o}else!h&&r[o].replace(/[^\w_]/g,"").length>1&&p.push(r[o]);(r[o].match(/[^\w_]/)||r[o].match(/^(break|case|catch|continue|debugger|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|this|throw|try|typeof|var|void|while|and with)$/))&&(a=a.replace(new RegExp(U(r[o]),"g")," repvars"+o),r[o]="repvars"+o)}if(p.length>0){vltq=p.join("|");var f=new RegExp("("+vltq+")","g");l=l.replace(f,'"$1"')}return l=(l=l.replace(/(@\d+@)/g," $1")).replace(/@(\d+)@/g,indextofunc),a=a.replace(/@(\d+)@/g,indextofunc),d=d.replace(/@(\d+)@/g,indextofunc),n.match(/\bf\b/)&&!i.match(/\bf\b/)&&(l=(l=l.replace(/([^a-zA-Z])f\^([\d\.]+)([^\d\.])/g,"$1f^$2{::}$3")).replace(/([^a-zA-Z])f\(/g,"$1f{::}(")),n.match(/\bg\b/)&&!i.match(/\bg\b/)&&(l=(l=l.replace(/([^a-zA-Z])g\^([\d\.]+)([^\d\.])/g,"$1g^$2{::}$3")).replace(/([^a-zA-Z])g\(/g,"$1g{::}(")),[a,l,r.join("|"),d]}function P(e){return Array.isArray(e)?e.map(P):"number"==typeof e?Math.abs(e)<1?e.toPrecision(4).replace(/\.?0+$/,""):e.toFixed(4).replace(/\.?0+$/,""):e}function B(e,t){if(-1!=t.indexOf("allowplusminus")&&(e=e.replace(/(.*?)\+\-(.*?)(,|$)/g,"$1+$2,$1-$2$3")),-1!=t.indexOf("list"))var a=e.split(/,/);else if(-1!=t.indexOf("set"))a=e.replace(/[\{\}]/g,"").split(/,/);else a=[e];for(var r,i="",n=[],s=0;s<a.length;s++)str=a[s],i+=K(str,t),i+=Q(str,t),i+=(r=F(str,t))[1],n.push(r[0]);var l=P(n).join(", ");return-1!=t.indexOf("set")&&(l="{"+l+"}"),{err:i,dispvalstr:l,submitstr:n.join(",")}}function L(e,t,a,r){var i=!0;((t=(t=(t=t.replace(/\[/g,"(")).replace(/\]/g,")")).replace(/\s+/g,"")).length<2||"("!==t.charAt(0)||")"!==t.charAt(t.length-1))&&(i=!1),t=t.substring(1,t.length-1);for(var n="",s="",l=[],o=0,c=0,u=0;u<t.length;u++)"("==t.charAt(u)?c++:")"==t.charAt(u)?c--:","==t.charAt(u)&&0==c&&(l.push(t.substring(o+1,u-1)),o=u+1);0==o&&"("!=t.charAt(0)?l.push(t):l.push(t.substring(o+1,t.length-1));var d,p,h,g=-1;0!==c&&(i=!1);var m=[],f=[];for(u=0;u<l.length;u++){m[u]=[],d=l[u].split(","),g>-1&&d.length!=g&&(i=!1),g=d.length;for(var v=0;v<d.length;v++)""==(p=d[v].replace(/^\s+/,"").replace(/\s+$/,""))?(s=_("No elements of the matrix should be left blank."),m[u][v]="",f.push("")):"algmatrix"===r?n+=(h=N(e,p,a)).err:r.match(/complex/)?(n+=(h=z(p,a)).err,m[u][v]=h.outstrdisp,h.outstr&&f.push(h.outstr)):(n+=Q(p,a),n+=K(p,a),n+=(h=F(p,a))[1],m[u][v]=P(h[0]),f.push(h[0]));m[u]="("+m[u].join(",")+")"}return i||(n=_("Invalid matrix format")+". "),{err:n+=s,dispvalstr:"["+m.join(",")+"]",submitstr:f.join("|")}}function N(e,a,r){var i,n,s,l,o,c,u,d=t[e],p=d.vars,h=d.fvars,g=d.domain,m=r.match(/equation/),f=r.match(/doubleinequality/),v=r.match(/inequality/),b="",y=[2,3,5,7,11,13,17,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97],x=T(e,a);r.match(/list/)?n=x[0].split(/,/):(!commasep&&x[0].match(/,/)&&(b+=_("Invalid use of a comma.")),n=[x[0]]);for(var w=0,q=0;q<n.length;q++){i=(i=n[q]).replace(/,/g,"").replace(/^\s+/,"").replace(/\s+$/,"").replace(/degree/g,"");var k=x[2].split("|");if(i.match(/(<=|>=|<|>|!=)/)?(v?i.match(/(<=|>=|<|>|!=)/g).length>1&&!f?b+=_("syntax error: your inequality should only contain one inequality symbol")+". ":2!=i.match(/(<=|>=|<|>|!=)/g).length&&f?b+=_("syntax error: your inequality should contain two inequality symbols")+". ":i.match(/(^(<|>|!))|(=|>|<)$/)&&(b+=_("syntax error: your inequality should have expressions on both sides")+". "):b+=m?_("syntax error: you gave an inequality, not an equation")+". ":_("syntax error: you gave an inequality, not an expression")+". ",i=i.replace(/(.*)(<=|>=|<|>|!=)(.*)/,"$1-($3)")):i.match(/=/)?(v&&!m?b+=_("syntax error: you gave an equation, not an inequality")+". ":m?i.match(/=/g).length>1?b+=_("syntax error: your equation should only contain one equal sign")+". ":i.match(/(^=)|(=$)/)&&(b+=_("syntax error: your equation should have expressions on both sides")+". "):b+=_("syntax error: you gave an equation, not an expression")+". ",i=i.replace(/(.*)=(.*)/,"$1-($2)")):m&&v?b+=_("syntax error: this is not an equation or inequality")+". ":m?b+=_("syntax error: this is not an equation")+". ":v&&(b+=_("syntax error: this is not an inequality")+". "),!r.match(/generalcomplex/)){var $,E=makeMathFunction(i,k.join("|"),[],h.join("|"),r.match(/generalcomplex/));if(w=0,!1!==E)for(l=0;l<20;l++){for(o={DNE:1},s=0;s<k.length-1;s++)$=0==l||19==l?l/19:l*y[s%y.length]%19/20,c=g[s][2]?Math.floor(g[s][0]+(g[s][1]-g[s][0])*$):g[s][0]+(g[s][1]-g[s][0])*$,o[k[s]]=c;if(""!==(u=E(o))&&!isNaN(u)){w++;break}}0===w&&(b+=_("syntax error")+". ")}b+=Q(x[0],r+",isnumfunc",p.map(U).join("|"))}return{err:b}}function R(e){var t=a[e].exportObjs(Kekule.Molecule)[0];if(void 0===t)document.getElementById("qn"+e).value="";else{var r=Kekule.IO.saveFormatData(t,"smi"),i=Kekule.IO.saveFormatData(t,"cml");document.getElementById("qn"+e).value=r+"~~~"+i}}function S(e){return e.replace(/[^\w_\^\-+]/g,"")}function H(e,t){var a=S(t);if(commasep&&(e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),e.match(/all\s*real/i))return["(-oo,oo)"];if(e.match(/DNE/))return["DNE"];var r,i,n=[],s=e.split(/\s*or\s*/);if(1==s.length&&e.match(/!=/)){var l=e.split(/!=/);return 2!=l.length?["","invalid"]:S(l[0])!=a?["","wrongvar"]:["(-oo,"+l[1]+")U("+l[1]+",oo)"]}for(var o=0;o<s.length;o++)if(str=s[o],r=str.match(/^(.*?)(<=?|>=?)(.*?)(<=?|>=?)(.*?)$/)){if(S(r[3])!=a)return["","wrongvar"];if(r[2].charAt(0)!=r[4].charAt(0))return["","invalid"];if(""==r[1].trim()||""==r[5].trim())return["","invalid"];i="<"==r[2].charAt(0)?("<"==r[2]?"(":"[")+r[1]+","+r[5]+("<"==r[4]?")":"]"):(">"==r[4]?"(":"[")+r[5]+","+r[1]+(">"==r[2]?")":"]"),n.push(i)}else{if(!(r=str.match(/^(.*?)(<=?|>=?)(.*?)$/)))return["","invalid"];if(S(r[1])==a)i="<"==r[2].charAt(0)?"(-oo,"+r[3]+("<"==r[2]?")":"]"):(">"==r[2]?"(":"[")+r[3]+",oo)",n.push(i);else{if(S(r[3])!=a)return["","wrongvar"];i="<"==r[2].charAt(0)?("<"==r[2]?"(":"[")+r[1]+",oo)":"(-oo,"+r[1]+(">"==r[2]?")":"]"),n.push(i)}}var c=n.join("U");return c.match(/[\(\[],|,[\)\]]/)?["","invalid"]:[c]}function z(e,t){var a="",r="",i="";if(e=e.replace(/^\s+/,"").replace(/\s+$/,""),-1!=t.indexOf("allowjcomplex")&&(e=e.replace(/j/g,"i")),a+=Q(e,t),-1!=t.indexOf("generalcomplex"))return{err:a,outstrdisp:e};if(-1==t.indexOf("sloppycomplex")){var n=function(e){var t,a,r,i,n,s,l,o=(e=(e=(e=(e=e.replace(/\s/,"")).replace(/\((\d+\*?i|i)\)\/(\d+)/g,"$1/$2")).replace(/sin/g,"s$n")).replace(/pi/g,"p$")).length;if(e.split("i").length>2)return _("error - more than 1 i in expression");if(-1==(n=e.indexOf("i")))t=e,a="0";else{for(i=0,l=n-1;l>0;l--)if(")"==(r=e.charAt(l)))i++;else if("("==r)i--;else if(("+"==r||"-"==r)&&0==i)break;if(l<0&&(l=0),0!=i)return _("error - invalid form");for(i=0,s=n+1;s<o;s++)if("("==(r=e.charAt(s)))i++;else if(")"==r)i--;else if(("+"==r||"-"==r)&&0==i)break;if(0!=i)return _("error - invalid form");if(n-l>0&&s-n>0&&(s==o||0==l)){if(s==o)t=e.substr(0,l),a=e.substr(l,n-l);else{if(0!=l)return _("error - invalid form");t=e.substr(s),a=e.substr(0,n)}a=(a=(a+="*"+e.substr(n+1+("*"==e.charAt(n+1)?1:0),s-n-1)).replace("-*","-1*").replace("+*","+1*")).replace(/(\+|-)1\*(.+)/g,"$1$2")}else if(n-l>1)a=e.substr(l,n-l),t=e.substr(0,l)+e.substr(n+1);else if(s-n>1)if(n>0){if("+"!=e.charAt(n-1)&&"-"!=e.charAt(n-1))return _("error - invalid form");a=e.charAt(n-1)+e.substr(n+1+("*"==e.charAt(n+1)?1:0),s-n-1),t=e.substr(0,n-1)+e.substr(s)}else a=e.substr(n+1,s-n-1),t=e.substr(0,n)+e.substr(s);else a="+"==e.charAt(l)?"1":"-"==e.charAt(l)?"-1":0==n?"1":e.charAt(l),t=(n>0?e.substr(0,l):"")+e.substr(n+1);""==t&&(t="0"),"/"==a.charAt(0)?a="1"+a:"+"!=a.charAt(0)&&"-"!=a.charAt(0)||"/"!=a.charAt(1)||(a=a.charAt(0)+"1"+a.substr(1)),"*"==a.charAt(a.length-1)&&(a=a.substr(0,a.length-1)),"+"==a.charAt(0)&&(a=a.substr(1)),"+"==t.charAt(0)&&(t=t.substr(1))}return[t=(t=t.replace(/s\$n/g,"sin")).replace(/p\$/g,"pi"),a=(a=(a=a.replace(/s\$n/g,"sin")).replace(/p\$/g,"pi")).replace(/\*\//g,"/")]}(e);"string"==typeof n?a+=n:(a+=K(n[0],t),a+=K(n[1],t))}if(""!==e){var s=evalMathParser(e,!0);if(Array.isArray(s)){var l=s[0],o=s[1];r=Math.abs(l)<1e-16?"":l,i=Math.abs(l)<1e-16?"":P(l),r+=Math.abs(o)<1e-16?"":(o>0&&""!=r?"+":"")+o+"i",i+=Math.abs(o)<1e-16?"":(o>0&&""!=r?"+":"")+P(o)+"i"}else a+=_("syntax incomplete"),l=NaN}return{err:a,outstrdisp:i,outstr:r}}var J=/^[\u0000-\u007f]*$/;function K(e,t){if(commasep&&(e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),e.match(/DNE/i))return"";if(e.match(/-?\+?oo$/)||e.match(/-?\+?oo\W/))return"";if(e.match(/,/))return _("Invalid use of a comma.");if(-1!=t.indexOf("allowmixed")&&e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/))return"";if(-1!=t.indexOf("fracordec")){if(!((e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2").replace(/\s/g,"")).match(/^\(?\-?\(?\d+\)?\/\(?\d+\)?$/)||e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)||e.match(/^\-?\d+$/)||e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/)))return _(" invalid entry format")+". "}else if(-1!=t.indexOf("fraction")||-1!=t.indexOf("reducedfraction")){if(!(e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2").replace(/\s/g,"")).match(/^\(?\-?\(?\d+\)?\/\(?\-?\d+\)?$/)&&!e.match(/^\s*?\-?\d+\s*$/))return _("not a valid fraction")+". "}else if(-1!=t.indexOf("mixednumber")){if(!(e.match(/^\(?\-?\s*\(?\d+\)?\/\(?\d+\)?$/)||e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)||e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/)||e.match(/^\s*\-?\s*\d+\s*$/)))return _("not a valid mixed number")+". ";e=e.replace(/_/," ")}else if(-1!=t.indexOf("scinot")){if(!(e=(e=e.replace(/\s/g,"")).replace(/(xx|x|X|\u00D7)/,"xx")).match(/^\-?[1-9](\.\d*)?(\*|xx)10\^(\(?\(?\-?\d+\)?\)?)$/)){if(-1==t.indexOf("scinotordec"))return _("not valid scientific notation")+". ";if(!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)([eE]\-?\d+)?$/))return _("not valid decimal or scientific notation")+". "}}else if(-1!=t.indexOf("decimal")&&-1==t.indexOf("nodecimal")){if(!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)([eE]\-?\d+)?$/))return _(" not a valid integer or decimal number")+". "}else if(-1!=t.indexOf("integer")){if(!e.match(/^\s*\-?\d+(\.0*)?\s*$/))return _(" not an integer number")+". "}else if(!J.test(e))return _("Your answer contains an unrecognized symbol")+". ";return""}function Q(e,t,a){var r="";-1!=t.indexOf("notrig")&&e.match(/(sin|cos|tan|cot|sec|csc)/i)?r+=_("no trig functions allowed")+". ":-1!=t.indexOf("nodecimal")&&-1!=e.indexOf(".")?r+=_("no decimals allowed")+". ":-1==t.indexOf("mixed")&&e.match(/\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/)?r+=_("mixed numbers are not allowed")+". ":-1==t.indexOf("allowdegrees")&&e.match(/degree/)&&(r+=_("no degree symbols allowed")+". ");for(var i=0,n=0,s=0,l=0;l<e.length;l++)"("==e.charAt(l)?i++:")"==e.charAt(l)?i--:"["==e.charAt(l)?n++:"]"==e.charAt(l)?n--:"|"==e.charAt(l)&&(s=1-s);if(0==i&&0==n||(r+=" ("+_("unmatched parens")+"). "),0!=s&&(r+=" ("+_("unmatched absolute value bars")+"). "),reg=a?new RegExp("(sqrt|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*("+a+"|\\d+)","i"):new RegExp("(sqrt|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*(\\d+)","i"),errstuff=e.match(reg),null!=errstuff&&(r+="["+_("use function notation")+" - "+_("use $1 instead of $2",errstuff[1]+"("+errstuff[2]+")",errstuff[0])+"]. "),a)if(t.match(/casesensitivevars/)){(o="degree|arc|arg|ar|sqrt|root|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs|pi|sign|DNE|e|oo".split("|")).sort(function(e,t){return t.length-e.length});let t=new RegExp("("+o.join("|")+")","ig");(o=a.split("|")).sort(function(e,t){return t.length-e.length});let i=new RegExp("("+o.join("|")+")","g");e.replace(/repvars\d+/g,"").replace(t,"").replace(i,"").match(/[a-zA-Z]/)&&(r+=_(" Check your variables - you might be using an incorrect one")+". ")}else{var o;(o="degree|arc|arg|ar|sqrt|root|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs|pi|sign|DNE|e|oo".split("|").concat(a.split("|"))).sort(function(e,t){return t.length-e.length});let t=new RegExp("("+o.join("|")+")","ig");e.replace(/repvars\d+/g,"").replace(t,"").match(/[a-zA-Z]/)&&(r+=_(" Check your variables - you might be using an incorrect one")+". ")}if((e.match(/\|/g)||[]).length>2)for(var c=/\|.*?\|\s*(.|$)/g;match=c.exec(e);)if(""!=match[1]&&match[1].match(/[^+\-\*\/\^\)]/)){r+=_(" You may want to use abs(x) instead of |x| for absolute values to avoid ambiguity")+". ";break}return e.match(/\(\s*\)/)&&(r+=_(" Empty function input or parentheses")+". "),e.match(/%/)&&!e.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(r+=_(" Do not use the percent symbol, %")+". "),e.match(/=/)&&!t.match(/isnumfunc/)&&(r+=_("You gave an equation, not an expression")+". "),r}function F(e,t){if(commasep&&(e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),e.match(/,/))return[NaN,_("syntax incomplete")+". "];e.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(e=e.replace(/%/g,"")+"/100"),-1!=t.indexOf("mixed")&&(e=e.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),-1!=t.indexOf("allowxtimes")&&(e=e.replace(/(xx|x|X|\u00D7)/,"*")),-1!=t.indexOf("scinot")&&(e=e.replace("xx","*"));try{var a=evalMathParser(e);return isNaN(a)||""===a?[NaN,_("syntax incomplete")+". "]:[a,""]}catch(e){return[NaN,_("syntax incomplete")+". "]}}function U(e){return e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}return{init:function(a,i,l){var g,w,q,$,E;for(g in MQeditor.setConfig({toMQ:r,fromMQ:n}),0==e("#arialive").length&&e("body").append(e("<p>",{id:"arialive","aria-live":"assertive","aria-atomic":"true",class:"sr-only"})),a)if(!isNaN(parseInt(g))){if(t[g]=a[g],(w=a[g]).helper&&w.qtype.match(/^(calc|numfunc|string|interval|matrix|chemeqn|complexmatrix|alg)/)){if(!(q=document.getElementById("qn"+g))&&!w.matrixsize)continue;$=w.qtype,w.calcformat&&($+=","+w.calcformat),w.displayformat&&($+=","+w.displayformat),w.matrixsize?($+=",matrixsized",e("input[id^=qn"+g+"-]").attr("data-mq",$),w.vars&&e("input[id^=qn"+g+"-]").attr("data-mq-vars",w.vars)):(q.setAttribute("data-mq",$),w.vars&&q.setAttribute("data-mq-vars",w.vars)),i&&(w.matrixsize?MQeditor.toggleMQAll("input[id^=qn"+g+"-]",!0,!0):MQeditor.toggleMQ(q,!0,!0),e("#pbtn"+g).hide())}if(w.preview?(document.getElementById("pbtn"+g).addEventListener("click",function(e){return function(){k(e)}}(g)),1!=w.preview||w.qtype.match(/matrix/)||(b.hasOwnProperty(g)&&delete b[g],y(g,i),document.getElementById("qn"+g).addEventListener("keyup",x),i&&M(g))):w.matrixsize?e("input[id^=qn"+g+"-]").on("input",function(e){return function(){A(e)}}(g)):document.getElementById("qn"+g)&&document.getElementById("qn"+g).addEventListener("keyup",function(e){return function(){A(e)}}(g)),"debit"===w.format?document.getElementById("qn"+g).addEventListener("keyup",m):"credit"===w.format?(document.getElementById("qn"+g).addEventListener("keyup",f),v()):"normslider"===w.format&&imathasDraw.addnormslider(g,!0),w.autosuggest&&(!autoSuggestLists.hasOwnProperty(w.autosuggest)&&w.hasOwnProperty(w.autosuggest)&&(autoSuggestLists[w.autosuggest]=w[w.autosuggest]),autoSuggestLists.hasOwnProperty(w.autosuggest)&&(autoSuggestObjects[g]=new AutoSuggest(document.getElementById("qn"+g),autoSuggestLists[w.autosuggest]))),w.tip)if(q=document.getElementById("qn"+g+"-0"))for(j=0;document.getElementById("qn"+g+"-"+j);)o("qn"+g+"-"+j,w.tip,w.longtip),j++;else o("qn"+g,w.tip,w.longtip);if("draw"===w.qtype&&d(g),"file"===w.qtype&&initFileAlt(document.getElementById("qn"+g)),"multans"===w.qtype&&p(g),"molecule"===w.qtype&&h(g),w.usetinymce)if(document.getElementById("qn"+g).disabled&&!document.getElementById("tinyprev"+g)){var O=e("#qn"+g).val(),C=e("<div>",{id:"tinyprev"+g,class:"introtext"});C.html(O),e("#qn"+g).hide().after(C)}else{var I={};w.nopaste&&(I.paste_preprocess=function(e,t){t.content=""}),I.valid_classes="gridded,centered,attach,AMedit,AM",initeditor("selector","#qn"+g+".mceEditor",null,!1,function(e){e.on("blur",function(e){tinymce.triggerSave(),jQuery(e.target.targetElm).triggerHandler("change")}).on("focus",function(e){jQuery(e.target.targetElm).triggerHandler("focus")})},I)}"essay"==w.qtype&&e("#qnwrap"+g+".introtext img").on("click",rotateimg),u(g),e("input[id^=qn"+g+"]:not([type=file])").attr("maxlength",8e3)}if(e(".rubriclink").each(function(t,a){e(a).removeClass("rubriclink");var r=a.id.substring(16);if(-1!==r.indexOf("-")){var i=r.split("-");r=1e3*(1*i[0]+1)+1*i[1]}var n=e("#mqinput-qn"+r+",input[type=text]#qn"+r+",select#qn"+r+",textarea#qn"+r+",div.introtext#qnwrap"+r);n.length>0&&(n.after(a),e(a).show())}),E='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>',e("input.sabtn + span.hidden, input.sabtn + div.hidden").each(function(t,a){var r,i=a.id.substring(3),n=i;if(-1!==n.indexOf("-")){var s=n.split("-");n=1e3*(1*s[0]+1)+1*s[1],r=_("Question ")+(1*s[0]+1)+_(" Part ")+(1*s[1]+1)}else r=_("Question ")+(1*n+1);var l=e("<span>",{class:"keywrap"}).append(e("<button>",{type:"button","aria-controls":"ans"+i,"aria-expanded":"false",class:"keybtn","aria-label":_("View Key for ")+r,title:_("View Key")}).on("click",function(t){var a="true"==t.currentTarget.getAttribute("aria-expanded");t.currentTarget.setAttribute("aria-expanded",a?"false":"true"),e("#ans"+i).toggleClass("hidden",a),a||e("#ans"+i).attr("tabindex","-1").focus(),sendLTIresizemsg()}).html(E));if(e(a).closest(".autoshowans").length>0){var o=e("#qnwrap"+n);if(o.length>0)return e(a).prev(".sabtn").remove(),l.append(e(a)).addClass("inwrap"),void o.append(l);var c=e("#mqinput-qn"+n+",input[type=text]#qn"+n+",select#qn"+n+",textarea#qn"+n);if(c.length>0)return e(a).prev(".sabtn").remove(),l.append(e(a)),void c.after(l)}var u=e(a).parent();l.append(e(a)),u.empty().append(l)}),e("input.dsbtn + div.hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),e("input.dsbtn").each(function(){var t=e(this).siblings("div:first-of-type").attr("id");e(this).attr("aria-expanded",!1).attr("aria-controls",t).off("click.sashow").on("click.sashow",function(){var t="true"==e(this).attr("aria-expanded");e(this).attr("aria-expanded",!t).siblings("div:first-of-type").attr("aria-expanded",!t).attr("aria-hidden",t).toggleClass("hidden",t),sendLTIresizemsg()})}),l&&function(t){var a='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="green" stroke-width="3" fill="none" role="img" aria-hidden=true>';a+='<polyline points="20 6 9 17 4 12"></polyline></svg>',a+='<span class="sr-only scoremarker">'+_("Correct")+"</span>";var r='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="rgb(255,187,0)" stroke-width="3" fill="none" role="img" aria-hidden=true>';r+='<path d="M 5.3,10.6 9,14.2 18.5,4.6 21.4,7.4 9,19.8 2.7,13.5 z" /></svg>',r+='<span class="sr-only scoremarker">'+_("Partially correct")+"</span>";var i='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="rgb(153,0,0)" stroke-width="3" fill="none" role="img" aria-hidden=true>';i+='<path d="M18 6 L6 18 M6 6 L18 18" /></svg>',i+='<span class="sr-only scoremarker">'+_("Incorrect")+"</span>";var n='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="rgb(255,85,0)" stroke-width="3" fill="none" role="img" aria-hidden=true>';n+='<path d="M18 6 L6 18 M6 6 L18 18" /></svg>',n+='<span class="sr-only scoremarker">'+_("Incorrect, wrong format")+"</span>",e(t).find(".scoremarker").remove(),e(t).find("div.ansgrn,table.ansgrn").append(a),e(t).find("div.ansyel,table.ansyel").append(r),e(t).find("div.ansred,table.ansred").append(i),e(t).find("div.ansorg,table.ansorg").append(n),e(t).find("select.ansgrn").after(a),e(t).find("select.ansyel").after(r),e(t).find("select.ansred").after(i),e(t).find("select.ansorg").after(n),e(t).find("span[id^=mqinput-].ansgrn,input[type=text].ansgrn").after('<span class="scoremarker sr-only">'+_("Correct")+"</span>"),e(t).find("span[id^=mqinput-].ansyel,input[type=text].ansyel").after('<span class="scoremarker sr-only">'+_("Partially correct")+"</span>"),e(t).find("span[id^=mqinput-].ansred,input[type=text].ansred").after('<span class="scoremarker sr-only">'+_("Incorrect")+"</span>"),e(t).find("span[id^=mqinput-].ansorg,input[type=text].ansorg").after('<span class="scoremarker sr-only">'+_("Incorrect, wrong format")+"</span>"),e(t).find("span[id^=mqinput-].ansorg,input[type=text].ansorg").after(e("<span>",{role:"button",class:"scoremarker",tabindex:0,"aria-label":_("Incorrect, wrong format"),"data-tip":_("Your answer is equivalent to the correct answer, but is not simplified or is in the wrong format"),"data-tooltipclass":"dropdown-pane tooltip-pane"}).on("mouseover focus",function(){tipshow(this)}).on("mouseleave blur",tipout).html('<svg style="vertical-align:middle;margin-left:3px;" viewBox="0 0 24 24" width="18" height="18" stroke="rgb(255,85,0)" stroke-width="2" stroke-linecap="round" fill="none" role="img" aria-hidden=true><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12" y2="16"></line></svg>'))}(l),e("input[id^=qs][value=spec]").each(function(t,a){e(a).siblings("input[type=text]").off("keyup.qsclickchange").on("keyup.qsclickchange",function(t){8!=t.keyCode&&46!=t.keyCode&&e(a).prop("checked",!0)})}),e("input[id^=qn]").off("input.clearmarkers").on("input.clearmarkers",c),e("input[id^=qs],select[id^=qn]").off("change.clearmarkers").on("change.clearmarkers",c),a.scripts){for(var j in a.scripts)"code"==a.scripts[j][0]?scriptqueue.push(a.scripts[j]):-1==loadedscripts.indexOf(a.scripts[j][1])&&(scriptqueue.push(a.scripts[j]),loadedscripts.push(a.scripts[j][1]));scriptqueue.length>0&&!1===processingscriptsqueue&&s()}},clearparams:function(e){var a;for(a in e)delete t[a]},preSubmitForm:function(e){var a;for(var r in t){var i;if(!1!==(a=O(r)))if(i=document.getElementById("qn"+r+"-val"))i.value=a;else{var n=document.createElement("input");n.type="hidden",n.name="qn"+r+"-val",n.value=a,e.appendChild(n)}}},preSubmit:O,preSubmitString:function(e,a){var r=parseInt(e.substr(2));if(!t.hasOwnProperty(r))return a;var i=t[r];return a=(a=w(a)).replace(/^\s+/,"").replace(/\s+$/,""),"numfunc"==i.qtype&&"qs"!=e.substr(0,2)&&(a=T(r,a)[3]),a.length>3e4&&(a=a.substr(0,3e4)),a},clearLivePreviewTimeouts:function(){for(var e in b)clearTimeout(b[e].finaltimeout)},syntaxCheckMQ:A,clearTips:function(){hideAllEhTips()},handleMQenter:function(t){var a=e("#"+t).closest(".questionwrap").find(".submitbtnwrap .primary");a.is(":disabled")||a.trigger("click")}}}(jQuery);function prepWithMath(e){return e=(e=(e=e.replace(/\b(abs|acos|asin|atan|ceil|floor|cos|sin|tan|sqrt|exp|max|min|pow)\(/g,"Math.$1(")).replace(/\(E\)/g,"(Math.E)")).replace(/\((PI|pi)\)/g,"(Math.PI)")}function toggleinlinebtn(e,t){var a=document.getElementById(t),r=document.getElementById(e);"none"==r.style.display?(r.style.display="",r.setAttribute("aria-hidden",!1),a.setAttribute("aria-expanded",!0)):(r.style.display="none",r.setAttribute("aria-hidden",!0),a.setAttribute("aria-expanded",!1));var i=a.innerHTML;a.innerHTML=i.match(/\[\+\]/)?i.replace(/\[\+\]/,"[-]"):i.replace(/\[\-\]/,"[+]"),sendLTIresizemsg()}var seqgroupcollapsed={};function setupSeqPartToggles(e){var t='<svg style="vertical-align:middle" width="12" height="12" viewBox="0 0 12 12"><path d="M2 2 L2 10 L10 6 Z" fill="currentColor"/></svg>',a='<svg style="vertical-align:middle" width="12" height="12" viewBox="0 0 12 12"><path d="M2 2 L10 2 L6 10 Z" fill="currentColor"/></svg>';if(e.id&&e.id.match(/questionwrap/)){var r=parseInt(e.id.substr(12)),i=$(e).find(".seqsep");if(seqgroupcollapsed[r]&&1!=i.length||(seqgroupcollapsed[r]={}),i.length>1)for(var n=0;n<i.length-1;n++)$(i[n]).next().attr("id","seqgrp"+r+"-"+n),seqgroupcollapsed[r][n]&&$(i[n]).next().hide(),$(i[n]).prepend($("<button>",{class:"plain slim",style:"color: inherit","aria-expanded":!seqgroupcollapsed[r][n],"aria-controls":"seqgrp"+r+"-"+n,"aria-label":seqgroupcollapsed[r][n]?_("Expand"):_("Collapse"),html:seqgroupcollapsed[r][n]?t:a,type:"button",click:function(e){var r="true"==this.getAttribute("aria-expanded"),i=this.getAttribute("aria-controls");r?(this.setAttribute("aria-expanded","false"),this.setAttribute("aria-label",_("Expand")),this.innerHTML=t):(this.setAttribute("aria-expanded","true"),this.setAttribute("aria-label",_("Collapse")),this.innerHTML=a),$("#"+i).slideToggle(300);var n=i.substr(6).split("-");seqgroupcollapsed[n[0]][n[1]]=r,sendLTIresizemsg()}}))}}function AutoSuggest(e,t){var a=this;this.elem=e,this.suggestions=t,this.eligible=new Array,this.inputText=null,this.highlighted=-1,this.div=document.getElementById("autosuggest"),null==this.div&&(this.div=document.createElement("div"),this.div.id="autosuggest",document.getElementsByTagName("body")[0].appendChild(this.div),this.div.appendChild(document.createElement("ul")));if(e.setAttribute("autocomplete","off"),!e.id){var r="autosuggest"+AutoSuggestIdCounter;AutoSuggestIdCounter++,e.id=r}e.onkeydown=function(e){var t=a.getKeyCode(e);switch(t){case 9:a.useSuggestion("tab");break;case 13:return a.highlighted>-1&&e.stopImmediatePropagation(),a.useSuggestion("enter"),!1;case 27:a.hideDiv();break;case 38:a.highlighted>0&&a.highlighted--,a.changeHighlight(t);break;case 40:a.highlighted<a.eligible.length-1&&a.highlighted++,a.changeHighlight(t)}},e.onkeyup=function(e){switch(a.getKeyCode(e)){case 9:case 27:case 38:case 40:return;default:this.value.length>1?(a.inputText=this.value,a.getEligible(),a.eligible.length>0?a.highlighted=0:a.highlighted=-1,a.createDiv(),a.positionDiv(),a.showDiv()):(a.hideDiv(),0==this.value.length&&(a.inputText=""))}},e.onblur=function(e){a.hideDiv()},this.useSuggestion=function(e){this.highlighted>-1?(this.elem.value=this.eligible[this.highlighted],this.hideDiv()):this.hideDiv()},this.showDiv=function(){this.div.style.display="block"},this.hideDiv=function(){a.div.style.display="none",a.highlighted=-1},this.changeHighlight=function(){var e=this.div.getElementsByTagName("LI");for(i in e){var t=e[i];this.highlighted==i?t.className="selected":t.className=""}},this.positionDiv=function(){var e=this.elem,t=findPos(e);t[1]+=e.offsetHeight,this.div.style.left=t[0]+"px",this.div.style.top=t[1]+"px"},this.createDiv=function(){var e=document.createElement("ul");for(i in this.eligible){var t=this.eligible[i],r=document.createElement("li"),n=document.createElement("a");n.href="#",n.onclick=function(){return!1},n.innerHTML=t,r.appendChild(n),a.highlighted==i&&(r.className="selected"),e.appendChild(r)}this.div.replaceChild(e,this.div.childNodes[0]),this.setHighlight=function(e){for(var t=a.getEventSource(e);t.parentNode&&"LI"!=t.tagName.toUpperCase();)t=t.parentNode;var r=a.div.getElementsByTagName("LI");for(i in r){if(r[i]==t){a.highlighted=i;break}}a.changeHighlight()},e.onmouseover=a.setHighlight,e.onmousedown=e.ontouchstart=function(e){return a.setHighlight(e),a.useSuggestion("click"),a.hideDiv(),a.cancelEvent(e),!1},this.div.className="suggestion_list",this.div.style.position="absolute"},this.getEligible=function(){this.eligible=new Array;if(-1==this.inputText.indexOf(" ")){var e=new RegExp("\\b"+this.inputText.toLowerCase());for(i in this.suggestions){var t=this.suggestions[i];t.toLowerCase().match(e)&&(this.eligible[this.eligible.length]=t,i+",")}}},this.getKeyCode=function(e){return e?e.keyCode:window.event?window.event.keyCode:void 0},this.getEventSource=function(e){return e?e.target:window.event?window.event.srcElement:void 0},this.cancelEvent=function(e){e&&(e.preventDefault(),e.stopPropagation()),window.event&&(window.event.returnValue=!1)}}var AutoSuggestIdCounter=0,autoSuggestLists={},autoSuggestObjects={};document.write=function(){};var ehcurel=null,ehclosetimer=0,ehddclosetimer=0,curehdd=null,eecurel=null;function showeh(e){if(null==eecurel){unhideeh(0);var t=document.getElementById(e),l=document.getElementById("eh");if(e!=ehcurel){ehcurel=e;var d=jQuery(t).offset();l.style.display="block",l.style.left=d.left+"px",l.style.top=d.top+t.offsetHeight+"px",document.getElementById("ehdd").style.display="none"}else l.style.display="none",ehcurel=null;e.match(/mqinput/)?MQ(t).focus():t.focus()}}function reshrinkeh(e){null==eecurel&&e==ehcurel&&(document.getElementById("ehdd").style.display="block",document.getElementById("eh").style.display="none",ehcurel=null,curehdd=e,unhideeh(0))}function unhideeh(e){ehcancelclosetimer()}function hideeh(e){null==ehcurel?ehddclosetimer=window.setTimeout(function(){curehdd=null,document.getElementById("ehdd").style.display="none"},250):ehclosetimer=window.setTimeout(reallyhideeh,250)}function reallyhideeh(){document.getElementById("eh").style.display="none",ehcurel=null}function ehcancelclosetimer(){ehclosetimer&&(window.clearTimeout(ehclosetimer),ehclosetimer=null)}function hideAllEhTips(){ehclosetimer&&(window.clearTimeout(ehclosetimer),ehclosetimer=null),ehddclosetimer&&(window.clearTimeout(ehddclosetimer),ehddclosetimer=null),curehdd=null,document.getElementById("ehdd").style.display="none",document.getElementById("eh").style.display="none"}function showehdd(e,t,l){if((null==eecurel||eecurel!=e)&&null!=document.getElementById("tips"+l)){if(ehddclosetimer&&e!=curehdd&&(window.clearTimeout(ehddclosetimer),ehddclosetimer=null),e!=ehcurel){var d=document.getElementById("ehdd"),n=document.getElementById(e),o=jQuery(n).offset();document.getElementById("ehddtext").innerHTML=t,document.getElementById("eh").innerHTML=document.getElementById("tips"+l).innerHTML,d.style.display="block",d.style.left=o.left+"px",d.style.top=o.top+n.offsetHeight+"px"}curehdd=e}}function updateehpos(){if(curehdd||ehcurel){var e=document.getElementById("eh"),t=document.getElementById("ehdd"),l=document.getElementById(curehdd||ehcurel),d=jQuery(l).offset();e.style.left=d.left+"px",e.style.top=d.top+l.offsetHeight+"px",t.style.left=d.left+"px",t.style.top=d.top+l.offsetHeight+"px"}}var AMtoMQ=function(){var t={input:'"',tag:"mtext",output:"mbox",ttype:10},e=[{input:"alpha",tag:"mi",ttype:0},{input:"beta",tag:"mi",ttype:0},{input:"chi",tag:"mi",ttype:0},{input:"delta",tag:"mi",ttype:0},{input:"Delta",tag:"mo",ttype:0},{input:"epsi",tag:"mi",tex:"epsilon",ttype:0},{input:"varepsilon",tag:"mi",ttype:0},{input:"eta",tag:"mi",ttype:0},{input:"gamma",tag:"mi",ttype:0},{input:"Gamma",tag:"mo",ttype:0},{input:"iota",tag:"mi",ttype:0},{input:"kappa",tag:"mi",ttype:0},{input:"lambda",tag:"mi",ttype:0},{input:"Lambda",tag:"mo",ttype:0},{input:"mu",tag:"mi",ttype:0},{input:"nu",tag:"mi",ttype:0},{input:"omega",tag:"mi",ttype:0},{input:"Omega",tag:"mo",ttype:0},{input:"phi",tag:"mi",ttype:0},{input:"varphi",tag:"mi",ttype:0},{input:"Phi",tag:"mo",ttype:0},{input:"pi",tag:"mi",ttype:0},{input:"Pi",tag:"mo",ttype:0},{input:"psi",tag:"mi",ttype:0},{input:"Psi",tag:"mi",ttype:0},{input:"rho",tag:"mi",ttype:0},{input:"sigma",tag:"mi",ttype:0},{input:"Sigma",tag:"mo",ttype:0},{input:"tau",tag:"mi",ttype:0},{input:"theta",tag:"mi",ttype:0},{input:"vartheta",tag:"mi",ttype:0},{input:"Theta",tag:"mo",ttype:0},{input:"upsilon",tag:"mi",ttype:0},{input:"xi",tag:"mi",ttype:0},{input:"Xi",tag:"mo",ttype:0},{input:"zeta",tag:"mi",ttype:0},{input:"*",tag:"mo",tex:"cdot",ttype:0},{input:"-:",tag:"mo",tex:"div",ttype:0},{input:"sum",tag:"mo",ttype:7},{input:"^^",tag:"mo",tex:"wedge",ttype:0},{input:"xor",tag:"mo",tex:"oplus",ttype:0},{input:"oplus",tag:"mo",tex:"oplus",ttype:0},{input:"ominus",tag:"mo",tex:"ominus",ttype:0},{input:"neg",tag:"mo",tex:"neg",ttype:0},{input:"vv",tag:"mo",tex:"vee",ttype:0},{input:"nn",tag:"mo",tex:"cap",ttype:0},{input:"uu",tag:"mo",tex:"cup",ttype:0},{input:"xx",tex:"times",ttype:0},{input:"!=",tag:"mo",tex:"ne",ttype:0},{input:"<=",tag:"mo",tex:"le",ttype:0},{input:">=",tag:"mo",tex:"ge",ttype:0},{input:"geq",tag:"mo",ttype:0},{input:"in",tag:"mo",ttype:0},{input:"sub",tag:"mo",tex:"subset",ttype:0},{input:"sube",tag:"mo",tex:"subseteq",ttype:0},{input:"(",tag:"mo",output:"(",ttype:4},{input:")",tag:"mo",output:")",ttype:5},{input:"[",tag:"mo",output:"[",ttype:4},{input:"]",tag:"mo",output:"]",ttype:5},{input:"{",tag:"mo",output:"{",tex:"{",ttype:4,notexcopy:!0},{input:"}",tag:"mo",output:"}",tex:"}",ttype:5,notexcopy:!0},{input:"|",tag:"mo",output:"|",ttype:9},{input:"(:",tag:"mo",tex:"langle",ttype:4},{input:":)",tag:"mo",tex:"rangle",ttype:5},{input:"<<",tag:"mo",tex:"langle",ttype:4},{input:">>",tag:"mo",tex:"rangle",ttype:5},{input:"{:",tag:"mo",output:"{:",ttype:4,invisible:!0},{input:":}",tag:"mo",output:":}",ttype:5,invisible:!0},{input:"int",tag:"mo",ttype:0},{input:"+-",tag:"mo",tex:"pm",ttype:0},{input:"O/",tag:"mo",tex:"emptyset",ttype:0},{input:"oo",tag:"mo",tex:"infty",ttype:0},{input:"rarr",tag:"mo",tex:"rightarrow",ttype:0},{input:"->",tag:"mo",tex:"to",ttype:0},{input:"=>",tag:"mo",tex:"implies",ttype:0},{input:"<=>",tag:"mo",tex:"iff",ttype:0},{input:"rightleftharpoons",tag:"mo",ttype:0},{input:"RR",tag:"mo",tex:"mathbb{R}",ttype:0,notexcopy:!0},{input:"f",tag:"mi",output:"f",ttype:1,func:!0,val:!0},{input:"degree",tag:"mo",ttype:0},{input:"degrees",output:"degree",ttype:8},{input:"sin",tag:"mo",ttype:1,func:!0},{input:"cos",tag:"mo",ttype:1,func:!0},{input:"tan",tag:"mo",ttype:1,func:!0},{input:"arcsin",tag:"mo",ttype:1,func:!0},{input:"arccos",tag:"mo",ttype:1,func:!0},{input:"arctan",tag:"mo",ttype:1,func:!0},{input:"arcsec",tag:"mo",ttype:1,func:!0},{input:"arccsc",tag:"mo",ttype:1,func:!0},{input:"arccot",tag:"mo",ttype:1,func:!0},{input:"sinh",tag:"mo",ttype:1,func:!0},{input:"cosh",tag:"mo",ttype:1,func:!0},{input:"tanh",tag:"mo",ttype:1,func:!0},{input:"cot",tag:"mo",ttype:1,func:!0},{input:"coth",tag:"mo",ttype:1,func:!0},{input:"sech",tag:"mo",ttype:1,func:!0},{input:"csch",tag:"mo",ttype:1,func:!0},{input:"sec",tag:"mo",ttype:1,func:!0},{input:"csc",tag:"mo",ttype:1,func:!0},{input:"log",tag:"mo",ttype:1,func:!0},{input:"ln",tag:"mo",ttype:1,func:!0},{input:"abs",tag:"mo",ttype:1},{input:"Sin",tag:"mo",output:"sin",ttype:1,func:!0},{input:"Cos",tag:"mo",output:"cos",ttype:1,func:!0},{input:"Tan",tag:"mo",output:"tan",ttype:1,func:!0},{input:"Arcsin",tag:"mo",output:"arcsin",ttype:1,func:!0},{input:"Arccos",tag:"mo",output:"arccos",ttype:1,func:!0},{input:"Arctan",tag:"mo",output:"arctan",ttype:1,func:!0},{input:"Sinh",tag:"mo",output:"sinh",ttype:1,func:!0},{input:"Sosh",tag:"mo",output:"cosh",ttype:1,func:!0},{input:"Tanh",tag:"mo",output:"tanh",ttype:1,func:!0},{input:"Cot",tag:"mo",output:"cot",ttype:1,func:!0},{input:"Sec",tag:"mo",output:"sec",ttype:1,func:!0},{input:"Csc",tag:"mo",output:"csc",ttype:1,func:!0},{input:"Log",tag:"mo",output:"log",ttype:1,func:!0},{input:"Ln",tag:"mo",output:"ln",ttype:1,func:!0},{input:"Abs",tag:"mo",output:"abs",ttype:1,func:!0},{input:"sqrt",tag:"msqrt",output:"sqrt",ttype:1},{input:"root",tag:"mroot",output:"root",ttype:2},{input:"frac",tag:"mfrac",output:"/",ttype:2},{input:"/",tag:"mfrac",output:"/",ttype:3},{input:"stackrel",tag:"mover",output:"stackrel",ttype:2},{input:"_",tag:"msub",output:"_",ttype:3},{input:"^",tag:"msup",output:"^",ttype:3},{input:"Sqrt",tag:"msqrt",output:"sqrt",ttype:1},{input:"hat",tag:"mover",ttype:1,acc:!0},{input:"bar",tag:"mover",tex:"overline",ttype:1,acc:!0},{input:"vec",tag:"mover",ttype:1,acc:!0},{input:"text",tag:"mtext",output:"text",ttype:10},{input:"mbox",tag:"mtext",output:"mbox",ttype:10},t];function p(t,e){return t.input>e.input?1:-1}var n,a,u,r=[];function i(t,e){var p;p="\\"==t.charAt(e)&&"\\"!=t.charAt(e+1)&&" "!=t.charAt(e+1)?t.slice(e+1):t.slice(e);for(var n=0;n<p.length&&p.charCodeAt(n)<=32;n+=1);return p.slice(n)}function g(t,e,p){if(0==p){var n,a;for(p=-1,n=t.length;p+1<n;)t[a=p+n>>1]<e?p=a:n=a;return n}for(var u=p;u<t.length&&t[u]<e;u++);return u}function c(t){for(var p,n,i,c=0,o="",l=!0,s=1;s<=t.length&&l;s++)n=t.slice(0,s),(c=g(r,n,c))<r.length&&t.slice(0,r[c].length)==r[c]&&(p=c,s=(o=r[c]).length),l=c<r.length&&t.slice(0,r[c].length)>=r[c];if(a=u,""!=o)return u=e[p].ttype,e[p];u=0,c=1,n=t.slice(0,1);for(var m=!0;"0"<=n&&n<="9"&&c<=t.length;)n=t.slice(c,c+1),c++;if("."==n&&(n=t.slice(c,c+1),c++,"0"<=n&&n<="9"))for(m=!1;"0"<=n&&n<="9"&&c<=t.length;)n=t.slice(c,c+1),c++;return m&&c>1||c>2?(n=t.slice(0,c-1),i="mn"):(c=2,i=("A">(n=t.slice(0,1))||n>"Z")&&("a">n||n>"z")?"mo":"mi"),"-"==n&&" "!==t.charAt(1)&&3==a?(u=3,{input:n,tag:i,output:n,ttype:1,func:!0,val:!0}):{input:n,tag:i,output:n,ttype:0,val:!0}}function o(t){var e;if("{"==t.charAt(0)&&"}"==t.charAt(t.length-1)){var p=0;"\\left"==(e=t.substr(1,5))?"("==(e=t.charAt(6))||"["==e||"{"==e?p=7:"\\lbrace"==(e=t.substr(6,7))&&(p=13):"("!=(e=t.charAt(1))&&"["!=e||(p=2),p>0&&("\\right)}"==(e=t.substr(t.length-8))||"\\right]}"==e||"\\right.}"==e?t=(t="{"+t.substr(p)).substr(0,t.length-8)+"}":"\\rbrace}"==e&&(t=(t="{"+t.substr(p)).substr(0,t.length-14)+"}"))}return t}function l(t){return"boolean"==typeof t.val&&t.val?pre="":pre="\\",t.hasOwnProperty("tex")&&null!=t.tex?pre+t.tex:t.hasOwnProperty("output")&&null!==t.output?pre+t.output:pre+t.input}function s(t){return t.hasOwnProperty("tex")&&null!=t.tex?"\\"+t.tex:t.input}function m(e){var p,a,u,r,g="";if(null==(p=c(e=i(e,0)))||5==p.ttype&&n>0)return[null,e];switch(8==p.ttype&&(p=c(e=p.output+i(e,p.input.length))),p.ttype){case 7:case 0:e=i(e,p.input.length);var y=l(p);return"\\"==y.charAt(0)||"mo"==p.tag?[y,e]:["{"+y+"}",e];case 4:if(n++,u=f(e=i(e,p.input.length),!0),n--,u[0].match(/bmatrix/))return[a=u[0].substring(0,u[0].length-7),u[1]];var h=0;return"\\right"==u[0].substr(0,6)&&(")"==(x=u[0].charAt(6))||"]"==x||"}"==x?h=6:"."==x?h=7:"\\rbrace"==(x=u[0].substr(6,7))&&(h=13)),h>0?(u[0]=u[0].substr(h),a="boolean"==typeof p.invisible&&p.invisible?"{"+u[0]+"}":"{"+s(p)+u[0]+"}"):a="boolean"==typeof p.invisible&&p.invisible?"{"+u[0]+"}":"{\\left"+s(p)+u[0]+"}",[a,u[1]];case 10:return p!=t&&(e=i(e,p.input.length)),-1==(r="{"==e.charAt(0)?e.indexOf("}"):"("==e.charAt(0)?e.indexOf(")"):"["==e.charAt(0)?e.indexOf("]"):p==t?e.slice(1).indexOf('"')+1:0)&&(r=e.length),[g+="\\text{"+(x=e.slice(1,r))+"}",e=i(e,r+1)];case 1:return null==(u=m(e=i(e,p.input.length)))[0]?["{"+l(p)+"}",e]:"boolean"==typeof p.func&&p.func?"^"==(x=e.charAt(0))||"_"==x||"/"==x||"|"==x||","==x||1==p.input.length&&p.input.match(/\w/)&&"("!=x?["{"+l(p)+"}",e]:[a="{"+l(p)+"{"+u[0]+"}}",u[1]]:(u[0]=o(u[0]),"sqrt"==p.input?["\\sqrt{"+u[0]+"}",u[1]]:"abs"==p.input?["\\left|{"+u[0]+"}\\right|",u[1]]:"cancel"==p.input?["\\cancel{"+u[0]+"}",u[1]]:void 0!==p.rewriteleftright?["{\\left"+p.rewriteleftright[0]+u[0]+"\\right"+p.rewriteleftright[1]+"}",u[1]]:"boolean"==typeof p.acc&&p.acc?[l(p)+"{"+u[0]+"}",u[1]]:["{"+l(p)+"{"+u[0]+"}}",u[1]]);case 2:if(null==(u=m(e=i(e,p.input.length)))[0])return["{"+l(p)+"}",e];u[0]=o(u[0]);var b=m(u[1]);return null==b[0]?["{"+l(p)+"}",e]:(b[0]=o(b[0]),[g="color"==p.input?"{\\color{"+u[0].replace(/[\{\}]/g,"")+"}"+b[0]+"}":"root"==p.input?"{\\sqrt["+u[0]+"]{"+b[0]+"}}":"{"+l(p)+"{"+u[0]+"}{"+b[0]+"}}",b[1]]);case 3:return e=i(e,p.input.length),[p.output,e];case 6:return e=i(e,p.input.length),["{\\quad\\text{"+p.input+"}\\quad}",e];case 9:n++,u=f(e=i(e,p.input.length),!1),n--;var x="";return"|"==(x=u[0].charAt(u[0].length-1))?[a="{\\left|"+u[0]+"}",u[1]]:[a="{\\mid}",e];default:return e=i(e,p.input.length),["{"+l(p)+"}",e]}}function y(t){var e,p,n,a,u;if(p=c(t=i(t,0)),a=(u=m(t))[0],3==(e=c(t=u[1])).ttype&&"/"!=e.input){if(null==(u=m(t=i(t,e.input.length)))[0]?u[0]="{}":u[0]=o(u[0]),t=u[1],"_"==e.input)if("^"==(n=c(t)).input){var r=m(t=i(t,n.input.length));r[0]=o(r[0]),t=r[1],a="{"+a,a+="_{"+u[0]+"}",a+="^{"+r[0]+"}",a+="}"}else a+="_{"+u[0]+"}";else a=a+"^{"+u[0]+"}";void 0!==p.func&&p.func&&3!=(n=c(t)).ttype&&5!=n.ttype&&(a="{"+a+(u=y(t))[0]+"}",t=u[1])}return[a,t]}var h=!0;function f(t,e){var p,a,u,r,g="",l=!1;do{a=(u=y(t=i(t,0)))[0],3==(p=c(t=u[1])).ttype&&"/"==p.input?(null==(u=y(t=i(t,p.input.length)))[0]?u[0]="{}":u[0]=o(u[0]),t=u[1],a="\\frac{"+(a=o(a))+"}",g+=a+="{"+u[0]+"}",p=c(t)):null!=a&&(g+=a)}while((5!=p.ttype&&(9!=p.ttype||e)||0==n)&&null!=p&&""!=p.output);if(5==p.ttype||9==p.ttype){var m=g.length;if(h&&m>2&&"{"==g.charAt(0)&&g.indexOf(",")>0){var f=g.charAt(m-2);if(")"==f||"]"==f){var b=g.charAt(6);if("("==b&&")"==f&&"}"!=p.output||"["==b&&"]"==f){var x="\\begin{bmatrix}",v=new Array;v.push(0);var d=!0,A=0,$=[];$[0]=[0];var w=0,_=0;for(r=1;r<m-1;r++)g.charAt(r)==b&&A++,g.charAt(r)==f&&0==--A&&","==g.charAt(r+2)&&"{"==g.charAt(r+3)&&(v.push(r+2),$[w=r+2]=[r+2]),"["!=g.charAt(r)&&"("!=g.charAt(r)&&"{"!=g.charAt(r)||_++,"]"!=g.charAt(r)&&")"!=g.charAt(r)&&"}"!=g.charAt(r)||_--,","==g.charAt(r)&&1==_&&$[w].push(r);v.push(m);var q=-1;if(0==A&&v.length>0)for(r=0;r<v.length-1;r++){if(r>0&&(x+="\\\\"),0==r)if(1==$[v[r]].length)var O=[g.substr(v[r]+7,v[r+1]-v[r]-15)];else{O=[g.substring(v[r]+7,$[v[r]][1])];for(var E=2;E<$[v[r]].length;E++)O.push(g.substring($[v[r]][E-1]+1,$[v[r]][E]));O.push(g.substring($[v[r]][$[v[r]].length-1]+1,v[r+1]-8))}else if(1==$[v[r]].length)O=[g.substr(v[r]+8,v[r+1]-v[r]-16)];else{for(O=[g.substring(v[r]+8,$[v[r]][1])],E=2;E<$[v[r]].length;E++)O.push(g.substring($[v[r]][E-1]+1,$[v[r]][E]));O.push(g.substring($[v[r]][$[v[r]].length-1]+1,v[r+1]-8))}q>0&&O.length!=q?d=!1:-1==q&&(q=O.length),x+=O.join("&")}x+="\\end{bmatrix}",d&&(g=x)}}}t=i(t,p.input.length),"boolean"==typeof p.invisible&&p.invisible||(g+=a="\\right"+s(p)),l=!0}return n>0&&!l&&(g+="\\right)"),[g,t]}return function(){var t,n=[];for(t=0;t<e.length;t++)!e[t].tex||"boolean"==typeof e[t].notexcopy&&e[t].notexcopy||(n[n.length]={input:e[t].tex,tag:e[t].tag,output:e[t].output||null,ttype:e[t].ttype,acc:e[t].acc||!1});for((e=e.concat(n)).sort(p),t=0;t<e.length;t++)r[t]=e[t].input}(),function(t,e,p){if(n=0,h=!0!==p,t=t.replace(/(&nbsp;|\u00a0|&#160;|{::})/g,""),void 0!==e&&document.getElementById(e)&&document.getElementById(e).getAttribute("data-mq").match(/(ntuple|string)/)&&(t=t.replace(/<([^<].*?,.*?[^>])>/g,"<<$1>>")),t=(t=(t=(t=(t=(t=t.replace(/&gt;/g,">")).replace(/&lt;/g,"<")).replace(/\s*\bor\b\s*/g,'" or "')).replace(/all\s+real\s+numbers/g,'"all real numbers"')).replace(/(\)|\])\s*u\s*(\(|\[)/g,"$1U$2")).replace(/\bDNE\b/gi,'"DNE"'),void 0!==e&&document.getElementById(e)&&document.getElementById(e).getAttribute("data-mq").match(/interval/)&&(t=t.replace(/\bU\b/g,"cup")),null==t.match(/\S/))return"";var a=f(t.replace(/^\s+/g,""),!1)[0];return a=a.replace(/{(\d+)}(?={\d+})/g,"{$1}\\ ")}}();function MQtoAM(t,e){var p,n,a,u,r,i;if(t=(t=t.replace(/\\:/g," ")).replace(/\\operatorname{(\w+)}/g," $1"),e)t=t.replace(/\\Re/g,"RR");else{for(;-1!=(i=t.lastIndexOf("\\left|"));)-1!=(n=t.indexOf("\\right|",i+1))?(a=t.substring(0,i).match(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|ln|log|exp|sin|cos|tan|sec|csc|cot)(\^\d+)?$/),t=(t=t.substring(0,n)+")"+(a?")":"")+t.substring(n+7)).substring(0,i)+(a?"(":"")+"abs("+t.substring(i+6)):t=t.substring(0,i)+"|"+t.substring(i+6);t=(t=(t=(t=(t=t.replace(/\\text{\s*or\s*}/g," or ")).replace(/\\text{all\s+real\s+numbers}/g,"all real numbers")).replace(/\\text{DNE}/g,"DNE")).replace(/\\varnothing/g,"DNE")).replace(/\\Re/g,"all real numbers")}for(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/\\begin{.?matrix}(.*?)\\end{.?matrix}/g,function(t,e){return"[("+e.replace(/\\\\/g,"),(").replace(/&/g,",")+")]"})).replace(/\\le(?=(\b|\d))/g,"<=")).replace(/\\ge(?=(\b|\d))/g,">=")).replace(/\\ne(?=(\b|\d))/g,"!=")).replace(/\+\-/g,"+ -")).replace(/\\pm/g,"+-")).replace(/\\approx/g,"~~")).replace(/(\\arrow|\\rightarrow)/g,"rarr")).replace(/\\rightleftharpoons/g,"rightleftharpoons")).replace(/\\sim/g,"~")).replace(/\\vee/g,"vv").replace(/\\wedge/g," ^^ ")).replace(/\\Rightarrow/g,"=>").replace(/\\Leftrightarrow/g,"<=>")).replace(/\\times/g,"xx")).replace(/\\left\\{/g,"lbrace").replace(/\\right\\}/g,"rbrace")).replace(/\\left/g,"")).replace(/\\right/g,"")).replace(/\\langle/g,"<<")).replace(/\\rangle/g,">>")).replace(/\\cdot/g,"*")).replace(/\\infty/g,"oo")).replace(/\\nthroot/g,"root")).replace(/\\overline/g,"bar")).replace(/\\mid/g,"|")).replace(/\\/g,"")).replace(/sqrt\[(.*?)\]/g,"root($1)")).replace(/(\d)frac/g,"$1 frac")).replace(/degree/g,"degree ");-1!=(i=t.indexOf("frac{"));){for(p=1,u=i+5;p>0&&u<t.length-1;)u++,"{"==(r=t.charAt(u))?p++:"}"==r&&p--;t=0==p?t.substring(0,i)+"("+t.substring(i+5,u)+")/"+t.substring(u+1):t.substring(0,i)+t.substring(i+4)}return(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/_(\w)(\w)/g,"_$1 $2")).replace(/(\^|_){([+\-])}/g,"$1$2")).replace(/(\^|_)([+\-])([^\^])/g,"$1$2 $3")).replace(/\^(\w)(\w)/g,"^$1 $2")).replace(/_{([\d\.]+)}(\w)/g,"_$1 $2")).replace(/_{([\d\.]+)}([^\w])/g,"_$1$2")).replace(/_{([\d\.]+)}$/g,"_$1")).replace(/_{(\w+)}$/g,"_($1)")).replace(/{/g,"(").replace(/}/g,")")).replace(/lbrace/g,"{").replace(/rbrace/g,"}")).replace(/\(([\d\.]+)\)\/\(([\d\.]+)\)/g,"$1/$2 ")).replace(/\/\(([\d\.]+)\)/g,"/$1 ")).replace(/\(([\d\.]+)\)\//g,"$1/")).replace(/\/\(([a-zA-Z])\)/g,"/$1 ")).replace(/(^|[^a-zA-Z])\(([a-zA-Z])\)\//g,"$1$2/")).replace(/\^\((-?[\d\.]+)\)(\d)/g,"^$1 $2")).replace(/\^\(-1\)/g,"^-1")).replace(/\^\((-?[\d\.]+)\)/g,"^$1")).replace(/\/\(([a-zA-Z])\^([\d\.]+)\)/g,"/$1^$2 ")).replace(/\(([a-zA-Z])\^([\d\.]+)\)\//g,"$1^$2/")).replace(/text\(([^)]*)\)/g,"$1")).replace(/\(\s*(\w)/g,"($1").replace(/(\w)\s*\)/g,"$1)")).replace(/\s+/," ").replace(/^\s+|\s+$/g,"")}var MQeditor=function(t){var e={layoutstyle:"auto",layout:[]},a=!1,s=null,r=null,n=null,o=MathQuill.getInterface(MathQuill.getInterface.MAX),i=["alpha","beta","chi","delta","epsilon","gamma","varphi","phi","psi","sigma","rho","theta","lambda","mu","nu","omega","tau"];function d(){try{return window.self!==window.top}catch(t){return!0}}function l(a,s,r){"string"==typeof a&&(a=document.getElementById(a));var n="boolean"==typeof s?s:"hidden"!=a.type,d=a.id,l=a.getAttribute("data-mq")||"";if(!0===n){var u=t(a).attr("type","hidden").val();e.hasOwnProperty("toMQ")&&(u=e.toMQ(u,d));var m=t("#mqinput-"+d);if(0==m.length){var h,p=t("<span/>",{id:"mqinput-"+d,class:"mathquill-math-field",text:u});if(null!==(h=a.className.match(/(ansred|ansyel|ansgrn|ansorg)/))&&p.addClass(h[0]),l.match(/chem/)&&p.addClass("mq-chem"),"string"==typeof a.style.width&&a.style.width.match(/[\d\.]+\s*\w{2,3}/))p.css("min-width",a.style.width.replace(/([\d\.]+)\s*(\w{2,3})/,function(t,e,a){return e/1.15+a}));else{var g=a.hasAttribute("size")?a.size>3?a.size/1.8:a.size:10;p.css("min-width",g+"em")}p.insertAfter(a);var q={spaceBehavesLikeTab:!0,leftRightIntoCmdGoes:"up",supSubsRequireOperand:!0,charsThatBreakOutOfSupSub:"=<>",charsThatBreakOutOfSupSubVar:"+-(",charsThatBreakOutOfSupSubOp:"+-(",restrictMismatchedBrackets:!0,interpretTildeAsSim:!0,handlers:{edit:y,enter:f}};e.hasOwnProperty("getLayoutstyle")?e.curlayoutstyle=e.getLayoutstyle():"auto"==e.layoutstyle?e.curlayoutstyle=b():e.curlayoutstyle=e.layoutstyle,"OSK"==e.curlayoutstyle&&(q.substituteTextarea=function(){var t;isOldiOS()?((t=document.createElement("span")).setAttribute("tabindex",0),t.setAttribute("role","textbox")):((t=document.createElement("textarea")).setAttribute("tabindex",0),t.setAttribute("inputmode","none"));return t}),l.match(/chem/)&&(q.charsThatBreakOutOfSupSubVar="",q.charsThatBreakOutOfSupSubOp="",q.autoSubscriptNumerals=!0,q.autoSubscriptBrackets=!0),l.match(/(list|ntuple)/)&&(q.charsThatBreakOutOfSupSub="=<>,"),l.match(/allowplusminus/)&&(q.quickPlusMinus=!0),q.autoOperatorNames=q.autoParenOperators="ln log abs exp sin cos tan arcsinh arccosh arctanh arcsech arccsch arccoth argsinh argcosh argtanh argsech argcsch argcoth arsinh arcosh artanh arsech arcsch arcoth arcsin arccos arctan sec csc cot arcsec arccsc arccot sinh cosh sech csch tanh coth",q.autoCommands="pi theta root sqrt ^oo degree",l.match(/logic/)&&(q.autoCommands+=" neg xor or and implies iff"),l.match(/setexp/)&&(q.autoCommands+=" nn xor uu ominus cap cup oplus");var v,w=a.getAttribute("data-mq-vars")||"";if(""!=w){w=""==w?[]:w.split(/,/);for(var x=0;x<w.length;x++){v=w[x].split(/_/);for(var O=0;O<v.length;O++)v[O].length>1&&v[O].match(/^[a-zA-Z]+$/)&&(-1!=i.indexOf(v[O].toLowerCase())?q.autoCommands+=" "+v[O]:q.autoOperatorNames+=" "+v[O]);w[x].match(/^(hat|bar|vec)\(/)&&(q.autoCommands+=" "+w[x].substring(0,3))}}a.disabled?(m=o.StaticMath(p[0]),p.addClass("disabled")):((m=o.MathField(p[0],q)).setAriaLabel(a.getAttribute("aria-label")),a.hasAttribute("aria-describedby")&&t(p).find(".mq-textarea > [tabindex=0]").attr("aria-describedby",a.getAttribute("aria-describedby")),c(p),t(p).find(".mq-textarea > [tabindex=0]").on("keydown.mqed",function(t){t.ctrlKey&&"z"===t.key?(t.preventDefault(),function(t){if(t.data.history&&t.data.historyIndex>0){t.data.historyIndex--;var e=t.data.history[t.data.historyIndex];t.data._suppressHistory=!0,t.latex(e),t.data._suppressHistory=!1}}(m)):t.ctrlKey&&"y"===t.key&&(t.preventDefault(),function(t){if(t.data.history&&t.data.historyIndex<t.data.history.length-1){t.data.historyIndex++;var e=t.data.history[t.data.historyIndex];t.data._suppressHistory=!0,t.latex(e),t.data._suppressHistory=!1}}(m))}),m.data.history=[u],m.data.historyIndex=0,m.data._suppressHistory=!1,t(a).on("change.mqed",function(t,s){if(!s){var r=a.value;e.hasOwnProperty("toMQ")&&(r=e.toMQ(r,a.id)),m.latex(r)}}))}else m.show(),(m=o(m[0]).latex(u)).data.history=[u],m.data.historyIndex=0,m.data._suppressHistory=!1;!0!==r&&m.focus()}else t(a).attr("type","text").off("change.mqed"),!0!==r&&t(a).focus(),t("#mqinput-"+d).hide()}function c(a){t(a).find(".mq-textarea > [tabindex=0]").on("focus.mqeditor",u).on("blur.mqeditor",function(s){if(!(s.relatedTarget&&t(s.relatedTarget).closest("#mqeditor").length>0)){r=setTimeout(h,100);var n=o.MathField(a[0]);n&&n.data.history&&(n.data.history=[n.data.history[n.data.historyIndex]],n.data.historyIndex=0),e.hasOwnProperty("onBlur")&&e.onBlur()}}),t(a).on("click.mqeditor",function(e){var a=t(e.target).closest("label");if(a.length>0)return"undefined"!==a.attr("for")&&t("#"+a.attr("for")).prop("checked",!0),e.stopPropagation(),!1})}function u(n){clearTimeout(r);var i=t(n.target).closest(".mathquill-math-field");!1===a&&(t("body").append(t("<div/>",{id:"mqeditor",class:"mqeditor"})),t("#mqeditor").on("mousedown touchstart",function(t){t.preventDefault()}),a=!0);var l=e.curlayoutstyle;if(e.hasOwnProperty("getLayoutstyle")?e.curlayoutstyle=e.getLayoutstyle():"auto"==e.layoutstyle?e.curlayoutstyle=b():e.curlayoutstyle=e.layoutstyle,"OSK"===e.curlayoutstyle){if(d()?t("#mqeditor").addClass("iframeosk").removeClass("fixedbottom"):t("#mqeditor").addClass("fixedbottom").removeClass("iframeosk"),!document.getElementById("mqe-fb-spacer")){var c=document.createElement("div");c.style.height="200px",c.id="mqe-fb-spacer",t("body").append(c)}}else t("#mqeditor").removeClass("fixedbottom iframeosk");t("#mqeditor").toggleClass("mq-chem",t(i).hasClass("mq-chem"));var u=!1;if((null===s||i[0]!=s.el()||l!==e.curlayoutstyle)&&(u=!0,null!==s&&t("#"+s.el().id.substring(8)).trigger("change",!0).triggerHandler("blur"),e.hasOwnProperty("getLayout")&&(e.layout=e.getLayout(i[0],e.curlayoutstyle)),t("#mqeditor").empty().show(),e.layout.tabs?function(e,a,s){var r=document.createElement("div");r.className="mqed-row mqed-tabrow";var n,o,i=document.createElement("div");e.appendChild(r),e.appendChild(i);for(var d=0;d<a.tabs.length;d++)if(!0===a.tabs[d].enabled){q(r,a.tabs[d],s+"-"+d),(o=document.createElement("div")).className="mqed-row mqed-tabpanel",o.id=s+"-"+d+"-tabpanel",i.appendChild(o);for(var l=0;l<a.tabs[d].tabcontent.length;l++)(n=a.tabs[d].tabcontent[l]).hasOwnProperty("flow")&&0==n.contents.length||(n.hasOwnProperty("flow")?g(o,n,s+"-"+d+"-"+l):q(o,n,s+"-"+d+"-"+l))}q(r,{s:1}),q(r,{p:"&times;",c:"close",a:"close"}),t(e).find(".mqed-tab").first().addClass("mqed-activetab")}(document.getElementById("mqeditor"),e.layout,"mqeditor"):g(document.getElementById("mqeditor"),e.layout,"mqeditor"),t("#mqeditor .mqed-btn.rend").each(function(){o.StaticMath(this,{mouseEvents:!1})}),t("#mqeditor .mqed-tabrow").length>0)){t("#mqeditor .mqed-tabpanel").hide().first().show();var m=t("#mqeditor .mqed-tabrow + div");m.css("height",m.height())}"OSK"!==e.curlayoutstyle||d()?t("#mqeditor").show():t("#mqeditor").slideDown(50,function(){var e=t("#mqeditor").height()+5,a=t(window).height()-(i.offset().top+i.outerHeight()-t(window).scrollTop());a<e&&t(window).scrollTop(t(window).scrollTop()+(e-a))}),p(i),s=o.MathField(i[0]),t("#"+i[0].id.substring(8)).triggerHandler("focus"),e.hasOwnProperty("onShow")&&e.onShow(i[0],e.curlayoutstyle,u),t(document).trigger("mqeditor:show")}function h(a){s&&(t(document).trigger("mqeditor:hide"),"OSK"!==e.curlayoutstyle||d()?t("#mqeditor").hide():t("#mqeditor").slideUp(50),t("#"+s.el().id.substring(8)).trigger("change",!0).triggerHandler("blur"),s=null)}function p(a){if("under"==e.curlayoutstyle||d()){var s=t(a).closest(".mathquill-math-field"),r=s.offset(),n=s.outerHeight(),o=r.left;if(document.getElementById("mqeditor")){var i=document.getElementById("mqeditor").offsetWidth;o+i>document.documentElement.clientWidth&&(o=document.documentElement.clientWidth-i-5)}d()?t("#mqeditor").css("top",r.top+n+3).css("left",0):t("#mqeditor").css("top",r.top+n+3).css("left",o)}else t("#mqeditor").css("top","auto").css("left",0)}function y(a){var r=a.el();if(p(r),e.hasOwnProperty("onResize")&&e.onResize(r,e.curlayoutstyle),r.id.match(/mqinput/)){var n=a.latex();a.data._suppressHistory||(a.data.historyIndex<a.data.history.length-1&&a.data.history.splice(a.data.historyIndex+1),(0==a.data.history.length||""!=n&&a.data.history[a.data.history.length-1]!=n)&&(a.data.history.push(n),a.data.history.length>10&&a.data.history.shift(),a.data.historyIndex=a.data.history.length-1)),e.hasOwnProperty("fromMQ")&&(n=e.fromMQ(n,r.id)),t("#"+r.id.substring(8)).val(n).trigger("input"),""!=n&&t("#"+r.id.substring(8)).siblings("input[id^=qs][value=spec]").prop("checked",!0),s&&s.setAriaPostLabel(""),e.hasOwnProperty("onEdit")&&e.onEdit(r.id,n)}}function f(t){e.hasOwnProperty("onEnter")&&e.onEnter(t.el().id)}function b(){var t=document.documentElement.clientWidth;return navigator.userAgent.match(/Android/)||navigator.userAgent.match(/iPhone/)||navigator.userAgent.match(/iPad/)||t<500?"OSK":"under"}function g(t,e,a){var s=e.flow,r=100;e.hasOwnProperty("s")&&"row"==s&&(r=e.s);var n=document.createElement("div");e.hasOwnProperty("s")&&(n.style.flexGrow=e.s),e.hasOwnProperty("class")&&(n.className=e.class),e.hasOwnProperty("tabpanel")&&(n.id=e.tabpanel.id,n.style.display=e.tabpanel.hidden?"none":""),(c=document.createElement("div")).className="mqed-"+s;for(var o,i=0,d=0,l=0;l<e.contents.length;l++)if(!(o=e.contents[l]).hasOwnProperty("flow")||0!=o.contents.length){var c;if(i+(d=o.hasOwnProperty("s")?o.s:1)>r)n.appendChild(c),i=0,(c=document.createElement("div")).className="mqed-"+s;o.hasOwnProperty("flow")?g(c,o,a+"-"+l):q(c,o,a+"-"+l),i+=d}n.appendChild(c),t.appendChild(n)}function q(e,a,s){var r,o,i,d;if((o=document.createElement("div")).className="mqed-btn-cont",a.s&&(o.style.flexGrow=a.s),a.contid&&(o.id=a.contid),a.contclass&&t(o).addClass(a.contclass),e.appendChild(o),a.l||a.b||a.p){if((r=document.createElement("span")).tabIndex=0,a.l){if(a.op)r.className="mqed-btn mq-math-mode",r.innerHTML='<span class="mq-root-block"><var class="mq-operator-name">'+a.l.substring(1)+"</var></span>";else if(a.pr)r.className="mqed-btn mq-math-mode",r.innerHTML='<span class="mq-root-block">'+a.pr+"</span>";else if(a.l.match(/\\left(.)\\right(.)/)){var l=a.l.match(/\\left(.)\\right(.)/);r.className="mqed-btn mq-math-mode",r.innerHTML='<span class="mq-non-leaf"><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">'+l[1]+'</span><span class="mq-non-leaf mq-empty"></span><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">'+l[2]+"</span></span>"}else r.className="mqed-btn rend",r.innerText=a.l;i="c",d=a.l.substring(1)}else a.b?(a.r?(r.className="mqed-btn rend",r.innerHTML=a.b):(r.className="mqed-btn mq-math-mode",a.v?r.innerHTML='<span class="mq-root-block"><var>'+a.b+"</var></span>":r.innerHTML='<span class="mq-root-block"><span>'+a.b+"</span></span>"),i="t",((d=a.b).match(/^\d$/)||"."==d)&&t(r).addClass("mqed-digitkey")):(r.className="mqed-btn",r.innerHTML=a.p,i="t",d=a.p);a.c&&("shift"==(i=a.c)?t(r).addClass("mqed-shift"):"k"==i?t(r).addClass("mqed-navkey"):"close"==i&&t(r).addClass("mqed-closebtn")),r.setAttribute("aria-label",a.a||d),r.setAttribute("role","button"),r.setAttribute("tabindex","-1"),a.sm&&(r.style.fontSize=100-10*a.sm+"%"),a.w&&(d=a.w),a.tabcontent&&(t(r).addClass("mqed-tab"),i="showtabpanel",d=s+"-tabpanel"),t(r).data("cmdtype",i).data("cmdval",d),t(r).on("click mousedown touchstart keydown",function(t,e){return function(a){v(a,t,e)}}(i,d)).on("touchend",function(e){setTimeout(function(){t(e.currentTarget).removeClass("mactive")},50)}).on("touchend mouseup",function(){clearTimeout(n),n=null}),o.appendChild(r)}}function v(a,r,o){if(("mousedown"!=a.type||"Backspace"===o)&&!("click"==a.type&&"Backspace"===o||"keydown"==a.type&&"Enter"!==a.key))if("touchstart"==a.type&&(a.preventDefault(),t(a.currentTarget).addClass("mactive")),s.focus(),"t"==r)o.match(/^[a-zA-Z]$/)&&t(a.target).closest(".mqed-tabpanel").find(".mqed-shift").hasClass("active")&&(o=o.toUpperCase()),s.typedText(o);else if("c"==r)s.cmd(o);else if("l"==r)s.latex(o);else if("w"==r){if(s.write(o),m=o.match(/bmatrix}(.*?)(\\\\|\\end{bm)/))for(var i=m[1].split(/&/).length,d=0;d<i;d++)s.keystroke("Left")}else if("k"==r)s.keystroke(o),"Backspace"===o&&(n=setTimeout(function(){v(a,r,o)},null===n?600:70));else if("m"==r)s.matrixCmd(o);else if("f"==r){if((l=s.selection())&&l.startIndex!=l.endIndex){let t=l.latex.substring(l.startIndex,l.endIndex);s.write(o+"\\left("+t+"\\right)"),s.keystroke("Left")}else o.match(/{}$/)?s.typedText(o.replace(/{}$/,"")):s.write(o)}else if("sf"==r){if((l=s.selection())&&l.startIndex!=l.endIndex){let t=l.latex.substring(l.startIndex,l.endIndex);s.write(o+"{"+t+"}")}else s.cmd(o);s.keystroke("Left")}else if("i"==r){var l,c="";if((l=s.selection())&&l.startIndex!=l.endIndex&&(c=l.latex.substring(l.startIndex,l.endIndex)),"string"==typeof o){var u=o.charAt(0),h=o.charAt(1);s.write("\\left"+u+c+"\\right"+h)}else s.write(o[0]+c+o[1]);""==c&&s.keystroke("Left")}else if("showtabpanel"==r){(p=t(a.target).closest(".mqed-btn")).closest(".mqeditor").find(".mqed-tabpanel").hide(),p.closest(".mqeditor").find(".mqed-btn.mqed-activetab").removeClass("mqed-activetab"),t("#"+o).show(),p.addClass("mqed-activetab"),e.hasOwnProperty("onTab")&&e.onTab(p[0],e.curlayoutstyle,o)}else if("shift"==r){var p=t(a.target).closest(".mqed-btn"),y=t(a.target).closest(".mqed-tabpanel"),f=!p.hasClass("active");f?p.addClass("active"):p.removeClass("active"),y.find(".mqed-btn").each(function(t,e){e.textContent.match(/^[a-zA-Z]$/)&&(e.textContent=f?e.textContent.toUpperCase():e.textContent.toLowerCase())})}else"close"==r&&s.blur()}return{setConfig:function(t){for(var a in t)e[a]=t[a]},toggleMQ:l,toggleMQAll:function(e,a){var s=a||null;t(e).each(function(t,e){l(e,s,!0)})},attachEditor:c,getLayoutstyle:b,resetEditor:function(){clearTimeout(r),t("#mqeditor").hide(),s=null}}}(jQuery);function isOldiOS(){const t=(navigator.userAgent||navigator.vendor||window.opera).match(/OS (\d+)_\d+/i);if(t&&t.length>1){return parseInt(t[1],10)<=13}return!1}var myMQeditor=function(a){var s={tabs:[{p:"Basic",enabled:!0,tabcontent:[{flow:"row",s:2,contents:[{l:"\\left(\\right)",c:"i",w:"()",a:_("parentheses"),pr:'<span class="mq-non-leaf"><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">(</span><span class="mq-non-leaf mq-empty"></span><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">)</span></span>'},{l:"x^{}",c:"t",w:"^",nb:1,a:_("exponent"),pr:'<var>x</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup mq-empty"></span></span>'},{l:"\\pi",nb:1,a:_("pi"),pr:'<span class="mq-nonSymbola"></span>'},{l:"\\sqrt{}",c:"c",w:"sqrt",nb:1,a:_("square root"),pr:'<span class="mq-non-leaf mq-sqrt-container"><span class="mq-scaled mq-sqrt-prefix"><svg preserveAspectRatio="none" viewBox="0 0 32 54"><path d="M0 33 L7 27 L12.5 47 L13 47 L30 0 L32 0 L13 54 L11 54 L4.5 31 L0 33"></path></svg></span><span class="mq-non-leaf mq-sqrt-stem mq-empty"></span></span>'},{l:"x_{}",c:"t",w:"_",nb:1,a:_("subscript"),pr:'<var>x</var><span class="mq-supsub mq-non-leaf"><span class="mq-sub mq-empty"></span></span>'},{l:"\\sqrt[n]{}",c:"c",w:"nthroot",nb:1,a:_("nth root"),pr:'<span class="mq-nthroot-container mq-non-leaf"><sup class="mq-nthroot mq-non-leaf"><var>n</var></sup><span class="mq-scaled mq-sqrt-container"><span class="mq-sqrt-prefix mq-scaled"><svg preserveAspectRatio="none" viewBox="0 0 32 54"><path d="M0 33 L7 27 L12.5 47 L13 47 L30 0 L32 0 L13 54 L11 54 L4.5 31 L0 33"></path></svg></span><span class="mq-sqrt-stem mq-non-leaf mq-empty"></span></span></span>'},{p:"DNE",sm:2},{l:"\\left|\\right|",c:"i",w:"||",a:_("absolute value")}]},{s:.1},{flow:"row",s:4,contents:[{b:"7"},{b:"8"},{b:"9"},{l:"\\frac{}{}",c:"t",w:"/",a:_("fraction"),pr:'<span class="mq-fraction mq-non-leaf"><span class="mq-numerator mq-empty"></span><span class="mq-denominator mq-empty"></span><span style="display:inline-block;width:0">&#8203;</span></span>'},{b:"4"},{b:"5"},{b:"6"},{b:"*"},{b:"1"},{b:"2"},{b:"3"},{b:"-"},{b:"0"},{b:"."},{s:1},{b:"+"}]},{s:.1},{flow:"row",s:2,contents:[{s:.5},{b:"&uarr;",c:"k",w:"Up",a:_("Move up")},{s:.5},{b:"&larr;",c:"k",w:"Left",a:_("Move left")},{b:"&rarr;",c:"k",w:"Right",a:_("Move right")},{s:.5},{b:"&darr;",c:"k",w:"Down",a:_("Move down")},{s:.5},{b:"&#x232B;",s:2,c:"k",w:"Backspace",a:_("Backspace")}]}]},{p:"Funcs",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\log",c:"f",op:1,a:_("log")},{l:"\\ln",c:"f",op:1,a:_("natural log")},{l:"\\log_{}",c:"f",a:_("log with base"),pr:'<var class="mq-operator-name">log</var><span class="mq-supsub mq-non-leaf"><span class="mq-sub mq-empty"></span></span>'},{l:"e^{}",c:"t",w:"e^",a:_("e to power"),pr:'<var>e</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup mq-empty"></span></span>'}]}]},{p:"Trig",enabled:!1,tabcontent:[{flow:"row",s:6,contents:[{l:"\\sin",c:"f",op:1,a:_("sine")},{l:"\\cos",c:"f",op:1,a:_("cosine")},{l:"\\tan",c:"f",op:1,a:_("tangent")},{l:"\\sec",c:"f",op:1,a:_("secant")},{l:"\\csc",c:"f",op:1,a:_("cosecant")},{l:"\\cot",c:"f",op:1,a:_("cotangent")},{l:"\\sin^{-1}",c:"f",a:_("arc sine"),pr:'<var class="mq-operator-name">sin</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">1</span></span>'},{l:"\\cos^{-1}",c:"f",a:_("arc cosine"),pr:'<var class="mq-operator-name">cos</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">1</span></span>'},{l:"\\tan^{-1}",c:"f",a:_("arc tangent"),pr:'<var class="mq-operator-name">tan</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">1</span></span>'},{l:"\\sinh",c:"f",a:_("hyperbolic sin"),op:1},{l:"\\cosh",c:"f",a:_("hyperbolic cosine"),op:1},{l:"\\tanh",c:"f",a:_("hyperbolic tangent"),op:1},{l:"\\pi",nb:1,a:_("pi"),pr:'<span class="mq-nonSymbola"></span>'},{s:1},{s:4}]}]},{p:"Inequality",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\lt",a:_("less than"),pr:'<span class="mq-binary-operator">&lt;</span>'},{l:"\\gt",a:_("greater than"),pr:'<span class="mq-binary-operator">&gt;</span>'},{l:"\\le",a:_("less than or equal"),pr:'<span class="mq-binary-operator">&le;</span>'},{l:"\\ge",a:_("greater than or equal"),pr:'<span class="mq-binary-operator">&ge;</span>'},{l:"\\ne",a:_("not equal"),pr:'<span class="mq-binary-operator">&ne;</span>'},{p:"or",c:"w",w:"\\text{ or }"},{p:"DNE",sm:2},{p:"all reals",c:"w",w:"\\text{all reals}",sm:2}]}]},{p:"Interval",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\left(\\right)",c:"i",a:_("left and right parentheses"),w:"()"},{l:"\\left[\\right]",c:"i",a:_("left and right brackets"),w:"[]"},{l:"\\left(\\right]",c:"i",a:_("left parenthesis, right bracket"),w:"(]"},{l:"\\left[\\right)",c:"i",a:_("left bracket, right parenthesis"),w:"[)"},{l:"\\infty",a:_("infinity"),pr:"<span></span>"},{l:"-\\infty",c:"w",w:"-\\infty",a:_("negative infinity"),pr:"<span></span>"},{l:"\\cup",a:_("union"),pr:'<span class="mq-binary-operator"></span>'},{s:1}]}]},{p:"Matrix",sm:1,enabled:!1,tabcontent:[{flow:"row",s:6,contents:[{p:"21",c:"w",a:_("2 by 1 matrix"),w:"\\begin{bmatrix}\\\\\\end{bmatrix}"},{p:"22",c:"w",a:_("2 by 2 matrix"),w:"\\begin{bmatrix}&\\\\&\\end{bmatrix}"},{p:"23",c:"w",a:_("2 by 3 matrix"),w:"\\begin{bmatrix}&&\\\\&&\\end{bmatrix}"},{p:"31",c:"w",a:_("3 by 1 matrix"),w:"\\begin{bmatrix}\\\\\\\\\\end{bmatrix}"},{p:"33",c:"w",a:_("3 by 3 matrix"),w:"\\begin{bmatrix}&&\\\\&&\\\\&&\\end{bmatrix}"},{p:"34",c:"w",a:_("3 by 4 matrix"),w:"\\begin{bmatrix}&&&\\\\&&&\\\\&&&\\end{bmatrix}"},{p:"+Col",c:"m",a:_("add column"),w:"addColumn"},{p:"-Col",c:"m",a:_("delete column"),w:"deleteColumn"},{p:"+Row",c:"m",a:_("add row"),w:"addRow"},{p:"-Row",c:"m",a:_("add column"),w:"deleteRow"}]}]},{p:"=<%",enabled:!0,tabcontent:[{flow:"row",s:5,contents:[{p:"[",a:_("left bracket"),s:.5},{p:"]",a:_("right bracket"),s:.5},{p:"{",a:_("left brace"),s:.5},{p:"}",a:_("right brace"),s:.5},{p:"(",a:_("left parenthesis"),s:.5},{p:")",a:_("right parenthesis"),s:.5},{l:"\\left\\langle\\right\\rangle",c:"i",a:_("vector brackets"),w:["\\left\\langle","\\right\\rangle"]},{l:"\\left|\\right|",c:"i",a:_("absolute value"),w:"||"},{p:"="},{l:"\\lt",a:_("less than"),pr:'<span class="mq-binary-operator">&lt;</span>'},{l:"\\gt",a:_("greater than"),pr:'<span class="mq-binary-operator">&gt;</span>'},{l:"\\le",a:_("less than or equal"),pr:'<span class="mq-binary-operator">&le;</span>'},{l:"\\ge",a:_("greater than or equal"),pr:'<span class="mq-binary-operator">&ge;</span>'},{p:"%",a:_("percent")},{p:",",a:_("comma")},{l:"\\infty",a:_("infinity"),pr:"<span></span>"},{p:"!",a:_("exclamation point")},{p:"?",a:_("question mark")}]}]},{p:"ABC",enabled:!0,tabcontent:[{flow:"row",s:10,contents:[{p:"q"},{p:"w"},{p:"e"},{p:"r"},{p:"t"},{p:"y"},{p:"u"},{p:"i"},{p:"o"},{p:"p"},{s:.5},{p:"a"},{p:"s"},{p:"d"},{p:"f"},{p:"g"},{p:"h"},{p:"j"},{p:"k"},{p:"l"},{s:.5},{b:"&#8679;",c:"shift",a:_("capitalize"),s:1.5},{p:"z"},{p:"x"},{p:"c"},{p:"v"},{p:"b"},{p:"n"},{p:"m"},{b:"&#x232B;",c:"k",w:"Backspace",a:_("backspace"),s:1.5},{p:"%",a:_("percent")},{p:",",a:_("comma")},{p:"Space",s:5,c:"t",w:" "},{p:"."},{b:"&larr;",c:"k",w:"Left",a:_("move left")},{b:"&rarr;",c:"k",w:"Right",a:_("move right")}]}]}]},n={tabs:[{p:"Basic",enabled:!0,tabcontent:[{flow:"row",s:5,contents:[{l:"\\frac{}{}",c:"t",w:"/",a:_("fraction"),pr:'<span class="mq-fraction mq-non-leaf"><span class="mq-numerator mq-empty"></span><span class="mq-denominator mq-empty"></span><span style="display:inline-block;width:0">&#8203;</span></span>'},{l:"x^{}",c:"t",w:"^",nb:1,a:_("exponent"),pr:'<var>x</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup mq-empty"></span></span>'},{l:"x_{}",c:"t",w:"_",nb:1,a:_("subscript"),pr:'<var>x</var><span class="mq-supsub mq-non-leaf"><span class="mq-sub mq-empty"></span></span>'},{l:"\\sqrt{}",c:"c",w:"sqrt",nb:1,a:_("square root"),pr:'<span class="mq-non-leaf mq-sqrt-container"><span class="mq-scaled mq-sqrt-prefix"><svg preserveAspectRatio="none" viewBox="0 0 32 54"><path d="M0 33 L7 27 L12.5 47 L13 47 L30 0 L32 0 L13 54 L11 54 L4.5 31 L0 33"></path></svg></span><span class="mq-non-leaf mq-sqrt-stem mq-empty"></span></span>'},{l:"\\sqrt[n]{}",c:"c",w:"nthroot",nb:1,a:_("nth root"),pr:'<span class="mq-nthroot-container mq-non-leaf"><sup class="mq-nthroot mq-non-leaf"><var>n</var></sup><span class="mq-scaled mq-sqrt-container"><span class="mq-sqrt-prefix mq-scaled"><svg preserveAspectRatio="none" viewBox="0 0 32 54"><path d="M0 33 L7 27 L12.5 47 L13 47 L30 0 L32 0 L13 54 L11 54 L4.5 31 L0 33"></path></svg></span><span class="mq-sqrt-stem mq-non-leaf mq-empty"></span></span></span>'},{l:"\\left(\\right)",c:"i",a:_("parentheses"),w:"()"},{l:"\\left|\\right|",c:"i",a:_("absolute value"),w:"||"},{l:"\\pi",nb:1,a:_("pi"),pr:'<span class="mq-nonSymbola"></span>'},{l:"\\infty",a:_("infinity"),pr:"<span></span>"},{p:"DNE",sm:2}]},{s:.1},{flow:"row",s:2,contents:[{b:"&uarr;",c:"k",a:_("move up"),w:"Up"},{b:"&darr;",c:"k",a:_("move down"),w:"Down"},{b:"&larr;",c:"k",a:_("move left"),w:"Left"},{b:"&rarr;",c:"k",a:_("move right"),w:"Right"},{b:"&#x232B;",s:2,c:"k",a:_("backspace"),w:"Backspace"}]}]},{p:"Funcs",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\log",c:"f",op:1},{l:"\\ln",c:"f",a:_("natural log"),op:1},{l:"\\log_{}",c:"f",a:_("log with base"),pr:'<var class="mq-operator-name">log</var><span class="mq-supsub mq-non-leaf"><span class="mq-sub mq-empty"></span></span>'},{l:"e^{}",c:"t",w:"e^",a:_("e to a power"),pr:'<var>e</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup mq-empty"></span></span>'}]}]},{p:"Trig",enabled:!1,tabcontent:[{flow:"row",s:6,contents:[{l:"\\sin",c:"f",a:_("sine"),op:1},{l:"\\cos",c:"f",a:_("cosine"),op:1},{l:"\\tan",c:"f",a:_("tangent"),op:1},{l:"\\sec",c:"f",a:_("secant"),op:1},{l:"\\csc",c:"f",a:_("cosecant"),op:1},{l:"\\cot",c:"f",a:_("cotangent"),op:1},{l:"\\sin^{-1}",c:"f",a:_("arcsine"),pr:'<var class="mq-operator-name">sin</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">1</span></span>'},{l:"\\cos^{-1}",c:"f",a:_("arccosine"),pr:'<var class="mq-operator-name">cos</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">1</span></span>'},{l:"\\tan^{-1}",c:"f",a:_("arctangent"),pr:'<var class="mq-operator-name">tan</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">1</span></span>'},{l:"\\sinh",c:"f",a:_("hyperbolic sine"),op:1},{l:"\\cosh",c:"f",a:_("hyperbolic cosine"),op:1},{l:"\\tanh",c:"f",a:_("hyperbolic tangent"),op:1},{l:"\\pi",nb:1,a:_("pi"),pr:'<span class="mq-nonSymbola"></span>'},{s:1},{s:4}]}]},{p:"Inequality",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\lt",a:_("less than"),pr:'<span class="mq-binary-operator">&lt;</span>'},{l:"\\gt",a:_("greater than"),pr:'<span class="mq-binary-operator">&gt;</span>'},{l:"\\le",a:_("less than or equal"),pr:'<span class="mq-binary-operator">&le;</span>'},{l:"\\ge",a:_("greater than or equal"),pr:'<span class="mq-binary-operator">&ge;</span>'},{l:"\\ne",a:_("not equal"),pr:'<span class="mq-binary-operator">&ne;</span>'},{p:"or",c:"w",w:"\\text{ or }"},{p:"DNE",sm:2},{p:"all reals",c:"w",w:"\\text{all reals}",sm:2}]}]},{p:"Interval",enabled:!1,tabcontent:[{flow:"row",s:4,contents:[{l:"\\left(\\right)",c:"i",a:_("left and right parentheses"),w:"()"},{l:"\\left[\\right]",c:"i",a:_("left and right brackets"),w:"[]"},{l:"\\left(\\right]",c:"i",a:_("left parenthesis, right bracket"),w:"(]"},{l:"\\left[\\right)",c:"i",a:_("left bracket, right parenthesis"),w:"[)"},{l:"\\infty",a:_("infinity"),pr:"<span></span>"},{l:"-\\infty",c:"w",w:"-\\infty",a:_("negative infinity"),pr:"<span></span>"},{l:"\\cup",a:_("union"),pr:'<span class="mq-binary-operator"></span>'},{s:1}]}]},{p:"Matrix",sm:1,enabled:!1,tabcontent:[{flow:"row",s:6,contents:[{p:"21",c:"w",a:_("2 by 1 matrix"),w:"\\begin{bmatrix}\\\\\\end{bmatrix}"},{p:"22",c:"w",a:_("2 by 2 matrix"),w:"\\begin{bmatrix}&\\\\&\\end{bmatrix}"},{p:"23",c:"w",a:_("2 by 3 matrix"),w:"\\begin{bmatrix}&&\\\\&&\\end{bmatrix}"},{p:"31",c:"w",a:_("3 by 1 matrix"),w:"\\begin{bmatrix}\\\\\\\\\\end{bmatrix}"},{p:"33",c:"w",a:_("3 by 3 matrix"),w:"\\begin{bmatrix}&&\\\\&&\\\\&&\\end{bmatrix}"},{p:"34",c:"w",a:_("3 by 4 matrix"),w:"\\begin{bmatrix}&&&\\\\&&&\\\\&&&\\end{bmatrix}"},{p:"+Col",c:"m",a:_("add column"),w:"addColumn"},{p:"-Col",c:"m",a:_("delete column"),w:"deleteColumn"},{p:"+Row",c:"m",a:_("add row"),w:"addRow"},{p:"-Row",c:"m",a:_("add column"),w:"deleteRow"}]}]}]};_("fraction"),_("exponent"),_("subscript"),_("square root"),_("nth root"),_("parentheses"),_("absolute value"),_("pi"),_("infinity"),_("move up"),_("move down"),_("move left"),_("move right"),_("backspace");return{getLayout:function(t,e){var p=t.id.substring(8),r=a("#"+p),l=r.attr("data-mq-vars")||"";l=""==l?[]:l.split(/,/);var c=r.attr("data-mq"),o=c.split(/,/)[0],m=[];if("OSK"===e?(m=a.extend(!0,[],s),c.match(/\bdecimal/)&&"numfunc"!=o?(m.tabs[0].tabcontent[0].s=1,m.tabs[0].tabcontent[0].contents=[{l:"\\infty",pr:"<span></span>",a:_("infinity")},{p:"DNE",sm:2}],m.tabs[0].tabcontent[2]={flow:"row",s:4,contents:[{b:"7"},{b:"8"},{b:"9"},{s:1},{b:"4"},{b:"5"},{b:"6"},{s:1},{b:"1"},{b:"2"},{b:"3"},{b:"-"},{b:"0"},{b:"."},c.match(/(list|set\b)/)||o.match(/(ntuple|interval)/)?{b:","}:{s:1},"calcntuple"===o&&!c.match(/vector/)||c.match(/point/)?{l:"\\left(\\right)",c:"t",w:"(",a:_("parentheses")}:{s:1}]}):c.match(/(fraction|mixednumber|fracordec)/)&&"numfunc"!=o?(m.tabs[0].tabcontent[0].s=1,m.tabs[0].tabcontent[0].contents=[{l:"\\frac{n}{}",c:"t",w:"/",a:_("fraction"),pr:'<span class="mq-fraction mq-non-leaf"><span class="mq-numerator"><var>n</var></span><span class="mq-denominator mq-empty"></span><span style="display:inline-block;width:0">&#8203;</span></span>'},{l:"\\frac{}{}",c:"c",w:"\\frac",a:_("new fraction"),pr:'<span class="mq-fraction mq-non-leaf"><span class="mq-numerator mq-empty"></span><span class="mq-denominator mq-empty"></span><span style="display:inline-block;width:0">&#8203;</span></span>'},{l:"\\infty",a:_("infinity"),pr:"<span></span>"},{p:"DNE",sm:2}],m.tabs[0].tabcontent[2]={flow:"row",s:4,contents:[{b:"7"},{b:"8"},{b:"9"},{s:1},{b:"4"},{b:"5"},{b:"6"},{s:1},{b:"1"},{b:"2"},{b:"3"},{b:"-"},{b:"0"},c.match(/fracordec/)?{b:"."}:{s:1},c.match(/(list|set\b)/)||o.match(/(ntuple|interval)/)?{b:","}:{s:1},"calcntuple"===o&&!c.match(/vector/)||c.match(/point/)?{l:"\\left(\\right)",c:"t",w:"(",a:_("parentheses")}:o.match(/complex/)?{b:"+"}:{s:1}]}):(c.match(/(list|set\b)/)||o.match(/(interval|string|ntuple)/)?m.tabs[0].tabcontent[2].contents[14]={b:","}:c.match(/equation/)&&(m.tabs[0].tabcontent[2].contents[14]={b:"="}),c.match(/nodecimal/)&&(m.tabs[0].tabcontent[2].contents[13]={s:1})),c.match(/allowplusminus/)&&(m.tabs[6].tabcontent[0].contents[17]={l:"\\pm",a:_("plus or minus"),pr:'<span class="mq-binary-operator">&plusmn;</span>'}),c.match(/inequality/)&&(m.tabs[3].p="Ineq")):(m=a.extend(!0,[],n),c.match(/\bdecimal/)?(m.tabs[0].tabcontent[0].s=3,m.tabs[0].tabcontent[0].contents=[{l:"\\infty",pr:"<span></span>",a:_("infinity")},{p:"DNE",sm:2},"calcntuple"===o&&!c.match(/vector/)||c.match(/point/)?{l:"\\left(\\right)",c:"t",w:"(",a:_("parentheses")}:{s:1}]):c.match(/(fraction|mixednumber|fracordec)/)&&(m.tabs[0].tabcontent[0].s=4,m.tabs[0].tabcontent[0].contents=[{l:"\\frac{n}{}",c:"t",w:"/",a:_("fraction"),pr:'<span class="mq-fraction mq-non-leaf"><span class="mq-numerator"><var>n</var></span><span class="mq-denominator mq-empty"></span><span style="display:inline-block;width:0">&#8203;</span></span>'},{l:"\\frac{}{}",c:"c",w:"\\frac",a:_("new fraction"),pr:'<span class="mq-fraction mq-non-leaf"><span class="mq-numerator mq-empty"></span><span class="mq-denominator mq-empty"></span><span style="display:inline-block;width:0">&#8203;</span></span>'},{l:"\\infty",a:_("infinity"),pr:"<span></span>"},{p:"DNE",sm:2}],("calcntuple"===o&&!c.match(/vector/)||c.match(/point/))&&m.tabs[0].tabcontent[0].contents.push({l:"\\left(\\right)",c:"t",w:"(",a:_("parentheses")},{s:3}))),"numfunc"==o&&c.match(/inequality/)?(m.tabs[3].enabled=!0,m.tabs[3].tabcontent[0].contents.splice(5,3),m.tabs[3].tabcontent[0].s=5):"string"==o&&c.match(/inequality/)&&(m.tabs[3].enabled=!0),c.match(/(fraction|mixednumber|fracordec|\bdecimal|logic|setexp|chemeqn)/)||(m.tabs[1].enabled=!0,c.match(/notrig/)||(m.tabs[2].enabled=!0,c.match(/allowdegrees/)&&(m.tabs[2].tabcontent[0].contents[13]={l:"\\degree"}))),o.match(/interval/)?c.match(/inequality/)?m.tabs[3].enabled=!0:m.tabs[4].enabled=!0:!o.match(/matrix/)&&!c.match(/matrix/)||c.match(/matrixsized/)?c.match(/set\b/)?m.tabs[0].tabcontent.unshift({flow:"row",s:1,contents:[{l:"\\lbrace{\\rbrace}",c:"i",w:["\\left\\{","\\right\\}"],a:_("braces")}]},{s:.1}):o.match(/complex/)?m.tabs[0].tabcontent.unshift({flow:"row",s:1,contents:[{b:c.match(/allowjcomplex/)?"j":"i",v:1}]},{s:.1}):c.match(/vector/)&&m.tabs[0].tabcontent.unshift({flow:"row",s:1,contents:[{l:"\\left\\langle\\right\\rangle",c:"i",w:["\\left\\langle","\\right\\rangle"],a:_("vector brackets")}]},{s:.1}):m.tabs[5].enabled=!0,c.match(/logic/)&&(m.tabs[0].p="Logic",m.tabs[0].tabcontent[0].contents=[{l:"\\vee",pr:'<span class="mq-binary-operator"></span>'},{l:"\\wedge",pr:'<span class="mq-binary-operator"></span>'},{l:"\\oplus",pr:'<span class="mq-binary-operator"></span>'},{l:"\\left(\\right)",a:_("parentheses"),c:"i",w:"()",pr:'<span class="mq-non-leaf"><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">(</span><span class="mq-non-leaf mq-empty"></span><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">)</span></span>'},{l:"\\neg",pr:"",a:_("negation")},{b:"~",a:_("tilde")},{l:"\\implies",pr:'<span class="mq-binary-operator"></span>'},{l:"\\iff",a:_("if and only if"),pr:'<span class="mq-binary-operator"></span>'}],"OSK"!==e&&(m.tabs[0].tabcontent[0].s=4)),c.match(/setexp/)&&(m.tabs[0].p="Set Exp",m.tabs[0].tabcontent[0].contents=[{l:"\\cup",pr:'<span class="mq-binary-operator"></span>'},{l:"\\cap",pr:'<span class="mq-binary-operator"></span>'},{l:"\\^c",a:_("complement"),c:"w",pr:'<span class="mq-non-leaf mq-empty mq-empty-box"></span><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sub"><var>c</var></span></span>'},{l:"\\ominus",pr:'<span class="mq-binary-operator"></span>'},{l:"\\left(\\right)",a:_("parentheses"),c:"i",w:"()",pr:'<span class="mq-non-leaf"><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">(</span><span class="mq-non-leaf mq-empty"></span><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">)</span></span>'}],"OSK"!==e&&(m.tabs[0].tabcontent[0].s=3)),"chemeqn"==o&&(m.tabs[0].tabcontent[0].contents=[{l:"x_{}",c:"t",w:"_",nb:1,a:_("subscript"),pr:'<var>x</var><span class="mq-supsub mq-non-leaf"><span class="mq-sub mq-empty"></span></span>'},{l:"x^{}",c:"t",w:"^",nb:1,a:_("superscript"),pr:'<var>x</var><span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup mq-empty"></span></span>'},{l:"\\left(\\right)",c:"i",w:"()",a:_("parentheses"),pr:'<span class="mq-non-leaf"><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">(</span><span class="mq-non-leaf mq-empty"></span><span class="mq-scaled mq-paren" style="transform: scale(1, 1.2);">)</span></span>'}],c.match(/reaction/)&&m.tabs[0].tabcontent[0].contents.push({l:"\\to",a:_("arrow right"),pr:'<span class="mq-binary-operator"></span>'},{l:"\\rightleftharpoons",a:_("arrow left and right"),pr:'<span class="mq-binary-operator"></span>'}),"OSK"!==e&&(m.tabs[0].tabcontent[0].s=3)),l.length>0){var i=function(a,s){for(var n,t=1,e=[],p="OSK"==s?4:2,r=0;r<a.length;r++){let s=0;n=a[r].split(/_/);for(var l=0;l<n.length;l++)n[l]=n[l].replace(/\b(alpha|beta|chi|delta|epsilon|gamma|varphi|phi|psi|sigma|rho|theta|lambda|mu|nu|omega|tau)\b/i,"\\$&"),"\\"==n[l].charAt(0)?s++:"("==n[l].charAt(0)?s+=n[l].length-2:n[l].match(/^(hat|bar|vec)\(([^\(]*?)\)$/)?s+=n[l].length-5:s+=n[l].length;a[r]=n.join("_"),s>t&&(t=s),a[r]=a[r].replace(/_(\w{2,})/,"_{$1}"),a[r]=a[r].replace(/_\(([^\(]*?)\)/,"_{$1}"),a[r]=a[r].replace(/^(hat|bar|vec)\(([^\(]*?)\)/,"\\$1{$2}"),1==a[r].length?e.push({b:a[r],c:"w",v:1}):e.push({l:a[r].replace(/(\\)?([a-zA-Z0-9]{2,})/g,function(a,s,n){return s?a:"\\text{"+n+"}"}),w:a[r],c:"w",r:1})}var c=Math.min(8,Math.max(4,Math.ceil(a.length/4)));a.length%c!==0&&e.push({s:c-a.length%c});return{format:a.length<=p&&t<4?"basic":"tab",btns:e,perrow:c}}(l,e);"basic"==i.format?m.tabs[0].tabcontent.unshift({flow:"row",s:1,contents:i.btns},{s:.1}):m.tabs.splice(1,0,{p:"chemeqn"==o?"Atoms":"Vars",enabled:!0,tabcontent:[{flow:"row",s:i.perrow,contents:i.btns}]})}return m},onShow:function(s,n,t){if(t&&"under"===n){var e=s.id.substring(8);if((i=a("#"+e))[0].hasAttribute("data-tip")){var p=a("#mqeditor .mqed-tabpanel").first(),r=p.children("div").last().position().left-12,l=i.attr("data-tip"),c=document.createElement("div");if(a(c).html(l),i[0].hasAttribute("aria-describedby")){var o=i[0].getAttribute("aria-describedby");if(document.getElementById(o).textContent!=l){var m=a("<a>",{href:"#",text:_("[more..]")}).on("click touchstart",function(s){return s.preventDefault(),a(s.target).parent().html(a("#"+o).html()),!1});a(c).append(" ").append(m)}}p.parent().css("height","auto").append(a("<div>",{width:r,class:"mqed-tipholder"}).append(c))}}else if(t&&"OSK"===n){var i;e=s.id.substring(8);if((i=a("#"+e))[0].hasAttribute("data-tip")){var b=e.substr(2).split(/-/)[0];reshrinkeh(s.id),showehdd(s.id,i[0].getAttribute("data-tip"),b)}}},onBlur:function(){hideeh()},onResize:function(a,s){"OSK"===s&&updateehpos()},onTab:function(s,n,t){"under"===n&&(t.match(/mqeditor-0-tabpanel/)?a(".mqed-tipholder").show():a(".mqed-tipholder").hide())}}}(jQuery);MQeditor.setConfig({getLayout:myMQeditor.getLayout,onShow:myMQeditor.onShow,onBlur:myMQeditor.onBlur,onResize:myMQeditor.onResize,onTab:myMQeditor.onTab,toMQ:AMtoMQ,fromMQ:MQtoAM,onEdit:imathasAssess.syntaxCheckMQ,onEnter:imathasAssess.handleMQenter});var MQ=MathQuill.getInterface(MathQuill.getInterface.MAX);MQ.config({spaceBehavesLikeTab:!0,leftRightIntoCmdGoes:"up",supSubsRequireOperand:!0,charsThatBreakOutOfSupSub:"=<>",charsThatBreakOutOfSupSubVar:"+-(",charsThatBreakOutOfSupSubOp:"+-(",restrictMismatchedBrackets:!0,autoCommands:"pi theta root sqrt ^oo degree",autoParenOperators:!0,addCommands:{oo:["VanillaSymbol","\\infty ","&infin;"],xor:["VanillaSymbol","\\oplus ","&oplus;"],uu:["VanillaSymbol","\\cup ","&cup;"],nn:["VanillaSymbol","\\cap ","&cap;"],rightleftharpoons:["BinaryOperator","\\rightleftharpoons ","&rlhar;"]}});