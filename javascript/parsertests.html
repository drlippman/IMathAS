<html>
    <head>
        <script src="mathparser.js"></script>
        <script>
        var tests = [
            ['log(100)', {}, 2],
            ['ln(e^3)', {}, 3],
            ['log_3(9)', {}, 2],
            ['1/2 + 4/8', {}, 1],
            ['1+2*3', {}, 7],
            ['8/4/2', {}, 1],
            ['2^3^2', {}, 512],
            ['2*3^2', {}, 18],
            ['3!', {}, 6],
            ['6/-2', {}, -3],
            ['6 div -2', {}, -3],
            ['6*-2', {}, -12],
            ['-6/-2', {}, 3],
            ['-3^2', {}, -9],
            ['(-3)^2', {}, 9],
            ['-x^2', {'x':3}, -9],
            ['-x^2', {'x':-3}, -9],
            ['2^-2', {}, .25],
            ['2^-2', {}, .25],
            ['(1+2)!',{}, 6],
            ['2^sqrt(9)', {}, 8],
            ['3!(1+1)', {}, 12],
            ['3!a', {'a':3}, 18],
            ['2*3^2', {}, 18],
            ['2^3!', {}, 64],
            ['8sin(pi/2)/4', {}, 2],
            ['4arcsin(sqrt(2)/2)/pi', {}, 1],
            ['root(3)(8) + root3(8)', {}, 4],
            ['root((3))(8) + log_((3))(3)', {}, 3],
            ['sqrt4+1', {}, 3],
            ['sqrt4x', {'x':10}, 20],
            ['sin^2(pi/4)', {}, 1/2],
            ['sin^-1(1)', {}, Math.asin(1)],
            ['sin^(-1)(1)', {}, Math.asin(1)],
            ['arcsin(1)', {}, Math.asin(1)],
            ['log_x(9)', {'x':3}, 2],
            ['log_2(8)',{}, 3],
            ['log_(2)(8)',{}, 3],
            ['log_(4/2)(8)',{}, 3],
            ['log_(4-(2*1))(8)',{}, 3],
            ['llog(l)', {'l':100}, 200],
            ['1 && 1', {}, 1],
            ['1 && 0', {}, 0],
            ['0 || 1', {}, 1],
            ['0 || 0', {}, 0],
            ['!0 || 0', {}, 1],
            ['0 || !0', {}, 1],
            ['1 || 0 || 0', {}, 1],
            ['!!1', {}, 1],
            ['1 || 1 && 0', {}, 1],
            ['pir^2', {'r':3}, Math.PI*9],
            ['e^2', {'e':3}, 9],
            ['1.2E3', {}, 1200],
            ['-3.5E-3', {}, -0.0035],
            ['-3.5E-3x', {'x':2}, -0.007],
            ['Cos(x)+C', {'x':Math.PI,'C':3}, 2],
            ['icos(pi)', {'i':2}, -2],
            ['Icos(pi)', {'I':2}, -2],
            ['pcos(pi)', {'p':2}, -2],
            ['pcos(pi)+i', {'p':2,'i':3}, 1],
            ['2pi', {'pi':2}, 4],
            ['45degrees', {}, Math.PI/4],
            ['cos(90 degree + 90 degree)', {}, -1],
            ['3*e - 4', {}, 3*Math.E - 4],
            ['3e-4', {}, 3*Math.E - 4],
            ['3E-2', {}, 0.03],
            ['5>3', {}, 1],
            ['2>3', {}, 0],
            ['5>=3', {}, 1],
            ['2<=2', {}, 1],
            ['5+1>3', {}, 1],
            ['3<1+5', {}, 1],
            ['|-3|', {}, 3],
            ['5 + |-4|/2', {}, 7],
            ['3(|4-(1+5)|+2)', {}, 12],
            ['p #o q', {'p':1, 'q':0}, 1],
            ['2!3!', {}, 12],
            ['3!x', {'x':5}, 30],
            ['sech^-1(0.5)', {}, 1.316957896],
            ['arcsech(0.5)', {}, 1.316957896],
            ['arsech(0.5)', {}, 1.316957896],
            ['argsech(0.5)', {}, 1.316957896],
            ['csch^-1(0.5)', {}, 1.443635475],
            ['coth^-1(2)', {}, 0.549306144],
            ['root(1/2)(8)', {}, 64],
            ['root(x)(8)', {'x':3}, 2],
            ['root(pi)(5)', {}, 1.669125771],
            ['root(1/3)(-5)', {}, -125]
        ];

        function runtests() {
            var out = '';
            for (var i=0; i<tests.length; i++) {
                var test = tests[i];
                let vars = Object.keys(test[1]).join('|');
                let parser = new MathParser(vars, [], '', test[3] ?? false);
                try {
                    parser.parse(test[0]);
                } catch (e) {
                    out += '<li>Parse failed on ' + test[0] + '</li>';
                    continue;
                }
                var res;
                try {
                    res = parser.evaluate(test[1]);
                } catch (e) {
                    out += '<li>Evaluate failed on ' + test[0] + '</li>';
                    continue;
                }
                if (Math.abs(res - test[2]) > 1E-8) {
                    out += '<li>Result does not match on ' + test[0] + ': Got ' + res + ', Expected ' + test[2] +'</li>';
                }
            }
            if (out === '') {
                out += '<li>All Tests Passed</li>';
            }
            document.getElementById("out").innerHTML = out;
        }
        </script>
    </head>
    <body>
        <h1>Parser Tests</h1>
        <p><button type=button onclick="runtests()">Run Tests</button></p>
        <ul id="out"></ul>
    </body>
</html>