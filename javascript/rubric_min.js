var hasTouch,rubricbase,lastrubricpos;function imasrubric_getpttot(t){var e,i=0;for(e=0;e<imasrubrics[t].data.length;e++)0==imasrubrics[t].type||1==imasrubrics[t].type?i+=imasrubrics[t].data[e][2]:3!=imasrubrics[t].type&&4!=imasrubrics[t].type||(i=Math.max(i,imasrubrics[t].data[e][2]));return i=Math.round(10*i)/10}function imasrubric_show(t,e,i,r,n,o){var a,d,c,s,u,l,m;hasTouch="ontouchstart"in document.documentElement,0==GB_loaded&&((a=document.createElement("div")).id="GB_window",a.innerHTML='<div id="GB_caption"></div><div id="GB_loading">Loading...</div><div id="GB_frameholder"></div>',document.getElementsByTagName("body")[0].appendChild(a),GB_loaded=!0),document.getElementById("GB_caption").innerHTML='<span style="float:right;"><span class="pointer clickable" onclick="GB_hide()">[X]</span></span> Rubric',document.getElementById("GB_caption").style.cursor="move",document.getElementById("GB_window").style.display="block",document.getElementById("GB_window").style.position="absolute",document.getElementById("GB_window").style.height="auto",document.getElementById("GB_window").style.margin="0",document.getElementById("GB_loading").style.display="block",$("#GB_caption").on("mousedown touchstart",function(t){if("input"!=t.target.nodeName.toLowerCase()&&"button"!=t.target.nodeName.toLowerCase()&&"a"!=t.target.nodeName.toLowerCase())if("touchstart"==t.type){var e=t.originalEvent.changedTouches[0]||t.originalEvent.touches[0];rubricbase={left:e.pageX,top:e.pageY},$("body").on("touchmove.R_move",rubrictouchmove),$("body").bind("touchend",function(t){var e=$("#GB_window").offset();lastrubricpos.left=e.left,lastrubricpos.top=e.top,$("body").off("touchmove.R_move"),$(this).unbind(t)})}else rubricbase={left:t.pageX,top:t.pageY},$("body").on("mousemove.R_move",rubricmousemove),$("body").bind("mouseup",function(t){var e=$("#GB_window").offset();lastrubricpos.left=e.left,lastrubricpos.top=e.top,$("body").off("mousemove.R_move"),$(this).unbind(t)})}),d="<div style='margin: 10px;'><form id='imasrubricform'><table><tbody>",imasrubrics[t].type<2&&(d+='<tr><td></td><td colspan="3"><a href="#" onclick="imasrubric_fullcredit();return false;">'+_("Full Credit")+"</a></td></tr>"),c=imasrubric_getpttot(t);for(s=0;s<imasrubrics[t].data.length;s++)0==imasrubrics[t].type||1==imasrubrics[t].type?(d+="<tr><td>"+imasrubrics[t].data[s][0],""!=imasrubrics[t].data[s][1]&&(d+="<br/><i>"+imasrubrics[t].data[s][1]+"</i>"),totpts=Math.round(100*Math.round(e*imasrubrics[t].data[s][2])/c)/100,d+='</td><td width="10%"><input type="radio" name="rubricgrp'+s+'" value="'+totpts+'"/> '+totpts+"</td>",d+='<td width="10%"><input type="radio" name="rubricgrp'+s+'" value="0" checked="checked"/> 0</td>',d+='<td width="10%" style="white-space:nowrap;"><input type="radio" name="rubricgrp'+s+'" id="rubricgrpother'+s+'" value="-1"/> Other: <input onfocus="document.getElementById(\'rubricgrpother'+s+'\').checked=true" type="number" step="0.1" min="0" max="'+totpts+'" size="3" id="rubricother'+s+'" value=""/></td></tr>'):2==imasrubrics[t].type?(d+="<tr><td>"+imasrubrics[t].data[s][0],""!=imasrubrics[t].data[s][1]&&(d+="<br/><i>"+imasrubrics[t].data[s][1]+"</i>"),d+='</td><td><input type="checkbox" id="rubricchk'+s+'" value="1"/></td></tr>'):3!=imasrubrics[t].type&&4!=imasrubrics[t].type||(d+="<tr><td>"+imasrubrics[t].data[s][0],""!=imasrubrics[t].data[s][1]&&(d+="<br/><i>"+imasrubrics[t].data[s][1]+"</i>"),totpts=Math.round(100*Math.round(e*imasrubrics[t].data[s][2])/c)/100,d+='</td><td width="10%"><input type="radio" name="rubricgrp" value="'+s+'"/> '+totpts+"</td></tr>");d+='</tbody></table><br/><input type="button" value="Record" onclick="imasrubric_record(\''+t+"','"+i+"','"+r+"','"+n+"',"+e+',false)" />',d+='<input type="button" value="Clear Existing and Record" onclick="imasrubric_record(\''+t+"','"+i+"','"+r+"','"+n+"',"+e+',true)" /></form></div>',document.getElementById("GB_frameholder").innerHTML=d,document.getElementById("GB_loading").style.display="none",u=document.documentElement,l=self.innerWidth||u&&u.clientWidth||document.body.clientWidth,m=self.innerHeight||u&&u.clientHeight||document.body.clientHeight,document.getElementById("GB_window").style.width=o+"px",$("#GB_window").outerHeight()>m-30&&(document.getElementById("GB_window").style.height=m-30+"px"),document.getElementById("GB_window").style.left=(l-o)/2+"px",lastrubricpos={left:($(window).width()-$("#GB_window").outerWidth())/2,top:$(window).scrollTop()+((window.innerHeight?window.innerHeight:$(window).height())-$("#GB_window").outerHeight())/2,scroll:$(window).scrollTop()},document.getElementById("GB_window").style.top=lastrubricpos.top+"px"}function rubricmousemove(t){var e=document.getElementById("GB_window");return e.style.left=t.pageX-rubricbase.left+lastrubricpos.left+"px",e.style.top=t.pageY-rubricbase.top+lastrubricpos.top+"px",!1}function rubrictouchmove(t){var e=t.originalEvent.changedTouches[0]||t.originalEvent.touches[0],i=document.getElementById("GB_window");return i.style.left=e.pageX-rubricbase.left+lastrubricpos.left+"px",i.style.top=e.pageY-rubricbase.top+lastrubricpos.top+"px",t.preventDefault(),!1}function imasrubric_record(t,e,i,r,n,o){var a,d,c,s,u="",l="";if(null!==r&&"null"!==r&&(l="#"+r+": "),a=window.tinymce?tinymce.get(i).getContent():$("textarea[name="+i+"]").val(),d=imasrubric_getpttot(t),0==imasrubrics[t].type||1==imasrubrics[t].type){for(s=c=0;s<imasrubrics[t].data.length;s++)val=getRadioValue("rubricgrp"+s),-1==val?thisscore=1*document.getElementById("rubricother"+s).value:thisscore=1*val,c+=thisscore,totpts=Math.round(n*imasrubrics[t].data[s][2])/d,u+="<li>"+imasrubrics[t].data[s][0]+": "+thisscore+"/"+totpts+".</li>";""!=u&&(u=l+"<ul class=nomark>"+u+"</ul>"),document.getElementById(e).value=c,1==imasrubrics[t].type&&(o?window.tinymce?tinymce.get(i).setContent(u):document.getElementById(i).value=u:window.tinymce?tinymce.get(i).setContent(a+u):document.getElementById(i).value=a+u)}else if(2==imasrubrics[t].type){for(s=0;s<imasrubrics[t].data.length;s++)document.getElementById("rubricchk"+s).checked&&(u+="<li>"+imasrubrics[t].data[s][0]+".</li>");""!=u&&(u=l+"<ul class=nomark>"+u+"</ul>"),o?window.tinymce?tinymce.get(i).setContent(u):document.getElementById(i).value=u:window.tinymce?tinymce.get(i).setContent(a+u):document.getElementById(i).value=a+u}else 3!=imasrubrics[t].type&&4!=imasrubrics[t].type||(loc=getRadioValue("rubricgrp"),totpts=Math.round(n*imasrubrics[t].data[loc][2])/d,u+=imasrubrics[t].data[loc][0],document.getElementById(e).value=totpts,3==imasrubrics[t].type&&(o?window.tinymce?tinymce.get(i).setContent(u):document.getElementById(i).value=u:window.tinymce?tinymce.get(i).setContent(a+u):document.getElementById(i).value=a+u));document.getElementById(i).dispatchEvent(new CustomEvent("input")),document.getElementById(e).dispatchEvent(new CustomEvent("input")),(p=i.match(/^fb-(\d+)/))&&revealfb(p[1]),GB_hide()}function imasrubric_chgtype(){var t=document.getElementById("rubtype").value;for(i in els=document.getElementsByTagName("input"),els)"rubricpoints"==els[i].className&&(2==t?(els[i].style.display="none",document.getElementById("pointsheader").style.display="none",$("#breakdowninstr").hide(),$("#scoretotalinstr").hide()):(els[i].style.display="",document.getElementById("pointsheader").style.display="",0==t||1==t?($("#breakdowninstr").show(),$("#scoretotalinstr").hide()):3!=t&&4!=t||($("#breakdowninstr").hide(),$("#scoretotalinstr").show())))}function imasrubric_fullcredit(){$("#imasrubricform tr").find("input:radio:first").attr("checked",!0)}function getRadioValue(t){var e,i=document.getElementsByName(t);for(e=0;e<i.length;e++)if(i[e].checked)return i[e].value}function quickgrade(t,e,i,r,n){var o;if(0==e)for(o=0;o<r;o++)document.getElementById(i+t+"-"+o).value=n[o];else for(o=0;o<r.length;o++)document.getElementById(i+t+"-"+r[o]).value=n[r[o]]}function quicksetscore(t,e,i){if(document.getElementById(t).value=e,null!=i){var r=" | "+_("Quick feedback: ");r+='<a href="#" onclick="return quicksetfb(this)">'+_("Good!")+"</a> | ",r+='<a href="#" onclick="return quicksetfb(this)">'+_("Great work.")+"</a> | ",r+='<a href="#" onclick="return quicksetfb(this)">'+_("Excellent!")+"</a> ",$(i).siblings(".quickfb").html(r)}}function quicksetfb(t){var e=$(t).text(),i=$(t).closest(".review, .scoredetails").find(".fbbox").attr("id");return window.tinymce?tinymce.get(i).setContent(e):document.getElementById(i).value=e,!1}function markallfullscore(){$(".quickgrade").click()}function revealfb(t,e){return $("#fb-"+t+"-wrap").show(),$("#fb-"+t+"-add").hide(),e&&$("#fb-"+t).focus(),!1}
