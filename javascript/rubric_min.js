var hasTouch,rubricbase,lastrubricpos;function imasrubric_getpttot(t){for(var e=0,i=0;i<imasrubrics[t].data.length;i++)0==imasrubrics[t].type||1==imasrubrics[t].type?e+=imasrubrics[t].data[i][2]:3!=imasrubrics[t].type&&4!=imasrubrics[t].type||(e=Math.max(e,imasrubrics[t].data[i][2]));return e=Math.round(10*e)/10}function imasrubric_show(t,e,i,r,n,o){var a,d,c,s;hasTouch="ontouchstart"in document.documentElement,0==GB_loaded&&((s=document.createElement("div")).id="GB_window",s.innerHTML='<div id="GB_caption"></div><div id="GB_loading">Loading...</div><div id="GB_frameholder"></div>',document.getElementsByTagName("body")[0].appendChild(s),GB_loaded=!0),document.getElementById("GB_caption").innerHTML='<span style="float:right;"><span class="pointer clickable" onclick="GB_hide()">[X]</span></span> Rubric',document.getElementById("GB_caption").style.cursor="move",document.getElementById("GB_window").style.display="block",document.getElementById("GB_window").style.position="absolute",document.getElementById("GB_window").style.height="auto",document.getElementById("GB_window").style.margin="0",document.getElementById("GB_loading").style.display="block",$("#GB_caption").on("mousedown touchstart",function(t){var e;"input"!=t.target.nodeName.toLowerCase()&&"button"!=t.target.nodeName.toLowerCase()&&"a"!=t.target.nodeName.toLowerCase()&&("touchstart"==t.type?(e=t.originalEvent.changedTouches[0]||t.originalEvent.touches[0],rubricbase={left:e.pageX,top:e.pageY},$("body").on("touchmove.R_move",rubrictouchmove),$("body").bind("touchend",function(t){var e=$("#GB_window").offset();lastrubricpos.left=e.left,lastrubricpos.top=e.top,$("body").off("touchmove.R_move"),$(this).unbind(t)})):(rubricbase={left:t.pageX,top:t.pageY},$("body").on("mousemove.R_move",rubricmousemove),$("body").bind("mouseup",function(t){var e=$("#GB_window").offset();lastrubricpos.left=e.left,lastrubricpos.top=e.top,$("body").off("mousemove.R_move"),$(this).unbind(t)})))}),a="<div style='margin: 10px;'><form id='imasrubricform'><table><tbody>",imasrubrics[t].type<2&&(a+='<tr><td></td><td colspan="3"><a href="#" onclick="imasrubric_fullcredit();return false;">'+_("Full Credit")+"</a></td></tr>"),d=imasrubric_getpttot(t);for(c=0;c<imasrubrics[t].data.length;c++)0==imasrubrics[t].type||1==imasrubrics[t].type?(a+="<tr><td>"+imasrubrics[t].data[c][0],""!=imasrubrics[t].data[c][1]&&(a+="<br/><i>"+imasrubrics[t].data[c][1]+"</i>"),a=(a=a+('</td><td width="10%"><input type="radio" name="rubricgrp'+c+'" value="'+(totpts=Math.round(100*Math.round(e*imasrubrics[t].data[c][2])/d)/100)+'"/> '+totpts)+'</td><td width="10%"><input type="radio" name="rubricgrp'+c+'" value="0" checked="checked"/> 0</td>')+'<td width="10%" style="white-space:nowrap;"><input type="radio" name="rubricgrp'+c+'" id="rubricgrpother'+c+'" value="-1"/> Other: <input onfocus="document.getElementById(\'rubricgrpother'+c+'\').checked=true" type="number" step="0.1" min="0" max="'+totpts+'" size="3" id="rubricother'+c+'" value=""/></td></tr>'):2==imasrubrics[t].type?(a+="<tr><td>"+imasrubrics[t].data[c][0],""!=imasrubrics[t].data[c][1]&&(a+="<br/><i>"+imasrubrics[t].data[c][1]+"</i>"),a+='</td><td><input type="checkbox" id="rubricchk'+c+'" value="1"/></td></tr>'):3!=imasrubrics[t].type&&4!=imasrubrics[t].type||(a+="<tr><td>"+imasrubrics[t].data[c][0],""!=imasrubrics[t].data[c][1]&&(a+="<br/><i>"+imasrubrics[t].data[c][1]+"</i>"),a+='</td><td width="10%"><input type="radio" name="rubricgrp" value="'+c+'"/> '+(totpts=Math.round(100*Math.round(e*imasrubrics[t].data[c][2])/d)/100)+"</td></tr>");a=a+'</tbody></table><br/><input type="button" value="Record" onclick="imasrubric_record(\''+t+"','"+i+"','"+r+"','"+n+"',"+e+',false)" /><input type="button" value="Clear Existing and Record" onclick="imasrubric_record(\''+t+"','"+i+"','"+r+"','"+n+"',"+e+',true)" /></form></div>',document.getElementById("GB_frameholder").innerHTML=a,document.getElementById("GB_loading").style.display="none",s=document.documentElement,i=self.innerWidth||s&&s.clientWidth||document.body.clientWidth,r=self.innerHeight||s&&s.clientHeight||document.body.clientHeight,document.getElementById("GB_window").style.width=o+"px",$("#GB_window").outerHeight()>r-30&&(document.getElementById("GB_window").style.height=r-30+"px"),document.getElementById("GB_window").style.left=(i-o)/2+"px",lastrubricpos={left:($(window).width()-$("#GB_window").outerWidth())/2,top:$(window).scrollTop()+((window.innerHeight||$(window).height())-$("#GB_window").outerHeight())/2,scroll:$(window).scrollTop()},document.getElementById("GB_window").style.top=lastrubricpos.top+"px"}function rubricmousemove(t){var e=document.getElementById("GB_window");return e.style.left=t.pageX-rubricbase.left+lastrubricpos.left+"px",e.style.top=t.pageY-rubricbase.top+lastrubricpos.top+"px",!1}function rubrictouchmove(t){var e=t.originalEvent.changedTouches[0]||t.originalEvent.touches[0],i=document.getElementById("GB_window");return i.style.left=e.pageX-rubricbase.left+lastrubricpos.left+"px",i.style.top=e.pageY-rubricbase.top+lastrubricpos.top+"px",t.preventDefault(),!1}function imasrubric_record(t,e,i,r,n,o){var a,d,c="",r=null!==r&&"null"!==r?"#"+r+": ":"",s=window.tinymce?tinymce.get(i).getContent():$("textarea[name="+i+"]").val(),u=imasrubric_getpttot(t);if(0==imasrubrics[t].type||1==imasrubrics[t].type){for(d=a=0;d<imasrubrics[t].data.length;d++)val=getRadioValue("rubricgrp"+d),a+=thisscore=-1==val?+document.getElementById("rubricother"+d).value:+val,totpts=Math.round(n*imasrubrics[t].data[d][2])/u,c+="<li>"+imasrubrics[t].data[d][0]+": "+thisscore+"/"+totpts+".</li>";""!=c&&(c=r+"<ul class=nomark>"+c+"</ul>"),document.getElementById(e).value=a,1==imasrubrics[t].type&&(o?window.tinymce?tinymce.get(i).setContent(c):document.getElementById(i).value=c:window.tinymce?tinymce.get(i).setContent(s+c):document.getElementById(i).value=s+c)}else if(2==imasrubrics[t].type){for(d=0;d<imasrubrics[t].data.length;d++)document.getElementById("rubricchk"+d).checked&&(c+="<li>"+imasrubrics[t].data[d][0]+".</li>");""!=c&&(c=r+"<ul class=nomark>"+c+"</ul>"),o?window.tinymce?tinymce.get(i).setContent(c):document.getElementById(i).value=c:window.tinymce?tinymce.get(i).setContent(s+c):document.getElementById(i).value=s+c}else 3!=imasrubrics[t].type&&4!=imasrubrics[t].type||(loc=getRadioValue("rubricgrp"),totpts=Math.round(n*imasrubrics[t].data[loc][2])/u,c+=r+imasrubrics[t].data[loc][0],document.getElementById(e).value=totpts,3==imasrubrics[t].type&&(o?window.tinymce?tinymce.get(i).setContent(c):document.getElementById(i).value=c:window.tinymce?tinymce.get(i).setContent(s+c):document.getElementById(i).value=s+c));document.getElementById(i).dispatchEvent(new CustomEvent("input")),document.getElementById(e).dispatchEvent(new CustomEvent("input")),(p=i.match(/^fb-(\d+)/))&&revealfb(p[1]),GB_hide()}function imasrubric_chgtype(){var t=document.getElementById("rubtype").value;for(i in els=document.getElementsByTagName("input"))"rubricpoints"==els[i].className&&(2==t?(els[i].style.display="none",document.getElementById("pointsheader").style.display="none",$("#breakdowninstr").hide(),$("#scoretotalinstr").hide()):(els[i].style.display="",document.getElementById("pointsheader").style.display="",0==t||1==t?($("#breakdowninstr").show(),$("#scoretotalinstr").hide()):3!=t&&4!=t||($("#breakdowninstr").hide(),$("#scoretotalinstr").show())))}function imasrubric_fullcredit(){$("#imasrubricform tr").find("input:radio:first").attr("checked",!0)}function getRadioValue(t){for(var e=document.getElementsByName(t),i=0;i<e.length;i++)if(e[i].checked)return e[i].value}function quickgrade(t,e,i,r,n){var o;if(0==e)for(o=0;o<r;o++)document.getElementById(i+t+"-"+o).value=n[o];else for(o=0;o<r.length;o++)document.getElementById(i+t+"-"+r[o]).value=n[r[o]]}function quicksetscore(t,e,i){document.getElementById(t).value=e,null!=i&&(t=" | "+_("Quick feedback: "),t=(t=(t+='<a href="#" onclick="return quicksetfb(this)">'+_("Good!")+"</a> | ")+'<a href="#" onclick="return quicksetfb(this)">'+_("Great work.")+"</a> | ")+'<a href="#" onclick="return quicksetfb(this)">'+_("Excellent!")+"</a> ",$(i).siblings(".quickfb").html(t))}function quicksetfb(t){var e=$(t).text(),t=$(t).closest(".review, .scoredetails").find(".fbbox").attr("id");return window.tinymce?tinymce.get(t).setContent(e):document.getElementById(t).value=e,!1}function markallfullscore(){$(".quickgrade").click()}function revealfb(t,e){return $("#fb-"+t+"-wrap").show(),$("#fb-"+t+"-add").hide(),e&&$("#fb-"+t).focus(),!1}
