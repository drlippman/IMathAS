var rubricbase,lastrubricpos;function imasrubric_getpttot(t){for(var e=0,r=0;r<imasrubrics[t].data.length;r++)0==imasrubrics[t].type||1==imasrubrics[t].type?e+=imasrubrics[t].data[r][2]:3!=imasrubrics[t].type&&4!=imasrubrics[t].type||(e=Math.max(e,imasrubrics[t].data[r][2]));return e=Math.round(10*e)/10}function imasrubric_show(t,e,r,i,a,c){var n="<div style='margin: 10px;'><form id='imasrubricform'><table><thead>";imasrubrics[t].type<2?(n+="<tr><th>"+_("Item")+'</th><th><a href="#" onclick="imasrubric_fullcredit();return false;">'+_("Full Credit")+"</a></th>",n+='<th><a href="#" onclick="imasrubric_nocredit();return false;">'+_("No Credit")+"</a></th><th>"+_("Other")+"</th></tr>"):imasrubrics[t].type<2?n+="<tr><th>"+_("Feedback")+"</th><th>"+_("Select")+"</th></tr>":n+="<tr><th>"+_("Feedback")+"</th><th>"+_("Points")+"</th></tr>",n+="</thead><tbody>";for(var s=imasrubric_getpttot(t),u=0;u<imasrubrics[t].data.length;u++)0==imasrubrics[t].type||1==imasrubrics[t].type?(n+="<tr scope=row role=group aria-labelledby=rr"+u+"><th><span id=rr"+u+">"+imasrubrics[t].data[u][0]+"</span>",""!=imasrubrics[t].data[u][1]&&(n+="<br/><i>"+imasrubrics[t].data[u][1]+"</i>"),totpts=Math.round(100*Math.round(e*imasrubrics[t].data[u][2])/s)/100,n+='</th><td width="10%" style="white-space:nowrap;"><label><input type="radio" name="rubricgrp'+u+'" value="'+totpts+'"/> '+totpts+"</label></td>",n+='<td width="10%"><label><input type="radio" name="rubricgrp'+u+'" value="0" checked="checked"/> 0</label></td>',n+='<td width="10%" style="white-space:nowrap;"><label><input type="radio" name="rubricgrp'+u+'" id="rubricgrpother'+u+'" value="-1"/> Other</label>: <input onfocus="document.getElementById(\'rubricgrpother'+u+'\').checked=true" type="number" step="0.1" min="0" max="'+totpts+'" size="3" id="rubricother'+u+'" value="" aria-label="points to assign"/></td></tr>'):2==imasrubrics[t].type?(n+="<tr><th scope=row><label for=rubricchk"+u+">"+imasrubrics[t].data[u][0]+"</label>",""!=imasrubrics[t].data[u][1]&&(n+="<br/><i>"+imasrubrics[t].data[u][1]+"</i>"),n+='</th><td><input type="checkbox" id="rubricchk'+u+'" value="1"/></td></tr>'):3!=imasrubrics[t].type&&4!=imasrubrics[t].type||(n+="<tr><th scope=row>"+imasrubrics[t].data[u][0],""!=imasrubrics[t].data[u][1]&&(n+="<br/><i>"+imasrubrics[t].data[u][1]+"</i>"),totpts=Math.round(100*Math.round(e*imasrubrics[t].data[u][2])/s)/100,n+='</th><td width="10%"><label><input type="radio" name="rubricgrp" value="'+u+'"/> '+totpts+"</label></td></tr>");n+='</tbody></table><br/><input type="button" value="Record" onclick="imasrubric_record(\''+t+"','"+r+"','"+i+"','"+a+"',"+e+',false)" />',n+='<input type="button" value="Clear Existing and Record" onclick="imasrubric_record(\''+t+"','"+r+"','"+i+"','"+a+"',"+e+',true)" /></form></div>',GB_show(_("Rubric"),n,800,"content")}function imasrubric_record(t,e,r,i,a,c){var n="",s="";if(null!==i&&"null"!==i&&(s="#"+i+": "),window.tinymce)var u=tinymce.get(r).getContent();else u=$("textarea[name="+r+"]").val();var o=imasrubric_getpttot(t);if(0==imasrubrics[t].type||1==imasrubrics[t].type){for(var d=0,l=0;l<imasrubrics[t].data.length;l++)val=getRadioValue("rubricgrp"+l),-1==val?thisscore=1*document.getElementById("rubricother"+l).value:thisscore=1*val,d+=thisscore,totpts=Math.round(a*imasrubrics[t].data[l][2])/o,n+="<li>"+imasrubrics[t].data[l][0]+": "+thisscore+"/"+totpts+".</li>";""!=n&&(n=s+"<ul class=nomark>"+n+"</ul>"),document.getElementById(e).value=d,1==imasrubrics[t].type&&(c?window.tinymce?tinymce.get(r).setContent(n):document.getElementById(r).value=n:window.tinymce?tinymce.get(r).setContent(u+n):document.getElementById(r).value=u+n)}else if(2==imasrubrics[t].type){for(l=0;l<imasrubrics[t].data.length;l++)document.getElementById("rubricchk"+l).checked&&(n+="<li>"+imasrubrics[t].data[l][0]+".</li>");""!=n&&(n=s+"<ul class=nomark>"+n+"</ul>"),c?window.tinymce?tinymce.get(r).setContent(n):document.getElementById(r).value=n:window.tinymce?tinymce.get(r).setContent(u+n):document.getElementById(r).value=u+n}else 3!=imasrubrics[t].type&&4!=imasrubrics[t].type||(loc=getRadioValue("rubricgrp"),totpts=Math.round(a*imasrubrics[t].data[loc][2])/o,n+=s+imasrubrics[t].data[loc][0],document.getElementById(e).value=totpts,3==imasrubrics[t].type&&(c?window.tinymce?tinymce.get(r).setContent(n):document.getElementById(r).value=n:window.tinymce?tinymce.get(r).setContent(u+n):document.getElementById(r).value=u+n));document.getElementById(r).dispatchEvent(new CustomEvent("input")),document.getElementById(e).dispatchEvent(new CustomEvent("input")),(p=r.match(/^fb-(\d+)/))&&revealfb(p[1]),GB_hide()}function imasrubric_chgtype(){var t=document.getElementById("rubtype").value;els=document.getElementsByTagName("input"),2==t?($(".rubricpoints").hide(),$("#breakdowninstr").hide(),$("#scoretotalinstr").hide()):$(".rubricpoints").show(),t<2?($("#pointsheader").text(_("Portion of Score")),$("#breakdowninstr").show(),$("#scoretotalinstr").hide()):t>2&&($("#pointsheader").text(_("Total Score")),$("#breakdowninstr").hide(),$("#scoretotalinstr").show()),0==t||4==t?$(".hfeedback").hide():$(".hfeedback").show()}function imasrubric_fullcredit(){$("#imasrubricform tr").each((function(){$(this).find("input[type=radio]").first().prop("checked",!0)}))}function imasrubric_nocredit(){$("#imasrubricform tr").each((function(){$(this).find("input[type=radio]").eq(1).prop("checked",!0)}))}function getRadioValue(t){for(var e=document.getElementsByName(t),r=0;r<e.length;r++)if(e[r].checked)return e[r].value}function quickgrade(t,e,r,i,a){if(0==e)for(var c=0;c<i;c++)document.getElementById(r+t+"-"+c).value=a[c];else for(c=0;c<i.length;c++)document.getElementById(r+t+"-"+i[c]).value=a[i[c]]}function quicksetscore(t,e,r){if(document.getElementById(t).value=e,null!=r){var i=" | "+_("Quick feedback: ");i+='<a href="#" onclick="return quicksetfb(this)">'+_("Good!")+"</a> | ",i+='<a href="#" onclick="return quicksetfb(this)">'+_("Great work.")+"</a> | ",i+='<a href="#" onclick="return quicksetfb(this)">'+_("Excellent!")+"</a> ",$(r).siblings(".quickfb").html(i)}}function quicksetfb(t){var e=$(t).text(),r=$(t).closest(".review, .scoredetails").find(".fbbox").attr("id");return window.tinymce?tinymce.get(r).setContent(e):document.getElementById(r).value=e,!1}function markallfullscore(){$(".quickgrade").click()}function revealfb(t,e){return $("#fb-"+t+"-wrap").show(),$("#fb-"+t+"-add").hide(),e&&$("#fb-"+t).focus(),!1}