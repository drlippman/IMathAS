/**
 * Copyleft 2010-2011 Jay and Han (laughinghan@gmail.com)
 *   under the GNU Lesser General Public License
 *     http://www.gnu.org/licenses/lgpl.html
 * Project Website: http://mathquill.com
 */
(function(){function b(){}function t(n){var t=ti.call(arguments,1);return function(){return n.apply(this,t)}}function y(n,t){if(!t)throw new Error("prayer failed: "+n);}function nt(n){y("a direction was passed",n===i||n===r)}function ci(n,t,u,f){function p(){v=dt;var n=e.selection?"$"+e.selection.latex()+"$":"";a.select(n)}var w=n.contents().detach(),e,h,s,v,l,y,a;if(u||n.addClass("mathquill-rendered-math"),t.jQ=n.attr(c,t.id),t.revert=function(){n.empty().unbind(".mathquill").removeClass("mathquill-rendered-math mathquill-editable mathquill-textbox").append(w)},e=t.cursor=ki(t),t.renderLatex(w.text()),navigator.userAgent.match("Android")?(h=t.textarea=o('<span class="textarea"><input type="password"/></span>'),s=h.children()):(h=t.textarea=o('<span class="textarea"><textarea></textarea></span>'),s=h.children()),t.selectionChanged=function(){v===dt&&(v=setTimeout(p)),li(n[0])},n.bind("selectstart.mathquill",function(n){n.target!==s[0]&&n.preventDefault(),n.stopPropagation()}),y=e.blink,n.bind("mousedown.mathquill",function(t){function u(n){return e.seek(o(n.target),n.pageX,n.pageY),(e[i]!==l[i]||e.parent!==l.parent)&&e.selectFrom(l),!1}function a(n){return delete n.target,u(n)}function c(t){l=dt,e.blink=y,e.selection||(f?e.show():h.detach()),n.unbind("mousemove",u),o(t.target.ownerDocument).unbind("mousemove",a).unbind("mouseup",c)}return setTimeout(function(){document.activeElement!=s[0]&&s.focus()}),e.blink=b,e.seek(o(t.target),t.pageX,t.pageY),l=bt(e.parent,e[i],e[r]),f||n.prepend(h),n.mousemove(u),o(t.target.ownerDocument).mousemove(a).mouseup(c),!1}),!f){a=oi(s,{container:n}),n.bind("cut paste",!1).bind("copy",p).prepend('<span class="selectable">$'+t.latex()+"$</span>"),s.blur(function(){e.clearSelection(),setTimeout(k)});function k(){h.detach()}return}a=oi(s,{container:n,key:function(n,t){e.parent.bubble("onKey",n,t)},text:function(n){e.parent.bubble("onText",n)},cut:function(n){e.selection&&setTimeout(function(){e.prepareEdit(),e.parent.bubble("redraw")}),n.stopPropagation()},paste:function(n){n=n.slice(0,1)==="$"&&n.slice(-1)==="$"?n.slice(1,-1):"\\text{"+n+"}",e.writeLatex(n).show()}}),n.prepend(h),n.addClass("mathquill-editable"),u&&n.addClass("mathquill-textbox"),s.focus(function(n){e.parent||e.insAtRightEnd(t),e.parent.jQ.addClass("hasCursor"),e.selection?(e.selection.jQ.removeClass("blur"),setTimeout(t.selectionChanged)):e.show(),n.stopPropagation()}).blur(function(n){e.hide().parent.blur(),e.selection&&e.selection.jQ.addClass("blur"),n.stopPropagation()}),n.bind("focus.mathquill blur.mathquill",function(n){s.trigger(n)}).bind("click.mathquill",function(){document.activeElement!=s[0]&&s.focus()}).blur()}function rt(n,t,i){return f(vt,{ctrlSeq:n,htmlTemplate:"<"+t+" "+i+">&0</"+t+">"})}var k=window.jQuery,dt,ur,ai="mathquill-command-id",c="mathquill-block-id",fi=Math.min,rr=Math.max,ti=[].slice,hi=navigator.userAgent.match("Android"),f=function(n,t,i){function e(n){return typeof n=="object"}function r(n){return typeof n=="function"}function f(){}function u(o,s){function h(){var n=new a;return r(n.init)&&n.init.apply(n,arguments),n}function a(){}s===i&&(s=o,o=Object),h.Bare=a;var v=f[n]=o[n],l=a[n]=h[n]=new f,c;return l.constructor=h,h.mixin=function(t){return a[n]=h[n]=u(h,t)[n],h},(h.open=function(n){if(c={},r(n)?c=n.call(h,l,v,h,o):e(n)&&(c=n),e(c))for(var i in c)t.call(c,i)&&(l[i]=c[i]);return r(l.init)||(l.init=o),h})(s)}return u}("prototype",{}.hasOwnProperty),oi=function(){function n(n){var f=n.which||n.keyCode,u=t[f],r,i=[];return(n.ctrlKey&&i.push("Ctrl"),n.originalEvent&&n.originalEvent.metaKey&&i.push("Meta"),n.altKey&&i.push("Alt"),n.shiftKey&&i.push("Shift"),r=u||String.fromCharCode(f),!i.length&&!u)?r:(i.push(r),i.join("-"))}var t={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(t,i){function h(n){e=n,clearTimeout(o),o=setTimeout(n)}function rt(n){e(),e=b,clearTimeout(o),u.val(n),n&&u[0].select()}function it(){var n=u[0];return"selectionStart"in n?n.selectionStart!==n.selectionEnd:document.selection&&document.selection.type==="Text"&&document.selection.createRange&&document.selection.createRange().parentElement()===u[0]?!0:!1}function s(n){var t=k.trim(u.val());u.val(" "),t&&n(t)}function l(){g(n(r),r)}function v(n){r=n,f=null;var t=r.which||r.keyCode;hi?c():l()}function c(n){var t=r.which||r.keyCode;r&&(f||hi)&&l(),f=n,h(d)}function d(){it()||s(ut)}function w(){r=f=null}function p(){u.focus(),h(y)}function y(){s(nt)}var r=null,f=null;i||(i={});var ut=i.text||b,g=i.key||b,nt=i.paste||b,tt=i.cut||b,u=k(t),a=k(i.container||u),e=b,o;return a.bind("keydown keypress input keyup focusout paste",function(){e()}),a.bind({keydown:v,keypress:c,focusout:w,cut:tt,paste:p}),{select:rt}}}(),h=f(function(n,t,i){function e(n,t){n=n?"'"+n+"'":"EOF";throw"Parse Error: "+t+" at "+n;}n.init=function(n){this._=n},n.parse=function(n){function t(n,t){return t}return this.skip(f)._(n,t,e)},n.or=function(n){y("or is passed a parser",n instanceof i);var t=this;return i(function(i,r,u){function f(){return n._(i,r,u)}return t._(i,r,f)})},n.then=function(n){var t=this;return i(function(r,u,f){function e(t,r){var e=n instanceof i?n:n(r);return y("a parser is returned",e instanceof i),e._(t,u,f)}return t._(r,e,f)})},n.many=function(){var n=this;return i(function(t,i){function e(n,i){return t=n,u.push(i),!0}function f(){return!1}for(var u=[];n._(t,e,f););return i(t,u)})},n.times=function(n,t){arguments.length<2&&(t=n);var r=this;return i(function(i,u,f){function s(n,t){return h.push(t),i=n,!0}function a(n,t){return c=t,i=n,!1}function l(){return!1}for(var h=[],o=!0,c,e=0;e<n;e+=1)if(o=r._(i,s,a),!o)return f(i,c);for(;e<t&&o;e+=1)o=r._(i,s,l);return u(i,h)})},n.result=function(n){return this.then(u(n))},n.atMost=function(n){return this.times(0,n)},n.atLeast=function(n){var t=this;return t.times(n).then(function(n){return t.many().map(function(t){return n.concat(t)})})},n.map=function(n){return this.then(function(t){return u(n(t))})},n.skip=function(n){return this.then(function(t){return n.result(t)})};var v=this.string=function(n){var t=n.length,r="expected '"+n+"'";return i(function(i,u,f){var e=i.slice(0,t);return e===n?u(i.slice(t),e):f(i,r)})},r=this.regex=function(n){y("regexp parser is anchored",n.toString().charAt(1)==="^");var t="expected "+n;return i(function(i,r,u){var e=n.exec(i),f;return e?(f=e[0],r(i.slice(f.length),f)):u(i,t)})},u=i.succeed=function(n){return i(function(t,i){return i(t,n)})},a=i.fail=function(n){return i(function(t,i,r){return r(t,n)})},l=i.letter=r(/^[a-z]/i),p=i.letters=r(/^[a-z]*/i),b=i.digit=r(/^[0-9]/),w=i.digits=r(/^[0-9]*/),s=i.whitespace=r(/^\s+/),o=i.optWhitespace=r(/^\s*/),h=i.any=i(function(n,t,i){return n?t(n.slice(1),n.charAt(0)):i(n,"expected any character")}),c=i.all=i(function(n,t){return t("",n)}),f=i.eof=i(function(n,t,i){return n?i(n,"expected EOF"):t(n,n)})}),i=-1,r=1,o=f(k,function(n){n.insDirOf=function(n,t){return n===i?this.insertBefore(t.first()):this.insertAfter(t.last())},n.insAtDirEnd=function(n,t){return n===i?this.prependTo(t):this.appendTo(t)}}),bt=f(function(n){n.parent=0,n[i]=0,n[r]=0,n.init=function(n,t,u){this.parent=n,this[i]=t,this[r]=u}}),ii=f(function(n){n[i]=0,n[r]=0,n.parent=0,n.init=function(){this.ends={},this.ends[i]=0,this.ends[r]=0},n.children=function(){return at(this.ends[i],this.ends[r])},n.eachChild=function(n){return this.children().each(n)},n.foldChildren=function(n,t){return this.children().fold(n,t)},n.adopt=function(n,t,i){return at(this,this).adopt(n,t,i),this},n.disown=function(){return at(this,this).disown(),this}}),at=f(function(n){function t(n,t,u){y("a parent is always present",n),y("leftward is properly set up",function(){return t?t[r]===u&&t.parent===n:n.ends[i]===u}()),y("rightward is properly set up",function(){return u?u[i]===t&&u.parent===n:n.ends[r]===t}())}n.init=function(n,t){(y("no half-empty fragments",!n==!t),this.ends={},n)&&(y("left end node is passed to Fragment",n instanceof ii),y("right end node is passed to Fragment",t instanceof ii),y("leftEnd and rightEnd have the same parent",n.parent===t.parent),this.ends[i]=n,this.ends[r]=t)},n.adopt=function(n,u,f){var e,s,o;return(t(n,u,f),e=this,e.disowned=!1,s=e.ends[i],!s)?this:(o=e.ends[r],u||(n.ends[i]=s),f?f[i]=o:n.ends[r]=o,e.ends[r][r]=f,e.each(function(t){t[i]=u,t.parent=n,u&&(u[r]=t),u=t}),e)},n.disown=function(){var f=this,n=f.ends[i],u,e;return!n||f.disowned?f:(f.disowned=!0,u=f.ends[r],e=n.parent,t(e,n[i],n),t(e,u,u[r]),n[i]?n[i][r]=u[r]:e.ends[i]=u[r],u[r]?u[r][i]=n[i]:e.ends[r]=n[i],f)},n.each=function(n){var u=this,t=u.ends[i];if(!t)return u;for(;t!==u.ends[r][r];t=t[r])if(n.call(u,t)===!1)break;return u},n.fold=function(n,t){return this.each(function(i){n=t.call(this,n,i)}),n}}),wi=function(){var n=0;return function(){return n+=1}}(),s=f(ii,function(n,t){n.init=function(){t.init.call(this),this.id=wi(),s[this.id]=this},n.toString=function(){return"[MathElement "+this.id+"]"},n.bubble=function(n){for(var r=ti.call(arguments,1),i,t=this;t;t=t.parent)if(i=t[n]&&t[n].apply(t,r),i===!1)break;return this},n.postOrder=function(n){var r=ti.call(arguments,1),t;typeof n=="string"&&(t=n,n=function(n){t in n&&n[t].apply(n,r)}),function i(t){t.eachChild(i),n(t)}(this)},n.jQ=o(),n.jQadd=function(n){this.jQ=this.jQ.add(n)},this.jQize=function(n){var t=o(n);return t.find("*").andSelf().each(function(){var n=o(this),i=n.attr("mathquill-command-id"),t=n.attr("mathquill-block-id");i&&s[i].jQadd(n),t&&s[t].jQadd(n)}),t},n.finalizeInsert=function(){var n=this;n.postOrder("finalizeTree"),n.postOrder("blur"),n.postOrder("respace"),n[r].respace&&n[r].respace(),n[i].respace&&n[i].respace(),n.postOrder("redraw"),n.bubble("redraw")}}),a=f(s,function(n,t){n.init=function(n,i,r){var u=this;t.init.call(u),u.ctrlSeq||(u.ctrlSeq=n),i&&(u.htmlTemplate=i),r&&(u.textTemplate=r)},n.replaces=function(n){n.disown(),this.replacedFragment=n},n.isEmpty=function(){return this.foldChildren(!0,function(n,t){return n&&t.isEmpty()})},n.parser=function(){var t=ut.block,n=this;return t.times(n.numBlocks()).map(function(t){n.blocks=t;for(var i=0;i<t.length;i+=1)t[i].adopt(n,n.ends[r],0);return n})},n.createLeftOf=function(n){var t=this,u=t.replacedFragment;t.createBlocks(),s.jQize(t.html()),u&&(u.adopt(t.ends[i],0,0),u.jQ.appendTo(t.ends[i].jQ)),n.jQ.before(t.jQ),n[i]=t.adopt(n.parent,n[i],n[r]),t.finalizeInsert(n),t.placeCursor(n)},n.createBlocks=function(){for(var t=this,u=t.numBlocks(),f=t.blocks=Array(u),i,n=0;n<u;n+=1)i=f[n]=p(),i.adopt(t,t.ends[r],0)},n.respace=b,n.placeCursor=function(n){n.insAtRightEnd(this.foldChildren(this.ends[i],function(n,t){return n.isEmpty()?n:t}))},n.remove=function(){return this.disown(),this.jQ.remove(),this.postOrder(function(n){delete s[n.id]}),this},n.numBlocks=function(){var n=this.htmlTemplate.match(/&\d+/g);return n?n.length:0},n.html=function(){var u=this,e=u.blocks,f=" mathquill-command-id="+u.id,i=u.htmlTemplate.match(/<[^<>]+>|[^<>]+/g),t,n,r;for(y("no unmatched angle brackets",i.join("")===this.htmlTemplate),t=0,n=i[0];n;t+=1,n=i[t])if(n.slice(-2)==="/>")i[t]=n.slice(0,-2)+f+"/>";else if(n.charAt(0)==="<"){y("not an unmatched top-level close tag",n.charAt(1)!=="/"),i[t]=n.slice(0,-1)+f+">",r=1;do t+=1,n=i[t],y("no missing close tags",n),n.slice(0,2)==="</"?r-=1:n.charAt(0)==="<"&&n.slice(-2)!=="/>"&&(r+=1);while(r>0)}return i.join("").replace(/>&(\d+)/g,function(n,t){return" mathquill-block-id="+e[t].id+">"+e[t].join("html")})},n.latex=function(){return this.foldChildren(this.ctrlSeq,function(n,t){return n+"{"+(t.latex()||" ")+"}"})},n.textTemplate=[""],n.text=function(){var n=0;return this.foldChildren(this.textTemplate[n],function(t,i){n+=1;var r=i.text();return t&&this.textTemplate[n]==="("&&r[0]==="("&&r.slice(-1)===")"?t+r.slice(1,-1)+this.textTemplate[n]:t+i.text()+(this.textTemplate[n]||"")})}}),g=f(a,function(n,t){n.init=function(n,i,r){r||(r=n&&n.length>1?n.slice(1):n),t.init.call(this,n,i,[r])},n.parser=function(){return h.succeed(this)},n.numBlocks=function(){return 0},n.replaces=function(n){n.remove()},n.createBlocks=b,n.latex=function(){return this.ctrlSeq},n.text=function(){return this.textTemplate},n.placeCursor=b,n.isEmpty=function(){return!0}}),p=f(s,function(t){t.join=function(n){return this.foldChildren("",function(t,i){return t+i[n]()})},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[i]===this.ends[r]?this.ends[i].text():"("+this.join("text")+")"},t.isEmpty=function(){return this.ends[i]===0&&this.ends[r]===0},t.write=function(t,i,r){var f;f=i.match(/^[a-eg-zA-Z]$/)?l(i):(f=v[i]||n[i])?f(i):u(i),r&&f.replaces(r),f.createLeftOf(t)},t.focus=function(){return this.jQ.addClass("hasCursor"),this.jQ.removeClass("empty"),this},t.blur=function(){return this.jQ.removeClass("hasCursor"),this.isEmpty()&&this.jQ.addClass("empty"),this}}),pt=f(at,function(n,t){n.init=function(n,i){t.init.call(this,n,i||n),this.jQ=this.fold(o(),function(n,t){return t.jQ.add(n)})},n.latex=function(){return this.fold("",function(n,t){return n+t.latex()})},n.remove=function(){return this.jQ.remove(),this.each(function(n){n.postOrder(function(n){delete s[n.id]})}),this.disown()}}),ht=f(p,function(n,t){n.latex=function(){return t.latex.call(this).replace(/(\\[a-z]+) (?![a-z])/ig,"$1")},n.text=function(){return this.foldChildren("",function(n,t){return n+t.text()})},n.renderLatex=function(n){var t=this.jQ;t.children().slice(1).remove(),this.ends[i]=this.ends[r]=0,delete this.cursor.selection,this.cursor.insAtRightEnd(this).writeLatex(n)},n.onKey=function(n,t){var u;switch(n){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":while(this.cursor[i]||this.cursor.selection)this.cursor.backspace();break;case"Shift-Backspace":case"Backspace":this.cursor.backspace();break;case"Esc":case"Tab":case"Spacebar":if(u=this.cursor.parent,u===this.cursor.root){n==="Spacebar"&&t.preventDefault();return}this.cursor.prepareMove(),u[r]?this.cursor.insAtLeftEnd(u[r]):this.cursor.insRightOf(u.parent);break;case"Shift-Tab":case"Shift-Esc":case"Shift-Spacebar":if(u=this.cursor.parent,u===this.cursor.root){n==="Shift-Spacebar"&&t.preventDefault();return}this.cursor.prepareMove(),u[i]?this.cursor.insAtRightEnd(u[i]):this.cursor.insLeftOf(u.parent);break;case"Enter":typeof savemathquill=="function"&&savemathquill();break;case"End":this.cursor.prepareMove().insAtRightEnd(this.cursor.parent);break;case"Ctrl-End":this.cursor.prepareMove().insAtRightEnd(this);break;case"Shift-End":while(this.cursor[r])this.cursor.selectRight();break;case"Ctrl-Shift-End":while(this.cursor[r]||this.cursor.parent!==this)this.cursor.selectRight();break;case"Home":this.cursor.prepareMove().insAtLeftEnd(this.cursor.parent);break;case"Ctrl-Home":this.cursor.prepareMove().insAtLeftEnd(this);break;case"Shift-Home":while(this.cursor[i])this.cursor.selectLeft();break;case"Ctrl-Shift-Home":while(this.cursor[i]||this.cursor.parent!==this)this.cursor.selectLeft();break;case"Left":this.cursor.moveLeft();break;case"Shift-Left":this.cursor.selectLeft();break;case"Ctrl-Left":break;case"Right":this.cursor.moveRight();break;case"Shift-Right":this.cursor.selectRight();break;case"Ctrl-Right":break;case"Up":this.cursor.moveUp();break;case"Down":this.cursor.moveDown();break;case"Shift-Up":if(this.cursor[i])while(this.cursor[i])this.cursor.selectLeft();else this.cursor.selectLeft();case"Shift-Down":if(this.cursor[r])while(this.cursor[r])this.cursor.selectRight();else this.cursor.selectRight();case"Ctrl-Up":break;case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":while(this.cursor[r]||this.cursor.selection)this.cursor.deleteForward();break;case"Shift-Del":case"Del":this.cursor.deleteForward();break;case"Meta-A":case"Ctrl-A":if(this!==this.cursor.root)return;for(this.cursor.prepareMove().insAtRightEnd(this);this.cursor[i];)this.cursor.selectLeft();break;default:return!1}return t.preventDefault(),!1},n.onText=function(n){return this.cursor.write(n),!1}}),ni=f(a,function(n,t){n.init=function(n){t.init.call(this,"$"),this.cursor=n},n.htmlTemplate='<span class="mathquill-rendered-math">&0</span>',n.createBlocks=function(){this.ends[i]=this.ends[r]=ht(),this.blocks=[this.ends[i]],this.ends[i].parent=this,this.ends[i].cursor=this.cursor,this.ends[i].write=function(n,t,f){t!=="$"?p.prototype.write.call(this,n,t,f):this.isEmpty()?(n.insRightOf(this.parent).backspace().show(),u("\\$","$").createLeftOf(n)):n[r]?n[i]?p.prototype.write.call(this,n,t,f):n.insLeftOf(this.parent):n.insRightOf(this.parent)}},n.latex=function(){return"$"+this.ends[i].latex()+"$"}}),bi=f(p,function(n){n.renderLatex=function(n){var t=this,c=t.cursor,f,l;t.jQ.children().slice(1).remove(),t.ends[i]=t.ends[r]=0,delete c.selection,c.show().insAtRightEnd(t);var y=h.regex,o=h.string,a=h.eof,v=h.all,w=o("$").then(ut).skip(o("$").or(a)).map(function(n){var t=ni(c),r;return t.createBlocks(),r=t.ends[i],n.children().adopt(r,0,0),t}),b=o("\\$").result("$"),k=b.or(y(/^[^$]/)).map(u),p=w.or(k).many(),e=p.skip(a).or(v.result(!1)).parse(n);if(e){for(f=0;f<e.length;f+=1)e[f].adopt(t,t.ends[r],0);l=t.join("html"),s.jQize(l).appendTo(t.jQ),this.finalizeInsert()}},n.onKey=function(n){n!=="Spacebar"&&n!=="Shift-Spacebar"&&ht.prototype.onKey.apply(this,arguments)},n.onText=ht.prototype.onText,n.write=function(n,t,i){if(i&&i.remove(),t==="$")ni(n).createLeftOf(n);else{var r;t==="<"?r="&lt;":t===">"&&(r="&gt;"),u(t,r).createLeftOf(n)}}}),v={},n={},st,li=b,pi=document.createElement("div"),si=pi.style,gi={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1},ui,gt,tt,w,lt,wt,yt,kt,l,u,ot,it,e,ct,et,ri;for(gt in gi)if(gt in si){ui=gt;break}ui?st=function(n,t,i){n.css(ui,"scale("+t+","+i+")")}:"filter"in si?(li=function(n){n.className=n.className},st=function(n,t,i){function r(){n.css("marginRight",(1+n.width())*(t-1)/t+"px")}t/=1+(i-1)/2,n.addClass("matrixed").css({fontSize:i+.05+"em",marginTop:"-.05em",filter:"progid:DXImageTransform.Microsoft.Matrix(M11="+t+",SizingMethod='auto expand')"}),r();var u=setInterval(r);o(window).load(function(){clearTimeout(u),r()})}):st=function(n,t,i){n.css("fontSize",i+"em")},tt=f(a,function(n,t){n.init=function(n,i,r){t.init.call(this,n,"<"+i+" "+r+">&0</"+i+">")}}),n.mathrm=t(tt,"\\mathrm","span",'class="roman font"'),n.mathit=t(tt,"\\mathit","i",'class="font"'),n.mathbf=t(tt,"\\mathbf","b",'class="font"'),n.mathsf=t(tt,"\\mathsf","span",'class="sans-serif font"'),n.mathtt=t(tt,"\\mathtt","span",'class="monospace font"'),n.underline=t(tt,"\\underline","span",'class="non-leaf underline"'),n.overline=n.bar=t(tt,"\\overline","span",'class="non-leaf overline"'),w=f(a,function(n,t){n.init=function(n,i,r){t.init.call(this,n,"<"+i+' class="non-leaf">&0</'+i+">",[r])},n.finalizeTree=function(){function n(n){var i=this.parent,t=n;do{if(t[r])return n.insLeftOf(i),!1;t=t.parent.parent}while(t!==i);return n.insRightOf(i),!1}y("SupSub is only _ and ^",this.ctrlSeq==="^"||this.ctrlSeq==="_"),this.ctrlSeq==="_"?(this.down=this.ends[i],this.ends[i].up=n):(this.up=this.ends[i],this.ends[i].down=n)},n.latex=function(){var n=this.ends[i].latex();return n.length===1?this.ctrlSeq+n:this.ctrlSeq+"{"+(n||" ")+"}"},n.redraw=function(){this[i]&&this[i].respace(),this[i]instanceof w||(this.respace(),!this[r]||this[r]instanceof w||this[r].respace())},n.respace=function(){if(this[i].ctrlSeq==="\\int "||this[i]instanceof w&&this[i].ctrlSeq!=this.ctrlSeq&&this[i][i]&&this[i][i].ctrlSeq==="\\int "?this.limit||(this.limit=!0,this.jQ.addClass("limit")):this.limit&&(this.limit=!1,this.jQ.removeClass("limit")),this.respaced=this[i]instanceof w&&this[i].ctrlSeq!=this.ctrlSeq&&!this[i].respaced,this.respaced){var t=+this.jQ.css("fontSize").slice(0,-2),n=this[i].jQ.outerWidth(),u=this.jQ.outerWidth();this.jQ.css({left:(this.limit&&this.ctrlSeq==="_"?-.25:0)-n/t+"em",marginRight:.1-fi(u,n)/t+"em"})}else this.limit&&this.ctrlSeq==="_"?this.jQ.css({left:"-.25em",marginRight:""}):this.jQ.css({left:"",marginRight:""});return this[r]instanceof w&&this[r].respace(),this}}),n.subscript=n._=t(w,"_","sub","_"),n.superscript=n.supscript=n["^"]=t(w,"^","sup","**");var ir=n.frac=n.dfrac=n.cfrac=n.fraction=f(a,function(n){n.ctrlSeq="\\frac",n.htmlTemplate='<span class="fraction non-leaf"><span class="numerator">&0</span><span class="denominator">&1</span><span style="display:inline-block;width:0">&nbsp;</span></span>',n.textTemplate=["(","/",")"],n.finalizeTree=function(){this.up=this.ends[r].up=this.ends[i],this.down=this.ends[i].down=this.ends[r]},n.redraw=function(){if(k.browser.msie&&parseInt(k.browser.version,10)<=7){var r=this.jQ,i=r.children(".numerator"),n=r.children(".denominator"),t;i.css("width","auto"),n.css("width","auto"),t=Math.max(i.width(),n.width()),i.css("width",t+"px"),n.css("width",t+"px")}}}),tr=n.over=v["/"]=f(ir,function(n,t){n.createLeftOf=function(n){if(!this.replacedFragment){for(var u=n[i];u&&!(u instanceof e||u instanceof vt||u instanceof et||",;:".indexOf(u.ctrlSeq)>-1);)u=u[i];u instanceof et&&u[r]instanceof w&&(u=u[r],u[r]instanceof w&&u[r].ctrlSeq!=u.ctrlSeq&&(u=u[r])),u!==n[i]&&(this.replaces(pt(u[r]||n.parent.ends[i],n[i])),n[i]=u)}t.createLeftOf.call(this,n)}}),vi=n.sqrt=n["âˆš"]=f(a,function(n,t){n.ctrlSeq="\\sqrt",n.htmlTemplate='<span class="non-leaf"><span class="scaled sqrt-prefix">&radic;</span><span class="non-leaf sqrt-stem">&0</span></span>',n.textTemplate=["sqrt(",")"],n.parser=function(){return ut.optBlock.then(function(n){return ut.block.map(function(t){var i=yi();return i.blocks=[n,t],n.adopt(i,0,0),t.adopt(i,n,0),i})}).or(t.parser.call(this))},n.redraw=function(){var n=this.ends[r].jQ;st(n.prev(),1,n.innerHeight()/+n.css("fontSize").slice(0,-2)-.1)}}),er=n.vec=f(a,function(n){n.ctrlSeq='\\vec',n.htmlTemplate='<span class="non-leaf"><span class="vector-prefix">&rarr;</span><span class="vector-stem">&0</span></span>',n.textTemplate=["vec(",")"]}),yi=n.nthroot=f(vi,function(n){n.htmlTemplate='<sup class="nthroot non-leaf">&0</sup><span class="scaled"><span class="sqrt-prefix scaled">&radic;</span><span class="sqrt-stem non-leaf">&1</span></span>',n.textTemplate=["sqrt[","](",")"],n.latex=function(){return"\\sqrt["+this.ends[i].latex()+"]{"+this.ends[r].latex()+"}"}}),ft=f(a,function(n,t){n.init=function(n,i,r,u){t.init.call(this,"\\left"+r,'<span class="non-leaf"><span class="scaled paren">'+n+'</span><span class="non-leaf">&0</span><span class="scaled paren">'+i+"</span></span>",[n,i]),this.end="\\right"+u},n.jQadd=function(){t.jQadd.apply(this,arguments);var n=this.jQ;this.bracketjQs=n.children(":first").add(n.children(":last"))},n.latex=function(){return this.ctrlSeq+this.ends[i].latex()+this.end},n.redraw=function(){var t=this.ends[i].jQ,n=t.outerHeight()/+t.css("fontSize").slice(0,-2);st(this.bracketjQs,fi(1+.2*(n-1),1.2),1.05*n)}});n.left=f(a,function(n){n.parser=function(){var t=h.regex,i=h.string,r=h.succeed,n=h.optWhitespace;return n.then(t(/^(?:[([|]|\\\{)/)).then(function(u){u.charAt(0)==="\\"&&(u=u.slice(1));var f=v[u]();return ut.map(function(n){f.blocks=[n],n.adopt(f,0,0)}).then(i("\\right")).skip(n).then(t(/^(?:[\])|]|\\\})/)).then(function(n){return n.slice(-1)!==f.end.slice(-1)?h.fail("open doesn't match close"):r(f)})})}}),n.right=f(a,function(n){n.parser=function(){return h.fail("unmatched \\right")}}),n.intervalopenleft=t(ft,"(","]","(","]"),n.intervalopenright=t(ft,"[",")","[",")"),n.lbrace=v["{"]=t(ft,"{","}","\\{","\\}"),n.langle=n.lang=t(ft,"&lang;","&rang;","\\langle ","\\rangle "),lt=f(ft,function(n,t){n.createLeftOf=function(n){n[r]||!n.parent.parent||n.parent.parent.end!==this.end||this.replacedFragment?t.createLeftOf.call(this,n):n.insRightOf(n.parent.parent)},n.placeCursor=function(n){this.ends[i].blur(),n.insRightOf(this)}}),n.rbrace=v["}"]=t(lt,"{","}","\\{","\\}"),n.rangle=n.rang=t(lt,"&lang;","&rang;","\\langle ","\\rangle "),wt=function(n,t){n.init=function(n,i){t.init.call(this,n,i,n,i)}},yt=f(ft,wt),n.lparen=v["("]=t(yt,"(",")"),n.lbrack=n.lbracket=v["["]=t(yt,"[","]"),kt=f(lt,wt),n.rparen=v[")"]=t(kt,"(",")"),n.rbrack=n.rbracket=v["]"]=t(kt,"[","]");var fr=n.lpipe=n.rpipe=v["|"]=f(yt,function(n,t){n.init=function(){t.init.call(this,"|","|")},n.createLeftOf=lt.prototype.createLeftOf}),vt=v.$=n.text=n.textnormal=n.textrm=n.textup=n.textmd=f(a,function(n,t){n.ctrlSeq="\\text",n.htmlTemplate='<span class="text">&0</span>',n.replaces=function(n){n instanceof pt?this.replacedText=n.remove().jQ.text():typeof n=="string"&&(this.replacedText=n)},n.textTemplate=['"','"'],n.parser=function(){var n=this,t=h.string,e=h.regex,f=h.optWhitespace;return f.then(t("{")).then(e(/^[^}]*/)).skip(t("}")).map(function(t){var e,f,o;for(n.createBlocks(),e=n.ends[i],f=0;f<t.length;f+=1)o=u(t.charAt(f)),o.adopt(e,e.ends[r],0);return n})},n.createBlocks=function(){this.ends[i]=this.ends[r]=di(),this.blocks=[this.ends[i]],this.ends[i].parent=this},n.finalizeInsert=function(){this.ends[i].blur=function(){return delete this.blur,this},t.finalizeInsert.call(this)},n.createLeftOf=function(n){if(t.createLeftOf.call(this,this.cursor=n),this.replacedText)for(var r=0;r<this.replacedText.length;r+=1)this.ends[i].write(n,this.replacedText.charAt(r))}}),di=f(p,function(n,t){n.onKey=function(n){if(n==="Spacebar"||n==="Shift-Spacebar")return!1},n.deleteOutOf=function(n,t){this.isEmpty()&&t.insRightOf(this.parent)},n.write=function(n,t,f){var o,e;return f&&f.remove(),t!=="$"?(t==="<"?o="&lt;":t===">"&&(o="&gt;"),u(t,o).createLeftOf(n)):this.isEmpty()?(n.insRightOf(this.parent).backspace(),u("\\$","$").createLeftOf(n)):n[r]?n[i]?(e=vt(),e.replaces(pt(n[r],this.ends[r])),n.insRightOf(this.parent),e.adopt=function(){delete this.adopt,this.adopt.apply(this,arguments),this[i]=0},e.createLeftOf(n),e[i]=this.parent,n.insLeftOf(e)):n.insLeftOf(this.parent):n.insRightOf(this.parent),!1},n.blur=function(){if(this.jQ.removeClass("hasCursor"),this.isEmpty()){var t=this.parent,n=t.cursor;n.parent===this?this.jQ.addClass("empty"):(n.hide(),t.remove(),n[r]===t?n[r]=t[r]:n[i]===t&&(n[i]=t[i]),n.show().parent.bubble("redraw"))}return this},n.focus=function(){var n,u;if(t.focus.call(this),n=this.parent,n[r].ctrlSeq===n.ctrlSeq){var e=this,u=n.cursor,f=n[r].ends[i];f.eachChild(function(n){n.parent=e,n.jQ.appendTo(e.jQ)}),this.ends[r]?this.ends[r][r]=f.ends[i]:this.ends[i]=f.ends[i],f.ends[i][i]=this.ends[r],this.ends[r]=f.ends[r],f.parent.remove(),u[i]?u.insRightOf(u[i]):u.insAtLeftEnd(this),u.parent.bubble("redraw")}else n[i].ctrlSeq===n.ctrlSeq&&(u=n.cursor,u[i]?n[i].ends[i].focus():u.insAtRightEnd(n[i].ends[i]));return this}});n.em=n.italic=n.italics=n.emph=n.textit=n.textsl=rt("\\textit","i",'class="text"'),n.strong=n.bold=n.textbf=rt("\\textbf","b",'class="text"'),n.sf=n.textsf=rt("\\textsf","span",'class="sans-serif text"'),n.tt=n.texttt=rt("\\texttt","span",'class="monospace text"'),n.textsc=rt("\\textsc","span",'style="font-variant:small-caps" class="text"'),n.uppercase=rt("\\uppercase","span",'style="text-transform:uppercase" class="text"'),n.lowercase=rt("\\lowercase","span",'style="text-transform:lowercase" class="text"');var or=v["\\"]=f(a,function(n,t){n.ctrlSeq="\\",n.replaces=function(n){this._replacedFragment=n.disown(),this.isEmpty=function(){return!1}},n.htmlTemplate='<span class="latex-command-input non-leaf">\\<span>&0</span></span>',n.textTemplate=["\\"],n.createBlocks=function(){t.createBlocks.call(this),this.ends[i].focus=function(){return this.parent.jQ.addClass("hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("empty"),this},this.ends[i].blur=function(){return this.parent.jQ.removeClass("hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("empty"),this}},n.createLeftOf=function(n){if(t.createLeftOf.call(this,n),this.cursor=n.insAtRightEnd(this.ends[i]),this._replacedFragment){var r=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("blur").bind("mousedown mousemove",function(n){return o(n.target=r).trigger(n),!1}).insertBefore(this.jQ).add(this.jQ)}this.ends[i].write=function(n,t,i){i&&i.remove(),t.match(/[a-z]/i)?u(t).createLeftOf(n):(this.parent.renderCommand(),t==="\\"&&this.isEmpty()||this.parent.parent.write(n,t))}},n.latex=function(){return"\\"+this.ends[i].latex()+" "},n.onKey=function(n,t){if(n==="Tab"||n==="Enter"||n==="Spacebar")return this.renderCommand(),t.preventDefault(),!1},n.renderCommand=function(){this.jQ=this.jQ.last(),this.remove(),this[r]?this.cursor.insLeftOf(this[r]):this.cursor.insAtRightEnd(this.parent);var n=this.ends[i].latex(),t;n||(n="backslash"),this.cursor.insertCmd(n,this._replacedFragment)}}),nr=n.binom=n.binomial=f(a,function(n){n.ctrlSeq="\\binom",n.htmlTemplate='<span class="paren scaled">(</span><span class="non-leaf"><span class="array non-leaf"><span>&0</span><span>&1</span></span></span><span class="paren scaled">)</span>',n.textTemplate=["choose(",",",")"],n.redraw=function(){var t=this.jQ.eq(1),n=t.outerHeight()/+t.css("fontSize").slice(0,-2),i=this.jQ.filter(".paren");st(i,fi(1+.2*(n-1),1.2),1.05*n)}}),hr=n.choose=f(nr,function(n){n.createLeftOf=tr.prototype.createLeftOf}),sr=n.vector=f(a,function(n,t){n.ctrlSeq='\\vector',n.htmlTemplate='<span class="array"><span>&0</span></span>',n.latex=function(){return"\\begin{matrix}"+this.foldChildren([],function(n,t){return n.push(t.latex()),n}).join("\\\\")+"\\end{matrix}"},n.text=function(){return"["+this.foldChildren([],function(n,t){return n.push(t.text()),n}).join()+"]"},n.createLeftOf=function(n){t.createLeftOf.call(this,this.cursor=n)},n.onKey=function(n,t){var u=this.cursor.parent,f;if(u.parent===this){if(n==="Enter")return f=p(),f.parent=this,f.jQ=o("<span></span>").attr(c,f.id).insertAfter(u.jQ),u[r]?u[r][i]=f:this.ends[r]=f,f[r]=u[r],u[r]=f,f[i]=u,this.bubble("redraw").cursor.insAtRightEnd(f),t.preventDefault(),!1;if(n!=="Tab"||u[r]){if(t.which===8){if(u.isEmpty())return u[i]?(this.cursor.insAtRightEnd(u[i]),u[i][r]=u[r]):(this.cursor.insLeftOf(this),this.ends[i]=u[r]),u[r]?u[r][i]=u[i]:this.ends[r]=u[i],u.jQ.remove(),this.isEmpty()?this.cursor.deleteForward():this.bubble("redraw"),t.preventDefault(),!1;if(!this.cursor[i])return t.preventDefault(),!1}}else return u.isEmpty()?u[i]?(this.cursor.insRightOf(this),delete u[i][r],this.ends[r]=u[i],u.jQ.remove(),this.bubble("redraw"),t.preventDefault(),!1):void 0:(f=p(),f.parent=this,f.jQ=o("<span></span>").attr(c,f.id).appendTo(this.jQ),this.ends[r]=f,u[r]=f,f[i]=u,this.bubble("redraw").cursor.insAtRightEnd(f),t.preventDefault(),!1)}}});n.editable=f(ni,function(n,t){n.init=function(){a.prototype.init.call(this,"\\editable")},n.jQadd=function(){var n=this,f,u;t.jQadd.apply(n,arguments),f=n.ends[i].disown(),u=n.jQ.children().detach(),n.ends[i]=n.ends[r]=ht(),n.blocks=[n.ends[i]],n.ends[i].parent=n,ci(n.jQ,n.ends[i],!1,!0),n.cursor=n.ends[i].cursor,f.children().adopt(n.ends[i],0,0),u.appendTo(n.ends[i].jQ),n.ends[i].cursor.insAtRightEnd(n.ends[i])},n.latex=function(){return this.ends[i].latex()},n.text=function(){return this.ends[i].text()}}),n.f=t(g,"f",'<var class="florin">&fnof;</var><span style="display:inline-block;width:0">&nbsp;</span>'),l=f(g,function(n,t){n.init=function(n,i){t.init.call(this,n,"<var>"+(i||n)+"</var>")},n.text=function(){var n=this.ctrlSeq;return!this[i]||this[i]instanceof l||this[i]instanceof e||(n="*"+n),!this[r]||this[r]instanceof e||this[r].ctrlSeq==="^"||(n+="*"),n},n.createLeftOf=function(n){var r=this.ctrlSeq,t,u;for(d=n[i];d&&d instanceof l;)r=d.ctrlSeq+r,d=d[i];if(t=r.match(/(sqrt|root|arcsin|arccos|arctan|sin|cos|tan|sec|csc|cot|log|ln)/)){for(u=0;u<t[0].length-1;u++)n.selectLeft();t[0]=="root"&&(t[0]="nthroot{3}"),t[0].match(/(sqrt|root)/)?n.writeLatex("\\"+t[0]+"{}").parent.blur():n.writeLatex("\\"+t[0]+"\\left(\\right)").parent.blur(),n.moveLeft()}else(t=r.match(/(pi|^oo)$/))?(t[0]=="oo"&&(t[0]="infty"),n.selectLeft(),n.writeLatex("\\"+t[0]).parent.blur()):a.prototype.createLeftOf.apply(this,arguments)}}),u=f(g,function(n,t){n.init=function(n,i){t.init.call(this,n,"<span>"+(i||n)+"</span>")}}),v[" "]=t(u,"\\:"," "),n.prime=v["'"]=t(u,"'","&prime;"),ot=f(g,function(n,t){n.init=function(n,i){t.init.call(this,n,'<span class="nonSymbola">'+(i||n)+"</span>")}}),n["@"]=ot,n["&"]=t(ot,"\\&","&amp;"),n["%"]=t(ot,"\\%","%"),n.alpha=n.beta=n.gamma=n.delta=n.zeta=n.eta=n.theta=n.iota=n.kappa=n.mu=n.nu=n.xi=n.rho=n.sigma=n.tau=n.chi=n.psi=n.omega=f(l,function(n,t){n.init=function(n){t.init.call(this,"\\"+n+" ","&"+n+";")}}),n.phi=t(l,"\\phi ","&#981;"),n.phiv=n.varphi=t(l,'\\varphi ',"&phi;"),n.epsilon=t(l,"\\epsilon ","&#1013;"),n.epsiv=n.varepsilon=t(l,'\\varepsilon ',"&epsilon;"),n.piv=n.varpi=t(l,'\\varpi ',"&piv;"),n.sigmaf=n.sigmav=n.varsigma=t(l,'\\varsigma ',"&sigmaf;"),n.thetav=n.vartheta=n.thetasym=t(l,'\\vartheta ',"&thetasym;"),n.upsilon=n.upsi=t(l,"\\upsilon ","&upsilon;"),n.gammad=n.Gammad=n.digamma=t(l,"\\digamma ","&#989;"),n.kappav=n.varkappa=t(l,'\\varkappa ',"&#1008;"),n.rhov=n.varrho=t(l,'\\varrho ',"&#1009;"),n.pi=n["Ï€"]=t(ot,"\\pi ","&pi;"),n.lambda=t(ot,"\\lambda ","&lambda;"),n.Upsilon=n.Upsi=n.upsih=n.Upsih=t(g,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),n.Gamma=n.Delta=n.Theta=n.Lambda=n.Xi=n.Pi=n.Sigma=n.Phi=n.Psi=n.Omega=n.forall=f(u,function(n,t){n.init=function(n){t.init.call(this,"\\"+n+" ","&"+n+";")}}),it=f(a,function(n){n.init=function(n){this.latex=n},n.createLeftOf=function(n){n.writeLatex(this.latex)},n.parser=function(){var n=ut.parse(this.latex).children();return h.succeed(n)}}),n["Â¹"]=t(it,"^1"),n["Â²"]=t(it,"^2"),n["Â³"]=t(it,"^3"),n["Â¼"]=t(it,"\\frac14"),n["Â½"]=t(it,"\\frac12"),n["Â¾"]=t(it,"\\frac34"),e=f(g,function(n,t){n.init=function(n,i,r){t.init.call(this,n,'<span class="binary-operator">'+i+"</span>",r)}}),ct=f(e,function(n){n.init=u.prototype.init,n.respace=function(){return this.jQ[0].className=this[i]?this[i]instanceof e&&this[r]&&!(this[r]instanceof e)?"unary-operator":"binary-operator":"",this}}),n["+"]=t(ct,"+","+"),n["â€“"]=n["-"]=t(ct,"-","&minus;"),n["Â±"]=n.pm=n.plusmn=n.plusminus=t(ct,"\\pm ","&plusmn;"),n.mp=n.mnplus=n.minusplus=t(ct,"\\mp ","&#8723;"),v["*"]=n.sdot=n.cdot=t(e,"\\cdot ","&middot;"),n["="]=t(e,"=","="),n["<"]=t(e,"<","&lt;"),n[">"]=t(e,">","&gt;"),n.notin=n.sim=n.cong=n.equiv=n.oplus=n.otimes=f(e,function(n,t){n.init=function(n){t.init.call(this,"\\"+n+" ","&"+n+";")}}),n.times=t(e,"\\times ","&times;","[x]"),n["Ã·"]=n.div=n.divide=n.divides=t(e,"\\div ","&divide;","[/]"),n["â‰ "]=n.ne=n.neq=t(e,"\\ne ","&ne;"),n.ast=n.star=n.loast=n.lowast=t(e,"\\ast ","&lowast;"),n.therefor=n.therefore=t(e,"\\therefore ","&there4;"),n.cuz=n.because=t(e,"\\because ","&#8757;"),n.prop=n.propto=t(e,"\\propto ","&prop;"),n["â‰ˆ"]=n.asymp=n.approx=t(e,"\\approx ","&asymp;"),n.lt=t(e,"<","&lt;"),n.gt=t(e,">","&gt;"),n["â‰¤"]=n.le=n.leq=t(e,"\\le ","&le;"),n["â‰¥"]=n.ge=n.geq=t(e,"\\ge ","&ge;"),n.isin=n["in"]=t(e,"\\in ","&isin;"),n.ni=n.contains=t(e,"\\ni ","&ni;"),n.notni=n.niton=n.notcontains=n.doesnotcontain=t(e,"\\not\\ni ","&#8716;"),n.sub=n.subset=t(e,"\\subset ","&sub;"),n.sup=n.supset=n.superset=t(e,"\\supset ","&sup;"),n.nsub=n.notsub=n.nsubset=n.notsubset=t(e,"\\not\\subset ","&#8836;"),n.nsup=n.notsup=n.nsupset=n.notsupset=n.nsuperset=n.notsuperset=t(e,"\\not\\supset ","&#8837;"),n.sube=n.subeq=n.subsete=n.subseteq=t(e,"\\subseteq ","&sube;"),n.supe=n.supeq=n.supsete=n.supseteq=n.supersete=n.superseteq=t(e,"\\supseteq ","&supe;"),n.nsube=n.nsubeq=n.notsube=n.notsubeq=n.nsubsete=n.nsubseteq=n.notsubsete=n.notsubseteq=t(e,"\\not\\subseteq ","&#8840;"),n.nsupe=n.nsupeq=n.notsupe=n.notsupeq=n.nsupsete=n.nsupseteq=n.notsupsete=n.notsupseteq=n.nsupersete=n.nsuperseteq=n.notsupersete=n.notsuperseteq=t(e,"\\not\\supseteq ","&#8841;"),et=f(g,function(n,t){n.init=function(n,i){t.init.call(this,n,"<big>"+i+"</big>")}}),n["âˆ‘"]=n.sum=n.summation=t(et,"\\sum ","&sum;"),n["âˆ"]=n.prod=n.product=t(et,"\\prod ","&prod;"),n.coprod=n.coproduct=t(et,"\\coprod ","&#8720;"),n["âˆ«"]=n.int=n.integral=t(et,"\\int ","&int;"),n.N=n.naturals=n.Naturals=t(u,"\\mathbb{N}","&#8469;"),n.P=n.primes=n.Primes=n.projective=n.Projective=n.probability=n.Probability=t(u,"\\mathbb{P}","&#8473;"),n.Z=n.integers=n.Integers=t(u,"\\mathbb{Z}","&#8484;"),n.Q=n.rationals=n.Rationals=t(u,"\\mathbb{Q}","&#8474;"),n.R=n.reals=n.Reals=t(u,"\\mathbb{R}","&#8477;"),n.C=n.complex=n.Complex=n.complexes=n.Complexes=n.complexplane=n.Complexplane=n.ComplexPlane=t(u,"\\mathbb{C}","&#8450;"),n.H=n.Hamiltonian=n.quaternions=n.Quaternions=t(u,"\\mathbb{H}","&#8461;"),n.quad=n.emsp=t(u,"\\quad ","    "),n.qquad=t(u,"\\qquad ","        "),n.diamond=t(u,"\\diamond ","&#9671;"),n.bigtriangleup=t(u,"\\bigtriangleup ","&#9651;"),n.ominus=t(u,"\\ominus ","&#8854;"),n.uplus=t(u,"\\uplus ","&#8846;"),n.bigtriangledown=t(u,"\\bigtriangledown ","&#9661;"),n.sqcap=t(u,"\\sqcap ","&#8851;"),n.triangleleft=t(u,"\\triangleleft ","&#8882;"),n.sqcup=t(u,"\\sqcup ","&#8852;"),n.triangleright=t(u,"\\triangleright ","&#8883;"),n.odot=t(u,"\\odot ","&#8857;"),n.bigcirc=t(u,"\\bigcirc ","&#9711;"),n.dagger=t(u,"\\dagger ","&#0134;"),n.ddagger=t(u,"\\ddagger ","&#135;"),n.wr=t(u,"\\wr ","&#8768;"),n.amalg=t(u,"\\amalg ","&#8720;"),n.models=t(u,"\\models ","&#8872;"),n.prec=t(u,"\\prec ","&#8826;"),n.succ=t(u,"\\succ ","&#8827;"),n.preceq=t(u,"\\preceq ","&#8828;"),n.succeq=t(u,"\\succeq ","&#8829;"),n.simeq=t(u,"\\simeq ","&#8771;"),n.mid=t(u,"\\mid ","&#8739;"),n.ll=t(u,"\\ll ","&#8810;"),n.gg=t(u,"\\gg ","&#8811;"),n.parallel=t(u,"\\parallel ","&#8741;"),n.bowtie=t(u,"\\bowtie ","&#8904;"),n.sqsubset=t(u,"\\sqsubset ","&#8847;"),n.sqsupset=t(u,"\\sqsupset ","&#8848;"),n.smile=t(u,"\\smile ","&#8995;"),n.sqsubseteq=t(u,"\\sqsubseteq ","&#8849;"),n.sqsupseteq=t(u,"\\sqsupseteq ","&#8850;"),n.doteq=t(u,"\\doteq ","&#8784;"),n.frown=t(u,"\\frown ","&#8994;"),n.vdash=t(u,'\\vdash ',"&#8870;"),n.dashv=t(u,"\\dashv ","&#8867;"),n.longleftarrow=t(u,"\\longleftarrow ","&#8592;"),n.longrightarrow=t(u,"\\longrightarrow ","&#8594;"),n.Longleftarrow=t(u,"\\Longleftarrow ","&#8656;"),n.Longrightarrow=t(u,"\\Longrightarrow ","&#8658;"),n.longleftrightarrow=t(u,"\\longleftrightarrow ","&#8596;"),n.updownarrow=t(u,"\\updownarrow ","&#8597;"),n.Longleftrightarrow=t(u,"\\Longleftrightarrow ","&#8660;"),n.Updownarrow=t(u,"\\Updownarrow ","&#8661;"),n.mapsto=t(u,"\\mapsto ","&#8614;"),n.nearrow=t(u,"\\nearrow ","&#8599;"),n.hookleftarrow=t(u,"\\hookleftarrow ","&#8617;"),n.hookrightarrow=t(u,"\\hookrightarrow ","&#8618;"),n.searrow=t(u,"\\searrow ","&#8600;"),n.leftharpoonup=t(u,"\\leftharpoonup ","&#8636;"),n.rightharpoonup=t(u,"\\rightharpoonup ","&#8640;"),n.swarrow=t(u,"\\swarrow ","&#8601;"),n.leftharpoondown=t(u,"\\leftharpoondown ","&#8637;"),n.rightharpoondown=t(u,"\\rightharpoondown ","&#8641;"),n.nwarrow=t(u,"\\nwarrow ","&#8598;"),n.ldots=t(u,"\\ldots ","&#8230;"),n.cdots=t(u,"\\cdots ","&#8943;"),n.vdots=t(u,'\\vdots ',"&#8942;"),n.ddots=t(u,"\\ddots ","&#8944;"),n.surd=t(u,"\\surd ","&#8730;"),n.triangle=t(u,"\\triangle ","&#9653;"),n.ell=t(u,"\\ell ","&#8467;"),n.top=t(u,"\\top ","&#8868;"),n.flat=t(u,"\\flat ","&#9837;"),n.natural=t(u,"\\natural ","&#9838;"),n.sharp=t(u,"\\sharp ","&#9839;"),n.wp=t(u,"\\wp ","&#8472;"),n.bot=t(u,"\\bot ","&#8869;"),n.clubsuit=t(u,"\\clubsuit ","&#9827;"),n.diamondsuit=t(u,"\\diamondsuit ","&#9826;"),n.heartsuit=t(u,"\\heartsuit ","&#9825;"),n.spadesuit=t(u,"\\spadesuit ","&#9824;"),n.oint=t(u,"\\oint ","&#8750;"),n.bigcap=t(u,"\\bigcap ","&#8745;"),n.bigcup=t(u,"\\bigcup ","&#8746;"),n.bigsqcup=t(u,"\\bigsqcup ","&#8852;"),n.bigvee=t(u,"\\bigvee ","&#8744;"),n.bigwedge=t(u,"\\bigwedge ","&#8743;"),n.bigodot=t(u,"\\bigodot ","&#8857;"),n.bigotimes=t(u,"\\bigotimes ","&#8855;"),n.bigoplus=t(u,"\\bigoplus ","&#8853;"),n.biguplus=t(u,"\\biguplus ","&#8846;"),n.lfloor=t(u,"\\lfloor ","&#8970;"),n.rfloor=t(u,"\\rfloor ","&#8971;"),n.lceil=t(u,"\\lceil ","&#8968;"),n.rceil=t(u,"\\rceil ","&#8969;"),n.slash=t(u,"\\slash ","&#47;"),n.opencurlybrace=t(u,"\\opencurlybrace ","&#123;"),n.closecurlybrace=t(u,"\\closecurlybrace ","&#125;"),n.caret=t(u,"\\caret ","^"),n.underscore=t(u,"\\underscore ","_"),n.backslash=t(u,"\\backslash ","\\"),n.vert=t(u,"|"),n.perp=n.perpendicular=t(u,"\\perp ","&perp;"),n.nabla=n.del=t(u,"\\nabla ","&nabla;"),n.hbar=t(u,"\\hbar ","&#8463;"),n.AA=n.Angstrom=n.angstrom=t(u,"\\text\\AA ","&#8491;"),n.ring=n.circ=n.circle=t(u,"\\circ ","&#8728;"),n.bull=n.bullet=t(u,"\\bullet ","&bull;"),n.setminus=n.smallsetminus=t(u,"\\setminus ","&#8726;"),n.not=n["Â¬"]=n.neg=t(u,"\\neg ","&not;"),n["â€¦"]=n.dots=n.ellip=n.hellip=n.ellipsis=n.hellipsis=t(u,"\\dots ","&hellip;"),n.converges=n.darr=n.dnarr=n.dnarrow=n.downarrow=t(u,"\\downarrow ","&darr;"),n.dArr=n.dnArr=n.dnArrow=n.Downarrow=t(u,"\\Downarrow ","&dArr;"),n.diverges=n.uarr=n.uparrow=t(u,"\\uparrow ","&uarr;"),n.uArr=n.Uparrow=t(u,"\\Uparrow ","&uArr;"),n.to=t(e,"\\to ","&rarr;"),n.rarr=n.rightarrow=t(u,"\\rightarrow ","&rarr;"),n.implies=t(e,"\\Rightarrow ","&rArr;"),n.rArr=n.Rightarrow=t(u,"\\Rightarrow ","&rArr;"),n.gets=t(e,"\\gets ","&larr;"),n.larr=n.leftarrow=t(u,"\\leftarrow ","&larr;"),n.impliedby=t(e,"\\Leftarrow ","&lArr;"),n.lArr=n.Leftarrow=t(u,"\\Leftarrow ","&lArr;"),n.harr=n.lrarr=n.leftrightarrow=t(u,"\\leftrightarrow ","&harr;"),n.iff=t(e,"\\Leftrightarrow ","&hArr;"),n.hArr=n.lrArr=n.Leftrightarrow=t(u,"\\Leftrightarrow ","&hArr;"),n.Re=n.Real=n.real=t(u,"\\Re ","&real;"),n.Im=n.imag=n.image=n.imagin=n.imaginary=n.Imaginary=t(u,"\\Im ","&image;"),n.part=n.partial=t(u,"\\partial ","&part;"),n.inf=n.infin=n.infty=n.infinity=t(u,"\\infty ","&infin;"),n.alef=n.alefsym=n.aleph=n.alephsym=t(u,"\\aleph ","&alefsym;"),n.xist=n.xists=n.exist=n.exists=t(u,"\\exists ","&exist;"),n.and=n.land=n.wedge=t(u,"\\wedge ","&and;"),n.or=n.lor=n.vee=t(u,'\\vee ',"&or;"),n.o=n.O=n.empty=n.emptyset=n.oslash=n.Oslash=n.nothing=n.varnothing=t(e,'\\varnothing ',"&empty;"),n.cup=n.union=t(e,"\\cup ","&cup;"),n.cap=n.intersect=n.intersection=t(e,"\\cap ","&cap;"),n.deg=n.degree=t(u,"^\\circ ","&deg;"),n.ang=n.angle=t(u,"\\angle ","&ang;"),ri=f(g,function(n,t){n.init=function(n){t.init.call(this,"\\"+n+" ","<span>"+n+"</span>")},n.respace=function(){this.jQ[0].className=this[r]instanceof w||this[r]instanceof ft?"":"non-italicized-function"}}),n.ln=n.lg=n.log=n.span=n.proj=n.det=n.dim=n.min=n.max=n.mod=n.lcm=n.gcd=n.gcf=n.hcf=n.lim=ri,function(){var i=["sin","cos","tan","sec","cosec","csc","cotan","cot"],t;for(t in i)n[i[t]]=n[i[t]+"h"]=n["a"+i[t]]=n["arc"+i[t]]=n["a"+i[t]+"h"]=n["arc"+i[t]+"h"]=ri}();var ut=function(){function b(n){var t=p();return n.adopt(t,0,0),t}function a(n){for(var i=n[0]||p(),t=1;t<n.length;t+=1)n[t].children().adopt(i,i.ends[r],0);return i}var t=h.string,i=h.regex,v=h.letter,d=h.any,e=h.optWhitespace,g=h.succeed,c=h.fail,nt=v.map(l),it=i(/^[^${}\\_^]/).map(u),tt=i(/^[^\\a-eg-zA-Z]/).or(t("\\").then(i(/^[a-z]+/i).or(i(/^\s+/).result(" ")).or(d))).then(function(t){var i=n[t];return i?i(t).parser():c("unknown command: \\"+t)}),k=tt.or(nt).or(it),y=t("{").then(function(){return s}).skip(t("}")),f=e.then(y.or(k.map(b))),s=f.many().map(a).skip(e),w=t("[").then(f.then(function(n){return n.join("latex")!=="]"?g(n):c()}).many().map(a).skip(e)).skip(t("]")),o=s;return o.block=f,o.optBlock=w,o}(),ki=f(bt,function(t){function e(n,t){var e,u,o,s;if(n[r][t])n.insAtLeftEnd(n[r][t]);else if(n[i][t])n.insAtRightEnd(n[i][t]);else{e=n.parent;do{if(u=e[t],u&&(typeof u=="function"&&(u=e[t](n)),u===!1||u instanceof p)){n.upDownCache[e.id]=bt(n.parent,n[i],n[r]),u instanceof p&&(o=n.upDownCache[u.id],o?o[r]?n.insLeftOf(o[r]):n.insAtRightEnd(o.parent):(s=f(n).left,n.insAtRightEnd(u),n.seekHoriz(s,u)));break}e=e.parent.parent}while(e)}return n.clearSelection().show()}function f(n){var t=n.jQ.removeClass("cursor").offset();return n.jQ.addClass("cursor"),t}function u(n){n.upDownCache={}}t.init=function(n){this.parent=this.root=n;var t=this.jQ=this._jQ=o('<span class="cursor">&zwj;</span>');this.blink=function(){t.toggleClass("blink")},this.upDownCache={}},t.show=function(){return this.jQ=this._jQ.removeClass("blink"),"intervalId"in this?clearInterval(this.intervalId):(this[r]?this.selection&&this.selection.ends[i][i]===this[i]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[r].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=o(),this},t.withDirInsertAt=function(n,t,i,r){var u=this.parent;this.parent=t,this[n]=i,this[-n]=r,u.blur()},t.insDirOf=function(n,t){return nt(n),this.withDirInsertAt(n,t.parent,t[n],t),this.parent.jQ.addClass("hasCursor"),this.jQ.insDirOf(n,t.jQ),this},t.insLeftOf=function(n){return this.insDirOf(i,n)},t.insRightOf=function(n){return this.insDirOf(r,n)},t.insAtDirEnd=function(n,t){return nt(n),this.withDirInsertAt(n,t,0,t.ends[n]),n===i&&t.textarea?this.jQ.insDirOf(-n,t.textarea):this.jQ.insAtDirEnd(n,t.jQ),t.focus(),this},t.insAtLeftEnd=function(n){return this.insAtDirEnd(i,n)},t.insAtRightEnd=function(n){return this.insAtDirEnd(r,n)},t.hopDir=function(n){return nt(n),this.jQ.insDirOf(n,this[n].jQ),this[-n]=this[n],this[n]=this[n][n],this},t.hopLeft=function(){return this.hopDir(i)},t.hopRight=function(){return this.hopDir(r)},t.moveDirWithin=function(n,t){if(nt(n),this[n])this[n].ends[-n]?this.insAtDirEnd(-n,this[n].ends[-n]):this.hopDir(n);else{if(this.parent===t)return;this.parent[n]?this.insAtDirEnd(-n,this.parent[n]):this.insDirOf(n,this.parent.parent)}},t.moveLeftWithin=function(n){return this.moveDirWithin(i,n)},t.moveRightWithin=function(n){return this.moveDirWithin(r,n)},t.moveDir=function(n){return nt(n),u(this),this.selection?this.insDirOf(n,this.selection.ends[n]).clearSelection():this.moveDirWithin(n,this.root),this.show()},t.moveLeft=function(){return this.moveDir(i)},t.moveRight=function(){return this.moveDir(r)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},t.seek=function(n,t){u(this);var f,e,r=this.clearSelection().show();return n.hasClass("empty")?(r.insAtLeftEnd(s[n.attr(c)]),r):(f=s[n.attr(ai)],f instanceof g)?(n.outerWidth()>2*(t-n.offset().left)?r.insLeftOf(f):r.insRightOf(f),r):(f||(e=s[n.attr(c)],e||(n=n.parent(),f=s[n.attr(ai)],f||(e=s[n.attr(c)],e||(e=r.root)))),f?r.insRightOf(f):r.insAtRightEnd(e),r.seekHoriz(t,r.root))},t.seekHoriz=function(n,t){var r=this,u=f(r).left-n,e;do r.moveLeftWithin(t),e=u,u=f(r).left-n;while(u>0&&(r[i]||r.parent!==t));return-u>e&&r.moveRightWithin(t),r},t.writeLatex=function(n){var t=this;u(t),t.show().deleteSelection();var e=h.all,o=h.eof,f=ut.skip(o).or(e.result(!1)).parse(n);return f&&(f.children().adopt(t.parent,t[i],t[r]),s.jQize(f.join("html")).insertBefore(t.jQ),t[i]=f.ends[r],f.finalizeInsert(),t.parent.bubble("redraw")),this.hide()},t.write=function(n){var t=this.prepareWrite();return this.insertCh(n,t)},t.insertCh=function(n,t){return this.parent.write(this,n,t),this},t.insertCmd=function(t,r){var u=n[t];return u?(u=u(t),r&&u.replaces(r),u.createLeftOf(this)):(u=vt(),u.replaces(t),u.ends[i].focus=function(){return delete this.focus,this},u.createLeftOf(this),this.insRightOf(u),r&&r.remove()),this},t.unwrapGramp=function(){var n=this.parent.parent,t=n.parent,f=n[r],e=this,u=n[i];if(n.disown().eachChild(function(i){i.isEmpty()||(i.children().adopt(t,u,f).each(function(t){t.jQ.insertBefore(n.jQ.first())}),u=i.ends[r])}),!this[r])if(this[i])this[r]=this[i][r];else while(!this[r])if(this.parent=this.parent[r],this.parent)this[r]=this.parent.ends[i];else{this[r]=n[r],this.parent=t;break}this[r]?this.insLeftOf(this[r]):this.insAtRightEnd(t),n.jQ.remove(),n[i]&&n[i].respace(),n[r]&&n[r].respace()},t.deleteDir=function(n){if(nt(n),u(this),this.show(),!this.deleteSelection())if(this[n])this[n].isEmpty()?this[n]=this[n].remove()[n]:this.selectDir(n);else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insDirOf(-n,this.parent.parent).deleteDir(n);this.unwrapGramp()}return this[i]&&this[i].respace(),this[r]&&this[r].respace(),this.parent.bubble("redraw"),this},t.backspace=function(){return this.deleteDir(i)},t.deleteForward=function(){return this.deleteDir(r)},t.selectFrom=function(n){var e=this,o=n,s,f,u,t,c,h;n:for(;;){for(s=this;s!==e.parent.parent;s=s.parent.parent)if(s.parent===o.parent){u=s,t=o;break n}for(f=n;f!==o.parent.parent;f=f.parent.parent)if(e.parent===f.parent){u=e,t=f;break n}e.parent.parent&&(e=e.parent.parent),o.parent.parent&&(o=o.parent.parent)}if(u[r]!==t){for(h=u;h;h=h[r])if(h===t[i]){c=!0;break}c||(c=t,t=u,u=c)}this.hide().selection=ei(u[i][r]||u.parent.ends[i],t[r][i]||t.parent.ends[r]),this.insRightOf(t[r][i]||t.parent.ends[r]),this.root.selectionChanged()},t.selectDir=function(n){if(nt(n),u(this),this.selection)if(this.selection.ends[n]===this[-n])this[n]?this.hopDir(n).selection.extendDir(n):this.parent!==this.root&&this.insDirOf(n,this.parent.parent).selection.levelUp();else{if(this.hopDir(n),this.selection.ends[n]===this.selection.ends[-n]){this.clearSelection().show();return}this.selection.retractDir(n)}else{if(this[n])this.hopDir(n);else{if(this.parent===this.root)return;this.insDirOf(n,this.parent.parent)}this.hide().selection=ei(this[-n])}this.root.selectionChanged()},t.selectLeft=function(){return this.selectDir(i)},t.selectRight=function(){return this.selectDir(r)},t.prepareMove=function(){return u(this),this.show().clearSelection()},t.prepareEdit=function(){return u(this),this.show().deleteSelection()},t.prepareWrite=function(){return u(this),this.show().replaceSelection()},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.root.selectionChanged()),this},t.deleteSelection=function(){return this.selection?(this[i]=this.selection.ends[i][i],this[r]=this.selection.ends[r][r],this.selection.remove(),this.root.selectionChanged(),delete this.selection):!1},t.replaceSelection=function(){var n=this.selection;return n&&(this[i]=n.ends[i][i],this[r]=n.ends[r][r],delete this.selection),n}}),ei=f(pt,function(n,t){n.init=function(){var n=this;t.init.apply(n,arguments),n.jQwrap(n.jQ)},n.jQwrap=function(n){this.jQ=n.wrapAll('<span class="selection"></span>').parent()},n.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),t.adopt.apply(this,arguments)},n.clear=function(){return this.jQ.replaceWith(this.jQ.children()),this},n.levelUp=function(){var n=this,t=n.ends[i]=n.ends[r]=n.ends[r].parent.parent;return n.clear().jQwrap(t.jQ),n},n.extendDir=function(n){return nt(n),this.ends[n]=this.ends[n][n],this.ends[n].jQ.insAtDirEnd(n,this.jQ),this},n.extendLeft=function(){return this.extendDir(i)},n.extendRight=function(){return this.extendDir(r)},n.retractDir=function(n){nt(n),this.ends[-n].jQ.insDirOf(-n,this.jQ),this.ends[-n]=this.ends[-n][n]},n.retractRight=function(){return this.retractDir(r)},n.retractLeft=function(){return this.retractDir(i)}});k.fn.mathquill=function(n,t){var r,i;switch(n){case"redraw":return this.each(function(){var t=o(this).attr(c),n=t&&s[t];n&&function i(n){n.eachChild(i),n.redraw&&n.redraw()}(n)});case"revert":return this.each(function(){var t=o(this).attr(c),n=t&&s[t];n&&n.revert&&n.revert()});case"latex":return arguments.length>1?this.each(function(){var i=o(this).attr(c),n=i&&s[i];n&&n.renderLatex(t)}):(r=o(this).attr(c),i=r&&s[r],i&&i.latex());case"text":return r=o(this).attr(c),i=r&&s[r],i&&i.text();case"html":return this.html().replace(/ ?hasCursor|hasCursor /,"").replace(/ class=(""|(?= |>))/g,"").replace(/<span class="?cursor( blink)?"?><\/span>/i,"").replace(/<span class="?textarea"?><textarea><\/textarea><\/span>/i,"");case"write":if(arguments.length>1)return this.each(function(){var r=o(this).attr(c),i=r&&s[r],n=i&&i.cursor;n&&n.writeLatex(t).parent.blur()});case"cmd":if(arguments.length>1)return this.each(function(){var r=o(this).attr(c),u=r&&s[r],n=u&&u.cursor,i;n&&(i=n.prepareWrite(),/^\\[a-z]+$/i.test(t)?n.insertCmd(t.slice(1),i):n.insertCh(t,i),n.hide().parent.blur())});case"writesimpfunc":if(arguments.length>1)return this.each(function(){var i=o(this).attr(c),r=i&&s[i],n=r&&r.cursor;n&&(n.selection?n.writeLatex(t+"{"+n.selection.latex()+"}").parent.blur():n.writeLatex(t+"{}").parent.blur(),n.moveLeft())});case"writefunc":if(arguments.length>1)return this.each(function(){var i=o(this).attr(c),r=i&&s[i],n=r&&r.cursor;n&&(n.selection?n.writeLatex(t+"\\left("+n.selection.latex()+"\\right)").parent.blur():n.writeLatex(t+"\\left(\\right)").parent.blur(),n.moveLeft())});case"movecursor":if(arguments.length>1)return this.each(function(){var i=o(this).attr(c),r=i&&s[i],n=r&&r.cursor;n&&(t=="b"?n.backspace():(n.clearSelection().show(),t=="l"?n.moveLeft():t=="r"?n.moveRight():t=="u"?n.moveUp():t=="d"&&n.moveDown()))});case"writefrac":if(arguments.length>1)return this.each(function(){var t=o(this).attr(c),i=t&&s[t],n=i&&i.cursor;n&&(n.selection?n.writeLatex("\\frac{"+n.selection.latex()+"}{}").parent.blur():(n.writeLatex("\\frac{}{}").parent.blur(),n.moveLeft()),n.moveLeft())});case"writeint":if(arguments.length>1)return this.each(function(){var u=o(this).attr(c),f=u&&s[u],n=f&&f.cursor,i,r;t=="["?(i="\\left[",r="\\right]"):t=="("?(i="\\left(",r="\\right)"):(i=t+"{",r="}"),n&&(n.selection?n.selection.latex().match(/,/)?n.writeLatex(i+n.selection.latex()+r).parent.blur():n.writeLatex(i+n.selection.latex()+","+r).parent.blur():(n.writeLatex(i+","+r).parent.blur(),n.moveLeft()),n.moveLeft())});case"writebracket":if(arguments.length>1)return this.each(function(){var u=o(this).attr(c),f=u&&s[u],n=f&&f.cursor,i,r;t=="["?(i="\\left[",r="\\right]"):t=="("?(i="\\left(",r="\\right)"):t=="|"&&(i="\\left|",r="\\right|"),n&&(n.selection?n.writeLatex(i+n.selection.latex()+r).parent.blur():n.writeLatex(i+r).parent.blur(),n.moveLeft())});default:var u=n==="textbox",e=u||n==="editable",f=u?bi:ht;return this.each(function(){ci(o(this),f(),u,e)})}},k(function(){k(".mathquill-editable:not(.mathquill-rendered-math)").mathquill("editable"),k(".mathquill-textbox:not(.mathquill-rendered-math)").mathquill("textbox"),k(".mathquill-embedded-latex").mathquill()})})();
