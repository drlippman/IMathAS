var initstack=[],loadedscripts=[],scriptqueue=[],processingscriptsqueue=!1,callbackstack={};"undefined"==typeof commasep&&(commasep=!0);var imathasAssess=function(e){var t={},a={};function r(e,a){var r=a.substr(2).split(/-/)[0],n=t[r].qtype;("numfunc"===n||"calcinterval"===n&&-1!=t[r].calcformat.indexOf("inequality"))&&(e=D(r,e)[1]);var i=!(n.match(/matrix/)||"string"===n);return AMtoMQ(e,a,i)}function n(e,t){return e=(e=MQtoAM(e)).replace(/\(text\((.*?)\)\)/g,"($1)").replace(/text\((.*?)\)/g," $1 ")}function s(){if(processingscriptsqueue=!0,0!=scriptqueue.length){var e=scriptqueue.shift();if("code"==e[0]){try{window.eval(e[1])}catch(t){console.log("Error executing question script:"+e[1])}o()}else jQuery.getScript(e[1]).always((function(){o()}))}}function o(){for(var e=0;e<initstack.length;e++)initstack[e]();initstack.length=0,0==scriptqueue.length?processingscriptsqueue=!1:s()}function l(t,a,r){var n=document.getElementById(t);if(n){n.setAttribute("data-tip",a);var i=t.substr(2).split(/-/)[0];document.getElementById("tips"+i)||e("body").append(e("<div>",{class:"hidden",id:"tips"+i}).html(r)),n.setAttribute("aria-describedby","tips"+i),n.addEventListener("focus",(function(){showehdd(t,a,i)})),n.addEventListener("blur",hideeh),n.addEventListener("click",(function(){reshrinkeh(t)}))}}function c(t){var a,r=t.currentTarget;if(null!==(a=r.className.match(/(ansgrn|ansred|ansyel|ansorg)/)))e(r).removeClass(a[0]),e(r).nextAll(".scoremarker.sr-only").first().remove(),"ansorg"==a[0]&&e(r).nextAll(".scoremarker").first().remove(),"select"==r.tagName.toLowerCase()&&e(r).nextAll("svg.scoremarker").first().remove(),"hidden"==r.type&&e("#mqinput-"+r.id).removeClass(a[0]);else{var n=e(r).closest("[id^=qnwrap]");n.length>0&&null!==(a=n[0].className.match(/(ansgrn|ansred|ansyel|ansorg)/))&&(n.removeClass(a[0]),n.find(".scoremarker").remove())}}function u(t){e("input[type=text][name=qn"+t+"]").off("keydown.enterhandler").on("keydown.enterhandler",(function(t){if(13==t.which){var a=e(this).closest(".questionwrap").find(".submitbtnwrap .primary");a.length>0&&t.preventDefault(),a.is(":disabled")||a.trigger("click")}}))}function d(a){var r,n=document.getElementById("qn"+a).value.split(";;"),i=[];for(r=0;r<n.length;r++)if(5==r?n[r]="["+n[r].replace(/&quot;/g,'"')+"]":(n[r]="["+n[r].replace(/\(/g,"[").replace(/\)/g,"]")+"]",0==r&&n[r].length>2&&(n[r]="["+n[r].replace(/;/g,"],[")+"]")),""===n[r])i[r]=[];else try{i[r]=JSON.parse(n[r])}catch(e){i[r]=[]}window.drawla[a]=i,window.canvases[a]=t[a].canvas,imathasDraw.initCanvases(a);var s=document.getElementById("drawtools"+a);s&&s.addEventListener("click",(function(e){var t=e.target;if(t.hasAttribute("data-drawaction")){var a=t.getAttribute("data-drawaction"),r=t.getAttribute("data-qn");if("clearcanvas"===a)imathasDraw.clearcanvas(r);else if("settool"===a){var n=t.getAttribute("data-val");imathasDraw.settool(t,r,n)}}})),e("#qn"+a).parent().find(".a11ydrawadd:not(.inited)").off("click.adda11ydraw").on("click.adda11ydraw",(function(t){var a=t.target.getAttribute("data-qn");e(t.target).addClass("inited"),imathasDraw.adda11ydraw(a)}))}function p(t){if("hasnone"==e("#qnwrap"+t).attr("data-multans")){var a=e('input[name^="qn'+t+'["]');a.on("change",(function(){this.checked&&this.value==a.length-1?a.not(":last").prop("checked",!1):this.checked&&a.last().prop("checked",!1)}))}}function h(e){if("undefined"!=typeof Kekule){if(a[e]=new Kekule.Editor.Composer(document.getElementById("chemdraw"+e)),a[e].setEnableOperHistory(!0).setEnableLoadNewFile(!1).setEnableCreateNewDoc(!1).setAllowCreateNewChild(!1).setCommonToolButtons(["undo","redo","copy","cut","paste","zoomIn","reset","zoomOut"]).setChemToolButtons(["manipulate","erase","bond","atomAndFormula","ring","charge"]).setStyleToolComponentNames([]),"condensed"===t[e].displayformat){var r=new Kekule.Render.Render2DConfigs;r.getMoleculeDisplayConfigs().setDefMoleculeDisplayType(Kekule.Render.MoleculeDisplayType.CONDENSED),a[e].setRenderConfigs(r)}a[e].getEditor().on("editObjsUpdated",(function(t){R(e)})),t[e].chemla&&(a[e].setChemObj(Kekule.IO.loadFormatData(t[e].chemla,"cml")),window.setTimeout((function(){let t=a[e].getEditor();t.scrollClientToObject(t.getChemObj().getChildren())}),100));var n=document.getElementById("chemsa"+e);if(n){var i=new Kekule.ChemWidget.Viewer(n,null,Kekule.Render.RendererType.R2D);i.setEnableToolbar(!1).setPadding(20).setChemObj(Kekule.IO.loadFormatData(n.getAttribute("data-cmldata"),"cml")),"condensed"===t[e].displayformat&&i.setMoleculeDisplayType(Kekule.Render.Molecule2DDisplayType.CONDENSED)}}else{var s=e;setTimeout(function(){h(s)}.bind(this),100)}}function g(e){return!e||0===e.length||/^\s*$/.test(e)}function m(t){var a=t.target,r=e(a).closest("tr").find("input").first();if(!g(a.value)&&r.hasClass("iscredit")){r.css("padding-left");r.is("select")?r.css("margin-right",20):r.width(""),r.css("padding-left",""),r.removeClass("iscredit")}}function f(t){var a=t.target,r=e(a).closest("tr").find("input").first();if(!g(a.value)&&!r.hasClass("iscredit")){var n=parseInt(r.css("padding-left"));r.is("select")?r.css("margin-right",0):r.width(r.width()-20),r.css("padding-left",20+n),r.addClass("iscredit")}}var v=[];function b(a,r){if("MathJax"!=mathRenderer||window.MathJax&&(window.MathJax.Hub||window.MathJax.typesetPromise))v.hasOwnProperty(a)||("MathJax"==mathRenderer||"Katex"==mathRenderer?(v[a]={delay:"MathJax"==mathRenderer?100:0,finaldelay:1e3,preview:null,buffer:null,timeout:null,finaltimeout:null,mjRunning:!1,mjPending:!1,oldText:null,mjPromise:null,Init:function(t){e("#p"+a).css("positive","relative").append('<span id="lpbuf1'+a+'" style="visibility:hidden;position:absolute;"></span>').append('<span id="lpbuf2'+a+'" style="visibility:hidden;position:absolute;"></span>'),this.preview=document.getElementById("lpbuf1"+a),this.buffer=document.getElementById("lpbuf2"+a),"MathJax"==mathRenderer&&MathJax.typesetPromise&&(this.mjPromise=Promise.resolve()),t||q(a)},SwapBuffers:function(){var e=this.preview,t=this.buffer;this.buffer=e,this.preview=t,e.style.visibility="hidden",e.style.position="absolute",t.style.position="",t.style.visibility=""},Update:function(e){this.timeout&&clearTimeout(this.timeout),this.finaltimeout&&clearTimeout(this.finaltimeout),this.timeout=setTimeout(this.callback,this.delay),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(e,t){this.oldtext=e,this.buffer.innerHTML=t?e:this.preformat(e),this.mjRunning=!0,this.RenderBuffer()},RenderBuffer:function(){"MathJax"==mathRenderer?MathJax.typesetPromise&&this.mjPromise?this.mjPromise=this.mjPromise.then(function(){MathJax.typesetPromise([this.buffer]).then(this.PreviewDone.bind(this))}.bind(this)):2===parseInt(MathJax.version)&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.buffer],["PreviewDone",this]):"Katex"==mathRenderer&&(renderMathInElement(this.buffer),"undefined"!=typeof MathJax&&MathJax.Hub&&!MathJax.typesetPromise&&e(this.buffer).children(".mj").length>0?MathJax.Hub.Queue(["PreviewDone",this]):this.PreviewDone())},DoFinalPreview:function(){e("#pbtn"+a).trigger("click")},preformat:function(e){var r=t[a].qtype,n=t[a].calcformat;return O(a,e,r,n)},CreatePreview:function(){if(this.timeout=null,!this.mjPending){var e=document.getElementById("qn"+a).value;e!==this.oldtext&&(this.mjRunning?(this.mjPending=!0,this.mjPromise?this.mjPromise=this.mjPromise.then(this.CreatePreview().bind(this)):MathJax.Hub&&2===parseInt(MathJax.version)&&MathJax.Hub.Queue(["CreatePreview",this])):(this.oldtext=e,this.buffer.innerHTML="`"+w(this.preformat(e))+"`",this.mjRunning=!0,this.RenderBuffer()))}},PreviewDone:function(){this.mjRunning=this.mjPending=!1,this.SwapBuffers(),updateehpos()}},"undefined"==typeof MathJax||MathJax.typesetPromise?v[a].callback=function(){v[a].CreatePreview()}:(v[a].callback=MathJax.Callback(["CreatePreview",v[a]]),v[a].callback.autoReset=!0),v[a].Init(r)):v[a]={finaldelay:1e3,finaltimeout:null,Update:function(e){this.finaltimeout&&clearTimeout(this.finaltimeout),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(e){var t=document.getElementById("p"+a);t.innerHTML=w(e),rendermathnode(t)},DoFinalPreview:function(){e("#pbtn"+a).trigger("click")}});else{var n=a,i=r;setTimeout(100,(function(){b(n,i)}))}}function y(e){var t=e.target.id.substr(2);b(t),v[t].Update()}function x(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/[\x00-\x09\x0B\x0C\x0E-\x1F\x7F]/g,"")).replace(/\u2013|\u2014|\u2015|\u2212/g,"-")).replace(/\u2044|\u2215/g,"/")).replace(/∞/g,"oo").replace(/≤/g,"<=").replace(/≥/g,">=").replace(/∪/g,"U")).replace(/±/g,"+-").replace(/÷/g,"/").replace(/·|✕|×|⋅/g,"*")).replace(/√/g,"sqrt").replace(/∛/g,"root(3)")).replace(/⁰/g,"^0").replace(/¹/g,"^1").replace(/²/g,"^2").replace(/³/g,"^3").replace(/⁴/g,"^4").replace(/⁵/g,"^5").replace(/⁶/g,"^6").replace(/⁷/g,"^7").replace(/⁸/g,"^8").replace(/⁹/g,"^9")).replace(/\u2329/g,"<").replace(/\u232a/g,">")).replace(/₀/g,"_0").replace(/₁/g,"_1").replace(/₂/g,"_2").replace(/₃/g,"_3")).replace(/\b(OO|infty)\b/gi,"oo").replace(/°/g,"degree")).replace(/θ/g,"theta").replace(/ϕ/g,"phi").replace(/φ/g,"phi").replace(/π/g,"pi").replace(/σ/g,"sigma").replace(/μ/g,"mu")).replace(/α/g,"alpha").replace(/β/g,"beta").replace(/γ/g,"gamma").replace(/δ/g,"delta").replace(/ε/g,"epsilon").replace(/κ/g,"kappa")).replace(/λ/g,"lambda").replace(/ρ/g,"rho").replace(/τ/g,"tau").replace(/χ/g,"chi").replace(/ω/g,"omega")).replace(/Ω/g,"Omega").replace(/Γ/g,"Gamma").replace(/Φ/g,"Phi").replace(/Δ/g,"Delta").replace(/Σ/g,"Sigma")).replace(/&(ZeroWidthSpace|nbsp);/g," ").replace(/\u200B/g," ")).replace(/degree\s+s\b/g,"degree")).replace(/\(\((-?\d+)\)\)/g,"($1)")}function w(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;")}function q(e){var a=t[e],r="",n=M(e);if(n.str&&(r+="`"+w(n.str)+"`"),n.dispvalstr&&""!=n.dispvalstr&&-1!=a.calcformat.indexOf("showval")&&(r+=(""==r?"":" &asymp; ")+"`"+w(n.dispvalstr)+"`"),n.err&&""!=n.err&&""!=n.str&&(r+="``"==r?"":". <span class=noticetext>"+n.err+"</span>"),v.hasOwnProperty(e))v[e].RenderNow(r,!0);else{var i=document.getElementById("p"+e);i.innerHTML=r,rendermathnode(i)}k(r)}function k(t){var a=e("<div>",{class:"inactive"}).html(t).appendTo("body")[0];rendermathnode(a,(function(){var t=document.getElementById("arialive");t.innerHTML="",a.className="",e(a).find("[aria-label]").each((function(t,a){e(a).html(e(a).attr("aria-label"))})),t.appendChild(a)}))}var $=null;function E(e,t){clearTimeout($);var a=parseInt(e.replace(/.*qn(\d+)\b.*/g,"$1"));$=setTimeout((function(){A(a)}),1e3)}function A(e){var a=t[e],r=M(e),n="";if(r.dispvalstr&&""!=r.dispvalstr&&"NaN"!=r.dispvalstr&&a.calcformat&&-1!=a.calcformat.indexOf("showval")&&(n+="`"+w(r.str)+"`","calcmatrix"==a.qtype||"calccomplexmatrix"==a.qtype||"calcinterval"==a.qtype&&a.calcformat.match(/inequality/)?n+=" &asymp; `"+w(r.dispvalstr)+"` ":n+=" &asymp; "+w(r.dispvalstr)+" "),r.err&&""!=r.err&&""!=r.str&&(n+="<span class=noticetext>"+r.err+"</span>"),!v.hasOwnProperty(e)||"MathJax"!=mathRenderer&&"Katex"!=mathRenderer){var i=document.getElementById("p"+e);i&&(i.innerHTML=n,rendermathnode(i))}else v[e].RenderNow(n,!0);document.getElementById("qn"+e)?k("`"+w(document.getElementById("qn"+e).value)+"` "+n):k(n)}function C(e){var t=M(e);return!!t.submitstr&&t.submitstr}function M(e){if(!t.hasOwnProperty(e))return!1;var a=t[e],r={};if("draw"==a.qtype)return imathasDraw.encodea11ydraw(),{};if("choices"==a.qtype||"multans"==a.qtype||"matching"==a.qtype)return{};if(a.hasOwnProperty("matrixsize"))r=function(e){var a=t[e],r=a.matrixsize,n="";a.calcformat&&(n=a.calcformat);for(var i,s,o=[],l=[],c=[],u=0,d="",p=0;p<r[0];p++){o[p]=[],l[p]=[];for(var h=0;h<r[1];h++)i=x(i=document.getElementById("qn"+e+"-"+u).value),a.qtype.match(/complex/)?(d+=(s=H(i,n)).err,l[p][h]=s.outstrdisp,s.outstr&&c.push(s.outstr)):"algmatrix"===a.qtype?d+=(s=N(e,i,n)).err:(""!==i&&(d+=K(i,n),d+=J(i,n)),o[p][h]=i,d+=(s=Q(i,n))[1],l[p][h]=s[0],c.push(s[0])),u++;o[p]="("+o[p].join(",")+")",l[p]="("+T(l[p]).join(",")+")"}return{err:d,str:"["+o.join(",")+"]",dispvalstr:a.qtype.match(/calc/)?"["+l.join(",")+"]":"",submitstr:c.join("|")}}(e);else{if("molecule"==a.qtype)return R(e),{};var n=document.getElementById("qn"+e);if(!n)return!1;var s=n.value;if((s=(s=x(s)).replace(/^\s+/,"").replace(/\s+$/,"")).match(/^\s*$/))return{str:"",displvalstr:"",submitstr:""};if(s.match(/^\s*DNE\s*$/i))return{str:"DNE",displvalstr:"",submitstr:"DNE"};if(s.match(/^\s*oo\s*$/i))return{str:"oo",displvalstr:"",submitstr:"oo"};if(s.match(/^\s*\+oo\s*$/i))return{str:"+oo",displvalstr:"",submitstr:"+oo"};if(s.match(/^\s*-oo\s*$/i))return{str:"-oo",displvalstr:"",submitstr:"-oo"};switch(a.qtype){case"number":r=function(e,t){var a,r="";e=e.replace(/^\s+|\s+$/g,""),-1!==t.indexOf("set")&&("{"!==e.charAt(0)||"}"!==e.substr(-1)?r+=_("Invalid set notation"):e=e.slice(1,-1));if(-1!==t.indexOf("list")||-1!==t.indexOf("set"))var n=e.split(/\s*,\s*/);else{!commasep&&e.match(/,/)&&(r+=_("Invalid use of a comma."));n=[e.replace(/,/g,"")]}for(var i=0;i<n.length;i++)if(a=n[i],-1!=t.indexOf("units")){_("Units must be given as [decimal number]*[unit]^[power]*[unit]^[power].../[unit]^[power]*[unit]^[power]...");if(a.match(/^\s*(-?\s*\d+\.?\d*|-?\s*\.\d+|-?\s*\d\.?\d*\s*(E|\*\s*10\s*\^)\s*[\-\+]?\d+)/)||(r+=_("Answer must start with a number. ")),a.match(/\b(sq|square|cu|cubic|squared|cubed)\s*\^\s*[\-\+]?\s*\d+/)&&(r+=_("Invalid base for exponent. "),a=a.replace(/\^/,"")),a.match(/\b(sq|square|cu|cubic)\s+per\b/)&&(r+=_('Missing unit before "per". '),a=a.replace(/per\b/,"")),a.match(/\bper\s+(squared|cubed)/)&&(r+=_('Missing unit after "per". '),a=a.replace(/\bper/,"")),(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=a.replace(/([a-zA-Z]\w*\s*)(\^\s*[\-\+]?\s*\d+\s*)(?:squared|cubed)\b/g,"$1")).replace(/(?:sq|square|cu|cubic)\s+([a-zA-Z]\w*)/g,"$1")).replace(/([a-zA-Z]\w*)\s+(?:squared|cubed)/g,"$1")).replace(/\sper\s/g,"/")).replace(/^\s*(-?\s*\d\.?\d*\s*(E|\*\s*10\s*\^)\s*[\-\+]?\d+|-?\s*\d+\.?\d*|-?\s*\.\d+)\s*[\-\*]?\s*/,"")).replace(/\s*\-\s*([a-zA-Z])/g,"*$1")).replace(/\*\*/g,"^")).replace(/\s*(\/|\^|\-)\s*/g,"$1")).replace(/\(\s*(.*?)\s*\)\s*\//,"$1/").replace(/\/\s*\(\s*(.*?)\s*\)/,"/$1")).replace(/\s*[\*\s]\s*/g,"*")).replace(/([a-zA-Z]\w*)\^[\-\+]?\d+/g,"$1")).match(/\^/)&&(r+=_("Invalid exponents. "),a=a.replace(/\^/g,"")),(a.match(/\//g)||[]).length>1&&(r+=_("Only one division symbol allowed in the units. ")),(a=a.replace(/\//g,"*").replace(/^\s*\*/,"").trim()).length>0)for(var s="(yotta|zetta|exa|peta|tera|giga|mega|kilo|hecto|deka|deca|deci|centi|milli|micro|nano|pico|fempto|atto|zepto|yocto)",o="(Y|Z|E|P|T|G|M|k|h|da|d|c|m|u|n|p|f|a|z|y)",l=/^(m|meter|metre|micron|angstrom|fermi|in|inch|inches|ft|foot|feet|mi|mile|furlong|yd|yard|s|sec|second|min|minute|h|hr|hour|day|week|mo|month|yr|year|fortnight|acre|ha|hectare|b|barn|L|liter|litre|cc|gal|gallon|cup|pt|pint|qt|quart|tbsp|tablespoon|tsp|teaspoon|rad|radian|deg|degree|arcminute|arcsecond|grad|gradian|knot|kt|c|mph|kph|g|gram|gramme|t|tonne|Hz|hertz|rev|revolution|cycle|N|newton|kip|dyn|dyne|lb|pound|lbf|ton|J|joule|erg|lbft|ftlb|cal|calorie|eV|electronvolt|Wh|Btu|therm|W|watt|hp|horsepower|Pa|pascal|atm|atmosphere|bar|Torr|mmHg|umHg|cmWater|psi|ksi|Mpsi|C|coulomb|V|volt|farad|F|ohm|amp|ampere|A|T|tesla|G|gauss|Wb|weber|H|henry|lm|lumen|lx|lux|amu|dalton|Da|me|mol|mole|Ci|curie|R|roentgen|sr|steradian|Bq|becquerel|ls|lightsecond|ly|lightyear|AU|au|parsec|pc|solarmass|solarradius|degF|degC|degK|K)$/,c="(inch|inches|lbft|ftlb|solarmass|solarradius)",u="(L|Hz|Btu)",d="(fermi|foot|feet|sec|hertz|horsepower|Torr|gauss|lux)",p="(micron|mile|furlong|yard|minute|hour|day|week|month|year|fortnight|acre|hectare|gallon|cup|pint|quart|tablespoon|teaspoon|radian|degree|gradian|knot|revolution|cycle|kip|lb|therm|atmosphere|roentgen)",h="(meter|metre|angstrom|second|barn|liter|litre|arcminute|arcsecond|gram|gramme|tonne|newton|dyne|pound|ton|joule|erg|calorie|electronvolt|watt|pascal|coulomb|volt|farad|ohm|amp|ampere|tesla|weber|henry|lumen|dalton|mole|curie|steradian|becquerel|lightsecond|lightyear|parsec)",g=new RegExp("^"+o+"?"+"(m|ft|s|b|cc|g|t|N|dyn|J|cal|eV|Wh|W|hp|Pa|C|V|F|A|T|G|Wb|H|lm|lx|Da|mol|M|Ci|sr|Bq|ls|ly|pc)"+"$"),m=new RegExp("^"+c+"$","i"),f=new RegExp("^"+o+"?"+u+"$","i"),v=new RegExp("^"+s+"?"+d+"$","i"),b=new RegExp("^"+p+"s?$","i"),y=new RegExp("^"+s+"?"+h+"s?$","i"),x=a.split(/\s*\*\s*/),w=0;w<x.length;w++){unitsregexmatch=x[w].match(f);let e=!1;if(unitsregexmatch&&void 0!==unitsregexmatch[1])new RegExp("^"+o+"$").test(unitsregexmatch[1])||(e=!0);(l.test(x[w])||g.test(x[w])||m.test(x[w])||f.test(x[w])||v.test(x[w])||b.test(x[w])||y.test(x[w]))&&!e||(r+=_("Unknown unit ")+'"'+x[w]+'". ')}else r+=_("Missing units")}else-1!=t.indexOf("integer")?a.match(/^\s*\-?\d+\s*$/)||(r+=_("This is not an integer.")):a.match(/^\s*(\+|\-)?(\d+\.?\d*|\.\d+|\d*\.?\d*\s*E\s*[\-\+]?\d+)\s*$/)||(r+=_("This is not a decimal or integer value."));return{err:r,dispvalstr:e}}(s,a.calcformat);break;case"calculated":r=B(s,a.calcformat);break;case"interval":case"calcinterval":r=function(e,t,a){if(e=e.replace(/cup/g,"U"),-1!=t.indexOf("inequality")){var r=S(e=e.replace(/or/g," or "),a);if(r.length>1)return{err:"wrongvar"==r[1]?_("you may have used the wrong variable"):_("invalid inequality notation")};e=r[0]}var n=[],s=[],o=[],l="U";if(-1!=t.indexOf("list")){e=e.replace(/\s*,\s*/g,",").replace(/(^,|,$)/g,""),l=",";for(var c=0,u=1;u<e.length-1;u++)","==e.charAt(u)&&(")"!=e.charAt(u-1)&&"]"!=e.charAt(u-1)||"("!=e.charAt(u+1)&&"["!=e.charAt(u+1)||(n.push(e.substring(c,u)),c=u+1));n.push(e.substring(c))}else n=e.split(/\s*U\s*/i);var d,p,h,g="",m=[],f=[];for(i=0;i<n.length;i++){if(d=n[i],sm=d.charAt(0),em=d.charAt(d.length-1),2!=(p=(p=d.substring(1,d.length-1)).split(/,/)).length||"("!=sm&&"["!=sm||")"!=em&&"]"!=em){-1!=t.indexOf("inequality")?g+=_("invalid inequality notation")+". ":g+=_("invalid interval notation")+". ";break}for(j=0;j<2;j++)-1!=t.indexOf("decimal")&&p[j].match(/[\d\.]e\-?\d/)&&(p[j]=p[j].replace(/e/,"E")),g+=J(p[j],t),g+=K(p[j],t),p[j].match(/^\s*\-?\+?oo\s*$/)?m[j]=p[j]:(g+=(h=Q(p[j],t))[1],m[j]=h[0]);f=T(m),s[i]=sm+m[0]+","+m[1]+em,-1!=t.indexOf("inequality")?m[0].toString().match(/oo/)?m[1].toString().match(/oo/)?o[i]="RR":o[i]=a+("]"==em?" le ":" lt ")+f[1]:m[1].toString().match(/oo/)?o[i]=a+("["==sm?" ge ":" gt ")+f[0]:o[i]=f[0]+("["==sm?" le ":" lt ")+a+("]"==em?" le ":" lt ")+f[1]:o[i]=sm+f[0]+","+f[1]+em}return-1!=t.indexOf("inequality")?{err:g,dispvalstr:o.join(' "or" '),submitstr:s.join(l)}:{err:g,dispvalstr:o.join(" uu "),submitstr:s.join(l)}}(s,a.calcformat,a.vars);break;case"ntuple":case"calcntuple":case"complexntuple":case"calccomplexntuple":case"algntuple":r=function(e,t,a,r){var n,i="",s="",o=0,l=0,c="",u=!0,d=NaN;(t=(t=(t=x(t)).replace(/(\s+,\s+|,\s+|\s+,)/g,",").replace(/(^,|,$)/g,"")).replace(/<<(.*?)>>/g,"<$1>")).charAt(0).match(/[\(\[\<\{]/)||(u=!1);for(var p=0;p<t.length;p++)n=!1,0==o&&(i+=t.charAt(p),s+=t.charAt(p),l=p+1,","==t.charAt(p)?t.substring(p+1).match(/^\s*[\(\[\<\{]/)&&t.substring(0,p).match(/[\)\]\>\}]\s*$/)||(u=!1):p>0&&","!=t.charAt(p-1)&&(u=!1)),t.charAt(p).match(/[\(\[\<\{]/)?o++:t.charAt(p).match(/[\)\]\>\}]/)&&(o--,n=!0),(0==o&&n||1==o&&","==t.charAt(p))&&(sub=t.substring(l,p).replace(/^\s+/,"").replace(/\s+$/,""),""==sub&&(u=!1),r.match(/complex/)?(c+=(d=H(sub,a)).err,s+=d.outstrdisp,s+=t.charAt(p),d.outstr&&(i+=d.outstr,i+=t.charAt(p))):"algntuple"===r?c+=(d=N(e,sub,a)).err:(c+=J(sub,a),c+=K(sub,a),c+=(d=Q(sub,a))[1],i+=d[0],s+=T(d[0]),i+=t.charAt(p),s+=t.charAt(p)),l=p+1);0!=o&&(u=!1);0==u&&(c=_("Invalid notation")+". "+c);"algntuple"===r&&(s="");a.match(/generalcomplex/)&&(i="");return{err:c,dispvalstr:s,submitstr:i}}(e,s,a.calcformat,a.qtype);break;case"complex":case"calccomplex":r=function(e,t){-1!=t.indexOf("allowplusminus")&&(e=e.replace(/(.*?)\+\-(.*?)(,|$)/g,"$1+$2,$1-$2$3"));for(var a,r="",n=e.split(","),i=[],s=[],o=0;o<n.length;o++)r+=(a=H(n[o],t)).err,s.push(a.outstrdisp),a.outstr&&i.push(a.outstr);return-1!=t.indexOf("generalcomplex")?{err:r,dispvalstr:s.join(", ")}:{err:r,dispvalstr:s.join(", "),submitstr:i.join(",")}}(s,a.calcformat);break;case"numfunc":r=N(e,s,a.calcformat);break;case"matrix":case"complexmatrix":case"calcmatrix":case"calccomplexmatrix":case"algmatrix":r=P(e,s,a.calcformat,a.qtype)}r.str=O(e,s,a.qtype,a.calcformat)}return r}function O(e,t,a,r){return t=x(t),a.match(/interval/)?r.match(/inequality/)?(t=(t=D(e,t)[1]).replace(/<=/g," le ").replace(/>=/g," ge ").replace(/</g," lt ").replace(/>/g," gt ")).match(/all\s*real/i)&&(t="text("+t+")"):t=t.replace(/U/g,"uu"):"numfunc"==a?t=D(e,t)[1]:"calcntuple"==a?t=t.replace(/<+/g,"(:").replace(/>+/g,":)"):"calculated"==a&&(-1==r.indexOf("list")&&-1==r.indexOf("set")&&commasep&&(t=t.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),-1!=r.indexOf("scinot")&&(t=t.replace(/(x|X|\u00D7)/,"xx"))),t=t.replace(/[^\u0000-\u007f]/g,"?")}var I=["alpha","beta","chi","delta","epsilon","gamma","varphi","phi","psi","sigma","rho","theta","lambda","mu","nu","omega","tau"];function D(e,a){var r,n="",i=(r="string"==typeof t[e].vars?[t[e].vars]:t[e].vars.slice()).map(F).join("|");t[e].fvars&&(n=t[e].fvars.map(F).join("|")),r.push("DNE"),i.match(/lambda/)&&(a=a.replace(/lamda/,"lambda"));var s=[],o=a;o=o.replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|argsinh|argcosh|argtanh|argsech|argcsch|argcoth|arsinh|arcosh|artanh|arsech|arcsch|arcoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root|pi)/g,functoindex),a=a.replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|argsinh|argcosh|argtanh|argsech|argcsch|argcoth|arsinh|arcosh|artanh|arsech|arcsch|arcoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root|pi)/g,functoindex);for(var l=0;l<r.length;l++)if(r[l].match(/\(.+\)/)&&(a=a.replace(/\(\(([^\(]*?)\)\)/g,"($1)")),"E"==r[l]||"e"==r[l])s[l]=!0;else{s[l]=t[e].calcformat.match(/casesensitivevars/);for(var c=0;c<r.length;c++)if(l!=c&&r[c].toLowerCase()==r[l].toLowerCase()&&r[c]!=r[l]){s[l]=!0;break}}a=a.replace(new RegExp("("+i+")","gi"),(function(e,t){for(var a=0;a<r.length;a++)if(r[a]==t||!s[a]&&r[a].toLowerCase()==t.toLowerCase())return"@v"+a+"@";return t})),a=a.replace(/@v(\d+)@/g,(function(e,t){return r[t]})),o=o.replace(new RegExp("("+i+")","gi"),(function(e,t){for(var a=0;a<r.length;a++)if(r[a]==t||!s[a]&&r[a].toLowerCase()==t.toLowerCase())return"@v"+a+"@";return t})),o=(o=(o=(o=o.replace(/(@v\d+@)(@v\d+@)/g,"$1 $2")).replace(/(@v\d+@)(@v\d+@)/g,"$1 $2")).replace(/(@v(\d+)@|\d+(\.\d+)?)!(?!=)/g,"{:$&:}")).replace(/@v(\d+)@/g,(function(e,t){return r[t]}));var u,d=a,p=new Array;for(l=0;l<r.length;l++)if(r[l].length>1){var h=!1;if(-1!=I.indexOf(r[l].toLowerCase())&&(h=!0),r[l].match(/^\w+_\w+$/)){u=s[l]?"g":"gi";var g=new RegExp(/^(\w+)_(\w+)$/,u).exec(r[l]),m=new RegExp(g[1]+"_\\("+g[2]+"\\)",u);o=o.replace(m,r[l]),a=a.replace(m,r[l]),d=(d=d.replace(new RegExp(g[0],u),g[1]+"_"+g[2])).replace(new RegExp(g[1]+"_\\("+g[2]+"\\)",u),g[1]+"_("+g[2]+")"),g[1].length>1&&-1==I.indexOf(g[1].toLowerCase())&&(g[1]='"'+g[1]+'"'),g[2].length>1&&-1==I.indexOf(g[2].toLowerCase())&&(g[2]='"'+g[2]+'"'),o=o.replace(new RegExp(g[0],u),g[1]+"_"+g[2]),a=a.replace(new RegExp(g[0],"g")," repvars"+l),r[l]="repvars"+l}else!h&&r[l].replace(/[^\w_]/g,"").length>1&&p.push(r[l]);(r[l].match(/[^\w_]/)||r[l].match(/^(break|case|catch|continue|debugger|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|this|throw|try|typeof|var|void|while|and with)$/))&&(a=a.replace(new RegExp(F(r[l]),"g")," repvars"+l),r[l]="repvars"+l)}if(p.length>0){vltq=p.join("|");var f=new RegExp("("+vltq+")","g");o=o.replace(f,'"$1"')}return o=(o=o.replace(/(@\d+@)/g," $1")).replace(/@(\d+)@/g,indextofunc),a=a.replace(/@(\d+)@/g,indextofunc),d=d.replace(/@(\d+)@/g,indextofunc),i.match(/\bf\b/)&&!n.match(/\bf\b/)&&(o=(o=o.replace(/([^a-zA-Z])f\^([\d\.]+)([^\d\.])/g,"$1f^$2{::}$3")).replace(/([^a-zA-Z])f\(/g,"$1f{::}(")),i.match(/\bg\b/)&&!n.match(/\bg\b/)&&(o=(o=o.replace(/([^a-zA-Z])g\^([\d\.]+)([^\d\.])/g,"$1g^$2{::}$3")).replace(/([^a-zA-Z])g\(/g,"$1g{::}(")),[a,o,r.join("|"),d]}function T(e){return Array.isArray(e)?e.map(T):"number"==typeof e?Math.abs(e)<1?e.toPrecision(4).replace(/\.?0+$/,""):e.toFixed(4).replace(/\.?0+$/,""):e}function B(e,t){if(-1!=t.indexOf("allowplusminus")&&(e=e.replace(/(.*?)\+\-(.*?)(,|$)/g,"$1+$2,$1-$2$3")),-1!=t.indexOf("list"))var a=e.split(/,/);else if(-1!=t.indexOf("set"))a=e.replace(/[\{\}]/g,"").split(/,/);else a=[e];for(var r,n="",i=[],s=0;s<a.length;s++)str=a[s],n+=J(str,t),n+=K(str,t),n+=(r=Q(str,t))[1],i.push(r[0]);var o=T(i).join(", ");return-1!=t.indexOf("set")&&(o="{"+o+"}"),{err:n,dispvalstr:o,submitstr:i.join(",")}}function P(e,t,a,r){var n=!0;((t=(t=(t=t.replace(/\[/g,"(")).replace(/\]/g,")")).replace(/\s+/g,"")).length<2||"("!==t.charAt(0)||")"!==t.charAt(t.length-1))&&(n=!1),t=t.substring(1,t.length-1);for(var i="",s="",o=[],l=0,c=0,u=0;u<t.length;u++)"("==t.charAt(u)?c++:")"==t.charAt(u)?c--:","==t.charAt(u)&&0==c&&(o.push(t.substring(l+1,u-1)),l=u+1);0==l&&"("!=t.charAt(0)?o.push(t):o.push(t.substring(l+1,t.length-1));var d,p,h,g=-1;0!==c&&(n=!1);var m=[],f=[];for(u=0;u<o.length;u++){m[u]=[],d=o[u].split(","),g>-1&&d.length!=g&&(n=!1),g=d.length;for(var v=0;v<d.length;v++)""==(p=d[v].replace(/^\s+/,"").replace(/\s+$/,""))?(s=_("No elements of the matrix should be left blank."),m[u][v]="",f.push("")):"algmatrix"===r?i+=(h=N(e,p,a)).err:r.match(/complex/)?(i+=(h=H(p,a)).err,m[u][v]=h.outstrdisp,h.outstr&&f.push(h.outstr)):(i+=K(p,a),i+=J(p,a),i+=(h=Q(p,a))[1],m[u][v]=T(h[0]),f.push(h[0]));m[u]="("+m[u].join(",")+")"}return n||(i=_("Invalid matrix format")+". "),{err:i+=s,dispvalstr:"["+m.join(",")+"]",submitstr:f.join("|")}}function N(e,a,r){var n,i,s,o,l,c,u,d=t[e],p=d.vars,h=d.fvars,g=d.domain,m=r.match(/equation/),f=r.match(/inequality/),v="",b=D(e,a);r.match(/list/)?i=b[0].split(/,/):(!commasep&&b[0].match(/,/)&&(v+=_("Invalid use of a comma.")),i=[b[0]]);for(var y=0,x=0;x<i.length;x++){n=(n=i[x]).replace(/,/g,"").replace(/^\s+/,"").replace(/\s+$/,"").replace(/degree/g,"");var w=b[2].split("|");if(n.match(/(<=|>=|<|>|!=)/)?(f?n.match(/(<=|>=|<|>|!=)/g).length>1?v+=_("syntax error: your inequality should only contain one inequality symbol")+". ":n.match(/(^(<|>|!))|(=|>|<)$/)&&(v+=_("syntax error: your inequality should have expressions on both sides")+". "):v+=m?_("syntax error: you gave an inequality, not an equation")+". ":_("syntax error: you gave an inequality, not an expression")+". ",n=n.replace(/(.*)(<=|>=|<|>|!=)(.*)/,"$1-($3)")):n.match(/=/)?(f&&!m?v+=_("syntax error: you gave an equation, not an inequality")+". ":m?n.match(/=/g).length>1?v+=_("syntax error: your equation should only contain one equal sign")+". ":n.match(/(^=)|(=$)/)&&(v+=_("syntax error: your equation should have expressions on both sides")+". "):v+=_("syntax error: you gave an equation, not an expression")+". ",n=n.replace(/(.*)=(.*)/,"$1-($2)")):m&&f?v+=_("syntax error: this is not an equation or inequality")+". ":m?v+=_("syntax error: this is not an equation")+". ":f&&(v+=_("syntax error: this is not an inequality")+". "),!r.match(/generalcomplex/)){h.length>0&&(reg=new RegExp("("+h.join("|")+")\\(","g"),n=(n=(n=n.replace(/\w+/g,functoindex)).replace(reg,"$1*sin($1+")).replace(/@(\d+)@/g,indextofunc));var q=makeMathFunction(n,w.join("|"),[],"",r.match(/generalcomplex/));if(y=0,!1!==q)for(o=0;o<20;o++){for(l={DNE:1},s=0;s<w.length-1;s++)c=g[s][2]?Math.floor(g[s][0]+(g[s][1]-g[s][0])*o/20):g[s][0]+(g[s][1]-g[s][0])*o/20,l[w[s]]=c;if(""!==(u=q(l))&&!isNaN(u)){y++;break}}0===y&&(v+=_("syntax error")+". ")}v+=K(b[0],r+",isnumfunc",p.map(F).join("|"))}return{err:v}}function R(e){var t=a[e].exportObjs(Kekule.Molecule)[0];if(void 0===t)document.getElementById("qn"+e).value="";else{var r=Kekule.IO.saveFormatData(t,"smi"),n=Kekule.IO.saveFormatData(t,"cml");document.getElementById("qn"+e).value=r+"~~~"+n}}function L(e){return e.replace(/[^\w_\^\-+]/g,"")}function S(e,t){var a=L(t);if(commasep&&(e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),e.match(/all\s*real/i))return["(-oo,oo)"];if(e.match(/DNE/))return["DNE"];var r,n,i=[],s=e.split(/\s*or\s*/);if(1==s.length&&e.match(/!=/)){var o=e.split(/!=/);return 2!=o.length?["","invalid"]:L(o[0])!=a?["","wrongvar"]:["(-oo,"+o[1]+")U("+o[1]+",oo)"]}for(var l=0;l<s.length;l++)if(str=s[l],r=str.match(/^(.*?)(<=?|>=?)(.*?)(<=?|>=?)(.*?)$/)){if(L(r[3])!=a)return["","wrongvar"];if(r[2].charAt(0)!=r[4].charAt(0))return["","invalid"];if(""==r[1].trim()||""==r[5].trim())return["","invalid"];n="<"==r[2].charAt(0)?("<"==r[2]?"(":"[")+r[1]+","+r[5]+("<"==r[4]?")":"]"):(">"==r[4]?"(":"[")+r[5]+","+r[1]+(">"==r[2]?")":"]"),i.push(n)}else{if(!(r=str.match(/^(.*?)(<=?|>=?)(.*?)$/)))return["","invalid"];if(L(r[1])==a)n="<"==r[2].charAt(0)?"(-oo,"+r[3]+("<"==r[2]?")":"]"):(">"==r[2]?"(":"[")+r[3]+",oo)",i.push(n);else{if(L(r[3])!=a)return["","wrongvar"];n="<"==r[2].charAt(0)?("<"==r[2]?"(":"[")+r[1]+",oo)":"(-oo,"+r[1]+(">"==r[2]?")":"]"),i.push(n)}}var c=i.join("U");return c.match(/[\(\[],|,[\)\]]/)?["","invalid"]:[c]}function H(e,t){var a="",r="",n="";if(e=e.replace(/^\s+/,"").replace(/\s+$/,""),-1!=t.indexOf("allowjcomplex")&&(e=e.replace(/j/g,"i")),a+=K(e,t),-1!=t.indexOf("generalcomplex"))return{err:a,outstrdisp:e};if(-1==t.indexOf("sloppycomplex")){var i=function(e){var t,a,r,n,i,s,o,l=(e=(e=(e=(e=e.replace(/\s/,"")).replace(/\((\d+\*?i|i)\)\/(\d+)/g,"$1/$2")).replace(/sin/g,"s$n")).replace(/pi/g,"p$")).length;if(e.split("i").length>2)return _("error - more than 1 i in expression");if(-1==(i=e.indexOf("i")))t=e,a="0";else{for(n=0,o=i-1;o>0;o--)if(")"==(r=e.charAt(o)))n++;else if("("==r)n--;else if(("+"==r||"-"==r)&&0==n)break;if(o<0&&(o=0),0!=n)return _("error - invalid form");for(n=0,s=i+1;s<l;s++)if("("==(r=e.charAt(s)))n++;else if(")"==r)n--;else if(("+"==r||"-"==r)&&0==n)break;if(0!=n)return _("error - invalid form");if(i-o>0&&s-i>0&&(s==l||0==o)){if(s==l)t=e.substr(0,o),a=e.substr(o,i-o);else{if(0!=o)return _("error - invalid form");t=e.substr(s),a=e.substr(0,i)}a=(a=(a+="*"+e.substr(i+1+("*"==e.charAt(i+1)?1:0),s-i-1)).replace("-*","-1*").replace("+*","+1*")).replace(/(\+|-)1\*(.+)/g,"$1$2")}else if(i-o>1)a=e.substr(o,i-o),t=e.substr(0,o)+e.substr(i+1);else if(s-i>1)if(i>0){if("+"!=e.charAt(i-1)&&"-"!=e.charAt(i-1))return _("error - invalid form");a=e.charAt(i-1)+e.substr(i+1+("*"==e.charAt(i+1)?1:0),s-i-1),t=e.substr(0,i-1)+e.substr(s)}else a=e.substr(i+1,s-i-1),t=e.substr(0,i)+e.substr(s);else a="+"==e.charAt(o)?"1":"-"==e.charAt(o)?"-1":0==i?"1":e.charAt(o),t=(i>0?e.substr(0,o):"")+e.substr(i+1);""==t&&(t="0"),"/"==a.charAt(0)?a="1"+a:"+"!=a.charAt(0)&&"-"!=a.charAt(0)||"/"!=a.charAt(1)||(a=a.charAt(0)+"1"+a.substr(1)),"*"==a.charAt(a.length-1)&&(a=a.substr(0,a.length-1)),"+"==a.charAt(0)&&(a=a.substr(1)),"+"==t.charAt(0)&&(t=t.substr(1))}return[t=(t=t.replace(/s\$n/g,"sin")).replace(/p\$/g,"pi"),a=(a=(a=a.replace(/s\$n/g,"sin")).replace(/p\$/g,"pi")).replace(/\*\//g,"/")]}(e);"string"==typeof i?a+=i:(a+=J(i[0],t),a+=J(i[1],t))}if(""!==e){var s=evalMathParser(e,!0);if(Array.isArray(s)){var o=s[0],l=s[1];r=Math.abs(o)<1e-16?"":o,n=Math.abs(o)<1e-16?"":T(o),r+=Math.abs(l)<1e-16?"":(l>0&&""!=r?"+":"")+l+"i",n+=Math.abs(l)<1e-16?"":(l>0&&""!=r?"+":"")+T(l)+"i"}else a+=_("syntax incomplete"),o=NaN}return{err:a,outstrdisp:n,outstr:r}}var z=/^[\u0000-\u007f]*$/;function J(e,t){if(commasep&&(e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),e.match(/DNE/i))return"";if(e.match(/-?\+?oo$/)||e.match(/-?\+?oo\W/))return"";if(e.match(/,/))return _("Invalid use of a comma.");if(-1!=t.indexOf("allowmixed")&&e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/))return"";if(-1!=t.indexOf("fracordec")){if(!((e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2").replace(/\s/g,"")).match(/^\(?\-?\(?\d+\)?\/\(?\d+\)?$/)||e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)||e.match(/^\-?\d+$/)||e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/)))return _(" invalid entry format")+". "}else if(-1!=t.indexOf("fraction")||-1!=t.indexOf("reducedfraction")){if(!(e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2").replace(/\s/g,"")).match(/^\(?\-?\(?\d+\)?\/\(?\-?\d+\)?$/)&&!e.match(/^\s*?\-?\d+\s*$/))return _("not a valid fraction")+". "}else if(-1!=t.indexOf("mixednumber")){if(!(e.match(/^\(?\-?\s*\(?\d+\)?\/\(?\d+\)?$/)||e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)||e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/)||e.match(/^\s*\-?\s*\d+\s*$/)))return _("not a valid mixed number")+". ";e=e.replace(/_/," ")}else if(-1!=t.indexOf("scinot")){if(!(e=(e=e.replace(/\s/g,"")).replace(/(xx|x|X|\u00D7)/,"xx")).match(/^\-?[1-9](\.\d*)?(\*|xx)10\^(\(?\(?\-?\d+\)?\)?)$/)){if(-1==t.indexOf("scinotordec"))return _("not valid scientific notation")+". ";if(!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)([eE]\-?\d+)?$/))return _("not valid decimal or scientific notation")+". "}}else if(-1!=t.indexOf("decimal")&&-1==t.indexOf("nodecimal")){if(!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)([eE]\-?\d+)?$/))return _(" not a valid integer or decimal number")+". "}else if(-1!=t.indexOf("integer")){if(!e.match(/^\s*\-?\d+(\.0*)?\s*$/))return _(" not an integer number")+". "}else if(!z.test(e))return _("Your answer contains an unrecognized symbol")+". ";return""}function K(e,t,a){var r="";-1!=t.indexOf("notrig")&&e.match(/(sin|cos|tan|cot|sec|csc)/i)?r+=_("no trig functions allowed")+". ":-1!=t.indexOf("nodecimal")&&-1!=e.indexOf(".")?r+=_("no decimals allowed")+". ":-1==t.indexOf("mixed")&&e.match(/\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/)?r+=_("mixed numbers are not allowed")+". ":-1==t.indexOf("allowdegrees")&&e.match(/degree/)&&(r+=_("no degree symbols allowed")+". ");for(var n=0,i=0,s=0,o=0;o<e.length;o++)"("==e.charAt(o)?n++:")"==e.charAt(o)?n--:"["==e.charAt(o)?i++:"]"==e.charAt(o)?i--:"|"==e.charAt(o)&&(s=1-s);if(0==n&&0==i||(r+=" ("+_("unmatched parens")+"). "),0!=s&&(r+=" ("+_("unmatched absolute value bars")+"). "),reg=a?new RegExp("(sqrt|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*("+a+"|\\d+)","i"):new RegExp("(sqrt|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*(\\d+)","i"),errstuff=e.match(reg),null!=errstuff&&(r+="["+_("use function notation")+" - "+_("use $1 instead of $2",errstuff[1]+"("+errstuff[2]+")",errstuff[0])+"]. "),a)if(t.match(/casesensitivevars/)){(l="degree|arc|arg|ar|sqrt|root|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs|pi|sign|DNE|e|oo".split("|")).sort((function(e,t){return t.length-e.length}));let t=new RegExp("("+l.join("|")+")","ig");(l=a.split("|")).sort((function(e,t){return t.length-e.length}));let n=new RegExp("("+l.join("|")+")","g");e.replace(/repvars\d+/g,"").replace(t,"").replace(n,"").match(/[a-zA-Z]/)&&(r+=_(" Check your variables - you might be using an incorrect one")+". ")}else{var l;(l="degree|arc|arg|ar|sqrt|root|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs|pi|sign|DNE|e|oo".split("|").concat(a.split("|"))).sort((function(e,t){return t.length-e.length}));let t=new RegExp("("+l.join("|")+")","ig");e.replace(/repvars\d+/g,"").replace(t,"").match(/[a-zA-Z]/)&&(r+=_(" Check your variables - you might be using an incorrect one")+". ")}if((e.match(/\|/g)||[]).length>2)for(var c=/\|.*?\|\s*(.|$)/g;match=c.exec(e);)if(""!=match[1]&&match[1].match(/[^+\-\*\/\^\)]/)){r+=_(" You may want to use abs(x) instead of |x| for absolute values to avoid ambiguity")+". ";break}return e.match(/\(\s*\)/)&&(r+=_(" Empty function input or parentheses")+". "),e.match(/%/)&&!e.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(r+=_(" Do not use the percent symbol, %")+". "),e.match(/=/)&&!t.match(/isnumfunc/)&&(r+=_("You gave an equation, not an expression")+". "),r}function Q(e,t){if(commasep&&(e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),e.match(/,/))return[NaN,_("syntax incomplete")+". "];e.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(e=e.replace(/%/g,"")+"/100"),-1!=t.indexOf("mixed")&&(e=e.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),-1!=t.indexOf("allowxtimes")&&(e=e.replace(/(xx|x|X|\u00D7)/,"*")),-1!=t.indexOf("scinot")&&(e=e.replace("xx","*"));try{var a=evalMathParser(e);return isNaN(a)||""===a?[NaN,_("syntax incomplete")+". "]:[a,""]}catch(e){return[NaN,_("syntax incomplete")+". "]}}function F(e){return e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}return{init:function(a,i,o){var g,x,w,k,$;for(g in MQeditor.setConfig({toMQ:r,fromMQ:n}),0==e("#arialive").length&&e("body").append(e("<p>",{id:"arialive","aria-live":"assertive","aria-atomic":"true",class:"sr-only"})),a)if(!isNaN(parseInt(g))){if(t[g]=a[g],(x=a[g]).helper&&x.qtype.match(/^(calc|numfunc|string|interval|matrix|chemeqn|complexmatrix|alg)/)){if(!(w=document.getElementById("qn"+g))&&!x.matrixsize)continue;k=x.qtype,x.calcformat&&(k+=","+x.calcformat),x.displayformat&&(k+=","+x.displayformat),x.matrixsize?(k+=",matrixsized",e("input[id^=qn"+g+"-]").attr("data-mq",k),x.vars&&e("input[id^=qn"+g+"-]").attr("data-mq-vars",x.vars)):(w.setAttribute("data-mq",k),x.vars&&w.setAttribute("data-mq-vars",x.vars)),i&&(x.matrixsize?MQeditor.toggleMQAll("input[id^=qn"+g+"-]",!0,!0):MQeditor.toggleMQ(w,!0,!0),e("#pbtn"+g).hide())}if(x.preview?(document.getElementById("pbtn"+g).addEventListener("click",function(e){return function(){q(e)}}(g)),1!=x.preview||x.qtype.match(/matrix/)||(v.hasOwnProperty(g)&&delete v[g],b(g,i),document.getElementById("qn"+g).addEventListener("keyup",y),i&&A(g))):x.matrixsize?e("input[id^=qn"+g+"-]").on("input",function(e){return function(){E(e)}}(g)):document.getElementById("qn"+g)&&document.getElementById("qn"+g).addEventListener("keyup",function(e){return function(){E(e)}}(g)),"debit"===x.format?document.getElementById("qn"+g).addEventListener("keyup",m):"credit"===x.format?(document.getElementById("qn"+g).addEventListener("keyup",f),e(".creditbox").each((function(e,t){f({target:t})}))):"normslider"===x.format&&imathasDraw.addnormslider(g,!0),x.autosuggest&&(!autoSuggestLists.hasOwnProperty(x.autosuggest)&&x.hasOwnProperty(x.autosuggest)&&(autoSuggestLists[x.autosuggest]=x[x.autosuggest]),autoSuggestLists.hasOwnProperty(x.autosuggest)&&(autoSuggestObjects[g]=new AutoSuggest(document.getElementById("qn"+g),autoSuggestLists[x.autosuggest]))),x.tip)if(w=document.getElementById("qn"+g+"-0"))for(I=0;document.getElementById("qn"+g+"-"+I);)l("qn"+g+"-"+I,x.tip,x.longtip),I++;else l("qn"+g,x.tip,x.longtip);if("draw"===x.qtype&&d(g),"file"===x.qtype&&initFileAlt(document.getElementById("qn"+g)),"multans"===x.qtype&&p(g),"molecule"===x.qtype&&h(g),x.usetinymce)if(document.getElementById("qn"+g).disabled&&!document.getElementById("tinyprev"+g)){var C=e("#qn"+g).val(),M=e("<div>",{id:"tinyprev"+g,class:"introtext"});M.html(C),e("#qn"+g).hide().after(M)}else{var O={};x.nopaste&&(O.paste_preprocess=function(e,t){t.content=""}),O.valid_classes="gridded,centered,attach,AMedit,AM",initeditor("selector","#qn"+g+".mceEditor",null,!1,(function(e){e.on("blur",(function(e){tinymce.triggerSave(),jQuery(e.target.targetElm).triggerHandler("change")})).on("focus",(function(e){jQuery(e.target.targetElm).triggerHandler("focus")}))}),O)}"essay"==x.qtype&&e("#qnwrap"+g+".introtext img").on("click",rotateimg),u(g),e("input[id^=qn"+g+"]:not([type=file])").attr("maxlength",8e3)}if(e(".rubriclink").each((function(t,a){e(a).removeClass("rubriclink");var r=a.id.substring(16);if(-1!==r.indexOf("-")){var n=r.split("-");r=1e3*(1*n[0]+1)+1*n[1]}var i=e("#mqinput-qn"+r+",input[type=text]#qn"+r+",select#qn"+r+",textarea#qn"+r+",div.introtext#qnwrap"+r);i.length>0&&(i.after(a),e(a).show())})),$='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>',e("input.sabtn + span.hidden, input.sabtn + div.hidden").each((function(t,a){var r,n=a.id.substring(3),i=n;if(-1!==i.indexOf("-")){var s=i.split("-");i=1e3*(1*s[0]+1)+1*s[1],r=_("Question ")+(1*s[0]+1)+_(" Part ")+(1*s[1]+1)}else r=_("Question ")+(1*i+1);var o=e("<span>",{class:"keywrap"}).append(e("<button>",{type:"button","aria-controls":"ans"+n,"aria-expanded":"false",class:"keybtn","aria-label":_("View Key for ")+r,title:_("View Key")}).on("click",(function(t){var a="true"==t.currentTarget.getAttribute("aria-expanded");t.currentTarget.setAttribute("aria-expanded",a?"false":"true"),e("#ans"+n).toggleClass("hidden",a),a||e("#ans"+n).attr("tabindex","-1").focus(),sendLTIresizemsg()})).html($));if(e(a).closest(".autoshowans").length>0){var l=e("#qnwrap"+i);if(l.length>0)return e(a).prev(".sabtn").remove(),o.append(e(a)).addClass("inwrap"),void l.append(o);var c=e("#mqinput-qn"+i+",input[type=text]#qn"+i+",select#qn"+i+",textarea#qn"+i);if(c.length>0)return e(a).prev(".sabtn").remove(),o.append(e(a)),void c.after(o)}var u=e(a).parent();o.append(e(a)),u.empty().append(o)})),e("input.dsbtn + div.hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),e("input.dsbtn").each((function(){var t=e(this).siblings("div:first-of-type").attr("id");e(this).attr("aria-expanded",!1).attr("aria-controls",t).off("click.sashow").on("click.sashow",(function(){var t="true"==e(this).attr("aria-expanded");e(this).attr("aria-expanded",!t).siblings("div:first-of-type").attr("aria-expanded",!t).attr("aria-hidden",t).toggleClass("hidden",t),sendLTIresizemsg()}))})),o&&function(t){var a='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="green" stroke-width="3" fill="none" role="img" aria-hidden=true>';a+='<polyline points="20 6 9 17 4 12"></polyline></svg>',a+='<span class="sr-only scoremarker">'+_("Correct")+"</span>";var r='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="rgb(255,187,0)" stroke-width="3" fill="none" role="img" aria-hidden=true>';r+='<path d="M 5.3,10.6 9,14.2 18.5,4.6 21.4,7.4 9,19.8 2.7,13.5 z" /></svg>',r+='<span class="sr-only scoremarker">'+_("Partially correct")+"</span>";var n='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="rgb(153,0,0)" stroke-width="3" fill="none" role="img" aria-hidden=true>';n+='<path d="M18 6 L6 18 M6 6 L18 18" /></svg>',n+='<span class="sr-only scoremarker">'+_("Incorrect")+"</span>";var i='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="rgb(255,85,0)" stroke-width="3" fill="none" role="img" aria-hidden=true>';i+='<path d="M18 6 L6 18 M6 6 L18 18" /></svg>',i+='<span class="sr-only scoremarker">'+_("Incorrect, wrong format")+"</span>",e(t).find(".scoremarker").remove(),e(t).find("div.ansgrn,table.ansgrn").append(a),e(t).find("div.ansyel,table.ansyel").append(r),e(t).find("div.ansred,table.ansred").append(n),e(t).find("div.ansorg,table.ansorg").append(i),e(t).find("select.ansgrn").after(a),e(t).find("select.ansyel").after(r),e(t).find("select.ansred").after(n),e(t).find("select.ansorg").after(i),e(t).find("span[id^=mqinput-].ansgrn,input[type=text].ansgrn").after('<span class="scoremarker sr-only">'+_("Correct")+"</span>"),e(t).find("span[id^=mqinput-].ansyel,input[type=text].ansyel").after('<span class="scoremarker sr-only">'+_("Partially correct")+"</span>"),e(t).find("span[id^=mqinput-].ansred,input[type=text].ansred").after('<span class="scoremarker sr-only">'+_("Incorrect")+"</span>"),e(t).find("span[id^=mqinput-].ansorg,input[type=text].ansorg").after('<span class="scoremarker sr-only">'+_("Incorrect, wrong format")+"</span>"),e(t).find("span[id^=mqinput-].ansorg,input[type=text].ansorg").after(e("<span>",{role:"button",class:"scoremarker",tabindex:0,"aria-label":_("Incorrect, wrong format"),"data-tip":_("Your answer is equivalent to the correct answer, but is not simplified or is in the wrong format"),"data-tooltipclass":"dropdown-pane tooltip-pane"}).on("mouseover focus",(function(){tipshow(this)})).on("mouseleave blur",tipout).html('<svg style="vertical-align:middle;margin-left:3px;" viewBox="0 0 24 24" width="18" height="18" stroke="rgb(255,85,0)" stroke-width="2" stroke-linecap="round" fill="none" role="img" aria-hidden=true><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12" y2="16"></line></svg>'))}(o),e("input[id^=qs][value=spec]").each((function(t,a){e(a).siblings("input[type=text]").off("keyup.qsclickchange").on("keyup.qsclickchange",(function(t){8!=t.keyCode&&46!=t.keyCode&&e(a).prop("checked",!0)}))})),e("input[id^=qn]").off("input.clearmarkers").on("input.clearmarkers",c),e("input[id^=qs],select[id^=qn]").off("change.clearmarkers").on("change.clearmarkers",c),a.scripts){for(var I in a.scripts)"code"==a.scripts[I][0]?scriptqueue.push(a.scripts[I]):-1==loadedscripts.indexOf(a.scripts[I][1])&&(scriptqueue.push(a.scripts[I]),loadedscripts.push(a.scripts[I][1]));scriptqueue.length>0&&!1===processingscriptsqueue&&s()}},clearparams:function(e){var a;for(a in e)delete t[a]},preSubmitForm:function(e){var a;for(var r in t){var n;if(!1!==(a=C(r)))if(n=document.getElementById("qn"+r+"-val"))n.value=a;else{var i=document.createElement("input");i.type="hidden",i.name="qn"+r+"-val",i.value=a,e.appendChild(i)}}},preSubmit:C,preSubmitString:function(e,a){var r=parseInt(e.substr(2));if(!t.hasOwnProperty(r))return a;var n=t[r];return a=(a=x(a)).replace(/^\s+/,"").replace(/\s+$/,""),"numfunc"==n.qtype&&"qs"!=e.substr(0,2)&&(a=D(r,a)[3]),a.length>3e4&&(a=a.substr(0,3e4)),a},clearLivePreviewTimeouts:function(){for(var e in v)clearTimeout(v[e].finaltimeout)},syntaxCheckMQ:E,clearTips:function(){hideAllEhTips()},handleMQenter:function(t){var a=e("#"+t).closest(".questionwrap").find(".submitbtnwrap .primary");a.is(":disabled")||a.trigger("click")}}}(jQuery);function prepWithMath(e){return e=(e=(e=e.replace(/\b(abs|acos|asin|atan|ceil|floor|cos|sin|tan|sqrt|exp|max|min|pow)\(/g,"Math.$1(")).replace(/\(E\)/g,"(Math.E)")).replace(/\((PI|pi)\)/g,"(Math.PI)")}function toggleinlinebtn(e,t){var a=document.getElementById(t),r=document.getElementById(e);"none"==r.style.display?(r.style.display="",r.setAttribute("aria-hidden",!1),a.setAttribute("aria-expanded",!0)):(r.style.display="none",r.setAttribute("aria-hidden",!0),a.setAttribute("aria-expanded",!1));var n=a.innerHTML;a.innerHTML=n.match(/\[\+\]/)?n.replace(/\[\+\]/,"[-]"):n.replace(/\[\-\]/,"[+]"),sendLTIresizemsg()}var seqgroupcollapsed={};function setupSeqPartToggles(e){if(e.id&&e.id.match(/questionwrap/)){var t=parseInt(e.id.substr(12)),a=$(e).find(".seqsep");if(seqgroupcollapsed[t]&&1!=a.length||(seqgroupcollapsed[t]={}),a.length>1)for(var r=0;r<a.length-1;r++)$(a[r]).next().attr("id","seqgrp"+t+"-"+r),seqgroupcollapsed[t][r]&&$(a[r]).next().hide(),$(a[r]).prepend($("<button>",{class:"plain slim",style:"color: inherit","aria-expanded":!seqgroupcollapsed[t][r],"aria-controls":"seqgrp"+t+"-"+r,"aria-label":seqgroupcollapsed[t][r]?_("Expand"):_("Collapse"),html:seqgroupcollapsed[t][r]?"&#x25B6;":"&#x25BC;",type:"button",click:function(e){var t="true"==this.getAttribute("aria-expanded"),a=this.getAttribute("aria-controls");t?(this.setAttribute("aria-expanded","false"),this.setAttribute("aria-label",_("Expand")),this.innerHTML="&#x25B6;"):(this.setAttribute("aria-expanded","true"),this.setAttribute("aria-label",_("Collapse")),this.innerHTML="&#x25BC;"),$("#"+a).slideToggle(300);var r=a.substr(6).split("-");seqgroupcollapsed[r[0]][r[1]]=t,sendLTIresizemsg()}}))}}function AutoSuggest(e,t){var a=this;this.elem=e,this.suggestions=t,this.eligible=new Array,this.inputText=null,this.highlighted=-1,this.div=document.getElementById("autosuggest"),null==this.div&&(this.div=document.createElement("div"),this.div.id="autosuggest",document.getElementsByTagName("body")[0].appendChild(this.div),this.div.appendChild(document.createElement("ul")));if(e.setAttribute("autocomplete","off"),!e.id){var r="autosuggest"+AutoSuggestIdCounter;AutoSuggestIdCounter++,e.id=r}e.onkeydown=function(e){var t=a.getKeyCode(e);switch(t){case 9:a.useSuggestion("tab");break;case 13:return a.highlighted>-1&&e.stopImmediatePropagation(),a.useSuggestion("enter"),!1;case 27:a.hideDiv();break;case 38:a.highlighted>0&&a.highlighted--,a.changeHighlight(t);break;case 40:a.highlighted<a.eligible.length-1&&a.highlighted++,a.changeHighlight(t)}},e.onkeyup=function(e){switch(a.getKeyCode(e)){case 9:case 27:case 38:case 40:return;default:this.value.length>1?(a.inputText=this.value,a.getEligible(),a.eligible.length>0?a.highlighted=0:a.highlighted=-1,a.createDiv(),a.positionDiv(),a.showDiv()):(a.hideDiv(),0==this.value.length&&(a.inputText=""))}},e.onblur=function(e){a.hideDiv()},this.useSuggestion=function(e){this.highlighted>-1?(this.elem.value=this.eligible[this.highlighted],this.hideDiv()):this.hideDiv()},this.showDiv=function(){this.div.style.display="block"},this.hideDiv=function(){a.div.style.display="none",a.highlighted=-1},this.changeHighlight=function(){var e=this.div.getElementsByTagName("LI");for(i in e){var t=e[i];this.highlighted==i?t.className="selected":t.className=""}},this.positionDiv=function(){var e=this.elem,t=findPos(e);t[1]+=e.offsetHeight,this.div.style.left=t[0]+"px",this.div.style.top=t[1]+"px"},this.createDiv=function(){var e=document.createElement("ul");for(i in this.eligible){var t=this.eligible[i],r=document.createElement("li"),n=document.createElement("a");n.href="#",n.onclick=function(){return!1},n.innerHTML=t,r.appendChild(n),a.highlighted==i&&(r.className="selected"),e.appendChild(r)}this.div.replaceChild(e,this.div.childNodes[0]),this.setHighlight=function(e){for(var t=a.getEventSource(e);t.parentNode&&"LI"!=t.tagName.toUpperCase();)t=t.parentNode;var r=a.div.getElementsByTagName("LI");for(i in r){if(r[i]==t){a.highlighted=i;break}}a.changeHighlight()},e.onmouseover=a.setHighlight,e.onmousedown=e.ontouchstart=function(e){return a.setHighlight(e),a.useSuggestion("click"),a.hideDiv(),a.cancelEvent(e),!1},this.div.className="suggestion_list",this.div.style.position="absolute"},this.getEligible=function(){this.eligible=new Array;if(-1==this.inputText.indexOf(" ")){var e=new RegExp("\\b"+this.inputText.toLowerCase());for(i in this.suggestions){var t=this.suggestions[i];t.toLowerCase().match(e)&&(this.eligible[this.eligible.length]=t,i+",")}}},this.getKeyCode=function(e){return e?e.keyCode:window.event?window.event.keyCode:void 0},this.getEventSource=function(e){return e?e.target:window.event?window.event.srcElement:void 0},this.cancelEvent=function(e){e&&(e.preventDefault(),e.stopPropagation()),window.event&&(window.event.returnValue=!1)}}var AutoSuggestIdCounter=0,autoSuggestLists={},autoSuggestObjects={};document.write=function(){};