var initstack,loadedscripts,scriptqueue,processingscriptsqueue,callbackstack,imathasAssess,seqgroupcollapsed,AutoSuggestIdCounter,autoSuggestLists,autoSuggestObjects;function prepWithMath(e){return e=(e=(e=e.replace(/\b(abs|acos|asin|atan|ceil|floor|cos|sin|tan|sqrt|exp|max|min|pow)\(/g,"Math.$1(")).replace(/\(E\)/g,"(Math.E)")).replace(/\((PI|pi)\)/g,"(Math.PI)")}function toggleinlinebtn(e,t){var t=document.getElementById(t),e=document.getElementById(e);"none"==e.style.display?(e.style.display="",e.setAttribute("aria-hidden",!1),t.setAttribute("aria-expanded",!0)):(e.style.display="none",e.setAttribute("aria-hidden",!0),t.setAttribute("aria-expanded",!1)),e=t.innerHTML,t.innerHTML=e.match(/\[\+\]/)?e.replace(/\[\+\]/,"[-]"):e.replace(/\[\-\]/,"[+]")}function setupSeqPartToggles(e){var t,a,r;if(e.id&&e.id.match(/questionwrap/)&&(t=parseInt(e.id.substr(12)),a=$(e).find(".seqsep"),seqgroupcollapsed[t]&&1!=a.length||(seqgroupcollapsed[t]={}),1<a.length))for(r=0;r<a.length-1;r++)$(a[r]).next().attr("id","seqgrp"+t+"-"+r),seqgroupcollapsed[t][r]&&$(a[r]).next().hide(),$(a[r]).prepend($("<button>",{class:"plain slim",style:"color: inherit","aria-expanded":!seqgroupcollapsed[t][r],"aria-controls":"seqgrp"+t+"-"+r,"aria-label":seqgroupcollapsed[t][r]?_("Expand"):_("Collapse"),html:seqgroupcollapsed[t][r]?"&#x25B6;":"&#x25BC;",type:"button",click:function(e){var t="true"==this.getAttribute("aria-expanded"),a=this.getAttribute("aria-controls");t?(this.setAttribute("aria-expanded","false"),this.setAttribute("aria-label",_("Expand")),this.innerHTML="&#x25B6;"):(this.setAttribute("aria-expanded","true"),this.setAttribute("aria-label",_("Collapse")),this.innerHTML="&#x25BC;"),$("#"+a).slideToggle(300),a=a.substr(6).split("-"),seqgroupcollapsed[a[0]][a[1]]=t}}))}function AutoSuggest(e,t){var n=this;this.elem=e,this.suggestions=t,this.eligible=new Array,this.inputText=null,this.highlighted=-1,this.div=document.getElementById("autosuggest"),null==this.div&&(this.div=document.createElement("div"),this.div.id="autosuggest",document.getElementsByTagName("body")[0].appendChild(this.div),this.div.appendChild(document.createElement("ul"))),e.setAttribute("autocomplete","off"),e.id||(t="autosuggest"+AutoSuggestIdCounter,AutoSuggestIdCounter++,e.id=t),e.onkeydown=function(e){var t=n.getKeyCode(e);switch(t){case 9:n.useSuggestion("tab");break;case 13:return-1<n.highlighted&&e.stopImmediatePropagation(),n.useSuggestion("enter"),!1;case 27:n.hideDiv();break;case 38:0<n.highlighted&&n.highlighted--,n.changeHighlight(t);break;case 40:n.highlighted<n.eligible.length-1&&n.highlighted++,n.changeHighlight(t)}},e.onkeyup=function(e){switch(n.getKeyCode(e)){case 9:case 27:case 38:case 40:return;default:1<this.value.length?(n.inputText=this.value,n.getEligible(),0<n.eligible.length?n.highlighted=0:n.highlighted=-1,n.createDiv(),n.positionDiv(),n.showDiv()):(n.hideDiv(),0==this.value.length&&(n.inputText=""))}},e.onblur=function(e){n.hideDiv()},this.useSuggestion=function(e){-1<this.highlighted&&(this.elem.value=this.eligible[this.highlighted]),this.hideDiv()},this.showDiv=function(){this.div.style.display="block"},this.hideDiv=function(){n.div.style.display="none",n.highlighted=-1},this.changeHighlight=function(){var e,t=this.div.getElementsByTagName("LI");for(i in t)e=t[i],this.highlighted==i?e.className="selected":e.className=""},this.positionDiv=function(){var e=this.elem,t=findPos(e);t[1]+=e.offsetHeight,this.div.style.left=t[0]+"px",this.div.style.top=t[1]+"px"},this.createDiv=function(){var e,t,a,r=document.createElement("ul");for(i in this.eligible)e=this.eligible[i],t=document.createElement("li"),(a=document.createElement("a")).href="#",a.onclick=function(){return!1},a.innerHTML=e,t.appendChild(a),n.highlighted==i&&(t.className="selected"),r.appendChild(t);this.div.replaceChild(r,this.div.childNodes[0]),this.setHighlight=function(e){for(var t,a=n.getEventSource(e);a.parentNode&&"LI"!=a.tagName.toUpperCase();)a=a.parentNode;for(i in t=n.div.getElementsByTagName("LI"))if(t[i]==a){n.highlighted=i;break}n.changeHighlight()},r.onmouseover=n.setHighlight,r.onmousedown=r.ontouchstart=function(e){return n.setHighlight(e),n.useSuggestion("click"),n.hideDiv(),n.cancelEvent(e),!1},this.div.className="suggestion_list",this.div.style.position="absolute"},this.getEligible=function(){var e,t;if(this.eligible=new Array,-1==this.inputText.indexOf(" "))for(i in e=new RegExp("\\b"+this.inputText.toLowerCase()),this.suggestions)(t=this.suggestions[i]).toLowerCase().match(e)&&(this.eligible[this.eligible.length]=t,i)},this.getKeyCode=function(e){return e?e.keyCode:window.event?window.event.keyCode:void 0},this.getEventSource=function(e){return e?e.target:window.event?window.event.srcElement:void 0},this.cancelEvent=function(e){e&&(e.preventDefault(),e.stopPropagation()),window.event&&(window.event.returnValue=!1)}}initstack=[],loadedscripts=[],scriptqueue=[],processingscriptsqueue=!1,callbackstack={},imathasAssess=function($){var allParams,LivePreviews,MQsyntaxtimer,greekletters,onlyAscii;function clearparams(e){for(var t in e)delete allParams[t]}function toMQwVars(e,t){var a=t.substr(2).split(/-/)[0],r=allParams[a].qtype;return("numfunc"===r||"calcinterval"===r&&-1!=allParams[a].calcformat.indexOf("inequality"))&&(e=AMnumfuncPrepVar(a,e)[1]),AMtoMQ(e,t,!("matrix"===r||"calcmatrix"===r||"string"===r))}function fromMQwText(e,t){return e=(e=MQtoAM(e)).replace(/\(text\((.*?)\)\)/g,"($1)").replace(/text\((.*?)\)/g," $1 ")}function init(e,t,a){var r,i,n,s,c,l;for(r in MQeditor.setConfig({toMQ:toMQwVars,fromMQ:fromMQwText}),0==$("#arialive").length&&$("body").append($("<p>",{id:"arialive","aria-live":"assertive","aria-atomic":"true",class:"sr-only"})),e)if(!isNaN(parseInt(r))){if(allParams[r]=e[r],(i=e[r]).helper&&i.qtype.match(/^(calc|numfunc|string|interval|matrix|chemeqn)/)){if(!(s=document.getElementById("qn"+r))&&!i.matrixsize)continue;c=i.qtype,i.calcformat&&(c+=","+i.calcformat),i.displayformat&&(c+=","+i.displayformat),i.matrixsize?(c+=",matrixsized",$("input[id^=qn"+r+"-]").attr("data-mq",c)):(s.setAttribute("data-mq",c),i.vars&&s.setAttribute("data-mq-vars",i.vars)),t&&(i.matrixsize?MQeditor.toggleMQAll("input[id^=qn"+r+"-]",!0,!0):MQeditor.toggleMQ(s,!0,!0),$("#pbtn"+r).hide())}if(i.preview?(document.getElementById("pbtn"+r).addEventListener("click",function(e){return function(){showPreview(e)}}(r)),1!=i.preview||i.qtype.match(/matrix/)||(LivePreviews.hasOwnProperty(r)&&delete LivePreviews[r],setupLivePreview(r,t),document.getElementById("qn"+r).addEventListener("keyup",updateLivePreview),t&&showSyntaxCheckMQ(r))):i.matrixsize?$("input[id^=qn"+r+"-]").on("input",function(e){return function(){syntaxCheckMQ(e)}}(r)):document.getElementById("qn"+r)&&document.getElementById("qn"+r).addEventListener("keyup",function(e){return function(){syntaxCheckMQ(e)}}(r)),"debit"===i.format?document.getElementById("qn"+r).addEventListener("keyup",editdebit):"credit"===i.format?(document.getElementById("qn"+r).addEventListener("keyup",editcredit),initcreditboxes()):"normslider"===i.format&&imathasDraw.addnormslider(r,!0),i.autosuggest&&(!autoSuggestLists.hasOwnProperty(i.autosuggest)&&i.hasOwnProperty(i.autosuggest)&&(autoSuggestLists[i.autosuggest]=i[i.autosuggest]),autoSuggestLists.hasOwnProperty(i.autosuggest))&&(autoSuggestObjects[r]=new AutoSuggest(document.getElementById("qn"+r),autoSuggestLists[i.autosuggest])),i.tip)if(s=document.getElementById("qn"+r+"-0"))for(n=0;document.getElementById("qn"+r+"-"+n);)setupTips("qn"+r+"-"+n,i.tip,i.longtip),n++;else setupTips("qn"+r,i.tip,i.longtip);"draw"===i.qtype&&setupDraw(r),"file"===i.qtype&&initFileAlt(document.getElementById("qn"+r)),"multans"===i.qtype&&initMultAns(r),i.usetinymce&&(document.getElementById("qn"+r).disabled&&!document.getElementById("tinyprev"+r)?(c=$("#qn"+r).val(),(l=$("<div>",{id:"tinyprev"+r,class:"introtext"})).html(c),$("#qn"+r).hide().after(l)):(l=null,i.nopaste&&(l={paste_preprocess:function(e,t){t.content=""}}),initeditor("selector","#qn"+r+".mceEditor",null,!1,function(e){e.on("blur",function(e){tinymce.triggerSave(),jQuery(e.target.targetElm).triggerHandler("change")}).on("focus",function(e){jQuery(e.target.targetElm).triggerHandler("focus")})},l))),"essay"==i.qtype&&$("#qnwrap"+r+".introtext img").on("click",rotateimg),initEnterHandler(r),$("input[id^=qn"+r+"]:not([type=file])").attr("maxlength",8e3)}if(initDupRubrics(),initShowAnswer2(),a&&setScoreMarkers(a),initqsclickchange(),initClearScoreMarkers(),e.scripts){for(n in e.scripts)"code"==e.scripts[n][0]?scriptqueue.push(e.scripts[n]):-1==loadedscripts.indexOf(e.scripts[n][1])&&(scriptqueue.push(e.scripts[n]),loadedscripts.push(e.scripts[n][1]));0<scriptqueue.length&&!1===processingscriptsqueue&&processScriptQueue()}}function processScriptQueue(){if(processingscriptsqueue=!0,0!=scriptqueue.length){var t=scriptqueue.shift();if("code"==t[0]){try{window.eval(t[1])}catch(e){console.log("Error executing question script:"+t[1])}processScriptQueueNext()}else jQuery.getScript(t[1]).always(function(){processScriptQueueNext()})}}function processScriptQueueNext(){for(var e=0;e<initstack.length;e++)initstack[e]();(initstack.length=0)==scriptqueue.length?processingscriptsqueue=!1:processScriptQueue()}function setupTips(e,t,a){var r,i=document.getElementById(e);i&&(i.setAttribute("data-tip",t),r=e.substr(2).split(/-/)[0],document.getElementById("tips"+r)||$("body").append($("<div>",{class:"hidden",id:"tips"+r}).html(a)),i.setAttribute("aria-describedby","tips"+r),i.addEventListener("focus",function(){showehdd(e,t,r)}),i.addEventListener("blur",hideeh),i.addEventListener("click",function(){reshrinkeh(e)}))}function clearTips(){hideAllEhTips()}function initqsclickchange(){$("input[id^=qs][value=spec]").each(function(e,t){$(t).siblings("input[type=text]").off("keyup.qsclickchange").on("keyup.qsclickchange",function(e){8!=e.keyCode&&46!=e.keyCode&&$(t).prop("checked",!0)})})}function clearScoreMarkers(e){var t,e=e.currentTarget;null!==(t=e.className.match(/(ansgrn|ansred|ansyel|ansorg)/))?($(e).removeClass(t[0]),$(e).nextAll(".scoremarker.sr-only").first().remove(),"ansorg"==t[0]&&$(e).nextAll(".scoremarker").first().remove(),"select"==e.tagName.toLowerCase()&&$(e).nextAll("svg.scoremarker").first().remove(),"hidden"==e.type&&$("#mqinput-"+e.id).removeClass(t[0])):0<(e=$(e).closest("[id^=qnwrap]")).length&&null!==(t=e[0].className.match(/(ansgrn|ansred|ansyel|ansorg)/))&&(e.removeClass(t[0]),e.find(".scoremarker").remove())}function setScoreMarkers(e){var t,a,r,i='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="green" stroke-width="3" fill="none" role="img" aria-hidden=true>';i=(i+='<polyline points="20 6 9 17 4 12"></polyline></svg>')+'<span class="sr-only scoremarker">'+_("Correct")+"</span>",t='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="rgb(255,187,0)" stroke-width="3" fill="none" role="img" aria-hidden=true>',t=(t+='<path d="M 5.3,10.6 9,14.2 18.5,4.6 21.4,7.4 9,19.8 2.7,13.5 z" /></svg>')+'<span class="sr-only scoremarker">'+_("Partially correct")+"</span>",a='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="rgb(153,0,0)" stroke-width="3" fill="none" role="img" aria-hidden=true>',a=(a+='<path d="M18 6 L6 18 M6 6 L18 18" /></svg>')+'<span class="sr-only scoremarker">'+_("Incorrect")+"</span>",r='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="rgb(255,85,0)" stroke-width="3" fill="none" role="img" aria-hidden=true>',r=(r+='<path d="M18 6 L6 18 M6 6 L18 18" /></svg>')+'<span class="sr-only scoremarker">'+_("Incorrect, wrong format")+"</span>",$(e).find(".scoremarker").remove(),$(e).find("div.ansgrn,table.ansgrn").append(i),$(e).find("div.ansyel,table.ansyel").append(t),$(e).find("div.ansred,table.ansred").append(a),$(e).find("div.ansorg,table.ansorg").append(r),$(e).find("select.ansgrn").after(i),$(e).find("select.ansyel").after(t),$(e).find("select.ansred").after(a),$(e).find("select.ansorg").after(r),$(e).find("span[id^=mqinput-].ansgrn,input[type=text].ansgrn").after('<span class="scoremarker sr-only">'+_("Correct")+"</span>"),$(e).find("span[id^=mqinput-].ansyel,input[type=text].ansyel").after('<span class="scoremarker sr-only">'+_("Partially correct")+"</span>"),$(e).find("span[id^=mqinput-].ansred,input[type=text].ansred").after('<span class="scoremarker sr-only">'+_("Incorrect")+"</span>"),$(e).find("span[id^=mqinput-].ansorg,input[type=text].ansorg").after('<span class="scoremarker sr-only">'+_("Incorrect, wrong format")+"</span>"),$(e).find("span[id^=mqinput-].ansorg,input[type=text].ansorg").after($("<span>",{role:"button",class:"scoremarker",tabindex:0,"aria-label":_("Incorrect, wrong format"),"data-tip":_("Your answer is equivalent to the correct answer, but is not simplified or is in the wrong format"),"data-tooltipclass":"dropdown-pane tooltip-pane"}).on("mouseover focus",function(){tipshow(this)}).on("mouseleave blur",tipout).html('<svg style="vertical-align:middle;margin-left:3px;" viewBox="0 0 24 24" width="18" height="18" stroke="rgb(255,85,0)" stroke-width="2" stroke-linecap="round" fill="none" role="img" aria-hidden=true><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12" y2="16"></line></svg>'))}function initClearScoreMarkers(){$("input[id^=qn]").off("input.clearmarkers").on("input.clearmarkers",clearScoreMarkers),$("input[id^=qs],select[id^=qn]").off("change.clearmarkers").on("change.clearmarkers",clearScoreMarkers)}function initEnterHandler(e){$("input[type=text][name=qn"+e+"]").off("keydown.enterhandler").on("keydown.enterhandler",function(e){var t;13==e.which&&(0<(t=$(this).closest(".questionwrap").find(".submitbtnwrap .primary")).length&&e.preventDefault(),t.is(":disabled")||t.trigger("click"))})}function handleMQenter(e){e=$("#"+e).closest(".questionwrap").find(".submitbtnwrap .primary");e.is(":disabled")||e.trigger("click")}function initDupRubrics(){$(".rubriclink").each(function(e,t){var a,r;$(t).removeClass("rubriclink"),-1!==(a=t.id.substring(16)).indexOf("-")&&(a=1e3*(+(r=a.split("-"))[0]+1)+ +r[1]),0<(r=$("#mqinput-qn"+a+",input[type=text]#qn"+a+",select#qn"+a+",textarea#qn"+a+",div.introtext#qnwrap"+a)).length&&(r.after(t),$(t).show())})}function initShowAnswer2(){$("input.sabtn + span.hidden, input.sabtn + div.hidden").each(function(e,t){var a,r=t.id.substring(3),i=r,n=-1!==i.indexOf("-")?(i=1e3*(+(n=i.split("-"))[0]+1)+ +n[1],_("Question ")+(+n[0]+1)+_(" Part ")+(+n[1]+1)):_("Question ")+(+i+1),n=$("<span>",{class:"keywrap"}).append($("<button>",{type:"button","aria-controls":"ans"+r,"aria-expanded":"false",class:"keybtn","aria-label":_("View Key for ")+n,title:_("View Key")}).on("click",function(e){var t="true"==e.currentTarget.getAttribute("aria-expanded");e.currentTarget.setAttribute("aria-expanded",t?"false":"true"),$("#ans"+r).toggleClass("hidden",t)}).html('<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>'));if(0<$(t).closest(".autoshowans").length){if(0<(a=$("#qnwrap"+i)).length)return $(t).prev(".sabtn").remove(),n.append($(t)).addClass("inwrap"),void a.append(n);if(0<(a=$("#mqinput-qn"+i+",input[type=text]#qn"+i+",select#qn"+i+",textarea#qn"+i)).length)return $(t).prev(".sabtn").remove(),n.append($(t)),void a.after(n)}i=$(t).parent(),n.append($(t)),i.empty().append(n)}),$("input.dsbtn + div.hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),$("input.dsbtn").each(function(){var e=$(this).siblings("div:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",e).off("click.sashow").on("click.sashow",function(){var e="true"==$(this).attr("aria-expanded");$(this).attr("aria-expanded",!e).siblings("div:first-of-type").attr("aria-expanded",!e).attr("aria-hidden",e).toggleClass("hidden",e)})})}function initShowAnswer(){$("input.sabtn + span.hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),$("input.sabtn").each(function(){var e=$(this).siblings("span:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",e).off("click.sashow").on("click.sashow",function(){$(this).attr("aria-expanded",!0).siblings("span:first-of-type").attr("aria-expanded",!0).attr("aria-hidden",!1).removeClass("hidden")})}),$("input.dsbtn + div.hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),$("input.dsbtn").each(function(){var e=$(this).siblings("div:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",e).off("click.sashow").on("click.sashow",function(){$(this).attr("aria-expanded",!0).siblings("div:first-of-type").attr("aria-expanded",!0).attr("aria-hidden",!1).removeClass("hidden")})})}function setupDraw(e){for(var t,a=document.getElementById("qn"+e).value.split(";;"),r=[],i=0;i<a.length;i++)if(5==i?a[i]="["+a[i].replace(/&quot;/g,'"')+"]":(a[i]="["+a[i].replace(/\(/g,"[").replace(/\)/g,"]")+"]",0==i&&2<a[i].length&&(a[i]="["+a[i].replace(/;/g,"],[")+"]")),""===a[i])r[i]=[];else try{r[i]=JSON.parse(a[i])}catch(e){r[i]=[]}window.drawla[e]=r,window.canvases[e]=allParams[e].canvas,imathasDraw.initCanvases(e),(t=document.getElementById("drawtools"+e))&&t.addEventListener("click",function(e){var t,a,e=e.target;e.hasAttribute("data-drawaction")&&(a=e.getAttribute("data-drawaction"),t=e.getAttribute("data-qn"),"clearcanvas"===a?imathasDraw.clearcanvas(t):"settool"===a&&(a=e.getAttribute("data-val"),imathasDraw.settool(e,t,a)))}),$("#qn"+e).parent().find(".a11ydrawadd:not(.inited)").off("click.adda11ydraw").on("click.adda11ydraw",function(e){var t=e.target.getAttribute("data-qn");$(e.target).addClass("inited"),imathasDraw.adda11ydraw(t)})}function initMultAns(e){var t;"hasnone"==$("#qnwrap"+e).attr("data-multans")&&(t=$('input[name^="qn'+e+'["]')).on("change",function(){this.checked&&this.value==t.length-1?t.not(":last").prop("checked",!1):this.checked&&t.last().prop("checked",!1)})}function isBlank(e){return!e||0===e.length||/^\s*$/.test(e)}function editdebit(e){var e=e.target,t=$(e).closest("tr").find("input").first();!isBlank(e.value)&&t.hasClass("iscredit")&&(t.css("padding-left"),t.is("select")?t.css("margin-right",20):t.width(""),t.css("padding-left",""),t.removeClass("iscredit"))}function editcredit(e){var e=e.target,t=$(e).closest("tr").find("input").first();isBlank(e.value)||t.hasClass("iscredit")||(e=parseInt(t.css("padding-left")),t.is("select")?t.css("margin-right",0):t.width(t.width()-20),t.css("padding-left",20+e),t.addClass("iscredit"))}function initcreditboxes(){$(".creditbox").each(function(e,t){editcredit({target:t})})}function setupLivePreview(r,e){var t,a;"MathJax"!=mathRenderer||window.MathJax&&(window.MathJax.Hub||window.MathJax.typesetPromise)?LivePreviews.hasOwnProperty(r)||("MathJax"==mathRenderer||"Katex"==mathRenderer?(LivePreviews[r]={delay:"MathJax"==mathRenderer?100:0,finaldelay:1e3,preview:null,buffer:null,timeout:null,finaltimeout:null,mjRunning:!1,mjPending:!1,oldText:null,mjPromise:null,Init:function(e){$("#p"+r).css("positive","relative").append('<span id="lpbuf1'+r+'" style="visibility:hidden;position:absolute;"></span>').append('<span id="lpbuf2'+r+'" style="visibility:hidden;position:absolute;"></span>'),this.preview=document.getElementById("lpbuf1"+r),this.buffer=document.getElementById("lpbuf2"+r),"MathJax"==mathRenderer&&MathJax.typesetPromise&&(this.mjPromise=Promise.resolve()),e||showPreview(r)},SwapBuffers:function(){var e=this.preview,t=this.buffer;this.buffer=e,this.preview=t,e.style.visibility="hidden",e.style.position="absolute",t.style.position="",t.style.visibility=""},Update:function(e){this.timeout&&clearTimeout(this.timeout),this.finaltimeout&&clearTimeout(this.finaltimeout),this.timeout=setTimeout(this.callback,this.delay),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(e){this.oldtext=e,this.buffer.innerHTML=this.preformat(e),this.mjRunning=!0,this.RenderBuffer()},RenderBuffer:function(){"MathJax"==mathRenderer?MathJax.typesetPromise&&this.mjPromise?this.mjPromise=this.mjPromise.then(function(){MathJax.typesetPromise([this.buffer]).then(this.PreviewDone.bind(this))}.bind(this)):MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.buffer],["PreviewDone",this]):"Katex"==mathRenderer&&(renderMathInElement(this.buffer),"undefined"!=typeof MathJax&&MathJax.Hub&&!MathJax.typesetPromise&&0<$(this.buffer).children(".mj").length?MathJax.Hub.Queue(["PreviewDone",this]):this.PreviewDone())},DoFinalPreview:function(){$("#pbtn"+r).trigger("click")},preformat:function(e){var t=allParams[r].qtype,a=allParams[r].calcformat;return preformat(r,e,t,a)},CreatePreview:function(){var e;this.timeout=null,this.mjPending||(e=document.getElementById("qn"+r).value)!==this.oldtext&&(this.mjRunning?(this.mjPending=!0,this.mjPromise?this.mjPromise=this.mjPromise.then(this.CreatePreview().bind(this)):MathJax.Hub&&MathJax.Hub.Queue(["CreatePreview",this])):(this.oldtext=e,this.buffer.innerHTML="`"+htmlEntities(this.preformat(e))+"`",this.mjRunning=!0,this.RenderBuffer()))},PreviewDone:function(){this.mjRunning=this.mjPending=!1,this.SwapBuffers(),updateehpos()}},"undefined"==typeof MathJax||MathJax.typesetPromise?LivePreviews[r].callback=function(){LivePreviews[r].CreatePreview()}:(LivePreviews[r].callback=MathJax.Callback(["CreatePreview",LivePreviews[r]]),LivePreviews[r].callback.autoReset=!0),LivePreviews[r].Init(e)):LivePreviews[r]={finaldelay:1e3,finaltimeout:null,Update:function(e){this.finaltimeout&&clearTimeout(this.finaltimeout),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(e){var t=document.getElementById("p"+r);t.innerHTML=htmlEntities(e),rendermathnode(t)},DoFinalPreview:function(){$("#pbtn"+r).trigger("click")}}):(t=r,a=e,setTimeout(100,function(){setupLivePreview(t,a)}))}function updateLivePreview(e){e=e.target.id.substr(2);setupLivePreview(e),LivePreviews[e].Update()}function clearLivePreviewTimeouts(){for(var e in LivePreviews)clearTimeout(LivePreviews[e].finaltimeout)}function normalizemathunicode(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/[\x00-\x09\x0B\x0C\x0E-\x1F\x7F]/g,"")).replace(/\u2013|\u2014|\u2015|\u2212/g,"-")).replace(/\u2044|\u2215/g,"/")).replace(/∞/g,"oo").replace(/≤/g,"<=").replace(/≥/g,">=").replace(/∪/g,"U")).replace(/±/g,"+-").replace(/÷/g,"/").replace(/·|✕|×|⋅/g,"*")).replace(/√/g,"sqrt").replace(/∛/g,"root(3)")).replace(/⁰/g,"^0").replace(/¹/g,"^1").replace(/²/g,"^2").replace(/³/g,"^3").replace(/⁴/g,"^4").replace(/⁵/g,"^5").replace(/⁶/g,"^6").replace(/⁷/g,"^7").replace(/⁸/g,"^8").replace(/⁹/g,"^9")).replace(/\u2329/g,"<").replace(/\u232a/g,">")).replace(/₀/g,"_0").replace(/₁/g,"_1").replace(/₂/g,"_2").replace(/₃/g,"_3")).replace(/\b(OO|infty)\b/gi,"oo").replace(/°/g,"degree")).replace(/θ/g,"theta").replace(/ϕ/g,"phi").replace(/φ/g,"phi").replace(/π/g,"pi").replace(/σ/g,"sigma").replace(/μ/g,"mu")).replace(/α/g,"alpha").replace(/β/g,"beta").replace(/γ/g,"gamma").replace(/δ/g,"delta").replace(/ε/g,"epsilon").replace(/κ/g,"kappa")).replace(/λ/g,"lambda").replace(/ρ/g,"rho").replace(/τ/g,"tau").replace(/χ/g,"chi").replace(/ω/g,"omega")).replace(/Ω/g,"Omega").replace(/Γ/g,"Gamma").replace(/Φ/g,"Phi").replace(/Δ/g,"Delta").replace(/Σ/g,"Sigma")).replace(/&(ZeroWidthSpace|nbsp);/g," ").replace(/\u200B/g," ")).replace(/degree\s+s\b/g,"degree")).replace(/\(\((-?\d+)\)\)/g,"($1)")}function htmlEntities(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;")}function showPreview(e){var t=allParams[e],a="",r=processByType(e);r.str&&(a="`"+htmlEntities(r.str)+"`"),r.dispvalstr&&""!=r.dispvalstr&&-1!=t.calcformat.indexOf("showval")&&(a+=(""==a?"":" = ")+"`"+htmlEntities(r.dispvalstr)+"`"),r.err&&""!=r.err&&""!=r.str&&(a+="``"==a?"":". <span class=noticetext>"+r.err+"</span>"),LivePreviews.hasOwnProperty(e)?LivePreviews[e].RenderNow(a):((t=document.getElementById("p"+e)).innerHTML=a,rendermathnode(t)),a11ypreview(a)}function a11ypreview(e){var t=$("<div>",{class:"inactive"}).html(e).appendTo("body")[0];rendermathnode(t,function(){var e=document.getElementById("arialive");e.innerHTML="",t.className="",$(t).find("[aria-label]").each(function(e,t){$(t).html($(t).attr("aria-label"))}),e.appendChild(t)})}function syntaxCheckMQ(e,t){clearTimeout(MQsyntaxtimer);var a=parseInt(e.replace(/.*qn(\d+)\b.*/g,"$1"));MQsyntaxtimer=setTimeout(function(){showSyntaxCheckMQ(a)},1e3)}function showSyntaxCheckMQ(e){var t,a=allParams[e],r=processByType(e),i="";r.dispvalstr&&""!=r.dispvalstr&&"NaN"!=r.dispvalstr&&a.calcformat&&-1!=a.calcformat.indexOf("showval")&&("calcmatrix"==a.qtype?i+=" = `"+htmlEntities(r.dispvalstr)+"` ":i+=" = "+htmlEntities(r.dispvalstr)+" "),r.err&&""!=r.err&&""!=r.str&&(i+="<span class=noticetext>"+r.err+"</span>"),!LivePreviews.hasOwnProperty(e)||"MathJax"!=mathRenderer&&"Katex"!=mathRenderer?(t=document.getElementById("p"+e))&&(t.innerHTML=i,rendermathnode(t)):((t=document.getElementById("p"+e).firstChild).innerHTML=i,t.style.visibility="",t.style.position=""),document.getElementById("qn"+e)?a11ypreview("`"+htmlEntities(document.getElementById("qn"+e).value)+"` "+i):a11ypreview(i)}function preSubmitForm(e){var t,a,r;for(a in allParams)!1!==(t=preSubmit(a))&&((r=document.getElementById("qn"+a+"-val"))?r.value=t:((r=document.createElement("input")).type="hidden",r.name="qn"+a+"-val",r.value=t,e.appendChild(r)))}function preSubmit(e){e=processByType(e);return e.submitstr||!1}function preSubmitString(e,t){var a,e=parseInt(e.substr(2));return t=allParams.hasOwnProperty(e)&&(a=allParams[e],t=(t=normalizemathunicode(t)).replace(/^\s+/,"").replace(/\s+$/,""),3e4<(t="numfunc"==a.qtype?AMnumfuncPrepVar(e,t)[3]:t).length)?t.substr(0,3e4):t}function processByType(e){var t,a,r,i;if(!allParams.hasOwnProperty(e))return!1;if(a={},"draw"==(t=allParams[e]).qtype)return imathasDraw.encodea11ydraw(),{};if("choices"==t.qtype||"multans"==t.qtype||"matching"==t.qtype)return{};if(t.hasOwnProperty("matrixsize"))a=processSizedMatrix(e);else{if(!(r=document.getElementById("qn"+e)))return!1;if((i=(i=normalizemathunicode(i=r.value)).replace(/^\s+/,"").replace(/\s+$/,"")).match(/^\s*$/))return{str:"",displvalstr:"",submitstr:""};if(i.match(/^\s*DNE\s*$/i))return{str:"DNE",displvalstr:"",submitstr:"DNE"};if(i.match(/^\s*oo\s*$/i))return{str:"oo",displvalstr:"",submitstr:"oo"};if(i.match(/^\s*\+oo\s*$/i))return{str:"+oo",displvalstr:"",submitstr:"+oo"};if(i.match(/^\s*-oo\s*$/i))return{str:"-oo",displvalstr:"",submitstr:"-oo"};switch(t.qtype){case"number":a=processNumber(i,t.calcformat);break;case"calculated":a=processCalculated(i,t.calcformat);break;case"interval":case"calcinterval":a=processCalcInterval(i,t.calcformat,t.vars);break;case"ntuple":case"calcntuple":a=processCalcNtuple(i,t.calcformat);break;case"complex":case"calccomplex":a=processCalcComplex(i,t.calcformat);break;case"calcmatrix":a=processCalcMatrix(i,t.calcformat);break;case"numfunc":a=processNumfunc(e,i,t.calcformat);break;case"matrix":a=processCalcMatrix(i,"decimal")}a.str=preformat(e,i,t.qtype,t.calcformat)}return a}function preformat(e,t,a,r){return t=normalizemathunicode(t),a.match(/interval/)?r.match(/inequality/)?(t=(t=AMnumfuncPrepVar(e,t)[1]).replace(/<=/g," le ").replace(/>=/g," ge ").replace(/</g," lt ").replace(/>/g," gt ")).match(/all\s*real/i)&&(t="text("+t+")"):t=t.replace(/U/g,"uu"):"numfunc"==a?t=AMnumfuncPrepVar(e,t)[1]:"calcntuple"==a?t=t.replace(/<+/g,"(:").replace(/>+/g,":)"):"calculated"==a&&(-1==r.indexOf("list")&&-1==r.indexOf("set")&&(t=t.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),-1!=r.indexOf("scinot"))&&(t=t.replace(/(x|X|\u00D7)/,"xx")),t=t.replace(/[^\u0000-\u007f]/g,"?")}function AMnumfuncPrepVar(e,t){var r,a,i,n,s,c,l,o,d,u,p="",h="string"==typeof allParams[e].vars?[allParams[e].vars]:allParams[e].vars.slice(),g=h.map(escapeRegExp).join("|");for(allParams[e].fvars&&(p=allParams[e].fvars.map(escapeRegExp).join("|")),h.push("DNE"),g.match(/lambda/)&&(t=t.replace(/lamda/,"lambda")),r=[],a=(a=t).replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|argsinh|argcosh|argtanh|argsech|argcsch|argcoth|arsinh|arcosh|artanh|arsech|arcsch|arcoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root|pi)/g,functoindex),t=t.replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|argsinh|argcosh|argtanh|argsech|argcsch|argcoth|arsinh|arcosh|artanh|arsech|arcsch|arcoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root|pi)/g,functoindex),i=0;i<h.length;i++)if(h[i].match(/\(.+\)/)&&(t=t.replace(/\(\((.*?)\)\)/g,"($1)")),"E"==h[i]||"e"==h[i])r[i]=!0;else for(r[i]=!1,n=0;n<h.length;n++)if(i!=n&&h[n].toLowerCase()==h[i].toLowerCase()&&h[n]!=h[i]){r[i]=!0;break}for(t=(t=t.replace(new RegExp("("+g+")","gi"),function(e,t){for(var a=0;a<h.length;a++)if(h[a]==t||!r[a]&&h[a].toLowerCase()==t.toLowerCase())return"@v"+a+"@";return t})).replace(/@v(\d+)@/g,function(e,t){return h[t]}),a=(a=(a=(a=(a=a.replace(new RegExp("("+g+")","gi"),function(e,t){for(var a=0;a<h.length;a++)if(h[a]==t||!r[a]&&h[a].toLowerCase()==t.toLowerCase())return"@v"+a+"@";return t})).replace(/(@v\d+@)(@v\d+@)/g,"$1 $2")).replace(/(@v\d+@)(@v\d+@)/g,"$1 $2")).replace(/(@v(\d+)@|\d+(\.\d+)?)!(?!=)/g,"{:$&:}")).replace(/@v(\d+)@/g,function(e,t){return h[t]}),s=t,c=new Array,i=0;i<h.length;i++)1<h[i].length&&(o=!1,-1!=greekletters.indexOf(h[i].toLowerCase())&&(o=!0),h[i].match(/^\w+_\w+$/)?(l=r[i]?"g":"gi",d=new RegExp(/^(\w+)_(\w+)$/,l).exec(h[i]),u=new RegExp(d[1]+"_\\("+d[2]+"\\)",l),a=a.replace(u,h[i]),t=t.replace(u,h[i]),s=(s=s.replace(new RegExp(d[0],l),d[1]+"_"+d[2])).replace(new RegExp(d[1]+"_\\("+d[2]+"\\)",l),d[1]+"_("+d[2]+")"),1<d[1].length&&-1==greekletters.indexOf(d[1].toLowerCase())&&(d[1]='"'+d[1]+'"'),1<d[2].length&&-1==greekletters.indexOf(d[2].toLowerCase())&&(d[2]='"'+d[2]+'"'),a=a.replace(new RegExp(d[0],l),d[1]+"_"+d[2]),t=t.replace(new RegExp(d[0],"g"),"repvars"+i),h[i]="repvars"+i):!o&&1<h[i].replace(/[^\w_]/g,"").length&&c.push(h[i]),h[i].match(/[^\w_]/)||h[i].match(/^(break|case|catch|continue|debugger|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|this|throw|try|typeof|var|void|while|and with)$/))&&(t=t.replace(new RegExp(escapeRegExp(h[i]),"g"),"repvars"+i),h[i]="repvars"+i);return 0<c.length&&(vltq=c.join("|"),e=new RegExp("("+vltq+")","g"),a=a.replace(e,'"$1"')),a=(a=a.replace(/(@\d+@)/g," $1")).replace(/@(\d+)@/g,indextofunc),t=t.replace(/@(\d+)@/g,indextofunc),s=s.replace(/@(\d+)@/g,indextofunc),g.match(/\bf\b/)&&!p.match(/\bf\b/)&&(a=(a=a.replace(/([^a-zA-Z])f\^([\d\.]+)([^\d\.])/g,"$1f^$2{::}$3")).replace(/([^a-zA-Z])f\(/g,"$1f{::}(")),[t,a=g.match(/\bg\b/)&&!p.match(/\bg\b/)?(a=a.replace(/([^a-zA-Z])g\^([\d\.]+)([^\d\.])/g,"$1g^$2{::}$3")).replace(/([^a-zA-Z])g\(/g,"$1g{::}("):a,h.join("|"),s]}function processNumber(e,t){var a,r,i,n,s,c,l,o,d,u,p,h,g,m,f="";for(e=e.replace(/^\s+|\s+$/g,""),-1!==t.indexOf("set")&&("{"!==e.charAt(0)||"}"!==e.substr(-1)?f+=_("Invalid set notation"):e=e.slice(1,-1)),a=-1!==t.indexOf("list")||-1!==t.indexOf("set")?e.split(/\s*,\s*/):[e.replace(/,/g,"")],i=0;i<a.length;i++)if(r=a[i],-1!=t.indexOf("units"))if(_("Units must be given as [decimal number]*[unit]^[power]*[unit]^[power].../[unit]^[power]*[unit]^[power]..."),r.match(/^\s*(-?\s*\d+\.?\d*|-?\s*\.\d+|-?\s*\d\.?\d*\s*(E|\*\s*10\s*\^)\s*[\-\+]?\d+)/)||(f+=_("Answer must start with a number. ")),r.match(/\b(sq|square|cu|cubic|squared|cubed)\s*\^\s*[\-\+]?\s*\d+/)&&(f+=_("Invalid base for exponent. "),r=r.replace(/\^/,"")),r.match(/\b(sq|square|cu|cubic)\s+per\b/)&&(f+=_('Missing unit before "per". '),r=r.replace(/per\b/,"")),r.match(/\bper\s+(squared|cubed)/)&&(f+=_('Missing unit after "per". '),r=r.replace(/\bper/,"")),(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=r.replace(/([a-zA-Z]\w*\s*)(\^\s*[\-\+]?\s*\d+\s*)(?:squared|cubed)\b/g,"$1")).replace(/(?:sq|square|cu|cubic)\s+([a-zA-Z]\w*)/g,"$1")).replace(/([a-zA-Z]\w*)\s+(?:squared|cubed)/g,"$1")).replace(/\sper\s/g,"/")).replace(/^\s*(-?\s*\d\.?\d*\s*(E|\*\s*10\s*\^)\s*[\-\+]?\d+|-?\s*\d+\.?\d*|-?\s*\.\d+)\s*[\-\*]?\s*/,"")).replace(/\s*\-\s*([a-zA-Z])/g,"*$1")).replace(/\*\*/g,"^")).replace(/\s*(\/|\^|\-)\s*/g,"$1")).replace(/\(\s*(.*?)\s*\)\s*\//,"$1/").replace(/\/\s*\(\s*(.*?)\s*\)/,"/$1")).replace(/\s*[\*\s]\s*/g,"*")).replace(/([a-zA-Z]\w*)\^[\-\+]?\d+/g,"$1")).match(/\^/)&&(f+=_("Invalid exponents. "),r=r.replace(/\^/g,"")),1<(r.match(/\//g)||[]).length&&(f+=_("Only one division symbol allowed in the units. ")),0<(r=r.replace(/\//g,"*").replace(/^\s*\*/,"").trim()).length)for(n="(yotta|zetta|exa|peta|tera|giga|mega|kilo|hecto|deka|deca|deci|centi|milli|micro|nano|pico|fempto|atto|zepto|yocto)",s="(Y|Z|E|P|T|G|M|k|h|da|d|c|m|u|n|p|f|a|z|y)",c=/^(m|meter|metre|micron|angstrom|fermi|in|inch|inches|ft|foot|feet|mi|mile|furlong|yd|yard|s|sec|second|min|minute|h|hr|hour|day|week|mo|month|yr|year|fortnight|acre|ha|hectare|b|barn|L|liter|litre|cc|gal|gallon|cup|pt|pint|qt|quart|tbsp|tablespoon|tsp|teaspoon|rad|radian|deg|degree|arcminute|arcsecond|grad|gradian|knot|kt|c|mph|kph|g|gram|gramme|t|tonne|Hz|hertz|rev|revolution|cycle|N|newton|kip|dyn|dyne|lb|pound|lbf|ton|J|joule|erg|lbft|ftlb|cal|calorie|eV|electronvolt|Wh|Btu|therm|W|watt|hp|horsepower|Pa|pascal|atm|atmosphere|bar|Torr|mmHg|umHg|cmWater|psi|ksi|Mpsi|C|coulomb|V|volt|farad|F|ohm|amp|ampere|A|T|tesla|G|gauss|Wb|weber|H|henry|lm|lumen|lx|lux|amu|dalton|Da|me|mol|mole|Ci|curie|R|roentgen|sr|steradian|Bq|becquerel|ls|lightsecond|ly|lightyear|AU|au|parsec|pc|solarmass|solarradius|degF|degC|degK|K)$/,l=new RegExp("^"+s+"?(m|ft|s|b|cc|g|t|N|dyn|J|cal|eV|Wh|W|hp|Pa|C|V|F|A|T|G|Wb|H|lm|lx|Da|mol|M|Ci|sr|Bq|ls|ly|pc)$"),o=new RegExp("^(inch|inches|lbft|ftlb|solarmass|solarradius)$","i"),d=new RegExp("^"+s+"?(L|Hz|Btu)$","i"),u=new RegExp("^"+n+"?(fermi|foot|feet|sec|hertz|horsepower|Torr|gauss|lux)$","i"),p=new RegExp("^(micron|mile|furlong|yard|minute|hour|day|week|month|year|fortnight|acre|hectare|gallon|cup|pint|quart|tablespoon|teaspoon|radian|degree|gradian|knot|revolution|cycle|kip|lb|therm|atmosphere|roentgen)s?$","i"),h=new RegExp("^"+n+"?(meter|metre|angstrom|second|barn|liter|litre|arcminute|arcsecond|gram|gramme|tonne|newton|dyne|pound|ton|joule|erg|calorie|electronvolt|watt|pascal|coulomb|volt|farad|ohm|amp|ampere|tesla|weber|henry|lumen|dalton|mole|curie|steradian|becquerel|lightsecond|lightyear|parsec)s?$","i"),g=r.split(/\s*\*\s*/),m=0;m<g.length;m++){let e=!1;!(unitsregexmatch=g[m].match(d))||3!=unitsregexmatch.length||new RegExp("^"+s+"$").test(unitsregexmatch[1])||(e=!0),(c.test(g[m])||l.test(g[m])||o.test(g[m])||d.test(g[m])||u.test(g[m])||p.test(g[m])||h.test(g[m]))&&!e||(f+=_("Unknown unit ")+'"'+g[m]+'". ')}else f+=_("Missing units");else-1!=t.indexOf("integer")?r.match(/^\s*\-?\d+\s*$/)||(f+=_("This is not an integer.")):r.match(/^\s*(\+|\-)?(\d+\.?\d*|\.\d+|\d*\.?\d*\s*E\s*[\-\+]?\d+)\s*$/)||(f+=_("This is not a decimal or integer value."));return{err:f,dispvalstr:e}}function processCalculated(e,t){var a,r,i,n,s;for(-1!=t.indexOf("allowplusminus")&&(e=e.replace(/(.*?)\+\-(.*?)(,|$)/g,"$1+$2,$1-$2$3")),a=-1!=t.indexOf("list")?e.split(/,/):-1!=t.indexOf("set")?e.replace(/[\{\}]/g,"").split(/,/):[e],r="",n=[],s=0;s<a.length;s++)r=(r=(r+=singlevalsyntaxcheck(str=a[s],t))+syntaxcheckexpr(str,t))+(i=singlevaleval(str,t))[1],n.push(i[0]);return e=n.join(", "),{err:r,dispvalstr:e=-1!=t.indexOf("set")?"{"+e+"}":e,submitstr:n.join(",")}}function processCalcInterval(e,t,a){var r,n,s,c,l,o,d,u,p,h,g;if(e=e.replace(/cup/g,"U"),-1!=t.indexOf("inequality")){if(1<(c=ineqtointerval(e=e.replace(/or/g," or "),a)).length)return{err:"wrongvar"==c[1]?_("you may have used the wrong variable"):_("invalid inequality notation")};e=c[0]}if(r=[],n=[],s=[],c="U",-1!=t.indexOf("list")){for(e=e.replace(/\s*,\s*/g,",").replace(/(^,|,$)/g,""),c=",",l=0,o=1;o<e.length-1;o++)","!=e.charAt(o)||")"!=e.charAt(o-1)&&"]"!=e.charAt(o-1)||"("!=e.charAt(o+1)&&"["!=e.charAt(o+1)||(r.push(e.substring(l,o)),l=o+1);r.push(e.substring(l))}else r=e.split(/\s*U\s*/i);for(d="",g=[],i=0;i<r.length;i++){if(u=r[i],sm=u.charAt(0),em=u.charAt(u.length-1),2!=(p=(p=u.substring(1,u.length-1)).split(/,/)).length||"("!=sm&&"["!=sm||")"!=em&&"]"!=em){-1!=t.indexOf("inequality")?d+=_("invalid inequality notation")+". ":d+=_("invalid interval notation")+". ";break}for(j=0;j<2;j++)-1!=t.indexOf("decimal")&&p[j].match(/[\d\.]e\-?\d/)&&(p[j]=p[j].replace(/e/,"E")),d=(d+=singlevalsyntaxcheck(p[j],t))+syntaxcheckexpr(p[j],t),p[j].match(/^\s*\-?\+?oo\s*$/)?g[j]=p[j]:(d+=(h=singlevaleval(p[j],t))[1],g[j]=h[0]);n[i]=sm+g[0]+","+g[1]+em,-1!=t.indexOf("inequality")&&(g[0].toString().match(/oo/)?g[1].toString().match(/oo/)?s[i]="RR":s[i]=a+("]"==em?"le":"lt")+g[1]:g[1].toString().match(/oo/)?s[i]=a+("["==sm?"ge":"gt")+g[0]:s[i]=g[0]+("["==sm?"le":"lt")+a+("]"==em?"le":"lt")+g[1])}return-1!=t.indexOf("inequality")?{err:d,dispvalstr:s.join(' "or" '),submitstr:n.join(c)}:{err:d,dispvalstr:n.join(" uu "),submitstr:n.join(c)}}function processCalcNtuple(e,t){var a,r,i="",n=0,s=0,c="",l=!0;for((e=(e=e.replace(/(\s+,\s+|,\s+|\s+,)/g,",").replace(/(^,|,$)/g,"")).replace(/<<(.*?)>>/g,"<$1>")).charAt(0).match(/[\(\[\<\{]/)||(l=!1),a=0;a<e.length;a++)r=!1,0==n&&(i+=e.charAt(a),s=a+1,","==e.charAt(a)?e.substring(a+1).match(/^\s*[\(\[\<\{]/)&&e.substring(0,a).match(/[\)\]\>\}]\s*$/)||(l=!1):0<a&&","!=e.charAt(a-1)&&(l=!1)),e.charAt(a).match(/[\(\[\<\{]/)?n++:e.charAt(a).match(/[\)\]\>\}]/)&&(n--,r=!0),(0==n&&r||1==n&&","==e.charAt(a))&&(c=(c=(c+=singlevalsyntaxcheck(sub=e.substring(s,a).replace(/^\s+/,"").replace(/\s+$/,""),t))+syntaxcheckexpr(sub,t))+(r=singlevaleval(sub,t))[1],i=(i+=r[0])+e.charAt(a),s=a+1);return{err:c=0==(l=0!=n?!1:l)?_("Invalid notation")+". "+c:c,dispvalstr:i,submitstr:i}}function processCalcComplex(e,t){for(var a,r,i,n,s,c="",l=(e=-1!=t.indexOf("allowplusminus")?e.replace(/(.*?)\+\-(.*?)(,|$)/g,"$1+$2,$1-$2$3"):e).split(","),o=(a="",[]),d=0;d<l.length;d++)a=l[d].replace(/^\s+/,"").replace(/\s+$/,""),-1!=t.indexOf("allowjcomplex")&&(a=a.replace(/j/g,"i")),-1!=t.indexOf("generalcomplex")?o.push(a):(-1==t.indexOf("sloppycomplex")&&("string"==typeof(n=parsecomplex(a))?c+=n:c=(c+=singlevalsyntaxcheck(n[0],t))+singlevalsyntaxcheck(n[1],t)),c+=syntaxcheckexpr(a,t),r=scopedeval("var i=0;"+(n=prepWithMath(mathjs(a,"i")))),i=scopedeval("var i=1;"+n),s=scopedeval("var i=-1;"+n),"synerr"!=r&&"synerr"!=i||(c+=_("syntax incomplete"),r=NaN),isNaN(r)||"Infinity"==r||isNaN(i)||isNaN(s)||"Infinity"==i||(i-=r,s=Math.abs(r)<1e-16?"":r,s+=Math.abs(i)<1e-16?"":(0<i&&""!=s?"+":"")+i+"i",o.push(s)));return-1!=t.indexOf("generalcomplex")?{err:c,dispvalstr:o.join(", ")}:{err:c,dispvalstr:o.join(", "),submitstr:o.join(",")}}function processSizedMatrix(e){var t,a,r,i,n,s,c,l,o=allParams[e],d=o.matrixsize,u="";for(o.calcformat&&(u=o.calcformat),t=[],a=[],r=[],s="",c=i=0;c<d[0];c++){for(t[c]=[],a[c]=[],l=0;l<d[1];l++)""!==(n=normalizemathunicode(document.getElementById("qn"+e+"-"+i).value))&&(s=(s+=syntaxcheckexpr(n,u))+singlevalsyntaxcheck(n,u)),t[c][l]=n,s+=(res=singlevaleval(n,u))[1],a[c][l]=res[0],r.push(res[0]),i++;t[c]="("+t[c].join(",")+")",a[c]="("+a[c].join(",")+")"}return{err:s,str:"["+t.join(",")+"]",dispvalstr:"calcmatrix"==o.qtype?"["+a.join(",")+"]":"",submitstr:r.join("|")}}function processCalcMatrix(e,t){var a,r,i,n,s,c,l,o,d,u,p,h,g=!0;for(((e=(e=(e=e.replace(/\[/g,"(")).replace(/\]/g,")")).replace(/\s+/g,"")).length<2||"("!==e.charAt(0)||")"!==e.charAt(e.length-1))&&(g=!1),e=e.substring(1,e.length-1),r=a="",i=[],c=s=n=0;c<e.length;c++)"("==e.charAt(c)?s++:")"==e.charAt(c)?s--:","==e.charAt(c)&&0==s&&(i.push(e.substring(n+1,c-1)),n=c+1);for(0==n&&"("!=e.charAt(0)?i.push(e):i.push(e.substring(n+1,e.length-1)),l=-1,0!==s&&(g=!1),u=[],p=[],c=0;c<i.length;c++){for(u[c]=[],o=i[c].split(","),-1<l&&o.length!=l&&(g=!1),l=o.length,h=0;h<o.length;h++)""==(d=o[h].replace(/^\s+/,"").replace(/\s+$/,""))?(r=_("No elements of the matrix should be left blank."),u[c][h]="",p.push("")):(a=(a=(a+=syntaxcheckexpr(d,t))+singlevalsyntaxcheck(d,t))+(res=singlevaleval(d,t))[1],u[c][h]=res[0],p.push(res[0]));u[c]="("+u[c].join(",")+")"}return g||(a=_("Invalid matrix format")+". "),{err:a+=r,dispvalstr:"["+u.join(",")+"]",submitstr:p.join("|")}}function processNumfunc(e,t,a){for(var r,i,n,s,c,l,o=allParams[e],d=o.vars,u=o.fvars,p=o.domain,h=a.match(/equation/),g=a.match(/inequality/),m="",f=AMnumfuncPrepVar(e,t),v=a.match(/list/)?f[0].split(/,/):[f[0]],y=0,b=0;b<v.length;b++){if(r=(r=v[b]).replace(/,/g,"").replace(/^\s+/,"").replace(/\s+$/,"").replace(/degree/g,""),l=f[2].split("|"),r.match(/(<=|>=|<|>|!=)/)?(g?1<r.match(/(<=|>=|<|>|!=)/g).length?m+=_("syntax error: your inequality should only contain one inequality symbol")+". ":r.match(/(^(<|>|!))|(=|>|<)$/)&&(m+=_("syntax error: your inequality should have expressions on both sides")+". "):m+=h?_("syntax error: you gave an inequality, not an equation")+". ":_("syntax error: you gave an inequality, not an expression")+". ",r=r.replace(/(.*)(<=|>=|<|>|!=)(.*)/,"$1-($3)")):r.match(/=/)?(g&&!h?m+=_("syntax error: you gave an equation, not an inequality")+". ":h?1<r.match(/=/g).length?m+=_("syntax error: your equation should only contain one equal sign")+". ":r.match(/(^=)|(=$)/)&&(m+=_("syntax error: your equation should have expressions on both sides")+". "):m+=_("syntax error: you gave an equation, not an expression")+". ",r=r.replace(/(.*)=(.*)/,"$1-($2)")):h&&g?m+=_("syntax error: this is not an equation or inequality")+". ":h?m+=_("syntax error: this is not an equation")+". ":g&&(m+=_("syntax error: this is not an inequality")+". "),!a.match(/generalcomplex/)){for(0<u.length&&(reg=new RegExp("("+u.join("|")+")\\(","g"),r=(r=(r=r.replace(/\w+/g,functoindex)).replace(reg,"$1*sin($1+")).replace(/@(\d+)@/g,indextofunc)),r=prepWithMath(mathjs(r,l.join("|"))),n=y=0;n<20;n++){for(s="var DNE=1;",i=0;i<l.length-1;i++)c=p[i][2]?Math.floor(Math.random()*(p[i][0]-p[i][1]+1)+p[i][0]):Math.random()*(p[i][0]-p[i][1])+p[i][0],s+="var "+l[i]+"="+c+";";if("synerr"!==scopedeval(s+r)){y++;break}}0===y&&(m+=_("syntax error")+". ")}m+=syntaxcheckexpr(f[0],a+",isnumfunc",d.map(escapeRegExp).join("|"))}return{err:m}}function simplifyVariable(e){return e.replace(/[^\w_\^\-+]/g,"")}function ineqtointerval(e,t){var a,r,i,n,s,c=simplifyVariable(t);if((e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")).match(/all\s*real/i))return["(-oo,oo)"];if(e.match(/DNE/))return["DNE"];if(i=[],1==(n=e.split(/\s*or\s*/)).length&&e.match(/!=/))return 2!=(t=e.split(/!=/)).length?["","invalid"]:simplifyVariable(t[0])!=c?["","wrongvar"]:["(-oo,"+t[1]+")U("+t[1]+",oo)"];for(s=0;s<n.length;s++){if(a=(str=n[s]).match(/^(.*?)(<=?|>=?)(.*?)(<=?|>=?)(.*?)$/)){if(simplifyVariable(a[3])!=c)return["","wrongvar"];if(a[2].charAt(0)!=a[4].charAt(0))return["","invalid"];if(""==a[1].trim()||""==a[5].trim())return["","invalid"];r="<"==a[2].charAt(0)?("<"==a[2]?"(":"[")+a[1]+","+a[5]+("<"==a[4]?")":"]"):(">"==a[4]?"(":"[")+a[5]+","+a[1]+(">"==a[2]?")":"]")}else{if(!(a=str.match(/^(.*?)(<=?|>=?)(.*?)$/)))return["","invalid"];if(simplifyVariable(a[1])==c)r="<"==a[2].charAt(0)?"(-oo,"+a[3]+("<"==a[2]?")":"]"):(">"==a[2]?"(":"[")+a[3]+",oo)";else{if(simplifyVariable(a[3])!=c)return["","wrongvar"];r="<"==a[2].charAt(0)?("<"==a[2]?"(":"[")+a[1]+",oo)":"(-oo,"+a[1]+(">"==a[2]?")":"]")}}i.push(r)}return(e=i.join("U")).match(/[\(\[],|,[\)\]]/)?["","invalid"]:[e]}function parsecomplex(e){var t,a,r,i,n,s,c,l=(e=(e=(e=(e=e.replace(/\s/,"")).replace(/\((\d+\*?i|i)\)\/(\d+)/g,"$1/$2")).replace(/sin/g,"s$n")).replace(/pi/g,"p$")).length;if(2<e.split("i").length)return _("error - more than 1 i in expression");if(-1==(n=e.indexOf("i")))t=e,a="0";else{for(i=0,c=n-1;0<c;c--)if(")"==(r=e.charAt(c)))i++;else if("("==r)i--;else if(("+"==r||"-"==r)&&0==i)break;if(c<0&&(c=0),0!=i)return _("error - invalid form");for(i=0,s=n+1;s<l;s++)if("("==(r=e.charAt(s)))i++;else if(")"==r)i--;else if(("+"==r||"-"==r)&&0==i)break;if(0!=i)return _("error - invalid form");if(0<n-c&&0<s-n&&(s==l||0==c)){if(s==l)t=e.substr(0,c),a=e.substr(c,n-c);else{if(0!=c)return _("error - invalid form");t=e.substr(s),a=e.substr(0,n)}a=(a=(a+="*"+e.substr(n+1+("*"==e.charAt(n+1)?1:0),s-n-1)).replace("-*","-1*").replace("+*","+1*")).replace(/(\+|-)1\*(.+)/g,"$1$2")}else if(1<n-c)a=e.substr(c,n-c),t=e.substr(0,c)+e.substr(n+1);else if(1<s-n)if(0<n){if("+"!=e.charAt(n-1)&&"-"!=e.charAt(n-1))return _("error - invalid form");a=e.charAt(n-1)+e.substr(n+1+("*"==e.charAt(n+1)?1:0),s-n-1),t=e.substr(0,n-1)+e.substr(s)}else a=e.substr(n+1,s-n-1),t=e.substr(0,n)+e.substr(s);else a="+"==e.charAt(c)?"1":"-"==e.charAt(c)?"-1":0==n?"1":e.charAt(c),t=(0<n?e.substr(0,c):"")+e.substr(n+1);""==t&&(t="0"),"/"==a.charAt(0)?a="1"+a:"+"!=a.charAt(0)&&"-"!=a.charAt(0)||"/"!=a.charAt(1)||(a=a.charAt(0)+"1"+a.substr(1)),"+"==(a="*"==a.charAt(a.length-1)?a.substr(0,a.length-1):a).charAt(0)&&(a=a.substr(1)),"+"==t.charAt(0)&&(t=t.substr(1))}return[t=(t=t.replace(/s\$n/g,"sin")).replace(/p\$/g,"pi"),a=(a=(a=a.replace(/s\$n/g,"sin")).replace(/p\$/g,"pi")).replace(/\*\//g,"/")]}function singlevalsyntaxcheck(e,t){if(!(e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")).match(/DNE/i)&&!e.match(/-?\+?oo$/)&&!e.match(/-?\+?oo\W/)){if(e.match(/,/))return _("Invalid use of a comma.");if(-1==t.indexOf("allowmixed")||!e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/))if(-1!=t.indexOf("fracordec")){if(!((e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2").replace(/\s/g,"")).match(/^\(?\-?\(?\d+\)?\/\(?\d+\)?$/)||e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)||e.match(/^\-?\d+$/)||e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/)))return _(" invalid entry format")+". "}else if(-1!=t.indexOf("fraction")||-1!=t.indexOf("reducedfraction")){if(!(e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2").replace(/\s/g,"")).match(/^\(?\-?\(?\d+\)?\/\(?\-?\d+\)?$/)&&!e.match(/^\s*?\-?\d+\s*$/))return _("not a valid fraction")+". "}else if(-1!=t.indexOf("mixednumber")){if(!(e.match(/^\(?\-?\s*\(?\d+\)?\/\(?\d+\)?$/)||e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)||e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/)||e.match(/^\s*\-?\s*\d+\s*$/)))return _("not a valid mixed number")+". ";e=e.replace(/_/," ")}else if(-1!=t.indexOf("scinot")){if(!(e=(e=e.replace(/\s/g,"")).replace(/(xx|x|X|\u00D7)/,"xx")).match(/^\-?[1-9](\.\d*)?(\*|xx)10\^(\(?\(?\-?\d+\)?\)?)$/)){if(-1==t.indexOf("scinotordec"))return _("not valid scientific notation")+". ";if(!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/))return _("not valid decimal or scientific notation")+". "}}else if(-1!=t.indexOf("decimal")&&-1==t.indexOf("nodecimal")){if(!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)([eE]\-?\d+)?$/))return _(" not a valid integer or decimal number")+". "}else if(-1!=t.indexOf("integer")){if(!e.match(/^\s*\-?\d+(\.0*)?\s*$/))return _(" not an integer number")+". "}else if(!onlyAscii.test(e))return _("Your answer contains an unrecognized symbol")+". "}return""}function syntaxcheckexpr(e,t,a){var r,i,n,s,c,l="";for(-1!=t.indexOf("notrig")&&e.match(/(sin|cos|tan|cot|sec|csc)/i)?l+=_("no trig functions allowed")+". ":-1!=t.indexOf("nodecimal")&&-1!=e.indexOf(".")?l+=_("no decimals allowed")+". ":-1==t.indexOf("mixed")&&e.match(/\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/)?l+=_("mixed numbers are not allowed")+". ":-1==t.indexOf("allowdegrees")&&e.match(/degree/)&&(l+=_("no degree symbols allowed")+". "),s=n=i=r=0;s<e.length;s++)"("==e.charAt(s)?r++:")"==e.charAt(s)?r--:"["==e.charAt(s)?i++:"]"==e.charAt(s)?i--:"|"==e.charAt(s)&&(n=1-n);if(0==r&&0==i||(l+=" ("+_("unmatched parens")+"). "),0!=n&&(l+=" ("+_("unmatched absolute value bars")+"). "),reg=a?new RegExp("(sqrt|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*("+a+"|\\d+)","i"):new RegExp("(sqrt|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*(\\d+)","i"),null!=(errstuff=e.match(reg))&&(l+="["+_("use function notation")+" - "+_("use $1 instead of $2",errstuff[1]+"("+errstuff[2]+")",errstuff[0])+"]. "),a&&((a="degree|arc|arg|ar|sqrt|root|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs|pi|sign|DNE|e|oo".split("|").concat(a.split("|"))).sort(function(e,t){return t.length-e.length}),reg=new RegExp("(repvars\\d+|"+a.join("|")+")","ig"),e.replace(reg,"").match(/[a-zA-Z]/))&&(l+=_(" Check your variables - you might be using an incorrect one")+". "),2<(e.match(/\|/g)||[]).length)for(c=/\|.*?\|\s*(.|$)/g;match=c.exec(e);)if(""!=match[1]&&match[1].match(/[^+\-\*\/\^\)]/)){l+=_(" You may want to use abs(x) instead of |x| for absolute values to avoid ambiguity")+". ";break}return e.match(/%/)&&!e.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(l+=_(" Do not use the percent symbol, %")+". "),e.match(/=/)&&!t.match(/isnumfunc/)&&(l+=_("You gave an equation, not an expression")+". "),l}function singlevaleval(e,t){if((e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")).match(/,/))return[NaN,_("syntax incomplete")+". "];e.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(e=e.replace(/%/g,"")+"/100"),-1!=t.indexOf("mixed")&&(e=e.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),-1!=t.indexOf("allowxtimes")&&(e=e.replace(/(xx|x|X|\u00D7)/,"*")),-1!=t.indexOf("scinot")&&(e=e.replace("xx","*"));try{var a=scopedmatheval(e);return""===a?[NaN,_("syntax incomplete")+". "]:[a,""]}catch(e){return[NaN,_("syntax incomplete")+". "]}}function escapeRegExp(e){return e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function scopedeval(c){try{return eval(c)}catch(e){return"synerr"}}function scopedmatheval(c){if(c.match(/^\s*[a-df-zA-Z]\s*$/))return"";try{return eval(prepWithMath(mathjs(c)))}catch(e){return""}}return allParams={},LivePreviews=[],MQsyntaxtimer=null,greekletters=["alpha","beta","chi","delta","epsilon","gamma","varphi","phi","psi","sigma","rho","theta","lambda","mu","nu","omega","tau"],onlyAscii=/^[\u0000-\u007f]*$/,{init:init,clearparams:clearparams,preSubmitForm:preSubmitForm,preSubmit:preSubmit,preSubmitString:preSubmitString,clearLivePreviewTimeouts:clearLivePreviewTimeouts,syntaxCheckMQ:syntaxCheckMQ,clearTips:clearTips,handleMQenter:handleMQenter}}(jQuery),seqgroupcollapsed={},AutoSuggestIdCounter=0,autoSuggestLists={},autoSuggestObjects={},document.write=function(){};
