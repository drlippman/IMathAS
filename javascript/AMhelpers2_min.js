function prepWithMath(e){return e=e.replace(/\b(abs|acos|asin|atan|ceil|floor|cos|sin|tan|sqrt|exp|max|min|pow)\(/g,"Math.$1("),e=e.replace(/\(E\)/g,"(Math.E)"),e=e.replace(/\((PI|pi)\)/g,"(Math.PI)")}function toggleinlinebtn(e,t){var a=document.getElementById(t),r=document.getElementById(e);"none"==r.style.display?(r.style.display="",r.setAttribute("aria-hidden",!1),a.setAttribute("aria-expanded",!0)):(r.style.display="none",r.setAttribute("aria-hidden",!0),a.setAttribute("aria-expanded",!1));var i=a.innerHTML;a.innerHTML=i.match(/\[\+\]/)?i.replace(/\[\+\]/,"[-]"):i.replace(/\[\-\]/,"[+]")}function AutoSuggest(e,t){var a=this;this.elem=e,this.suggestions=t,this.eligible=new Array,this.inputText=null,this.highlighted=-1,this.div=document.getElementById("autosuggest"),null==this.div&&(this.div=document.createElement("div"),this.div.id="autosuggest",document.getElementsByTagName("body")[0].appendChild(this.div),this.div.appendChild(document.createElement("ul")));if(e.setAttribute("autocomplete","off"),!e.id){var r="autosuggest"+AutoSuggestIdCounter;AutoSuggestIdCounter++,e.id=r}e.onkeydown=function(e){var t=a.getKeyCode(e);switch(t){case 9:a.useSuggestion("tab");break;case 13:return a.highlighted>-1&&e.stopImmediatePropagation(),a.useSuggestion("enter"),!1;case 27:a.hideDiv();break;case 38:a.highlighted>0&&a.highlighted--,a.changeHighlight(t);break;case 40:a.highlighted<a.eligible.length-1&&a.highlighted++,a.changeHighlight(t)}},e.onkeyup=function(e){switch(a.getKeyCode(e)){case 9:case 27:case 38:case 40:return;default:this.value.length>1?(a.inputText=this.value,a.getEligible(),a.eligible.length>0?a.highlighted=0:a.highlighted=-1,a.createDiv(),a.positionDiv(),a.showDiv()):(a.hideDiv(),0==this.value.length&&(a.inputText=""))}},e.onblur=function(e){a.hideDiv()},this.useSuggestion=function(e){this.highlighted>-1?(this.elem.value=this.eligible[this.highlighted],this.hideDiv()):this.hideDiv()},this.showDiv=function(){this.div.style.display="block"},this.hideDiv=function(){a.div.style.display="none",a.highlighted=-1},this.changeHighlight=function(){var e=this.div.getElementsByTagName("LI");for(i in e){var t=e[i];this.highlighted==i?t.className="selected":t.className=""}},this.positionDiv=function(){var e=this.elem,t=findPos(e);t[1]+=e.offsetHeight,this.div.style.left=t[0]+"px",this.div.style.top=t[1]+"px"},this.createDiv=function(){var e=document.createElement("ul");for(i in this.eligible){var t=this.eligible[i],r=document.createElement("li"),n=document.createElement("a");n.href="#",n.onclick=function(){return!1},n.innerHTML=t,r.appendChild(n),a.highlighted==i&&(r.className="selected"),e.appendChild(r)}this.div.replaceChild(e,this.div.childNodes[0]),this.setHighlight=function(e){for(var t=a.getEventSource(e);t.parentNode&&"LI"!=t.tagName.toUpperCase();)t=t.parentNode;var r=a.div.getElementsByTagName("LI");for(i in r){if(r[i]==t){a.highlighted=i;break}}a.changeHighlight()},e.onmouseover=a.setHighlight,e.onmousedown=e.ontouchstart=function(e){return a.setHighlight(e),a.useSuggestion("click"),a.hideDiv(),a.cancelEvent(e),!1},this.div.className="suggestion_list",this.div.style.position="absolute"},this.getEligible=function(){this.eligible=new Array;var e=",";if(-1==this.inputText.indexOf(" ")){var t=new RegExp("\\b"+this.inputText.toLowerCase());for(i in this.suggestions){var a=this.suggestions[i];a.toLowerCase().match(t)&&(this.eligible[this.eligible.length]=a,e+=i+",")}}},this.getKeyCode=function(e){return e?e.keyCode:window.event?window.event.keyCode:void 0},this.getEventSource=function(e){return e?e.target:window.event?window.event.srcElement:void 0},this.cancelEvent=function(e){e&&(e.preventDefault(),e.stopPropagation()),window.event&&(window.event.returnValue=!1)}}var initstack=[],loadedscripts=[],callbackstack={},imathasAssess=function($){function clearparams(e){var t;for(t in e)delete allParams[t]}function toMQwVars(e,t){var a=t.substr(2).split(/-/)[0],r=allParams[a].qtype;return("numfunc"===r||"calcinterval"===r&&-1!=allParams[a].calcformat.indexOf("inequality"))&&(e=AMnumfuncPrepVar(a,e)[1]),AMtoMQ(e,t)}function fromMQwText(e,t){return e=MQtoAM(e),e=e.replace(/\(text\((.*?)\)\)/g,"($1)").replace(/text\((.*?)\)/g," $1 ")}function init(e,t,a){function r(e,t){if("code"==e[t][0]){try{window.eval(e[t][1])}catch(a){console.log("Error executing question script:"+e[t][1])}e.length>t+1&&r(e,t+1)}else-1==loadedscripts.indexOf(e[t][1])?jQuery.getScript(e[t][1]).always(function(){loadedscripts.push(e[t][1]),e.length>t+1&&r(e,t+1)}):e.length>t+1&&r(e,t+1);if(e.length<=t+1){for(var a=0;a<initstack.length;a++){initstack[a]()}initstack.length=0}}MQeditor.setConfig({toMQ:toMQwVars,fromMQ:fromMQwText}),0==$("#arialive").length&&$("body").append($("<p>",{id:"arialive","aria-live":"assertive","aria-atomic":"true",class:"sr-only"}));var i,n,s,l,c;for(i in e)if(!isNaN(parseInt(i))){if(allParams[i]=e[i],n=e[i],n.helper&&n.qtype.match(/^(calc|numfunc|string|interval|matrix)/)&&(l=document.getElementById("qn"+i),c=n.qtype,n.calcformat&&(c+=","+n.calcformat),n.displayformat&&(c+=","+n.displayformat),n.matrixsize?(c+=",matrixsized",$("input[id^=qn"+i+"-]").attr("data-mq",c)):l.setAttribute("data-mq",c),n.vars&&l.setAttribute("data-mq-vars",n.vars),t&&(n.matrixsize?MQeditor.toggleMQAll("input[id^=qn"+i+"-]",!0,!0):MQeditor.toggleMQ(l,!0,!0),$("#pbtn"+i).hide())),n.preview?(document.getElementById("pbtn"+i).addEventListener("click",function(e){return function(){showPreview(e)}}(i)),1!=n.preview||n.qtype.match(/matrix/)||(LivePreviews.hasOwnProperty(i)&&delete LivePreviews[i],setupLivePreview(i,t),document.getElementById("qn"+i).addEventListener("keyup",updateLivePreview),t&&showSyntaxCheckMQ(i))):n.matrixsize?$("input[id^=qn"+i+"-]").on("input",function(e){return function(){syntaxCheckMQ(e)}}(i)):document.getElementById("qn"+i)&&document.getElementById("qn"+i).addEventListener("keyup",function(e){return function(){syntaxCheckMQ(e)}}(i)),"debit"===n.format?document.getElementById("qn"+i).addEventListener("keyup",editdebit):"credit"===n.format?(document.getElementById("qn"+i).addEventListener("keyup",editcredit),initcreditboxes()):"normslider"===n.format&&imathasDraw.addnormslider(i,!0),n.autosuggest&&(!autoSuggestLists.hasOwnProperty(n.autosuggest)&&n.hasOwnProperty(n.autosuggest)&&(autoSuggestLists[n.autosuggest]=n[n.autosuggest]),autoSuggestLists.hasOwnProperty(n.autosuggest)&&(autoSuggestObjects[i]=new AutoSuggest(document.getElementById("qn"+i),autoSuggestLists[n.autosuggest]))),n.tip)if(l=document.getElementById("qn"+i+"-0"))for(s=0;document.getElementById("qn"+i+"-"+s);)setupTips("qn"+i+"-"+s,n.tip,n.longtip),s++;else setupTips("qn"+i,n.tip,n.longtip);if("draw"===n.qtype&&setupDraw(i),"file"===n.qtype&&initFileAlt(document.getElementById("qn"+i)),"multans"===n.qtype&&initMultAns(i),n.usetinymce)if(document.getElementById("qn"+i).disabled&&!document.getElementById("tinyprev"+i)){var o=$("#qn"+i).val(),d=$("<div>",{id:"tinyprev"+i,class:"introtext"});d.html(o),$("#qn"+i).hide().after(d)}else initeditor("selector","#qn"+i+".mceEditor",null,!1,function(e){e.on("blur",function(e){tinymce.triggerSave(),jQuery(e.target.targetElm).triggerHandler("change")}).on("focus",function(e){jQuery(e.target.targetElm).triggerHandler("focus")})});"essay"==n.qtype&&$("#qnwrap"+i+".introtext img").on("click",rotateimg),initEnterHandler(i)}initDupRubrics(),initShowAnswer2(),a&&setScoreMarkers(a),initqsclickchange(),initClearScoreMarkers(),e.scripts&&r(e.scripts,0)}function setupTips(e,t,a){var r=document.getElementById(e);if(r){r.setAttribute("data-tip",t);var i=e.substr(2).split(/-/)[0];document.getElementById("tips"+i)||$("body").append($("<div>",{class:"hidden",id:"tips"+i}).html(a)),r.setAttribute("aria-describedby","tips"+i),r.addEventListener("focus",function(){showehdd(e,t,i)}),r.addEventListener("blur",hideeh),r.addEventListener("click",function(){reshrinkeh(e)})}}function clearTips(){hideAllEhTips()}function initqsclickchange(){$("input[id^=qs][value=spec]").each(function(e,t){$(t).siblings("input[type=text]").off("keyup.qsclickchange").on("keyup.qsclickchange",function(e){8!=e.keyCode&&46!=e.keyCode&&$(t).prop("checked",!0)})})}function clearScoreMarkers(e){var t,a=e.currentTarget;if(null!==(t=a.className.match(/(ansgrn|ansred|ansyel|ansorg)/)))$(a).removeClass(t[0]),$(a).nextAll(".scoremarker.sr-only").first().remove(),"ansorg"==t[0]&&$(a).nextAll(".scoremarker").first().remove(),"select"==a.tagName.toLowerCase()&&$(a).nextAll("svg.scoremarker").first().remove(),"hidden"==a.type&&$("#mqinput-"+a.id).removeClass(t[0]);else{var r=$(a).closest("[id^=qnwrap]");r.length>0&&null!==(t=r[0].className.match(/(ansgrn|ansred|ansyel|ansorg)/))&&(r.removeClass(t[0]),r.find(".scoremarker").remove())}}function setScoreMarkers(e){var t='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="green" stroke-width="3" fill="none" role="img" aria-hidden=true>';t+='<polyline points="20 6 9 17 4 12"></polyline></svg>',t+='<span class="sr-only scoremarker">'+_("Correct")+"</span>";var a='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="rgb(255,187,0)" stroke-width="3" fill="none" role="img" aria-hidden=true>';a+='<path d="M 5.3,10.6 9,14.2 18.5,4.6 21.4,7.4 9,19.8 2.7,13.5 z" /></svg>',a+='<span class="sr-only scoremarker">'+_("Partially correct")+"</span>";var r='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="rgb(153,0,0)" stroke-width="3" fill="none" role="img" aria-hidden=true>';r+='<path d="M18 6 L6 18 M6 6 L18 18" /></svg>',r+='<span class="sr-only scoremarker">'+_("Incorrect")+"</span>";var i='<svg class="scoremarker" viewBox="0 0 24 24" width="16" height="16" stroke="rgb(255,85,0)" stroke-width="3" fill="none" role="img" aria-hidden=true>';i+='<path d="M18 6 L6 18 M6 6 L18 18" /></svg>',i+='<span class="sr-only scoremarker">'+_("Incorrect, wrong format")+"</span>",$(e).find(".scoremarker").remove(),$(e).find("div.ansgrn,table.ansgrn").append(t),$(e).find("div.ansyel,table.ansyel").append(a),$(e).find("div.ansred,table.ansred").append(r),$(e).find("div.ansorg,table.ansorg").append(i),$(e).find("select.ansgrn").after(t),$(e).find("select.ansyel").after(a),$(e).find("select.ansred").after(r),$(e).find("select.ansorg").after(i),$(e).find("span[id^=mqinput-].ansgrn,input[type=text].ansgrn").after('<span class="scoremarker sr-only">'+_("Correct")+"</span>"),$(e).find("span[id^=mqinput-].ansyel,input[type=text].ansyel").after('<span class="scoremarker sr-only">'+_("Partially correct")+"</span>"),$(e).find("span[id^=mqinput-].ansred,input[type=text].ansred").after('<span class="scoremarker sr-only">'+_("Incorrect")+"</span>"),$(e).find("span[id^=mqinput-].ansorg,input[type=text].ansorg").after('<span class="scoremarker sr-only">'+_("Incorrect, wrong format")+"</span>"),$(e).find("span[id^=mqinput-].ansorg,input[type=text].ansorg").after($("<span>",{role:"button",class:"scoremarker",tabindex:0,"aria-label":_("Incorrect, wrong format"),"data-tip":_("Your answer is equivalent to the correct answer, but is not simplified or is in the wrong format"),"data-tooltipclass":"dropdown-pane tooltip-pane"}).on("mouseover focus",function(){tipshow(this)}).on("mouseleave blur",tipout).html('<svg style="vertical-align:middle;margin-left:3px;" viewBox="0 0 24 24" width="18" height="18" stroke="rgb(255,85,0)" stroke-width="2" stroke-linecap="round" fill="none" role="img" aria-hidden=true><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12" y2="16"></line></svg>'))}function initClearScoreMarkers(){$("input[id^=qn]").off("input.clearmarkers").on("input.clearmarkers",clearScoreMarkers),$("input[id^=qs],select[id^=qn]").off("change.clearmarkers").on("change.clearmarkers",clearScoreMarkers)}function initEnterHandler(e){$("input[type=text][name=qn"+e+"]").off("keydown.enterhandler").on("keydown.enterhandler",function(e){if(13==e.which){var t=$(this).closest(".questionwrap").find(".submitbtnwrap .primary");t.length>0&&e.preventDefault(),t.is(":disabled")||t.trigger("click")}})}function handleMQenter(e){var t=$("#"+e).closest(".questionwrap").find(".submitbtnwrap .primary");t.is(":disabled")||t.trigger("click")}function initDupRubrics(){$(".rubriclink").each(function(e,t){$(t).removeClass("rubriclink");var a=t.id.substring(16);if(-1!==a.indexOf("-")){var r=a.split("-");a=1e3*(1*r[0]+1)+1*r[1]}var i=$("#mqinput-qn"+a+",input[type=text]#qn"+a+",select#qn"+a+",textarea#qn"+a+",div.introtext#qnwrap"+a);i.length>0&&(i.after(t),$(t).show())})}function initShowAnswer2(){$("input.sabtn + span.hidden, input.sabtn + div.hidden").each(function(e,t){var a,r=t.id.substring(3),i=r;if(-1!==i.indexOf("-")){var n=i.split("-");i=1e3*(1*n[0]+1)+1*n[1],a=_("Question ")+(1*n[0]+1)+_(" Part ")+(1*n[1]+1)}else a=_("Question ")+(1*i+1);var s=$("<span>",{class:"keywrap"}).append($("<button>",{type:"button","aria-controls":"ans"+r,"aria-expanded":"false",class:"keybtn","aria-label":_("View Key for ")+a,title:_("View Key")}).on("click",function(e){var t="true"==e.currentTarget.getAttribute("aria-expanded");e.currentTarget.setAttribute("aria-expanded",t?"false":"true"),$("#ans"+r).toggleClass("hidden",t)}).html('<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>'));if($(t).closest(".autoshowans").length>0){var l=$("#qnwrap"+i);if(l.length>0)return $(t).prev(".sabtn").remove(),s.append($(t)).addClass("inwrap"),void l.append(s);var c=$("#mqinput-qn"+i+",input[type=text]#qn"+i+",select#qn"+i+",textarea#qn"+i);if(c.length>0)return $(t).prev(".sabtn").remove(),s.append($(t)),void c.after(s)}var o=$(t).parent();s.append($(t)),o.empty().append(s)}),$("input.dsbtn + div.hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),$("input.dsbtn").each(function(){var e=$(this).siblings("div:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",e).off("click.sashow").on("click.sashow",function(){var e="true"==$(this).attr("aria-expanded");$(this).attr("aria-expanded",!e).siblings("div:first-of-type").attr("aria-expanded",!e).attr("aria-hidden",e).toggleClass("hidden",e)})})}function initShowAnswer(){$("input.sabtn + span.hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),$("input.sabtn").each(function(){var e=$(this).siblings("span:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",e).off("click.sashow").on("click.sashow",function(){$(this).attr("aria-expanded",!0).siblings("span:first-of-type").attr("aria-expanded",!0).attr("aria-hidden",!1).removeClass("hidden")})}),$("input.dsbtn + div.hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),$("input.dsbtn").each(function(){var e=$(this).siblings("div:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",e).off("click.sashow").on("click.sashow",function(){$(this).attr("aria-expanded",!0).siblings("div:first-of-type").attr("aria-expanded",!0).attr("aria-hidden",!1).removeClass("hidden")})})}function setupDraw(e){var t,a,r=document.getElementById("qn"+e).value,t=r.split(";;"),i=[];for(a=0;a<t.length;a++)if(5==a?t[a]="["+t[a].replace(/&quot;/g,'"')+"]":(t[a]="["+t[a].replace(/\(/g,"[").replace(/\)/g,"]")+"]",0==a&&t[a].length>2&&(t[a]="["+t[a].replace(/;/g,"],[")+"]")),""===t[a])i[a]=[];else try{i[a]=JSON.parse(t[a])}catch(e){i[a]=[]}window.drawla[e]=i,window.canvases[e]=allParams[e].canvas,imathasDraw.initCanvases(e);var n=document.getElementById("drawtools"+e);n&&n.addEventListener("click",function(e){var t=e.target;if(t.hasAttribute("data-drawaction")){var a=t.getAttribute("data-drawaction"),r=t.getAttribute("data-qn");if("clearcanvas"===a)imathasDraw.clearcanvas(r);else if("settool"===a){var i=t.getAttribute("data-val");imathasDraw.settool(t,r,i)}}}),$("#qn"+e).parent().find(".a11ydrawadd:not(.inited)").off("click.adda11ydraw").on("click.adda11ydraw",function(e){var t=e.target.getAttribute("data-qn");$(e.target).addClass("inited"),imathasDraw.adda11ydraw(t)})}function initMultAns(e){if("hasnone"==$("#qnwrap"+e).attr("data-multans")){var t=$('input[name^="qn'+e+'["]');t.on("change",function(){this.checked&&this.value==t.length-1?t.not(":last").prop("checked",!1):this.checked&&t.last().prop("checked",!1)})}}function isBlank(e){return!e||0===e.length||/^\s*$/.test(e)}function editdebit(e){var t=e.target,a=$(t).closest("tr").find("input").first();if(!isBlank(t.value)&&a.hasClass("iscredit")){a.css("padding-left");a.is("select")?a.css("margin-right",20):a.width(""),a.css("padding-left",""),a.removeClass("iscredit")}}function editcredit(e){var t=e.target,a=$(t).closest("tr").find("input").first();if(!isBlank(t.value)&&!a.hasClass("iscredit")){var r=parseInt(a.css("padding-left"));a.is("select")?a.css("margin-right",0):a.width(a.width()-20),a.css("padding-left",20+r),a.addClass("iscredit")}}function initcreditboxes(){$(".creditbox").each(function(e,t){editcredit({target:t})})}function setupLivePreview(e,t){if("MathJax"==mathRenderer&&(!window.MathJax||!window.MathJax.Hub&&!window.MathJax.typesetPromise)){var a=e,r=t;return void setTimeout(100,function(){setupLivePreview(a,r)})}LivePreviews.hasOwnProperty(e)||("MathJax"==mathRenderer||"Katex"==mathRenderer?(LivePreviews[e]={delay:"MathJax"==mathRenderer?100:0,finaldelay:1e3,preview:null,buffer:null,timeout:null,finaltimeout:null,mjRunning:!1,mjPending:!1,oldText:null,mjPromise:null,Init:function(t){$("#p"+e).css("positive","relative").append('<span id="lpbuf1'+e+'" style="visibility:hidden;position:absolute;"></span>').append('<span id="lpbuf2'+e+'" style="visibility:hidden;position:absolute;"></span>'),this.preview=document.getElementById("lpbuf1"+e),this.buffer=document.getElementById("lpbuf2"+e),"MathJax"==mathRenderer&&MathJax.typesetPromise&&(this.mjPromise=Promise.resolve()),t||showPreview(e)},SwapBuffers:function(){var e=this.preview,t=this.buffer;this.buffer=e,this.preview=t,e.style.visibility="hidden",e.style.position="absolute",t.style.position="",t.style.visibility=""},Update:function(e){this.timeout&&clearTimeout(this.timeout),this.finaltimeout&&clearTimeout(this.finaltimeout),this.timeout=setTimeout(this.callback,this.delay),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(e){this.buffer.innerHTML=this.oldtext=e,this.mjRunning=!0,this.RenderBuffer()},RenderBuffer:function(){"MathJax"==mathRenderer?MathJax.typesetPromise?this.mjPromise=this.mjPromise.then(function(){MathJax.typesetPromise([this.buffer]).then(this.PreviewDone.bind(this))}.bind(this)):MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.buffer],["PreviewDone",this]):"Katex"==mathRenderer&&(renderMathInElement(this.buffer),"undefined"!=typeof MathJax&&MathJax.Hub&&!MathJax.typesetPromise&&$(this.buffer).children(".mj").length>0?MathJax.Hub.Queue(["PreviewDone",this]):this.PreviewDone())},DoFinalPreview:function(){$("#pbtn"+e).trigger("click")},preformat:function(t){var a=allParams[e].qtype,r=allParams[e].calcformat;return preformat(e,t,a,r)},CreatePreview:function(){if(this.timeout=null,!this.mjPending){var t=document.getElementById("qn"+e).value;t!==this.oldtext&&(this.mjRunning?(this.mjPending=!0,this.mjPromise?this.mjPromise=this.mjPromise.then(this.CreatePreview().bind(this)):MathJax.Hub&&MathJax.Hub.Queue(["CreatePreview",this])):(this.oldtext=t,this.buffer.innerHTML="`"+this.preformat(t)+"`",this.mjRunning=!0,this.RenderBuffer()))}},PreviewDone:function(){this.mjRunning=this.mjPending=!1,this.SwapBuffers(),updateehpos()}},"undefined"==typeof MathJax||MathJax.typesetPromise?LivePreviews[e].callback=function(){LivePreviews[e].CreatePreview()}:(LivePreviews[e].callback=MathJax.Callback(["CreatePreview",LivePreviews[e]]),LivePreviews[e].callback.autoReset=!0),LivePreviews[e].Init(t)):LivePreviews[e]={finaldelay:1e3,finaltimeout:null,Update:function(e){this.finaltimeout&&clearTimeout(this.finaltimeout),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(t){var a=document.getElementById("p"+e);a.innerHTML=t,rendermathnode(a)},DoFinalPreview:function(){$("#pbtn"+e).trigger("click")}})}function updateLivePreview(e){var t=e.target.id.substr(2);setupLivePreview(t),LivePreviews[t].Update()}function clearLivePreviewTimeouts(){for(var e in LivePreviews)clearTimeout(LivePreviews[e].finaltimeout)}function normalizemathunicode(e){return e=e.replace(/[\x00-\x09\x0B\x0C\x0E-\x1F\x7F]/g,""),e=e.replace(/\u2013|\u2014|\u2015|\u2212/g,"-"),e=e.replace(/\u2044|\u2215/g,"/"),e=e.replace(/∞/g,"oo").replace(/≤/g,"<=").replace(/≥/g,">=").replace(/∪/g,"U"),e=e.replace(/±/g,"+-").replace(/÷/g,"/").replace(/·|✕|×|⋅/g,"*"),e=e.replace(/√/g,"sqrt").replace(/∛/g,"root(3)"),e=e.replace(/⁰/g,"^0").replace(/¹/g,"^1").replace(/²/g,"^2").replace(/³/g,"^3").replace(/⁴/g,"^4").replace(/⁵/g,"^5").replace(/⁶/g,"^6").replace(/⁷/g,"^7").replace(/⁸/g,"^8").replace(/⁹/g,"^9"),e=e.replace(/\u2329/g,"<").replace(/\u232a/g,">"),e=e.replace(/₀/g,"_0").replace(/₁/g,"_1").replace(/₂/g,"_2").replace(/₃/g,"_3"),e=e.replace(/\b(OO|infty)\b/gi,"oo").replace(/°/g,"degree"),e=e.replace(/θ/g,"theta").replace(/ϕ/g,"phi").replace(/φ/g,"phi").replace(/π/g,"pi").replace(/σ/g,"sigma").replace(/μ/g,"mu"),e=e.replace(/α/g,"alpha").replace(/β/g,"beta").replace(/γ/g,"gamma").replace(/δ/g,"delta").replace(/ε/g,"epsilon").replace(/κ/g,"kappa"),e=e.replace(/λ/g,"lambda").replace(/ρ/g,"rho").replace(/τ/g,"tau").replace(/χ/g,"chi").replace(/ω/g,"omega"),e=e.replace(/Ω/g,"Omega").replace(/Γ/g,"Gamma").replace(/Φ/g,"Phi").replace(/Δ/g,"Delta").replace(/Σ/g,"Sigma")}function htmlEntities(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;")}function showPreview(e){var t=allParams[e],a="",r=processByType(e);if(r.str&&(a="`"+htmlEntities(r.str)+"`"),r.dispvalstr&&""!=r.dispvalstr&&-1!=t.calcformat.indexOf("showval")&&(a+=(""==a?"":" = ")+"`"+htmlEntities(r.dispvalstr)+"`"),r.err&&""!=r.err&&""!=r.str&&(a+="``"==a?"":". <span class=noticetext>"+r.err+"</span>"),LivePreviews.hasOwnProperty(e))LivePreviews[e].RenderNow(a);else{var i=document.getElementById("p"+e);i.innerHTML=a,rendermathnode(i)}a11ypreview(a)}function a11ypreview(e){var t=$("<div>",{class:"inactive"}).html(e).appendTo("body")[0];rendermathnode(t,function(){var e=document.getElementById("arialive");e.innerHTML="",t.className="",$(t).find("[aria-label]").each(function(e,t){$(t).html($(t).attr("aria-label"))}),e.appendChild(t)})}function syntaxCheckMQ(e,t){clearTimeout(MQsyntaxtimer);var a=parseInt(e.replace(/.*qn(\d+)\b.*/g,"$1"));MQsyntaxtimer=setTimeout(function(){showSyntaxCheckMQ(a)},1e3)}function showSyntaxCheckMQ(e){var t=allParams[e],a=processByType(e),r="";if(a.dispvalstr&&""!=a.dispvalstr&&"NaN"!=a.dispvalstr&&t.calcformat&&-1!=t.calcformat.indexOf("showval")&&(r+=" = "+htmlEntities(a.dispvalstr)+" "),a.err&&""!=a.err&&""!=a.str&&(r+="<span class=noticetext>"+a.err+"</span>"),!LivePreviews.hasOwnProperty(e)||"MathJax"!=mathRenderer&&"Katex"!=mathRenderer){var i=document.getElementById("p"+e);i&&(i.innerHTML=r)}else{var i=document.getElementById("p"+e).firstChild;i.innerHTML=r,i.style.visibility="",i.style.position=""}a11ypreview(document.getElementById("qn"+e)?"`"+htmlEntities(document.getElementById("qn"+e).value)+"` "+r:r)}function preSubmitForm(e){var t;for(var a in allParams){var r;if(!1!==(t=preSubmit(a)))if(r=document.getElementById("qn"+a+"-val"))r.value=t;else{var i=document.createElement("input");i.type="hidden",i.name="qn"+a+"-val",i.value=t,e.appendChild(i)}}}function preSubmit(e){var t=processByType(e);return!!t.submitstr&&t.submitstr}function preSubmitString(e,t){var a=parseInt(e.substr(2));if(!allParams.hasOwnProperty(a))return t;var r=allParams[a];return t=normalizemathunicode(t),t=t.replace(/^\s+/,"").replace(/\s+$/,""),"numfunc"==r.qtype&&(t=AMnumfuncPrepVar(a,t)[3]),t}function processByType(e){if(!allParams.hasOwnProperty(e))return!1;var t=allParams[e],a={};if("draw"==t.qtype)return imathasDraw.encodea11ydraw(),{};if("choices"==t.qtype||"multans"==t.qtype||"matching"==t.qtype)return{};if(t.hasOwnProperty("matrixsize"))a=processSizedMatrix(e);else{var r=document.getElementById("qn"+e);if(!r)return!1;var i=r.value;if(i=normalizemathunicode(i),i=i.replace(/^\s+/,"").replace(/\s+$/,""),i.match(/^\s*$/))return{str:"",displvalstr:"",submitstr:""};if(i.match(/^\s*DNE\s*$/i))return{str:"DNE",displvalstr:"",submitstr:"DNE"};if(i.match(/^\s*oo\s*$/i))return{str:"oo",displvalstr:"",submitstr:"oo"};if(i.match(/^\s*\+oo\s*$/i))return{str:"+oo",displvalstr:"",submitstr:"+oo"};if(i.match(/^\s*-oo\s*$/i))return{str:"-oo",displvalstr:"",submitstr:"-oo"};switch(t.qtype){case"number":a=processNumber(i,t.calcformat);break;case"calculated":a=processCalculated(i,t.calcformat);break;case"interval":case"calcinterval":a=processCalcInterval(i,t.calcformat,t.vars);break;case"ntuple":case"calcntuple":a=processCalcNtuple(i,t.calcformat);break;case"complex":case"calccomplex":a=processCalcComplex(i,t.calcformat);break;case"calcmatrix":a=processCalcMatrix(i,t.calcformat);break;case"numfunc":a=processNumfunc(e,i,t.calcformat);break;case"matrix":a=processCalcMatrix(i,"decimal")}a.str=preformat(e,i,t.qtype,t.calcformat)}return a}function preformat(e,t,a,r){return t=normalizemathunicode(t),a.match(/interval/)?r.match(/inequality/)?(t=AMnumfuncPrepVar(e,t)[1],t=t.replace(/<=/g," le ").replace(/>=/g," ge ").replace(/</g," lt ").replace(/>/g," gt "),t.match(/all\s*real/i)&&(t="text("+t+")")):t=t.replace(/U/g,"uu"):"numfunc"==a?t=AMnumfuncPrepVar(e,t)[1]:"calcntuple"==a?t=t.replace(/<+/g,"(:").replace(/>+/g,":)"):"calculated"==a&&(-1==r.indexOf("list")&&-1==r.indexOf("set")&&(t=t.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),-1!=r.indexOf("scinot")&&(t=t.replace(/(x|X|\u00D7)/,"xx"))),t=t.replace(/[^\u0000-\u007f]/g,"?")}function AMnumfuncPrepVar(e,t){var a,r="";a="string"==typeof allParams[e].vars?[allParams[e].vars]:allParams[e].vars.slice();var i=a.map(escapeRegExp).join("|");allParams[e].fvars&&(r=allParams[e].fvars.map(escapeRegExp).join("|")),a.push("DNE"),i.match(/lambda/)&&(t=t.replace(/lamda/,"lambda"));var n=[],s=t;s=s.replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root)/g,functoindex),t=t.replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root)/g,functoindex);for(var l=0;l<a.length;l++)if(a[l].match(/\(.+\)/)&&(t=t.replace(/\(\((.*?)\)\)/g,"($1)")),"E"==a[l]||"e"==a[l])n[l]=!0;else{n[l]=!1;for(var c=0;c<a.length;c++)if(l!=c&&a[c].toLowerCase()==a[l].toLowerCase()&&a[c]!=a[l]){n[l]=!0;break}}t=t.replace(new RegExp("("+i+")","gi"),function(e,t){for(var r=0;r<a.length;r++)if(a[r]==t||!n[r]&&a[r].toLowerCase()==t.toLowerCase())return"@v"+r+"@";return t}),t=t.replace(/@v(\d+)@/g,function(e,t){return a[t]}),s=s.replace(new RegExp("("+i+")","gi"),function(e,t){for(var r=0;r<a.length;r++)if(a[r]==t||!n[r]&&a[r].toLowerCase()==t.toLowerCase())return"@v"+r+"@";return t}),s=s.replace(/(@v(\d+)@|\d+(\.\d+)?)!/g,"{:$&:}"),s=s.replace(/@v(\d+)@/g,function(e,t){return a[t]});for(var o,d=t,u=new Array,l=0;l<a.length;l++)if(a[l].length>1){var p=!1;if(-1!=greekletters.indexOf(a[l].toLowerCase())&&(p=!0),a[l].match(/^\w+_\w+$/)){o=n[l]?"g":"gi";var h=new RegExp(/^(\w+)_(\w+)$/,o).exec(a[l]),g=new RegExp(h[1]+"_\\("+h[2]+"\\)",o);s=s.replace(g,a[l]),t=t.replace(g,a[l]),d=d.replace(new RegExp(h[0],o),h[1]+"_"+h[2]),d=d.replace(new RegExp(h[1]+"_\\("+h[2]+"\\)",o),h[1]+"_("+h[2]+")"),h[1].length>1&&-1==greekletters.indexOf(h[1].toLowerCase())&&(h[1]='"'+h[1]+'"'),h[2].length>1&&-1==greekletters.indexOf(h[2].toLowerCase())&&(h[2]='"'+h[2]+'"'),s=s.replace(new RegExp(h[0],o),h[1]+"_"+h[2]),t=t.replace(new RegExp(h[0],"g"),"repvars"+l),a[l]="repvars"+l}else!p&&a[l].replace(/[^\w_]/g,"").length>1&&u.push(a[l]);(a[l].match(/[^\w_]/)||a[l].match(/^(break|case|catch|continue|debugger|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|this|throw|try|typeof|var|void|while|and with)$/))&&(t=t.replace(new RegExp(escapeRegExp(a[l]),"g"),"repvars"+l),a[l]="repvars"+l)}if(u.length>0){vltq=u.join("|");var m=new RegExp("("+vltq+")","g");s=s.replace(m,'"$1"')}return s=s.replace(/@(\d+)@/g,indextofunc),t=t.replace(/@(\d+)@/g,indextofunc),d=d.replace(/@(\d+)@/g,indextofunc),i.match(/\bf\b/)&&!r.match(/\bf\b/)&&(s=s.replace(/([^a-zA-Z])f\^([\d\.]+)([^\d\.])/g,"$1f^$2{::}$3"),s=s.replace(/([^a-zA-Z])f\(/g,"$1f{::}(")),i.match(/\bg\b/)&&!r.match(/\bg\b/)&&(s=s.replace(/([^a-zA-Z])g\^([\d\.]+)([^\d\.])/g,"$1g^$2{::}$3"),s=s.replace(/([^a-zA-Z])g\(/g,"$1g{::}(")),[t,s,a.join("|"),d]}function processNumber(e,t){var a="";if(e=e.replace(/^\s+|\s+$/g,""),-1!==t.indexOf("set")&&("{"!==e.charAt(0)||"}"!==e.substr(-1)?a+=_("Invalid set notation"):e=e.slice(1,-1)),-1!==t.indexOf("list")||-1!==t.indexOf("set"))var r=e.split(/\s*,\s*/);else var r=[e.replace(/,/g,"")];for(var i,n=0;n<r.length;n++)if(i=r[n],-1!=t.indexOf("units")){_("Units must be given as [decimal number]*[unit]^[power]*[unit]^[power].../[unit]^[power]*[unit]^[power]...");if(i.match(/^\s*(-?\s*\d+\.?\d*|-?\s*\.\d+|-?\s*\d\.?\d*\s*(E|\*\s*10\s*\^)\s*[\-\+]?\d+)/)||(a+=_("Answer must start with a number. ")),i.match(/\b(sq|square|cu|cubic|squared|cubed)\s*\^\s*[\-\+]?\s*\d+/)&&(a+=_("Invalid base for exponent. "),i=i.replace(/\^/,"")),i.match(/\b(sq|square|cu|cubic)\s+per\b/)&&(a+=_('Missing unit before "per". '),i=i.replace(/per\b/,"")),i.match(/\bper\s+(squared|cubed)/)&&(a+=_('Missing unit after "per". '),i=i.replace(/\bper/,"")),i=i.replace(/([a-zA-Z]\w*\s*)(\^\s*[\-\+]?\s*\d+\s*)(?:squared|cubed)\b/g,"$1"),i=i.replace(/(?:sq|square|cu|cubic)\s+([a-zA-Z]\w*)/g,"$1"),i=i.replace(/([a-zA-Z]\w*)\s+(?:squared|cubed)/g,"$1"),i=i.replace(/\sper\s/g,"/"),i=i.replace(/^\s*(-?\s*\d\.?\d*\s*(E|\*\s*10\s*\^)\s*[\-\+]?\d+|-?\s*\d+\.?\d*|-?\s*\.\d+)\s*[\-\*]?\s*/,""),i=i.replace(/\s*\-\s*([a-zA-Z])/g,"*$1"),i=i.replace(/\*\*/g,"^"),i=i.replace(/\s*(\/|\^|\-)\s*/g,"$1"),i=i.replace(/\(\s*(.*?)\s*\)\s*\//,"$1/").replace(/\/\s*\(\s*(.*?)\s*\)/,"/$1"),i=i.replace(/\s*[\*\s]\s*/g,"*"),i=i.replace(/([a-zA-Z]\w*)\^[\-\+]?\d+/g,"$1"),i.match(/\^/)&&(a+=_("Invalid exponents. "),i=i.replace(/\^/g,"")),(i.match(/\//g)||[]).length>1&&(a+=_("Only one division symbol allowed in the units. ")),i=i.replace(/\//g,"*").replace(/^\s*\*/,"").trim(),
i.length>0)for(var s="(yotta|zetta|exa|peta|tera|giga|mega|kilo|hecto|deka|deci|centi|milli|micro|nano|pico|fempto|atto|zepto|yocto)",l=/^(m|meter|micron|angstrom|fermi|in|inch|inches|ft|foot|feet|mi|mile|furlong|yd|yard|s|sec|second|min|minute|h|hr|hour|day|week|mo|month|yr|year|fortnight|acre|ha|hectare|b|barn|L|liter|litre|cc|gal|gallon|cup|pt|pint|qt|quart|tbsp|tablespoon|tsp|teaspoon|rad|radian|deg|degree|arcminute|arcsecond|grad|gradian|knot|kt|c|mph|kph|g|gram|t|tonne|Hz|hertz|rev|revolution|cycle|N|newton|kip|dyn|dyne|lb|pound|lbf|ton|J|joule|erg|lbft|ftlb|cal|calorie|eV|electronvolt|Wh|Btu|therm|W|watt|hp|horsepower|Pa|pascal|atm|atmosphere|bar|Torr|mmHg|umHg|cmWater|psi|ksi|Mpsi|C|coulomb|V|volt|farad|F|ohm|amp|ampere|A|T|tesla|G|gauss|Wb|weber|H|henry|lm|lumen|lx|lux|amu|dalton|Da|me|mol|mole|Ci|curie|R|roentgen|sr|steradian|Bq|becquerel|ls|lightsecond|ly|lightyear|AU|au|parsec|pc|solarmass|solarradius|degF|degC|degK|K)$/,c=new RegExp("^(Y|Z|E|P|T|G|M|k|h|da|d|c|m|u|n|p|f|a|z|y)?(m|ft|s|b|cc|g|t|N|dyn|J|cal|eV|Wh|W|hp|Pa|C|V|F|A|T|G|Wb|H|lm|lx|Da|mol|Ci|sr|Bq|ls|ly|pc)$"),o=new RegExp("^(inch|inches|lbft|ftlb|solarmass|solarradius)$","i"),d=new RegExp("^(Y|Z|E|P|T|G|M|k|h|da|d|c|m|u|n|p|f|a|z|y)?(L|Hz|Btu)$","i"),u=new RegExp("^"+s+"?(fermi|foot|feet|sec|hertz|horsepower|Torr|gauss|lux)$","i"),p=new RegExp("^(micron|mile|furlong|yard|minute|hour|day|week|month|year|fortnight|acre|hectare|gallon|cup|pint|quart|tablespoon|teaspoon|radian|degree|gradian|knot|revolution|cycle|kip|lb|therm|atmosphere|roentgen)s?$","i"),h=new RegExp("^"+s+"?(meter|angstrom|second|barn|liter|litre|arcminute|arcsecond|gram|tonne|newton|dyne|pound|ton|joule|erg|calorie|electronvolt|watt|pascal|coulomb|volt|farad|ohm|amp|ampere|tesla|weber|henry|lumen|dalton|mole|curie|steradian|becquerel|lightsecond|lightyear|parsec)s?$","i"),g=i.split(/\s*\*\s*/),m=0;m<g.length;m++)l.test(g[m])||c.test(g[m])||o.test(g[m])||d.test(g[m])||u.test(g[m])||p.test(g[m])||h.test(g[m])||(a+=_("Unknown unit ")+'"'+g[m]+'". ');else a+=_("Missing units")}else-1!=t.indexOf("integer")?i.match(/^\s*\-?\d+\s*$/)||(a+=_("This is not an integer.")):i.match(/^\s*(\+|\-)?(\d+\.?\d*|\.\d+|\d*\.?\d*\s*E\s*[\-\+]?\d+)\s*$/)||(a+=_("This is not a decimal or integer value."));return{err:a,dispvalstr:e}}function processCalculated(e,t){if(e=e.replace(/=/,""),-1!=t.indexOf("list"))var a=e.split(/,/);else if(-1!=t.indexOf("set"))var a=e.replace(/[\{\}]/g,"").split(/,/);else var a=[e];for(var r,i="",n=[],s=0;s<a.length;s++)str=a[s],i+=singlevalsyntaxcheck(str,t),i+=syntaxcheckexpr(str,t),r=singlevaleval(str,t),i+=r[1],n.push(r[0]);var l=n.join(", ");return-1!=t.indexOf("set")&&(l="{"+l+"}"),{err:i,dispvalstr:l,submitstr:n.join(",")}}function processCalcInterval(e,t,a){if(-1!=t.indexOf("inequality")){e=e.replace(/or/g," or ");var r=ineqtointerval(e,a);if(r.length>1)return{err:"wrongvar"==r[1]?_("you may have used the wrong variable"):_("invalid inequality notation")};e=r[0]}var n=[],s=[],l=[],c="U";if(-1!=t.indexOf("list")){e=e.replace(/\s*,\s*/g,","),c=",";for(var o=0,d=1;d<e.length-1;d++)","==e.charAt(d)&&(")"!=e.charAt(d-1)&&"]"!=e.charAt(d-1)||"("!=e.charAt(d+1)&&"["!=e.charAt(d+1)||(n.push(e.substring(o,d)),o=d+1));n.push(e.substring(o))}else n=e.split(/\s*U\s*/i);var u,p,h,g="",m=[];for(i=0;i<n.length;i++){if(u=n[i],sm=u.charAt(0),em=u.charAt(u.length-1),p=u.substring(1,u.length-1),p=p.split(/,/),2!=p.length||"("!=sm&&"["!=sm||")"!=em&&"]"!=em){-1!=t.indexOf("inequality")?g+=_("invalid inequality notation")+". ":g+=_("invalid interval notation")+". ";break}for(j=0;j<2;j++)-1!=t.indexOf("decimal")&&p[j].match(/[\d\.]e\-?\d/)&&(p[j]=p[j].replace(/e/,"E")),g+=singlevalsyntaxcheck(p[j],t),g+=syntaxcheckexpr(p[j],t),p[j].match(/^\s*\-?\+?oo\s*$/)?m[j]=p[j]:(h=singlevaleval(p[j],t),g+=h[1],m[j]=h[0]);s[i]=sm+m[0]+","+m[1]+em,-1!=t.indexOf("inequality")&&(m[0].toString().match(/oo/)?m[1].toString().match(/oo/)?l[i]="RR":l[i]=a+("]"==em?"le":"lt")+m[1]:m[1].toString().match(/oo/)?l[i]=a+("["==sm?"ge":"gt")+m[0]:l[i]=m[0]+("["==sm?"le":"lt")+a+("]"==em?"le":"lt")+m[1])}return-1!=t.indexOf("inequality")?{err:g,dispvalstr:l.join(' "or" '),submitstr:s.join(c)}:{err:g,dispvalstr:s.join(" uu "),submitstr:s.join(c)}}function processCalcNtuple(e,t){var a,r="",i=0,n=0,s="",l=!0,c=NaN;e=e.replace(/(\s+,\s+|,\s+|\s+,)/,","),e=e.replace(/<<(.*?)>>/g,"<$1>"),e.charAt(0).match(/[\(\[\<\{]/)||(l=!1);for(var o=0;o<e.length;o++)a=!1,0==i&&(r+=e.charAt(o),n=o+1,","==e.charAt(o)?e.substring(o+1).match(/^\s*[\(\[\<\{]/)&&e.substring(0,o).match(/[\)\]\>\}]\s*$/)||(l=!1):o>0&&","!=e.charAt(o-1)&&(l=!1)),e.charAt(o).match(/[\(\[\<\{]/)?i++:e.charAt(o).match(/[\)\]\>\}]/)&&(i--,a=!0),(0==i&&a||1==i&&","==e.charAt(o))&&(sub=e.substring(n,o).replace(/^\s+/,"").replace(/\s+$/,""),s+=singlevalsyntaxcheck(sub,t),s+=syntaxcheckexpr(sub,t),c=singlevaleval(sub,t),s+=c[1],r+=c[0],r+=e.charAt(o),n=o+1);return 0!=i&&(l=!1),0==l&&(s=_("Invalid notation")+". "+s),{err:s,dispvalstr:r,submitstr:r}}function processCalcComplex(e,t){for(var a,r,i,n,s="",l=e.split(","),c="",o="",d=[],u=0;u<l.length;u++){if(c=l[u].replace(/^\s+/,"").replace(/\s+$/,""),-1==t.indexOf("sloppycomplex")){var p=parsecomplex(l[u]);"string"==typeof p?s+=p:(s+=singlevalsyntaxcheck(p[0],t),s+=singlevalsyntaxcheck(p[1],t))}syntaxcheckexpr(c,t),n=prepWithMath(mathjs(c,"i")),a=scopedeval("var i=0;"+n),r=scopedeval("var i=1;"+n),i=scopedeval("var i=-1;"+n),"synerr"!=a&&"synerr"!=r||(s+=_("syntax incomplete"),a=NaN),isNaN(a)||"Infinity"==a||isNaN(r)||isNaN(i)||"Infinity"==r||(r-=a,o=Math.abs(a)<1e-16?"":a,o+=Math.abs(r)<1e-16?"":(r>0&&""!=o?"+":"")+r+"i",d.push(o))}return{err:s,dispvalstr:d.join(", "),submitstr:d.join(",")}}function processSizedMatrix(e){var t=allParams[e],a=t.matrixsize,r="";t.calcformat&&(r=t.calcformat);for(var i,n=[],s=[],l=[],c=0,o="",d=0;d<a[0];d++){n[d]=[],s[d]=[];for(var u=0;u<a[1];u++)i=document.getElementById("qn"+e+"-"+c).value,i=normalizemathunicode(i),""!==i&&(o+=syntaxcheckexpr(i,r),o+=singlevalsyntaxcheck(i,r)),n[d][u]=i,res=singlevaleval(i,r),o+=res[1],s[d][u]=res[0],l.push(res[0]),c++;n[d]="("+n[d].join(",")+")",s[d]="("+s[d].join(",")+")"}return{err:o,str:"["+n.join(",")+"]",dispvalstr:"calcmatrix"==t.qtype?"["+s.join(",")+"]":"",submitstr:l.join("|")}}function processCalcMatrix(e,t){var a=!0;e=e.replace(/\[/g,"("),e=e.replace(/\]/g,")"),e=e.replace(/\s+/g,""),(e.length<2||"("!==e.charAt(0)||")"!==e.charAt(e.length-1))&&(a=!1),e=e.substring(1,e.length-1);for(var r="",i="",n=[],s=0,l=0,c=0;c<e.length;c++)"("==e.charAt(c)?l++:")"==e.charAt(c)?l--:","==e.charAt(c)&&0==l&&(n.push(e.substring(s+1,c-1)),s=c+1);n.push(e.substring(s+1,e.length-1));var o=-1;0!==l&&(a=!1);for(var d,u,p=[],h=[],c=0;c<n.length;c++){p[c]=[],d=n[c].split(","),o>-1&&d.length!=o&&(a=!1),o=d.length;for(var g=0;g<d.length;g++)u=d[g].replace(/^\s+/,"").replace(/\s+$/,""),""==u?(i=_("No elements of the matrix should be left blank."),p[c][g]="",h.push("")):(r+=syntaxcheckexpr(u,t),r+=singlevalsyntaxcheck(u,t),res=singlevaleval(u,t),r+=res[1],p[c][g]=res[0],h.push(res[0]));p[c]="("+p[c].join(",")+")"}return a||(r=_("Invalid matrix format")+". "),r+=i,{err:r,dispvalstr:"["+p.join(",")+"]",submitstr:h.join("|")}}function processNumfunc(e,t,a){var r,i,n=allParams[e],s=n.vars,l=n.fvars,c=n.domain,o=a.match(/equation/),d=a.match(/inequality/),u="",p=AMnumfuncPrepVar(e,t);i=a.match(/list/)?p[0].split(/,/):[p[0]];for(var h,g,m,f,v=0,y=0;y<i.length;y++){r=i[y],r=r.replace(/,/g,"").replace(/^\s+/,"").replace(/\s+$/,"").replace(/degree/g,"");var b=p[2].split("|");for(r.match(/(<=|>=|<|>)/)?(d?r.match(/(<=|>=|<|>)/g).length>1&&(u+=_("syntax error: your inequality should only contain one inequality symbol")+". "):u+=o?_("syntax error: you gave an inequality, not an equation")+". ":_("syntax error: you gave an inequality, not an expression")+". ",r=r.replace(/(.*)(<=|>=|<|>)(.*)/,"$1-($3)")):r.match(/=/)?(d?u+=_("syntax error: you gave an equation, not an inequality")+". ":o?r.match(/=/g).length>1&&(u+=_("syntax error: your equation should only contain one equal sign")+". "):u+=_("syntax error: you gave an equation, not an expression")+". ",r=r.replace(/(.*)=(.*)/,"$1-($2)")):o?u+=_("syntax error: this is not an equation")+". ":d&&(u+=_("syntax error: this is not an inequality")+". "),l.length>0&&(reg=new RegExp("("+l.join("|")+")\\(","g"),r=r.replace(reg,"$1*sin($1+")),r=prepWithMath(mathjs(r,b.join("|"))),v=0,g=0;g<20;g++){for(m="var DNE=1;",h=0;h<b.length-1;h++)f=c[h][2]?Math.floor(Math.random()*(c[h][0]-c[h][1]+1)+c[h][0]):Math.random()*(c[h][0]-c[h][1])+c[h][0],m+="var "+b[h]+"="+f+";";if("synerr"!==scopedeval(m+r)){v++;break}}0===v&&(u+=_("syntax error")+". "),u+=syntaxcheckexpr(p[0],a,s.map(escapeRegExp).join("|"))}return{err:u}}function simplifyVariable(e){return e.replace(/[^\w_\^\-+]/g,"")}function ineqtointerval(e,t){var a=simplifyVariable(t);if(e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1"),e.match(/all\s*real/i))return["(-oo,oo)"];if(e.match(/DNE/))return["DNE"];for(var r,i,n=[],s=e.split(/\s*or\s*/),l=0;l<s.length;l++)if(str=s[l],r=str.match(/^(.*?)(<=?|>=?)(.*?)(<=?|>=?)(.*?)$/)){if(simplifyVariable(r[3])!=a)return["","wrongvar"];if(r[2].charAt(0)!=r[4].charAt(0))return["","invalid"];if(""==r[1].trim()||""==r[5].trim())return["","invalid"];i="<"==r[2].charAt(0)?("<"==r[2]?"(":"[")+r[1]+","+r[5]+("<"==r[4]?")":"]"):(">"==r[4]?"(":"[")+r[5]+","+r[1]+(">"==r[2]?")":"]"),n.push(i)}else{if(!(r=str.match(/^(.*?)(<=?|>=?)(.*?)$/)))return["","invalid"];if(simplifyVariable(r[1])==a)i="<"==r[2].charAt(0)?"(-oo,"+r[3]+("<"==r[2]?")":"]"):(">"==r[2]?"(":"[")+r[3]+",oo)",n.push(i);else{if(simplifyVariable(r[3])!=a)return["","wrongvar"];i="<"==r[2].charAt(0)?("<"==r[2]?"(":"[")+r[1]+",oo)":"(-oo,"+r[1]+(">"==r[2]?")":"]"),n.push(i)}}return[n.join("U")]}function parsecomplex(e){var t,a,r,i,n,s,l;e=e.replace(/\s/,""),e=e.replace(/\((\d+\*?i|i)\)\/(\d+)/g,"$1/$2"),e=e.replace(/sin/,"s$n"),e=e.replace(/pi/,"p$");var c=e.length;if(e.split("i").length>2)return _("error - more than 1 i in expression");if(-1==(n=e.indexOf("i")))t=e,a="0";else{for(i=0,l=n-1;l>0;l--)if(")"==(r=e.charAt(l)))i++;else if("("==r)i--;else if(("+"==r||"-"==r)&&0==i)break;if(l<0&&(l=0),0!=i)return _("error - invalid form");for(i=0,s=n+1;s<c;s++)if("("==(r=e.charAt(s)))i++;else if(")"==r)i--;else if(("+"==r||"-"==r)&&0==i)break;if(0!=i)return _("error - invalid form");if(n-l>0&&s-n>0&&(s==c||0==l)){if(s==c)t=e.substr(0,l),a=e.substr(l,n-l);else{if(0!=l)return _("error - invalid form");t=e.substr(s),a=e.substr(0,n)}a+="*"+e.substr(n+1+("*"==e.charAt(n+1)?1:0),s-n-1),a=a.replace("-*","-1*").replace("+*","+1*"),a=a.replace(/(\+|-)1\*(.+)/g,"$1$2")}else if(n-l>1)a=e.substr(l,n-l),t=e.substr(0,l)+e.substr(n+1);else if(s-n>1)if(n>0){if("+"!=e.charAt(n-1)&&"-"!=e.charAt(n-1))return _("error - invalid form");a=e.charAt(n-1)+e.substr(n+1+("*"==e.charAt(n+1)?1:0),s-n-1),t=e.substr(0,n-1)+e.substr(s)}else a=e.substr(n+1,s-n-1),t=e.substr(0,n)+e.substr(s);else a="+"==e.charAt(l)?"1":"-"==e.charAt(l)?"-1":0==n?"1":e.charAt(l),t=(n>0?e.substr(0,l):"")+e.substr(n+1);""==t&&(t="0"),"/"==a.charAt(0)?a="1"+a:"+"!=a.charAt(0)&&"-"!=a.charAt(0)||"/"!=a.charAt(1)||(a=a.charAt(0)+"1"+a.substr(1)),"*"==a.charAt(a.length-1)&&(a=a.substr(0,a.length-1)),"+"==a.charAt(0)&&(a=a.substr(1)),"+"==t.charAt(0)&&(t=t.substr(1))}return t=t.replace("s$n","sin"),t=t.replace("p$","pi"),a=a.replace("s$n","sin"),a=a.replace("p$","pi"),a=a.replace(/\*\//g,"/"),[t,a]}function singlevalsyntaxcheck(e,t){if(e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1"),e.match(/DNE/i))return"";if(e.match(/-?\+?oo$/)||e.match(/-?\+?oo\W/))return"";if(e.match(/,/))return _("Invalid use of a comma.");if(-1!=t.indexOf("allowmixed")&&e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/))return"";if(-1!=t.indexOf("fracordec")){if(e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2").replace(/\s/g,""),!(e.match(/^\(?\-?\(?\d+\)?\/\(?\d+\)?$/)||e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)||e.match(/^\-?\d+$/)||e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/)))return _(" invalid entry format")+". "}else if(-1!=t.indexOf("fraction")||-1!=t.indexOf("reducedfraction")){if(e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2").replace(/\s/g,""),!e.match(/^\(?\-?\(?\d+\)?\/\(?\d+\)?$/)&&!e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)&&!e.match(/^\s*?\-?\d+\s*$/))return _("not a valid fraction")+". "}else if(-1!=t.indexOf("mixednumber")){if(!(e.match(/^\(?\-?\s*\(?\d+\)?\/\(?\d+\)?$/)||e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)||e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/)||e.match(/^\s*\-?\s*\d+\s*$/)))return _("not a valid mixed number")+". ";e=e.replace(/_/," ")}else if(-1!=t.indexOf("scinot")){if(e=e.replace(/\s/g,""),e=e.replace(/(xx|x|X|\u00D7)/,"xx"),!e.match(/^\-?[1-9](\.\d*)?(\*|xx)10\^(\(?\-?\d+\)?)$/)){if(-1==t.indexOf("scinotordec"))return _("not valid scientific notation")+". ";if(!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/))return _("not valid decimal or scientific notation")+". "}}else if(-1!=t.indexOf("decimal")&&-1==t.indexOf("nodecimal")){if(!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)([eE]\-?\d+)?$/))return _(" not a valid integer or decimal number")+". "}else if(!onlyAscii.test(e))return _("Your answer contains an unrecognized symbol")+". ";return""}function syntaxcheckexpr(e,t,a){var r="";-1!=t.indexOf("notrig")&&e.match(/(sin|cos|tan|cot|sec|csc)/i)?r+=_("no trig functions allowed")+". ":-1!=t.indexOf("nodecimal")&&-1!=e.indexOf(".")?r+=_("no decimals allowed")+". ":-1==t.indexOf("mixed")&&e.match(/\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/)?r+=_("mixed numbers are not allowed")+". ":-1==t.indexOf("allowdegrees")&&e.match(/degree/)&&(r+=_("no degree symbols allowed")+". ");for(var i=0,n=0,s=0,l=0;l<e.length;l++)"("==e.charAt(l)?i++:")"==e.charAt(l)?i--:"["==e.charAt(l)?n++:"]"==e.charAt(l)?n--:"|"==e.charAt(l)&&(s=1-s);if(0==i&&0==n||(r+=" ("+_("unmatched parens")+"). "),0!=s&&(r+=" ("+_("unmatched absolute value bars")+"). "),reg=a?new RegExp("(sqrt|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*("+a+"|\\d+)","i"):new RegExp("(sqrt|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*(\\d+)","i"),errstuff=e.match(reg),null!=errstuff&&(r+="["+_("use function notation")+" - "+_("use $1 instead of $2",errstuff[1]+"("+errstuff[2]+")",errstuff[0])+"]. "),a){var c="degree|arc|sqrt|root|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs|pi|sign|DNE|e|oo".split("|").concat(a.split("|"));c.sort(function(e,t){return t.length-e.length}),reg=new RegExp("(repvars\\d+|"+c.join("|")+")","ig"),e.replace(reg,"").match(/[a-zA-Z]/)&&(r+=_(" Check your variables - you might be using an incorrect one")+". ")}if((e.match(/\|/g)||[]).length>2)for(var o=/\|.*?\|\s*(.|$)/g;match=o.exec(e);)if(""!=match[1]&&match[1].match(/[^+\-\*\/\^\)]/)){r+=_(" You may want to use abs(x) instead of |x| for absolute values to avoid ambiguity")+". ";break}return e.match(/%/)&&!e.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(r+=_(" Do not use the percent symbol, %")+". "),r}function singlevaleval(e,t){if(e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1"),e.match(/,/))return[NaN,_("syntax incomplete")+". "];e.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(e=e.replace(/%/g,"")+"/100"),-1!=t.indexOf("mixed")&&(e=e.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),-1!=t.indexOf("allowxtimes")&&(e=e.replace(/(xx|x|X|\u00D7)/,"*")),-1!=t.indexOf("scinot")&&(e=e.replace("xx","*"));try{var a=scopedmatheval(e);return""===a?[NaN,_("syntax incomplete")+". "]:[a,""]}catch(e){return[NaN,_("syntax incomplete")+". "]}}function escapeRegExp(e){return e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function scopedeval(c){try{return eval(c)}catch(e){return"synerr"}}function scopedmatheval(c){if(c.match(/^\s*[a-df-zA-Z]\s*$/))return"";try{return eval(prepWithMath(mathjs(c)))}catch(e){return""}}var allParams={},LivePreviews=[],MQsyntaxtimer=null,greekletters=["alpha","beta","chi","delta","epsilon","gamma","varphi","phi","psi","sigma","rho","theta","lambda","mu","nu","omega","tau"],onlyAscii=/^[\u0000-\u007f]*$/;return{init:init,clearparams:clearparams,preSubmitForm:preSubmitForm,preSubmit:preSubmit,preSubmitString:preSubmitString,clearLivePreviewTimeouts:clearLivePreviewTimeouts,syntaxCheckMQ:syntaxCheckMQ,clearTips:clearTips,handleMQenter:handleMQenter}}(jQuery),AutoSuggestIdCounter=0,autoSuggestLists={},autoSuggestObjects={};document.write=function(){};
