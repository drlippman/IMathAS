var tipobj,curtipel,popupwins,GB_loaded,tinyMCEPreInit,recordedunload,videoembedcounter,fileembedcounter,sagecellcounter,closetimer=0,ddmenuitem=0,homemenuloaded=0;function mopen(e,t){"homemenu"==e&&0==homemenuloaded&&(basicahah(imasroot+"/gethomemenu.php?cid="+t,"homemenu"),homemenuloaded=1),mcancelclosetime(),ddmenuitem?(ddmenuitem.style.visibility="hidden",ddmenuitem=null):(ddmenuitem=document.getElementById(e)).style.visibility="visible"}function mclose(){ddmenuitem&&(ddmenuitem.style.visibility="hidden",ddmenuitem=null)}function mclosetime(){closetimer=window.setTimeout(mclose,250)}function mcancelclosetime(){closetimer&&(window.clearTimeout(closetimer),closetimer=null)}function basicahah(e,t,i){null==i&&(i=" Fetching data... "),document.getElementById(t).innerHTML=i;var n=!1;window.XMLHttpRequest?(req=new XMLHttpRequest,n=!0):window.ActiveXObject&&(req=new ActiveXObject("Microsoft.XMLHTTP"),n=!0),n&&(req.onreadystatechange=function(){basicahahDone(e,t)},req.open("GET",e,!0),req.send(""))}function basicahahDone(e,t){4==req.readyState&&(200==req.status?document.getElementById(t).innerHTML=req.responseText:document.getElementById(t).innerHTML=" AHAH Error:\n"+req.status+"\n"+req.statusText)}function arraysearch(e,t){for(var i=0;i<t.length;i++)if(t[i]==e)return i;return-1}function tipshow(e,t,i){var n,a;if(void 0!==i&&"touchstart"==i.type){if(curtipel==e)return tipout(),!1;jQuery(document).on("touchstart.tipshow",function(){tipout(e)})}curtipel!=e&&("object"!=typeof tipobj&&(tipobj=document.createElement("div"),window.imathasAssess?tipobj.className="dropdown-pane tooltip-pane":tipobj.className="tips",tipobj.setAttribute("role","tooltip"),tipobj.id="hovertipsholder",document.getElementsByTagName("body")[0].appendChild(tipobj)),(curtipel=e).hasAttribute("data-tip")?tipobj.innerHTML=e.getAttribute("data-tip"):tipobj.innerHTML=t,tipobj.style.left="5px",$(tipobj).stop(!0,!0).fadeIn(100),tipobj.setAttribute("aria-hidden","false"),e.setAttribute("aria-describedby","hovertipsholder"),"undefined"!=typeof usingASCIIMath&&"undefined"!=typeof noMathRender&&usingASCIIMath&&!noMathRender&&-1!=tipobj.innerHTML.indexOf("`")&&rendermathnode(tipobj),n=findPos(e),self.innerHeight?x=self.innerWidth:document.documentElement&&document.documentElement.clientHeight?x=document.documentElement.clientWidth:document.body&&(x=document.body.clientWidth),a=0,"number"==typeof window.pageYOffset?a=window.pageXOffset:document.body&&(document.body.scrollLeft||document.body.scrollTop)?a=document.body.scrollLeft:document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)&&(a=document.documentElement.scrollLeft),x+=a,n[0]+tipobj.offsetWidth>x-10?(n[0]=x-tipobj.offsetWidth-30,$(tipobj).addClass("tipright")):$(tipobj).removeClass("tipright"),tipobj.style.left=n[0]+15+"px",n[1]<30?tipobj.style.top=n[1]+20+"px":tipobj.style.top=n[1]-tipobj.offsetHeight+"px")}function tipout(e){jQuery(document).off("touchstart.tipshow"),$(tipobj).fadeOut(100),tipobj.setAttribute("aria-hidden","true"),curtipel&&curtipel.removeAttribute("aria-describedby"),curtipel=null}function popupwindow(e,t,i,n,a){var o,r;"fit"==n&&(n=window.height-80),o="width="+i+",height="+n+",status=0,resizable=1,directories=0,menubar=0",null!=a&&1==a&&(o+=",scrollbars=1"),void 0===popupwins[e]||popupwins[e].closed||popupwins[e].focus(),t.match(/^http/)?popupwins[e]=window.open(t,e,o):((r=window.open("",e,o)).document.write("<html><head><title>Popup</title></head><body>"),r.document.write(t),r.document.write("</body></html>"),r.document.close(),popupwins[e]=r)}function findPos(e){var t=curtop=0;if(e.offsetParent)for(;t+=e.offsetLeft,curtop+=e.offsetTop,e.offsetParent&&(e.parentNode&&e.offsetParent!=e.parentNode?(t-=e.parentNode.scrollLeft,curtop-=e.parentNode.scrollTop):(t-=e.offsetParent.scrollLeft,curtop-=e.offsetParent.scrollTop)),e=e.offsetParent;);return[t,curtop]}function togglepic(e){e.getAttribute("src").match("userimg_sm")?e.setAttribute("src",e.getAttribute("src").replace("_sm","_")):e.setAttribute("src",e.getAttribute("src").replace("_","_sm"))}function addLoadEvent(e){var t=window.onload;"function"!=typeof window.onload?window.onload=e:window.onload=function(){t&&t(),e()}}function submitlimiter(e){var t=e.target;return"submitted"==t.className?(alert("You have already submitted this page.  Please be patient while your submission is processed."),t.className="submitted2",e.preventDefault?e.preventDefault():e.returnValue=!1,!1):"submitted2"==t.className?(e.preventDefault?e.preventDefault():e.returnValue=!1,!1):(t.className="submitted",!0)}function setupFormLimiters(){var e,t=document.getElementsByTagName("form");for(e=0;e<t.length;e++)"function"==typeof t[e].onsubmit||t[e].className.match(/(nolimit|limitaftervalidate)/)||$(t[e]).on("submit",submitlimiter)}function GB_move(e){var t,i,n,a;e.preventDefault(),n="touchmove"==e.type?(i=(t=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0]).pageX,t.pageY):(i=e.pageX,e.pageY),(a=jQuery("#GB_window")).css("left",Math.max(0,a.data("original_x")+(i-a.data("original_mouse_x")))).css("top",Math.max(0,a.data("original_y")+(n-a.data("original_mouse_y"))))}function GB_drop(e){jQuery(window).off("touchmove.GBmove touchend.GBmove mousemove.GBmove mouseup.GBmove"),jQuery("#GB_frameoverlay").remove(),jQuery("body").css("user-select","")}function GB_resize(e){var t,i,n,a,o,r,s;e.preventDefault(),n="touchmove"==e.type?(i=(t=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0]).pageX,t.pageY):(i=e.pageX,e.pageY),i=Math.max(0,Math.min(i,document.documentElement.clientWidth-5)),n=Math.max(0,Math.min(n,document.documentElement.clientHeight-5)),o=i-(a=jQuery("#GB_window")).data("original_mouse_x"),r=n-a.data("original_mouse_y"),a[0].hasAttribute("data-lockratio")&&(s=a.data("original_h")/a.data("original_w"),(a.data("original_h")+r)/(a.data("original_w")+o)>s?r=s*(a.data("original_w")+o)-a.data("original_h"):o=(a.data("original_h")+r)/s-a.data("original_w")),a.css("width",Math.max(0,a.data("original_w")+o)).css("height",Math.max(0,a.data("original_h")+r)),$("#GB_frameholder").css("height",Math.max(0,a.data("original_h")+r)-36)}function GB_endresize(e){jQuery(window).off("touchmove.GBresize touchend.GBresize mousemove.GBresize mouseup.GBresize"),jQuery("#GB_frameoverlay").remove(),jQuery("body").css("user-select","")}function GB_show(e,t,i,n,a,o,r){var s,l,d,c,u,p,m,h;if(o=o||"",0==GB_loaded&&((s=document.createElement("div")).id="GB_overlay",s.onclick=GB_hide,document.getElementsByTagName("body")[0].appendChild(s),(l=document.createElement("div")).setAttribute("role","dialog"),l.setAttribute("aria-labelledby","GB_title"),l.setAttribute("tabindex",-1),l.id="GB_window",l.innerHTML='<div id="GB_caption"></div><div id="GB_loading">Loading...</div><div id="GB_frameholder" ></div><div id="GB_resizehandle"></div>',document.getElementsByTagName("body")[0].appendChild(l),GB_loaded=!0,jQuery("#GB_caption").on("mousedown touchstart",function(e){var t,i;"input"!=e.target.nodeName.toLowerCase()&&"button"!=e.target.nodeName.toLowerCase()&&"a"!=e.target.nodeName.toLowerCase()&&(t=document.getElementById("GB_window"),"touchstart"==e.type&&(i=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0]),jQuery("#GB_window").data("original_x",t.getBoundingClientRect().left).data("original_y",t.getBoundingClientRect().top).data("original_mouse_x","touchstart"==e.type?i.pageX:e.pageX).data("original_mouse_y","touchstart"==e.type?i.pageY:e.pageY).css("left",t.getBoundingClientRect().left).css("top",t.getBoundingClientRect().top).css("margin",0).css("right","").css("width",$(t).width()),jQuery("#GB_window").append($("<div/>",{id:"GB_frameoverlay"})),jQuery("body").css("user-select","none"),"touchstart"==e.type?jQuery(window).on("touchmove.GBmove",GB_move).on("touchend.GBmove",GB_drop):jQuery(window).on("mousemove.GBmove",GB_move).on("mouseup.GBmove",GB_drop))}),jQuery("#GB_resizehandle").on("mousedown touchstart",function(e){var t,i;"touchstart"==e.type&&(t=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0]),i=document.getElementById("GB_window"),jQuery("#GB_window").css("left",i.getBoundingClientRect().left).css("top",i.getBoundingClientRect().top).css("margin",0).css("right","").data("original_w",$(i).width()).data("original_h",$(i).height()).data("original_mouse_x","touchstart"==e.type?t.pageX:e.pageX).data("original_mouse_y","touchstart"==e.type?t.pageY:e.pageY),jQuery("#GB_window").append($("<div/>",{id:"GB_frameoverlay"})),jQuery("body").css("user-select","none"),"touchstart"==e.type?jQuery(window).on("touchmove.GBresize",GB_resize).on("touchend.GBresize",GB_endresize):jQuery(window).on("mousemove.GBresize",GB_resize).on("mouseup.GBresize",GB_endresize)})),document.getElementById("GB_loading").style.display="block","<"==t.charAt(0)?(document.getElementById("GB_frameholder").innerHTML="<div>"+t+"</div>",t.match(/data-enlarged/)&&jQuery("#GB_window").attr("data-lockratio",1),setTimeout(GB_doneload,50)):document.getElementById("GB_frame")&&document.getElementById("GB_frame").src.replace(/\/$/,"")==t.replace(/\/$/,"")?document.getElementById("GB_loading").style.display="none":document.getElementById("GB_frameholder").innerHTML='<iframe onload="GB_doneload()" id="GB_frame" src="'+t+'" title="'+e+'"></iframe>',jQuery("#GB_frameholder").isolatedScroll(),c=t.match(/libtree/)?(d='<span class="floatright"><input type="button" value="Use Libraries" onClick="document.getElementById(\'GB_frame\').contentWindow.setlib()" /> ',d+='<a href="#" class="pointer" onclick="GB_hide();return false;" aria-label="Close">[X]</a>&nbsp;</span><span id="GB_title">Select Libraries</span><div class="clear"></div>',document.getElementById("GB_caption").innerHTML=d,self.innerHeight||de&&de.clientHeight||document.body.clientHeight):t.match(/assessselect/)?(d='<span class="floatright"><input type="button" value="Use Assessments" onClick="document.getElementById(\'GB_frame\').contentWindow.setassess()" /> ',d+='<a href="#" class="pointer" onclick="GB_hide();return false;" aria-label="Close">[X]</a>&nbsp;</span><span id="GB_title">Select Assessments</span><div class="clear"></div>',document.getElementById("GB_caption").innerHTML=d,self.innerHeight||de&&de.clientHeight||document.body.clientHeight):(document.getElementById("GB_caption").innerHTML='<span class="floatright"><a href="#" class="pointer" onclick="GB_hide();return false;" aria-label="Close">[X]</a></span><span id="GB_title">'+e+"</span>",document.getElementById("GB_caption").onclick=GB_hide,"auto"==n?self.innerHeight||de&&de.clientHeight||document.body.clientHeight:n),document.getElementById("GB_window").style.display="block",document.getElementById("GB_overlay").style.display=!1!==a?"block":"none",(u=$(document).width())-20<i&&(i=u-20),!o.match(/noreset/)||!jQuery("#GB_window").data("original_mouse_x")||""==document.getElementById("GB_window").style.left){if(p="","object"==typeof r)for(h in r)if(m=document.getElementById(r[h])){p=m.getBoundingClientRect().bottom+10,"auto"==n&&(c=window.self!==window.top?Math.min(600,self.innerHeight):self.innerHeight,c=Math.max(200,c-p-20));break}$("#GB_window").css("margin","").css("left","").css("top",p),o.match(/left/)&&""==document.getElementById("GB_window").style.left?($("body").hasClass("fw1000")&&1e3<u&&(i+=(u-1e3)/2),$("body").hasClass("fw1920")&&1920<u&&(i+=(u-1920)/2),$("#GB_window").css("left",i).css("width","auto").css("right",20).css("margin","0"),i=u-i-20):document.getElementById("GB_window").style.width=i+"px",document.getElementById("GB_window").style.height=c-30+"px","<"!=t.charAt(0)?document.getElementById("GB_frameholder").style.height=c-30-36+"px":document.getElementById("GB_frameholder").style.height="auto"}document.getElementById("GB_window").focus(),$(document).on("keydown.GB",function(e){27==e.keyCode&&GB_hide()})}function GB_doneload(){document.getElementById("GB_loading").style.display="none"}function GB_hide(){document.getElementById("GB_window").style.display="none",document.getElementById("GB_overlay")&&(document.getElementById("GB_overlay").style.display="none"),$(document).off("keydown.GB")}function chkAllNone(e,t,n,a){var o=document.getElementById(e);for(i=0;i<=o.elements.length;i++)try{("all"==t&&"checkbox"==o.elements[i].type||o.elements[i].name==t)&&(a&&o.elements[i].className==a?o.elements[i].checked=!n:o.elements[i].checked=n)}catch(e){}return!1}function initeditor(e,t,i,n,a){var o,r=i||0,s=n||0,l="";"exact"==e?l="#"+t.split(/,/).join(",#"):"textareas"==e?l="textarea."+t:"divs"==e?l="div."+t:"selector"==e&&(l=t),o={selector:l,inline:s,plugins:["lists advlist autolink attach image charmap anchor","searchreplace code link textcolor snippet","media table paste rollups colorpicker"],external_plugins:{asciimath:imasroot+"/tinymce4/plugins/asciimath/plugin.min.js",asciisvg:imasroot+"/tinymce4/plugins/asciisvg/plugin.min.js"},menubar:!1,toolbar1:"myEdit myInsert styleselect | bold italic underline subscript superscript | forecolor backcolor | snippet code | saveclose",toolbar2:" alignleft aligncenter alignright | bullist numlist outdent indent  | attach link unlink image | table | asciimath asciimathcharmap asciisvg",extended_valid_elements:"iframe[src|width|height|name|align|allowfullscreen|frameborder|style|class],param[name|value],@[sscr]",content_css:staticroot+(1==r?"/assessment/mathtest.css,":"/imascore.css,")+staticroot+"/themes/"+coursetheme,AScgiloc:imasroot+"/filter/graph/svgimg.php",convert_urls:!1,file_picker_callback:filePickerCallBackFunc,file_picker_types:"file image",images_upload_url:imasroot+"/tinymce4/upload_handler.php",paste_data_images:!0,default_link_target:"_blank",browser_spellcheck:!0,branding:!1,resize:"both",width:"100%",content_style:"body {background-color: "+(coursetheme.match(/_dark/)?"#000":"#fff")+" !important;}",table_class_list:[{title:"None",value:""},{title:"Gridded",value:"gridded"},{title:"Gridded Centered",value:"gridded centered"}],style_formats_merge:!0,snippets:1==tinymceUseSnippets&&imasroot+"/tinymce4/getsnippets.php",autolink_pattern:/^(https?:\/\/|www\.)(.+)$/i,style_formats:[{title:"Font Family",items:[{title:"Arial",inline:"span",styles:{"font-family":"arial"}},{title:"Book Antiqua",inline:"span",styles:{"font-family":"book antiqua"}},{title:"Comic Sans MS",inline:"span",styles:{"font-family":"comic sans ms,sans-serif"}},{title:"Courier New",inline:"span",styles:{"font-family":"courier new,courier"}},{title:"Georgia",inline:"span",styles:{"font-family":"georgia,palatino"}},{title:"Helvetica",inline:"span",styles:{"font-family":"helvetica"}},{title:"Impact",inline:"span",styles:{"font-family":"impact,chicago"}},{title:"Open Sans",inline:"span",styles:{"font-family":"Open Sans"}},{title:"Symbol",inline:"span",styles:{"font-family":"symbol"}},{title:"Tahoma",inline:"span",styles:{"font-family":"tahoma"}},{title:"Terminal",inline:"span",styles:{"font-family":"terminal,monaco"}},{title:"Times New Roman",inline:"span",styles:{"font-family":"times new roman,times"}},{title:"Verdana",inline:"span",styles:{"font-family":"Verdana"}}]},{title:"Font Size",items:[{title:"x-small",inline:"span",styles:{fontSize:"x-small","font-size":"x-small"}},{title:"small",inline:"span",styles:{fontSize:"small","font-size":"small"}},{title:"medium",inline:"span",styles:{fontSize:"medium","font-size":"medium"}},{title:"large",inline:"span",styles:{fontSize:"large","font-size":"large"}},{title:"x-large",inline:"span",styles:{fontSize:"x-large","font-size":"x-large"}},{title:"xx-large",inline:"span",styles:{fontSize:"xx-large","font-size":"xx-large"}}]}]},document.documentElement.clientWidth<385?(o.toolbar1="myEdit myInsert styleselect | bold italic underline | saveclose",o.toolbar2="bullist numlist outdent indent  | link image | asciimath asciisvg"):document.documentElement.clientWidth<465?(o.toolbar1="myEdit myInsert styleselect | bold italic underline forecolor | saveclose",o.toolbar2="bullist numlist outdent indent  | link unlink image | asciimath asciisvg"):document.documentElement.clientWidth<575&&(o.toolbar1="myEdit myInsert styleselect | bold italic underline subscript superscript | forecolor | saveclose",o.toolbar2=" alignleft aligncenter | bullist numlist outdent indent  | link unlink image | asciimath asciimathcharmap asciisvg"),a&&(o.setup=a),tinymce.remove(l),tinymce.init(o)}function filePickerCallBack(i,e,t){var n=imasroot+"/tinymce4/file_manager.php";switch(t.filetype){case"image":n+="?type=img";break;case"file":n+="?type=files"}tinyMCE.activeEditor.windowManager.open({file:n,title:"File Manager",width:350,height:450,resizable:"yes",inline:"yes",close_previous:"no"},{oninsert:function(e,t){i(e)}})}function imascleanup(e,t){return"get_from_editor"==e&&(t=(t=(t=(t=(t=t.replace(/<!--([\s\S]*?)-->|&lt;!--([\s\S]*?)--&gt;|<style>[\s\S]*?<\/style>/g,"")).replace(/class="?Mso\w+"?/g,"")).replace(/<p\s*>\s*<\/p>/gi,"")).replace(/<script.*?\/script>/gi,"")).replace(/<input[^>]*button[^>]*>/gi,"")),t}function readCookie(e){var t,i,n=e+"=",a=document.cookie.split(";");for(t=0;t<a.length;t++){for(i=a[t];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(n))return unescape(i.substring(n.length,i.length))}return null}function selectByDivID(e){var t,i,n=e.value,a=e.value.split(":")[0],o=document.getElementsByTagName("div");for(t=0;t<o.length;t++)o[t].className.match(a)&&(o[t].style.display=o[t].id==n?"block":"none");(i=new Date).setDate(i.getDate()+365),document.cookie=a+"store="+escape(n)+";expires="+i.toGMTString()}function setselectbycookie(){var e,t,i=document.getElementsByTagName("select");for(e=0;e<i.length;e++)i[e].className.match("alts")&&(t=i[e].className.replace(/alts/,"").replace(/\s/g,""),null!=(co=readCookie(t+"store"))&&(co=co.replace("store",""),i[e].value=co,selectByDivID(i[e])))}function recclick(e,t,i,n){if(0<cid){var a,o="";null!==(a=window.location.href.match(/showlinkedtext.*?&id=(\d+)/))&&0==recordedunload&&(o="&unloadinglinked="+a[1],recordedunload=!0),jQuery.ajax({type:"POST",url:imasroot+"/course/rectrack.php?cid="+cid,data:"type="+encodeURIComponent(e)+"&typeid="+encodeURIComponent(t)+"&info="+encodeURIComponent(i+"::"+n)+o})}}function setuptracklinks(e,i){jQuery(i).attr("data-base")&&jQuery(i).off("click.recclick").on("click.recclick",function(e){var t=jQuery(this).attr("data-base").split("-");if(recclick(t[0],t[1],jQuery(this).attr("href"),jQuery(this).clone().find(".sr-only").remove().end().text()),void 0===jQuery(i).attr("target"))return e.preventDefault(),setTimeout('window.location.href = "'+jQuery(this).attr("href")+'"',100),!1}).off("mousedown.recclick").on("mousedown.recclick",function(e){if(3==e.which){var t=jQuery(this).attr("data-base").split("-");recclick(t[0],t[1],jQuery(this).attr("href"),jQuery(this).clone().find(".sr-only").remove().end().text())}})}function togglevideoembed(){var e,t,i,n,a,o,r,s,l,d,c,u=this.id.substr(13),p=jQuery("#videoiframe"+u);0<p.length?"none"==p.css("display")?(p.show(),p.parent(".fluid-width-video-wrapper").show(),jQuery(this).text(" [-]").attr("title",_("Hide video")).attr("aria-label",_("Hide embedded video"))):(p.hide(),p.get(0).contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*"),p.parent(".fluid-width-video-wrapper").hide(),jQuery(this).text(" [+]"),jQuery(this).attr("title",_("Watch video here")),jQuery(this).attr("aria-label",_("Embed video")+" "+jQuery(this).prev().text())):(t="?",(e=(e=jQuery(this).prev().attr("href")).replace(/%3F/g,"?").replace(/%3D/g,"=")).match(/youtube\.com/)?-1<e.indexOf("playlist?list=")?(i=e.split("list=")[1].split(/[#&]/)[0],n="www.youtube.com/embed/videoseries?list=",t="&"):n=(i=e.match(/\/embed\//)?e.split("/embed/")[1].split(/[#&\?]/)[0]:e.split("v=")[1].split(/[#&]/)[0],"www.youtube.com/embed/"):e.match(/youtu\.be/)?(i=e.split(".be/")[1].split(/[#&]/)[0],n="www.youtube.com/embed/"):e.match(/vimeo/)&&(i=e.split(".com/")[1].split(/[#&]/)[0],n="player.vimeo.com/video/"),null==(a=e.match(/.*\Wt=((\d+)m)?((\d+)s)?.*/))?(o=t+"rel=0",null!=(a=e.match(/.*start=(\d+)/))&&(o+="&start="+a[1])):o=t+"rel=0&start="+((a[2]?60*a[2]:0)+(a[4]?1*a[4]:0)),null!=(a=e.match(/.*end=(\d+)/))&&(o+="&end="+a[1]),o+="&enablejsapi=1",r="https:"==location.protocol?"https:":"http:",s=jQuery("<iframe/>",{id:"videoiframe"+u,width:640,height:400,src:r+"//"+n+i+o,frameborder:0,allowfullscreen:1}),0==(l=jQuery(this)).closest(".itemhdr").length?(s.insertAfter(l),l.parent().fitVids(),jQuery("<br/>").insertAfter(l)):((d=l.closest(".itemhdr").next()).prepend(s),d.fitVids()),l.text(" [-]").attr("title",_("Hide video")).attr("aria-label",_("Hide embedded video")),l.prev().attr("data-base")&&recclick((c=l.prev().attr("data-base").split("-"))[0],c[1],e,l.prev().text()))}function setupvideoembeds(e,t){jQuery("<span/>",{text:" [+]",role:"button",title:_("Watch video here"),"aria-label":_("Embed video")+" "+this.textContent,id:"videoembedbtn"+videoembedcounter,click:togglevideoembed,keydown:function(e){13==e.which&&$(this).click()},tabindex:0,class:"videoembedbtn"}).insertAfter(t),jQuery(t).addClass("prepped"),videoembedcounter++}function setuppreviewembeds(e,t){var i,n="doc|docx|pdf|xls|xlsx|ppt|pptx|jpg|gif|png|jpeg";window.fetch&&(n+="|heic"),i=new RegExp(".("+n+")($|\\?)","i"),t.href.match(i)&&(jQuery("<span/>",{text:" [+]",role:"button",title:_("Preview file"),"aria-label":_("Preview file"),id:"fileembedbtn"+fileembedcounter,click:togglefileembed,keydown:function(e){13==e.which&&$(this).click()},tabindex:0,class:"videoembedbtn"}).insertAfter(t),jQuery(t).addClass("prepped"),fileembedcounter++)}function supportsPdf(){var e=window.navigator.userAgent;return-1!==e.indexOf("irefox")&&18<parseInt(e.split("rv:")[1].split(".")[0],10)||void 0!==navigator.mimeTypes["application/pdf"]}function togglefileembed(){var e,t,i,n=this.id.substr(12),a=jQuery("#fileiframe"+n);0<a.length?"none"==a.css("display")?(a.show(),jQuery(this).text(" [-]"),jQuery(this).attr("title",_("Hide preview")),jQuery(this).attr("aria-label",_("Hide file preview"))):(a.hide(),jQuery(this).text(" [+]"),jQuery(this).attr("title",_("Preview file")),jQuery(this).attr("aria-label",_("Preview file"))):((e=jQuery(this).prev().attr("href")).match(/\.(doc|docx|pdf|xls|xlsx|ppt|pptx)($|\?)/i)?(t=e.match(/\.pdf/)&&supportsPdf()?e:e.match(/\.(doc|docx|xls|xlsx|ppt|pptx)($|\?)/i)?"https://view.officeapps.live.com/op/embed.aspx?src="+encodeURIComponent(e):"https://docs.google.com/gview?embedded=true&url="+encodeURIComponent(e),jQuery("<iframe/>",{id:"fileiframe"+n,width:"90%",height:600,src:t,frameborder:0,allowfullscreen:1}).insertAfter(jQuery(this))):e.match(/\.(heic)($|\?)/i)?(jQuery("<div>",{id:"fileiframe"+n,text:"Converting HEIC file (this may take a while)..."}).insertAfter(jQuery(this)),window.heic2any?convertheic(e,"fileiframe"+n):jQuery.getScript(staticroot+"/javascript/heic2any.min.js").done(function(){convertheic(e,"fileiframe"+n)})):jQuery("<div>").append(jQuery("<img/>",{id:"fileiframe"+n,src:e}).css("display","block").on("click",rotateimg)).insertAfter(jQuery(this)),jQuery("<br/>").insertAfter(jQuery(this)),jQuery(this).text(" [-]"),jQuery(this).attr("title",_("Hide preview")),jQuery(this).prev().attr("data-base")&&recclick((i=jQuery(this).prev().attr("data-base").split("-"))[0],i[1],e,jQuery(this).prev().text()))}function convertheic(e,i){fetch(e).then(function(e){return e.blob()}).then(function(e){return heic2any({blob:e})}).then(function(e){var t=URL.createObjectURL(e);document.getElementById(i).innerHTML='<img src="'+t+'" onclick="rotateimg(this)">'}).catch(function(e){console.log(e)})}function addNoopener(e,t){!t.rel&&t.target&&t.host!==window.location.host&&t.setAttribute("rel","noopener noreferrer"),t.target&&0==jQuery(t).find(".openext").length&&jQuery(t).append('<span class="sr-only openext">Opens externally</span>')}function addBlankTarget(e,t){t.host!==window.location.host&&t.setAttribute("target","_blank")}function uniqid(e){return(e||"")+"_"+Math.random().toString(36).substr(2,9)}function setariastatus(e){var t=document.getElementById("ariastatus");t||(t=$("<div>",{id:"ariastatus",role:"status",class:"sr-only","aria-live":"polite"}),$("body").append(t),t=t[0]),t.innerHTML=e}function addmultiselect(e,t){var i=jQuery(e).parent(),n=jQuery("#"+t).val(),a=jQuery("#"+t+" option[value="+n+"]").prop("disabled",!0).html();"null"!=n&&i.append('<div class="multiselitem"><span class="right"><a href="#" onclick="removemultiselect(this);return false;">Remove</a></span><input type="hidden" name="'+t+'[]" value="'+n+'"/>'+a+"</div>"),jQuery("#"+t).val("null")}function removemultiselect(e){var t=jQuery(e).parent().parent(),i=t.find("input").val();t.parent().find("option[value="+i+"]").prop("disabled",!1),t.remove()}function hidefromcourselist(t,e,i){return confirm("Are you SURE you want to hide this course from your course list?")&&jQuery.ajax({type:"GET",url:imasroot+"/admin/hidefromcourselist.php?tohide="+e+"&type="+i}).done(function(e){"OK"==e&&(jQuery(t).closest("ul.courselist > li").slideUp(),jQuery("#unhidelink"+i).show())}),!1}function removeSelfAsCoteacher(t,e,i,n){return i=i||"ul.courselist > li",n=n||null,confirm("Are you SURE you want to remove yourself as a co-teacher on this course?")&&jQuery.ajax({type:"POST",url:imasroot+"/admin/actions.php",data:{action:"removeself",id:e,uid:n}}).done(function(e){"OK"==e&&jQuery(t).closest(i).slideUp()}),!1}function rotateimg(e){var t,i,n,a;e.hasOwnProperty("target")&&(e=e.target),t=$(e).data("rotation")?($(e).data("rotation")+90)%360:90,$(e).parent().css("height","auto"),a=$(e).parent().width(),$(e).data("rotation",t).css({transform:"rotate("+t+"deg)"}),t%180==90?($(e).css("transform-origin","0 0").css("max-width","none"),n=(i=e.getBoundingClientRect()).width>a?.95*a/i.width:1,90==t?$(e).data("rotation",t).css({transform:"rotate("+t+"deg) scale("+n+") translateY("+-i.width+"px) "}):$(e).data("rotation",t).css({transform:"rotate("+t+"deg) scale("+n+") translateX("+-i.height+"px) "}),i=e.getBoundingClientRect(),$(e).parent().css("height",i.height)):($(e).css("transform-origin","").css("max-width","80%"),$(e).parent().css("height",""))}function sendLTIresizemsg(){var e=Math.max(document.body.scrollHeight,document.body.offsetHeight)+100;window.parent!=window.self&&parent.postMessage(JSON.stringify({subject:"lti.frameResize",height:e}),"*")}function initlinkmarkup(e){"undefined"!=typeof isImathasAssessment&&$(e).find("a:not([target])").not(".textsegment a, .mce-content-body a").each(addBlankTarget),$(e).find("a").each(setuptracklinks).each(addNoopener),$(e).find('a[href*="youtu"]').not(".textsegment a,.mce-content-body a,.prepped").each(setupvideoembeds),$(e).find('a[href*="vimeo"]').not(".textsegment a,.mce-content-body a,.prepped").each(setupvideoembeds),$(e).find("a.attach").not(".textsegment a,.mce-content-body a").not(".prepped").each(setuppreviewembeds),setupToggler(e),setupToggler2(e),$(e).fitVids(),resizeResponsiveIframes(e,!0)}function resizeResponsiveIframes(e,t){t&&jQuery(e).find("iframe.scaleresponsive").wrap(jQuery("<div>",{css:{overflow:"hidden"}})),jQuery(e).find("iframe.scaleresponsive").each(function(e,t){var i=t.parentNode,n=Math.min(1,i.offsetWidth/parseInt(t.width||t.style.width));t.style.transform="scale("+n+")",i.style.height=n*parseInt(t.height||t.style.height)+3+"px"})}function _(e){var t,i;if(t="undefined"!=typeof i18njs&&i18njs[e]?i18njs[e]:e,1<arguments.length)for(i=1;i<arguments.length;i++)t=t.replace("$"+i,arguments[i]);return t}function randID(){return"_"+Math.random().toString(36).substr(2,9)}function setupToggler(e){$(e).find("*[data-toggler]:not(.togglerinit)").each(function(){var i,n,a,e,t=$(this).attr("id")||randID();"IFRAME"===$(this).prop("tagName")&&$(this).css("display","block"),i="block"==$(this).css("display"),n=$(this).attr("data-toggler"),a=$(this).attr("data-toggler-hide")||n,e=$("<button>",{id:"togbtn"+t,type:"button",text:n,"aria-controls":t}),$(this).hide().attr("id",t).addClass("togglerinit").before(e),e.attr("aria-expanded",!1).attr("tabindex",0).css("cursor","pointer").on("click keydown",function(e){if("click"==e.type||13==e.which){var t=$("#"+$(this).attr("aria-controls"));"true"==$(this).attr("aria-expanded")?($(this).attr("aria-expanded",!1).text(n),i?t.slideUp(300):t.hide()):($(this).attr("aria-expanded",!0).text(a),i?t.slideDown(300):t.show())}})})}function setupToggler2(e){$(e).find(".togglecontrol:not(.togglerinit)").each(function(){$(this).addClass("togglerinit").attr("aria-expanded",!1).on("click keydown",function(e){if("click"==e.type||13==e.which){var t=$("#"+$(this).attr("aria-controls"));return"true"==$(this).attr("aria-expanded")?($(this).attr("aria-expanded",!1),t.hide()):($(this).attr("aria-expanded",!0),t.show()),!1}})})}function groupToggleAll(e){$(".grouptoggle").attr("aria-expanded",1!=e).trigger("click")}function initFileAlt(e){var n=jQuery(e).next().find(".filealt-label"),t=n.attr("data-def")||n.html();jQuery(e).off("focus.filealt, blur.filealt, click.filealt, change.filealt").on("focus.filealt",function(e){jQuery(e.target).addClass("has-focus")}).on("blur.filealt",function(e){jQuery(e.target).removeClass("has-focus")}).on("click.filealt",function(e){n.html(t)}).on("change.filealt",function(e){var t,i="";(i=e.target.value.split(/(\\|\/)/g).pop())&&(t=1024e4,this.files[0].size>t?(alert(_("This file is too large - maximum size is 10MB")),$(this).val("")):n.html(i))})}function setAltSelectors(e,t){$(".alts."+e).parents(".altWrap").find(".altContentOn").removeClass("altContentOn").addClass("altContentOff"),$(".alts."+e).parents(".altWrap").find("."+t).addClass("altContentOn").removeClass("altContentOff"),$("select.alts."+e).val(e+":"+t);var i=new Date;i.setDate(i.getDate()+365),document.cookie="alt_store_"+e+"="+escape(t)+";expires="+i.toGMTString()+";path=/"}function initSageCell(e){jQuery(e).find(".converttosagecell").each(function(){var e,t,i,n,a,o,r=jQuery(this);if(r.is("pre"))e=this,t=jQuery(e).html().replace(/<br\s*\/?>/g,"\n").replace(/<\/?[a-zA-Z][^>]*>/g,"").replace(/&lt;/g,"<").replace(/&gt;/g,">");else if(0==(e=r.find("textarea")).length||""==jQuery(e[0]).val()){if(!(0<r.find("pre").length))return!1;t=r.find("pre").html().replace(/<br\s*\/?>/g,"\n").replace(/<\/?[a-zA-Z][^>]*>/g,"").replace(/\n\n/g,"\n").replace(/&lt;/g,"<").replace(/&gt;/g,">"),e=0==e.length?r.find("pre")[0]:e[0]}else t=jQuery(e[0]).val(),e=e[0];(m=t.match(/^\s+/))&&(i=m[0].length,n=new RegExp("\\n\\s{"+i+"}","g"),t=t.substr(i).replace(n,"\n").replace(/\s+$/,"")),a="sagecell-"+sagecellcounter,sagecellcounter++,o=imasroot+"/assessment/libs/sagecellframe.html?frame_id="+a,o+="&code="+encodeURIComponent(t),void 0!==jQuery(e).attr("id")&&(o+="&update_id="+jQuery(e).attr("id")),o+="&evallabel="+encodeURIComponent(_("Evaluate")),jQuery(e).addClass("allowupdate").hide().after(jQuery("<iframe/>",{id:a,class:"sagecellframe",style:"border:0",width:"100%",height:100,src:o}))})}function setActiveTab(e){jQuery(e).closest(".tabwrap").find("li.active").removeClass("active"),jQuery(e).closest(".tablist").find("a[role=tab]").attr("aria-selected",!1),jQuery(e).attr("aria-selected",!0),jQuery(e).parent().addClass("active"),jQuery(e).closest(".tabwrap").find(".tabpanel").hide().attr("aria-hidden",!0);var t=e.getAttribute("aria-controls");jQuery(e).closest(".tabwrap").find("#"+t).show().attr("aria-hidden",!1)}tipobj=0,curtipel=null,jQuery(function(){jQuery(document).on("keyup",function(e){27==e.which&&null!==curtipel&&tipout()})}),popupwins=[],addLoadEvent(setupFormLimiters),GB_loaded=!1,tinyMCEPreInit={base:staticroot+"/tinymce4"},addLoadEvent(setselectbycookie),recordedunload=!1,fileembedcounter=videoembedcounter=0,jQuery(function(){var n;(n=window.location.href.match(/course\.php.*cid=(\d+).*folder=([\d\-]+)/))&&window.sessionStorage.setItem("btf"+n[1],n[2]),jQuery('a[href*="course.php"]').each(function(e,t){if(!t.href.match(/folder=/)&&(n=t.href.match(/cid=(\d+)/))){var i=window.sessionStorage.getItem("btf"+n[1])||"";""!==i&&(t.href+="&folder="+i)}}),jQuery("form").each(function(e,t){if(t.hasAttribute("action")&&(n=t.getAttribute("action").match(/cid=(\d+)/))){var i=window.sessionStorage.getItem("btf"+n[1])||"";""!==i&&t.setAttribute("action",t.getAttribute("action")+"&btf="+i)}})}),jQuery(document).ready(function(r){r(window).on("message",function(e){var t,i,n,a,o;if("string"==typeof e.originalEvent.data&&e.originalEvent.data.match(/lti\.frameResize/)){if("frame_id"in(t=JSON.parse(e.originalEvent.data)))r("#"+t.frame_id).height(t.height);else if("iframe_resize_id"in t)r("#"+t.iframe_resize_id).height(t.height);else for(i=document.getElementsByTagName("iframe"),n=0;n<i.length;n++)if(i[n].contentWindow===e.originalEvent.source&&!i[n].hasAttribute("data-noresize")){r(i[n]).height(t.height);break}}else"string"==typeof e.originalEvent.data&&e.originalEvent.data.match(/\[iFrameSizer\]/)?(t=e.originalEvent.data.substr("[iFrameSizer]".length).split(":"),r("#"+t[0]).height(t[1])):"string"==typeof e.originalEvent.data&&e.originalEvent.data.match(/imathas\.update/)&&("qn"in(t=JSON.parse(e.originalEvent.data))?""!=(a=t.qn.replace(/[^\d]/,""))&&r("#qn"+a).val(t.value).trigger("change"):(o=t.id.replace(/[^\w\-]/,""),r("#"+o).hasClass("allowupdate")&&r("#"+o).val(t.value).trigger("change")))})}),jQuery(document).ready(function(e){initlinkmarkup("body"),e(window).on("resize",function(){resizeResponsiveIframes("body")})}),jQuery.fn.isolatedScroll=function(){return this.bind("mousewheel DOMMouseScroll",function(e){var t=e.wheelDelta||e.originalEvent&&e.originalEvent.wheelDelta||-e.detail,i=0<=this.scrollTop+jQuery(this).outerHeight()-this.scrollHeight,n=this.scrollTop<=0;(t<0&&i||0<t&&n)&&e.preventDefault()}),this},jQuery(document).ready(function(i){var e,n=i(".fixedonscroll"),a=[];for(e=0;e<n.length;e++)a[e]=i(n[e]).offset().top,i(n[e]).height()>i(window).height()&&(a[e]=-1);0<n.length&&i(window).scroll(function(){var e,t=i(window).scrollTop();for(e=0;e<n.length;e++)t>a[e]&&0<a[e]?i(n[e]).css("position","fixed").css("top","5px").attr("data-fixed",!0):i(n[e]).css("position","static").attr("data-fixed",!1)})}),jQuery(document).ready(function(n){n(".grouptoggle").each(function(){var e=randID(),t=n(this).next(".blockitems"),i=t.hasClass("hidden");i?t.hide().removeClass("hidden"):t.show(),t.attr("id","bi"+e),n(this).attr("id",e).attr("aria-controls","bi"+e).attr("aria-expanded",!i).attr("tabindex",0).css("cursor","pointer").on("click keydown",function(e){"click"!=e.type&&13!=e.which||("true"==n(this).attr("aria-expanded")?(n(this).attr("aria-expanded",!1),n(this).children("img").attr("src",staticroot+"/img/expand.gif"),n(this).next(".blockitems").slideUp()):(n(this).attr("aria-expanded",!0),n(this).children("img").attr("src",staticroot+"/img/collapse.gif"),n(this).next(".blockitems").slideDown()))})}),n(".grouptoggle img").attr("alt","expand/collapse")}),jQuery("input.filealt").each(function(e,t){initFileAlt(t)}),function(a){"use strict";a.fn.fitVids=function(){return this.each(function(){var e=["iframe[src*='player.vimeo.com']","iframe[src*='youtube.com']","iframe[src*='youtube-nocookie.com']"],t=a(this).find(e.join(","));t.each(function(){var e,t,i,n=a(this);return 0<n.closest(".textsegment").length||(0<n.closest(".fluid-width-video-wrapper").length||(n.parentsUntil(".intro","table").each(function(){a(this).css("width","100%")}),t=(n.attr("height")&&!isNaN(parseInt(n.attr("height"),10))?parseInt(n.attr("height"),10):n.height())/(e=isNaN(parseInt(n.attr("width"),10))?n.width():parseInt(n.attr("width"),10)),n.attr("id")||(i="fitvid"+Math.floor(999999*Math.random()),n.attr("id",i)),n.wrap('<div class="fluid-width-video-wrapper"></div>').parent(".fluid-width-video-wrapper").css("padding-top",100*t+"%").wrap('<div class="video-wrapper-wrapper"></div>').parent(".video-wrapper-wrapper").css("max-width",e+"px"),void n.removeAttr("height").removeAttr("width").css("height","").css("width","")))})})}}(window.jQuery||window.Zepto),jQuery(document).ready(function(n){n(".alts").on("change",function(){var e=this.value.split(":");1<e.length&&setAltSelectors(e[0],e[1])}).each(function(e,t){var i=t.value.split(":");null!=(co=readCookie("alt_store_"+i[0]))?setAltSelectors(i[0],co):n(t).hasClass("setDefault")&&setAltSelectors(i[0],i[1])}),n(document).on("keydown",function(e){8!==e.which||n(e.target).is("input[type='text']:not([readonly]),input[type='number']:not([readonly]),input:not([type]):not([readonly]),input[type='password']:not([readonly]),input[type='url']:not([readonly]),input[type='email']:not([readonly]), textarea, [contenteditable='true']")||e.preventDefault()}),n("div.breadcrumb").attr("role","navigation").attr("aria-label",_("Navigation breadcrumbs")),n("div.cpmid,div.cp").attr("role","group").attr("aria-label",_("Control link group")),n("#centercontent").length&&(n("#centercontent").attr("role","main"),n(".midwrapper").removeAttr("role"))}),jQuery(document).ready(function(i){function t(e){var t=i("#headermobilemenulist");"true"==t.attr("aria-hidden")?(i("#headermobilemenulist").slideDown(50,function(){i("#headermobilemenulist").addClass("menuexpanded").removeAttr("style"),t.attr("aria-hidden",!1),i("#topnavmenu").attr("aria-expanded",!0)}),i("#navlist").slideDown(100,function(){i("#navlist").addClass("menuexpanded").removeAttr("style")})):(i("#navlist").slideUp(100,function(){i("#navlist").removeClass("menuexpanded").removeAttr("style")}),i("#headermobilemenulist").slideUp(50,function(){i("#headermobilemenulist").removeClass("menuexpanded").removeAttr("style"),t.attr("aria-hidden",!0),i("#topnavmenu").attr("aria-expanded",!1)})),e.preventDefault()}i("#topnavmenu").on("click",t).on("keydown",function(e){13!==e.which&&32!=e.which||t(e)})}),sagecellcounter=0,jQuery(function(){initSageCell("body")}),function(s){"use strict";var e,t=".dropdown-backdrop",l='[data-toggle="dropdown"]',n=function(e){s(e).on("click.bs.dropdown",this.toggle)};function d(e){var t,i=e.attr("data-target");return i||(i=(i=e.attr("href"))&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,"")),(t="#"!==i?s(document).find(i):null)&&t.length?t:e.parent()}function o(n){n&&3===n.which||(s(t).remove(),s(l).each(function(){var e=s(this),t=d(e),i={relatedTarget:this};t.hasClass("open")&&(n&&"click"==n.type&&/input|textarea/i.test(n.target.tagName)&&s.contains(t[0],n.target)||(t.trigger(n=s.Event("hide.bs.dropdown",i)),n.isDefaultPrevented()||(e.attr("aria-expanded","false"),t.removeClass("open").trigger(s.Event("hidden.bs.dropdown",i)))))}))}n.VERSION="3.4.1",n.prototype.toggle=function(e){var t,i,n,a=s(this);if(!a.is(".disabled, :disabled")){if(i=(t=d(a)).hasClass("open"),o(),!i){if("ontouchstart"in document.documentElement&&!t.closest(".navbar-nav").length&&s(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(s(this)).on("click",o),n={relatedTarget:this},t.trigger(e=s.Event("show.bs.dropdown",n)),e.isDefaultPrevented())return;a.trigger("focus").attr("aria-expanded","true"),t.toggleClass("open").trigger(s.Event("shown.bs.dropdown",n))}return!1}},n.prototype.keydown=function(e){var t,i,n,a,o,r;if(/(38|40|27|32)/.test(e.which)&&!/input|textarea/i.test(e.target.tagName)&&(t=s(this),e.preventDefault(),e.stopPropagation(),!t.is(".disabled, :disabled"))){if(!(n=(i=d(t)).hasClass("open"))&&27!=e.which||n&&27==e.which)return 27==e.which&&i.find(l).trigger("focus"),t.trigger("click");a=" li:not(.disabled):visible a",(o=t.next(".dropdown-menu"+a)).length||(o=i.find(".dropdown-menu"+a)),o.length&&(r=o.index(e.target),38==e.which&&0<r&&r--,40==e.which&&r<o.length-1&&r++,~r||(r=0),o.eq(r).trigger("focus"))}},e=s.fn.dropdown,s.fn.dropdown=function(i){return this.each(function(){var e=s(this),t=e.data("bs.dropdown");t||e.data("bs.dropdown",t=new n(this)),"string"==typeof i&&t[i].call(e)})},s.fn.dropdown.Constructor=n,s.fn.dropdown.noConflict=function(){return s.fn.dropdown=e,this},s(document).on("click.bs.dropdown.data-api",o).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",l,n.prototype.toggle).on("keydown.bs.dropdown.data-api",l,n.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",n.prototype.keydown)}(jQuery);
var arcsech,arccsch,arccoth,sign,logten,sinn,cosn,tann,cscn,secn,cotn,funcstoindexarr,pi=Math.PI,ln=Math.log,e=Math.E,arcsin=Math.asin,arccos=Math.acos,arctan=Math.atan,sec=function(c){return 1/Math.cos(c)},csc=function(c){return 1/Math.sin(c)},cot=function(c){return 1/Math.tan(c)},arcsec=function(c){return arccos(1/c)},arccsc=function(c){return arcsin(1/c)},arccot=function(c){return arctan(1/c)},sinh=function(c){return(Math.exp(c)-Math.exp(-c))/2},cosh=function(c){return(Math.exp(c)+Math.exp(-c))/2},tanh=function(c){return(Math.exp(c)-Math.exp(-c))/(Math.exp(c)+Math.exp(-c))},sech=function(c){return 1/cosh(c)},csch=function(c){return 1/sinh(c)},coth=function(c){return 1/tanh(c)},arcsinh=function(c){return ln(c+Math.sqrt(c*c+1))},arccosh=function(c){return ln(c+Math.sqrt(c*c-1))},arctanh=function(c){return ln((1+c)/(1-c))/2};function factorial(c,n){null==n&&(n=1);for(var t=c-n;0<t;t-=n)c*=t;return c<0?NaN:0==c?1:c}function C(c,n){var t,r=1;for(t=0;t<n;t++)r*=(c-t)/(n-t);return r}function matchtolower(c){return c.toLowerCase()}function nthroot(c,n){return safepow(n,1/c)}function nthlogten(c,n){return Math.log(n)/Math.log(c)}function functoindex(c){for(var n=0;n<funcstoindexarr.length;n++)if(funcstoindexarr[n]==c)return"@"+n+"@"}function indextofunc(c,n){return funcstoindexarr[n]}function safepow(c,n){if(c<0&&Math.floor(n)!=n){for(var t=3;t<50;t+=2)if(Math.abs(Math.round(t*n)-t*n)<1e-6)return Math.round(t*n)%2==0?Math.pow(Math.abs(c),n):-1*Math.pow(Math.abs(c),n);return Math.sqrt(-1)}return Math.pow(c,n)}function mathjs(c,n){var r,a,t,e,o,s,h;if(c=(c=(c=(c=(c=(c=(c=c.replace("[","(")).replace("]",")")).replace(/root\s*(\d+)/,"root($1)")).replace(/\|(.*?)\|/g,"abs($1)")).replace(/arc(sin|cos|tan|sec|csc|cot|sinh|cosh|tanh|sech|csch|coth)/gi,"$1^-1")).replace(/(Sin|Cos|Tan|Sec|Csc|Cot|Arc|Abs|Log|Exp|Ln|Sqrt)/gi,matchtolower)).replace(/(sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root)/g,functoindex),null!=n&&""!=n){for((r=n.split("|")).push("pi"),r.sort(function(c,n){return n.length-c.length}),n=r.join("|"),a=[],t=0;t<r.length;t++)for(a[t]=!1,e=0;e<r.length;e++)if(t!=e&&r[e].toLowerCase()==r[t].toLowerCase()&&r[e]!=r[t]){a[t]=!0;break}c=c.replace(new RegExp("("+n+")","gi"),function(c,n){for(var t=0;t<r.length;t++)if(r[t]==n||!a[t]&&r[t].toLowerCase()==n.toLowerCase())return"(@v"+t+"@)"})}else c=c.replace(/pi/g,"(pi)");for(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=c.replace(/([0-9])E([\-0-9])/g,"$1(EE)$2")).replace(/e/g,"(E)")).replace(/@(\d+)@/g,indextofunc)).replace(/log_([a-zA-Z\d\.]+)\s*\(/g,"nthlog($1,")).replace(/log_\(([a-zA-Z\/\d\.]+)\)\s*\(/g,"nthlog(($1),")).replace(/log_(\(@v\d+@\))\s*\(/g,"nthlog($1,")).replace(/log/g,"logten")).replace(/(sin|cos|tan|sec|csc|cot|sinh|cosh|tanh|sech|csch|coth)\^(-1|\(-1\))/g,"arc$1")).replace(/(sin|cos|tan|sec|csc|cot)\^(\d+)\s*\(/g,"$1n($2,")).replace(/(sin|cos|tan|sec|csc|cot)\^\((\d+)\)\s*\(/g,"$1n($2,")).replace(/root\s*\((\d+)\)\s*\(/g,"nthroot($1,")).replace(/([0-9])\s+([0-9])/g,"$1*$2")).replace(/#/g,"")).replace(/\s/g,""),null!=n&&""!=n&&(c=c.replace(/@v(\d+)@/g,function(c,n){return r[n]})),c=(c=(c=(c=c.replace(/([0-9])([\(a-zA-Z])/g,"$1*$2")).replace(/(!)([0-9\(a-zA-Z])/g,"$1*$2")).replace(/\)([\(0-9a-zA-Z]|\.\d+)/g,")*$1")).replace(/([0-9])\*\(EE\)\*?([\-0-9])/g,"$1e$2");-1!=(t=c.indexOf("!"));){if(0==t)return"Error: missing argument";if(e=t-1,"0"<=(s=c.charAt(e))&&s<="9"){for(e--;0<=e&&"0"<=(s=c.charAt(e))&&s<="9";)e--;if("."==s)for(e--;0<=e&&"0"<=(s=c.charAt(e))&&s<="9";)e--}else if(")"==s){for(h=1,e--;0<=e&&0<h;)"("==(s=c.charAt(e))?h--:")"==s&&h++,e--;for(;0<=e&&("a"<=(s=c.charAt(e))&&s<="z"||"A"<=s&&s<="Z");)e--}else{if(!("a"<=s&&s<="z"||"A"<=s&&s<="Z"))return"Error: incorrect syntax in "+c+" at position "+e;for(e--;0<=e&&("a"<=(s=c.charAt(e))&&s<="z"||"A"<=s&&s<="Z");)e--}c=c.slice(0,e+1)+"factorial("+c.slice(e+1,t)+")"+c.slice(t+1)}for(;-1!=(t=c.lastIndexOf("^"));){if(0==t)return"Error: missing argument";if(e=t-1,"0"<=(s=c.charAt(e))&&s<="9"){for(e--;0<=e&&"0"<=(s=c.charAt(e))&&s<="9";)e--;if("."==s)for(e--;0<=e&&"0"<=(s=c.charAt(e))&&s<="9";)e--}else if(")"==s){for(h=1,e--;0<=e&&0<h;)"("==(s=c.charAt(e))?h--:")"==s&&h++,e--;for(;0<=e&&("a"<=(s=c.charAt(e))&&s<="z"||"A"<=s&&s<="Z");)e--}else{if(!("a"<=s&&s<="z"||"A"<=s&&s<="Z"))return"Error: incorrect syntax in "+c+" at position "+e;for(e--;0<=e&&("a"<=(s=c.charAt(e))&&s<="z"||"A"<=s&&s<="Z");)e--}if(t==c.length-1)return"Error: missing argument";if(o=t+1,s=c.charAt(o),nch=c.charAt(o+1),"0"<=s&&s<="9"||"-"==s&&"("!=nch||"."==s){for(o++;o<c.length&&"0"<=(s=c.charAt(o))&&s<="9";)o++;if("."==s)for(o++;o<c.length&&"0"<=(s=c.charAt(o))&&s<="9";)o++}else if("("==s||"-"==s&&"("==nch)for("-"==s&&o++,h=1,o++;o<c.length&&0<h;)"("==(s=c.charAt(o))?h++:")"==s&&h--,o++;else{if(!("a"<=s&&s<="z"||"A"<=s&&s<="Z"))return"Error: incorrect syntax in "+c+" at position "+o;for(o++;o<c.length&&("a"<=(s=c.charAt(o))&&s<="z"||"A"<=s&&s<="Z");)o++;if("("==s&&c.slice(t+1,o).match(/^(sinn|cosn|tann|secn|cscn|cotn|sin|cos|tan|sec|csc|cot|logten|nthlogten|log|ln|exp|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|sqrt|abs|nthroot|factorial|safepow)$/))for(h=1,o++;o<c.length&&0<h;)"("==(s=c.charAt(o))?h++:")"==s&&h--,o++}c=c.slice(0,e+1)+"safepow("+c.slice(e+1,t)+","+c.slice(t+1,o)+")"+c.slice(o)}return c}sech=function(c){return 1/cosh(c)},csch=function(c){return 1/sinh(c)},coth=function(c){return 1/tanh(c)},arcsech=function(c){return arccosh(1/c)},arccsch=function(c){return arcsinh(1/c)},arccoth=function(c){return arctanh(1/c)},sign=function(c){return 0==c?0:c<0?-1:1},logten=function(c){return Math.LOG10E*Math.log(c)},sinn=function(c,n){return Math.pow(Math.sin(n),c)},cosn=function(c,n){return Math.pow(Math.cos(n),c)},tann=function(c,n){return Math.pow(Math.tan(n),c)},cscn=function(c,n){return 1/Math.pow(Math.sin(n),c)},secn=function(c,n){return 1/Math.pow(Math.cos(n),c)},cotn=function(c,n){return 1/Math.pow(Math.tan(n),c)},funcstoindexarr="sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root|arcsin|arccos|arctan|arcsec|arccsc|arccot|arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth".split("|");
var onlyAscii,LivePreviews,greekletters,calctoproc,intcalctoproc,calcformat,functoproc,matcalctoproc,ntupletoproc,complextoproc,callbackstack,matsize,vlist,flist,pts,iseqn,backgsavetimer,AutoSuggestIdCounter,assessFormIsDirty;function updateeeddpos(){}function updateehpos(){}function setupLivePreview(a){LivePreviews.hasOwnProperty(a)||("MathJax"==mathRenderer||"Katex"==mathRenderer?(LivePreviews[a]={delay:"MathJax"==mathRenderer?100:0,finaldelay:1e3,preview:null,buffer:null,timeout:null,finaltimeout:null,mjRunning:!1,mjPending:!1,oldText:null,Init:function(){$("#p"+a).css("positive","relative").append('<span id="lpbuf1'+a+'" style="visibility:hidden;position:absolute;"></span>').append('<span id="lpbuf2'+a+'" style="visibility:hidden;position:absolute;"></span>'),this.preview=document.getElementById("lpbuf1"+a),this.buffer=document.getElementById("lpbuf2"+a)},SwapBuffers:function(){var e=this.preview,t=this.buffer;this.buffer=e,this.preview=t,e.style.visibility="hidden",e.style.position="absolute",t.style.position="",t.style.visibility=""},Update:function(e){this.timeout&&clearTimeout(this.timeout),this.finaltimeout&&clearTimeout(this.finaltimeout),this.timeout=setTimeout(this.callback,this.delay),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(e){this.buffer.innerHTML=this.oldtext=e,this.mjRunning=!0,this.RenderBuffer()},RenderBuffer:function(){"MathJax"==mathRenderer?MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.buffer],["PreviewDone",this]):"Katex"==mathRenderer&&(renderMathInElement(this.buffer),"undefined"!=typeof MathJax&&MathJax.version&&0<$(this.buffer).children(".mj").length?MathJax.Hub.Queue(["PreviewDone",this]):this.PreviewDone())},DoFinalPreview:function(){$("#pbtn"+a).trigger("click")},preformat:function(e){if(e=normalizemathunicode(e),intcalctoproc.hasOwnProperty(a))calcformat[a].match(/inequality/)?(e=e.replace(/<=/g," le ").replace(/>=/g," ge ").replace(/</g," lt ").replace(/>/g," gt ")).match(/all\s*real/i)&&(e="text("+e+")"):e=e.replace(/U/g,"uu");else if(vlist.hasOwnProperty(a))e=AMnumfuncPrepVar(a,e)[1];else if(ntupletoproc.hasOwnProperty(a))e=e.replace(/</g,"(:").replace(/>/g,":)");else if(calcformat.hasOwnProperty(a)){var t=calcformat[a];-1==t.indexOf("list")&&-1==t.indexOf("set")&&(e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),-1!=t.indexOf("scinot")&&(e=e.replace(/(x|X|\u00D7)/,"xx"))}return e=e.replace(/[^\u0000-\u007f]/g,"?")},CreatePreview:function(){var e;this.timeout=null,this.mjPending||(e=null==document.getElementById("tc"+a)?document.getElementById("qn"+a).value:document.getElementById("tc"+a).value)!==this.oldtext&&(this.mjRunning?(this.mjPending=!0,MathJax.Hub.Queue(["CreatePreview",this])):(this.oldtext=e,this.buffer.innerHTML="`"+this.preformat(e)+"`",this.mjRunning=!0,this.RenderBuffer()))},PreviewDone:function(){this.mjRunning=this.mjPending=!1,this.SwapBuffers(),updateeeddpos(),updateehpos()}},"MathJax"==mathRenderer?(LivePreviews[a].callback=MathJax.Callback(["CreatePreview",LivePreviews[a]]),LivePreviews[a].callback.autoReset=!0):LivePreviews[a].callback=function(){LivePreviews[a].CreatePreview()},LivePreviews[a].Init()):LivePreviews[a]={finaldelay:1e3,finaltimeout:null,Update:function(e){this.finaltimeout&&clearTimeout(this.finaltimeout),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(e){var t=document.getElementById("p"+a);t.innerHTML=e,rendermathnode(t)},DoFinalPreview:function(){$("#pbtn"+a).trigger("click")}})}function updateLivePreview(e){var t=e.id.substr(2);setupLivePreview(t),LivePreviews[t].Update()}function normalizemathunicode(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/[\x00-\x09\x0B\x0C\x0E-\x1F\x7F]/g,"")).replace(/\u2013|\u2014|\u2015|\u2212/g,"-")).replace(/\u2044|\u2215/g,"/")).replace(//g,"oo").replace(//g,"<=").replace(//g,">=").replace(//g,"U")).replace(//g,"+-").replace(//g,"/").replace(/|||/g,"*")).replace(//g,"sqrt").replace(//g,"root(3)")).replace(//g,"^2").replace(//g,"^3")).replace(/\u2329/g,"<").replace(/\u232a/g,">")).replace(//g,"_0").replace(//g,"_1").replace(//g,"_2").replace(//g,"_3")).replace(/\bOO\b/i,"oo")).replace(//,"theta").replace(//,"phi").replace(//,"phi").replace(//,"pi").replace(//,"sigma").replace(//,"mu")).replace(//,"alpha").replace(//,"beta").replace(//,"gamma").replace(//,"delta").replace(//,"epsilon").replace(//,"kappa")).replace(//,"lambda").replace(//,"rho").replace(//,"tau").replace(//,"chi").replace(//,"omega")).replace(//,"Omega").replace(//,"Gamma").replace(//,"Phi").replace(//,"Delta").replace(//,"Sigma")}function wrapAMnotice(e){return'<span class="AMHnotice">'+e+"</span>"}function calculate(e,t,a){var i,s,n,r,l,c,o=document.getElementById(e).value;for(o=(o=normalizemathunicode(o)).replace(/=/,""),-1!=a.indexOf("list")?i=o.split(/,/):-1!=a.indexOf("set")?i=o.replace(/[\{\}]/g,"").split(/,/):(i=new Array)[0]=o,s=0;s<i.length;s++){if(str=i[s],str=str.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1"),n="",str.match(/DNE/i))str=str.toUpperCase();else if(str.match(/oo$/)||str.match(/oo\W/))str="`"+str+"`";else{n+=singlevalsyntaxcheck(str,a),str.match(/,/)&&(n+=_("Invalid use of a comma.")),-1!=a.indexOf("allowxtimes")&&(str=str.replace(/(x|X|\u00D7)/,"*")),-1!=a.indexOf("mixed")?str=str.replace(/_/g," "):-1!=a.indexOf("scinot")?str=str.replace(/(x|X|\u00D7)/,"xx"):str=str.replace(/^\s+/,"").replace(/\s+$/,""),n+=syntaxcheckexpr(str,a);try{(r=(r=str).replace(",","*NaN*")).match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(r=r.replace(/%/,"")+"/100"),-1!=a.indexOf("mixed")&&(r=r.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),-1!=a.indexOf("scinot")&&(r=r.replace("xx","*")),l=scopedmatheval(r)}catch(e){n=_("syntax incomplete")+". "+n,l=NaN}str=str.replace(/[^\u0000-\u007f]/g,"?"),isNaN(l)||"Infinity"==l||""===l?""!=str&&(str="`"+str+"` = "+_("undefined")+". "+wrapAMnotice(n)):-1==a.indexOf("showval")?str="`"+str+"` "+wrapAMnotice(n):str="`"+str+" =` "+(Math.abs(l)<1e-15?0:l)+". "+wrapAMnotice(n)}i[s]=str+" "}o=i.join(", "),-1!=a.indexOf("set")&&(document.getElementById(e).value.match(/^\s*{.*?}\s*$/)?o="{"+o+"}":o+=wrapAMnotice(_("syntax error: this answer must be in set notation, a list wrapped in braces like {1,2,3}"))),setupLivePreview(c=t.substr(1)),LivePreviews[c].RenderNow(o)}function ineqtointerval(e){var t,a;for(t=(e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")).split(/or/),i=0;i<t.length;i++)str=t[i],a="",(pat=str.match(/^([^<]+)\s*(<=?)\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*(<=?)([^<]+)$/))?("<="==pat[2]?a+="[":a+="(",a+=pat[1]+","+pat[5],"<="==pat[4]?a+="]":a+=")"):(pat=str.match(/^([^>]+)\s*(>=?)\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*(>=?)([^>]+)$/))?(">="==pat[4]?a+="[":a+="(",a+=pat[5]+","+pat[1],">="==pat[2]?a+="]":a+=")"):(pat=str.match(/^([^><]+)\s*([><]=?)\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*$/))?">"==pat[2]?a="(-oo,"+pat[1]+")":">="==pat[2]?a="(-oo,"+pat[1]+"]":"<"==pat[2]?a="("+pat[1]+",oo)":"<="==pat[2]&&(a="["+pat[1]+",oo)"):(pat=str.match(/^\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*([><]=?)\s*([^><]+)$/))?"<"==pat[2]?a="(-oo,"+pat[3]+")":"<="==pat[2]?a="(-oo,"+pat[3]+"]":">"==pat[2]?a="("+pat[3]+",oo)":">="==pat[2]&&(a="["+pat[3]+",oo)"):a=str.match(/all\s*real/i)?"(-oo,oo)":"",t[i]=a;return a=t.join("U")}function intcalculate(e,t,a){var s,n,r,l,c,o,d,u,p,m,h,f,g,v,y=document.getElementById(e).value;if((y=normalizemathunicode(y=-1!=a.indexOf("mixed")?y.replace(/_/g," ").replace(/^\s+/,"").replace(/\s+$/,""):y.replace(/^\s+/,"").replace(/\s+$/,""))).match(/DNE/i))y=y.toUpperCase();else if(""==y.replace(/\s+/g,""))y=_("no answer given");else{if(s=new Array,n=new Array,-1!=a.indexOf("inequality")?(y=ineqtointerval(r=y=y.replace(/or/g," or ")),l=str.match(/\b([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+\b)/),c=str.match(/([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)/),o=null!=l?l[1]:null!=c?c[1]:""):r=y,-1!=a.indexOf("list")){for(d=0,u=[],p=1;p<y.length-1;p++)","==y.charAt(p)&&(")"!=y.charAt(p-1)&&"]"!=y.charAt(p-1)||"("!=y.charAt(p+1)&&"["!=y.charAt(p+1)||(u.push(y.substring(d,p)),d=p+1));u.push(y.substring(d))}else u=y.split(/\s*U\s*/i);for(m=!0,h="",i=0;i<u.length;i++){if(str=u[i],sm=str.charAt(0),em=str.charAt(str.length-1),vals=str.substring(1,str.length-1),vals=vals.split(/,/),2!=vals.length||"("!=sm&&"["!=sm||")"!=em&&"]"!=em){y=-1!=a.indexOf("inequality")?"`"+(r=r.replace("<=","le").replace(">=","ge").replace("<","lt").replace(">","gt"))+"`: "+wrapAMnotice(_("invalid inequality notation")):"`"+r.replace(/U/g,"uu")+"`: "+wrapAMnotice(_("invalid interval notation")),m=!1;break}for(j=0;j<2;j++)if(vals[j].match(/oo$/)||vals[j].match(/oo\W/))s[j]=vals[j];else{if(f="",g=NaN,f+=singlevalsyntaxcheck(vals[j],a),-1!=a.indexOf("mixed")?vals[j]=vals[j].replace(/_/g," ").replace(/^\s+/,"").replace(/\s+$/,""):vals[j]=vals[j].replace(/^\s+/,"").replace(/\s+$/,""),""==(f+=syntaxcheckexpr(vals[j],a)))try{toeval=vals[j],-1!=a.indexOf("mixed")&&(toeval=toeval.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),g=scopedmatheval(toeval)}catch(e){f=_("syntax incomplete")+". "}isNaN(g)||"Infinity"==g||""===g?s[j]=_("undefined"):(vals[j]=vals[j],s[j]=(Math.abs(g)<1e-15?0:g).toString()),""!=f&&(h+=f)}u[i]=sm+vals[0]+","+vals[1]+em,-1!=a.indexOf("inequality")?(s[0].match(/oo/)?s[1].match(/oo/)?n[i]="RR":n[i]=o+("]"==em?"le":"lt")+s[1]:s[1].match(/oo/)?n[i]=o+("["==sm?"ge":"gt")+s[0]:n[i]=s[0]+("["==sm?"le":"lt")+o+("]"==em?"le":"lt")+s[1],n[i]=n[i].replace("undefined",'"undefined"')):n[i]=sm+s[0]+","+s[1]+em}m&&(y=-1!=a.indexOf("inequality")?r.match(/all\s*real/)?r:(r=(r=(r=(r=(r=r.replace(/or/g,' \\ "or" \\ ')).replace(/<=/g,"le")).replace(/>=/g,"ge")).replace(/</g,"lt")).replace(/>/g,"gt"),-1==a.indexOf("showval")?"`"+r+"`. "+wrapAMnotice(h):"`"+r+"= "+n.join(' \\ "or" \\ ')+"`. "+wrapAMnotice(h)):-1==a.indexOf("showval")?"`"+u.join("uu")+"`. "+wrapAMnotice(h):-1!=a.indexOf("list")?"`"+u.join(",")+"` = "+n.join(" , ")+". "+wrapAMnotice(h):"`"+u.join("uu")+"` = "+n.join(" U ")+". "+wrapAMnotice(h))}y=y.replace(/[^\u0000-\u007f]/g,"?"),setupLivePreview(v=t.substr(1)),LivePreviews[v].RenderNow(y)}function ntuplecalc(e,t,a){var i,s,n,r,l,c,o,d,u=document.getElementById(e).value;if(u=(u=normalizemathunicode(u)).replace(/\(:|<</g,"<").replace(/:\)|>>/g,">"),(u=-1!=a.indexOf("mixed")?u.replace(/_/g," ").replace(/^\s+/,"").replace(/\s+$/,""):u.replace(/^\s+/,"").replace(/\s+$/,"")).match(/DNE/i))u=u.toUpperCase(),i="DNE",outstr="DNE";else if(u.match(/^\s*oo\s*$/i))u=u.toLowerCase(),i="oo",outstr="`oo`";else{for(n=s=0,l=!(r=i=""),c=NaN,u.charAt(0).match(/[\(\[\<\{]/)||(l=!1),o=0;o<u.length;o++)if(dec=!1,0==s&&(i+=u.charAt(o),n=o+1,","==u.charAt(o)&&(u.substring(o+1).match(/^\s*[\(\[\<\{]/)&&u.substring(0,o).match(/[\)\]\>\}]\s*$/)||(l=!1))),u.charAt(o).match(/[\(\[\<\{]/)?s++:u.charAt(o).match(/[\)\]\>\}]/)&&(s--,dec=!0),0==s&&dec||1==s&&","==u.charAt(o)){if(sub=u.substring(n,o),c=NaN,"oo"==sub||"-oo"==sub)i+=sub;else{r+=singlevalsyntaxcheck(sub,a),r+=syntaxcheckexpr(sub,a);try{-1!=a.indexOf("mixed")&&(sub=sub.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),c=scopedmatheval(sub)}catch(e){r+=_("syntax incomplete")+". "}isNaN(c)||"Infinity"==c||""===c?i+=_("undefined"):i+=c}i+=u.charAt(o),n=o+1}0!=s&&(l=!1),0==l&&(r+=_("Invalid notation")+". "),u=(u=u.replace(/[^\u0000-\u007f]/g,"?")).replace(/</g,"(:").replace(/>/g,":)"),-1==a.indexOf("showval")||0==l?outstr="`"+u+"`. "+wrapAMnotice(r):outstr="`"+u+"` = "+i+". "+wrapAMnotice(r)}return null!=t&&(setupLivePreview(d=t.substr(1)),LivePreviews[d].RenderNow(outstr)),i}function complexcalc(e,t,a){var i,s,n,r,l,c,o,d,u,p,m,h=document.getElementById(e).value;if(h=normalizemathunicode(h),(h=-1!=a.indexOf("mixed")?h.replace(/_/g," ").replace(/^\s+/,"").replace(/\s+$/,""):h.replace(/^\s+/,"").replace(/\s+$/,"")).match(/DNE/i))h=h.toUpperCase(),s=i="DNE";else{for(n=i="",r=h.split(","),l=0;l<r.length;l++){if(c=r[l],-1!=a.indexOf("mixed")&&(c=c.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),c=mathjs(c,"i"),-1==a.indexOf("sloppycomplex")&&("string"==typeof(o=parsecomplex(r[l]))?n+=o:(n+=singlevalsyntaxcheck(o[0],a),n+=singlevalsyntaxcheck(o[1],a))),""==(n+=syntaxcheckexpr(r[l],a)))try{d=scopedeval("var i=0;"+prepWithMath(c)),u=scopedeval("var i=1;"+prepWithMath(c)),p=scopedeval("var i=-1;"+prepWithMath(c))}catch(e){n+=_("syntax incomplete")}if("synerr"!=d&&"synerr"!=u||(n+=_("syntax incomplete"),d=NaN),isNaN(d)||"Infinity"==d||isNaN(u)||isNaN(p)||"Infinity"==u){i+=_("undefined");break}0!=l&&(i+=","),i+=d+(0<=(u-=d)?"+":"")+u+"i"}h=h.replace(/[^\u0000-\u007f]/g,"?"),s=-1==a.indexOf("showval")?"`"+h+"`. "+wrapAMnotice(n):"`"+h+"` = "+i+". "+wrapAMnotice(n)}return null!=t&&(setupLivePreview(m=t.substr(1)),LivePreviews[m].RenderNow(s)),i}function parsecomplex(e){var t,a,i,s,n,r,l,c;if(c=(e=(e=(e=(e=e.replace(/\s/,"")).replace(/\((\d+\*?i|i)\)\/(\d+)/g,"$1/$2")).replace(/sin/,"s$n")).replace(/pi/,"p$")).length,2<e.split("i").length)return _("error - more than 1 i in expression");if(-1==(n=e.indexOf("i")))t=e,a="0";else{for(s=0,l=n-1;0<l;l--)if(")"==(i=e.charAt(l)))s++;else if("("==i)s--;else if(("+"==i||"-"==i)&&0==s)break;if(l<0&&(l=0),0!=s)return _("error - invalid form");for(s=0,r=n+1;r<c;r++)if("("==(i=e.charAt(r)))s++;else if(")"==i)s--;else if(("+"==i||"-"==i)&&0==s)break;if(0!=s)return _("error - invalid form");if(0<n-l&&0<r-n&&(r==c||0==l)){if(r==c)t=e.substr(0,l),a=e.substr(l,n-l);else{if(0!=l)return _("error - invalid form");t=e.substr(r),a=e.substr(0,n)}a=(a=(a+="*"+e.substr(n+1+("*"==e.charAt(n+1)?1:0),r-n-1)).replace("-*","-1*").replace("+*","+1*")).replace(/(\+|-)1\*(.+)/g,"$1$2")}else if(1<n-l)a=e.substr(l,n-l),t=e.substr(0,l)+e.substr(n+1);else if(1<r-n)if(0<n){if("+"!=e.charAt(n-1)&&"-"!=e.charAt(n-1))return _("error - invalid form");a=e.charAt(n-1)+e.substr(n+1+("*"==e.charAt(n+1)?1:0),r-n-1),t=e.substr(0,n-1)+e.substr(r)}else a=e.substr(n+1,r-n-1),t=e.substr(0,n)+e.substr(r);else a="+"==e.charAt(l)?"1":"-"==e.charAt(l)?"-1":0==n?"1":e.charAt(l),t=(0<n?e.substr(0,l):"")+e.substr(n+1);""==t&&(t="0"),"/"==a.charAt(0)?a="1"+a:"+"!=a.charAt(0)&&"-"!=a.charAt(0)||"/"!=a.charAt(1)||(a=a.charAt(0)+"1"+a.substr(1)),"*"==a.charAt(a.length-1)&&(a=a.substr(0,a.length-1)),"+"==a.charAt(0)&&(a=a.substr(1)),"+"==t.charAt(0)&&(t=t.substr(1))}return[t=(t=t.replace("s$n","sin")).replace("p$","pi"),a=(a=(a=a.replace("s$n","sin")).replace("p$","pi")).replace(/\*\//g,"/")]}function matrixcalc(e,t,a,i,s){var n,r,l,c,o,d,u,p,m,h,f,g,v,y;function x(e){var t,a="";try{t=scopedmatheval(e)}catch(e){a=_("syntax incomplete")+". "}return isNaN(t)||"Infinity"==t||""===t?""!=e&&(e=a=_("undefined")+". "):e=(Math.abs(t)<1e-15?0:t)+a,[e,a]}if(n="","string"!=typeof s&&(s=""),null!=a&&null!=i){for(o=c="[",d=l=0;d<a;d++){for(0<d&&(c+=",",o+=","),c+="(",o+="(",u=0;u<i;u++)0<u&&(c+=",",o+=","),val=normalizemathunicode(document.getElementById(e+"-"+l).value),c+=val,(r=x(val))[1]+=syntaxcheckexpr(val,s),""==r[1]&&(r[1]+=singlevalsyntaxcheck(val,s)),""==n&&(n=r[1]),o+=r[0],l++;c+=")",o+=")"}c+="]",o+="]"}else{for(p=0,o=(o=(o=(o=c=normalizemathunicode(document.getElementById(e).value)).replace("[","(")).replace("]",")")).replace(/\s+/g,""),m=new Array,o=o.substring(1,o.length-1),f=h=0;f<o.length;f++)"("==o.charAt(f)?p++:")"==o.charAt(f)?p--:","==o.charAt(f)&&0==p&&(m[m.length]=o.substring(h+1,f-1),h=f+1);for(m[m.length]=o.substring(h+1,o.length-1),f=0;f<m.length;f++){for(calclist2=m[f].split(","),g=0;g<calclist2.length;g++)(r=x(calclist2[g]))[1]+=syntaxcheckexpr(calclist2[g],s),""==r[1]&&(r[1]+=singlevalsyntaxcheck(calclist2[g],s)),""==n&&(n=r[1]),calclist2[g]=r[0];m[f]=calclist2.join(",")}o="[("+m.join("),(")+")]"}if(c=c.replace(/[^\u0000-\u007f]/g,"?"),c=-1==s.indexOf("showval")?"`"+c+"`. "+n:"`"+c+"` = `"+o+"`. "+n,null!=t){for(y=(v=document.getElementById(t)).childNodes.length,f=0;f<y;f++)v.removeChild(v.firstChild);v.appendChild(document.createTextNode(c)),noMathRender||rendermathnode(v)}return o}function mathjsformat(e,t){var a=document.getElementById(e).value,i=document.getElementById(t);i.value=mathjs(a)}function stringqpreview(e,t){var a=document.getElementById(e).value,i=t.substr(1);setupLivePreview(i),LivePreviews[i].RenderNow("`"+a+"`")}function AMnumfuncPrepVar(e,t){var i,a,s,n,r,l,c,o,d,u,p=vlist[e],m=flist[e],h=p.split("|");for(h.push("DNE"),p.match(/lambda/)&&(t=t.replace(/lamda/,"lambda")),t=normalizemathunicode(t=t.replace(/,/g,"").replace(/^\s+/,"").replace(/\s+$/,"")),i=[],a=(a=t).replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root)/g,functoindex),s=0;s<h.length;s++)if("varE"==h[s])t=t.replace("E","varE"),a=a.replace("E","varE");else for(i[s]=!1,n=0;n<h.length;n++)if(s!=n&&h[n].toLowerCase()==h[s].toLowerCase()&&h[n]!=h[s]){i[s]=!0;break}for(t=(t=t.replace(new RegExp("("+p+")","gi"),function(e,t){for(var a=0;a<h.length;a++)if(h[a]==t||!i[a]&&h[a].toLowerCase()==t.toLowerCase())return"@v"+a+"@"})).replace(/@v(\d+)@/g,function(e,t){return h[t]}),a=(a=(a=a.replace(new RegExp("("+p+")","gi"),function(e,t){for(var a=0;a<h.length;a++)if(h[a]==t||!i[a]&&h[a].toLowerCase()==t.toLowerCase())return"@v"+a+"@"})).replace(/(@v(\d+)@|\d+(\.\d+)?)!/g,"{:$&:}")).replace(/@v(\d+)@/g,function(e,t){return h[t]}),r=new Array,s=0;s<h.length;s++)1<h[s].length&&(c=!1,-1!=arraysearch(h[s].toLowerCase(),greekletters)&&(c=!0),h[s].match(/^\w+_\w+$/)?(l=i[s]?"g":"gi",o=new RegExp(/^(\w+)_(\w+)$/,l).exec(h[s]),d=new RegExp(o[1]+"_\\("+o[2]+"\\)",l),a=a.replace(d,h[s]),t=t.replace(d,h[s]),1<o[1].length&&-1==arraysearch(o[1].toLowerCase(),greekletters)&&(o[1]='"'+o[1]+'"'),1<o[2].length&&-1==arraysearch(o[2].toLowerCase(),greekletters)&&(o[2]='"'+o[2]+'"'),a=a.replace(new RegExp(o[0],l),o[1]+"_"+o[2]),t=t.replace(new RegExp(o[0],"g"),"repvars"+s),h[s]="repvars"+s):c||"varE"==h[s]||r.push(h[s]));return 0<r.length&&(vltq=r.join("|"),u=new RegExp("("+vltq+")","g"),a=a.replace(u,'"$1"')),a=(a=a.replace("varE","E")).replace(/@(\d+)@/g,indextofunc),p.match(/\bf\b/)&&!m.match(/\bf\b/)&&(a=(a=a.replace(/([^a-zA-Z])f\^([\d\.]+)([^\d\.])/g,"$1f^$2{::}$3")).replace(/([^a-zA-Z])f\(/g,"$1f{::}(")),p.match(/\bg\b/)&&!m.match(/\bg\b/)&&(a=(a=a.replace(/([^a-zA-Z])g\^([\d\.]+)([^\d\.])/g,"$1g^$2{::}$3")).replace(/([^a-zA-Z])g\(/g,"$1g{::}(")),[t,a,h.join("|")]}function AMpreview(e,t){var a,i,s,n,r,l,c,o,d=e.slice(2),u=AMnumfuncPrepVar(d,document.getElementById(e).value),p=u[0],m=u[1],h=u[2],f=flist[d];for(ptlist=pts[d].split(","),a="",i=0,s=NaN,n=!1,1==iseqn[d]?(p.match(/=/)?1<p.match(/=/g).length&&(n=!0):n=!0,p=p.replace(/(.*)=(.*)/,"$1-($2)")):p.match(/=/)||(n=!0),""!=f&&(reg=new RegExp("("+f+")\\(","g"),p=p.replace(reg,"$1*sin($1+")),vars=h.split("|"),r=prepWithMath(mathjs(p,h));i<ptlist.length&&(isNaN(s)||"Infinity"==s);){for(l="",testvals=ptlist[i].split("~"),c=0;c<vars.length;c++)l+="var "+vars[c]+"="+testvals[c]+";";l+=r,a=_("syntax ok");try{s=scopedeval(l)}catch(e){a=_("syntax error")}"synerr"==s&&(a=_("syntax error")),i++}o=syntaxcheckexpr(p,"",h),(isNaN(s)||"Infinity"==s)&&(a=_("syntax error")),""!=o&&(a==_("syntax ok")?a+=". "+_("warning")+": "+o:a+=". "+o),onlyAscii.test(p)||(a+=". "+_("Your answer contains an unrecognized symbol"),m=m.replace(/[^\u0000-\u007f]/g,"?")),1==iseqn[d]&&n?a=_("syntax error: this is not an equation"):void 0!==iseqn[d]||n||(a=_("syntax error: you gave an equation, not an expression")),'"DNE"'!=m&&"oo"!=m||(a=_("syntax ok")),setupLivePreview(d=t.substr(1)),LivePreviews[d].RenderNow("`"+m+"` "+wrapAMnotice(a))}function AMmathpreview(e,t){var a,i=document.getElementById(e).value,s=document.getElementById(t),n=s.childNodes.length;for(a=0;a<n;a++)s.removeChild(s.firstChild);s.appendChild(document.createTextNode("`"+i+"`")),noMathRender||rendermathnode(s)}function singlevalsyntaxcheck(e,t){if(e.match(/DNE/i))return"";if(e.match(/oo$/)||e.match(/oo\W/))return"";if(-1!=t.indexOf("allowmixed")&&e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/))return"";if(-1!=t.indexOf("fracordec")){if(!(e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2").replace(/\s/g,"")).match(/^\-?\(?\d+\s*\/\s*\-?\d+\)?$/)&&!e.match(/^\-?\d+$/)&&!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/))return _(" invalid entry format")+". "}else if(-1!=t.indexOf("fraction")||-1!=t.indexOf("reducedfraction")){if(!(e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2").replace(/\s/g,"")).match(/^\(?\-?\(?\d+\)?\/\(?\d+\)?$/)&&!e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)&&!e.match(/^\s*?\-?\d+\s*$/))return _("not a valid fraction")+". "}else if(-1!=t.indexOf("mixednumber")){if(!(e.match(/^\(?\-?\s*\(?\d+\)?\/\(?\d+\)?$/)||e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)||e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/)||e.match(/^\s*\-?\s*\d+\s*$/)))return _("not a valid mixed number")+". ";e=e.replace(/_/," ")}else if(-1!=t.indexOf("scinot")){if(!(e=(e=e.replace(/\s/g,"")).replace(/(x|X|\u00D7)/,"xx")).match(/^\-?[1-9](\.\d*)?(\*|xx)10\^(\(?\-?\d+\)?)$/)){if(-1==t.indexOf("scinotordec"))return _("not valid scientific notation")+". ";if(!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/))return _("not valid decimal or scientific notation")+". "}}else if(-1!=t.indexOf("decimal")&&-1==t.indexOf("nodecimal")){if(!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/))return _(" not a valid integer or decimal number")+". "}else if(!onlyAscii.test(e))return _("Your answer contains an unrecognized symbol")+". ";return""}function syntaxcheckexpr(e,t,a){var i,s,n,r,l,c="";for(-1!=t.indexOf("notrig")&&e.match(/(sin|cos|tan|cot|sec|csc)/i)?c+=_("no trig functions allowed")+". ":-1!=t.indexOf("nodecimal")&&-1!=e.indexOf(".")?c+=_("no decimals allowed")+". ":-1==t.indexOf("mixed")&&e.match(/\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/)&&(c+=_("mixed numbers are not allowed")+". "),r=n=s=i=0;r<e.length;r++)"("==e.charAt(r)?i++:")"==e.charAt(r)?i--:"["==e.charAt(r)?s++:"]"==e.charAt(r)?s--:"|"==e.charAt(r)&&(n=1-n);if(0==i&&0==s||(c+=" ("+_("unmatched parens")+"). "),0!=n&&(c+=" ("+_("unmatched absolute value bars")+"). "),reg=a?new RegExp("(sqrt|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*("+a+"|\\d+)","i"):new RegExp("(sqrt|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*(\\d+)","i"),errstuff=e.match(reg),null!=errstuff&&(c+="["+_("use function notation")+" - "+_("use $1 instead of $2",errstuff[1]+"("+errstuff[2]+")",errstuff[0])+"]. "),a&&(reg=new RegExp("(repvars\\d+|arc|sqrt|root|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs|pi|sign|DNE|e|oo|"+a+")","ig"),e.replace(reg,"").match(/[a-zA-Z]/)&&(c+=_(" Check your variables - you might be using an incorrect one")+". ")),2<(e.match(/\|/g)||[]).length)for(l=/\|.*?\|\s*(.|$)/g;match=l.exec(e);)if(""!=match[1]&&match[1].match(/[^+\-\*\/\^\)]/)){c+=_(" You may want to use abs(x) instead of |x| for absolute values to avoid ambiguity")+". ";break}return e.match(/%/)&&!e.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(c+=_(" Do not use the percent symbol, %")+". "),c}function doonsubmit(e,t,a){var i,s,n,r,l,c,o,d,u,p,m,h;for(i in callbackstack)callbackstack[i](i);if(null!=e){if("submitted"==e.className)return alert(_("You have already submitted this page.  Please be patient while your submission is processed.")),!(e.className="submitted2");if("submitted2"==e.className)return!1;if(e.className="submitted",!a&&(t&&1==$("input[name=saveforlater]").attr("data-clicked")?(s=!0,$("input[name=saveforlater]").attr("data-clicked",0)):s=confirmSubmit(e),!s))return e.className="",!1}for(i in imathasDraw.encodea11ydraw(),intcalctoproc)if(i=parseInt(i),null!=document.getElementById("tc"+i)){if(fullstr=document.getElementById("tc"+i).value,-1!=calcformat[i].indexOf("mixed")?fullstr=fullstr.replace(/_/g," ").replace(/^\s+/,"").replace(/\s+$/,""):fullstr=fullstr.replace(/\s+/g,""),fullstr=normalizemathunicode(fullstr),fullstr.match(/DNE/i))fullstr=fullstr.toUpperCase();else{if(-1!=calcformat[i].indexOf("inequality")&&(fullstr=ineqtointerval(fullstr)),-1!=calcformat[i].indexOf("list")){for(n=0,r=[],l=1;l<fullstr.length-1;l++)","==fullstr.charAt(l)&&(")"!=fullstr.charAt(l-1)&&"]"!=fullstr.charAt(l-1)||"("!=fullstr.charAt(l+1)&&"["!=fullstr.charAt(l+1)||(r.push(fullstr.substring(n,l)),n=l+1));r.push(fullstr.substring(n))}else r=fullstr.split(/\s*U\s*/i);for(k=0;k<r.length;k++)if(str=r[k],0<str.length&&str.match(/,/)){for(sm=str.charAt(0),em=str.charAt(str.length-1),vals=str.substring(1,str.length-1),vals=vals.split(/,/),j=0;j<2;j++)if(!vals[j].match(/oo$/)&&!vals[j].match(/oo\W/)){c="";try{-1!=calcformat[i].indexOf("mixed")&&(vals[j]=vals[j].replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),o=scopedmatheval(vals[j])}catch(e){c="syntax incomplete"}isNaN(o)||"Infinity"==o||""===o||(vals[j]=(Math.abs(o)<1e-15?0:o)+c)}r[k]=sm+vals[0]+","+vals[1]+em}-1!=calcformat[i].indexOf("list")?fullstr=r.join(","):fullstr=r.join("U")}document.getElementById("qn"+i).value=fullstr}for(i in calctoproc)if(i=parseInt(i),null!=document.getElementById("tc"+i)){if(str=document.getElementById("tc"+i).value,str=normalizemathunicode(str),str=str.replace(/=/,""),-1!=calcformat[i].indexOf("list"))r=str.split(/,/);else if(-1!=calcformat[i].indexOf("set")){if(!str.match(/^\s*{.*?}\s*$/))continue;r=str.replace(/^\s*{(.*?)}\s*$/,"$1").split(/,/)}else(r=new Array)[0]=str;for(d=0;d<r.length;d++)str=r[d],str=str.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1"),str=str.replace(",","*NaN*"),-1==calcformat[i].indexOf("scinot")&&-1==calcformat[i].indexOf("allowxtimes")||(str=str.replace(/(x|X|\u00D7)/,"*")),str.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(str=str.replace(/%/,"")+"/100"),str=str.replace(/(\d+)\s*_\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)"),-1!=calcformat[i].indexOf("mixed")&&(str=str.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),o=str.match(/^\s*$/)?"":str.match(/oo$/)||str.match(/oo\W/)?str:str.match(/DNE/i)?str.toUpperCase():scopedmatheval(str),r[d]=o;document.getElementById("qn"+i).value=r.join(",")}for(i in matcalctoproc){if(i=parseInt(i),null!=matsize[i]){if(null==document.getElementById("qn"+i+"-0"))continue;msize=matsize[i].split(","),str=matrixcalc("qn"+i,null,msize[0],msize[1])}else{if(null==document.getElementById("tc"+i))continue;str=matrixcalc("tc"+i,null)}document.getElementById("qn"+i).value=str}for(i in ntupletoproc)i=parseInt(i),null!=document.getElementById("tc"+i)&&(str=ntuplecalc("tc"+i,null,calcformat[i]),document.getElementById("qn"+i).value=str);for(i in complextoproc)i=parseInt(i),null!=document.getElementById("tc"+i)&&(str=complexcalc("tc"+i,null,calcformat[i]),document.getElementById("qn"+i).value=str);for(i in functoproc)if(i=parseInt(i),null!=document.getElementById("tc"+i)){if(str=document.getElementById("tc"+i).value,str=str.replace(/,/g,""),str=normalizemathunicode(str),u=AMnumfuncPrepVar(i,str),str=u[0],varlist=u[2],1==iseqn[i])str=str.replace(/(.*)=(.*)/,"$1-($2)");else if(str.match("="))continue;for(fl=flist[i],""!=fl&&(reg=new RegExp("("+fl+")\\(","g"),str=str.replace(reg,"$1*sin($1+")),vars=varlist.split("|"),(p=document.getElementById("qn"+i)).value=mathjs(str,varlist),ptlist=pts[i].split(","),vals=new Array,m=0;m<ptlist.length;m++){for(inputs=ptlist[m].split("~"),totest="",h=0;h<inputs.length;h++)totest+="var "+vars[h]+"="+inputs[h]+";";""==p.value?totest+=Math.random()+";":totest+=prepWithMath(p.value)+";";try{vals[m]=scopedeval(totest)}catch(e){vals[m]=NaN}"synerr"==vals[m]&&(vals[m]=NaN)}document.getElementById("qn"+i+"-vals").value=vals.join(",")}return!0}function scopedeval(c){try{return eval(c)}catch(e){return"synerr"}}function scopedmatheval(c){if(c.match(/^\s*[a-df-zA-Z]\s*$/))return"";try{return eval(prepWithMath(mathjs(c)))}catch(e){return""}}function arraysearch(e,t){for(var a=0;a<t.length;a++)if(t[a]==e)return a;return-1}function toggleinlinebtn(e,t){var a,i=document.getElementById(t),s=document.getElementById(e);"none"==s.style.display?(s.style.display="",s.setAttribute("aria-hidden",!1),i.setAttribute("aria-expanded",!0)):(s.style.display="none",s.setAttribute("aria-hidden",!0),i.setAttribute("aria-expanded",!1)),a=i.innerHTML,i.innerHTML=a.match(/\[\+\]/)?a.replace(/\[\+\]/,"[-]"):a.replace(/\[\-\]/,"[+]")}function assessbackgsave(){var e=this;window.clearTimeout(backgsavetimer),backgsavetimer=window.setTimeout(function(){doassessbackgsave(e)},500)}function doassessbackgsave(e){var t,a,i,s=$(e).attr("name").match(/^(qs|qn|tc)(\d+)/);null!==s&&window.FormData&&(1e3<=(t=1*s[2])&&(t=Math.floor(t/1e3+.001)-1),"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave(),doonsubmit(),a=new FormData,i=new RegExp("^(qn|tc|qs)("+t+"\\b|"+(t+1)+"\\d{3})"),$("input,select,textarea").each(function(e,t){t.name.match(i)&&("radio"!=t.type&&"checkbox"!=t.type||t.checked)&&("file"==t.type?a.append(t.name,t.files[0]):a.append(t.name,t.value))}),a.append("backgroundsaveforlater",1),a.append("tosaveqn",t),a.append("asidverify",document.getElementById("asidverify").value),a.append("disptime",document.getElementById("disptime").value),a.append("isreview",document.getElementById("isreview").value),$.ajax({type:"POST",url:window.location.origin+window.location.pathname,data:a,contentType:!1,processData:!1,qn:t}).done(function(e){-1!=assessFormIsDirty.indexOf(1*this.qn)&&assessFormIsDirty.splice(assessFormIsDirty.indexOf(1*this.qn),1)}))}function assessbackgsubmit(qn,noticetgt){var params,useFormData,tosubFormData,els,tags,i,regex,options;if(qn=parseInt(qn),!confirmSubmit($("#embedqwrapper"+qn)[0]))return!1;for("undefined"!=typeof tinyMCE&&tinyMCE.triggerSave(),doonsubmit(),params={},useFormData=!!window.FormData,useFormData&&(tosubFormData=new FormData),els=new Array,tags=document.getElementsByTagName("input"),i=0;i<tags.length;i++)els.push(tags[i]);for(tags=document.getElementsByTagName("select"),i=0;i<tags.length;i++)els.push(tags[i]);for(tags=document.getElementsByTagName("textarea"),i=0;i<tags.length;i++)els.push(tags[i]);for(regex=null!=qn?new RegExp("^(qn|tc|qs)("+qn+"\\b|"+(qn+1)+"\\d{3})"):new RegExp("^(qn|tc|qs)"),i=0;i<els.length;i++)els[i].name.match(regex)&&("radio"!=els[i].type&&"checkbox"!=els[i].type||els[i].checked)&&(useFormData?"file"==els[i].type?tosubFormData.append(els[i].name,els[i].files[0]):tosubFormData.append(els[i].name,els[i].value):"file"==els[i].type?alert("File upload submissions are not supported by this browser"):params[els[i].name]=els[i].value);null!==qn?useFormData?(tosubFormData.append("toscore",qn),tosubFormData.append("verattempts",document.getElementById("verattempts"+qn).value)):(params.toscore=qn,params.verattempts=document.getElementById("verattempts"+qn).value):useFormData?tosubFormData.append("verattempts",document.getElementById("verattempts").value):params.verattempts=document.getElementById("verattempts").value,useFormData?(tosubFormData.append("asidverify",document.getElementById("asidverify").value),tosubFormData.append("disptime",document.getElementById("disptime").value),tosubFormData.append("isreview",document.getElementById("isreview").value)):(params.asidverify=document.getElementById("asidverify").value,params.disptime=document.getElementById("disptime").value,params.isreview=document.getElementById("isreview").value),options={type:"POST",url:assesspostbackurl,data:useFormData?tosubFormData:params,dataType:"text",qn:qn,noticetgt:noticetgt},useFormData&&(options.contentType=!1,options.processData=!1),$.ajax(options).done(function(msg){var qn,scripts,resptxt,s,s_e,e,e_e,i,foo,qnlen,pagescroll,B,D,elpos;if(null!=this.noticetgt&&(document.getElementById(this.noticetgt).innerHTML=""),null!==this.qn){for(qn=this.qn,scripts=new Array,resptxt=msg;-1<resptxt.indexOf("<script")||-1<resptxt.indexOf("</script");)s=resptxt.indexOf("<script"),s_e=resptxt.indexOf(">",s),e=resptxt.indexOf("</script",s),e_e=resptxt.indexOf(">",e),scripts.push(resptxt.substring(s_e+1,e)),resptxt=resptxt.substring(0,s)+resptxt.substring(e_e+1);for(document.getElementById("embedqwrapper"+qn).innerHTML=resptxt,usingASCIIMath&&rendermathnode(document.getElementById("embedqwrapper"+qn)),usingASCIISvg&&setTimeout("drawPics()",100),usingTinymceEditor&&initeditor("textareas","mceEditor"),initstack.length=0,i=0;i<scripts.length;i++)try{(k=scripts[i].match(/canvases\[(\d+)\]/))&&("undefined"!=typeof G_vmlCanvasManager&&(scripts[i]=scripts[i]+'G_vmlCanvasManager.initElement(document.getElementById("canvas'+k[1]+'"));'),scripts[i]=scripts[i]+"imathasDraw.initCanvases("+k[1]+");"),eval(scripts[i])}catch(e){}for(i=0;i<initstack.length;i++)foo=initstack[i]();for(i in qnlen=(qn+1).toString().length,LivePreviews)(i==qn||999<i&&i.toString().substr(0,qnlen)==qn+1)&&LivePreviews[i].Init();$(window).trigger("ImathasEmbedReload",[qn]),-1!=assessFormIsDirty.indexOf(1*qn)&&assessFormIsDirty.splice(assessFormIsDirty.indexOf(1*qn),1),$("#embedqwrapper"+qn).find("input,textarea").on("change",trackDirty),pagescroll=0,pagescroll=void 0!==window.pageYOffset?window.pageYOffset:(B=document.body,D=document.documentElement,D=D.clientHeight?D:B,D.scrollTop),elpos=findPos(document.getElementById("embedqwrapper"+qn))[1],elpos<pagescroll&&setTimeout(function(){window.scroll(0,elpos)},150)}}).fail(function(e){null!=this.noticetgt&&(document.getElementById(this.noticetgt).innerHTML=_("Submission Error"))})}function embedEnterHandler(e){$("#"+e+" input[type=text][name^=qn]").off("keydown.embedenterhandler").on("keydown.embedenterhandler",function(e){if(13==e.which){e.preventDefault();var t=parseInt($(this).closest(".embedqwrapper").attr("id").substr(13));assessbackgsubmit(t,"submitnotice"+t)}})}function AutoSuggest(e,t){var a,s,n,r,l,c,o=this;this.elem=e,this.suggestions=t,this.eligible=new Array,this.inputText=null,this.highlighted=-1,this.div=document.getElementById("autosuggest"),null==this.div&&(this.div=document.createElement("div"),this.div.id="autosuggest",document.getElementsByTagName("body")[0].appendChild(this.div),this.div.appendChild(document.createElement("ul"))),a=9,s=27,n=38,r=40,l=13,e.setAttribute("autocomplete","off"),e.id||(c="autosuggest"+AutoSuggestIdCounter,AutoSuggestIdCounter++,e.id=c),e.onkeydown=function(e){var t=o.getKeyCode(e);switch(t){case a:o.useSuggestion("tab");break;case l:return o.useSuggestion("enter"),!1;case s:o.hideDiv();break;case n:0<o.highlighted&&o.highlighted--,o.changeHighlight(t);break;case r:o.highlighted<o.eligible.length-1&&o.highlighted++,o.changeHighlight(t)}},e.onkeyup=function(e){switch(o.getKeyCode(e)){case a:case s:case n:case r:return;default:1<this.value.length?(o.inputText=this.value,o.getEligible(),0<o.eligible.length?o.highlighted=0:o.highlighted=-1,o.createDiv(),o.positionDiv(),o.showDiv()):(o.hideDiv(),0==this.value.length&&(o.inputText=""))}},e.onblur=function(e){setTimeout(o.hideDiv,100)},this.useSuggestion=function(e){-1<this.highlighted&&(this.elem.value=this.eligible[this.highlighted]),this.hideDiv()},this.showDiv=function(){this.div.style.display="block"},this.hideDiv=function(){o.div.style.display="none",o.highlighted=-1},this.changeHighlight=function(){var e,t=this.div.getElementsByTagName("LI");for(i in t)e=t[i],this.highlighted==i?e.className="selected":e.className=""},this.positionDiv=function(){var e=this.elem,t=findPos(e);t[1]+=e.offsetHeight,this.div.style.left=t[0]+"px",this.div.style.top=t[1]+"px"},this.createDiv=function(){var e,t,a,s=document.createElement("ul");for(i in this.eligible)e=this.eligible[i],t=document.createElement("li"),(a=document.createElement("a")).href="#",a.onclick=function(){return!1},a.innerHTML=e,t.appendChild(a),o.highlighted==i&&(t.className="selected"),s.appendChild(t);this.div.replaceChild(s,this.div.childNodes[0]),s.onmouseover=function(e){for(var t,a=o.getEventSource(e);a.parentNode&&"LI"!=a.tagName.toUpperCase();)a=a.parentNode;for(i in t=o.div.getElementsByTagName("LI"))if(t[i]==a){o.highlighted=i;break}o.changeHighlight()},s.onclick=function(e){return o.useSuggestion("click"),o.hideDiv(),o.cancelEvent(e),!1},this.div.className="suggestion_list",this.div.style.position="absolute"},this.getEligible=function(){var e,t;if(this.eligible=new Array,",",-1==this.inputText.indexOf(" "))for(i in e=new RegExp("\\b"+this.inputText.toLowerCase()),this.suggestions)(t=this.suggestions[i]).toLowerCase().match(e)&&(this.eligible[this.eligible.length]=t,i+",")},this.getKeyCode=function(e){return e?e.keyCode:window.event?window.event.keyCode:void 0},this.getEventSource=function(e){return e?e.target:window.event?window.event.srcElement:void 0},this.cancelEvent=function(e){e&&(e.preventDefault(),e.stopPropagation()),window.event&&(window.event.returnValue=!1)}}function isBlank(e){return!e||0===e.length||/^\s*$/.test(e)}function editdebit(e){var t=$("#qn"+(1*e.id.substr(2)-1));!isBlank(e.value)&&t.hasClass("iscredit")&&(t.is("select")?t.css("margin-right",20):t.width(t.width()+20),t.css("padding-left",0),t.removeClass("iscredit"))}function editcredit(e){var t=$("#qn"+(1*e.id.substr(2)-2));isBlank(e.value)||t.hasClass("iscredit")||(t.is("select")?t.css("margin-right",0):t.width(t.width()-20),t.css("padding-left",20),t.addClass("iscredit"))}function initcreditboxes(){$(".creditbox").each(function(e,t){if(!isBlank(t.value)&&20!=$(t).css("padding-left")){var a=$("#qn"+(1*t.id.substr(2)-2));a.is("select")?a.css("margin-right",0):a.width(a.width()-20),a.css("padding-left",20),a.addClass("iscredit")}})}function initqsclickchange(){$("input[id^=qs][value=spec]").each(function(e,t){$(t).siblings("input[type=text]").off("keyup.qsclickchange").on("keyup.qsclickchange",function(e){8!=e.keyCode&&46!=e.keyCode&&$(t).prop("checked",!0)})})}function initShowAnswer(){$("input.sabtn + span.hidden").attr("aria-hidden",!0),$("input.sabtn").each(function(){var e=$(this).siblings("span:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",e).off("click.sashow").on("click.sashow",function(){"true"==$(this).attr("aria-expanded")?$(this).attr("aria-expanded",!1).siblings("span:first-of-type").attr("aria-hidden",!0).addClass("hidden"):$(this).attr("aria-expanded",!0).siblings("span:first-of-type").attr("aria-hidden",!1).removeClass("hidden")})}),$("input.dsbtn + div.hidden").attr("aria-hidden",!0),$("input.dsbtn").each(function(){var e=$(this).siblings("div:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",e).off("click.sashow").on("click.sashow",function(){"true"==$(this).attr("aria-expanded")?$(this).attr("aria-expanded",!1).siblings("div:first-of-type").attr("aria-hidden",!0).addClass("hidden"):$(this).attr("aria-expanded",!0).siblings("div:first-of-type").attr("aria-hidden",!1).removeClass("hidden")})})}function assessmentTimer(a,i){var s,n,r,l,c,o,d=Date.now();c=setInterval(function(){var e,t;if((s=a-Math.floor((Date.now()-d)/1e3))<=0){if(s=0,clearInterval(c),i)return document.getElementById("timelimitholder").className="noticetext",document.getElementById("timelimitholder").innerHTML=_("Time limit expired - submitting now"),document.getElementById("timelimitholder").style.fontSize="300%",null==document.getElementById("qform")?void setTimeout("window.location.href='"+imasroot+"/assessment/showtest.php?action=skip&superdone=true'",2e3):(t=(e=document.getElementById("qform")).getAttribute("action"),e.setAttribute("action",t+"&superdone=true"),doonsubmit(e,!0,!0)&&setTimeout('document.getElementById("qform").submit()',2e3),0);alert(_("Time Limit has elapsed"))}l=Math.floor(s%60),r=Math.floor(s/60%60),0==(n=Math.floor(s/3600))&&r<5&&(document.getElementById("timeremaining").className="noticetext"),0==n&&0==r&&l<=5&&(document.getElementById("timeremaining").style.fontSize="150%"),o=(0<n?n+":":"")+(0<n&&r<10?"0":"")+r+":"+(l<10?"0":"")+l,document.getElementById("timeremaining").innerHTML=o},1e3),$(document).ready(function(){var e=$("#timerwrap"),t=e.position();$(window).scroll(function(){$(window).scrollTop()>=t.top?e.addClass("sticky"):e.removeClass("sticky")})})}function toggletimer(){"[x]"==$("#timerhide").text()?($("#timercontent").hide(),$("#timerhide").text("["+_("Show Timer")+"]"),$("#timerhide").attr("title","["+_("Show Timer")+"]")):($("#timercontent").show(),$("#timerhide").text("[x]"),$("#timerhide").attr("title",_("Hide Timer")))}function toggleintroshow(e){var t=document.getElementById("introtoggle"+e),a=document.getElementById("intropiece"+e);t.innerHTML.match("Hide")?(t.innerHTML=t.innerHTML.replace("Hide","Show"),$(t).attr("aria-expanded",!1),a.style.display="none",$(a).attr("aria-hidden",!0).attr("aria-expanded",!1)):(t.innerHTML=t.innerHTML.replace("Show","Hide"),$(t).attr("aria-expanded",!0),a.style.display="block",$(a).attr("aria-hidden",!1).attr("aria-expanded",!0))}function togglemainintroshow(e){$("#intro").hasClass("hidden")?($(e).html(_("Hide Intro/Instructions")).attr("aria-expanded",!0),$("#intro").removeClass("hidden").addClass("intro").attr("aria-hidden",!1).attr("aria-expanded",!0)):($("#intro").addClass("hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),$(e).html(_("Show Intro/Instructions")).attr("aria-expanded",!1))}function prepWithMath(e){return e=(e=(e=e.replace(/\b(abs|acos|asin|atan|ceil|floor|cos|sin|tan|sqrt|exp|max|min|pow)\(/g,"Math.$1(")).replace(/\(E\)/g,"(Math.E)")).replace(/\((PI|pi)\)/g,"(Math.PI)")}function trackDirty(){var e,t=$(this).attr("name"),a=t.match(/^(qs|qn|tc)(\d+)/);null!==a&&(1e3<(e=1*a[2])&&(e=Math.floor(e/1e3+.001)-1),-1==assessFormIsDirty.indexOf(e)&&assessFormIsDirty.push(e))}onlyAscii=/^[\u0000-\u007f]*$/,LivePreviews=[],greekletters=["alpha","beta","chi","delta","epsilon","gamma","varphi","phi","psi","sigma","rho","theta","lambda","mu","nu","omega","tau"],calctoproc={},intcalctoproc={},calcformat={},functoproc={},matcalctoproc={},ntupletoproc={},complextoproc={},callbackstack={},matsize={},vlist={},flist={},pts={},iseqn={},backgsavetimer=null,$(window).on("ImathasEmbedReload",function(e,t){embedEnterHandler("embedqwrapper"+t)}),AutoSuggestIdCounter=0,initstack.push(initcreditboxes),$(window).on("ImathasEmbedReload",initcreditboxes),$(window).on("ImathasEmbedReload",initqsclickchange),initstack.push(initqsclickchange),$(window).on("ImathasEmbedReload",initShowAnswer),initstack.push(initShowAnswer),assessFormIsDirty=[],$(function(){$("div.question").find("input,select,textarea").on("change",trackDirty),$(window).on("beforeunload",function(){if(0==$("form.submitted,form.submitted2").length&&0<assessFormIsDirty.length)return _("Are you sure you want to leave this assessment? You may have unsubmitted work")})});
function checkComplete(e){if("undefined"!=typeof tinyMCE)try{tinyMCE.triggerSave()}catch(e){}var n=!0;return $(e).find("input:visible,textarea:visible,select:visible").each(function(e,t){if(void 0===t.type||void 0===t.name||""==t.name)return 1;"text"==t.type||"textarea"==t.type||"password"==t.type||"file"==t.type?""==t.value&&0==$("#qs"+t.id.substr(2)+"-d:checked,#qs"+t.id.substr(2)+"-i:checked").length&&(n=!1):-1!=t.type.indexOf("select")?(-1==t.selectedIndex||"qn"==t.name.substr(0,2)&&0==t.selectedIndex)&&(n=!1):"radio"==t.type&&0==$("input[name="+t.name+"]:checked").length&&(n=!1)}),n}function confirmSubmit(e){var t=checkComplete(e);return!!t||confirm("Not all question parts have been answered.  Are you sure you want to submit this question?")}function confirmSubmit2(e){var t=checkComplete(e);return!!t||confirm("Not all questions have been answered completely.  If you are saving your answers for later, this is fine.  If you are submitting for grading, are you sure you want to submit now?")}
var canvases=new Array,drawla=new Array,imathasDraw=function($){var clickcnt,lastdrawmouseup,mouseintarget,normslider,drawexport,mouseisdown=!1,targets=new Array,imgs=new Array,targetOuts=new Array,lines=new Array,dots=new Array,odots=new Array,tplines=new Array,tptypes=new Array,ineqlines=new Array,ineqtypes=new Array,curLine=null,drawstyle=[],drawlocky=[],curTPcurve=null,curIneqcurve=null,ineqcolors=["rgb(0,0,255)","rgb(255,0,0)","rgb(0,255,0)"],ineqacolors=["rgba(0,0,255,.4)","rgba(255,0,0,.4)","rgba(0,255,0,.4)"],asymcolor="rgb(0,200,0)",dragObj=null,oldpointpos=null,curTarget=null,curCursor=null,nocanvaswarning=!1,hasTouch=!1,didMultiTouch=!1,clickmightbenewcurve=!1,hasTouchTimer=null,tpModeN={5:2,5.2:2,5.3:2,5.4:2,6:2,6.1:2,6.3:2,6.5:2,6.6:2,7:2,7.2:2,7.4:2,7.5:2,8:2,8.2:2,8.3:2,8.4:2,8.5:3,8.6:3,9:2,9.1:2,10:3,10.2:3,10.3:3,10.4:3},tpHasAsymp={7.4:1,7.5:1,8.2:1,8.5:1,8.6:1};function reset(){clearAllDrawListners(),targets.length=0,imgs.length=0,targetOuts.length=0,lines.length=0,dots.length=0,odots.length=0,tplines.length=0,tptypes.length=0,ineqlines.length=0,ineqtypes.length=0,drawstyle.length=0,drawlocky.length=0,curIneqcurve=curTPcurve=dragObj=curLine=curTarget=null}function clearcanvas(e){targetOuts[e].disabled||(lines[e].length=0,dots[e].length=0,odots[e].length=0,tplines[e].length=0,tptypes[e].length=0,ineqlines[e].length=0,ineqtypes[e].length=0,"canvas"==targets[curTarget=e].type&&drawTarget(),dragObj=curLine=curTarget=null)}function clearlastline(e){0<lines[e].length&&(lines[e].length=lines[e].length-1),curTarget=e,drawTarget(),dragObj=curLine=curTarget=null}function addA11yTarget(e,t){var r,a,n,i,s,g,l,u,o,c,d,T,p,h,m,y=e[0],w=e[1].substr(9).split(","),f=e[2],v=e[3],b=e[4],q=e[5];for(b==q&&(b=-1,q=1),r=e[6],a=e[7],n=e[8],null==(i=document.getElementById("a11ydraw"+y))&&(s=document.getElementById("canvas"+y))&&(g=$("<div>").append($("<p>",{text:_("Drawn Elements:")})),(i=document.createElement("ul")).setAttribute("id","allydraw"+y),g.append(i),$(s).replaceWith(g)),targetOuts[y]=document.getElementById("qn"+y),targetOuts[y].disabled&&(document.getElementById("a11ydrawnew"+y).disabled=!0,$(".a11ydrawadd[data-qn="+y+"]").prop("disabled",!0)),targets[y]={type:"a11y",el:i,xmin:f,xmax:v,ymin:b,ymax:q,imgborder:r,imgwidth:a,imgheight:n},targets[y].pixperx=(a-2*r)/(v-f),targets[y].pixpery=b==q?1:(n-2*r)/(q-b),"inequality"==w[0]?(l=w.shift(),0==w.length?w=["line"]:"both"==w[0]&&(w=["line","parab"])):"twopoint"==w[0]?(l=w.shift(),0==w.length&&(w=["line","parab","abs","circle","dot"])):"numberline"==w[0]?(l="basic",w.shift()):l="basic",targets[y].afgroup=l,u={inequality:{line:[{mode:10,descr:_("Linear inequality with solid line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")},{mode:10.2,descr:_("Linear inequality with dashed line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")}],parab:[{mode:10.3,descr:_("Parabolic inequality with solid line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")},{mode:10.4,descr:_("Parabolic inequality with dashed line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")}]},twopoint:{line:[{mode:5,descr:_("Line"),inN:2,input:_("Enter two points on the line")}],lineseg:[{mode:5.3,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],ray:[{mode:5.2,descr:_("Ray"),inN:2,input:_("Enter the starting point of the ray and another point on the ray")}],parab:[{mode:6,descr:_("Parabola"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],horizparab:[{mode:6.1,descr:_("Parabola opening right or left"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],cubic:[{mode:6.3,descr:_("Cubic"),inN:2,input:_("Enter the inflection point, then another point on the cubic")}],cuberoot:[{mode:6.6,descr:_("Cube root"),inN:2,input:_("Enter the inflection point of the cube root, then another point on the graph")}],abs:[{mode:8,descr:_("Absolute value"),inN:2,input:_("Enter the corner point of the absolute value, then another point on the graph")}],rational:[{mode:8.2,descr:_("Rational"),inN:2,input:_("Enter the point where the vertical and horizontal asymptote cross, then a point on the graph")}],exp:[{mode:8.3,descr:_("Exponential"),inN:2,input:_("Enter two points on the graph")}],log:[{mode:8.4,descr:_("Logarithm"),inN:2,input:_("Enter two points on the graph")}],genexp:[{mode:8.5,descr:_("Shifted Exponential"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],genlog:[{mode:8.6,descr:_("Shifted Logarithm"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],circle:[{mode:7,descr:_("Circle"),inN:2,input:_("Enter the center point of the circle, then a point on the graph")}],ellipse:[{mode:7.2,descr:_("Ellipse"),inN:2,input:_("Enter the center point of the ellipse, then a point offset from the center by the horizontal radius and vertical radius")}],hyperbola:[{mode:7.4,descr:_("Vertical hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the co-vertex and y is the y-coordinate of the vertex")},{mode:7.5,descr:_("Horizontal hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the vertex and y is the y-coordinate of the co-vertex")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],trig:[{mode:9,descr:_("Cosine"),inN:2,input:_("Enter a point at the start of a phase, then a point half a phase further")},{mode:9.2,descr:_("Sine"),inN:2,input:_("Enter a point at the start of a phase, then a point a quarter phase further")}],vector:[{mode:5.4,descr:_("Vector"),inN:2,input:_("Enter the starting and ending point of the vector")}]},basic:{line:[{mode:0,descr:_("Lines"),inN:"list",input:_("Enter a list of points to connect with lines")}],lineseg:[{mode:.5,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],freehand:[{mode:.7,descr:_("Freehand"),inN:"list",input:_("Enter a list of points to connect with lines")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],polygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter a list of points for dots to connect with lines"),dotline:1}],closedpolygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter a list of points for dots to connect with lines"),dotline:2}]}},c=[],d=[],T=[],h=0;h<w.length;h++)if(u[l].hasOwnProperty(w[h]))for(0==h&&(o=u[l][w[h]][0].mode),m=0;m<u[l][w[h]].length;m++)T[u[l][w[h]][m].mode]=u[l][w[h]][m],c.push(u[l][w[h]][m].mode),p='<option value="'+u[l][w[h]][m].mode+'"',p+=' data-af="'+w[h]+'">'+u[l][w[h]][m].descr+"</option>",d.push(p);if(document.getElementById("a11ydrawnew"+y).innerHTML=d,targets[y].defmode=o,targets[y].inputmodes=c,targets[y].selects=d,targets[y].moderef=T,null==t&&lines.hasOwnProperty(y)){for(h=0;h<lines[y].length;h++)adda11ydraw(y,0,pixcoordstopointlist(lines[y][h],y));for(h=0;h<dots[y].length;h++)adda11ydraw(y,1,pixcoordstopointlist(dots[y][h],y));for(h=0;h<odots[y].length;h++)adda11ydraw(y,2,pixcoordstopointlist(odots[y][h],y));for(h=0;h<tplines[y].length;h++)adda11ydraw(y,tptypes[y][h],pixcoordstopointlist(tplines[y][h][0],y)+","+pixcoordstopointlist(tplines[y][h][1],y));for(h=0;h<ineqlines[y].length;h++)adda11ydraw(y,ineqtypes[y][h],pixcoordstopointlist(ineqlines[y][h][0],y)+","+pixcoordstopointlist(ineqlines[y][h][1],y)+","+pixcoordstopointlist(ineqlines[y][h][2],y))}else if(null!=t)for(h=0;h<t.length;h++)adda11ydraw(y,t[h][0],t[h][1].replace(/\[/g,"(").replace(/\]/g,")"))}function adda11ydraw(e,t,r){var a,n=targets[e],i=t||document.getElementById("a11ydrawnew"+e).value,s=r||"",g=(n.afgroup,n.el.getElementsByTagName("li").length+1),l=targetOuts[e].disabled?" disabled ":"",u='<span class="sr-only draweln">'+_("Drawing element ")+g+"</span>";html=u,html+=n.moderef[i].descr+".<br/>",html+='<label><span class="a11ydrawinstr"></span><br/>',html+='<input type="text" value="'+s+'" data-n="'+n.moderef[i].inN+'" '+l,html+='onblur="imathasDraw.updatea11ydraw(this)"/></label>',html+='<button type="button" class="imgbutton" onclick="imathasDraw.removea11ydraw(this)"'+l+">",html+=_("Remove")+" "+u+"</button>",a=$("<li>",{class:"a11ydrawrow","data-mode":i}).html(html),$(n.el).append(a),a.find(".a11ydrawinstr").text(n.moderef[i].input),r||a.find("input").focus()}function removea11ydraw(e){setariastatus(_("Removed drawing element"));var t=$(e).closest("ul");$(e).parent().remove(),t.find("li").each(function(e,t){var r=_("Drawing element ")+(e+1);$(t).find(".draweln").html(r)}),t.prev().focus(),encodea11ydraw(t.attr("id").substring(8))}function changea11ydraw(e,t){var r=$(e).val(),a=targets[t].moderef[r];$(e).closest("li").find(".a11ydrawinstr").text(a.input),encodea11ydraw()}function updatea11ydraw(e){var t,r,a,n,i,s,g=0,l=e.value.trim();for("("==l.charAt(0)&&")"==l.slice(-1)||(g|=1),t=l.slice(1,-1).split(/\)\s*,\s*\(/),(r=e.getAttribute("data-n")).match(/\d/)&&t.length!=parseInt(r)&&(g|=2),a=0;a<t.length;a++)for(2!=(n=t[a].split(/,/)).length&&(g|=1),i=0;i<n.length;i++)0==n[i].trim().length&&(g|=1);"noticetext"==e.parentNode.parentNode.lastChild.className&&e.parentNode.parentNode.removeChild(e.parentNode.parentNode.lastChild),g?(e.setAttribute("aria-invalid",!0),(s=document.createElement("span")).id=uniqid("a11ydrawerr"),s.className="noticetext",1==(1&g)?(s.innerHTML="<br>"+_("Error: Invalid format for points. Give points as open parenthesis number comma number close parenthesis. Separate points with a comma."),setariastatus(_("Error: Invalid format for points"))):(s.innerHTML="<br>"+_("Error: Incorrect number of points. Expecting ")+r,setariastatus(_("Error: Incorrect number of points"))),e.parentNode.parentNode.appendChild(s),e.setAttribute("aria-describedby",s.id)):(e.removeAttribute("aria-invalid"),e.removeAttribute("aria-describedby"),setariastatus("")),encodea11ydraw(parseInt($(e).closest(".a11ydraw").attr("id").substring(8)))}function pixcoordstopointlist(e,t){var r=targets[t],a=(e[0]-r.imgborder)/r.pixperx+r.xmin,n=(r.imgheight-e[1]-r.imgborder)/r.pixpery+r.ymin;return"("+(a=Math.round(100*a)/100)+","+(n=Math.round(100*n)/100)+")"}function encodea11ydraw(qn){var tarnum,thistarg,lines,dots,odots,tplines,tpineq,saveinput,afgroup;for(tarnum in void 0===qn&&(qn=-1),targets)-1<qn&&qn!=tarnum||(thistarg=targets[tarnum],"a11y"==thistarg.type&&(lines=[],dots=[],odots=[],tplines=[],tpineq=[],saveinput=[],afgroup=targets[tarnum].afgroup,$("#a11ydraw"+tarnum).find(".a11ydrawrow").each(function(i,el){var outpts,input=$(el).find("input").val(),mode=el.getAttribute("data-mode");for(saveinput.push("["+mode+',"'+input+'"]'),input=input.replace(/[\(\)]/g,"").split(/\s*,\s*/),outpts=[],i=1;i<input.length;i+=2){try{input[i-1]=eval(prepWithMath(mathjs(input[i-1])))}catch(e){input[i-1]=NaN}try{input[i]=eval(prepWithMath(mathjs(input[i])))}catch(e){input[i]=NaN}input[i-1]=(input[i-1]-thistarg.xmin)*thistarg.pixperx+thistarg.imgborder,input[i]=thistarg.imgheight-(input[i]-thistarg.ymin)*thistarg.pixpery-thistarg.imgborder,outpts.push(Math.round(input[i-1])+","+Math.round(input[i]))}1==mode?dots.push("("+outpts.join("),(")+")"):2==mode?odots.push("("+outpts.join("),(")+")"):mode<1?lines.push("("+outpts.join("),(")+")"):5<=mode&&mode<10&&2==outpts.length?tplines.push("("+mode+","+outpts.join(",")+")"):10<=mode&&3==outpts.length&&tpineq.push("("+mode+","+outpts.join(",")+")")}),targetOuts[tarnum].value=lines.join(";")+";;"+dots.join(",")+";;"+odots.join(",")+";;"+tplines.join(",")+";;"+tpineq.join(",")+";;"+saveinput.join(","),$(targetOuts[tarnum]).trigger("input").trigger("change")))}function addTarget(t,e,r,a,n,i,s,g,l,u,o,c,d,T,p){var h,m,y=document.getElementById(e);$(y).is(":hidden")&&$(y).on("mouseover.imathasdrawwait touchstart.imathasdrawwait",function(){$(y).off("mouseover.imathasdrawwait touchstart.imathasdrawwait"),initCanvases(t)}),y.style.userSelect="none",y.style.webkitUserSelect="none",y.style.MozUserSelect="none",h=getPosition(y),targets[t]={type:"canvas",el:y,left:h.x,top:h.y,width:y.offsetWidth,height:y.offsetHeight,xmin:n,xmax:i,ymin:s,ymax:g,imgborder:l,imgwidth:u,imgheight:o,mode:c,dotline:d},"string"==typeof p&&-1!=p.indexOf(":")?(p=p.split(":"),targets[t].snaptogridx=1*p[0],targets[t].snaptogridy=1*p[1]):(targets[t].snaptogridx=1*p,targets[t].snaptogridy=1*p),targets[t].pixperx=(u-2*l)/(i-n),targets[t].pixpery=s==g?1:(o-2*l)/(g-s),targetOuts[t]=document.getElementById(a),null==lines[t]&&(lines[t]=new Array),null==dots[t]&&(dots[t]=new Array),null==odots[t]&&(odots[t]=new Array),null==tplines[t]&&(tplines[t]=new Array),null==tptypes[t]&&(tptypes[t]=new Array),null==ineqlines[t]&&(ineqlines[t]=new Array),null==ineqtypes[t]&&(ineqtypes[t]=new Array),drawstyle[t]=5<=c?1:0,drawlocky[t]=T,r.match(/initPicture/)?(0==$(y).closest(".drawcanvasholder").length&&($(y).removeClass("drawcanvas").wrap($("<div>",{class:"drawcanvas",style:"position:relative;width:"+u+"px;height:"+o+"px"})).wrap($("<div>",{class:"drawcanvasholder",style:"position:absolute;top:0;left:0;z-index:2"})),$(y).closest(".drawcanvas").prepend($("<div>",{class:"canvasbg",style:"position:absolute;top:0;left:0"}).append($("<embed>",{"data-nomag":1,type:"image/svg+xml",align:"middle",width:u,height:o,script:r}).attr("width",u).attr("height",o)))),imgs[t]=null,m=curTarget,curTarget=t,drawTarget(),setTimeout(function(){window.drawPics($(y).closest(".drawcanvas")[0])},30),curTarget=m):""!==r?(imgs[t]=new Image,imgs[t].onload=function(){var e=curTarget;curTarget=t,drawTarget(),curTarget=e},imgs[t].src=r):(imgs[t]=null,m=curTarget,curTarget=t,drawTarget(),curTarget=m)}function settool(e,t,r){var a,n=document.getElementById("drawtools"+t),i=n.getElementsByTagName("span");for(a=0;a<i.length;a++)i[a].className="";for(i=n.getElementsByTagName("img"),a=0;a<i.length;a++)i[a].className="";e.className="sel",setDrawMode(t,r),curTarget=t,drawTarget()}function setDrawMode(e,t){targets[e].mode=t}function setDotLine(e,t){targets[e].dotline=t}function drawTarget(e,t){var r,a,n,i,s,g,l,u,o,c,d,T,p,h,m,y,w,f,v,b,q,x,M,O,L,j,P,E,I,_,N,$,k,B,C,A,S,D,W,R,H,z,U,F,Y,X,V,G,Q,J,K,Z,ee,te;try{r=targets[curTarget].el.getContext("2d")}catch(e){nocanvaswarning||(nocanvaswarning=!0,alert("Your browser does not support drawing answer entry.  Please try again using Internet Explorer 6+ (Windows), FireFox 1.5+ (Win/Mac), Safari 1.3+ (Mac), Opera 9+ (Win/Mac), or Camino (Mac)"))}for(r.fillStyle="rgb(0,0,255)",r.lineWidth=2,r.strokeStyle="rgb(0,0,255)",r.clearRect(0,0,targets[curTarget].imgwidth,targets[curTarget].imgheight),null!==imgs[curTarget]&&r.drawImage(imgs[curTarget],0,0),r.beginPath(),a=0;a<ineqlines[curTarget].length;a++){for(n=a%3,r.strokeStyle=ineqcolors[n],r.fillStyle=ineqcolors[n],u=l=g=s=i=null,3==ineqlines[curTarget][a].length?(s=ineqlines[curTarget][a][1][0],l=ineqlines[curTarget][a][1][1],g=ineqlines[curTarget][a][2][0],u=ineqlines[curTarget][a][2][1]):2==ineqlines[curTarget][a].length?(s=ineqlines[curTarget][a][1][0],l=ineqlines[curTarget][a][1][1],g=e,u=t):curIneqcurve==a&&null!=e&&1==ineqlines[curTarget][a].length&&(s=e,l=t),null!=g&&(r.save(),r.fillStyle=ineqacolors[n],r.beginPath(),ineqtypes[curTarget][a]<=10.2?(s!=ineqlines[curTarget][a][0][0]&&(i=(l-ineqlines[curTarget][a][0][1])/(s-ineqlines[curTarget][a][0][0])),Math.abs(s-ineqlines[curTarget][a][0][0])<1||100<Math.abs(i)?(r.moveTo(ineqlines[curTarget][a][0][0],0),r.lineTo(ineqlines[curTarget][a][0][0],targets[curTarget].imgheight),s<g?(r.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight),r.lineTo(targets[curTarget].imgwidth,0)):(r.lineTo(0,targets[curTarget].imgheight),r.lineTo(0,0))):(o=i*(g-s)+l,c=ineqlines[curTarget][a][0][1]-i*ineqlines[curTarget][a][0][0],d=ineqlines[curTarget][a][0][1]+i*(targets[curTarget].imgwidth-ineqlines[curTarget][a][0][0]),r.moveTo(0,c),r.lineTo(targets[curTarget].imgwidth,d),o<u?(r.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight),r.lineTo(0,targets[curTarget].imgheight)):(r.lineTo(targets[curTarget].imgwidth,0),r.lineTo(0,0))),r.closePath()):shadeParabola(r,ineqlines[curTarget][a][0][0],ineqlines[curTarget][a][0][1],s,l,g,u,targets[curTarget].imgwidth,targets[curTarget].imgheight),r.fill(),r.restore()),r.beginPath(),null!=s&&(ineqtypes[curTarget][a]<=10.2?(s!=ineqlines[curTarget][a][0][0]&&(i=(l-ineqlines[curTarget][a][0][1])/(s-ineqlines[curTarget][a][0][0])),Math.abs(s-ineqlines[curTarget][a][0][0])<1||100<Math.abs(i)?10.2==ineqtypes[curTarget][a]?null!=dragObj&&10<=dragObj.mode&&dragObj.mode<11&&dragObj.num==a&&0==dragObj.subnum?(r.dashedLine(ineqlines[curTarget][a][1][0],ineqlines[curTarget][a][1][1],ineqlines[curTarget][a][1][0],targets[curTarget].imgheight),r.dashedLine(ineqlines[curTarget][a][1][0],ineqlines[curTarget][a][1][1],ineqlines[curTarget][a][1][0],0)):(r.dashedLine(ineqlines[curTarget][a][0][0],ineqlines[curTarget][a][0][1],ineqlines[curTarget][a][0][0],targets[curTarget].imgheight),r.dashedLine(ineqlines[curTarget][a][0][0],ineqlines[curTarget][a][0][1],ineqlines[curTarget][a][0][0],0)):(r.moveTo(ineqlines[curTarget][a][0][0],0),r.lineTo(ineqlines[curTarget][a][0][0],targets[curTarget].imgheight),r.stroke()):(c=ineqlines[curTarget][a][0][1]-i*ineqlines[curTarget][a][0][0],d=ineqlines[curTarget][a][0][1]+i*(targets[curTarget].imgwidth-ineqlines[curTarget][a][0][0]),10.2==ineqtypes[curTarget][a]?null!=dragObj&&10<=dragObj.mode&&dragObj.mode<11&&dragObj.num==a&&0==dragObj.subnum?(r.dashedLine(ineqlines[curTarget][a][1][0],ineqlines[curTarget][a][1][1],targets[curTarget].imgwidth,d),r.dashedLine(ineqlines[curTarget][a][1][0],ineqlines[curTarget][a][1][1],0,c)):(r.dashedLine(ineqlines[curTarget][a][0][0],ineqlines[curTarget][a][0][1],targets[curTarget].imgwidth,d),r.dashedLine(ineqlines[curTarget][a][0][0],ineqlines[curTarget][a][0][1],0,c)):(r.moveTo(0,c),r.lineTo(targets[curTarget].imgwidth,d),r.stroke()))):10.3==ineqtypes[curTarget][a]?(s!=ineqlines[curTarget][a][0][0]&&(l==ineqlines[curTarget][a][0][1]?(r.moveTo(0,l),r.lineTo(targets[curTarget].imgwidth,l)):(T=(l-ineqlines[curTarget][a][0][1])/((s-ineqlines[curTarget][a][0][0])*(s-ineqlines[curTarget][a][0][0])),y=l>ineqlines[curTarget][a][0][1]?(p=Math.sqrt((targets[curTarget].imgheight-ineqlines[curTarget][a][0][1])/T)+ineqlines[curTarget][a][0][0],h=-1*Math.sqrt((targets[curTarget].imgheight-ineqlines[curTarget][a][0][1])/T)+ineqlines[curTarget][a][0][0],m=ineqlines[curTarget][a][0][1]-(targets[curTarget].imgheight-ineqlines[curTarget][a][0][1]),targets[curTarget].imgheight):(p=Math.sqrt((0-ineqlines[curTarget][a][0][1])/T)+ineqlines[curTarget][a][0][0],h=-1*Math.sqrt((0-ineqlines[curTarget][a][0][1])/T)+ineqlines[curTarget][a][0][0],m=2*ineqlines[curTarget][a][0][1],0),v=(w=p+2/3*(ineqlines[curTarget][a][0][0]-p))+(h-p)/3,b=f=y+2/3*(m-y),r.moveTo(p,y),r.bezierCurveTo(w,f,v,b,h,y))),r.stroke()):s!=ineqlines[curTarget][a][0][0]&&dashedParabola(r,ineqlines[curTarget][a][0][0],ineqlines[curTarget][a][0][1],s,l,targets[curTarget].imgwidth,targets[curTarget].imgheight)),r.beginPath(),q=0;q<ineqlines[curTarget][a].length;q++)2==q?(r.arc(ineqlines[curTarget][a][q][0],ineqlines[curTarget][a][q][1],4,0,2*Math.PI,!0),r.fill()):r.fillRect(ineqlines[curTarget][a][q][0]-3,ineqlines[curTarget][a][q][1]-3,6,6);1==ineqlines[curTarget][a].length&&null!=s&&r.fillRect(s-3,l-3,6,6),r.beginPath()}for(r.fillStyle="rgb(0,0,255)",1==drawlocky[curTarget]?r.lineWidth=4:r.lineWidth=2,r.strokeStyle="rgb(0,0,255)",a=0;a<tplines[curTarget].length;a++){if(5<=tptypes[curTarget][a]&&tptypes[curTarget][a]<6)l=s=i=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&(5.3==tptypes[curTarget][a]||5.4==tptypes[curTarget][a]?(r.moveTo(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1]),r.lineTo(s,l),5.4==tptypes[curTarget][a]&&(x=[s-tplines[curTarget][a][0][0],l-tplines[curTarget][a][0][1]],1e-4<(O=Math.sqrt(x[0]*x[0]+x[1]*x[1]))&&(M=[-(x=[x[0]/O,x[1]/O])[1],x[0]],r.moveTo(s-15*x[0]-4*M[0],l-15*x[1]-5*M[1]),r.lineTo(s,l),r.moveTo(s-15*x[0]+4*M[0],l-15*x[1]+5*M[1]),r.lineTo(s,l)))):(s!=tplines[curTarget][a][0][0]&&(i=(l-tplines[curTarget][a][0][1])/(s-tplines[curTarget][a][0][0])),Math.abs(s-tplines[curTarget][a][0][0])<1||100<Math.abs(i)?5.2==tptypes[curTarget][a]?(r.moveTo(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1]),l>tplines[curTarget][a][0][1]?r.lineTo(tplines[curTarget][a][0][0],targets[curTarget].imgheight):r.lineTo(tplines[curTarget][a][0][0],0)):(r.moveTo(tplines[curTarget][a][0][0],0),r.lineTo(tplines[curTarget][a][0][0],targets[curTarget].imgheight)):(c=tplines[curTarget][a][0][1]-i*tplines[curTarget][a][0][0],d=tplines[curTarget][a][0][1]+i*(targets[curTarget].imgwidth-tplines[curTarget][a][0][0]),c=tplines[curTarget][a][0][1]-i*tplines[curTarget][a][0][0],d=tplines[curTarget][a][0][1]+i*(targets[curTarget].imgwidth-tplines[curTarget][a][0][0]),5.2==tptypes[curTarget][a]?(r.moveTo(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1]),s>tplines[curTarget][a][0][0]?r.lineTo(targets[curTarget].imgwidth,d):r.lineTo(0,c)):(r.moveTo(0,c),r.lineTo(targets[curTarget].imgwidth,d)))));else if(6==tptypes[curTarget][a]||6.1==tptypes[curTarget][a])s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&(6==tptypes[curTarget][a]?l==tplines[curTarget][a][0][1]?(r.moveTo(0,l),r.lineTo(targets[curTarget].imgwidth,l)):s==tplines[curTarget][a][0][0]?(r.moveTo(s,tplines[curTarget][a][0][1]),l>tplines[curTarget][a][0][1]?r.lineTo(s,targets[curTarget].imgheight):r.lineTo(s,0)):(T=(l-tplines[curTarget][a][0][1])/((s-tplines[curTarget][a][0][0])*(s-tplines[curTarget][a][0][0])),y=l>tplines[curTarget][a][0][1]?(p=Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][a][0][1])/T)+tplines[curTarget][a][0][0],h=-1*Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][a][0][1])/T)+tplines[curTarget][a][0][0],m=tplines[curTarget][a][0][1]-(targets[curTarget].imgheight-tplines[curTarget][a][0][1]),targets[curTarget].imgheight):(p=Math.sqrt((0-tplines[curTarget][a][0][1])/T)+tplines[curTarget][a][0][0],h=-1*Math.sqrt((0-tplines[curTarget][a][0][1])/T)+tplines[curTarget][a][0][0],m=2*tplines[curTarget][a][0][1],0),v=(w=p+2/3*(tplines[curTarget][a][0][0]-p))+(h-p)/3,b=f=y+2/3*(m-y),r.moveTo(p,y),r.bezierCurveTo(w,f,v,b,h,y)):6.1==tptypes[curTarget][a]&&(s==tplines[curTarget][a][0][0]?(r.moveTo(s,0),r.lineTo(s,targets[curTarget].imgheight)):l==tplines[curTarget][a][0][1]?(r.moveTo(tplines[curTarget][a][0][0],l),s>tplines[curTarget][a][0][0]?r.lineTo(targets[curTarget].imgwidth,l):r.lineTo(0,l)):(T=(s-tplines[curTarget][a][0][0])/((l-tplines[curTarget][a][0][1])*(l-tplines[curTarget][a][0][1])),j=s>tplines[curTarget][a][0][0]?(p=Math.sqrt((targets[curTarget].imgwidth-tplines[curTarget][a][0][0])/T)+tplines[curTarget][a][0][1],h=-1*Math.sqrt((targets[curTarget].imgwidth-tplines[curTarget][a][0][0])/T)+tplines[curTarget][a][0][1],L=tplines[curTarget][a][0][0]-(targets[curTarget].imgwidth-tplines[curTarget][a][0][0]),targets[curTarget].imgwidth):(p=Math.sqrt((0-tplines[curTarget][a][0][0])/T)+tplines[curTarget][a][0][1],h=-1*Math.sqrt((0-tplines[curTarget][a][0][0])/T)+tplines[curTarget][a][0][1],L=2*tplines[curTarget][a][0][0],0),b=(f=p+2/3*(tplines[curTarget][a][0][1]-p))+(h-p)/3,v=w=j+2/3*(L-j),r.moveTo(j,p),r.bezierCurveTo(w,f,v,b,j,h))));else if(6.5==tptypes[curTarget][a]){if(s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&s!=tplines[curTarget][a][0][0])if(l==tplines[curTarget][a][0][1])r.moveTo(tplines[curTarget][a][0][0],l),s>tplines[curTarget][a][0][0]?r.lineTo(targets[curTarget].imgwidth,l):r.lineTo(0,l);else for(P=s<tplines[curTarget][a][0][0]?-1:1,T=(l-tplines[curTarget][a][0][1])/Math.sqrt(P*(s-tplines[curTarget][a][0][0])),r.moveTo(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1]),I=tplines[curTarget][a][0][0],E=tplines[curTarget][a][0][1];I+=3*P,r.lineTo(I,T*Math.sqrt(P*(I-tplines[curTarget][a][0][0]))+tplines[curTarget][a][0][1]),0<I&&I<targets[curTarget].imgwidth&&0<E&&E<targets[curTarget].imgheight;);}else if(6.3==tptypes[curTarget][a]){if(s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&s!=tplines[curTarget][a][0][0])if(l==tplines[curTarget][a][0][1])r.moveTo(0,l),r.lineTo(targets[curTarget].imgwidth,l);else for(T=(l-tplines[curTarget][a][0][1])/safepow(s-tplines[curTarget][a][0][0],3),I=E=0;I<targets[curTarget].imgwidth+4;I+=1)(E=T*safepow(I-tplines[curTarget][a][0][0],3)+tplines[curTarget][a][0][1])<-100&&(E=-100),E>targets[curTarget].imgheight+100&&(E=targets[curTarget].imgheight+100),0==I?r.moveTo(I,E):r.lineTo(I,E)}else if(6.6==tptypes[curTarget][a]){if(s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&s!=tplines[curTarget][a][0][0])if(l==tplines[curTarget][a][0][1])r.moveTo(0,l),r.lineTo(targets[curTarget].imgwidth,l);else for(T=(l-tplines[curTarget][a][0][1])/safepow(s-tplines[curTarget][a][0][0],1/3),I=E=0;I<targets[curTarget].imgwidth+4;I+=1)(E=T*safepow(I-tplines[curTarget][a][0][0],1/3)+tplines[curTarget][a][0][1])<-100&&(E=-100),E>targets[curTarget].imgheight+100&&(E=targets[curTarget].imgheight+100),0==I?r.moveTo(I,E):r.lineTo(I,E)}else if(7<=tptypes[curTarget][a]&&tptypes[curTarget][a]<8){if(s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&(s!=tplines[curTarget][a][0][0]||l!=tplines[curTarget][a][0][1]))if(7==tptypes[curTarget][a])_=Math.sqrt((s-tplines[curTarget][a][0][0])*(s-tplines[curTarget][a][0][0])+(l-tplines[curTarget][a][0][1])*(l-tplines[curTarget][a][0][1])),r.arc(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],_,0,2*Math.PI,!0);else if(7.2==tptypes[curTarget][a])N=Math.abs(s-tplines[curTarget][a][0][0]),$=Math.abs(l-tplines[curTarget][a][0][1]),(curTPcurve==a||null!=dragObj&&dragObj.num==a)&&(r.strokeStyle="rgb(0,255,255)",r.lineWidth=1,r.dashedLine(s,l,s-2*(s-tplines[curTarget][a][0][0]),l,5),r.dashedLine(s,l,s,l-2*(l-tplines[curTarget][a][0][1]),5),r.dashedLine(s,l-2*(l-tplines[curTarget][a][0][1]),s-2*(s-tplines[curTarget][a][0][0]),l-2*(l-tplines[curTarget][a][0][1]),5),r.dashedLine(s-2*(s-tplines[curTarget][a][0][0]),l,s-2*(s-tplines[curTarget][a][0][0]),l-2*(l-tplines[curTarget][a][0][1]),5),r.lineWidth=2),r.strokeStyle="rgb(0,0,255)",r.save(),r.beginPath(),r.translate(tplines[curTarget][a][0][0]-N,tplines[curTarget][a][0][1]-$),r.scale(N,$),r.arc(1,1,1,0,2*Math.PI,!1),r.restore();else if(7.4==tptypes[curTarget][a]){for(k=Math.abs(s-tplines[curTarget][a][0][0]),B=Math.abs(l-tplines[curTarget][a][0][1]),C=Math.abs(B/k),r.strokeStyle=asymcolor,r.dashedLine(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],targets[curTarget].imgwidth,tplines[curTarget][a][0][1]+C*(targets[curTarget].imgwidth-tplines[curTarget][a][0][0])),r.dashedLine(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],targets[curTarget].imgwidth,tplines[curTarget][a][0][1]-C*(targets[curTarget].imgwidth-tplines[curTarget][a][0][0])),r.dashedLine(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],0,tplines[curTarget][a][0][1]-C*tplines[curTarget][a][0][0]),r.dashedLine(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],0,tplines[curTarget][a][0][1]+C*tplines[curTarget][a][0][0]),(curTPcurve==a||null!=dragObj&&dragObj.num==a)&&(r.strokeStyle="rgb(0,255,255)",r.lineWidth=1,r.dashedLine(s,l,s-2*(s-tplines[curTarget][a][0][0]),l,5),r.dashedLine(s,l,s,l-2*(l-tplines[curTarget][a][0][1]),5),r.dashedLine(s,l-2*(l-tplines[curTarget][a][0][1]),s-2*(s-tplines[curTarget][a][0][0]),l-2*(l-tplines[curTarget][a][0][1]),5),r.dashedLine(s-2*(s-tplines[curTarget][a][0][0]),l,s-2*(s-tplines[curTarget][a][0][0]),l-2*(l-tplines[curTarget][a][0][1]),5),r.lineWidth=2),r.beginPath(),r.strokeStyle="rgb(0,0,255)",I=0;I<targets[curTarget].imgwidth+4;I+=3)(E=tplines[curTarget][a][0][1]+Math.sqrt((Math.pow(I-tplines[curTarget][a][0][0],2)/(k*k)+1)*B*B))<-100&&(E=-100),E>targets[curTarget].imgheight+100&&(E=targets[curTarget].imgheight+100),0==I?r.moveTo(I,E):r.lineTo(I,E);for(r.stroke(),r.beginPath(),I=0;I<targets[curTarget].imgwidth+4;I+=3)(E=tplines[curTarget][a][0][1]-Math.sqrt((Math.pow(I-tplines[curTarget][a][0][0],2)/(k*k)+1)*B*B))<-100&&(E=-100),E>targets[curTarget].imgheight+100&&(E=targets[curTarget].imgheight+100),0==I?r.moveTo(I,E):r.lineTo(I,E)}else if(7.5==tptypes[curTarget][a]){for(B=Math.abs(s-tplines[curTarget][a][0][0]),k=Math.abs(l-tplines[curTarget][a][0][1]),C=Math.abs(k/B),r.strokeStyle=asymcolor,r.dashedLine(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],targets[curTarget].imgwidth,tplines[curTarget][a][0][1]+C*(targets[curTarget].imgwidth-tplines[curTarget][a][0][0])),r.dashedLine(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],targets[curTarget].imgwidth,tplines[curTarget][a][0][1]-C*(targets[curTarget].imgwidth-tplines[curTarget][a][0][0])),r.dashedLine(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],0,tplines[curTarget][a][0][1]-C*tplines[curTarget][a][0][0]),r.dashedLine(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],0,tplines[curTarget][a][0][1]+C*tplines[curTarget][a][0][0]),(curTPcurve==a||null!=dragObj&&dragObj.num==a)&&(r.strokeStyle="rgb(0,255,255)",r.lineWidth=1,r.dashedLine(s,l,s-2*(s-tplines[curTarget][a][0][0]),l,5),r.dashedLine(s,l,s,l-2*(l-tplines[curTarget][a][0][1]),5),r.dashedLine(s,l-2*(l-tplines[curTarget][a][0][1]),s-2*(s-tplines[curTarget][a][0][0]),l-2*(l-tplines[curTarget][a][0][1]),5),r.dashedLine(s-2*(s-tplines[curTarget][a][0][0]),l,s-2*(s-tplines[curTarget][a][0][0]),l-2*(l-tplines[curTarget][a][0][1]),5),r.lineWidth=2),r.beginPath(),r.strokeStyle="rgb(0,0,255)",E=0;E<targets[curTarget].imgwidth+4;E+=3)(I=tplines[curTarget][a][0][0]+Math.sqrt((Math.pow(E-tplines[curTarget][a][0][1],2)/(k*k)+1)*B*B))<-100&&(I=-100),I>targets[curTarget].imgwidth+100&&(I=targets[curTarget].imgwidth+100),0==E?r.moveTo(I,E):r.lineTo(I,E);for(r.stroke(),r.beginPath(),E=0;E<targets[curTarget].imgwidth+4;E+=3)(I=tplines[curTarget][a][0][0]-Math.sqrt((Math.pow(E-tplines[curTarget][a][0][1],2)/(k*k)+1)*B*B))<-100&&(I=-100),I>targets[curTarget].imgwidth+100&&(I=targets[curTarget].imgwidth+100),0==E?r.moveTo(I,E):r.lineTo(I,E)}}else if(8==tptypes[curTarget][a])l=s=i=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&(s!=tplines[curTarget][a][0][0]&&(i=(l-tplines[curTarget][a][0][1])/(s-tplines[curTarget][a][0][0]),s<tplines[curTarget][a][0][0]&&(i*=-1)),Math.abs(s-tplines[curTarget][a][0][0])<1||100<Math.abs(i)?(r.moveTo(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1]),l>tplines[curTarget][a][0][1]?r.lineTo(tplines[curTarget][a][0][0],targets[curTarget].imgheight):r.lineTo(tplines[curTarget][a][0][0],0)):(c=tplines[curTarget][a][0][1]+i*tplines[curTarget][a][0][0],d=tplines[curTarget][a][0][1]+i*(targets[curTarget].imgwidth-tplines[curTarget][a][0][0]),r.moveTo(0,c),r.lineTo(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1]),r.lineTo(targets[curTarget].imgwidth,d)));else if(8.3==tptypes[curTarget][a]){if(s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&s!=tplines[curTarget][a][0][0])if(l==tplines[curTarget][a][0][1])r.moveTo(0,l),r.lineTo(targets[curTarget].imgwidth,l);else if(0<(S=(A=targets[curTarget].ymax*targets[curTarget].pixpery+targets[curTarget].imgborder)-tplines[curTarget][a][0][1])*(D=A-l)&&s!=tplines[curTarget][a][0][0])for(W=safepow(D/S,1/(s-tplines[curTarget][a][0][0])),T=D/safepow(W,s),r.moveTo(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1]),I=E=0;I<targets[curTarget].imgwidth+4;I+=3)(E=A-T*safepow(W,I))<-100&&(E=-100),E>targets[curTarget].imgheight+100&&(E=targets[curTarget].imgheight+100),0==I?r.moveTo(I,E):r.lineTo(I,E)}else if(8.4==tptypes[curTarget][a]){if(s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&s!=tplines[curTarget][a][0][0]&&l!=tplines[curTarget][a][0][1]&&0<(H=(R=-targets[curTarget].xmin*targets[curTarget].pixperx+targets[curTarget].imgborder)-tplines[curTarget][a][0][0])*(z=R-s)&&l!=tplines[curTarget][a][0][1])for(W=safepow(z/H,1/(l-tplines[curTarget][a][0][1])),T=z/safepow(W,l),r.moveTo(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1]),E=E=0;E<targets[curTarget].imgheight+4;E+=3)(I=R-T*safepow(W,E))<-100&&(I=-100),I>targets[curTarget].imgwidth+100&&(I=targets[curTarget].imgwidth+100),0==E?r.moveTo(I,E):r.lineTo(I,E)}else if(8.5==tptypes[curTarget][a]){if(g=u=s=l=null,3==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1],g=tplines[curTarget][a][2][0],u=tplines[curTarget][a][2][1]):2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1],g=e,u=t):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),U=tplines[curTarget][a][0][1],r.strokeStyle=asymcolor,r.dashedLine(5,U,targets[curTarget].imgwidth,U),r.beginPath(),r.strokeStyle="rgb(0,0,255)",null!=g&&g!=s)if(u==l)r.moveTo(0,u),r.lineTo(targets[curTarget].imgwidth,u);else if(0<(D=U-l)*(F=U-u)&&g!=s)for(W=safepow(F/D,1/(g-s)),T=F/safepow(W,g),r.moveTo(s,l),I=E=0;I<targets[curTarget].imgwidth+4;I+=3)(E=U-T*safepow(W,I))<-100&&(E=-100),E>targets[curTarget].imgheight+100&&(E=targets[curTarget].imgheight+100),0==I?r.moveTo(I,E):r.lineTo(I,E)}else if(8.6==tptypes[curTarget][a]){if(g=u=s=l=null,3==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1],g=tplines[curTarget][a][2][0],u=tplines[curTarget][a][2][1]):2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1],g=e,u=t):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),Y=tplines[curTarget][a][0][0],r.strokeStyle=asymcolor,r.dashedLine(Y,5,Y,targets[curTarget].imgheight),r.beginPath(),r.strokeStyle="rgb(0,0,255)",null!=g&&g!=s&&u!=l&&0<(z=s-Y)*(X=g-Y))for(W=safepow(X/z,1/(u-l)),T=X/safepow(W,u),r.moveTo(s,l),E=I=0;E<targets[curTarget].imgheight+4;E+=3)(I=Y+T*safepow(W,E))<-100&&(I=-100),I>targets[curTarget].imgwidth+100&&(I=targets[curTarget].imgwidth+100),0==E?r.moveTo(I,E):r.lineTo(I,E)}else if(8.2==tptypes[curTarget][a]){if(s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),r.strokeStyle=asymcolor,r.dashedLine(5,tplines[curTarget][a][0][1],targets[curTarget].imgwidth,tplines[curTarget][a][0][1]),r.dashedLine(tplines[curTarget][a][0][0],5,tplines[curTarget][a][0][0],targets[curTarget].imgheight),r.beginPath(),r.strokeStyle="rgb(0,0,255)",null!=s&&s!=tplines[curTarget][a][0][0]&&l!=tplines[curTarget][a][0][1]){for(T=(l-tplines[curTarget][a][0][1])*(s-tplines[curTarget][a][0][0]),I=tplines[curTarget][a][0][0]-1;-4<I;I-=3)(E=T/(I-tplines[curTarget][a][0][0])+tplines[curTarget][a][0][1])<-100&&(E=-100),E>targets[curTarget].imgheight+100&&(E=targets[curTarget].imgheight+100),I==tplines[curTarget][a][0][0]-1?r.moveTo(I,E):r.lineTo(I,E);for(I=tplines[curTarget][a][0][0]+1;I<targets[curTarget].imgwidth+4;I+=3)(E=T/(I-tplines[curTarget][a][0][0])+tplines[curTarget][a][0][1])<-100&&(E=-100),E>targets[curTarget].imgheight+100&&(E=targets[curTarget].imgheight+100),I==tplines[curTarget][a][0][0]+1?r.moveTo(I,E):r.lineTo(I,E);r.stroke()}}else if((9==tptypes[curTarget][a]||9.1==tptypes[curTarget][a])&&(s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&s!=tplines[curTarget][a][0][0]))if(l==tplines[curTarget][a][0][1])r.moveTo(0,l),r.lineTo(targets[curTarget].imgwidth,l);else for(9==tptypes[curTarget][a]?(V=-1*Math.abs(l-tplines[curTarget][a][0][1])/2,G=(l+tplines[curTarget][a][0][1])/2,T=Math.PI/Math.abs(s-tplines[curTarget][a][0][0]),Q=l<tplines[curTarget][a][0][1]?s:tplines[curTarget][a][0][0]):9.1==tptypes[curTarget][a]&&(V=-1*Math.abs(l-tplines[curTarget][a][0][1]),G=tplines[curTarget][a][0][1],T=.5*Math.PI/Math.abs(s-tplines[curTarget][a][0][0]),Q=l<tplines[curTarget][a][0][1]?s:s+2*Math.abs(s-tplines[curTarget][a][0][0])),I=E=0;I<targets[curTarget].imgwidth+4;I+=3)E=V*Math.cos(T*(I-Q))+G,0==I?r.moveTo(I,E):r.lineTo(I,E);r.stroke(),r.beginPath()}for(null===curTPcurve&&tpHasAsymp.hasOwnProperty(targets[curTarget].mode)&&(r.strokeStyle="rgb(200,200,200)",8.5==targets[curTarget].mode?r.dashedLine(5,t,targets[curTarget].imgwidth,t):8.6==targets[curTarget].mode?r.dashedLine(e,5,e,targets[curTarget].imgwidth):8.2==targets[curTarget].mode?(r.dashedLine(5,t,targets[curTarget].imgwidth,t),r.dashedLine(e,5,e,targets[curTarget].imgheight)):7.4!=targets[curTarget].mode&&7.5!=targets[curTarget].mode||(r.dashedLine(e,t,targets[curTarget].imgwidth,t+(targets[curTarget].imgwidth-e)),r.dashedLine(e,t,targets[curTarget].imgwidth,t-(targets[curTarget].imgwidth-e)),r.dashedLine(e,t,0,t-e),r.dashedLine(e,t,0,t+e)),r.beginPath(),r.strokeStyle="rgb(0,0,255)"),r.fillStyle="rgba(0,0,255,.5)",a=0;a<lines[curTarget].length;a++){for(r.beginPath(),q=0;q<lines[curTarget][a].length;q++)0==q?(r.moveTo(lines[curTarget][a][q][0],lines[curTarget][a][q][1]),J=lines[curTarget][a][q][0],K=lines[curTarget][a][q][1]):(r.lineTo(lines[curTarget][a][q][0],lines[curTarget][a][q][1]),Z=lines[curTarget][a][q][0],ee=lines[curTarget][a][q][1]);if(a==curLine&&null!=e&&(r.lineTo(e,t),Z=e,ee=t),te=.02*targets[curTarget].imgwidth,1==drawlocky[curTarget]&&Z>.98*targets[curTarget].imgwidth?(r.moveTo(Z,ee),r.lineTo(Z-te,ee+te),r.moveTo(Z,ee),r.lineTo(Z-te,ee-te)):1==drawlocky[curTarget]&&J>.98*targets[curTarget].imgwidth&&(r.moveTo(J,K),r.lineTo(J-te,K+te),r.moveTo(J,K),r.lineTo(J-te,K-te)),1==drawlocky[curTarget]&&Z<.02*targets[curTarget].imgwidth?(r.moveTo(Z,ee),r.lineTo(Z+te,ee+te),r.moveTo(Z,ee),r.lineTo(Z+te,ee-te)):1==drawlocky[curTarget]&&J<.02*targets[curTarget].imgwidth&&(r.moveTo(J,K),r.lineTo(J+te,K+te),r.moveTo(J,K),r.lineTo(J+te,K-te)),r.stroke(),1<targets[curTarget].dotline){if(lines[curTarget][a].length-1<1)continue;if(Math.pow(Z-J,2)+Math.pow(ee-K,2)<25){for(r.moveTo(lines[curTarget][a][0][0],lines[curTarget][a][0][1]),q=1;q<lines[curTarget][a].length;q++)r.lineTo(lines[curTarget][a][q][0],lines[curTarget][a][q][1]);r.closePath(),r.fill()}}}for(r.fillStyle="rgb(0,0,255)",r.beginPath(),a=0;a<dots[curTarget].length;a++)r.moveTo(dots[curTarget][a][0]+5,dots[curTarget][a][1]),r.arc(dots[curTarget][a][0],dots[curTarget][a][1],5,0,2*Math.PI,!0);if(r.fill(),0<targets[curTarget].dotline){for(r.beginPath(),a=0;a<lines[curTarget].length;a++)for(q=0;q<lines[curTarget][a].length;q++)(0==q||25<Math.pow(lines[curTarget][a][q][0]-lines[curTarget][a][q-1][0],2)+Math.pow(lines[curTarget][a][q][1]-lines[curTarget][a][q-1][1],2))&&(r.moveTo(lines[curTarget][a][q][0]+5,lines[curTarget][a][q][1]),r.arc(lines[curTarget][a][q][0],lines[curTarget][a][q][1],5,0,2*Math.PI,!0));r.fill()}for(r.fillStyle="rgb(255,255,255)",r.beginPath(),a=0;a<odots[curTarget].length;a++)r.moveTo(odots[curTarget][a][0]+5,odots[curTarget][a][1]),r.arc(odots[curTarget][a][0],odots[curTarget][a][1],4,0,2*Math.PI,!0);for(targets[curTarget].mode<3?r.fill():r.stroke(),r.lineWidth=2,r.beginPath(),a=0;a<odots[curTarget].length;a++)r.moveTo(odots[curTarget][a][0]+5,odots[curTarget][a][1]),r.arc(odots[curTarget][a][0],odots[curTarget][a][1],4,0,2*Math.PI,!0);for(r.stroke(),a=0;a<tplines[curTarget].length;a++)if(tptypes[curTarget][a]==targets[curTarget].mode){for(r.fillStyle="rgb(255,0,0)",q=0;q<tplines[curTarget][a].length;q++)r.fillRect(tplines[curTarget][a][q][0]-3,tplines[curTarget][a][q][1]-3,6,6);tplines[curTarget][a].length<tpModeN[targets[curTarget].mode]&&null!=e&&curTPcurve==a&&r.fillRect(e-3,t-3,6,6),r.fillStyle="rgb(0,0,255)"}encodeDraw()}function deleteCurve(e,t){1==e?dots[curTarget].splice(t,1):2==e?odots[curTarget].splice(t,1):0<=e&&e<1?lines[curTarget].splice(t,1):5<=e&&e<10?(tplines[curTarget].splice(t,1),tptypes[curTarget].splice(t,1),curTPcurve=null):10<=e&&e<11&&(ineqlines[curTarget].splice(t,1),ineqtypes[curTarget].splice(t,1),curIneqcurve=null),drawTarget()}function encodeDraw(){var e,t,r,a,n,i,s="",g=[];for(e=0;e<lines[curTarget].length;e++)for(lines[curTarget][e].length,g=0==targets[curTarget].dotline?pathsimplify(lines[curTarget][e]):lines[curTarget][e],0!=e&&(s+=";"),t=0;t<g.length;t++)0!=t&&(s+=","),s+="("+g[t][0]+","+g[t][1]+")";for(s+=";;",e=0;e<dots[curTarget].length;e++)0!=e&&(s+=","),s+="("+dots[curTarget][e][0]+","+dots[curTarget][e][1]+")";for(s+=";;",e=0;e<odots[curTarget].length;e++)0!=e&&(s+=","),s+="("+odots[curTarget][e][0]+","+odots[curTarget][e][1]+")";for(s+=";;",r=[],a="",e=0;e<tplines[curTarget].length;e++)if(tplines[curTarget][e].length==tpModeN[tptypes[curTarget][e]]){for(a="("+tptypes[curTarget][e],t=0;t<tplines[curTarget][e].length;t++)a+=","+tplines[curTarget][e][t][0]+","+tplines[curTarget][e][t][1];r.push(a+")")}for(s+=r.join(","),s+=";;",n=[],e=0;e<ineqlines[curTarget].length;e++)2<ineqlines[curTarget][e].length&&n.push("("+ineqtypes[curTarget][e]+","+ineqlines[curTarget][e][0][0]+","+ineqlines[curTarget][e][0][1]+","+ineqlines[curTarget][e][1][0]+","+ineqlines[curTarget][e][1][1]+","+ineqlines[curTarget][e][2][0]+","+ineqlines[curTarget][e][2][1]+")");s+=n.join(","),targetOuts[curTarget].value!=s&&(i=""!=targetOuts[curTarget].value||";;;;;;;;"!=s,targetOuts[curTarget].value=s,i&&$(targetOuts[curTarget]).trigger("input").trigger("change"))}function drawMouseDown(e){var t,r,a,n;if(clickcnt++,clearAllDrawListners(),hasTouch&&1<e.originalEvent.touches.length)return didMultiTouch=!0,$(document).on("touchend.imathasdraw",drawMouseUp),!0;if(hasTouch?(window.clearTimeout(hasTouchTimer),$(document).off("mousemove.imathasdraw"),$(".drawcanvas").on("touchstart.imathasdraw",function(e){hasTouch=!0,drawMouseDown(e)}),$(".drawcanvas").on("touchmove.imathasdraw",drawMouseMove),$(document).on("touchend.imathasdraw",drawMouseUp),$(document).on("touchcancel.imathasdraw",drawMouseUp)):($(document).on("mousemove.imathasdraw",drawMouseMove),$(document).on("mouseup.imathasdraw",drawMouseUp)),t=mouseCoords(e),null==curTarget||null==curLine&&null==curTPcurve&&null==curIneqcurve)for(i in targets)if(!$(targets[i].el).is(":hidden")&&(r=getPosition(targets[i].el)).x<t.x&&r.x+targets[i].width>t.x&&r.y<t.y&&r.y+targets[i].height>t.y&&e.target==targets[i].el){curTarget=i;break}if(null!=curTarget){if(targetOuts[curTarget].disabled)return;if(e.preventDefault(),mouseisdown=!0,r=getPosition(targets[curTarget].el),-1<(a={x:t.x-r.x,y:t.y-r.y}).x&&a.x<targets[curTarget].width&&-1<a.y&&a.y<targets[curTarget].height){if(0<targets[curTarget].snaptogridx&&(a=snaptogrid(a,curTarget)),1==drawlocky[curTarget]&&(a.y=targets[curTarget].imgheight/2),null!=(n=findnearpoint(curTarget,a))){if(-1==targets[curTarget].mode)return void deleteCurve(n[0],n[1]);null!=curLine&&n[0]<1&&curLine!=n[1]?n=null:null!=curTPcurve&5<=n[0]&&n[0]<10&&curTPcurve!=n[1]?n=null:null!=curIneqcurve&&10<=n[0]&&n[0]<11&&curIneqcurve!=n[1]&&(n=null)}null==n?(setCursor("pendown"),1==targets[curTarget].mode?(dots[curTarget].push([a.x,a.y]),dragObj={mode:1,num:dots[curTarget].length-1}):2==targets[curTarget].mode?(odots[curTarget].push([a.x,a.y]),dragObj={mode:2,num:odots[curTarget].length-1}):0==targets[curTarget].mode||.7==targets[curTarget].mode?null==curLine?(lines[curTarget].push([[a.x,a.y]]),curLine=lines[curTarget].length-1):lines[curTarget][curLine].push([a.x,a.y]):.5==targets[curTarget].mode?null==curLine?(lines[curTarget].push([[a.x,a.y]]),curLine=lines[curTarget].length-1):(lines[curTarget][curLine].push([a.x,a.y]),dragObj=curLine=null):5<=targets[curTarget].mode&&targets[curTarget].mode<10?null==curTPcurve?(tplines[curTarget].push([[a.x,a.y]]),curTPcurve=tplines[curTarget].length-1,tptypes[curTarget][curTPcurve]=targets[curTarget].mode,mouseisdown=!1):(tplines[curTarget][curTPcurve].push([a.x,a.y]),tplines[curTarget][curTPcurve].length==tpModeN[targets[curTarget].mode]&&(dragObj={mode:targets[curTarget].mode,num:curTPcurve,subnum:1},curTPcurve=null)):10<=targets[curTarget].mode&&targets[curTarget].mode<11&&(null==curIneqcurve?(ineqlines[curTarget].push([[a.x,a.y]]),curIneqcurve=ineqlines[curTarget].length-1,ineqtypes[curTarget][curIneqcurve]=targets[curTarget].mode,mouseisdown=!1):(ineqlines[curTarget][curIneqcurve].push([a.x,a.y]),2==ineqlines[curTarget][curIneqcurve].length?dragObj={mode:targets[curTarget].mode,num:curIneqcurve,subnum:1}:3==ineqlines[curTarget][curIneqcurve].length&&(dragObj={mode:targets[curTarget].mode,num:curIneqcurve,subnum:2},curIneqcurve=null)))):0==n[0]||.5==n[0]?null==curLine?(setCursor("move"),dragObj={mode:targets[curTarget].mode,num:n[1],subnum:n[2]},oldpointpos=lines[curTarget][n[1]][n[2]],n[2]==lines[curTarget][n[1]].length-1&&0==targets[curTarget].mode?curLine=n[1]:0==n[2]&&0==targets[curTarget].mode&&(curLine=n[1],lines[curTarget][curLine].reverse(),dragObj.subnum=lines[curTarget][curLine].length-1),clickmightbenewcurve=!0):n[1]==curLine&&n[2]==lines[curTarget][n[1]].length-1?(lines[curTarget][curLine].length<2&&lines[curTarget].splice(curLine,1),curLine=null):1<targets[curTarget].dotline&&n[1]==curLine&&0==n[2]?(lines[curTarget][curLine].push(lines[curTarget][curLine][0]),curLine=null):(setCursor("pendown"),lines[curTarget][curLine].push([a.x,a.y])):1==n[0]?(setCursor("move"),dragObj={mode:1,num:n[1]}):2==n[0]?(setCursor("move"),dragObj={mode:2,num:n[1]}):5<=n[0]&&n[0]<10?null==curTPcurve&&(setCursor("move"),dragObj={mode:n[0],num:n[1],subnum:n[2]},oldpointpos=tplines[curTarget][n[1]][n[2]],clickmightbenewcurve=!0):10<=n[0]&&n[0]<11&&null==curIneqcurve&&(setCursor("move"),dragObj={mode:n[0],num:n[1],subnum:n[2]},oldpointpos=ineqlines[curTarget][n[1]][n[2]],clickmightbenewcurve=!0),drawTarget()}else null!=curLine&&(lines[curTarget][curLine].length<2&&lines[curTarget].splice(curLine,1),setCursor("pen")),null!=curTPcurve&&(tplines[curTarget][curTPcurve].length<tpModeN[targets[curTarget].mode]&&(tplines[curTarget].splice(curTPcurve,1),tptypes[curTarget].splice(curTPcurve,1)),setCursor("pen")),null!=curIneqcurve&&(ineqlines[curTarget][curIneqcurve].length<3&&(ineqlines[curTarget].splice(curIneqcurve,1),ineqtypes[curTarget].splice(curIneqcurve,1)),setCursor("pen")),dragObj=curIneqcurve=curTPcurve=curLine=null,drawTarget(),curTarget=null}}function findnearpoint(e,t){var r,a,n;if(hasTouch?(r=Math.max(15*window.innerWidth/screen.width,15),r*=r):r=-1==targets[e].mode?50:25,0==targets[e].mode||.5==targets[e].mode||-1==targets[e].mode)for(a=lines[e].length-1;0<=a;a--)for(n=lines[e][a].length-1;0<=n;n--)if(Math.pow(lines[e][a][n][0]-t.x,2)+Math.pow(lines[e][a][n][1]-t.y,2)<r)return[-1==targets[e].mode?0:targets[e].mode,a,n];if(1==targets[e].mode||-1==targets[e].mode)for(a=dots[e].length-1;0<=a;a--)if(Math.pow(dots[e][a][0]-t.x,2)+Math.pow(dots[e][a][1]-t.y,2)<r)return[1,a];if(2==targets[e].mode||-1==targets[e].mode)for(a=odots[e].length-1;0<=a;a--)if(Math.pow(odots[e][a][0]-t.x,2)+Math.pow(odots[e][a][1]-t.y,2)<r)return[2,a];if(5<=targets[e].mode&&targets[e].mode<10||-1==targets[e].mode)for(a=tplines[e].length-1;0<=a;a--)for(n=tplines[e][a].length-1;0<=n;n--)if((tptypes[e][a]==targets[e].mode||-1==targets[e].mode)&&Math.pow(tplines[e][a][n][0]-t.x,2)+Math.pow(tplines[e][a][n][1]-t.y,2)<r)return[tptypes[e][a],a,n];if(10<=targets[e].mode&&targets[e].mode<11||-1==targets[e].mode)for(a=ineqlines[e].length-1;0<=a;a--)for(n=ineqlines[e][a].length-1;0<=n;n--)if((ineqtypes[e][a]==targets[e].mode||-1==targets[e].mode)&&Math.pow(ineqlines[e][a][n][0]-t.x,2)+Math.pow(ineqlines[e][a][n][1]-t.y,2)<r)return[ineqtypes[e][a],a,n];return null}function drawMouseUp(e){var t,r,a,n=mouseCoords(e);if(mouseisdown=!1,null!=curTarget){if(targetOuts[curTarget].disabled)return;t=getPosition(targets[curTarget].el),r={x:n.x-t.x,y:n.y-t.y},0<targets[curTarget].snaptogridx&&(r=snaptogrid(r,curTarget)),a=-1<r.x&&r.x<targets[curTarget].width&&-1<r.y&&r.y<targets[curTarget].height,1==clickmightbenewcurve&&(5<=targets[curTarget].mode&&targets[curTarget].mode<10?(tplines[curTarget].push([[r.x,r.y]]),curTPcurve=tplines[curTarget].length-1,tptypes[curTarget][curTPcurve]=targets[curTarget].mode):10<=targets[curTarget].mode&&targets[curTarget].mode<11&&(ineqlines[curTarget].push([[r.x,r.y]]),curIneqcurve=ineqlines[curTarget].length-1,ineqtypes[curTarget][curIneqcurve]=targets[curTarget].mode)),null!=lastdrawmouseup&&n.x==lastdrawmouseup.x&&n.y==lastdrawmouseup.y&&null!=curLine&&null==dragObj&&(lines[curTarget][curLine].length<2&&lines[curTarget].splice(curLine,1),dragObj=curLine=null,drawTarget()),null!=curLine&&null==dragObj&&(.5==targets[curTarget].mode&&1<lines[curTarget][curLine].length?(curLine=null,dragobj=null,drawTarget()):.7==targets[curTarget].mode&&(curLine=null,dragobj=null,drawTarget())),null!=curTPcurve&&1==tplines[curTarget][curTPcurve].length&&(didMultiTouch||!a?(tplines[curTarget].splice(curTPcurve,1),tptypes[curTarget].splice(curTPcurve,1),curTPcurve=null,drawTarget()):null==findnearpoint(curTarget,r)&&(tplines[curTarget][curTPcurve].push([r.x,r.y]),curTPcurve=null,drawTarget())),null!=curIneqcurve&&1==ineqlines[curTarget][curIneqcurve].length&&(didMultiTouch||!a?(ineqlines[curTarget].splice(curIneqcurve,1),ineqtypes[curTarget].splice(curIneqcurve,1),curIneqcurve=null,drawTarget()):null==findnearpoint(curTarget,r)&&(ineqlines[curTarget][curIneqcurve].push([r.x,r.y]),drawTarget())),setCursor(null==curLine&&null==curTPcurve?"move":"pen"),void 0!==e&&e.preventDefault()}lastdrawmouseup=n,null!=curTarget&&null!=dragObj&&(t=getPosition(targets[curTarget].el),-1<r.x&&r.x<targets[curTarget].width&&-1<r.y&&r.y<targets[curTarget].height?(0==dragObj.mode&&1<targets[curTarget].dotline&&(0!=dragObj.subnum&&dragObj.subnum!=lines[curTarget][dragObj.num].length-1||Math.pow(lines[curTarget][dragObj.num][0][0]-lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][0],2)+Math.pow(lines[curTarget][dragObj.num][0][1]-lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][1],2)<25&&(0==dragObj.subnum?(lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][0]=lines[curTarget][dragObj.num][0][0],lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][1]=lines[curTarget][dragObj.num][0][1]):(lines[curTarget][dragObj.num][0][0]=lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][0],lines[curTarget][dragObj.num][0][1]=lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][1]),curLine=null,drawTarget())),dragObj=null):(1==drawlocky[curTarget]&&(r.y=targets[curTarget].imgheight/2),1==dragObj.mode?dots[curTarget].splice(dragObj.num,1):2==dragObj.mode?odots[curTarget].splice(dragObj.num,1):.5==dragObj.mode?lines[curTarget].splice(dragObj.num,1):0==dragObj.mode?lines[curTarget][dragObj.num][dragObj.subnum]=oldpointpos:5<=dragObj.mode&&dragObj.mode<10?(tplines[curTarget].splice(dragObj.num,1),tptypes[curTarget].splice(dragObj.num,1),curTPcurve=null):10<=dragObj.mode&&dragObj.mode<11&&(ineqlines[curTarget].splice(dragObj.num,1),ineqtypes[curTarget].splice(dragObj.num,1),curIneqcurve=null),dragObj=null,drawTarget())),didMultiTouch=!1,hasTouch?hasTouchTimer=window.setTimeout(function(){hasTouch=!1,clearAllDrawListners(),$(document).on("mousemove.imathasdraw",drawMouseMove),$(".drawcanvas").on("touchstart.imathasdraw",function(e){hasTouch=!0,drawMouseDown(e)}),$(document).on("mousedown.imathasdraw",drawMouseDown)},350):(clearAllDrawListners(),$(document).on("mousemove.imathasdraw",drawMouseMove),$(".drawcanvas").on("touchstart.imathasdraw",function(e){hasTouch=!0,drawMouseDown(e)}),$(document).on("mousedown.imathasdraw",drawMouseDown))}function drawMouseMove(e){var t,r,a,n,s,g=null;for(i in clickmightbenewcurve=!1,t=mouseCoords(e),targets)if(!$(targets[i].el).is(":hidden")&&(r=getPosition(targets[i].el)).x<t.x&&r.x+targets[i].width>t.x&&r.y<t.y&&r.y+targets[i].height>t.y&&e.target==targets[i].el){g=i;break}if(null!=g){if(targetOuts[g].disabled)return;r=getPosition(targets[mouseintarget=g].el),a={x:t.x-r.x,y:t.y-r.y},0<targets[g].snaptogridx&&(a=snaptogrid(a,g)),1==drawlocky[g]&&(a.y=targets[g].imgheight/2),-1<a.x&&a.x<targets[g].width&&-1<a.y&&a.y<targets[g].height&&null==dragObj&&null==curLine&&(null==(n=findnearpoint(g,a))?setCursor("pen",g):-1!=targets[g].mode&&setCursor("move",g))}else null!=mouseintarget&&-1!=mouseintarget&&(null!=curTarget?drawTarget():(curTarget=mouseintarget,drawTarget(),curTarget=null),mouseintarget=-1);if(null!=curTarget){if(e.originalEvent.touches&&1<e.originalEvent.touches.length)return didMultiTouch=!0;if(void 0!==e&&e.preventDefault(),r=getPosition(targets[curTarget].el),a={x:t.x-r.x,y:t.y-r.y},0<targets[curTarget].snaptogridx&&(a=snaptogrid(a,curTarget)),1==drawlocky[curTarget]&&(a.y=targets[curTarget].imgheight/2),-1<a.x&&a.x<targets[curTarget].width&&-1<a.y&&a.y<targets[curTarget].height){if(null==dragObj){if(mouseisdown&&-1==targets[curTarget].mode)return void(null!=(n=findnearpoint(curTarget,a))&&deleteCurve(n[0],n[1]));null!=curLine?!mouseisdown||0!=targets[curTarget].mode&&.7!=targets[curTarget].mode?mouseisdown&&.5==targets[curTarget].mode?0==(s=lines[curTarget][curLine].length-1)?25<Math.pow(lines[curTarget][curLine][s][0]-a.x,2)+Math.pow(lines[curTarget][curLine][s][1]-a.y,2)?(lines[curTarget][curLine].push([a.x,a.y]),drawTarget()):drawTarget(a.x,a.y):(lines[curTarget][curLine][s]=[a.x,a.y],drawTarget()):drawTarget(a.x,a.y):(s=lines[curTarget][curLine].length-1,25<Math.pow(lines[curTarget][curLine][s][0]-a.x,2)+Math.pow(lines[curTarget][curLine][s][1]-a.y,2)?(lines[curTarget][curLine].push([a.x,a.y]),drawTarget()):drawTarget(a.x,a.y)):null!=curTPcurve?mouseisdown?drawTarget():drawTarget(a.x,a.y):null!=curIneqcurve?mouseisdown?drawTarget():drawTarget(a.x,a.y):null==(n=findnearpoint(curTarget,a))?(setCursor("pen"),tpHasAsymp.hasOwnProperty(targets[curTarget].mode)&&null!==g&&drawTarget(a.x,a.y)):(drawTarget(),-1!=targets[curTarget].mode&&setCursor("move"))}else setCursor("move"),0==dragObj.mode||.5==dragObj.mode?lines[curTarget][dragObj.num][dragObj.subnum]=[a.x,a.y]:1==dragObj.mode?dots[curTarget][dragObj.num]=[a.x,a.y]:2==dragObj.mode?odots[curTarget][dragObj.num]=[a.x,a.y]:5<=dragObj.mode&&dragObj.mode<10?tplines[curTarget][dragObj.num][dragObj.subnum]=[a.x,a.y]:10<=dragObj.mode&&dragObj.mode<11&&(ineqlines[curTarget][dragObj.num][dragObj.subnum]=[a.x,a.y]),drawTarget();return!1}null==curIneqcurve||mouseisdown||drawTarget()}else null!=g&&-1!=mouseintarget&&(curTarget=g,tpHasAsymp.hasOwnProperty(targets[curTarget].mode)&&drawTarget(a.x,a.y),curTarget=null)}function setCursor(e,t){targets[t=t||curTarget].cursor!=e&&(targets[t].el.style.cursor="move"==e?e:"url("+staticroot+"/img/"+e+".cur), auto",targets[t].cursor=e)}function mouseCoords(e){var t,r,a,n,i;return e=e||window.event,hasTouch?{x:(t=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0]).pageX,y:t.pageY}:e.pageX||e.pageY?{x:e.pageX,y:e.pageY}:(r=document.documentElement,a=document.body,i=r&&(r.scrollTop||r.scrollLeft)?(n=r.scrollLeft,r.scrollTop):a?(n=a.scrollLeft,a.scrollTop):n=0,{x:e.clientX+n,y:e.clientY+i})}function snaptogrid(e,t){var r=e.x-targets[t].imgborder+targets[t].xmin*targets[t].pixperx,a=e.y-targets[t].imgborder-targets[t].ymax*targets[t].pixpery;return{x:r=Math.round(Math.round(r/(targets[t].pixperx*targets[t].snaptogridx))*targets[t].pixperx*targets[t].snaptogridx+targets[t].imgborder-targets[t].xmin*targets[t].pixperx),y:a=Math.round(Math.round(a/(targets[t].pixpery*targets[t].snaptogridy))*targets[t].pixpery*targets[t].snaptogridy+targets[t].imgborder+targets[t].ymax*targets[t].pixpery)}}function getMouseOffset(e,t){var r=getPosition(e),a=mouseCoords(t);return{x:a.x-r.x,y:a.y-r.y}}function getPosition(e){if(e.className.match(/hidden/))return{x:-1e4,y:-1e4};var t=$(e).offset();return{x:t.left,y:t.top}}function clearAllDrawListners(){$(document).off("mousedown.imathasdraw").off("mousemove.imathasdraw").off("mouseup.imathasdraw"),$(document).off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw"),$(".drawcanvas").off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw")}function initCanvases(e){var t,r,a,n,i;clearAllDrawListners(),$(document).on("mousemove.imathasdraw",drawMouseMove),$(".drawcanvas").on("touchstart.imathasdraw",function(e){hasTouch=!0,drawMouseDown(e)}),$(document).on("mousedown.imathasdraw",drawMouseDown);try{CanvasRenderingContext2D.prototype.dashedLine=function(e,t,r,a,n){var i,s,g,l,u,o;for(null==n&&(n=10),this.beginPath(),this.moveTo(e,t),s=a-t,l=(i=r-e)/(g=Math.sqrt(i*i+s*s)/n),u=s/g,g=Math.floor(g),o=0;o++<g&&-1<t&&t<targets[curTarget].imgheight+1&&-1<e&&e<targets[curTarget].imgwidth+1;)e+=l,t+=u,this[o%2==0?"moveTo":"lineTo"](e,t);this[o%2==0?"moveTo":"lineTo"](r,a),this.stroke(),this.closePath()}}catch(e){}for(t in canvases)if(void 0===e||e==t){if((r=null)!=drawla[t]&&2<drawla[t].length){if(lines[canvases[t][0]]=drawla[t][0],dots[canvases[t][0]]=drawla[t][1],odots[canvases[t][0]]=drawla[t][2],tptypes[canvases[t][0]]=[],tplines[canvases[t][0]]=[],3<drawla[t].length&&0<drawla[t][3].length)for(a=0;a<drawla[t][3].length;a++)for(tptypes[canvases[t][0]][a]=drawla[t][3][a][0],tplines[canvases[t][0]][a]=[],n=0;n<tpModeN[tptypes[canvases[t][0]][a]];n++)tplines[canvases[t][0]][a].push(drawla[t][3][a].slice(1+2*n,3+2*n));if(ineqtypes[canvases[t][0]]=[],ineqlines[canvases[t][0]]=[],4<drawla[t].length&&0<drawla[t][4].length)for(a=0;a<drawla[t][4].length;a++)ineqtypes[canvases[t][0]][a]=drawla[t][4][a][0],ineqlines[canvases[t][0]][a]=[drawla[t][4][a].slice(1,3),drawla[t][4][a].slice(3,5),drawla[t][4][a].slice(5)];5<drawla[t].length&&(r=drawla[t][5])}"a11ydraw"==canvases[t][1].substr(0,8)?addA11yTarget(canvases[t],r):(i="",canvases[t][1].match(/initPicture/)?i=canvases[t][1]:""!==canvases[t][1]&&(i=imasroot+"/filter/graph/imgs/"+canvases[t][1]),addTarget(canvases[t][0],"canvas"+canvases[t][0],i,"qn"+canvases[t][0],canvases[t][2],canvases[t][3],canvases[t][4],canvases[t][5],canvases[t][6],canvases[t][7],canvases[t][8],canvases[t][9],canvases[t][10],canvases[t][11],canvases[t][12]))}}function addnormslider(e,t){-1==arraysearch(e,normslider.idnums)?(normslider.idnums.push(e),!0===t&&slideronpageload(e)):slideronpageload(e)}function slideronpageload(e){var t,r;for(r=0;r<normslider.idnums.length;r++)void 0!==e&&e!=normslider.idnums[r]||(initnormslider(t=normslider.idnums[r]),$("#slid1"+t).on("touchstart.normslider mousedown.normslider",onsliderstart),$("#slid2"+t).on("touchstart.normslider mousedown.normslider",onsliderstart))}function initnormslider(e){var t,r,a,n,i=document.getElementById("qn"+e).value;a=(n=i.match(/\(-oo,([\-\d\.]+)\)U\(([\-\d\.]+),oo\)/))?(t=3,r=n[1],n[2]):(n=i.match(/\(-oo,([\-\d\.]+)\)/))?(t=0,r=n[1],2.5):(n=i.match(/\(([\-\d\.]+),oo\)/))?(r=n[t=1],2.5):(n=i.match(/\(([\-\d\.]+),([\-\d\.]+)\)/))?(t=2,r=n[1],n[2]):(t=0,r=-1.5,2.5),document.getElementById("slid1"+e).style.left=60*r+250-6+"px",document.getElementById("slid2"+e).style.left=60*a+250-6+"px",document.getElementById("shaderegions"+e).selectedIndex=t,normslider.curslider.type=document.getElementById("shaderegions"+e).value,chgnormtype(e)}function onsliderstart(e){(e=e||window.event).originalEvent.touches&&0<e.originalEvent.touches.length?(hasTouch=!0,$(document).on("touchmove.normslider",onsliderchange),$(document).on("touchend.normslider",onsliderstop)):($(document).on("mousemove.normslider",onsliderchange),$(document).on("mouseup.normslider",onsliderstop)),normslider.curslider.el=e.target||e.srcElement,normslider.curslider.id=normslider.curslider.el.id.substring(5),normslider.curslider.type=document.getElementById("shaderegions"+normslider.curslider.id).value,normslider.curslider.outnode=document.getElementById(normslider.outputid),normslider.curslider.startpos=getMouseOffset(normslider.curslider.el,e),normslider.curslider.el.parentNode.style.cursor="pointer";getPosition(normslider.curslider.el.parentNode);return e.preventDefault&&e.preventDefault(),!1}function onsliderchange(e){var t,r,a=normslider.curslider.id;if(e=e||window.event,!((t=getMouseOffset(normslider.curslider.el.parentNode,e)).x<5||t.x>normslider.curslider.el.parentNode.offsetWidth-5||t.y<5||t.y>normslider.curslider.el.parentNode.offsetHeight-5))return r=6*Math.round((t.x-normslider.curslider.startpos.x-10)/6)+10,normslider.curslider.el.style.left=r+"px",normupdatevalues(a),e.preventDefault&&e.preventDefault(),!1}function onsliderstop(e){null!==normslider.curslider.el&&(hasTouch=!1,$(document).off("touchmove.normslider touchend.normslider"),$(document).off("mousemove.normslider mouseup.normslider"),normslider.curslider.el.parentNode.style.cursor="",normslider.curslider.el=null)}function normupdatevalues(e){var t,r,a,n,i,s,g,l=parseInt(document.getElementById("slid1"+e).style.left)+6,u=parseInt(document.getElementById("slid2"+e).style.left)+6,o=Math.min(l,u),c=Math.max(l,u);"2O"==normslider.curslider.type?document.getElementById("normleft"+e).style.width=o+1+"px":"1L"==normslider.curslider.type?document.getElementById("normleft"+e).style.width=l+1+"px":"2B"==normslider.curslider.type&&(document.getElementById("normleft"+e).style.left=o+"px",document.getElementById("normleft"+e).style.width=c-o+1+"px"),"2O"==normslider.curslider.type?document.getElementById("normright"+e).style.width=500-c+"px":"1R"==normslider.curslider.type&&(document.getElementById("normright"+e).style.width=500-l+"px"),t=((l-10)/60-4).toFixed(1),r=((u-10)/60-4).toFixed(1),(a=document.getElementById("slid1txt"+e)).innerHTML=t,a.style.left=l-6+"px",(n=document.getElementById("slid2txt"+e)).innerHTML=r,n.style.left=u-6+"px",i=Math.min(t,r),s=Math.max(t,r),"2O"==normslider.curslider.type?g="(-oo,"+i+")U("+s+",oo)":"2B"==normslider.curslider.type?g="("+i+","+s+")":"1L"==normslider.curslider.type?g="(-oo,"+t+")":"1R"==normslider.curslider.type&&(g="("+t+",oo)"),document.getElementById("qn"+e).value=g,$("#qn"+e).trigger("input").trigger("change")}function chgnormtype(e){var t,r,a,n,i=document.getElementById("shaderegions"+e).value;normslider.curslider.type=i,t=parseInt(document.getElementById("slid1"+e).style.left)+6,r=parseInt(document.getElementById("slid2"+e).style.left)+6,a=Math.min(t,r),n=Math.max(t,r),"1R"==i||"1L"==i?(document.getElementById("slid2"+e).style.display="none",document.getElementById("slid2txt"+e).style.display="none","1R"==i?(document.getElementById("normleft"+e).style.display="none",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normright"+e).style.width=500-t+"px"):(document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.display="",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normleft"+e).style.width=t+"px")):"2O"==i?(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normright"+e).style.width=500-n+"px",document.getElementById("normleft"+e).style.width=a+"px"):"2B"==i&&(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.left=a+"px",document.getElementById("normleft"+e).style.width=n-a+"px"),normupdatevalues(e)}function dashedParabola(e,t,r,a,n,i,s){var g,l,u,o,c,d,T,p,h,m,y,w,f;if(n==r)e.moveTo(0,n),e.dashedLine(0,n,i,n);else{for(u=0,r<n&&(u=s),o=(g=(n-r)/((a-t)*(a-t)))*t*t+r-u,g*(d=(-(l=-2*g*t)-(c=Math.sqrt(l*l-4*g*o)))/(2*g))*d+l*d+(o+=u),(T=(-l+c)/(2*g))<d&&(p=d,d=T,T=p),m=(h=8)*h,T-d,y=t,w=r,f=0;d-5<y&&-5<y;)f%2==0?e.moveTo(y,w):e.lineTo(y,w),w=g*(y-=Math.min(Math.sqrt(m/(1+Math.pow(2*g*(y-t),2))),Math.sqrt(h/Math.abs(g))))*y+l*y+o,f++;for(y=t,w=r,f=0;y<T+5&&y<i+5;)f%2==0?e.moveTo(y,w):e.lineTo(y,w),w=g*(y+=Math.min(Math.sqrt(m/(1+Math.pow(2*g*(y-t),2))),Math.sqrt(h/Math.abs(g))))*y+l*y+o,f++}e.stroke()}function shadeParabola(e,t,r,a,n,i,s,g,l){var u,o,c,d,T,p,h,m,y,w,f,v,b,q,x,M;e.beginPath(),n==r?(e.moveTo(0,n),e.lineTo(g,n),s<r?(e.lineTo(g,0),e.lineTo(0,0)):(e.lineTo(g,l),e.lineTo(0,l))):(c=0,r<n&&(c=l),d=(u=(n-r)/((a-t)*(a-t)))*t*t+r-c,h=u*(p=(-(o=-2*u*t)-(T=Math.sqrt(o*o-4*u*d)))/(2*u))*p+o*p+(d+=c),(m=(-o+T)/(2*u))<p&&(w=p,p=m,m=w),x=(f=2*u*(p-t))*(q=((v=(y=h)-f*p)-(y-(b=-f)*m))/(b-f))+v,u<0&&s<u*i*i+o*i+d||0<u&&u*i*i+o*i+d<s?(e.moveTo(p,h),e.quadraticCurveTo(q,x,m,y)):(M=l,Math.abs(h-l)<2&&(M=0),e.moveTo(0,h),e.lineTo(p,h),e.quadraticCurveTo(q,x,m,y),e.lineTo(g,y),e.lineTo(g,M),e.lineTo(0,M))),e.closePath()}return clickcnt=0,lastdrawmouseup=null,mouseintarget=-1,"undefined"!=typeof initstack?initstack.push(initCanvases):$(function(){initCanvases()}),normslider={idnums:[],curslider:{el:null,startpos:[0,0],outnode:null}},"undefined"!=typeof initstack&&initstack.push(slideronpageload),drawexport={reset:reset,initCanvases:initCanvases,clearcanvas:clearcanvas,clearlastline:clearlastline,settool:settool,addnormslider:addnormslider,chgnormtype:chgnormtype,adda11ydraw:adda11ydraw,changea11ydraw:changea11ydraw,encodea11ydraw:encodea11ydraw,updatea11ydraw:updatea11ydraw,removea11ydraw:removea11ydraw},drawexport}(jQuery);!function(){"use strict";function n(e,t){var r=e.length-1,a=[e[0]];return function e(t,r,a,n,i){var s,g,l,u,o,c,d,T,p,h,m,y=n;for(g=r+1;g<a;g++)u=t[g],o=t[r],c=t[a],m=h=p=T=d=void 0,T=o[0],p=o[1],h=c[0]-T,m=c[1]-p,0===h&&0===m||(1<(d=((u[0]-T)*h+(u[1]-p)*m)/(h*h+m*m))?(T=c[0],p=c[1]):0<d&&(T+=h*d,p+=m*d)),y<(l=(h=u[0]-T)*h+(m=u[1]-p)*m)&&(s=g,y=l);n<y&&(1<s-r&&e(t,r,s,n,i),i.push(t[s]),1<a-s&&e(t,s,a,n,i))}(e,0,r,t,a),a.push(e[r]),a}window.pathsimplify=function(e,t,r){if(e.length<=2)return e;var a=void 0!==t?t*t:1;return e=n(e=r?e:function(e,t){var r,a,n,i,s,g,l,u=e[0],o=[u];for(a=1,n=e.length;a<n;a++)r=e[a],s=u,g=(i=r)[0]-s[0],l=i[1]-s[1],t<g*g+l*l&&(o.push(r),u=r);return u!==r&&o.push(r),o}(e,a),a)}}();
var ehcurel=null,ehclosetimer=0,ehddclosetimer=0,curehdd=null,eecurel=null;function showeh(e){var t,l,d;null==eecurel&&(unhideeh(0),t=document.getElementById(e),l=document.getElementById("eh"),e!=ehcurel?(ehcurel=e,d=jQuery(t).offset(),l.style.display="block",l.style.left=d.left+"px",l.style.top=d.top+t.offsetHeight+"px"):(l.style.display="none",ehcurel=null),t.focus())}function reshrinkeh(e){null==eecurel&&e==ehcurel&&(document.getElementById("ehdd").style.display="block",document.getElementById("eh").style.display="none",ehcurel=null,curehdd=e,unhideeh(0))}function unhideeh(e){ehcancelclosetimer()}function hideeh(e){null==ehcurel?ehddclosetimer=window.setTimeout(function(){curehdd=null,document.getElementById("ehdd").style.display="none"},250):ehclosetimer=window.setTimeout(reallyhideeh,250)}function reallyhideeh(){document.getElementById("eh").style.display="none",ehcurel=null}function ehcancelclosetimer(){ehclosetimer&&(window.clearTimeout(ehclosetimer),ehclosetimer=null)}function hideAllEhTips(){ehclosetimer&&(window.clearTimeout(ehclosetimer),ehclosetimer=null),ehddclosetimer&&(window.clearTimeout(ehddclosetimer),ehddclosetimer=null),curehdd=null,document.getElementById("ehdd").style.display="none",document.getElementById("eh").style.display="none"}function showehdd(e,t,l){var d,n,o;null!=eecurel&&eecurel==e||null!=document.getElementById("tips"+l)&&(ehddclosetimer&&e!=curehdd&&(window.clearTimeout(ehddclosetimer),ehddclosetimer=null),e!=ehcurel&&(d=document.getElementById("ehdd"),n=document.getElementById(e),o=jQuery(n).offset(),document.getElementById("ehddtext").innerHTML=t,document.getElementById("eh").innerHTML=document.getElementById("tips"+l).innerHTML,d.style.display="block",d.style.left=o.left+"px",d.style.top=o.top+n.offsetHeight+"px"),curehdd=e)}function updateehpos(){var e,t,l,d;(curehdd||ehcurel)&&(e=document.getElementById("eh"),t=document.getElementById("ehdd"),l=document.getElementById(curehdd||ehcurel),d=jQuery(l).offset(),e.style.left=d.left+"px",e.style.top=d.top+l.offsetHeight+"px",t.style.left=d.left+"px",t.style.top=d.top+l.offsetHeight+"px")}
