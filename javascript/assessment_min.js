function basicahah(e,t,i){null==i&&(i=" Fetching data... "),document.getElementById(t).textContent=i;var n=!1;window.XMLHttpRequest?(req=new XMLHttpRequest,n=!0):window.ActiveXObject&&(req=new ActiveXObject("Microsoft.XMLHTTP"),n=!0),n&&(req.onreadystatechange=function(){basicahahDone(e,t)},req.open("GET",e,!0),req.send(""))}function basicahahDone(e,t){4==req.readyState&&(200==req.status?document.getElementById(t).innerHTML=req.responseText:document.getElementById(t).textContent=" AHAH Error: "+req.status+", "+req.statusText)}function arraysearch(e,t){for(var i=0;i<t.length;i++)if(t[i]==e)return i;return-1}var tipobj=0,curtipel=null;function tipshow(e,t,i){if(void 0!==i&&"touchstart"==i.type){if(curtipel==e)return tipout(),!1;jQuery(document).on("touchstart.tipshow",(function(){tipout(e)}))}if(curtipel!=e){"object"!=typeof tipobj&&(tipobj=document.createElement("div"),void 0!==window.imathasAssess?tipobj.className="dropdown-pane tooltip-pane":tipobj.className="tips",tipobj.setAttribute("role","tooltip"),tipobj.id="hovertipsholder",document.getElementsByTagName("body")[0].appendChild(tipobj)),curtipel=e,e.hasAttribute("data-tip")?tipobj.innerHTML=e.getAttribute("data-tip"):tipobj.innerHTML=t,tipobj.style.left="5px",$(tipobj).stop(!0,!0).fadeIn(100),tipobj.setAttribute("aria-hidden","false"),e.setAttribute("aria-describedby","hovertipsholder"),"undefined"!=typeof usingASCIIMath&&"undefined"!=typeof noMathRender&&usingASCIIMath&&!noMathRender&&-1!=tipobj.innerHTML.indexOf("`")&&rendermathnode(tipobj);var n=findPos(e);self.innerHeight?x=self.innerWidth:document.documentElement&&document.documentElement.clientHeight?x=document.documentElement.clientWidth:document.body&&(x=document.body.clientWidth);var o=0;"number"==typeof window.pageYOffset?o=window.pageXOffset:document.body&&(document.body.scrollLeft||document.body.scrollTop)?o=document.body.scrollLeft:document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)&&(o=document.documentElement.scrollLeft),x+=o,n[0]+tipobj.offsetWidth>x-10?(n[0]=x-tipobj.offsetWidth-30,$(tipobj).addClass("tipright")):$(tipobj).removeClass("tipright"),tipobj.style.left=n[0]+15+"px",n[1]<30?tipobj.style.top=n[1]+20+"px":tipobj.style.top=n[1]-tipobj.offsetHeight+"px"}}function tipout(e){jQuery(document).off("touchstart.tipshow"),$(tipobj).fadeOut(100),tipobj.setAttribute("aria-hidden","true"),curtipel&&curtipel.removeAttribute("aria-describedby"),curtipel=null}jQuery((function(){jQuery(document).on("keyup",(function(e){27==e.which&&null!==curtipel&&tipout()}))}));var popupwins=[];function popupwindow(e,t,i,n,o){"fit"==n&&(n=window.innerHeight-80);var a="width="+i+",height="+n+",status=0,resizable=1,directories=0,menubar=0";if(null!=o&&1==o&&(a+=",scrollbars=1"),void 0===popupwins[e]||popupwins[e].closed||(popupwins[e].focus(),popupwins[e].location.href!=t))if(t.match(/^http/))popupwins[e]=window.open(t,e,a);else{var r=window.open("",e,a);r.document.write("<html><head><title>Popup</title></head><body>"),r.document.write(t),r.document.write("</body></html>"),r.document.close(),popupwins[e]=r}}var inIframe=function(){try{return window.self!==window.top}catch(e){return!0}};function findPos(e){var t=curtop=0;if(e.offsetParent)do{t+=e.offsetLeft,curtop+=e.offsetTop,e.offsetParent&&(e.parentNode&&e.offsetParent!=e.parentNode?(t-=e.parentNode.scrollLeft,curtop-=e.parentNode.scrollTop):(t-=e.offsetParent.scrollLeft,curtop-=e.offsetParent.scrollTop))}while(e=e.offsetParent);return[t,curtop]}function togglepic(e){"BUTTON"===e.tagName&&(e=e.firstChild),e.getAttribute("src").match("userimg_sm")?e.setAttribute("src",e.getAttribute("src").replace("_sm","_")):e.setAttribute("src",e.getAttribute("src").replace("_","_sm"))}function addLoadEvent(e){var t=window.onload;"function"!=typeof window.onload?window.onload=e:window.onload=function(){t&&t(),e()}}function submitlimiter(e){var t=e.target;return"submitted"==t.className?(alert("You have already submitted this page.  Please be patient while your submission is processed."),t.className="submitted2",e.preventDefault?e.preventDefault():e.returnValue=!1,!1):"submitted2"==t.className?(e.preventDefault?e.preventDefault():e.returnValue=!1,!1):(t.className="submitted",!0)}function setupFormLimiters(){for(var e=document.getElementsByTagName("form"),t=0;t<e.length;t++)"function"==typeof e[t].onsubmit||e[t].className.match(/(nolimit|limitaftervalidate)/)||$(e[t]).on("submit",submitlimiter)}function GB_move(e){if(e.preventDefault(),"touchmove"==e.type)var t=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0],i=t.pageX,n=t.pageY;else i=e.pageX,n=e.pageY;var o=jQuery("#GB_window");o.css("left",Math.max(0,o.data("original_x")+(i-o.data("original_mouse_x")))).css("top",Math.max(0,o.data("original_y")+(n-o.data("original_mouse_y"))))}function GB_drop(e){jQuery(window).off("touchmove.GBmove touchend.GBmove mousemove.GBmove mouseup.GBmove"),jQuery("#GB_frameoverlay").remove(),jQuery("body").css("user-select","")}function GB_resize(e){if(e.preventDefault(),"touchmove"==e.type)var t=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0],i=t.pageX,n=t.pageY;else i=e.pageX,n=e.pageY;i=Math.max(0,Math.min(i,document.documentElement.clientWidth-5)),n=window.scrollY+Math.max(0,Math.min(n-window.scrollY,document.documentElement.clientHeight-5));var o=jQuery("#GB_window"),a=i-o.data("original_mouse_x"),r=n-o.data("original_mouse_y");if(o[0].hasAttribute("data-lockratio")){var s=o.data("original_h")/o.data("original_w");(o.data("original_h")+r)/(o.data("original_w")+a)>s?r=s*(o.data("original_w")+a)-o.data("original_h"):a=(o.data("original_h")+r)/s-o.data("original_w")}o.css("width",Math.max(0,o.data("original_w")+a)).css("height",Math.max(0,o.data("original_h")+r)),jQuery("#GB_frameholder").css("height",Math.max(0,o.data("original_h")+r)-o.data("footer_h"))}function GB_endresize(e){jQuery(window).off("touchmove.GBresize touchend.GBresize mousemove.GBresize mouseup.GBresize"),jQuery("#GB_frameoverlay").remove(),jQuery("body").css("user-select","")}addLoadEvent(setupFormLimiters);var GB_loaded=!1,GB_sourceel=null;function GB_show(e,t,i,n,o,a,r,s){if(document.activeElement&&(GB_sourceel=document.activeElement,$(GB_sourceel).closest(".dropdown-menu").length>0&&(GB_sourceel=$(GB_sourceel).closest(".dropdown").find("a,button")[0])),t=rewriteVideoUrl(t),a=a||"",0==GB_loaded){var l=document.createElement("div");l.id="GB_overlay",l.onclick=GB_hide,document.getElementsByTagName("body")[0].appendChild(l);var d=document.createElement("div");d.setAttribute("role","dialog"),d.setAttribute("aria-labelledby","GB_title"),d.setAttribute("tabindex",-1),d.id="GB_window",d.innerHTML='<div id="GB_caption"></div><div id="GB_loading">Loading...</div><div id="GB_frameholder" ></div><div id="GB_footer"></div><div id="GB_resizehandle"></div>',document.getElementsByTagName("body")[0].appendChild(d),GB_loaded=!0,jQuery("#GB_caption").on("mousedown touchstart",(function(e){if("input"!=e.target.nodeName.toLowerCase()&&"button"!=e.target.nodeName.toLowerCase()&&"a"!=e.target.nodeName.toLowerCase()){var t=document.getElementById("GB_window");if("touchstart"==e.type)var i=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0];jQuery("#GB_window").data("original_x",t.getBoundingClientRect().left).data("original_y",t.getBoundingClientRect().top).data("original_mouse_x","touchstart"==e.type?i.pageX:e.pageX).data("original_mouse_y","touchstart"==e.type?i.pageY:e.pageY).css("left",t.getBoundingClientRect().left).css("top",t.getBoundingClientRect().top).css("margin",0).css("right","").css("width",$(t).width()),jQuery("#GB_window").append($("<div/>",{id:"GB_frameoverlay"})),jQuery("body").css("user-select","none"),"touchstart"==e.type?jQuery(window).on("touchmove.GBmove",GB_move).on("touchend.GBmove",GB_drop):jQuery(window).on("mousemove.GBmove",GB_move).on("mouseup.GBmove",GB_drop)}})),jQuery("#GB_resizehandle").on("mousedown touchstart",(function(e){if("touchstart"==e.type)var t=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0];var i=document.getElementById("GB_window");jQuery("#GB_window").css("left",i.getBoundingClientRect().left).css("top",i.getBoundingClientRect().top).css("margin",0).css("right","").data("original_w",$(i).width()).data("original_h",$(i).height()).data("footer_h",($("#GB_footer:visible").outerHeight()||0)+$("#GB_caption").outerHeight()).data("original_mouse_x","touchstart"==e.type?t.pageX:e.pageX).data("original_mouse_y","touchstart"==e.type?t.pageY:e.pageY),jQuery("#GB_window").append($("<div/>",{id:"GB_frameoverlay"})),jQuery("body").css("user-select","none"),"touchstart"==e.type?jQuery(window).on("touchmove.GBresize",GB_resize).on("touchend.GBresize",GB_endresize):jQuery(window).on("mousemove.GBresize",GB_resize).on("mouseup.GBresize",GB_endresize)}))}if(document.getElementById("GB_loading").style.display="block","<"==t.charAt(0)?(document.getElementById("GB_frameholder").innerHTML="<div>"+t+"</div>",t.match(/data-enlarged/)&&jQuery("#GB_window").attr("data-lockratio",1),setTimeout(GB_doneload,50)):document.getElementById("GB_frame")&&document.getElementById("GB_frame").src.replace(/\/$/,"")==t.replace(/\/$/,"")?document.getElementById("GB_loading").style.display="none":document.getElementById("GB_frameholder").innerHTML='<iframe onload="GB_doneload()" id="GB_frame" src="'+t+'" title="'+e+'" data-noresize=1></iframe>',jQuery("#GB_frameholder").isolatedScroll(),document.getElementById("GB_caption").innerHTML='<span class="floatright"><a href="#" class="pointer" onclick="GB_hide();return false;" aria-label="Close">[X]</a></span><span id="GB_title">'+e+"</span>",t.match(/libtree/)){document.getElementById("GB_footer").innerHTML='<button type="button" class="primary" onclick="document.getElementById(\'GB_frame\').contentWindow.setlib()">Use Libraries</button> <button type=button onclick="GB_hide()">Close</button>';var c=(self.innerHeight||de&&de.clientHeight||document.body.clientHeight)-30}else if(t.match(/assessselect/)){document.getElementById("GB_footer").innerHTML='<button type="button" class="primary" onclick="document.getElementById(\'GB_frame\').contentWindow.setassess()">Use Assessments</button> <button type=button onclick="GB_hide()">Close</button>';c=(self.innerHeight||de&&de.clientHeight||document.body.clientHeight)-30}else if(s){document.getElementById("GB_footer").innerHTML='<button type="button" class="primary" onclick="document.getElementById(\'GB_frame\').contentWindow.'+s.func+'()">'+s.label+'</button> <button type=button onclick="GB_hide()">Close</button>';c=(self.innerHeight||de&&de.clientHeight||document.body.clientHeight)-30}else if(document.getElementById("GB_footer").innerHTML='<button type=button class="primary" onclick="GB_hide()">Close</button>',document.getElementById("GB_caption").onclick=GB_hide,"auto"==n)c=(self.innerHeight||de&&de.clientHeight||document.body.clientHeight)-30;else c=n;document.getElementById("GB_window").style.display="block",!1!==o?(document.getElementById("GB_overlay").style.display="block",document.getElementById("GB_footer").style.display="block",document.getElementsByTagName("body")[0].style.overflow="hidden"):(document.getElementById("GB_overlay").style.display="none",document.getElementById("GB_footer").style.display="none");var u=$(document).width();if(i>u-20&&(i=u-20),!a.match(/noreset/)||!jQuery("#GB_window").data("original_mouse_x")||""==document.getElementById("GB_window").style.left){var p,m="";if("object"==typeof r)for(var h in r)if(p=document.getElementById(r[h])){m=Math.max(0,p.getBoundingClientRect().bottom+10),"auto"==n&&(c=window.self!==window.top?Math.min(600,self.innerHeight):self.innerHeight,c=Math.max(200,c-m-20));break}if($("#GB_window").css("margin","").css("left","").css("top",m),a.match(/left/)&&""==document.getElementById("GB_window").style.left?($("body").hasClass("fw1000")&&u>1e3&&(i+=(u-1e3)/2),$("body").hasClass("fw1920")&&u>1920&&(i+=(u-1920)/2),$("#GB_window").css("left",i).css("width","auto").css("right",20).css("margin","0"),i=u-i-20):document.getElementById("GB_window").style.width=i+"px","content"==n?(document.getElementById("GB_window").style.height="auto",document.getElementById("GB_frameholder").style.marginBottom="30px"):document.getElementById("GB_window").style.height=c+"px","<"!=t.charAt(0)){var f=$("#GB_caption").outerHeight(),g=$("#GB_footer:visible").outerHeight()||0;document.getElementById("GB_frameholder").style.height=c-f-g+"px"}else document.getElementById("GB_frameholder").style.height="auto"}$(document).on("keydown.GB",(function(e){27==e.keyCode?GB_hide():9==e.keyCode&&!1!==o&&GB_retainfocus(e)})),document.getElementById("GB_window").focus()}function GB_doneload(){document.getElementById("GB_loading").style.display="none"}function GB_hide(){document.getElementById("GB_window").style.display="none",document.getElementById("GB_overlay")&&(document.getElementById("GB_overlay").style.display="none",document.getElementsByTagName("body")[0].style.overflow=""),$(document).off("keydown.GB"),GB_sourceel&&GB_sourceel.focus(),GB_sourceel=null}function GB_retainfocus(e){document.getElementById("GB_window").contains(document.activeElement)?e.shiftKey&&$("#GB_window").find("a,button,input").first()[0]==document.activeElement?($("#GB_window").find("a,button,input").last().focus(),e.preventDefault()):e.shiftKey||$("#GB_window").find("a,button,input").last()[0]!=document.activeElement||($("#GB_window").find("a,button,input").first().focus(),e.preventDefault()):$("#GB_window").find("a,button,input").first().focus()}function chkAllNone(e,t,n,o){var a=document.getElementById(e);for(i=0;i<=a.elements.length;i++)try{("all"==t&&"checkbox"==a.elements[i].type||a.elements[i].name==t)&&(o&&a.elements[i].className==o?a.elements[i].checked=!n:a.elements[i].checked=n)}catch(e){}return!1}function initeditor(e,t,i,n,o,a){var r=i||!1,s=n||!1,l="";"exact"==e?l="#"+t.split(/,/).join(",#"):"textareas"==e?l="textarea."+t:"divs"==e?l="div."+t:"selector"==e&&(l=t);var d={selector:l,inline:s,license_key:"gpl",plugins:"lists advlist autolink image charmap anchor searchreplace code link media table rollups asciimath asciisvg attach snippet emoticons",menubar:!1,toolbar1:"myEdit myInsert styles | bold italic underline subscript superscript | forecolor backcolor | snippet code | saveclose",toolbar2:" alignleft aligncenter alignright | bullist numlist outdent indent  | attach link unlink image | table | asciimath asciimathcharmap asciisvg",extended_valid_elements:"iframe[src|width|height|name|align|allowfullscreen|frameborder|style|class],param[name|value],@[sscr]",content_css:staticroot+(1==r?"/assessment/mathtest.css,":"/imascore.css,")+staticroot+"/themes/"+coursetheme,AScgiloc:imasroot+"/filter/graph/svgimg.php",convert_urls:!1,file_picker_callback:filePickerCallBackFunc,file_picker_types:"file image",images_upload_handler:image_upload_handler,paste_data_images:!0,default_link_target:"_blank",browser_spellcheck:!0,contextmenu:!1,branding:!1,promotion:!1,sandbox_iframes:!1,resize:"both",width:"100%",content_style:"body {background-color: "+(coursetheme.match(/_dark/)?"#000":"#fff")+" !important;}",table_class_list:[{title:"None",value:""},{title:"Gridded",value:"gridded"},{title:"Gridded Centered",value:"gridded centered"}],style_formats_merge:!0,snippet_list:1==tinymceUseSnippets&&imasroot+"/tinymce8/getsnippets.php",autolink_pattern:/^(https?:\/\/|www\.)(.+)$/i,mobile:{toolbar_mode:"sliding"},init_instance_callback:function(e){inIframe()&&(sendLTIresizemsg(),e.on("OpenWindow",(t=>{let i=e.editorContainer.getBoundingClientRect(),n=document.querySelector(".tox-dialog"),o=n.getBoundingClientRect(),a=Math.min(Math.max(i.y+.5*i.height-.5*o.height,0),document.documentElement.clientHeight-o.height);n.style.position="absolute",n.style.top=a+"px",n.style.width="",n.focus()})))},style_formats:[{title:"Font Family",items:[{title:"Arial",inline:"span",styles:{"font-family":"arial"}},{title:"Book Antiqua",inline:"span",styles:{"font-family":"book antiqua"}},{title:"Comic Sans MS",inline:"span",styles:{"font-family":"comic sans ms,sans-serif"}},{title:"Courier New",inline:"span",styles:{"font-family":"courier new,courier"}},{title:"Georgia",inline:"span",styles:{"font-family":"georgia,palatino"}},{title:"Helvetica",inline:"span",styles:{"font-family":"helvetica"}},{title:"Impact",inline:"span",styles:{"font-family":"impact,chicago"}},{title:"Open Sans",inline:"span",styles:{"font-family":"Open Sans"}},{title:"Symbol",inline:"span",styles:{"font-family":"symbol"}},{title:"Tahoma",inline:"span",styles:{"font-family":"tahoma"}},{title:"Terminal",inline:"span",styles:{"font-family":"terminal,monaco"}},{title:"Times New Roman",inline:"span",styles:{"font-family":"times new roman,times"}},{title:"Verdana",inline:"span",styles:{"font-family":"Verdana"}}]},{title:"Font Size",items:[{title:"x-small",inline:"span",styles:{fontSize:"x-small","font-size":"x-small"}},{title:"small",inline:"span",styles:{fontSize:"small","font-size":"small"}},{title:"medium",inline:"span",styles:{fontSize:"medium","font-size":"medium"}},{title:"large",inline:"span",styles:{fontSize:"large","font-size":"large"}},{title:"x-large",inline:"span",styles:{fontSize:"x-large","font-size":"x-large"}},{title:"xx-large",inline:"span",styles:{fontSize:"xx-large","font-size":"xx-large"}}]}]};document.documentElement.clientWidth<385?(d.toolbar1="myEdit myInsert styles saveclose",d.toolbar2="bullist numlist outdent indent bold italic asciimath asciisvg"):document.documentElement.clientWidth<465?(d.toolbar1="myEdit myInsert styles forecolor saveclose",d.toolbar2="bullist numlist outdent indent bold italic asciimath asciisvg"):document.documentElement.clientWidth<575?(d.toolbar1="myEdit myInsert styles bold italic underline forecolor saveclose",d.toolbar2=" alignleft aligncenter | bullist numlist outdent indent  | link image | asciimath asciimathcharmap asciisvg"):document.documentElement.clientWidth<665&&(d.toolbar1="myEdit myInsert styles bold italic underline subscript superscript forecolor snippet saveclose",d.toolbar2=" alignleft aligncenter alignright | bullist numlist outdent indent  | attach link image | asciimath asciimathcharmap asciisvg"),location.href.match(/usealted/)&&(delete d.toolbar1,delete d.toolbar2,d.menu={altinsert:{title:"Insert",items:"media link image attach snippet inserttable | asciimath asciimathcharmap asciisvg | charmap emoticons anchor hr"}},d.menubar="edit altinsert format tools table",d.toolbar="alignleft aligncenter | bullist numlist outdent indent | bold italic",d.mobile.menubar="edit altinsert format tools table"),o&&(d.setup=o),a&&(d=Object.assign(d,a)),tinymce.remove(l),tinymce.init(d)}function filePickerCallBack(e,t,i){var n=imasroot+"/tinymce8/file_manager.php";switch(i.filetype){case"image":n+="?type=img";break;case"file":n+="?type=files"}tinyMCE.activeEditor.windowManager.openUrl({url:n,title:"File Manager",width:350,height:450,resizable:"yes",inline:"yes",close_previous:"no",onMessage:function(t,i){i.data.filename&&e(i.data.filename)}})}const image_upload_handler=(e,t)=>new Promise(((i,n)=>{const o=new XMLHttpRequest;o.withCredentials=!1,o.open("POST",imasroot+"/tinymce8/upload_handler.php"),o.upload.onprogress=e=>{t&&t(e.loaded/e.total*100)},o.onload=()=>{if(403===o.status)return void n({message:"HTTP Error: "+o.status,remove:!0});if(o.status<200||o.status>=300)return void n({message:"HTTP Error: "+o.status,remove:!0});const e=JSON.parse(o.responseText);e&&"string"==typeof e.location?i(e.location):n({message:"Invalid JSON: "+o.responseText,remove:!0})},o.onerror=()=>{n({message:"Image upload failed due to a XHR Transport error. Code: "+o.status,remove:!0})};const a=new FormData;doImageUploadResize(e.blob(),(function(t,i){let n=e.filename();i&&(n=n.replace(/\.\w+$/,".jpg")),a.append("file",t,n),o.send(a)}))}));function imascleanup(e,t){return"get_from_editor"==e&&(t=(t=(t=(t=(t=t.replace(/<!--([\s\S]*?)-->|&lt;!--([\s\S]*?)--&gt;|<style>[\s\S]*?<\/style>/g,"")).replace(/class="?Mso\w+"?/g,"")).replace(/<p\s*>\s*<\/p>/gi,"")).replace(/<script.*?\/script>/gi,"")).replace(/<input[^>]*button[^>]*>/gi,"")),t}function readCookie(e){for(var t=e+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var o=i[n];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return unescape(o.substring(t.length,o.length))}return null}function selectByDivID(e){for(var t=e.value,i=e.value.split(":")[0],n=document.getElementsByTagName("div"),o=0;o<n.length;o++)n[o].className.match(i)&&(n[o].style.display=n[o].id==t?"block":"none");var a=new Date;a.setDate(a.getDate()+365),setCookie(i+"store",t,a.toGMTString())}function setselectbycookie(){for(var e=document.getElementsByTagName("select"),t=0;t<e.length;t++)if(e[t].className.match("alts")){var i=e[t].className.replace(/alts/,"").replace(/\s/g,"");null!=(co=readCookie(i+"store"))&&(co=co.replace("store",""),e[t].value=co,selectByDivID(e[t]))}}addLoadEvent(setselectbycookie);var recordedunload=!1;function recclick(e,t,i,n){if(cid>0){var o,a="";if(null!==(o=window.location.href.match(/showlinkedtext.*?&id=(\d+)/))&&0==recordedunload&&(a="&unloadinglinked="+o[1],recordedunload=!0),navigator.sendBeacon){var r=new FormData;r.append("type",e),r.append("typeid",t),r.append("info",i+"::"+n),""!=a&&r.append("unloadinglinked",o[1]),navigator.sendBeacon(imasroot+"/course/rectrack.php?cid="+cid,r)}else jQuery.ajax({type:"POST",url:imasroot+"/course/rectrack.php?cid="+cid,data:"type="+encodeURIComponent(e)+"&typeid="+encodeURIComponent(t)+"&info="+encodeURIComponent(i+"::"+n)+a})}}function setuptracklinks(e,t){jQuery(t).attr("data-base")&&jQuery(t).off("click.recclick").on("click.recclick",(function(e){var i=jQuery(this).attr("data-base").split("-");if(recclick(i[0],i[1],jQuery(this).attr("href"),jQuery(this).clone().find(".sr-only").remove().end().text()),void 0===jQuery(t).attr("target"))return e.preventDefault(),setTimeout('window.location.href = "'+jQuery(this).attr("href")+'"',100),!1})).off("mousedown.recclick").on("mousedown.recclick",(function(e){if(3==e.which){var t=jQuery(this).attr("data-base").split("-");recclick(t[0],t[1],jQuery(this).attr("href"),jQuery(this).clone().find(".sr-only").remove().end().text())}}))}var videoembedcounter=0;function togglevideoembed(){var e=this.id.substr(13),t=jQuery("#videoiframe"+e);if(t.length>0)"none"==t.css("display")?(t.show(),t.closest(".video-wrapper-wrapper").show(),jQuery(this).text(" [-]").attr("title",_("Hide video")).attr("aria-label",_("Hide embedded video"))):(t.hide(),t.get(0).contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*"),t.closest(".video-wrapper-wrapper").hide(),jQuery(this).text(" [+]"),jQuery(this).attr("title",_("Watch video here")),jQuery(this).attr("aria-label",_("Embed video")+" "+jQuery(this).prev().text()));else{var i=jQuery(this).prev().attr("href");i=rewriteVideoUrl(i);var n=jQuery("<iframe/>",{id:"videoiframe"+e,width:640,height:400,src:i,frameborder:0,allowfullscreen:1}),o=jQuery(this);if(0==o.closest(".itemhdr").length)n.insertAfter(o),o.parent().fitVids();else{var a=o.closest(".itemhdr").next();a.prepend(n),a.fitVids()}if(o.text(" [-]").attr("title",_("Hide video")).attr("aria-label",_("Hide embedded video")),o.prev().attr("data-base")&&"open"!==o.prev().attr("data-def")){var r=o.prev().attr("data-base").split("-");recclick(r[0],r[1],i,o.prev().text())}}}function rewriteVideoUrl(e){var t="?";if((e=e.replace(/%3F/g,"?").replace(/%3D/g,"=")).match(/youtube\.com/))if(e.indexOf("playlist?list=")>-1){var i=e.split("list=")[1].split(/[#&]/)[0],n="www.youtube.com/embed/videoseries?list=";t="&"}else if(e.match(/\/embed\//))i=e.split("/embed/")[1].split(/[#&\?]/)[0],n="www.youtube.com/embed/";else i=e.split("v=")[1].split(/[#&]/)[0],n="www.youtube.com/embed/";else if(e.match(/youtu\.be/)){n="www.youtube.com/embed/";(i=e.split(".be/")[1].split(/[#&]/)[0]).indexOf("?")>-1&&(t="&")}else{if(!e.match(/vimeo/))return e.match(/loom/)?e.replace("/share/","/embed/"):e;i=e.split(".com/")[1].split(/[#&]/)[0],n="player.vimeo.com/video/"}var o=e.match(/.*\Wt=((\d+)m)?((\d+)s?)?.*/);if(null==o){var a=t+"rel=0";null!=(o=e.match(/.*start=(\d+)/))&&(a+="&start="+o[1])}else a=t+"rel=0&start="+((o[2]?60*o[2]:0)+(o[4]?1*o[4]:0));return null!=(o=e.match(/.*end=(\d+)/))&&(a+="&end="+o[1]),a+="&enablejsapi=1",("https:"==location.protocol?"https:":"http:")+"//"+n+i+a}function setupvideoembeds(e,t){jQuery("<span/>",{text:" [+]",role:"button",title:_("Watch video here"),"aria-label":_("Embed video")+" "+this.textContent,id:"videoembedbtn"+videoembedcounter,click:togglevideoembed,keydown:function(e){13==e.which&&$(this).click()},tabindex:0,class:"videoembedbtn"}).insertAfter(t),jQuery(t).addClass("prepped"),"open"===t.getAttribute("data-def")&&jQuery(t).next().trigger("click"),videoembedcounter++}var fileembedcounter=0;function setuppreviewembeds(e,t){var i="doc|docx|pdf|xls|xlsx|ppt|pptx|jpg|gif|png|jpeg";window.fetch&&(i+="|heic");var n=new RegExp(".("+i+")($|\\?)","i");t.href.match(n)&&(jQuery("<span/>",{text:" [+]",role:"button",title:_("Preview file"),"aria-label":_("Preview file"),id:"fileembedbtn"+fileembedcounter,click:function(){togglefileembed(this.id)},keydown:function(e){13==e.which&&$(this).click()},tabindex:0,class:"videoembedbtn"}).insertAfter(t),jQuery(t).addClass("prepped"),fileembedcounter++)}function supportsPdf(){var e=window.navigator.userAgent;return-1!==e.indexOf("irefox")&&parseInt(e.split("rv:")[1].split(".")[0],10)>18||void 0!==navigator.mimeTypes["application/pdf"]}function togglefileembed(e,t){var i=jQuery("#fileiframe"+e),n=jQuery("#"+e);if(i.length>0)if("none"==i.css("display")){if(!1===t)return;i.show(),n.text(" [-]"),n.attr("title",_("Hide preview")),n.attr("aria-label",_("Hide file preview"))}else{if(!0===t)return;i.hide(),n.text(" [+]"),n.attr("title",_("Preview file")),n.attr("aria-label",_("Preview file"))}else{if(!1===t)return;var o,a=n.prev().attr("href");a.match(/\.(doc|docx|pdf|xls|xlsx|ppt|pptx)($|\?)/i)?(o=a.match(/\.pdf/)&&supportsPdf()?a:a.match(/\.(doc|docx|xls|xlsx|ppt|pptx)($|\?)/i)?"https://view.officeapps.live.com/op/embed.aspx?src="+encodeURIComponent(a):"https://docs.google.com/gview?embedded=true&url="+encodeURIComponent(a),jQuery("<iframe/>",{id:"fileiframe"+e,width:"90%",height:600,src:o,frameborder:0,allowfullscreen:1}).insertAfter(n)):a.match(/\.(heic)($|\?)/i)?(jQuery("<div>",{id:"fileiframe"+e,text:"Converting HEIC file (this may take a while)..."}).insertAfter(n),window.heic2any?convertheic(a,"fileiframe"+e):jQuery.getScript(staticroot+"/javascript/heic2any.min.js").done((function(){convertheic(a,"fileiframe"+e)}))):jQuery("<div>").append(jQuery("<img/>",{id:"fileiframe"+e,src:a}).css("display","block").on("click",rotateimg)).insertAfter(n);if(jQuery("<br/>").insertAfter(n),n.text(" [-]"),n.attr("title",_("Hide preview")),n.prev().attr("data-base")){var r=n.prev().attr("data-base").split("-");recclick(r[0],r[1],a,n.prev().text())}}}function convertheic(e,t){fetch(e).then((function(e){return e.blob()})).then((function(e){return heic2any({blob:e})})).then((function(e){var i=URL.createObjectURL(e);document.getElementById(t).innerHTML='<img src="'+i+'" onclick="rotateimg(this)">'})).catch((function(e){console.log(e)}))}function addNoopener(e,t){!t.rel&&t.target&&t.host!==window.location.host&&t.setAttribute("rel","noopener noreferrer")}function addBlankTarget(e,t){t.host!==window.location.host&&t.setAttribute("target","_blank")}function uniqid(e){return(e||"")+"_"+Math.random().toString(36).substr(2,9)}function setariastatus(e){var t=document.getElementById("ariastatus");t||(t=$("<div>",{id:"ariastatus",role:"status",class:"sr-only","aria-live":"polite"}),$("body").append(t),t=t[0]),t.innerHTML=e}function addmultiselect(e,t){var i=jQuery(e).parent(),n=jQuery("#"+t).val(),o=jQuery("#"+t+" option[value="+n+"]").prop("disabled",!0).html();"null"!=n&&i.append('<div class="multiselitem"><span class="right"><a href="#" onclick="removemultiselect(this);return false;">Remove</a></span><input type="hidden" name="'+t+'[]" value="'+n+'"/>'+o+"</div>"),jQuery("#"+t).val("null")}function removemultiselect(e){var t=jQuery(e).parent().parent(),i=t.find("input").val();t.parent().find("option[value="+i+"]").prop("disabled",!1),t.remove()}function hidefromcourselist(e,t,i){return confirm("Are you SURE you want to hide this course from your course list?")&&jQuery.ajax({type:"GET",url:imasroot+"/admin/hidefromcourselist.php?tohide="+t+"&type="+i}).done((function(t){"OK"==t&&(jQuery(e).closest("ul.courselist > li").slideUp(),jQuery("#unhidelink"+i).show())})),!1}function removeSelfAsCoteacher(e,t,i,n){return i=i||"ul.courselist > li",n=n||null,confirm("Are you SURE you want to remove yourself as a co-teacher on this course?")&&jQuery.ajax({type:"POST",url:imasroot+"/admin/actions.php",data:{action:"removeself",id:t,uid:n}}).done((function(t){"OK"==t&&jQuery(e).closest(i).slideUp()})),!1}function rotateimg(e){if(e.hasOwnProperty("target")&&(e=e.target),$(e).data("rotation"))var t=($(e).data("rotation")+90)%360;else t=90;var i,n;$(e).parent().css("height","auto");var o=$(e).parent().width();$(e).data("rotation",t).css({transform:"rotate("+t+"deg)"}),t%180==90?($(e).css("transform-origin","0 0").css("max-width","none"),n=(i=e.getBoundingClientRect()).width>o?.95*o/i.width:1,90==t?$(e).data("rotation",t).css({transform:"rotate("+t+"deg) scale("+n+") translateY("+-i.width+"px) "}):$(e).data("rotation",t).css({transform:"rotate("+t+"deg) scale("+n+") translateX("+-i.height+"px) "}),i=e.getBoundingClientRect(),$(e).parent().css("height",i.height)):($(e).css("transform-origin","").css("max-width","80%"),$(e).parent().css("height",""))}function sendLTIresizemsg(){var e=Math.max(document.body.scrollHeight,document.body.offsetHeight)+100;window.parent!=window.self&&parent.postMessage(JSON.stringify({subject:"lti.frameResize",height:e}),"*")}function initlinkmarkup(e){"undefined"!=typeof isImathasAssessment&&$(e).find("a:not([target])").not(".textsegment a, .mce-content-body a").each(addBlankTarget),$(e).find("a").each(setuptracklinks).each(addNoopener),$(e).find('a[href*="youtu"]').not(".textsegment a,.mce-content-body a,.prepped").each(setupvideoembeds),$(e).find('a[href*="vimeo"]').not(".textsegment a,.mce-content-body a,.prepped").each(setupvideoembeds),$(e).find('a[href*="loom.com/share"],a[href*="loom.com/embed"]').not(".textsegment a,.mce-content-body a,.prepped").each(setupvideoembeds),$(e).find("a.attach").not(".textsegment a,.mce-content-body a").not(".prepped").each(setuppreviewembeds),setIframeSpinner(e),setupToggler(e),setupToggler2(e),setupPopuplinks(e),$(e).fitVids(),resizeResponsiveIframes(e,!0)}function setIframeSpinner(e){jQuery(e).find("iframe").each((function(e,t){""==t.style.background&&(t.style.background="url("+staticroot+"/img/updating.gif) center center no-repeat"),$(t).on("load",(function(){this.style.backgroundImage="none"}))}))}function resizeResponsiveIframes(e,t){t&&jQuery(e).find("iframe.scaleresponsive").wrap(jQuery("<div>",{css:{overflow:"hidden"}})),jQuery(e).find("iframe.scaleresponsive").each((function(e,t){var i=t.parentNode,n=Math.min(1,i.offsetWidth/parseInt(t.width||t.style.width));t.style.transform="scale("+n+")",i.style.height=n*parseInt(t.height||t.style.height)+3+"px"}))}function _(e){if("undefined"!=typeof i18njs&&i18njs[e])var t=i18njs[e];else t=e;if(arguments.length>1)for(var i=1;i<arguments.length;i++)t=t.replace("$"+i,arguments[i]);return t}function randID(){return"_"+Math.random().toString(36).substr(2,9)}function setupToggler(e){$(e).find("*[data-toggler]:not(.togglerinit)").each((function(){var e=$(this).attr("id")||randID();"IFRAME"===$(this).prop("tagName")&&$(this).css("display","block");var t="block"==$(this).css("display"),i=$(this).attr("data-toggler"),n=$(this).attr("data-toggler-hide")||i,o=$("<button>",{id:"togbtn"+e,type:"button",text:i,"aria-controls":e});$(this).hide().attr("id",e).addClass("togglerinit").before(o),o.attr("aria-expanded",!1).attr("tabindex",0).css("cursor","pointer").on("click keydown",(function(e){if("click"==e.type||13==e.which){var o=$("#"+$(this).attr("aria-controls"));"true"==$(this).attr("aria-expanded")?($(this).attr("aria-expanded",!1),i!=n&&($(this).text(i),rendermathnode(this)),t?o.slideUp(300):o.hide()):($(this).attr("aria-expanded",!0),i!=n&&($(this).text(n),rendermathnode(this)),t?o.slideDown(300):o.show()),sendLTIresizemsg()}}))}))}function setupToggler2(e){$(e).find(".togglecontrol:not(.togglerinit)").each((function(){$(this).addClass("togglerinit").attr("aria-expanded",!1).on("click keydown",(function(e){if("click"==e.type||13==e.which){var t=$("#"+$(this).attr("aria-controls"));return"true"==$(this).attr("aria-expanded")?($(this).attr("aria-expanded",!1),t.hide()):($(this).attr("aria-expanded",!0),t.show()),sendLTIresizemsg(),!1}}))}))}function setupPopuplinks(e){var t=["popup","width","innerWidth","height","innerHeight","left","screenX","top","screenY"];$(e).find("a[data-popup]").each((function(e,i){i.id||(i.id="link"+Math.random().toString(16).slice(2)),$(i).off("click.popup").on("click.popup",(function(e){e.preventDefault();var n=i.getAttribute("data-popup").split(/,/),o=[];for(let e=0;e<n.length;e++){let i=n[e].split(/=/);2==i.length&&t.includes(i[0])&&o.push(i[0]+"="+parseInt(i[1]))}return console.log(o.join(",")),window.open(i.href,"popup_"+i.id,o.join(",")),!1}))}))}function groupToggleAll(e){$(".grouptoggle").attr("aria-expanded",1!=e).trigger("click")}function initFileAlt(e){var t=jQuery(e).next().find(".filealt-label"),i=t.attr("data-def")||t.html();jQuery(e).off("focus.filealt, blur.filealt, click.filealt, change.filealt").on("focus.filealt",(function(e){jQuery(e.target).addClass("has-focus")})).on("blur.filealt",(function(e){jQuery(e.target).removeClass("has-focus")})).on("click.filealt",(function(e){t.html(i)})).on("change.filealt",(function(e){t.html(_("Preparing file...")),doImageUploadResize(this,(function(e){var i;if(i=e.value.split(/(\\|\/)/g).pop()){e.files[0].size>1024e4?(alert(_("This file is too large - maximum size is 10MB")),$(e).val(""),t.html("")):t.html(i)}}))}))}function setAltSelectors(e,t){$(".alts."+e).parents(".altWrap").find(".altContentOn").removeClass("altContentOn").addClass("altContentOff"),$(".alts."+e).parents(".altWrap").find("."+t).addClass("altContentOn").removeClass("altContentOff"),$("select.alts."+e).val(e+":"+t);var i=new Date;i.setDate(i.getDate()+365),setCookie("alt_store_"+e,t,i.toGMTString())}jQuery((function(){var e;(e=window.location.href.match(/course\.php.*cid=(\d+).*folder=([\d\-]+)/))&&window.sessionStorage.setItem("btf"+e[1],e[2]),jQuery('a[href*="course.php"]').each((function(t,i){if(!i.href.match(/folder=/)&&(e=i.href.match(/cid=(\d+)/))){var n=window.sessionStorage.getItem("btf"+e[1])||"";""!==n&&(i.href+="&folder="+n)}})),jQuery("form").each((function(t,i){if(i.hasAttribute("action")&&(e=i.getAttribute("action").match(/cid=(\d+)/))){var n=window.sessionStorage.getItem("btf"+e[1])||"";""!==n&&i.setAttribute("action",i.getAttribute("action")+"&btf="+n)}}))})),jQuery(document).ready((function(e){e(window).on("message",(function(t){if("string"==typeof t.originalEvent.data&&t.originalEvent.data.match(/lti\.frameResize/)){if("frame_id"in(o=JSON.parse(t.originalEvent.data)))e("#"+o.frame_id).height(o.height),o.wrapheight&&e("#"+o.frame_id+"wrap").height(o.wrapheight);else if("iframe_resize_id"in o)e("#"+o.iframe_resize_id).height(o.height);else for(var i=document.getElementsByTagName("iframe"),n=0;n<i.length;n++)if(i[n].contentWindow===t.originalEvent.source&&!i[n].hasAttribute("data-noresize")){e(i[n]).height(o.height);break}}else if("string"==typeof t.originalEvent.data&&t.originalEvent.data.match(/\[iFrameSizer\]/)){var o=t.originalEvent.data.substr(13).split(":");e("#"+o[0]).height(o[1])}else if("string"==typeof t.originalEvent.data&&t.originalEvent.data.match(/imathas\.update/)){if("qn"in(o=JSON.parse(t.originalEvent.data))){var a=o.qn.replace(/[^\d]/,"");""!=a&&e("#qn"+a).val(o.value).trigger("change")}else{var r=o.id.replace(/[^\w\-]/,"");e("#"+r).hasClass("allowupdate")&&e("#"+r).val(o.value).trigger("change")}}}))})),jQuery(document).ready((function(e){initlinkmarkup("body"),e(window).on("resize",(function(){resizeResponsiveIframes("body")}))})),jQuery((function(e){e("#ltimenubutton").on("click",(function(){var t=e("#ltimenubutton");t.attr("data-loaded")||e.ajax({type:"GET",url:imasroot+"/lti/ltimenu.php?launchid="+encodeURIComponent(window.sessionStorage.getItem("LTI1p3_launchid"))}).done((function(i){e("#ltimenudiv").html(i),t.attr("data-loaded",1),setCookie("fromltimenu",1),sendLTIresizemsg()}))}))})),jQuery.fn.isolatedScroll=function(){return this.bind("mousewheel DOMMouseScroll",(function(e){var t=e.wheelDelta||e.originalEvent&&e.originalEvent.wheelDelta||-e.detail,i=this.scrollTop+jQuery(this).outerHeight()-this.scrollHeight>=0,n=this.scrollTop<=0;(t<0&&i||t>0&&n)&&e.preventDefault()})),this},jQuery(document).ready((function(e){for(var t=e(".fixedonscroll"),i=[],n=0;n<t.length;n++)i[n]=e(t[n]).offset().top,e(t[n]).height()>e(window).height()&&(i[n]=-1);t.length>0&&e(window).scroll((function(){for(var n=e(window).scrollTop(),o=0;o<t.length;o++)n>i[o]&&i[o]>0?e(t[o]).css("position","fixed").css("top","5px").attr("data-fixed",!0):e(t[o]).css("position","static").attr("data-fixed",!1)}))})),jQuery(document).ready((function(e){e(".grouptoggle").each((function(){var t=randID(),i=e(this).next(".blockitems"),n=i.hasClass("hidden");n?i.hide().removeClass("hidden"):i.show(),i.attr("id","bi"+t),e(this).attr("id",t).attr("aria-controls","bi"+t).attr("role","button").attr("aria-expanded",!n).attr("tabindex",0).css("cursor","pointer").on("click keydown",(function(t){"click"!=t.type&&13!=t.which||("true"==e(this).attr("aria-expanded")?(e(this).attr("aria-expanded",!1),e(this).children("img").attr("src",staticroot+"/img/expand.gif"),e(this).next(".blockitems").slideUp()):(e(this).attr("aria-expanded",!0),e(this).children("img").attr("src",staticroot+"/img/collapse.gif"),e(this).next(".blockitems").slideDown())),sendLTIresizemsg()}))})),e(".grouptoggle img").attr("alt","expand/collapse")})),jQuery("input.filealt").each((function(e,t){initFileAlt(t)})),function(e){"use strict";e.fn.fitVids=function(){return this.each((function(){e(this).find(["iframe[src*='player.vimeo.com']","iframe[src*='youtube.com']","iframe[src*='youtube-nocookie.com']","iframe[src*='loom.com']"].join(",")).each((function(){var t=e(this);if(t.closest(".textsegment").length>0)return!0;if(t.closest(".fluid-width-video-wrapper").length>0)return!0;t.parentsUntil(".intro","table").each((function(){e(this).css("width","100%")}));var i=t.attr("height")&&!isNaN(parseInt(t.attr("height"),10))?parseInt(t.attr("height"),10):t.height(),n=isNaN(parseInt(t.attr("width"),10))?t.width():parseInt(t.attr("width"),10),o=i/n;if(!t.attr("id")){var a="fitvid"+Math.floor(999999*Math.random());t.attr("id",a)}t.wrap('<div class="fluid-width-video-wrapper"></div>').parent(".fluid-width-video-wrapper").css("padding-top",100*o+"%").wrap('<div class="video-wrapper-wrapper"></div>').parent(".video-wrapper-wrapper").css("max-width",n+"px"),t.removeAttr("height").removeAttr("width").css("height","").css("width","")}))}))}}(window.jQuery||window.Zepto),jQuery(document).ready((function(e){e(".alts").on("change",(function(){var e=this.value.split(":");e.length>1&&setAltSelectors(e[0],e[1])})).each((function(t,i){var n=i.value.split(":");null!=(co=readCookie("alt_store_"+n[0]))?setAltSelectors(n[0],co):e(i).hasClass("setDefault")&&setAltSelectors(n[0],n[1])})),e(document).on("keydown",(function(t){8!==t.which||e(t.target).is("input[type='text']:not([readonly]),input[type='number']:not([readonly]),input:not([type]):not([readonly]),input[type='password']:not([readonly]),input[type='url']:not([readonly]),input[type='email']:not([readonly]), textarea, [contenteditable='true']")||t.preventDefault()})),e("div.breadcrumb").attr("role","navigation").attr("aria-label",_("Navigation breadcrumbs")),e("div.cpmid,div.cp").attr("role","group").attr("aria-label",_("Control link group")),e("#centercontent").length?(e("#centercontent").attr("role","main"),e(".midwrapper").removeAttr("role")):e("div[role=main]").length>1&&e(".midwrapper").removeAttr("role")})),jQuery(document).ready((function(e){function t(t){var i=e("#headermobilemenulist");"true"==i.attr("aria-hidden")?(e("#headermobilemenulist").slideDown(50,(function(){e("#headermobilemenulist").addClass("menuexpanded").removeAttr("style"),i.attr("aria-hidden",!1),e("#topnavmenu").attr("aria-expanded",!0)})),e("#navlist").slideDown(100,(function(){e("#navlist").addClass("menuexpanded").removeAttr("style")}))):(e("#navlist").slideUp(100,(function(){e("#navlist").removeClass("menuexpanded").removeAttr("style")})),e("#headermobilemenulist").slideUp(50,(function(){e("#headermobilemenulist").removeClass("menuexpanded").removeAttr("style"),i.attr("aria-hidden",!0),e("#topnavmenu").attr("aria-expanded",!1)}))),t.preventDefault()}e("#topnavmenu").on("click",t).on("keydown",(function(e){13!==e.which&&32!=e.which||t(e)}))}));var sagecellcounter=0;function initSageCell(e){jQuery(e).find(".converttosagecell:visible:not(.inited)").each((function(){var e,t,i,n=jQuery(this);if(n.is("pre"))e=this,i=jQuery(e).html();else{if(0==(e=n.find("textarea")).length||""==jQuery(e[0]).val()){if(!(n.find("pre").length>0))return!1;i=n.find("pre").html(),e=0==e.length?n.find("pre")[0]:e[0]}else i=jQuery(e[0]).val(),e=e[0];t=n.find("input[id^=qn]")}if(i=i.replace(/<br\s*\/?>/g,"\n").replace(/<\/?[a-zA-Z][^>]*>/g,"").replace(/\n\n/g,"\n").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&"),m=i.match(/^\s+/)){var o=m[0].length,a=new RegExp("\\n\\s{"+o+"}","g");i=i.substr(o).replace(a,"\n").replace(/\s+$/,"")}var r="sagecell-"+sagecellcounter;sagecellcounter++;var s=imasroot+"/assessment/libs/sagecellframe.html?frame_id="+r;s+="&code="+encodeURIComponent(i),["lang","hide","autoeval"].forEach((function(e){n[0].hasAttribute("data-"+e)&&(s+="&"+e+"="+encodeURIComponent(n.attr("data-"+e)))}));void 0!==jQuery(e).attr("id")&&(s+="&update_id="+jQuery(e).attr("id")),null!==t&&(s+="&update_out="+jQuery(t).attr("id"),jQuery(t).addClass("allowupdate").hide()),s+="&evallabel="+encodeURIComponent(_("Evaluate")),n.addClass("inited"),jQuery(e).addClass("allowupdate").hide().after(jQuery("<iframe/>",{id:r,class:"sagecellframe",style:"border:0",width:"100%",height:100,src:s}))}))}function setActiveTab(e){jQuery(e).closest(".tabwrap").find("li.active").removeClass("active"),jQuery(e).closest(".tablist").find("a[role=tab]").attr("aria-selected",!1),jQuery(e).attr("aria-selected",!0),jQuery(e).parent().addClass("active"),-1==e.getAttribute("tabindex")&&(jQuery(e).closest(".tablist").find("a[role=tab]").attr("tabindex",-1),e.setAttribute("tabindex",0)),jQuery(e).closest(".tabwrap").find(".tabpanel").hide().attr("aria-hidden",!0);var t=e.getAttribute("aria-controls");jQuery(e).closest(".tabwrap").find("#"+t).show().attr("aria-hidden",!1)}function setCookie(e,t,i){i=i||0;let n=encodeURIComponent(e)+"="+encodeURIComponent(t);n+=";path="+(""==imasroot?"/":imasroot),"http:"!==location.protocol&&(n+="; Secure",n+="; samesite=none"),i>0&&(n+="; expires="+i),document.cookie=n}function doImageUploadResize(e,t){let i,n,o;if(e instanceof HTMLElement?(o=e,n=e.files[0],i="file"):e instanceof Blob&&(n=e,i="blob"),n&&n.type.startsWith("image")){var a=new FileReader;a.onload=function(e){var a=document.createElement("img"),r=document.createElement("canvas");a.src=e.target.result,a.onload=function(){r.getContext("2d").drawImage(a,0,0);var e=a.width,s=a.height,l="";if(a.width>1e3||a.height>1e3){const t=Math.min(1e3/a.width,1e3/a.height);e=Math.round(a.width*t),s=Math.round(a.height*t),l="resized_"}r.width=e,r.height=s,r.getContext("2d").drawImage(a,0,0,e,s),r.toBlob((function(e){if("blob"===i)"function"==typeof t&&t(e,!0);else{var a=new File([e],l+n.name.replace(/\.\w+$/,".jpg"),n),r=new DataTransfer;r.items.add(a);var s=o.onchange;o.onchange=null,o.files=r.files,o.onchange=s,"function"==typeof t&&t(o,!0)}}),"image/jpeg",.95)}},a.readAsDataURL(n)}else t(e,!1)}jQuery((function(){initSageCell("body")})),function(e){"use strict";var t='[data-toggle="dropdown"]',i=function(t){e(t).next(".dropdown-menu").children("li").attr("role","menuitem")};function n(t){var i=t.attr("data-target");i||(i=(i=t.attr("href"))&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""));var n="#"!==i?e(document).find(i):null;return n&&n.length?n:t.parent()}function o(i){i&&3===i.which||(e(".dropdown-backdrop").remove(),e(t).each((function(){var t=e(this),o=n(t),a={relatedTarget:this};o.hasClass("open")&&(i&&"click"==i.type&&/input|textarea/i.test(i.target.tagName)&&e.contains(o[0],i.target)||(o.trigger(i=e.Event("hide.bs.dropdown",a)),i.isDefaultPrevented()||(t.attr("aria-expanded","false"),o.removeClass("open").trigger(e.Event("hidden.bs.dropdown",a)))))})))}i.VERSION="3.4.1",i.prototype.toggle=function(t){var i=e(this);if(!i.is(".disabled, :disabled")){var a=n(i),r=a.hasClass("open");if(o(),!r){"ontouchstart"in document.documentElement&&!a.closest(".navbar-nav").length&&e(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(e(this)).on("click",o);var s={relatedTarget:this};if(a.trigger(t=e.Event("show.bs.dropdown",s)),t.isDefaultPrevented())return;i.next(".dropdown-menu").children("li").attr("role","menuitem"),i.trigger("focus").attr("aria-expanded","true"),a.toggleClass("open").trigger(e.Event("shown.bs.dropdown",s))}return!1}},i.prototype.keydown=function(i){if(/(38|40|27|32|39|37|9)/.test(i.which)&&!/input|textarea/i.test(i.target.tagName)&&(9!=i.which||!e(i.target).hasClass("dropdown-toggle"))){var o=e(this);if(i.preventDefault(),i.stopPropagation(),!o.is(".disabled, :disabled")){var a=n(o),r=a.hasClass("open");if(!r&&27!=i.which||r&&27==i.which)return 27==i.which&&a.find(t).trigger("focus"),o.trigger("click");var s=e(i.target).closest(".dropdown-submenu");r&&37==i.which&&s.length&&(s.removeClass("open").children("a").attr("aria-expanded",!1),s.children("a").first().focus());var l=o.next(".dropdown-menu li:not(.disabled):visible a");if(l.length||(l=a.children(".dropdown-menu").children("li:not(.disabled):visible").children("a")),l.length){var d=l.index(i.target);(38==i.which||9==i.which&&i.shiftKey)&&d>0&&d--,(40==i.which||9==i.which&&!i.shiftKey)&&d<l.length-1&&d++,~d||(d=0),l.eq(d).trigger("focus")}}}},i.prototype.submenu=function(t){("keydown"!=t.type||/(13|39)/.test(t.which))&&(e(".dropdown-submenu").removeClass("open").children("a").attr("aria-expanded",!1),e(this).closest(".dropdown-submenu").addClass("open").children("a").attr("aria-expanded",!0),"keydown"==t.type&&e(this).next(".dropdown-menu").find("a").first().focus(),t.stopPropagation(),t.preventDefault())};var a=e.fn.dropdown;e.fn.dropdown=function(t){return this.each((function(){var n=e(this),o=n.data("bs.dropdown");o||n.data("bs.dropdown",o=new i(this)),"string"==typeof t&&o[t].call(n)}))},e.fn.dropdown.Constructor=i,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=a,this},e(document).on("click.bs.dropdown.data-api",o).on("click.bs.dropdown.data-api",".dropdown form",(function(e){e.stopPropagation()})).on("click.bs.dropdown.data-api",t,i.prototype.toggle).on("keydown.bs.dropdown.data-api",t,i.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",i.prototype.keydown).on("click.bs.dropdown keydown.bs.dropdown",".dropdown-submenu > a",i.prototype.submenu)}(jQuery),$((function(){$(".dropdown-toggle").dropdown()})),$((function(){$("#pageskipnav").on("click",(function(e){e.preventDefault(),$("div.scrollpane[tabindex=-1]").length>0?$("div.scrollpane[tabindex=-1]").first().focus():$("div.pagetitle").length>0&&$("div.pagetitle").attr("tabindex","-1").focus()}))}));
"use strict";function makeMathFunction(t,r,e,n,a){if(r=r||"",e=e||[],n=n||"",a=void 0!==a&&a,""===t.trim())return!1;try{var o=new MathParser(r,e,n,a);return o.parse(t),function(t){try{return o.evaluate(t)}catch(t){return Math.sqrt(-1)}}}catch(r){return console.error("Parse error on: "+t+". Error: "+r.message),!1}}function evalMathParser(t,r){if(r=void 0!==r&&r,""===t.trim())return Math.sqrt(-1);try{var e=new MathParser("",[],"",r);return e.parse(t),e.evaluate()}catch(r){return console.error("Parse error on: "+t+". Error: "+r.message),Math.sqrt(-1)}}function MathParser(t,r,e,n){this.functions=[],this.variables=[],this.funcvariables=[],this.operators={},this.tokens=[],this.operatorStack=[],this.operandStack=[],this.AST=[],this.regex="",this.funcregex="",this.numvarregex="",this.variableValues={},this.origstr="",this.docomplex=n,this.allowEscinot=!0,""!==t&&(this.variables=t.split("|").map((function(t){return t.trim()})).filter((function(t){return t.length>0}))),""!==e&&(this.funcvariables=e.split("|").map((function(t){return t.trim()})).filter((function(t){return t.length>0}))),this.variables.push("pi","e"),n&&(this.docomplex=!0,this.variables.push("i")),this.variables.sort((function(t,r){return r.length-t.length})),this.allowEscinot=-1===this.variables.indexOf("E"),r.length>0?this.functions=r:this.functions="funcvar,arcsinh,arccosh,arctanh,arcsech,arccsch,arccoth,arcsin,arccos,arctan,arcsec,arccsc,arccot,root,sqrt,sign,sinh,cosh,tanh,sech,csch,coth,abs,sin,cos,tan,sec,csc,cot,exp,log,div,ln".split(",");var a=this.functions.concat(this.variables,["degree","degrees"]);a.sort((function(t,r){return r.length-t.length})),this.regex=new RegExp("^("+a.map((function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})).join("|")+")"),this.funcregex=new RegExp("("+this.functions.map((function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})).join("|")+")","i"),this.numvarregex=new RegExp("^(\\d+\\.?\\d*|"+this.variables.map((function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})).join("|")+")"),this.initializeOperators()}function factorial(t){if(t<0)return!1;if(0===t)return 1;for(let r=t-1;r>0;r--)t*=r;return t}function nthroot(t,r){if(0===t)return 0;if(Math.floor(r)!==r)return safepow(t,1/r);if(r%2==0&&t<0)throw new Error("Can't take even root of negative value");if(0===r)throw new Error("Can't take 0th root");return t<0?-1*Math.exp(1/r*Math.log(Math.abs(t))):Math.exp(1/r*Math.log(Math.abs(t)))}function funcvar(t,r){return r*Math.sin(r+t)}function safepow(t,r){if(0===t)return 0===r?(console.error("0^0 is undefined"),NaN):0;if("number"!=typeof t||"number"!=typeof r)return console.error("cannot evaluate powers with nonnumeric values"),NaN;if(t<0&&Math.floor(r)!==r){for(let e=3;e<50;e+=2)if(Math.abs(Math.round(e*r)-e*r)<1e-6)return Math.round(e*r)%2==0?Math.exp(r*Math.log(Math.abs(t))):-1*Math.exp(r*Math.log(Math.abs(t)));return console.error("invalid power for negative base"),NaN}return Math.pow(t,r)}function sec(t){var r=Math.cos(t);return Math.abs(r)<1e-16?NaN:1/r}function csc(t){var r=Math.sin(t);return Math.abs(r)<1e-16?NaN:1/r}function cot(t){var r=Math.tan(t);return Math.abs(r)<1e-16?NaN:1/r}function sech(t){var r=Math.cosh(t);return Math.abs(r)<1e-16?NaN:1/r}function csch(t){var r=Math.sinh(t);return Math.abs(r)<1e-16?NaN:1/r}function coth(t){var r=Math.tanh(t);return Math.abs(r)<1e-16?NaN:1/r}function asec(t){if(Math.abs(t)<1e-16)return NaN;var r=Math.round(1/t*1e12)/1e12;return Math.acos(r)}function acsc(t){if(Math.abs(t)<1e-16)return NaN;var r=Math.round(1/t*1e12)/1e12;return Math.asin(r)}function acot(t){return Math.abs(t)<1e-16?NaN:Math.atan(1/t)}function asech(t){if(Math.abs(t)<1e-16)return NaN;var r=Math.round(1/t*1e12)/1e12;return Math.acosh(r)}function acsch(t){if(Math.abs(t)<1e-16)return NaN;var r=Math.round(1/t*1e12)/1e12;return Math.asinh(r)}function acoth(t){if(Math.abs(t)<1e-16)return NaN;var r=Math.round(1/t*1e12)/1e12;return Math.atanh(r)}function cplx_subt(t,r){return[t[0]-r[0],t[1]-r[1]]}function cplx_mult(t,r){return[t[0]*r[0]-t[1]*r[1],t[0]*r[1]+t[1]*r[0]]}function cplx_div(t,r){var e=r[0]*r[0]+r[1]*r[1];if(0===e)throw new Error("Cannot divide by zero in complex division");return[(t[0]*r[0]+t[1]*r[1])/e,(t[1]*r[0]-t[0]*r[1])/e]}function cplx_sqrt(t){return cplx_nthroot(t,2)}function cplx_nthroot(t,r){var e=safepow(t[0]*t[0]+t[1]*t[1],r/(2*r)),n=Math.atan2(t[1],t[0]);return[e*Math.cos(n/r),e*Math.sin(n/r)]}function cplx_log(t,r=Math.E){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]),n=Math.atan2(t[1],t[0]);return[Math.log(e)/Math.log(r),n/Math.log(r)]}function cplx_exp(t){var r=Math.exp(t[0]);return[r*Math.cos(t[1]),r*Math.sin(t[1])]}function cplx_abs(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function cplx_sin(t){return[Math.sin(t[0])*Math.cosh(t[1]),Math.cos(t[0])*Math.sinh(t[1])]}function cplx_cos(t){return[Math.cos(t[0])*Math.cosh(t[1]),-1*Math.sin(t[0])*Math.sinh(t[1])]}function cplx_tan(t){return cplx_div(cplx_sin(t),cplx_cos(t))}function cplx_sec(t){return cplx_div([1,0],cplx_cos(t))}function cplx_csc(t){return cplx_div([1,0],cplx_sin(t))}function cplx_cot(t){return cplx_div(cplx_cos(t),cplx_sin(t))}function cplx_sinh(t){return[Math.sinh(t[0])*Math.cos(t[1]),Math.cosh(t[0])*Math.sin(t[1])]}function cplx_cosh(t){return[Math.cosh(t[0])*Math.cos(t[1]),Math.sinh(t[0])*Math.sin(t[1])]}function cplx_tanh(t){return cplx_div(cplx_sinh(t),cplx_cosh(t))}function cplx_sech(t){return cplx_div([1,0],cplx_cosh(t))}function cplx_csch(t){return cplx_div([1,0],cplx_sinh(t))}function cplx_coth(t){return cplx_div(cplx_cosh(t),cplx_sinh(t))}function cplx_asin(t){var r=[t[0]*t[0]-t[1]*t[1],2*t[0]*t[1]],e=cplx_nthroot([1-r[0],-1*r[1]],2),n=cplx_log([e[0]-t[1],e[1]+t[0]]);return[n[1],-1*n[0]]}function cplx_acos(t){var r=[t[0]*t[0]-t[1]*t[1],2*t[0]*t[1]],e=cplx_nthroot([r[0]-1,r[1]],2),n=cplx_log([e[0]+t[0],e[1]+t[1]]);return[n[1],-1*n[0]]}function cplx_atan(t){var r=cplx_log(cplx_div([-1*t[0],1-t[1]],[t[0],1+t[1]]));return[2*r[1],-2*r[0]]}function cplx_asinh(t){var r=cplx_sqrt([t[0]*t[0]-t[1]*t[1]+1,2*t[0]*t[1]]);return cplx_log([t[0]+r[0],t[1]+r[1]])}function cplx_acosh(t){var r=cplx_sqrt([t[0]*t[0]-t[1]*t[1]-1,2*t[0]*t[1]]);return cplx_log([t[0]+r[0],t[1]+r[1]])}function cplx_atanh(t){return cplx_mult([.5,1],cplx_log(cplx_div([1+t[0],t[1]],[1-t[0],-1*t[1]])))}function cplx_asec(t){var r=[t[0]*t[0]-t[1]*t[1],2*t[0]*t[1]],e=cplx_nthroot([1-r[0],-1*r[1]],2),n=cplx_log(cplx_div([1+e[0],e[1]],t));return[n[1],-1*n[0]]}function cplx_acsc(t){var r=[t[0]*t[0]-t[1]*t[1],2*t[0]*t[1]],e=cplx_nthroot([r[0]-1,r[1]],2),n=cplx_log(cplx_div([e[0],1+e[1]],t));return[n[1],-1*n[0]]}function cplx_acot(t){var r=cplx_log(cplx_div([t[0],t[1]+1],[t[0],t[1]-1]));return[2*r[1],-2*r[0]]}function cplx_asech(t){return cplx_acosh(cplx_div([1,0],t))}function cplx_acsch(t){return cplx_asinh(cplx_div([1,0],t))}function cplx_acoth(t){return cplx_mult([.5,1],cplx_log(cplx_div([t[0]+1,t[1]],[t[0]-1,t[1]])))}function cplx_factorial(t){if(0===t[1])return[factorial(t[0]),0];throw new Error("Complex factorial not fully implemented")}function cplx_funcvar(t,r){return Array.isArray(t)||(t=[t,0]),Array.isArray(r)||(r=[r,0]),cplx_mult(r,cplx_sin([r[0]+t[0],r[1]+t[1]]))}MathParser.prototype.initializeOperators=function(){var t=this;this.operators={"+":{precedence:11,assoc:"left",evalfunc:function(r,e){return t.docomplex?[r[0]+e[0],r[1]+e[1]]:r+e}},"-":{precedence:11,assoc:"left",evalfunc:function(r,e){return t.docomplex?[r[0]-e[0],r[1]-e[1]]:r-e}},"*":{precedence:12,assoc:"left",evalfunc:function(r,e){return t.docomplex?[r[0]*e[0]-r[1]*e[1],r[0]*e[1]+r[1]*e[0]]:r*e}},"/":{precedence:12,assoc:"left",evalfunc:function(r,e){if(t.docomplex){if(Math.abs(e[0])<1e-50&&Math.abs(e[1])<1e-50)throw new Error("Division by zero");var n=e[0]*e[0]+e[1]*e[1];return[(r[0]*e[0]+r[1]*e[1])/n,(r[1]*e[0]-r[0]*e[1])/n]}if(Math.abs(e)<1e-50)throw new Error("Division by zero");return r/e}},"^":{precedence:18,assoc:"right",evalfunc:function(r,e){if(t.docomplex){if(0===e[1]){var n=safepow(r[0]*r[0]+r[1]*r[1],e[0]/2),a=Math.atan2(r[1],r[0]);return[n*Math.cos(a*e[0]),n*Math.sin(a*e[0])]}var o=Math.atan2(r[1],r[0]),s=(n=safepow(r[0]*r[0]+r[1]*r[1],e[0]/2)*Math.exp(-e[1]*o),e[0]*o+.5*e[1]*Math.log(r[0]*r[0]+r[1]*r[1]));return[n*Math.cos(s),n*Math.sin(s)]}return safepow(r,e)}},"!":{precedence:20,assoc:"right"},"~":{precedence:16,assoc:"left"},not:{precedence:16,assoc:"right"},"&&":{precedence:8,assoc:"left",evalfunc:function(t,r){return t&&r}},"||":{precedence:7,assoc:"left",evalfunc:function(t,r){return t||r}},"#a":{precedence:8,assoc:"right",evalfunc:function(t,r){return t&&r}},"#x":{precedence:7,assoc:"right",evalfunc:function(t,r){return!!(t^r)}},"#o":{precedence:7,assoc:"right",evalfunc:function(t,r){return t||r}},"#m":{precedence:7,assoc:"right",evalfunc:function(t,r){return t&&!r}},"#i":{precedence:6,assoc:"right",evalfunc:function(t,r){return!t||r}},"#b":{precedence:6,assoc:"right",evalfunc:function(t,r){return t&&r||!t&&!r}},"<":{precedence:6,assoc:"left",evalfunc:function(t,r){return t<r?1:0}},">":{precedence:6,assoc:"left",evalfunc:function(t,r){return t>r?1:0}},"<=":{precedence:6,assoc:"left",evalfunc:function(t,r){return t<=r?1:0}},">=":{precedence:6,assoc:"left",evalfunc:function(t,r){return t>=r?1:0}},"(":!0,")":!0}},MathParser.prototype.parse=function(t){return this.origstr=t,t=(t=(t=t.replace(/(ar|arg)(sinh|cosh|tanh|sech|csch|coth)/g,"arc$2")).replace(/[\\[\]`]/g,"").replace(/[\[\]]/g,"()")).replace(/(?<!\|)\|([^|]+?)\|(?!\|)/g,"abs($1)"),this.tokenize(t),this.handleImplicit(),this.buildTree(),this.AST},MathParser.prototype.evaluate=function(t){void 0===t&&(t={});for(var r=0;r<this.variables.length;r++){var e=this.variables[r];if(!("pi"===e||"e"===e||this.docomplex&&"i"===e)){if(!(e in t))throw new Error("Missing value for variable "+e);if("number"!=typeof t[e])throw new Error("Invalid input value for variable "+e)}}if(this.variableValues=t,0===this.AST.length)return"";let n=this.evalNode(this.AST);return this.docomplex&&!Array.isArray(n)&&(n=[n,0]),n},MathParser.prototype.evaluateQuiet=function(t){try{return this.evaluate(t)}catch(t){return Math.sqrt(-1)}},MathParser.prototype.tokenize=function(t){var r=[],e=(t=t.replace(this.funcregex,(function(t){return t.toLowerCase()}))).length;let n="";for(let h=0;h<e;h++){var a=t[h];if(!/\s/.test(a))if(/[\d.]/.test(a)){let e;if(e=this.allowEscinot?/^(\d*\.?\d*(E[+-]?\d+(?!\.))?)/:/^(\d*\.?\d*)/,"."===(o=t.substr(h).match(e))[1])continue;r.push({type:"number",symbol:parseFloat(o[1])}),n="number",h+=o[1].length-1}else if(-1!==["|","&","#","<",">"].indexOf(a)&&this.operators[t.substr(h,2)])r.push({type:"operator",symbol:t.substr(h,2)}),h++,n="operator";else if(this.operators[a])r.push({type:"operator",symbol:a}),n="operator";else{var o;if(!(o=t.substr(h).match(this.regex)))throw new Error("Don't know how to handle symbol: "+a);var s=o[1];if(-1!==this.funcvariables.indexOf(s)&&h+s.length<t.length&&"("===t[h+s.length]?(r.push({type:"function",symbol:"funcvar",input:null,index:{type:"variable",symbol:s}}),n="function"):-1!==this.variables.indexOf(s)?(r.push({type:"variable",symbol:s}),n="variable"):"div"===s?(r.push({type:"operator",symbol:"/"}),n="operator"):("log"===s?r.push({type:"function",symbol:"log",input:null,index:{type:"number",symbol:10}}):"ln"===s?r.push({type:"function",symbol:"log",input:null,index:{type:"number",symbol:Math.E}}):"degree"===s||"degrees"===s?r.push({type:"number",symbol:Math.PI/180}):r.push({type:"function",symbol:s,input:null}),n="function"),h+=s.length-1,"function"===n&&h<e-2){var c=t[h+1];if("log"===s&&"_"===c)(i=t.substr(h+2).match(this.numvarregex))?(r[r.length-1].index={type:isNaN(i[1])?"variable":"number",symbol:i[1]},h+=i[1].length+1):"("===t[h+2]&&(r[r.length-1].symbol+="_",h+=1);else if("^"===c){(i=t.substr(h+2).match(/^(-?\d+|\((-?\d+)\))/))&&(r[r.length-1].symbol+="^"+(i[2]||i[1]),h+=i[1].length+1)}else if("root"===s)if("("===c)r[r.length-1].symbol+="(";else{var i;if(!(i=t.substr(h+1).match(/^[\(\[]*(-?\d+)[\)\]]*/)))throw new Error("Invalid root index");r[r.length-1]={type:"function",symbol:"nthroot",input:null,index:{type:"number",symbol:parseInt(i[1])}},h+=i[0].length}}}}return this.tokens=r,r},MathParser.prototype.handleImplicit=function(){var t=[];let r={type:"",symbol:""};for(var e=0;e<this.tokens.length;e++){var n=this.tokens[e];"number"!==r.type&&"variable"!==r.type&&"!"!==r.symbol&&")"!==r.symbol||"number"!==n.type&&"variable"!==n.type&&"function"!==n.type&&"("!==n.symbol?"function"===r.type&&"("!==n.symbol?(t.push({type:"operator",symbol:"("}),t.push(n),t.push({type:"operator",symbol:")"})):t.push(n):(t.push({type:"operator",symbol:"*"}),t.push(n)),r=n}this.tokens=t},MathParser.prototype.buildTree=function(){this.operatorStack=[],this.operandStack=[];let t=null;for(let i=0;i<this.tokens.length;i++){var r=this.tokens[i];if(")"===r.symbol)this.handleSubExpression(i);else if("number"===r.type||"variable"===r.type)this.operandStack.push(r);else if("function"===r.type)this.operatorStack.push(r);else if("("===r.symbol)this.operatorStack.push(r);else if("!"===r.symbol){if(this.isUnary(r,t))r.symbol="not",this.operatorStack.push(r),i+1<this.tokens.length&&"*"===this.tokens[i+1].symbol&&this.tokens.splice(i+1,1);else{if(0===this.operandStack.length)throw new Error("Syntax error: ! without something to apply it to");var e=this.operandStack.pop();this.operandStack.push({type:"function",symbol:"factorial",input:e})}}else if("operator"===r.type){if(this.isUnary(r,t))"+"===r.symbol?(r.type="",r.symbol=""):"-"===r.symbol&&(r.symbol="~");else for(;this.operatorStack.length>0;){var n=this.operatorStack[this.operatorStack.length-1],a=this.operators[n.symbol],o=this.operators[r.symbol];if("boolean"==typeof a||"boolean"==typeof o)break;if(!(o.precedence<a.precedence||o.precedence===a.precedence&&"left"===o.assoc))break;var s=this.operatorStack.pop(),c=this.handleExpression(s);this.operandStack.push(c)}""!==r.symbol&&this.operatorStack.push(r)}""!==r.symbol&&(t=r)}for(;this.operatorStack.length>0;){s=this.operatorStack.pop(),c=this.handleExpression(s);this.operandStack.push(c)}if(this.operandStack.length>1)throw new Error("Syntax error - expression didn't terminate");this.AST=this.operandStack.pop()},MathParser.prototype.isUnary=function(t,r){return-1!==["-","+","!"].indexOf(t.symbol)&&(0===this.operandStack.length&&0===this.operatorStack.length||"operator"===r.type&&")"!==r.symbol&&"!"!==r.symbol)},MathParser.prototype.handleExpression=function(t){if("function"===t.type||"("===t.symbol)throw new Error("Syntax error - parentheses mismatch");if("~"===t.symbol||"not"===t.symbol){if(void 0===(r=this.operandStack.pop()))throw new Error("Syntax error - unary negative with nothing following");return t.left=r,t}var r,e=this.operandStack.pop();if(void 0===(r=this.operandStack.pop())||void 0===e)throw new Error("Syntax error");return t.left=r,t.right=e,t},MathParser.prototype.handleSubExpression=function(t){let r,e=!1;for(;r=this.operatorStack.pop();){if("("===r.symbol){e=!0;break}var n=this.handleExpression(r);this.operandStack.push(n)}if(!e)throw new Error("Syntax error - parentheses mismatch");if(this.operatorStack.length>0&&"function"===this.operatorStack[this.operatorStack.length-1].type){n=this.operatorStack.pop();var a=this.operandStack.pop();if("log_"===n.symbol){if(void 0===a)throw new Error("Syntax error - missing index");return n.symbol="log",n.index=a,this.operatorStack.push(n),void(t+1<this.tokens.length&&"*"===this.tokens[t+1].symbol&&this.tokens.splice(t+1,1))}if("root("===n.symbol){if(void 0===a)throw new Error("Syntax error - missing index");return n.symbol="nthroot",n.index=a,this.operatorStack.push(n),void(t+1<this.tokens.length&&"*"===this.tokens[t+1].symbol&&this.tokens.splice(t+1,1))}if(void 0===a)throw new Error("Syntax error - missing function input");if(n.input=a,-1!==n.symbol.indexOf("^")){var o=n.symbol.split("^"),s=o[0],c=o[1];if("-1"!==c||!window["a"+s]&&!Math["a"+s]){n.symbol=s;var i={type:"operator",symbol:"^",left:n,right:{type:"number",symbol:parseInt(c)}};return void this.operandStack.push(i)}n.symbol="arc"+s}this.operandStack.push(n)}},MathParser.prototype.evalNode=function(t){if(!t)throw new Error("Cannot evaluate an empty expression");if("number"===t.type)return this.docomplex?Array.isArray(t.symbol)?[parseFloat(t.symbol[0]),parseFloat(t.symbol[1])]:[parseFloat(t.symbol),0]:parseFloat(t.symbol);if("variable"===t.type){if(t.symbol in this.variableValues)return this.docomplex&&"number"==typeof this.variableValues[t.symbol]?[parseFloat(this.variableValues[t.symbol]),0]:this.variableValues[t.symbol];if("pi"===t.symbol)return this.docomplex?[Math.PI,0]:Math.PI;if("e"===t.symbol)return this.docomplex?[Math.E,0]:Math.E;if(this.docomplex&&"i"===t.symbol)return[0,1];throw new Error("Variable found without a provided value")}if("function"===t.type){var r=this.evalNode(t.input);let n;t.index&&(n=this.evalNode(t.index));let a=t.symbol;if(!this.docomplex)switch(a){case"sqrt":if(r<0)throw new Error("Invalid input to "+a);break;case"log":if(r<=0)throw new Error("Invalid input to "+a);if(n<=0)throw new Error("Invalid base to "+a);break;case"arcsin":case"arccos":var e=Math.round(1e12*r)/1e12;if(e<-1||e>1)throw new Error("Invalid input to "+a);break;case"factorial":if(Math.round(r)!==Math.floor(r)||r<0)throw new Error("invalid factorial input "+r);if(r>150)throw new Error("too big of factorial input "+r)}return a=a.replace("arc","a"),this.docomplex&&(a="cplx_"+a,Array.isArray(r)||(r=[r,0])),t.index?this.callFunction(a,r,n):this.callFunction(a,r)}if("~"===t.symbol){if(this.docomplex){var n=this.evalNode(t.left);return Array.isArray(n)?[-1*n[0],-1*n[1]]:-1*n}return-1*this.evalNode(t.left)}if("not"===t.symbol)return!this.evalNode(t.left);if(this.operators[t.symbol])return(0,this.operators[t.symbol].evalfunc)(this.evalNode(t.left),this.evalNode(t.right));throw new Error("Syntax error")},MathParser.prototype.callFunction=function(t){var r=null;if(-1!==["sqrt","sin","cos","tan","asin","acos","atan","sinh","cosh","tanh","asinh","acosh","atanh","exp","abs","sign"].indexOf(t)?r=Math[t]:-1!==["factorial","nthroot","sec","csc","cot","asec","acsc","acot","sech","csch","coth","asech","acsch","acoth","funcvar","cplx_sqrt","cplx_sin","cplx_cos","cplx_tan","cplx_log","cplx_exp","cplx_abs","cplx_asin","cplx_acos","cplx_atan","cplx_sinh","cplx_cosh","cplx_tanh","cplx_asinh","cplx_acosh","cplx_atanh","cplx_sec","cplx_csc","cplx_cot","cplx_sech","cplx_csch","cplx_coth","cplx_asec","cplx_acsc","cplx_acot","cplx_asech","cplx_acsch","cplx_acoth","cplx_nthroot","cplx_factorial","cplx_funcvar"].indexOf(t)?r=window[t]:"log"===t?r=function(t,r){return r=void 0===r?Math.E:r,Math.log(t)/Math.log(r)}:"ln"===t&&(r=Math.log),null!==r){let t=[];return arguments.length>1&&(t=Array.prototype.slice.call(arguments,1)),r.apply(null,t)}throw new Error("Unknown function: "+t)},MathParser.prototype.isMultiple=function(t,r){if(0===r)return!1;var e=Math.abs(t)/Math.abs(r);return Math.abs(Math.floor(e+1e-10)-e)<1e-8},Math.sinh||(Math.sinh=function(t){return(Math.exp(t)-Math.exp(-t))/2}),Math.cosh||(Math.cosh=function(t){return(Math.exp(t)+Math.exp(-t))/2}),Math.tanh||(Math.tanh=function(t){if(t===1/0)return 1;if(t===-1/0)return-1;var r=Math.exp(t),e=Math.exp(-t);return(r-e)/(r+e)}),Math.asinh||(Math.asinh=function(t){return Math.log(t+Math.sqrt(t*t+1))}),Math.acosh||(Math.acosh=function(t){return t<1?NaN:Math.log(t+Math.sqrt(t*t-1))}),Math.atanh||(Math.atanh=function(t){return t<=-1||t>=1?NaN:.5*Math.log((1+t)/(1-t))});var pi=Math.PI,ln=Math.log,e=Math.E,arcsin=Math.asin,arccos=Math.acos,arctan=Math.atan,funcstoindexarr="sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root|arcsin|arccos|arctan|arcsec|arccsc|arccot|arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|argsinh|argcosh|argtanh|argsech|argcsch|argcoth|arsinh|arcosh|artanh|arsech|arcsch|arcoth|pi".split("|");function functoindex(t){for(var r=0;r<funcstoindexarr.length;r++)if(funcstoindexarr[r]==t)return"@"+r+"@";return t}function indextofunc(t,r){return funcstoindexarr[r]}function matchtolower(t){return t.toLowerCase()}function mathjs(t){var r,e,n,a,o,s;for(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/(\+\s*-|-\s*\+)/g,"-").replace(/-\s*-/g,"+")).replace(/\[/g,"(").replace(/\]/g,")")).replace(/\b00+\./g,"0.")).replace(/root\s*(\d+)/,"root($1)")).replace(/\|(.*?)\|/g,"abs($1)")).replace(/(Sin|Cos|Tan|Sec|Csc|Cot|Arc|Abs|Log|Exp|Ln|Sqrt)/gi,matchtolower)).replace(/pi/g,"(pi)")).replace(/([0-9])E([\-0-9])/g,"$1(EE)$2")).replace(/\*?\s*degrees?/g,"*((pi)/180)")).replace(/div/,"/")).replace(/e/g,"(E)")).replace(/log_([a-zA-Z\d\.]+|\(([a-zA-Z\/\d\.]+)\))\s*\(/g,"nthlog($1,")).replace(/log/g,"logten")).replace(/(sin|cos|tan|sec|csc|cot|sinh|cosh|tanh|sech|csch|coth)\^(-1|\(-1\))/g,"arc$1")).replace(/(sin|cos|tan|sec|csc|cot|ln)\^(\d+|\(\d+\))\s*\(/g,"$1n($2,")).replace(/root\s*\(([a-zA-Z\/\d\.]+)\)\s*\(/g,"nthroot(($1),")).replace(/([0-9]\.?)\s+([0-9])/g,"$1*$2")).replace(/#/g,"")).replace(/\s/g,"")).replace(/([0-9]\.?)([\(a-zA-Z])/g,"$1*$2")).replace(/(!)([0-9\(a-zA-Z])/g,"$1*$2")).replace(/\)([\(0-9a-zA-Z]|\.\d+)/g,")*$1")).replace(/([0-9])\*\(EE\)\*?([\-0-9])/g,"$1e$2");-1!=(r=t.lastIndexOf("^"));){if(0==r)return"Error: missing argument";if(e=r-1,(a=t.charAt(e))>="0"&&a<="9"||"."==a){for(e--;e>=0&&(a=t.charAt(e))>="0"&&a<="9";)e--;if("."==a)for(e--;e>=0&&(a=t.charAt(e))>="0"&&a<="9";)e--}else if(")"==a){for(s=1,e--;e>=0&&s>0;)"("==(a=t.charAt(e))?s--:")"==a&&s++,e--;for(;e>=0&&((a=t.charAt(e))>="a"&&a<="z"||a>="A"&&a<="Z");)e--}else{if(!(a>="a"&&a<="z"||a>="A"&&a<="Z"))return"Error: incorrect syntax in "+t+" at position "+e;for(e--;e>=0&&((a=t.charAt(e))>="a"&&a<="z"||a>="A"&&a<="Z");)e--}if(r==t.length-1)return"Error: missing argument";if(n=r+1,a=t.charAt(n),o=t.charAt(n+1),a>="0"&&a<="9"||"-"==a&&"("!=o||"."==a){for(n++;n<t.length&&(a=t.charAt(n))>="0"&&a<="9";)n++;if("."==a)for(n++;n<t.length&&(a=t.charAt(n))>="0"&&a<="9";)n++}else if("("==a||"-"==a&&"("==o)for("-"==a&&n++,s=1,n++;n<t.length&&s>0;)"("==(a=t.charAt(n))?s++:")"==a&&s--,n++;else{if(!(a>="a"&&a<="z"||a>="A"&&a<="Z"))return"Error: incorrect syntax in "+t+" at position "+n;for(n++;n<t.length&&((a=t.charAt(n))>="a"&&a<="z"||a>="A"&&a<="Z");)n++;if("("==a&&t.slice(r+1,n).match(/^(sinn|cosn|tann|secn|cscn|cotn|sin|cos|tan|sec|csc|cot|logten|nthlogten|log|ln|exp|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|sqrt|abs|nthroot|factorial|safepow)$/))for(s=1,n++;n<t.length&&s>0;)"("==(a=t.charAt(n))?s++:")"==a&&s--,n++}t=t.slice(0,e+1)+"safepow("+t.slice(e+1,r)+","+t.slice(r+1,n)+")"+t.slice(n)}return t}
function updateeeddpos(){}function updateehpos(){}var onlyAscii=/^[\u0000-\u007f]*$/,LivePreviews=[];function setupLivePreview(e){LivePreviews.hasOwnProperty(e)||("MathJax"==mathRenderer||"Katex"==mathRenderer?(LivePreviews[e]={delay:"MathJax"==mathRenderer?100:0,finaldelay:1e3,preview:null,buffer:null,timeout:null,finaltimeout:null,mjRunning:!1,mjPending:!1,oldText:null,Init:function(){$("#p"+e).css("positive","relative").append('<span id="lpbuf1'+e+'" style="visibility:hidden;position:absolute;"></span>').append('<span id="lpbuf2'+e+'" style="visibility:hidden;position:absolute;"></span>'),this.preview=document.getElementById("lpbuf1"+e),this.buffer=document.getElementById("lpbuf2"+e)},SwapBuffers:function(){var e=this.preview,t=this.buffer;this.buffer=e,this.preview=t,e.style.visibility="hidden",e.style.position="absolute",t.style.position="",t.style.visibility=""},Update:function(e){this.timeout&&clearTimeout(this.timeout),this.finaltimeout&&clearTimeout(this.finaltimeout),this.timeout=setTimeout(this.callback,this.delay),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(e){this.oldtext=e,this.buffer.innerHTML=this.preformat(e),this.mjRunning=!0,this.RenderBuffer()},RenderBuffer:function(){"MathJax"==mathRenderer?MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.buffer],["PreviewDone",this]):"Katex"==mathRenderer&&(renderMathInElement(this.buffer),"undefined"!=typeof MathJax&&MathJax.version&&$(this.buffer).children(".mj").length>0?MathJax.Hub.Queue(["PreviewDone",this]):this.PreviewDone())},DoFinalPreview:function(){$("#pbtn"+e).trigger("click")},preformat:function(t){if(t=normalizemathunicode(t),intcalctoproc.hasOwnProperty(e))calcformat[e].match(/inequality/)?(t=t.replace(/<=/g," le ").replace(/>=/g," ge ").replace(/</g," lt ").replace(/>/g," gt ")).match(/all\s*real/i)&&(t="text("+t+")"):t=t.replace(/U/g,"uu");else if(vlist.hasOwnProperty(e))t=AMnumfuncPrepVar(e,t)[1];else if(ntupletoproc.hasOwnProperty(e))t=t.replace(/</g,"(:").replace(/>/g,":)");else if(calcformat.hasOwnProperty(e)){var a=calcformat[e];-1==a.indexOf("list")&&-1==a.indexOf("set")&&(t=t.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")),-1!=a.indexOf("scinot")&&(t=t.replace(/(x|X|\u00D7)/,"xx"))}return t=t.replace(/[^\u0000-\u007f]/g,"?")},CreatePreview:function(){if(this.timeout=null,!this.mjPending){if(null==document.getElementById("tc"+e))var t=document.getElementById("qn"+e).value;else t=document.getElementById("tc"+e).value;t!==this.oldtext&&(this.mjRunning?(this.mjPending=!0,MathJax.Hub.Queue(["CreatePreview",this])):(this.oldtext=t,this.buffer.innerHTML="`"+htmlEntities(this.preformat(t))+"`",this.mjRunning=!0,this.RenderBuffer()))}},PreviewDone:function(){this.mjRunning=this.mjPending=!1,this.SwapBuffers(),updateeeddpos(),updateehpos()}},"MathJax"==mathRenderer?(LivePreviews[e].callback=MathJax.Callback(["CreatePreview",LivePreviews[e]]),LivePreviews[e].callback.autoReset=!0):LivePreviews[e].callback=function(){LivePreviews[e].CreatePreview()},LivePreviews[e].Init()):LivePreviews[e]={finaldelay:1e3,finaltimeout:null,Update:function(e){this.finaltimeout&&clearTimeout(this.finaltimeout),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(t){var a=document.getElementById("p"+e);a.innerHTML=htmlEntities(t),rendermathnode(a)},DoFinalPreview:function(){$("#pbtn"+e).trigger("click")}})}function updateLivePreview(e){var t=e.id.substr(2);setupLivePreview(t),LivePreviews[t].Update()}function htmlEntities(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function normalizemathunicode(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/[\x00-\x09\x0B\x0C\x0E-\x1F\x7F]/g,"")).replace(/\u2013|\u2014|\u2015|\u2212/g,"-")).replace(/\u2044|\u2215/g,"/")).replace(//g,"oo").replace(//g,"<=").replace(//g,">=").replace(//g,"U")).replace(//g,"+-").replace(//g,"/").replace(/|||/g,"*")).replace(//g,"sqrt").replace(//g,"root(3)")).replace(//g,"^2").replace(//g,"^3")).replace(/\u2329/g,"<").replace(/\u232a/g,">")).replace(//g,"_0").replace(//g,"_1").replace(//g,"_2").replace(//g,"_3")).replace(/\b(OO|infty)\b/i,"oo")).replace(//,"theta").replace(//,"phi").replace(//,"phi").replace(//,"pi").replace(//,"sigma").replace(//,"mu")).replace(//,"alpha").replace(//,"beta").replace(//,"gamma").replace(//,"delta").replace(//,"epsilon").replace(//,"kappa")).replace(//,"lambda").replace(//,"rho").replace(//,"tau").replace(//,"chi").replace(//,"omega")).replace(//,"Omega").replace(//,"Gamma").replace(//,"Phi").replace(//,"Delta").replace(//,"Sigma")}function wrapAMnotice(e){return'<span class="AMHnotice">'+e+"</span>"}function calculate(e,t,a){var i=document.getElementById(e).value;if(i=(i=normalizemathunicode(i)).replace(/=/,""),-1!=a.indexOf("list"))var s=i.split(/,/);else if(-1!=a.indexOf("set"))s=i.replace(/[\{\}]/g,"").split(/,/);else{(s=new Array)[0]=i}for(var r=0;r<s.length;r++){str=s[r],str=str.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1");var n="";if(str.match(/DNE/i))str=str.toUpperCase();else if(str.match(/oo$/)||str.match(/oo\W/))str="`"+str+"`";else{n+=singlevalsyntaxcheck(str,a),str.match(/,/)&&(n+=_("Invalid use of a comma.")),-1!=a.indexOf("allowxtimes")&&(str=str.replace(/(x|X|\u00D7)/,"*")),-1!=a.indexOf("mixed")?str=str.replace(/_/g," "):-1!=a.indexOf("scinot")?str=str.replace(/(x|X|\u00D7)/,"xx"):str=str.replace(/^\s+/,"").replace(/\s+$/,""),n+=syntaxcheckexpr(str,a);try{var l=str;(l=l.replace(",","*NaN*")).match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(l=l.replace(/%/,"")+"/100"),-1!=a.indexOf("mixed")&&(l=l.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),-1!=a.indexOf("scinot")&&(l=l.replace("xx","*"));var c=scopedmatheval(l)}catch(e){n=_("syntax incomplete")+". "+n,c=NaN}str=str.replace(/[^\u0000-\u007f]/g,"?"),str=htmlEntities(str),isNaN(c)||"Infinity"==c||""===c?""!=str&&(str="`"+str+"` = "+_("undefined")+". "+wrapAMnotice(n)):-1==a.indexOf("showval")?str="`"+str+"` "+wrapAMnotice(n):str="`"+str+" =` "+(Math.abs(c)<1e-15?0:c)+". "+wrapAMnotice(n)}s[r]=str+" "}i=s.join(", "),-1!=a.indexOf("set")&&(document.getElementById(e).value.match(/^\s*{.*?}\s*$/)?i="{"+i+"}":i+=wrapAMnotice(_("syntax error: this answer must be in set notation, a list wrapped in braces like {1,2,3}")));var o=t.substr(1);setupLivePreview(o),LivePreviews[o].RenderNow(i)}function ineqtointerval(e){var t=(e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1")).split(/or/);for(i=0;i<t.length;i++){str=t[i];var a="";(pat=str.match(/^([^<]+)\s*(<=?)\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*(<=?)([^<]+)$/))?("<="==pat[2]?a+="[":a+="(",a+=pat[1]+","+pat[5],"<="==pat[4]?a+="]":a+=")"):(pat=str.match(/^([^>]+)\s*(>=?)\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*(>=?)([^>]+)$/))?(">="==pat[4]?a+="[":a+="(",a+=pat[5]+","+pat[1],">="==pat[2]?a+="]":a+=")"):(pat=str.match(/^([^><]+)\s*([><]=?)\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*$/))?">"==pat[2]?a="(-oo,"+pat[1]+")":">="==pat[2]?a="(-oo,"+pat[1]+"]":"<"==pat[2]?a="("+pat[1]+",oo)":"<="==pat[2]&&(a="["+pat[1]+",oo)"):(pat=str.match(/^\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*([><]=?)\s*([^><]+)$/))?"<"==pat[2]?a="(-oo,"+pat[3]+")":"<="==pat[2]?a="(-oo,"+pat[3]+"]":">"==pat[2]?a="("+pat[3]+",oo)":">="==pat[2]&&(a="["+pat[3]+",oo)"):a=str.match(/all\s*real/i)?"(-oo,oo)":"",t[i]=a}return a=t.join("U")}function intcalculate(e,t,a){var s=document.getElementById(e).value;if((s=normalizemathunicode(s=-1!=a.indexOf("mixed")?s.replace(/_/g," ").replace(/^\s+/,"").replace(/\s+$/,""):s.replace(/^\s+/,"").replace(/\s+$/,""))).match(/DNE/i))s=s.toUpperCase();else if(""==s.replace(/\s+/g,""))s=_("no answer given");else{var r=new Array,n=new Array;if(-1!=a.indexOf("inequality")){var l=s=s.replace(/or/g," or ");s=ineqtointerval(s);var c=str.match(/\b([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+\b)/),o=str.match(/([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)/),d=null!=c?c[1]:null!=o?o[1]:""}else l=s;if(-1!=a.indexOf("list")){for(var u=0,p=[],m=1;m<s.length-1;m++)","==s.charAt(m)&&(")"!=s.charAt(m-1)&&"]"!=s.charAt(m-1)||"("!=s.charAt(m+1)&&"["!=s.charAt(m+1)||(p.push(s.substring(u,m)),u=m+1));p.push(s.substring(u))}else p=s.split(/\s*U\s*/i);var h=!0,f="";for(i=0;i<p.length;i++){if(str=p[i],sm=str.charAt(0),em=str.charAt(str.length-1),vals=str.substring(1,str.length-1),vals=vals.split(/,/),2!=vals.length||"("!=sm&&"["!=sm||")"!=em&&"]"!=em){l=htmlEntities(l),s=-1!=a.indexOf("inequality")?"`"+(l=l.replace("<=","le").replace(">=","ge").replace("<","lt").replace(">","gt"))+"`: "+wrapAMnotice(_("invalid inequality notation")):"`"+l.replace(/U/g,"uu")+"`: "+wrapAMnotice(_("invalid interval notation")),h=!1;break}for(j=0;j<2;j++)if(vals[j].match(/oo$/)||vals[j].match(/oo\W/))r[j]=vals[j];else{var g="";if(v=NaN,g+=singlevalsyntaxcheck(vals[j],a),-1!=a.indexOf("mixed")?vals[j]=vals[j].replace(/_/g," ").replace(/^\s+/,"").replace(/\s+$/,""):vals[j]=vals[j].replace(/^\s+/,"").replace(/\s+$/,""),""==(g+=syntaxcheckexpr(vals[j],a)))try{toeval=vals[j],-1!=a.indexOf("mixed")&&(toeval=toeval.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)"));var v=scopedmatheval(toeval)}catch(e){g=_("syntax incomplete")+". "}isNaN(v)||"Infinity"==v||""===v?r[j]=_("undefined"):(vals[j]=vals[j],r[j]=(Math.abs(v)<1e-15?0:v).toString()),""!=g&&(f+=g)}p[i]=sm+vals[0]+","+vals[1]+em,-1!=a.indexOf("inequality")?(r[0].match(/oo/)?r[1].match(/oo/)?n[i]="RR":n[i]=d+("]"==em?"le":"lt")+r[1]:r[1].match(/oo/)?n[i]=d+("["==sm?"ge":"gt")+r[0]:n[i]=r[0]+("["==sm?"le":"lt")+d+("]"==em?"le":"lt")+r[1],n[i]=n[i].replace("undefined",'"undefined"')):n[i]=sm+r[0]+","+r[1]+em}h&&(-1!=a.indexOf("inequality")?l.match(/all\s*real/)?s=l:(l=(l=(l=(l=(l=l.replace(/or/g,' \\ "or" \\ ')).replace(/<=/g,"le")).replace(/>=/g,"ge")).replace(/</g,"lt")).replace(/>/g,"gt"),s=-1==a.indexOf("showval")?"`"+l+"`. "+wrapAMnotice(f):"`"+l+"= "+n.join(' \\ "or" \\ ')+"`. "+wrapAMnotice(f)):s=-1==a.indexOf("showval")?"`"+htmlEntities(p.join("uu"))+"`. "+wrapAMnotice(f):-1!=a.indexOf("list")?"`"+htmlEntities(p.join(","))+"` = "+n.join(" , ")+". "+wrapAMnotice(f):"`"+htmlEntities(p.join("uu"))+"` = "+n.join(" U ")+". "+wrapAMnotice(f))}s=s.replace(/[^\u0000-\u007f]/g,"?");var y=t.substr(1);setupLivePreview(y),LivePreviews[y].RenderNow(s)}function ntuplecalc(e,t,a){var i=document.getElementById(e).value;if(i=(i=normalizemathunicode(i)).replace(/\(:|<</g,"<").replace(/:\)|>>/g,">"),(i=-1!=a.indexOf("mixed")?i.replace(/_/g," ").replace(/^\s+/,"").replace(/\s+$/,""):i.replace(/^\s+/,"").replace(/\s+$/,"")).match(/DNE/i))i=i.toUpperCase(),s="DNE",outstr="DNE";else if(i.match(/^\s*oo\s*$/i))i=i.toLowerCase(),s="oo",outstr="`oo`";else{var s="",r=0,n=0,l="",c=!0,o=NaN;i.charAt(0).match(/[\(\[\<\{]/)||(c=!1);for(var d=0;d<i.length;d++)if(dec=!1,0==r&&(s+=i.charAt(d),n=d+1,","==i.charAt(d)&&(i.substring(d+1).match(/^\s*[\(\[\<\{]/)&&i.substring(0,d).match(/[\)\]\>\}]\s*$/)||(c=!1))),i.charAt(d).match(/[\(\[\<\{]/)?r++:i.charAt(d).match(/[\)\]\>\}]/)&&(r--,dec=!0),0==r&&dec||1==r&&","==i.charAt(d)){if(sub=i.substring(n,d),o=NaN,"oo"==sub||"-oo"==sub)s+=sub;else{l+=singlevalsyntaxcheck(sub,a),l+=syntaxcheckexpr(sub,a);try{-1!=a.indexOf("mixed")&&(sub=sub.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),o=scopedmatheval(sub)}catch(e){l+=_("syntax incomplete")+". "}isNaN(o)||"Infinity"==o||""===o?s+=_("undefined"):s+=o}s+=i.charAt(d),n=d+1}0!=r&&(c=!1),0==c&&(l+=_("Invalid notation")+". "),i=(i=i.replace(/[^\u0000-\u007f]/g,"?")).replace(/</g,"(:").replace(/>/g,":)"),-1==a.indexOf("showval")||0==c?outstr="`"+htmlEntities(i)+"`. "+wrapAMnotice(l):outstr="`"+htmlEntities(i)+"` = "+s+". "+wrapAMnotice(l)}if(null!=t){var u=t.substr(1);setupLivePreview(u),LivePreviews[u].RenderNow(outstr)}return s}function complexcalc(e,t,a){var i,s,r,n=document.getElementById(e).value;if(n=normalizemathunicode(n),(n=-1!=a.indexOf("mixed")?n.replace(/_/g," ").replace(/^\s+/,"").replace(/\s+$/,""):n.replace(/^\s+/,"").replace(/\s+$/,"")).match(/DNE/i))n=n.toUpperCase(),i="DNE",s="DNE";else{i="",r="";for(var l=n.split(","),c=0;c<l.length;c++){var o=l[c];if(-1!=a.indexOf("mixed")&&(o=o.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),-1==a.indexOf("sloppycomplex")){var d=parsecomplex(l[c]);"string"==typeof d?r+=d:(r+=singlevalsyntaxcheck(d[0],a),r+=singlevalsyntaxcheck(d[1],a))}var u=NaN,p=NaN;if(""==(r+=syntaxcheckexpr(l[c],a)))try{var m=evalMathParser(o,!0);isNaN(m)?(r+=_("syntax incomplete"),u=NaN):(u=m[0],p=m[1])}catch(e){r+=_("syntax incomplete")}if("synerr"!=u&&"synerr"!=p||(r+=_("syntax incomplete"),u=NaN),isNaN(u)||"Infinity"==u||isNaN(p)){i+=_("undefined");break}0!=c&&(i+=","),i+=u+(p>=0?"+":"")+p+"i"}n=n.replace(/[^\u0000-\u007f]/g,"?"),s=-1==a.indexOf("showval")?"`"+htmlEntities(n)+"`. "+wrapAMnotice(r):"`"+htmlEntities(n)+"` = "+i+". "+wrapAMnotice(r)}if(null!=t){var h=t.substr(1);setupLivePreview(h),LivePreviews[h].RenderNow(s)}return i}function parsecomplex(e){var t,a,i,s,r,n,l,c=(e=(e=(e=(e=e.replace(/\s/,"")).replace(/\((\d+\*?i|i)\)\/(\d+)/g,"$1/$2")).replace(/sin/,"s$n")).replace(/pi/,"p$")).length;if(e.split("i").length>2)return _("error - more than 1 i in expression");if(-1==(r=e.indexOf("i")))t=e,a="0";else{for(s=0,l=r-1;l>0;l--)if(")"==(i=e.charAt(l)))s++;else if("("==i)s--;else if(("+"==i||"-"==i)&&0==s)break;if(l<0&&(l=0),0!=s)return _("error - invalid form");for(s=0,n=r+1;n<c;n++)if("("==(i=e.charAt(n)))s++;else if(")"==i)s--;else if(("+"==i||"-"==i)&&0==s)break;if(0!=s)return _("error - invalid form");if(r-l>0&&n-r>0&&(n==c||0==l)){if(n==c)t=e.substr(0,l),a=e.substr(l,r-l);else{if(0!=l)return _("error - invalid form");t=e.substr(n),a=e.substr(0,r)}a=(a=(a+="*"+e.substr(r+1+("*"==e.charAt(r+1)?1:0),n-r-1)).replace("-*","-1*").replace("+*","+1*")).replace(/(\+|-)1\*(.+)/g,"$1$2")}else if(r-l>1)a=e.substr(l,r-l),t=e.substr(0,l)+e.substr(r+1);else if(n-r>1)if(r>0){if("+"!=e.charAt(r-1)&&"-"!=e.charAt(r-1))return _("error - invalid form");a=e.charAt(r-1)+e.substr(r+1+("*"==e.charAt(r+1)?1:0),n-r-1),t=e.substr(0,r-1)+e.substr(n)}else a=e.substr(r+1,n-r-1),t=e.substr(0,r)+e.substr(n);else a="+"==e.charAt(l)?"1":"-"==e.charAt(l)?"-1":0==r?"1":e.charAt(l),t=(r>0?e.substr(0,l):"")+e.substr(r+1);""==t&&(t="0"),"/"==a.charAt(0)?a="1"+a:"+"!=a.charAt(0)&&"-"!=a.charAt(0)||"/"!=a.charAt(1)||(a=a.charAt(0)+"1"+a.substr(1)),"*"==a.charAt(a.length-1)&&(a=a.substr(0,a.length-1)),"+"==a.charAt(0)&&(a=a.substr(1)),"+"==t.charAt(0)&&(t=t.substr(1))}return[t=(t=t.replace("s$n","sin")).replace("p$","pi"),a=(a=(a=a.replace("s$n","sin")).replace("p$","pi")).replace(/\*\//g,"/")]}function matrixcalc(e,t,a,i,s){function r(e){var t="";try{var a=scopedmatheval(e)}catch(e){t=_("syntax incomplete")+". "}return isNaN(a)||"Infinity"==a||""===a?""!=e&&(e=t=_("undefined")+". "):e=(Math.abs(a)<1e-15?0:a)+t,[e,t]}var n,l="";if("string"!=typeof s&&(s=""),null!=a&&null!=i){for(var c=0,o="[",d="[",u=0;u<a;u++){u>0&&(o+=",",d+=","),o+="(",d+="(";for(var p=0;p<i;p++)p>0&&(o+=",",d+=","),val=normalizemathunicode(document.getElementById(e+"-"+c).value),o+=val,(n=r(val))[1]+=syntaxcheckexpr(val,s),""==n[1]&&(n[1]+=singlevalsyntaxcheck(val,s)),""==l&&(l=n[1]),d+=n[0],c++;o+=")",d+=")"}o+="]",d+="]"}else{var m=0;d=(d=(d=(d=o=normalizemathunicode(document.getElementById(e).value)).replace("[","(")).replace("]",")")).replace(/\s+/g,"");var h=new Array;d=d.substring(1,d.length-1);for(var f=0,g=0;g<d.length;g++)"("==d.charAt(g)?m++:")"==d.charAt(g)?m--:","==d.charAt(g)&&0==m&&(h[h.length]=d.substring(f+1,g-1),f=g+1);h[h.length]=d.substring(f+1,d.length-1);for(g=0;g<h.length;g++){calclist2=h[g].split(",");for(var v=0;v<calclist2.length;v++)(n=r(calclist2[v]))[1]+=syntaxcheckexpr(calclist2[v],s),""==n[1]&&(n[1]+=singlevalsyntaxcheck(calclist2[v],s)),""==l&&(l=n[1]),calclist2[v]=n[0];h[g]=calclist2.join(",")}d="[("+h.join("),(")+")]"}if(o=o.replace(/[^\u0000-\u007f]/g,"?"),o=-1==s.indexOf("showval")?"`"+htmlEntities(o)+"`. "+l:"`"+htmlEntities(o)+"` = `"+d+"`. "+l,null!=t){var y=document.getElementById(t),x=y.childNodes.length;for(g=0;g<x;g++)y.removeChild(y.firstChild);y.appendChild(document.createTextNode(o)),noMathRender||rendermathnode(y)}return d}function mathjsformat(e,t){var a=document.getElementById(e).value;document.getElementById(t).value=a}function stringqpreview(e,t){var a=document.getElementById(e).value,i=t.substr(1);setupLivePreview(i),LivePreviews[i].RenderNow("`"+htmlEntities(a)+"`")}function AMnumfuncPrepVar(e,t){var a=vlist[e],i=flist[e],s=a.split("|");s.push("DNE"),a.match(/lambda/)&&(t=t.replace(/lamda/,"lambda")),t=normalizemathunicode(t=t.replace(/,/g,"").replace(/^\s+/,"").replace(/\s+$/,""));var r=[],n=t;n=n.replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root)/g,functoindex);for(var l=0;l<s.length;l++)if("varE"==s[l])t=t.replace("E","varE"),n=n.replace("E","varE");else{r[l]=!1;for(var c=0;c<s.length;c++)if(l!=c&&s[c].toLowerCase()==s[l].toLowerCase()&&s[c]!=s[l]){r[l]=!0;break}}t=t.replace(new RegExp("("+a+")","gi"),(function(e,t){for(var a=0;a<s.length;a++)if(s[a]==t||!r[a]&&s[a].toLowerCase()==t.toLowerCase())return"@v"+a+"@"})),t=t.replace(/@v(\d+)@/g,(function(e,t){return s[t]})),n=n.replace(new RegExp("("+a+")","gi"),(function(e,t){for(var a=0;a<s.length;a++)if(s[a]==t||!r[a]&&s[a].toLowerCase()==t.toLowerCase())return"@v"+a+"@"})),n=(n=n.replace(/(@v(\d+)@|\d+(\.\d+)?)!/g,"{:$&:}")).replace(/@v(\d+)@/g,(function(e,t){return s[t]}));var o,d=new Array;for(l=0;l<s.length;l++)if(s[l].length>1){var u=!1;if(-1!=arraysearch(s[l].toLowerCase(),greekletters)&&(u=!0),s[l].match(/^\w+_\w+$/)){o=r[l]?"g":"gi";var p=new RegExp(/^(\w+)_(\w+)$/,o).exec(s[l]),m=new RegExp(p[1]+"_\\("+p[2]+"\\)",o);n=n.replace(m,s[l]),t=t.replace(m,s[l]),p[1].length>1&&-1==arraysearch(p[1].toLowerCase(),greekletters)&&(p[1]='"'+p[1]+'"'),p[2].length>1&&-1==arraysearch(p[2].toLowerCase(),greekletters)&&(p[2]='"'+p[2]+'"'),n=n.replace(new RegExp(p[0],o),p[1]+"_"+p[2]),t=t.replace(new RegExp(p[0],"g"),"repvars"+l),s[l]="repvars"+l}else u||"varE"==s[l]||d.push(s[l])}if(d.length>0){vltq=d.join("|");var h=new RegExp("("+vltq+")","g");n=n.replace(h,'"$1"')}return n=(n=n.replace("varE","E")).replace(/@(\d+)@/g,indextofunc),a.match(/\bf\b/)&&!i.match(/\bf\b/)&&(n=(n=n.replace(/([^a-zA-Z])f\^([\d\.]+)([^\d\.])/g,"$1f^$2{::}$3")).replace(/([^a-zA-Z])f\(/g,"$1f{::}(")),a.match(/\bg\b/)&&!i.match(/\bg\b/)&&(n=(n=n.replace(/([^a-zA-Z])g\^([\d\.]+)([^\d\.])/g,"$1g^$2{::}$3")).replace(/([^a-zA-Z])g\(/g,"$1g{::}(")),[t,n,s.join("|")]}function AMpreview(e,t){var a=AMnumfuncPrepVar(h=e.slice(2),document.getElementById(e).value),i=a[0],s=a[1],r=a[2],n=flist[h];ptlist=pts[h].split(",");var l="",c=0,o=NaN,d=!1;1==iseqn[h]?(i.match(/=/)?i.match(/=/g).length>1&&(d=!0):d=!0,i=i.replace(/(.*)=(.*)/,"$1-($2)")):i.match(/=/)||(d=!0),""!=n&&(reg=new RegExp("("+n+")\\(","g"),i=i.replace(reg,"$1*sin($1+")),vars=r.split("|");var u=makeMathFunction(i,r);if(!1===u)l=_("syntax error");else for(;c<ptlist.length&&(isNaN(o)||"Infinity"==o);){var p={};testvals=ptlist[c].split("~");for(var m=0;m<vars.length;m++)p[vars[m]]=parseFloat(testvals[m])??1;l=_("syntax ok");try{o=u(p)}catch(e){console.log(e),l=_("syntax error")}"synerr"==o&&(l=_("syntax error")),c++}var h,f=syntaxcheckexpr(i,"",r);(isNaN(o)||"Infinity"==o)&&(l=_("syntax error")),""!=f&&(l==_("syntax ok")?l+=". "+_("warning")+": "+f:l+=". "+f),onlyAscii.test(i)||(l+=". "+_("Your answer contains an unrecognized symbol"),s=s.replace(/[^\u0000-\u007f]/g,"?")),1==iseqn[h]&&d?l=_("syntax error: this is not an equation"):void 0!==iseqn[h]||d||(l=_("syntax error: you gave an equation, not an expression")),'"DNE"'!=s&&"oo"!=s||(l=_("syntax ok")),setupLivePreview(h=t.substr(1)),LivePreviews[h].RenderNow("`"+htmlEntities(s)+"` "+wrapAMnotice(l))}function AMmathpreview(e,t){for(var a=document.getElementById(e).value,i=document.getElementById(t),s=i.childNodes.length,r=0;r<s;r++)i.removeChild(i.firstChild);i.appendChild(document.createTextNode("`"+a+"`")),noMathRender||rendermathnode(i)}function singlevalsyntaxcheck(e,t){if(e.match(/DNE/i))return"";if(e.match(/oo$/)||e.match(/oo\W/))return"";if(-1!=t.indexOf("allowmixed")&&e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/))return"";if(-1!=t.indexOf("fracordec")){if(!(e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2").replace(/\s/g,"")).match(/^\-?\(?\d+\s*\/\s*\-?\d+\)?$/)&&!e.match(/^\-?\d+$/)&&!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/))return _(" invalid entry format")+". "}else if(-1!=t.indexOf("fraction")||-1!=t.indexOf("reducedfraction")){if(!(e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2").replace(/\s/g,"")).match(/^\(?\-?\(?\d+\)?\/\(?\d+\)?$/)&&!e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)&&!e.match(/^\s*?\-?\d+\s*$/))return _("not a valid fraction")+". "}else if(-1!=t.indexOf("mixednumber")){if(!(e.match(/^\(?\-?\s*\(?\d+\)?\/\(?\d+\)?$/)||e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)||e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))\s*$/)||e.match(/^\s*\-?\s*\d+\s*$/)))return _("not a valid mixed number")+". ";e=e.replace(/_/," ")}else if(-1!=t.indexOf("scinot")){if(!(e=(e=e.replace(/\s/g,"")).replace(/(x|X|\u00D7)/,"xx")).match(/^\-?[1-9](\.\d*)?(\*|xx)10\^(\(?\-?\d+\)?)$/)){if(-1==t.indexOf("scinotordec"))return _("not valid scientific notation")+". ";if(!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/))return _("not valid decimal or scientific notation")+". "}}else if(-1!=t.indexOf("decimal")&&-1==t.indexOf("nodecimal")){if(!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/))return _(" not a valid integer or decimal number")+". "}else if(!onlyAscii.test(e))return _("Your answer contains an unrecognized symbol")+". ";return""}function syntaxcheckexpr(e,t,a){var i="";-1!=t.indexOf("notrig")&&e.match(/(sin|cos|tan|cot|sec|csc)/i)?i+=_("no trig functions allowed")+". ":-1!=t.indexOf("nodecimal")&&-1!=e.indexOf(".")?i+=_("no decimals allowed")+". ":-1==t.indexOf("mixed")&&e.match(/\-?\s*\d+\s*(_|\s)\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/)&&(i+=_("mixed numbers are not allowed")+". ");for(var s=0,r=0,n=0,l=0;l<e.length;l++)"("==e.charAt(l)?s++:")"==e.charAt(l)?s--:"["==e.charAt(l)?r++:"]"==e.charAt(l)?r--:"|"==e.charAt(l)&&(n=1-n);if(0==s&&0==r||(i+=" ("+_("unmatched parens")+"). "),0!=n&&(i+=" ("+_("unmatched absolute value bars")+"). "),reg=a?new RegExp("(sqrt|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*("+a+"|\\d+)","i"):new RegExp("(sqrt|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*(\\d+)","i"),errstuff=e.match(reg),null!=errstuff&&(i+="["+_("use function notation")+" - "+_("use $1 instead of $2",errstuff[1]+"("+errstuff[2]+")",errstuff[0])+"]. "),a&&(reg=new RegExp("(repvars\\d+|arc|sqrt|root|ln|log|exp|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs|pi|sign|DNE|e|oo|"+a+")","ig"),e.replace(reg,"").match(/[a-zA-Z]/)&&(i+=_(" Check your variables - you might be using an incorrect one")+". ")),(e.match(/\|/g)||[]).length>2)for(var c=/\|.*?\|\s*(.|$)/g;match=c.exec(e);)if(""!=match[1]&&match[1].match(/[^+\-\*\/\^\)]/)){i+=_(" You may want to use abs(x) instead of |x| for absolute values to avoid ambiguity")+". ";break}return e.match(/%/)&&!e.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(i+=_(" Do not use the percent symbol, %")+". "),i}var greekletters=["alpha","beta","chi","delta","epsilon","gamma","varphi","phi","psi","sigma","rho","theta","lambda","mu","nu","omega","tau"],calctoproc={},intcalctoproc={},calcformat={},functoproc={},matcalctoproc={},ntupletoproc={},complextoproc={},callbackstack={},matsize={},vlist={},flist={},pts={},iseqn={};function doonsubmit(e,t,a){for(var i in callbackstack)callbackstack[i](i);if(null!=e){if("submitted"==e.className)return alert(_("You have already submitted this page.  Please be patient while your submission is processed.")),e.className="submitted2",!1;if("submitted2"==e.className)return!1;if(e.className="submitted",!a){if(t&&1==$("input[name=saveforlater]").attr("data-clicked")){var s=!0;$("input[name=saveforlater]").attr("data-clicked",0)}else s=confirmSubmit(e);if(!s)return e.className="",!1}}for(var i in imathasDraw.encodea11ydraw(),intcalctoproc)if(i=parseInt(i),null!=document.getElementById("tc"+i)){if(fullstr=document.getElementById("tc"+i).value,-1!=calcformat[i].indexOf("mixed")?fullstr=fullstr.replace(/_/g," ").replace(/^\s+/,"").replace(/\s+$/,""):fullstr=fullstr.replace(/\s+/g,""),fullstr=normalizemathunicode(fullstr),fullstr.match(/DNE/i))fullstr=fullstr.toUpperCase();else{if(-1!=calcformat[i].indexOf("inequality")&&(fullstr=ineqtointerval(fullstr)),-1!=calcformat[i].indexOf("list")){for(var r=0,n=[],l=1;l<fullstr.length-1;l++)","==fullstr.charAt(l)&&(")"!=fullstr.charAt(l-1)&&"]"!=fullstr.charAt(l-1)||"("!=fullstr.charAt(l+1)&&"["!=fullstr.charAt(l+1)||(n.push(fullstr.substring(r,l)),r=l+1));n.push(fullstr.substring(r))}else n=fullstr.split(/\s*U\s*/i);for(k=0;k<n.length;k++)if(str=n[k],str.length>0&&str.match(/,/)){for(sm=str.charAt(0),em=str.charAt(str.length-1),vals=str.substring(1,str.length-1),vals=vals.split(/,/),j=0;j<2;j++)if(!vals[j].match(/oo$/)&&!vals[j].match(/oo\W/)){var c="";try{-1!=calcformat[i].indexOf("mixed")&&(vals[j]=vals[j].replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)"));var o=scopedmatheval(vals[j])}catch(e){c="syntax incomplete"}isNaN(o)||"Infinity"==o||""===o||(vals[j]=(Math.abs(o)<1e-15?0:o)+c)}n[k]=sm+vals[0]+","+vals[1]+em}-1!=calcformat[i].indexOf("list")?fullstr=n.join(","):fullstr=n.join("U")}document.getElementById("qn"+i).value=fullstr}for(var i in calctoproc)if(i=parseInt(i),null!=document.getElementById("tc"+i)){if(str=document.getElementById("tc"+i).value,str=normalizemathunicode(str),str=str.replace(/=/,""),-1!=calcformat[i].indexOf("list"))n=str.split(/,/);else if(-1!=calcformat[i].indexOf("set")){if(!str.match(/^\s*{.*?}\s*$/))continue;n=str.replace(/^\s*{(.*?)}\s*$/,"$1").split(/,/)}else{(n=new Array)[0]=str}for(var d=0;d<n.length;d++){if(str=n[d],str=str.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1"),str=str.replace(",","*NaN*"),-1==calcformat[i].indexOf("scinot")&&-1==calcformat[i].indexOf("allowxtimes")||(str=str.replace(/(x|X|\u00D7)/,"*")),str.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(str=str.replace(/%/,"")+"/100"),str=str.replace(/(\d+)\s*_\s*(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)"),-1!=calcformat[i].indexOf("mixed")&&(str=str.replace(/(\d+)\s+(\d+|\(\d+\))\s*\/\s*(\d+|\(\d+\))/g,"($1+$2/$3)")),str.match(/^\s*$/))o="";else if(str.match(/oo$/)||str.match(/oo\W/))o=str;else if(str.match(/DNE/i))o=str.toUpperCase();else o=scopedmatheval(str);n[d]=o}document.getElementById("qn"+i).value=n.join(",")}for(var i in matcalctoproc){if(i=parseInt(i),null!=matsize[i]){if(null==document.getElementById("qn"+i+"-0"))continue;msize=matsize[i].split(","),str=matrixcalc("qn"+i,null,msize[0],msize[1])}else{if(null==document.getElementById("tc"+i))continue;str=matrixcalc("tc"+i,null)}document.getElementById("qn"+i).value=str}for(var i in ntupletoproc)i=parseInt(i),null!=document.getElementById("tc"+i)&&(str=ntuplecalc("tc"+i,null,calcformat[i]),document.getElementById("qn"+i).value=str);for(var i in complextoproc)i=parseInt(i),null!=document.getElementById("tc"+i)&&(str=complexcalc("tc"+i,null,calcformat[i]),document.getElementById("qn"+i).value=str);for(var i in functoproc)if(i=parseInt(i),null!=document.getElementById("tc"+i)){str=document.getElementById("tc"+i).value,str=str.replace(/,/g,""),str=normalizemathunicode(str);var u=AMnumfuncPrepVar(i,str);if(str=u[0],varlist=u[2],1==iseqn[i])str=str.replace(/(.*)=(.*)/,"$1-($2)");else if(str.match("="))continue;fl=flist[i],""!=fl&&(reg=new RegExp("("+fl+")\\(","g"),str=str.replace(reg,"$1*sin($1+")),vars=varlist.split("|"),document.getElementById("qn"+i).value=str,parser=makeMathFunction(str,varlist),ptlist=pts[i].split(","),vals=new Array;for(var p=0;p<ptlist.length;p++){inputs=ptlist[p].split("~");for(var m={DNE:1},h=0;h<inputs.length;h++)m[vars[h]]=parseFloat(inputs[h]);if(""!==str&&!1!==parser){try{vals[p]=parser(m)}catch(e){vals[p]=NaN}"synerr"==vals[p]&&(vals[p]=NaN)}else vals[p]=NaN}document.getElementById("qn"+i+"-vals").value=vals.join(",")}return!0}function scopedmatheval(e){if(e.match(/^\s*[a-df-zA-Z]\s*$/))return"";try{return evalMathParser(e)}catch(e){return""}}function arraysearch(e,t){for(var a=0;a<t.length;a++)if(t[a]==e)return a;return-1}function toggleinlinebtn(e,t){var a=document.getElementById(t),i=document.getElementById(e);"none"==i.style.display?(i.style.display="",i.setAttribute("aria-hidden",!1),a.setAttribute("aria-expanded",!0)):(i.style.display="none",i.setAttribute("aria-hidden",!0),a.setAttribute("aria-expanded",!1));var s=a.innerHTML;a.innerHTML=s.match(/\[\+\]/)?s.replace(/\[\+\]/,"[-]"):s.replace(/\[\-\]/,"[+]")}var backgsavetimer=null;function assessbackgsave(){var e=this;window.clearTimeout(backgsavetimer),backgsavetimer=window.setTimeout((function(){doassessbackgsave(e)}),500)}function doassessbackgsave(e){var t=$(e).attr("name").match(/^(qs|qn|tc)(\d+)/);if(null!==t&&window.FormData){var a=1*t[2];a>=1e3&&(a=Math.floor(a/1e3+.001)-1),"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave(),doonsubmit();var i=new FormData,s=new RegExp("^(qn|tc|qs)("+a+"\\b|"+(a+1)+"\\d{3})");$("input,select,textarea").each((function(e,t){t.name.match(s)&&("radio"!=t.type&&"checkbox"!=t.type||t.checked)&&("file"==t.type?i.append(t.name,t.files[0]):i.append(t.name,t.value))})),i.append("backgroundsaveforlater",1),i.append("tosaveqn",a),i.append("asidverify",document.getElementById("asidverify").value),i.append("disptime",document.getElementById("disptime").value),i.append("isreview",document.getElementById("isreview").value),$.ajax({type:"POST",url:window.location.origin+window.location.pathname,data:i,contentType:!1,processData:!1,qn:a}).done((function(e){-1!=assessFormIsDirty.indexOf(1*this.qn)&&assessFormIsDirty.splice(assessFormIsDirty.indexOf(1*this.qn),1)}))}}function assessbackgsubmit(qn,noticetgt){if(qn=parseInt(qn),!confirmSubmit($("#embedqwrapper"+qn)[0]))return!1;"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave(),doonsubmit();var params={},useFormData=!!window.FormData;if(useFormData)var tosubFormData=new FormData;for(var els=new Array,tags=document.getElementsByTagName("input"),i=0;i<tags.length;i++)els.push(tags[i]);for(var tags=document.getElementsByTagName("select"),i=0;i<tags.length;i++)els.push(tags[i]);for(var tags=document.getElementsByTagName("textarea"),i=0;i<tags.length;i++)els.push(tags[i]);if(null!=qn)var regex=new RegExp("^(qn|tc|qs)("+qn+"\\b|"+(qn+1)+"\\d{3})");else var regex=new RegExp("^(qn|tc|qs)");for(var i=0;i<els.length;i++)els[i].name.match(regex)&&("radio"!=els[i].type&&"checkbox"!=els[i].type||els[i].checked)&&(useFormData?"file"==els[i].type?tosubFormData.append(els[i].name,els[i].files[0]):tosubFormData.append(els[i].name,els[i].value):"file"==els[i].type?alert("File upload submissions are not supported by this browser"):params[els[i].name]=els[i].value);null!==qn?useFormData?(tosubFormData.append("toscore",qn),tosubFormData.append("verattempts",document.getElementById("verattempts"+qn).value)):(params.toscore=qn,params.verattempts=document.getElementById("verattempts"+qn).value):useFormData?tosubFormData.append("verattempts",document.getElementById("verattempts").value):params.verattempts=document.getElementById("verattempts").value,useFormData?(tosubFormData.append("asidverify",document.getElementById("asidverify").value),tosubFormData.append("disptime",document.getElementById("disptime").value),tosubFormData.append("isreview",document.getElementById("isreview").value)):(params.asidverify=document.getElementById("asidverify").value,params.disptime=document.getElementById("disptime").value,params.isreview=document.getElementById("isreview").value);var options={type:"POST",url:assesspostbackurl,data:useFormData?tosubFormData:params,dataType:"text",qn:qn,noticetgt:noticetgt};useFormData&&(options.contentType=!1,options.processData=!1),$.ajax(options).done((function(msg){if(null!=this.noticetgt&&(document.getElementById(this.noticetgt).innerHTML=""),null!==this.qn){for(var qn=this.qn,scripts=new Array,resptxt=msg;resptxt.indexOf("<script")>-1||resptxt.indexOf("</script")>-1;){var s=resptxt.indexOf("<script"),s_e=resptxt.indexOf(">",s),e=resptxt.indexOf("</script",s),e_e=resptxt.indexOf(">",e);scripts.push(resptxt.substring(s_e+1,e)),resptxt=resptxt.substring(0,s)+resptxt.substring(e_e+1)}document.getElementById("embedqwrapper"+qn).innerHTML=resptxt,usingASCIIMath&&rendermathnode(document.getElementById("embedqwrapper"+qn)),usingASCIISvg&&setTimeout("drawPics()",100),usingTinymceEditor&&initeditor("textareas","mceEditor"),initstack.length=0;for(var i=0;i<scripts.length;i++)try{(k=scripts[i].match(/canvases\[(\d+)\]/))&&("undefined"!=typeof G_vmlCanvasManager&&(scripts[i]=scripts[i]+'G_vmlCanvasManager.initElement(document.getElementById("canvas'+k[1]+'"));'),scripts[i]=scripts[i]+"imathasDraw.initCanvases("+k[1]+");"),eval(scripts[i])}catch(e){}for(var i=0;i<initstack.length;i++)var foo=initstack[i]();var qnlen=(qn+1).toString().length;for(i in LivePreviews)(i==qn||i>999&&i.toString().substr(0,qnlen)==qn+1)&&LivePreviews[i].Init();$(window).trigger("ImathasEmbedReload",[qn]),-1!=assessFormIsDirty.indexOf(1*qn)&&assessFormIsDirty.splice(assessFormIsDirty.indexOf(1*qn),1),$("#embedqwrapper"+qn).find("input,textarea").on("change",trackDirty);var pagescroll=0;if(void 0!==window.pageYOffset)pagescroll=window.pageYOffset;else{var B=document.body,D=document.documentElement;D=D.clientHeight?D:B,pagescroll=D.scrollTop}var elpos=findPos(document.getElementById("embedqwrapper"+qn))[1];pagescroll>elpos&&setTimeout((function(){window.scroll(0,elpos)}),150)}})).fail((function(e){null!=this.noticetgt&&(document.getElementById(this.noticetgt).innerHTML=_("Submission Error"))}))}function embedEnterHandler(e){$("#"+e+" input[type=text][name^=qn]").off("keydown.embedenterhandler").on("keydown.embedenterhandler",(function(e){if(13==e.which){e.preventDefault();var t=parseInt($(this).closest(".embedqwrapper").attr("id").substr(13));assessbackgsubmit(t,"submitnotice"+t)}}))}function AutoSuggest(e,t){var a=this;this.elem=e,this.suggestions=t,this.eligible=new Array,this.inputText=null,this.highlighted=-1,this.div=document.getElementById("autosuggest"),null==this.div&&(this.div=document.createElement("div"),this.div.id="autosuggest",document.getElementsByTagName("body")[0].appendChild(this.div),this.div.appendChild(document.createElement("ul")));if(e.setAttribute("autocomplete","off"),!e.id){var s="autosuggest"+AutoSuggestIdCounter;AutoSuggestIdCounter++,e.id=s}e.onkeydown=function(e){var t=a.getKeyCode(e);switch(t){case 9:a.useSuggestion("tab");break;case 13:return a.useSuggestion("enter"),!1;case 27:a.hideDiv();break;case 38:a.highlighted>0&&a.highlighted--,a.changeHighlight(t);break;case 40:a.highlighted<a.eligible.length-1&&a.highlighted++,a.changeHighlight(t)}},e.onkeyup=function(e){switch(a.getKeyCode(e)){case 9:case 27:case 38:case 40:return;default:this.value.length>1?(a.inputText=this.value,a.getEligible(),a.eligible.length>0?a.highlighted=0:a.highlighted=-1,a.createDiv(),a.positionDiv(),a.showDiv()):(a.hideDiv(),0==this.value.length&&(a.inputText=""))}},e.onblur=function(e){setTimeout(a.hideDiv,100)},this.useSuggestion=function(e){this.highlighted>-1?(this.elem.value=this.eligible[this.highlighted],this.hideDiv()):this.hideDiv()},this.showDiv=function(){this.div.style.display="block"},this.hideDiv=function(){a.div.style.display="none",a.highlighted=-1},this.changeHighlight=function(){var e=this.div.getElementsByTagName("LI");for(i in e){var t=e[i];this.highlighted==i?t.className="selected":t.className=""}},this.positionDiv=function(){var e=this.elem,t=findPos(e);t[1]+=e.offsetHeight,this.div.style.left=t[0]+"px",this.div.style.top=t[1]+"px"},this.createDiv=function(){var e=document.createElement("ul");for(i in this.eligible){var t=this.eligible[i],s=document.createElement("li"),r=document.createElement("a");r.href="#",r.onclick=function(){return!1},r.innerHTML=t,s.appendChild(r),a.highlighted==i&&(s.className="selected"),e.appendChild(s)}this.div.replaceChild(e,this.div.childNodes[0]),e.onmouseover=function(e){for(var t=a.getEventSource(e);t.parentNode&&"LI"!=t.tagName.toUpperCase();)t=t.parentNode;var s=a.div.getElementsByTagName("LI");for(i in s){if(s[i]==t){a.highlighted=i;break}}a.changeHighlight()},e.onclick=function(e){return a.useSuggestion("click"),a.hideDiv(),a.cancelEvent(e),!1},this.div.className="suggestion_list",this.div.style.position="absolute"},this.getEligible=function(){this.eligible=new Array;if(-1==this.inputText.indexOf(" ")){var e=new RegExp("\\b"+this.inputText.toLowerCase());for(i in this.suggestions){var t=this.suggestions[i];t.toLowerCase().match(e)&&(this.eligible[this.eligible.length]=t,i+",")}}},this.getKeyCode=function(e){return e?e.keyCode:window.event?window.event.keyCode:void 0},this.getEventSource=function(e){return e?e.target:window.event?window.event.srcElement:void 0},this.cancelEvent=function(e){e&&(e.preventDefault(),e.stopPropagation()),window.event&&(window.event.returnValue=!1)}}$(window).on("ImathasEmbedReload",(function(e,t){embedEnterHandler("embedqwrapper"+t)}));var AutoSuggestIdCounter=0;function isBlank(e){return!e||0===e.length||/^\s*$/.test(e)}function editdebit(e){var t=$(e).closest("tr").find("input").first();!isBlank(e.value)&&t.hasClass("iscredit")&&(t.is("select")?t.css("margin-right",20):t.width(t.width()+20),t.css("padding-left",0),t.removeClass("iscredit"))}function editcredit(e){var t=$(e).closest("tr").find("input").first();isBlank(e.value)||t.hasClass("iscredit")||(t.is("select")?t.css("margin-right",0):t.width(t.width()-20),t.css("padding-left",20),t.addClass("iscredit"))}function initcreditboxes(){$(".creditbox").each((function(e,t){if(!isBlank(t.value)&&20!=$(t).css("padding-left")){var a=$(t).closest("tr").find("input").first();a.is("select")?a.css("margin-right",0):a.width(a.width()-20),a.css("padding-left",20),a.addClass("iscredit")}}))}function initqsclickchange(){$("input[id^=qs][value=spec]").each((function(e,t){$(t).siblings("input[type=text]").off("keyup.qsclickchange").on("keyup.qsclickchange",(function(e){8!=e.keyCode&&46!=e.keyCode&&$(t).prop("checked",!0)}))}))}function initShowAnswer(){$("input.sabtn + span.hidden").attr("aria-hidden",!0),$("input.sabtn").each((function(){var e=$(this).siblings("span:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",e).off("click.sashow").on("click.sashow",(function(){"true"==$(this).attr("aria-expanded")?$(this).attr("aria-expanded",!1).siblings("span:first-of-type").attr("aria-hidden",!0).addClass("hidden"):$(this).attr("aria-expanded",!0).siblings("span:first-of-type").attr("aria-hidden",!1).removeClass("hidden")}))})),$("input.dsbtn + div.hidden").attr("aria-hidden",!0),$("input.dsbtn").each((function(){var e=$(this).siblings("div:first-of-type").attr("id");$(this).attr("aria-expanded",!1).attr("aria-controls",e).off("click.sashow").on("click.sashow",(function(){"true"==$(this).attr("aria-expanded")?$(this).attr("aria-expanded",!1).siblings("div:first-of-type").attr("aria-hidden",!0).addClass("hidden"):$(this).attr("aria-expanded",!0).siblings("div:first-of-type").attr("aria-hidden",!1).removeClass("hidden")}))}))}function assessmentTimer(e,t){var a,i,s,r,n,l,c=Date.now();n=setInterval((function(){if((a=e-Math.floor((Date.now()-c)/1e3))<=0){if(a=0,clearInterval(n),t){if(document.getElementById("timelimitholder").className="noticetext",document.getElementById("timelimitholder").innerHTML=_("Time limit expired - submitting now"),document.getElementById("timelimitholder").style.fontSize="300%",null==document.getElementById("qform"))return void setTimeout("window.location.href='"+imasroot+"/assessment/showtest.php?action=skip&superdone=true'",2e3);var o=document.getElementById("qform"),d=o.getAttribute("action");return o.setAttribute("action",d+"&superdone=true"),doonsubmit(o,!0,!0)&&setTimeout('document.getElementById("qform").submit()',2e3),0}alert(_("Time Limit has elapsed"))}r=Math.floor(a%60),s=Math.floor(a/60%60),0==(i=Math.floor(a/3600))&&s<5&&(document.getElementById("timeremaining").className="noticetext"),0==i&&0==s&&r<=5&&(document.getElementById("timeremaining").style.fontSize="150%"),l=(i>0?i+":":"")+(i>0&&s<10?"0":"")+s+":"+(r<10?"0":"")+r,document.getElementById("timeremaining").innerHTML=l}),1e3),$(document).ready((function(){var e=$("#timerwrap"),t=e.position();$(window).scroll((function(){$(window).scrollTop()>=t.top?e.addClass("sticky"):e.removeClass("sticky")}))}))}function toggletimer(){"[x]"==$("#timerhide").text()?($("#timercontent").hide(),$("#timerhide").text("["+_("Show Timer")+"]"),$("#timerhide").attr("title","["+_("Show Timer")+"]")):($("#timercontent").show(),$("#timerhide").text("[x]"),$("#timerhide").attr("title",_("Hide Timer")))}function toggleintroshow(e){var t=document.getElementById("introtoggle"+e),a=document.getElementById("intropiece"+e);t.innerHTML.match("Hide")?(t.innerHTML=t.innerHTML.replace("Hide","Show"),$(t).attr("aria-expanded",!1),a.style.display="none",$(a).attr("aria-hidden",!0).attr("aria-expanded",!1)):(t.innerHTML=t.innerHTML.replace("Show","Hide"),$(t).attr("aria-expanded",!0),a.style.display="block",$(a).attr("aria-hidden",!1).attr("aria-expanded",!0))}function togglemainintroshow(e){$("#intro").hasClass("hidden")?($(e).html(_("Hide Intro/Instructions")).attr("aria-expanded",!0),$("#intro").removeClass("hidden").addClass("intro").attr("aria-hidden",!1).attr("aria-expanded",!0)):($("#intro").addClass("hidden").attr("aria-hidden",!0).attr("aria-expanded",!1),$(e).html(_("Show Intro/Instructions")).attr("aria-expanded",!1))}function prepWithMath(e){return e=(e=(e=e.replace(/\b(abs|acos|asin|atan|ceil|floor|cos|sin|tan|sqrt|exp|max|min|pow)\(/g,"Math.$1(")).replace(/\(E\)/g,"(Math.E)")).replace(/\((PI|pi)\)/g,"(Math.PI)")}initstack.push(initcreditboxes),$(window).on("ImathasEmbedReload",initcreditboxes),$(window).on("ImathasEmbedReload",initqsclickchange),initstack.push(initqsclickchange),$(window).on("ImathasEmbedReload",initShowAnswer),initstack.push(initShowAnswer);var assessFormIsDirty=[];function trackDirty(){var e=$(this).attr("name").match(/^(qs|qn|tc)(\d+)/);if(null!==e){var t=1*e[2];t>1e3&&(t=Math.floor(t/1e3+.001)-1),-1==assessFormIsDirty.indexOf(t)&&assessFormIsDirty.push(t)}}$((function(){$("div.question").find("input,select,textarea").on("change",trackDirty),$(window).on("beforeunload",(function(){if(0==$("form.submitted,form.submitted2").length&&assessFormIsDirty.length>0)return _("Are you sure you want to leave this assessment? You may have unsubmitted work")}))}));
function checkComplete(e){if("undefined"!=typeof tinyMCE)try{tinyMCE.triggerSave()}catch(e){}var t=!0;return $(e).find("input:visible,textarea:visible,select:visible").each((function(e,n){if(void 0===n.type||void 0===n.name||""==n.name)return 1;"text"==n.type||"textarea"==n.type||"password"==n.type||"file"==n.type?""==n.value&&0==$("#qs"+n.id.substr(2)+"-d:checked,#qs"+n.id.substr(2)+"-i:checked").length&&(t=!1):-1!=n.type.indexOf("select")?(-1==n.selectedIndex||"qn"==n.name.substr(0,2)&&0==n.selectedIndex)&&(t=!1):"radio"==n.type&&0==$("input[name="+n.name+"]:checked").length&&(t=!1)})),t}function confirmSubmit(e){if(checkComplete(e))return!0;return confirm("Not all question parts have been answered.  Are you sure you want to submit this question?")}function confirmSubmit2(e){if(checkComplete(e))return!0;return confirm("Not all questions have been answered completely.  If you are saving your answers for later, this is fine.  If you are submitting for grading, are you sure you want to submit now?")}
var canvases=new Array,drawla=new Array,imathasDraw=function(e){var t=!1,n=new Array,l=new Array,o=new Array,a=new Array,r=new Array,d=new Array,h=new Array,s=new Array,m=new Array,u=new Array,g=null,c=[],p=[],f=null,v=null,y=["rgb(0,0,255)","rgb(255,0,0)","rgb(0,255,0)"],w=["rgba(0,0,255,.4)","rgba(255,0,0,.4)","rgba(0,255,0,.4)"],x="rgb(0,200,0)",b=null,T=null,M=null,E=!1,I=!1,L=!1,N=!1,B=null,P={5:2,5.1:2,5.2:2,5.3:2,5.4:2,6:2,6.1:2,6.2:2,6.3:2,6.5:2,6.6:2,7:2,7.2:2,7.4:2,7.5:2,8:2,8.2:2,8.3:2,8.4:2,8.5:3,8.6:3,9:2,9.1:2,10:3,10.2:3,10.3:3,10.4:3},q={7.4:1,7.5:1,8.2:1,8.5:1,8.6:1};function k(e,t){o[e]&&o[e].disabled&&!t||a.hasOwnProperty(e)&&(a[e].length=0,r[e].length=0,d[e].length=0,h[e].length=0,s[e].length=0,m[e].length=0,u[e].length=0,M=e,"canvas"==n[e].type&&O(),M=null,g=null,b=null)}function S(t,i,l){var g=t[0],c=t[13].split(","),p=!0;"noprev"==c[c.length-1]&&(p=!1,c.pop());var f=t[2],v=t[3],y=t[4],w=t[5];y==w&&(y=-1,w=1);var x=t[6],b=t[7],T=t[8],M=document.getElementById("a11ydraw"+g);if(null==M){var E=document.getElementById("canvas"+g);if(E&&!p){var I=e("<div>").append(e("<p>",{text:_("Drawn Elements:")}));(M=document.createElement("ul")).setAttribute("id","allydraw"+g),I.append(M),e(E).replaceWith(I)}}o[g]=document.getElementById("qn"+g);var L,N=!!document.getElementById("a11ydrawnew"+g);o[g].disabled&&(N&&(document.getElementById("a11ydrawnew"+g).disabled=!0),e(".a11ydrawadd[data-qn="+g+"]").prop("disabled",!0)),n[g]={type:"a11y",el:M,vispreview:p,xmin:f,xmax:v,ymin:y,ymax:w,imgborder:x,imgwidth:b,imgheight:T},p&&(n[g].canv=document.getElementById("canvas"+g)),n[g].pixperx=(b-2*x)/(v-f),n[g].pixpery=y==w?1:(T-2*x)/(w-y),"inequality"==c[0]?(L=c.shift(),0==c.length?c=["line"]:"both"==c[0]&&(c=["line","parab"])):"twopoint"==c[0]?(L=c.shift(),0==c.length&&(c=["line","parab","abs","circle","dot"])):"numberline"==c[0]?(L="basic",c.shift()):L="basic",n[g].afgroup=L;var B={inequality:{line:[{mode:10,descr:_("Linear inequality with solid line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")},{mode:10.2,descr:_("Linear inequality with dashed line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")}],parab:[{mode:10.3,descr:_("Parabolic inequality with solid line"),inN:3,input:_("Enter the vertex, then another point on the parabola, then a third point in the shaded region")},{mode:10.4,descr:_("Parabolic inequality with dashed line"),inN:3,input:_("Enter the vertex, then another point on the parabola, then a third point in the shaded region")}],abs:[{mode:10.5,descr:_("Absolute value inequality with solid line"),inN:3,input:_("Enter the corner point of the absolute value, then another point on the graph, then a third point in the shaded region")},{mode:10.6,descr:_("Absolute value inequality with dashed line"),inN:3,input:_("Enter the corner point of the absolute value, then another point on the graph, then a third point in the shaded region")}]},twopoint:{line:[{mode:5,descr:_("Line"),inN:2,input:_("Enter two points on the line")}],dashline:[{mode:5.1,descr:_("Dashed Line"),inN:2,input:_("Enter two points on the dashed line")}],lineseg:[{mode:5.3,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],ray:[{mode:5.2,descr:_("Ray"),inN:2,input:_("Enter the starting point of the ray and another point on the ray")}],parab:[{mode:6,descr:_("Parabola"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],horizparab:[{mode:6.1,descr:_("Parabola opening right or left"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],halfparab:[{mode:6.2,descr:_("Half Parabola"),inN:2,input:_("Enter the vertex, then another point on the half parabola")}],cubic:[{mode:6.3,descr:_("Cubic"),inN:2,input:_("Enter the inflection point, then another point on the cubic")}],sqrt:[{mode:6.5,descr:_("Square root"),inN:2,input:_("Enter the starting point of the square root, then another point on the graph")}],cuberoot:[{mode:6.6,descr:_("Cube root"),inN:2,input:_("Enter the inflection point of the cube root, then another point on the graph")}],abs:[{mode:8,descr:_("Absolute value"),inN:2,input:_("Enter the corner point of the absolute value, then another point on the graph")}],rational:[{mode:8.2,descr:_("Rational"),inN:2,input:_("Enter the point where the vertical and horizontal asymptote cross, then a point on the graph")}],exp:[{mode:8.3,descr:_("Exponential"),inN:2,input:_("Enter two points on the graph")}],log:[{mode:8.4,descr:_("Logarithm"),inN:2,input:_("Enter two points on the graph")}],genexp:[{mode:8.5,descr:_("Shifted Exponential"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],genlog:[{mode:8.6,descr:_("Shifted Logarithm"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],circle:[{mode:7,descr:_("Circle"),inN:2,input:_("Enter the center point of the circle, then a point on the graph")}],ellipse:[{mode:7.2,descr:_("Ellipse"),inN:2,input:_("Enter the center point of the ellipse, then a point offset from the center by the horizontal radius and vertical radius")}],hyperbola:[{mode:7.4,descr:_("Vertical hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the co-vertex and y is the y-coordinate of the vertex")},{mode:7.5,descr:_("Horizontal hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the vertex and y is the y-coordinate of the co-vertex")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],trig:[{mode:9,descr:_("Cosine"),inN:2,input:_("Enter a point at the start of a phase, then a point half a phase further")},{mode:9.1,descr:_("Sine"),inN:2,input:_("Enter a point at the start of a phase, then a point a quarter phase further")}],vector:[{mode:5.4,descr:_("Vector"),inN:2,input:_("Enter the starting and ending point of the vector")}]},basic:{line:[{mode:0,descr:_("Lines"),inN:"list",input:_("Enter a list of points to connect with lines")}],lineseg:[{mode:.5,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],freehand:[{mode:.7,descr:_("Freehand"),inN:"list",input:_("Enter a list of points to connect with lines")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],polygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter a list of points for dots to connect with lines"),dotline:1}],closedpolygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter a list of points for dots to connect with lines"),dotline:2}]}};null==a[g]&&(a[g]=new Array),null==r[g]&&(r[g]=new Array),null==d[g]&&(d[g]=new Array),null==h[g]&&(h[g]=new Array),null==s[g]&&(s[g]=new Array),null==m[g]&&(m[g]=new Array),null==u[g]&&(u[g]=new Array);for(var P,q,k=[],S=[],W=[],j=0;j<c.length;j++)if(B[L].hasOwnProperty(c[j])){0==j&&(P=B[L][c[j]][0].mode);for(var O=0;O<B[L][c[j]].length;O++)W[B[L][c[j]][O].mode]=B[L][c[j]][O],k.push(B[L][c[j]][O].mode),q='<option value="'+B[L][c[j]][O].mode+'"',q+=' data-af="'+c[j]+'">'+B[L][c[j]][O].descr+"</option>",S.push(q)}if(N&&(document.getElementById("a11ydrawnew"+g).innerHTML=S),n[g].defmode=P,n[g].inputmodes=k,n[g].selects=S,n[g].moderef=W,N||!p)if(null==i&&a.hasOwnProperty(g)){for(j=0;j<a[g].length;j++)A(g,0,C(a[g][j],g));for(j=0;j<r[g].length;j++)A(g,1,C(r[g][j],g));for(j=0;j<d[g].length;j++)A(g,2,C(d[g][j],g));for(j=0;j<h[g].length;j++)A(g,s[g][j],C(h[g][j][0],g)+","+C(h[g][j][1],g));for(j=0;j<m[g].length;j++)A(g,u[g][j],C(m[g][j][0],g)+","+C(m[g][j][1],g)+","+C(m[g][j][2],g))}else if(null!=i)for(j=0;j<i.length;j++)A(g,i[j][0],i[j][1].replace(/\[/g,"(").replace(/\]/g,")"));p&&D(n[g].canv,g,l,b,T,!0)}function A(t,i,l){var a=n[t],r=i||document.getElementById("a11ydrawnew"+t).value,d=l||"",h=(a.afgroup,a.el.getElementsByTagName("li").length+1),s=o[t].disabled?" disabled ":"",m='<span class="sr-only draweln">'+_("Drawing element ")+h+"</span>";html=m,html+=a.moderef[r].descr+".<br/>",html+='<label><span class="a11ydrawinstr"></span><br/>',html+='<input type="text" value="'+d+'" data-n="'+a.moderef[r].inN+'" '+s,html+='onblur="imathasDraw.updatea11ydraw(this)"/></label>',html+='<button type="button" class="imgbutton" onclick="imathasDraw.removea11ydraw(this)"'+s+">",html+=_("Remove")+" "+m+"</button>";var u=e("<li>",{class:"a11ydrawrow","data-mode":r}).html(html);e(a.el).append(u),u.find(".a11ydrawinstr").text(a.moderef[r].input),l||u.find("input").focus()}function C(e,t){var i,l,o=n[t];return i=(e[0]-o.imgborder)/o.pixperx+o.xmin,l=(o.imgheight-e[1]-o.imgborder)/o.pixpery+o.ymin,"("+(i=Math.round(100*i)/100)+","+(l=Math.round(100*l)/100)+")"}function W(t){void 0===t&&(t=-1);var i=M;for(var l in n)if(!(t>-1&&t!=l)){var g=n[l];if("a11y"==g.type){t>-1&&t==l&&(M=l),a[l].length=0,r[l].length=0,d[l].length=0,h[l].length=0,s[l].length=0,m[l].length=0,u[l].length=0;var c=[],p=[],f=[],v=[],y=[],w=[];n[l].afgroup;e("#a11ydraw"+l).find(".a11ydrawrow").each((function(t,n){var i=e(n).find("input").val(),o=n.getAttribute("data-mode"),x=e(n).find("input").attr("data-n");w.push("["+o+',"'+i+'"]'),i=i.replace(/[\(\)]/g,"").split(/\s*,\s*/);var b=[],T=[];for(t=1;t<i.length;t+=2){if("oo"===i[t-1])i[t-1]=g.imgwidth-2*g.imgborder-1;else if("-oo"===i[t-1])i[t-1]=1;else try{i[t-1]=evalMathParser(i[t-1])}catch(e){i[t-1]=NaN}try{i[t]=evalMathParser(i[t])}catch(e){i[t]=NaN}i[t-1]=(i[t-1]-g.xmin)*g.pixperx+g.imgborder,i[t]=g.imgheight-(i[t]-g.ymin)*g.pixpery-g.imgborder,b.push(Math.round(i[t-1])+","+Math.round(i[t])),T.push([i[t-1],i[t]])}"list"!==x&&x!=b.length||(1==o?(p.push("("+b.join("),(")+")"),r[l].push(T)):2==o?(f.push("("+b.join("),(")+")"),d[l].push(T)):o<1?(c.push("("+b.join("),(")+")"),a[l].push(T)):o>=5&&o<10?(v.push("("+o+","+b.join(",")+")"),h[l].push(T),s[l].push(o)):o>=10&&(y.push("("+o+","+b.join(",")+")"),m[l].push(T),u[l].push(o)))})),o[l].value=c.join(";")+";;"+p.join(",")+";;"+f.join(",")+";;"+v.join(",")+";;"+y.join(",")+";;"+w.join(","),e(o[l]).trigger("input").trigger("change")}}t>-1&&n[t].vispreview&&O(null,null,!0),M=i}function j(t,i,l,g,f,v,y,w,x,b,T,M,E,_,I){var L=document.getElementById(i);e(L).is(":hidden")&&e(L).on("mouseover.imathasdrawwait touchstart.imathasdrawwait",(function(){e(L).off("mouseover.imathasdrawwait touchstart.imathasdrawwait"),ee(t)})),L.style.userSelect="none",L.style.webkitUserSelect="none",L.style.MozUserSelect="none";var N=Z(L);n[t]={type:"canvas",el:L,left:N.x,top:N.y,width:L.offsetWidth,height:L.offsetHeight,xmin:f,xmax:v,ymin:y,ymax:w,imgborder:x,imgwidth:b,imgheight:T,mode:M,dotline:E},"string"==typeof I&&-1!=I.indexOf(":")?(I=I.split(":"),n[t].snaptogridx=1*I[0],n[t].snaptogridy=1*I[1]):(n[t].snaptogridx=1*I,n[t].snaptogridy=1*I),n[t].pixperx=(b-2*x)/(v-f),n[t].pixpery=y==w?1:(T-2*x)/(w-y),o[t]=document.getElementById(g),null==a[t]&&(a[t]=new Array),null==r[t]&&(r[t]=new Array),null==d[t]&&(d[t]=new Array),null==h[t]&&(h[t]=new Array),null==s[t]&&(s[t]=new Array),null==m[t]&&(m[t]=new Array),null==u[t]&&(u[t]=new Array),c[t]=M>=5?1:0,p[t]=_,D(L,t,l,b,T,!1)}function D(t,n,i,o,a,r){if(i.match(/initPicture/)){0==e(t).closest(".drawcanvasholder").length&&(e(t).removeClass("drawcanvas").wrap(e("<div>",{class:"drawcanvas",style:"position:relative;width:"+o+"px;height:"+a+"px"})).wrap(e("<div>",{class:"drawcanvasholder",style:"position:absolute;top:0;left:0;z-index:2"})),e(t).closest(".drawcanvas").prepend(e("<div>",{class:"canvasbg",style:"position:absolute;top:0;left:0"}).append(e("<embed>",{"data-nomag":1,type:"image/svg+xml",align:"middle",width:o,height:a,script:i}).attr("width",o).attr("height",a)))),l[n]=null;var d=M;M=n,O(null,null,r),setTimeout((function(){window.drawPics(e(t).closest(".drawcanvas")[0])}),30),M=d}else if(""!==i)l[n]=new Image,l[n].onload=function(){var e=M;M=n,O(null,null,r),M=e},l[n].src=i;else{l[n]=null;d=M;M=n,O(null,null,r),M=d}}function O(t,i,c){try{if(n[M].canv)var T=n[M].canv.getContext("2d");else T=n[M].el.getContext("2d")}catch(e){E||(E=!0,alert("Your browser does not support drawing answer entry.  Please try again using Internet Explorer 6+ (Windows), FireFox 1.5+ (Win/Mac), Safari 1.3+ (Mac), Opera 9+ (Win/Mac), or Camino (Mac)"))}T.fillStyle="rgb(0,0,255)",T.lineWidth=2,T.strokeStyle="rgb(0,0,255)",T.clearRect(0,0,n[M].imgwidth,n[M].imgheight),null!==l[M]&&T.drawImage(l[M],0,0),T.beginPath();for(var _=0;_<m[M].length;_++){var I=_%3;T.strokeStyle=y[I],T.fillStyle=y[I];var L=null,N=null,B=null,k=null,S=null;if(3==m[M][_].length?(N=m[M][_][1][0],k=m[M][_][1][1],B=m[M][_][2][0],S=m[M][_][2][1]):2==m[M][_].length?(N=m[M][_][1][0],k=m[M][_][1][1],B=t,S=i):v==_&&null!=t&&1==m[M][_].length&&(N=t,k=i),null!=B){if(T.save(),T.fillStyle=w[I],T.beginPath(),u[M][_]<=10.2){if(N!=m[M][_][0][0])L=(k-m[M][_][0][1])/(N-m[M][_][0][0]);if(Math.abs(N-m[M][_][0][0])<1||Math.abs(L)>100)T.moveTo(m[M][_][0][0],0),T.lineTo(m[M][_][0][0],n[M].imgheight),B>N?(T.lineTo(n[M].imgwidth,n[M].imgheight),T.lineTo(n[M].imgwidth,0),T.closePath()):(T.lineTo(0,n[M].imgheight),T.lineTo(0,0),T.closePath());else{var A=L*(B-N)+k,C=m[M][_][0][1]-L*m[M][_][0][0],W=m[M][_][0][1]+L*(n[M].imgwidth-m[M][_][0][0]);T.moveTo(0,C),T.lineTo(n[M].imgwidth,W),S>A?(T.lineTo(n[M].imgwidth,n[M].imgheight),T.lineTo(0,n[M].imgheight),T.closePath()):(T.lineTo(n[M].imgwidth,0),T.lineTo(0,0),T.closePath())}}else if(u[M][_]<=10.4)se(T,m[M][_][0][0],m[M][_][0][1],N,k,B,S,n[M].imgwidth,n[M].imgheight);else if(Math.abs(N-m[M][_][0][0])>1){L=(k-m[M][_][0][1])/(N-m[M][_][0][0]);N<m[M][_][0][0]&&(L*=-1);A=L*Math.abs(B-m[M][_][0][0])+m[M][_][0][1],C=m[M][_][0][1]+L*m[M][_][0][0],W=m[M][_][0][1]+L*(n[M].imgwidth-m[M][_][0][0]);S>A?(T.moveTo(n[M].imgwidth,n[M].imgheight),T.lineTo(0,n[M].imgheight)):(T.moveTo(n[M].imgwidth,0),T.lineTo(0,0)),T.lineTo(0,C),T.lineTo(m[M][_][0][0],m[M][_][0][1]),T.lineTo(n[M].imgwidth,W)}T.fill(),T.restore()}if(T.beginPath(),null!=N)if(u[M][_]<=10.2){if(N!=m[M][_][0][0])L=(k-m[M][_][0][1])/(N-m[M][_][0][0]);if(Math.abs(N-m[M][_][0][0])<1||Math.abs(L)>100)10.2==u[M][_]?null!=b&&b.mode>=10&&b.mode<11&&b.num==_&&0==b.subnum?(T.dashedLine(m[M][_][1][0],m[M][_][1][1],m[M][_][1][0],n[M].imgheight),T.dashedLine(m[M][_][1][0],m[M][_][1][1],m[M][_][1][0],0)):(T.dashedLine(m[M][_][0][0],m[M][_][0][1],m[M][_][0][0],n[M].imgheight),T.dashedLine(m[M][_][0][0],m[M][_][0][1],m[M][_][0][0],0)):(T.moveTo(m[M][_][0][0],0),T.lineTo(m[M][_][0][0],n[M].imgheight),T.stroke());else{C=m[M][_][0][1]-L*m[M][_][0][0],W=m[M][_][0][1]+L*(n[M].imgwidth-m[M][_][0][0]);10.2==u[M][_]?null!=b&&b.mode>=10&&b.mode<11&&b.num==_&&0==b.subnum?(T.dashedLine(m[M][_][1][0],m[M][_][1][1],n[M].imgwidth,W),T.dashedLine(m[M][_][1][0],m[M][_][1][1],0,C)):(T.dashedLine(m[M][_][0][0],m[M][_][0][1],n[M].imgwidth,W),T.dashedLine(m[M][_][0][0],m[M][_][0][1],0,C)):(T.moveTo(0,C),T.lineTo(n[M].imgwidth,W),T.stroke())}}else if(u[M][_]<=10.4)if(10.3==u[M][_]){if(N!=m[M][_][0][0])if(k==m[M][_][0][1])T.moveTo(0,k),T.lineTo(n[M].imgwidth,k);else{var j=(k-m[M][_][0][1])/((N-m[M][_][0][0])*(N-m[M][_][0][0]));if(k>m[M][_][0][1])var D=Math.sqrt((n[M].imgheight-m[M][_][0][1])/j)+m[M][_][0][0],O=-1*Math.sqrt((n[M].imgheight-m[M][_][0][1])/j)+m[M][_][0][0],R=m[M][_][0][1]-(n[M].imgheight-m[M][_][0][1]),H=n[M].imgheight;else D=Math.sqrt((0-m[M][_][0][1])/j)+m[M][_][0][0],O=-1*Math.sqrt((0-m[M][_][0][1])/j)+m[M][_][0][0],R=2*m[M][_][0][1],H=0;var F=(Z=D+2/3*(m[M][_][0][0]-D))+(O-D)/3,Y=$=H+2/3*(R-H);T.moveTo(D,H),T.bezierCurveTo(Z,$,F,Y,O,H)}T.stroke()}else N!=m[M][_][0][0]&&he(T,m[M][_][0][0],m[M][_][0][1],N,k,n[M].imgwidth,n[M].imgheight);else if(N!=m[M][_][0][0]){L=(k-m[M][_][0][1])/(N-m[M][_][0][0]);N<m[M][_][0][0]&&(L*=-1);C=m[M][_][0][1]+L*m[M][_][0][0],W=m[M][_][0][1]+L*(n[M].imgwidth-m[M][_][0][0]);10.6==u[M][_]?(null!=b&&b.mode>=10&&b.mode<11&&b.num==_&&b.subnum,T.dashedLine(m[M][_][0][0],m[M][_][0][1],n[M].imgwidth,W),T.dashedLine(m[M][_][0][0],m[M][_][0][1],0,C)):(T.moveTo(0,C),T.lineTo(m[M][_][0][0],m[M][_][0][1]),T.lineTo(n[M].imgwidth,W),T.stroke())}if(u[M][_]==n[M].mode){T.beginPath();for(var U=0;U<m[M][_].length;U++)2==U?(T.arc(m[M][_][U][0],m[M][_][U][1],4,0,2*Math.PI,!0),T.fill()):T.fillRect(m[M][_][U][0]-3,m[M][_][U][1]-3,6,6);1==m[M][_].length&&null!=N&&T.fillRect(N-3,k-3,6,6)}T.beginPath()}T.fillStyle="rgb(0,0,255)",1==p[M]?T.lineWidth=4:T.lineWidth=2,T.strokeStyle="rgb(0,0,255)";for(_=0;_<h[M].length;_++){if(s[M][_]>=5&&s[M][_]<6){var X;L=null,N=null,k=null;if(2==h[M][_].length?(N=h[M][_][1][0],k=h[M][_][1][1]):f==_&&null!=t&&1==h[M][_].length&&(N=t,k=i),null!=N)if(5.3==s[M][_]||5.4==s[M][_]){if(T.moveTo(h[M][_][0][0],h[M][_][0][1]),T.lineTo(N,k),5.4==s[M][_]){var V=[N-h[M][_][0][0],k-h[M][_][0][1]],G=Math.sqrt(V[0]*V[0]+V[1]*V[1]);G>1e-4&&(X=[-(V=[V[0]/G,V[1]/G])[1],V[0]],T.moveTo(N-15*V[0]-4*X[0],k-15*V[1]-5*X[1]),T.lineTo(N,k),T.moveTo(N-15*V[0]+4*X[0],k-15*V[1]+5*X[1]),T.lineTo(N,k))}}else{if(N!=h[M][_][0][0])L=(k-h[M][_][0][1])/(N-h[M][_][0][0]);if(Math.abs(N-h[M][_][0][0])<1||Math.abs(L)>100)5.1==s[M][_]?T.dashedLine(h[M][_][0][0],0,h[M][_][0][0],n[M].imgheight):5.2==s[M][_]?(T.moveTo(h[M][_][0][0],h[M][_][0][1]),k>h[M][_][0][1]?T.lineTo(h[M][_][0][0],n[M].imgheight):T.lineTo(h[M][_][0][0],0)):(T.moveTo(h[M][_][0][0],0),T.lineTo(h[M][_][0][0],n[M].imgheight));else{C=h[M][_][0][1]-L*h[M][_][0][0],W=h[M][_][0][1]+L*(n[M].imgwidth-h[M][_][0][0]),C=h[M][_][0][1]-L*h[M][_][0][0],W=h[M][_][0][1]+L*(n[M].imgwidth-h[M][_][0][0]);5.1==s[M][_]?(T.dashedLine(h[M][_][0][0],h[M][_][0][1],n[M].imgwidth,W),T.dashedLine(h[M][_][0][0],h[M][_][0][1],0,C)):5.2==s[M][_]?(T.moveTo(h[M][_][0][0],h[M][_][0][1]),N>h[M][_][0][0]?T.lineTo(n[M].imgwidth,W):T.lineTo(0,C)):(T.moveTo(0,C),T.lineTo(n[M].imgwidth,W))}}}else if(6==s[M][_]||6.1==s[M][_]||6.2==s[M][_]){k=null,N=null;if(2==h[M][_].length?(N=h[M][_][1][0],k=h[M][_][1][1]):f==_&&null!=t&&1==h[M][_].length&&(N=t,k=i),null!=N)if(6==s[M][_])if(k==h[M][_][0][1])T.moveTo(0,k),T.lineTo(n[M].imgwidth,k);else if(N==h[M][_][0][0])T.moveTo(N,h[M][_][0][1]),k>h[M][_][0][1]?T.lineTo(N,n[M].imgheight):T.lineTo(N,0);else{j=(k-h[M][_][0][1])/((N-h[M][_][0][0])*(N-h[M][_][0][0]));if(k>h[M][_][0][1])D=Math.sqrt((n[M].imgheight-h[M][_][0][1])/j)+h[M][_][0][0],O=-1*Math.sqrt((n[M].imgheight-h[M][_][0][1])/j)+h[M][_][0][0],R=h[M][_][0][1]-(n[M].imgheight-h[M][_][0][1]),H=n[M].imgheight;else D=Math.sqrt((0-h[M][_][0][1])/j)+h[M][_][0][0],O=-1*Math.sqrt((0-h[M][_][0][1])/j)+h[M][_][0][0],R=2*h[M][_][0][1],H=0;F=(Z=D+2/3*(h[M][_][0][0]-D))+(O-D)/3,Y=$=H+2/3*(R-H);T.moveTo(D,H),T.bezierCurveTo(Z,$,F,Y,O,H)}else if(6.1==s[M][_])if(N==h[M][_][0][0])T.moveTo(N,0),T.lineTo(N,n[M].imgheight);else if(k==h[M][_][0][1])T.moveTo(h[M][_][0][0],k),N>h[M][_][0][0]?T.lineTo(n[M].imgwidth,k):T.lineTo(0,k);else{j=(N-h[M][_][0][0])/((k-h[M][_][0][1])*(k-h[M][_][0][1]));if(N>h[M][_][0][0]){D=Math.sqrt((n[M].imgwidth-h[M][_][0][0])/j)+h[M][_][0][1],O=-1*Math.sqrt((n[M].imgwidth-h[M][_][0][0])/j)+h[M][_][0][1];var J=h[M][_][0][0]-(n[M].imgwidth-h[M][_][0][0]),Q=n[M].imgwidth}else D=Math.sqrt((0-h[M][_][0][0])/j)+h[M][_][0][1],O=-1*Math.sqrt((0-h[M][_][0][0])/j)+h[M][_][0][1],J=2*h[M][_][0][0],Q=0;Y=($=D+2/3*(h[M][_][0][1]-D))+(O-D)/3,F=Z=Q+2/3*(J-Q);T.moveTo(Q,D),T.bezierCurveTo(Z,$,F,Y,Q,O)}else if(6.2==s[M][_])if(k==h[M][_][0][1])T.moveTo(h[M][_][0][0],k),T.lineTo(N<h[M][_][0][0]?0:n[M].imgwidth,k);else if(N==h[M][_][0][0])T.moveTo(N,h[M][_][0][1]),k>h[M][_][0][1]?T.lineTo(N,n[M].imgheight):T.lineTo(N,0);else{j=(k-h[M][_][0][1])/((N-h[M][_][0][0])*(N-h[M][_][0][0])),h[M][_][0][0];if(k>h[M][_][0][1]){var K=Math.sqrt((n[M].imgheight-h[M][_][0][1])/j);H=n[M].imgheight}else K=Math.sqrt((0-h[M][_][0][1])/j),H=0;N<h[M][_][0][0]&&(K*=-1);var Z=h[M][_][0][0]+1/3*K,$=h[M][_][0][1];F=h[M][_][0][0]+2/3*K,Y=h[M][_][0][1]+1/3*j*K*K;T.moveTo(h[M][_][0][0],h[M][_][0][1]),T.bezierCurveTo(Z,$,F,Y,h[M][_][0][0]+K,H)}}else if(6.5==s[M][_]){k=null,N=null;if(2==h[M][_].length?(N=h[M][_][1][0],k=h[M][_][1][1]):f==_&&null!=t&&1==h[M][_].length&&(N=t,k=i),null!=N&&N!=h[M][_][0][0])if(k==h[M][_][0][1])T.moveTo(h[M][_][0][0],k),N>h[M][_][0][0]?T.lineTo(n[M].imgwidth,k):T.lineTo(0,k);else{var ee=N<h[M][_][0][0]?-1:1;j=(k-h[M][_][0][1])/Math.sqrt(ee*(N-h[M][_][0][0]));T.moveTo(h[M][_][0][0],h[M][_][0][1]),ne=h[M][_][0][0],te=h[M][_][0][1];do{ne+=3*ee,te=j*Math.sqrt(ee*(ne-h[M][_][0][0]))+h[M][_][0][1],T.lineTo(ne,te)}while(ne>0&&ne<n[M].imgwidth&&te>0&&te<n[M].imgheight)}}else if(6.3==s[M][_]){k=null,N=null;if(2==h[M][_].length?(N=h[M][_][1][0],k=h[M][_][1][1]):f==_&&null!=t&&1==h[M][_].length&&(N=t,k=i),null!=N&&N!=h[M][_][0][0])if(k==h[M][_][0][1])T.moveTo(0,k),T.lineTo(n[M].imgwidth,k);else{j=(k-h[M][_][0][1])/safepow(N-h[M][_][0][0],3);for(var te=0,ne=0;ne<n[M].imgwidth+4;ne+=1)(te=j*safepow(ne-h[M][_][0][0],3)+h[M][_][0][1])<-100&&(te=-100),te>n[M].imgheight+100&&(te=n[M].imgheight+100),0==ne?T.moveTo(ne,te):T.lineTo(ne,te)}}else if(6.6==s[M][_]){k=null,N=null;if(2==h[M][_].length?(N=h[M][_][1][0],k=h[M][_][1][1]):f==_&&null!=t&&1==h[M][_].length&&(N=t,k=i),null!=N&&N!=h[M][_][0][0])if(k==h[M][_][0][1])T.moveTo(0,k),T.lineTo(n[M].imgwidth,k);else for(j=(k-h[M][_][0][1])/safepow(N-h[M][_][0][0],1/3),te=0,ne=0;ne<n[M].imgwidth+4;ne+=1)(te=j*safepow(ne-h[M][_][0][0],1/3)+h[M][_][0][1])<-100&&(te=-100),te>n[M].imgheight+100&&(te=n[M].imgheight+100),0==ne?T.moveTo(ne,te):T.lineTo(ne,te)}else if(s[M][_]>=7&&s[M][_]<8){k=null,N=null;if(2==h[M][_].length?(N=h[M][_][1][0],k=h[M][_][1][1]):f==_&&null!=t&&1==h[M][_].length&&(N=t,k=i),null!=N&&(N!=h[M][_][0][0]||k!=h[M][_][0][1]))if(7==s[M][_]){var ie=Math.abs(N-h[M][_][0][0]),le=Math.abs(k-h[M][_][0][1]),oe=ie/n[M].pixperx,ae=le/n[M].pixpery,re=Math.sqrt(oe*oe+ae*ae);T.save(),T.beginPath();var de=re*n[M].pixperx,me=re*n[M].pixpery;T.translate(h[M][_][0][0]-de,h[M][_][0][1]-me),T.scale(de,me),T.arc(1,1,1,0,2*Math.PI,!1),T.restore()}else if(7.2==s[M][_]){de=Math.abs(N-h[M][_][0][0]),me=Math.abs(k-h[M][_][0][1]);(f==_||null!=b&&b.num==_)&&(T.strokeStyle="rgb(0,255,255)",T.lineWidth=1,T.dashedLine(N,k,N-2*(N-h[M][_][0][0]),k,5),T.dashedLine(N,k,N,k-2*(k-h[M][_][0][1]),5),T.dashedLine(N,k-2*(k-h[M][_][0][1]),N-2*(N-h[M][_][0][0]),k-2*(k-h[M][_][0][1]),5),T.dashedLine(N-2*(N-h[M][_][0][0]),k,N-2*(N-h[M][_][0][0]),k-2*(k-h[M][_][0][1]),5),T.lineWidth=2),T.strokeStyle="rgb(0,0,255)",T.save(),T.beginPath(),T.translate(h[M][_][0][0]-de,h[M][_][0][1]-me),T.scale(de,me),T.arc(1,1,1,0,2*Math.PI,!1),T.restore()}else if(7.4==s[M][_]){var ue=Math.abs(N-h[M][_][0][0]),ge=Math.abs(k-h[M][_][0][1]),ce=Math.abs(ge/ue);T.strokeStyle=x,T.dashedLine(h[M][_][0][0],h[M][_][0][1],n[M].imgwidth,h[M][_][0][1]+ce*(n[M].imgwidth-h[M][_][0][0])),T.dashedLine(h[M][_][0][0],h[M][_][0][1],n[M].imgwidth,h[M][_][0][1]-ce*(n[M].imgwidth-h[M][_][0][0])),T.dashedLine(h[M][_][0][0],h[M][_][0][1],0,h[M][_][0][1]-ce*h[M][_][0][0]),T.dashedLine(h[M][_][0][0],h[M][_][0][1],0,h[M][_][0][1]+ce*h[M][_][0][0]),(f==_||null!=b&&b.num==_)&&(T.strokeStyle="rgb(0,255,255)",T.lineWidth=1,T.dashedLine(N,k,N-2*(N-h[M][_][0][0]),k,5),T.dashedLine(N,k,N,k-2*(k-h[M][_][0][1]),5),T.dashedLine(N,k-2*(k-h[M][_][0][1]),N-2*(N-h[M][_][0][0]),k-2*(k-h[M][_][0][1]),5),T.dashedLine(N-2*(N-h[M][_][0][0]),k,N-2*(N-h[M][_][0][0]),k-2*(k-h[M][_][0][1]),5),T.lineWidth=2),T.beginPath(),T.strokeStyle="rgb(0,0,255)";for(ne=0;ne<n[M].imgwidth+4;ne+=3)(te=h[M][_][0][1]+Math.sqrt((Math.pow(ne-h[M][_][0][0],2)/(ue*ue)+1)*ge*ge))<-100&&(te=-100),te>n[M].imgheight+100&&(te=n[M].imgheight+100),0==ne?T.moveTo(ne,te):T.lineTo(ne,te);T.stroke(),T.beginPath();for(ne=0;ne<n[M].imgwidth+4;ne+=3)(te=h[M][_][0][1]-Math.sqrt((Math.pow(ne-h[M][_][0][0],2)/(ue*ue)+1)*ge*ge))<-100&&(te=-100),te>n[M].imgheight+100&&(te=n[M].imgheight+100),0==ne?T.moveTo(ne,te):T.lineTo(ne,te)}else if(7.5==s[M][_]){ge=Math.abs(N-h[M][_][0][0]),ue=Math.abs(k-h[M][_][0][1]),ce=Math.abs(ue/ge);T.strokeStyle=x,T.dashedLine(h[M][_][0][0],h[M][_][0][1],n[M].imgwidth,h[M][_][0][1]+ce*(n[M].imgwidth-h[M][_][0][0])),T.dashedLine(h[M][_][0][0],h[M][_][0][1],n[M].imgwidth,h[M][_][0][1]-ce*(n[M].imgwidth-h[M][_][0][0])),T.dashedLine(h[M][_][0][0],h[M][_][0][1],0,h[M][_][0][1]-ce*h[M][_][0][0]),T.dashedLine(h[M][_][0][0],h[M][_][0][1],0,h[M][_][0][1]+ce*h[M][_][0][0]),(f==_||null!=b&&b.num==_)&&(T.strokeStyle="rgb(0,255,255)",T.lineWidth=1,T.dashedLine(N,k,N-2*(N-h[M][_][0][0]),k,5),T.dashedLine(N,k,N,k-2*(k-h[M][_][0][1]),5),T.dashedLine(N,k-2*(k-h[M][_][0][1]),N-2*(N-h[M][_][0][0]),k-2*(k-h[M][_][0][1]),5),T.dashedLine(N-2*(N-h[M][_][0][0]),k,N-2*(N-h[M][_][0][0]),k-2*(k-h[M][_][0][1]),5),T.lineWidth=2),T.beginPath(),T.strokeStyle="rgb(0,0,255)";for(te=0;te<n[M].imgwidth+4;te+=3)(ne=h[M][_][0][0]+Math.sqrt((Math.pow(te-h[M][_][0][1],2)/(ue*ue)+1)*ge*ge))<-100&&(ne=-100),ne>n[M].imgwidth+100&&(ne=n[M].imgwidth+100),0==te?T.moveTo(ne,te):T.lineTo(ne,te);T.stroke(),T.beginPath();for(te=0;te<n[M].imgwidth+4;te+=3)(ne=h[M][_][0][0]-Math.sqrt((Math.pow(te-h[M][_][0][1],2)/(ue*ue)+1)*ge*ge))<-100&&(ne=-100),ne>n[M].imgwidth+100&&(ne=n[M].imgwidth+100),0==te?T.moveTo(ne,te):T.lineTo(ne,te)}}else if(8==s[M][_]){L=null,N=null,k=null;if(2==h[M][_].length?(N=h[M][_][1][0],k=h[M][_][1][1]):f==_&&null!=t&&1==h[M][_].length&&(N=t,k=i),null!=N){if(N!=h[M][_][0][0]){L=(k-h[M][_][0][1])/(N-h[M][_][0][0]);N<h[M][_][0][0]&&(L*=-1)}if(Math.abs(N-h[M][_][0][0])<1||Math.abs(L)>100)T.moveTo(h[M][_][0][0],h[M][_][0][1]),k>h[M][_][0][1]?T.lineTo(h[M][_][0][0],n[M].imgheight):T.lineTo(h[M][_][0][0],0);else{C=h[M][_][0][1]+L*h[M][_][0][0],W=h[M][_][0][1]+L*(n[M].imgwidth-h[M][_][0][0]);T.moveTo(0,C),T.lineTo(h[M][_][0][0],h[M][_][0][1]),T.lineTo(n[M].imgwidth,W)}}}else if(8.3==s[M][_]){k=null,N=null;if(2==h[M][_].length?(N=h[M][_][1][0],k=h[M][_][1][1]):f==_&&null!=t&&1==h[M][_].length&&(N=t,k=i),null!=N&&N!=h[M][_][0][0])if(k==h[M][_][0][1])T.moveTo(0,k),T.lineTo(n[M].imgwidth,k);else{var pe=n[M].ymax*n[M].pixpery+n[M].imgborder,fe=pe-h[M][_][0][1];if(fe*(be=pe-k)>0&&N!=h[M][_][0][0]){var ve=safepow(be/fe,1/(N-h[M][_][0][0]));j=be/safepow(ve,N);T.moveTo(h[M][_][0][0],h[M][_][0][1]);for(te=0,ne=0;ne<n[M].imgwidth+4;ne+=3)(te=pe-j*safepow(ve,ne))<-100&&(te=-100),te>n[M].imgheight+100&&(te=n[M].imgheight+100),0==ne?T.moveTo(ne,te):T.lineTo(ne,te)}}}else if(8.4==s[M][_]){k=null,N=null;if(2==h[M][_].length?(N=h[M][_][1][0],k=h[M][_][1][1]):f==_&&null!=t&&1==h[M][_].length&&(N=t,k=i),null!=N&&N!=h[M][_][0][0]&&k!=h[M][_][0][1]){var ye=-n[M].xmin*n[M].pixperx+n[M].imgborder,we=ye-h[M][_][0][0];if(we*(Ee=ye-N)>0&&k!=h[M][_][0][1]){ve=safepow(Ee/we,1/(k-h[M][_][0][1])),j=Ee/safepow(ve,k);T.moveTo(h[M][_][0][0],h[M][_][0][1]);for(te=0,te=0;te<n[M].imgheight+4;te+=3)(ne=ye-j*safepow(ve,te))<-100&&(ne=-100),ne>n[M].imgwidth+100&&(ne=n[M].imgwidth+100),0==te?T.moveTo(ne,te):T.lineTo(ne,te)}}}else if(8.5==s[M][_]){k=null,N=null,S=null,B=null;3==h[M][_].length?(N=h[M][_][1][0],k=h[M][_][1][1],B=h[M][_][2][0],S=h[M][_][2][1]):2==h[M][_].length?(N=h[M][_][1][0],k=h[M][_][1][1],B=t,S=i):f==_&&null!=t&&1==h[M][_].length&&(N=t,k=i);var xe=h[M][_][0][1];if(T.strokeStyle=x,T.dashedLine(5,xe,n[M].imgwidth,xe),T.beginPath(),T.strokeStyle="rgb(0,0,255)",null!=B&&B!=N)if(S==k)T.moveTo(0,S),T.lineTo(n[M].imgwidth,S);else{var be,Te=xe-S;if((be=xe-k)*Te>0&&B!=N){ve=safepow(Te/be,1/(B-N)),j=Te/safepow(ve,B);T.moveTo(N,k);for(te=0,ne=0;ne<n[M].imgwidth+4;ne+=3)(te=xe-j*safepow(ve,ne))<-100&&(te=-100),te>n[M].imgheight+100&&(te=n[M].imgheight+100),0==ne?T.moveTo(ne,te):T.lineTo(ne,te)}}}else if(8.6==s[M][_]){k=null,N=null,S=null,B=null;3==h[M][_].length?(N=h[M][_][1][0],k=h[M][_][1][1],B=h[M][_][2][0],S=h[M][_][2][1]):2==h[M][_].length?(N=h[M][_][1][0],k=h[M][_][1][1],B=t,S=i):f==_&&null!=t&&1==h[M][_].length&&(N=t,k=i);var Me=h[M][_][0][0];if(T.strokeStyle=x,T.dashedLine(Me,5,Me,n[M].imgheight),T.beginPath(),T.strokeStyle="rgb(0,0,255)",null!=B&&B!=N&&S!=k){var Ee,_e=B-Me;if((Ee=N-Me)*_e>0){ve=safepow(_e/Ee,1/(S-k)),j=_e/safepow(ve,S);T.moveTo(N,k);for(ne=0,te=0;te<n[M].imgheight+4;te+=3)(ne=Me+j*safepow(ve,te))<-100&&(ne=-100),ne>n[M].imgwidth+100&&(ne=n[M].imgwidth+100),0==te?T.moveTo(ne,te):T.lineTo(ne,te)}}}else if(8.2==s[M][_]){k=null,N=null;if(2==h[M][_].length?(N=h[M][_][1][0],k=h[M][_][1][1]):f==_&&null!=t&&1==h[M][_].length&&(N=t,k=i),T.strokeStyle=x,T.dashedLine(5,h[M][_][0][1],n[M].imgwidth,h[M][_][0][1]),T.dashedLine(h[M][_][0][0],5,h[M][_][0][0],n[M].imgheight),T.beginPath(),T.strokeStyle="rgb(0,0,255)",null!=N&&N!=h[M][_][0][0]&&k!=h[M][_][0][1]){for(j=(k-h[M][_][0][1])*(N-h[M][_][0][0]),ne=h[M][_][0][0]-1;ne>-4;ne-=3)(te=j/(ne-h[M][_][0][0])+h[M][_][0][1])<-100&&(te=-100),te>n[M].imgheight+100&&(te=n[M].imgheight+100),ne==h[M][_][0][0]-1?T.moveTo(ne,te):T.lineTo(ne,te);for(ne=h[M][_][0][0]+1;ne<n[M].imgwidth+4;ne+=3)(te=j/(ne-h[M][_][0][0])+h[M][_][0][1])<-100&&(te=-100),te>n[M].imgheight+100&&(te=n[M].imgheight+100),ne==h[M][_][0][0]+1?T.moveTo(ne,te):T.lineTo(ne,te);T.stroke()}}else if(9==s[M][_]||9.1==s[M][_]){k=null,N=null;if(2==h[M][_].length?(N=h[M][_][1][0],k=h[M][_][1][1]):f==_&&null!=t&&1==h[M][_].length&&(N=t,k=i),null!=N&&N!=h[M][_][0][0])if(k==h[M][_][0][1])T.moveTo(0,k),T.lineTo(n[M].imgwidth,k);else{if(9==s[M][_])var Ie=-1*Math.abs(k-h[M][_][0][1])/2,Le=(k+h[M][_][0][1])/2,Ne=(j=Math.PI/Math.abs(N-h[M][_][0][0]),k<h[M][_][0][1]?N:h[M][_][0][0]);else if(9.1==s[M][_])Ie=-1*Math.abs(k-h[M][_][0][1]),Le=h[M][_][0][1],j=.5*Math.PI/Math.abs(N-h[M][_][0][0]),Ne=k<h[M][_][0][1]?N:N+2*Math.abs(N-h[M][_][0][0]);for(te=0,ne=0;ne<n[M].imgwidth+4;ne+=3)te=Ie*Math.cos(j*(ne-Ne))+Le,0==ne?T.moveTo(ne,te):T.lineTo(ne,te)}}T.stroke(),T.beginPath()}var Be,Pe,qe,ke;null===f&&q.hasOwnProperty(n[M].mode)&&(T.strokeStyle="rgb(200,200,200)",8.5==n[M].mode?T.dashedLine(5,i,n[M].imgwidth,i):8.6==n[M].mode?T.dashedLine(t,5,t,n[M].imgwidth):8.2==n[M].mode?(T.dashedLine(5,i,n[M].imgwidth,i),T.dashedLine(t,5,t,n[M].imgheight)):7.4!=n[M].mode&&7.5!=n[M].mode||(T.dashedLine(t,i,n[M].imgwidth,i+(n[M].imgwidth-t)),T.dashedLine(t,i,n[M].imgwidth,i-(n[M].imgwidth-t)),T.dashedLine(t,i,0,i-t),T.dashedLine(t,i,0,i+t)),T.beginPath(),T.strokeStyle="rgb(0,0,255)"),T.fillStyle="rgba(0,0,255,.5)";for(_=0;_<a[M].length;_++){T.beginPath();for(U=0;U<a[M][_].length;U++)0==U?(T.moveTo(a[M][_][U][0],a[M][_][U][1]),Be=a[M][_][U][0],Pe=a[M][_][U][1]):(T.lineTo(a[M][_][U][0],a[M][_][U][1]),qe=a[M][_][U][0],ke=a[M][_][U][1]);_==g&&null!=t&&(T.lineTo(t,i),qe=t,ke=i);var Se=.02*n[M].imgwidth;if(1==p[M]&&qe>.98*n[M].imgwidth?(T.moveTo(qe,ke),T.lineTo(qe-Se,ke+Se),T.moveTo(qe,ke),T.lineTo(qe-Se,ke-Se)):1==p[M]&&Be>.98*n[M].imgwidth&&(T.moveTo(Be,Pe),T.lineTo(Be-Se,Pe+Se),T.moveTo(Be,Pe),T.lineTo(Be-Se,Pe-Se)),1==p[M]&&qe<.02*n[M].imgwidth?(T.moveTo(qe,ke),T.lineTo(qe+Se,ke+Se),T.moveTo(qe,ke),T.lineTo(qe+Se,ke-Se)):1==p[M]&&Be<.02*n[M].imgwidth&&(T.moveTo(Be,Pe),T.lineTo(Be+Se,Pe+Se),T.moveTo(Be,Pe),T.lineTo(Be+Se,Pe-Se)),T.stroke(),n[M].dotline>1){if(a[M][_].length-1<1)continue;if(Math.pow(qe-Be,2)+Math.pow(ke-Pe,2)<25){T.moveTo(a[M][_][0][0],a[M][_][0][1]);for(U=1;U<a[M][_].length;U++)T.lineTo(a[M][_][U][0],a[M][_][U][1]);T.closePath(),T.fill()}}}T.fillStyle="rgb(0,0,255)",T.beginPath();for(_=0;_<r[M].length;_++)T.moveTo(r[M][_][0]+5,r[M][_][1]),T.arc(r[M][_][0],r[M][_][1],5,0,2*Math.PI,!0);if(T.fill(),n[M].dotline>0){T.beginPath();for(_=0;_<a[M].length;_++)for(U=0;U<a[M][_].length;U++)(0==U||Math.pow(a[M][_][U][0]-a[M][_][U-1][0],2)+Math.pow(a[M][_][U][1]-a[M][_][U-1][1],2)>25)&&(T.moveTo(a[M][_][U][0]+5,a[M][_][U][1]),T.arc(a[M][_][U][0],a[M][_][U][1],5,0,2*Math.PI,!0));T.fill()}T.fillStyle="rgb(255,255,255)",T.beginPath();for(_=0;_<d[M].length;_++)T.moveTo(d[M][_][0]+5,d[M][_][1]),T.arc(d[M][_][0],d[M][_][1],4,0,2*Math.PI,!0);n[M].mode<3?T.fill():T.stroke(),T.lineWidth=2,T.beginPath();for(_=0;_<d[M].length;_++)T.moveTo(d[M][_][0]+5,d[M][_][1]),T.arc(d[M][_][0],d[M][_][1],4,0,2*Math.PI,!0);T.stroke();for(_=0;_<h[M].length;_++)if(s[M][_]==n[M].mode){T.fillStyle="rgb(255,0,0)";for(U=0;U<h[M][_].length;U++)T.fillRect(h[M][_][U][0]-3,h[M][_][U][1]-3,6,6);h[M][_].length<P[n[M].mode]&&null!=t&&f==_&&T.fillRect(t-3,i-3,6,6),T.fillStyle="rgb(0,0,255)"}!0!==c&&function(){for(var t="",i=[],l=0;l<a[M].length;l++){a[M][l].length;i=0==n[M].dotline?pathsimplify(a[M][l]):a[M][l],0!=l&&(t+=";");for(var g=0;g<i.length;g++)0!=g&&(t+=","),t+="("+z(i[g][0],4)+","+z(i[g][1],4)+")"}t+=";;";for(l=0;l<r[M].length;l++)0!=l&&(t+=","),t+="("+z(r[M][l][0],4)+","+z(r[M][l][1],4)+")";t+=";;";for(l=0;l<d[M].length;l++)0!=l&&(t+=","),t+="("+z(d[M][l][0],4)+","+z(d[M][l][1],4)+")";t+=";;";var c=[],p="";for(l=0;l<h[M].length;l++)if(h[M][l].length==P[s[M][l]]){p="("+s[M][l];for(g=0;g<h[M][l].length;g++)p+=","+z(h[M][l][g][0],4)+","+z(h[M][l][g][1],4);c.push(p+")")}t+=c.join(","),t+=";;";var f=[];for(l=0;l<m[M].length;l++)m[M][l].length>2&&f.push("("+u[M][l]+","+z(m[M][l][0][0],4)+","+z(m[M][l][0][1],4)+","+z(m[M][l][1][0],4)+","+z(m[M][l][1][1],4)+","+z(m[M][l][2][0],4)+","+z(m[M][l][2][1],4)+")");if(t+=f.join(","),o[M].value!=t){var v=""!=o[M].value||";;;;;;;;"!=t;o[M].value=t,v&&e(o[M]).trigger("input").trigger("change")}}()}function R(e,t){1==e?r[M].splice(t,1):2==e?d[M].splice(t,1):e>=0&&e<1?a[M].splice(t,1):e>=5&&e<10?(h[M].splice(t,1),s[M].splice(t,1),f=null):e>=10&&e<11&&(m[M].splice(t,1),u[M].splice(t,1),v=null),O()}function z(e,t){return Math.round(e)}function H(l){if($(),I&&l.originalEvent.touches.length>1)return L=!0,e(document).on("touchend.imathasdraw",U),!0;I?(window.clearTimeout(B),e(document).off("mousemove.imathasdraw"),e(".drawcanvas").on("touchstart.imathasdraw",(function(e){I=!0,H(e)})),e(".drawcanvas").on("touchmove.imathasdraw",V),e(document).on("touchend.imathasdraw",U),e(document).on("touchcancel.imathasdraw",U)):(e(document).on("mousemove.imathasdraw",V),e(document).on("mouseup.imathasdraw",U));var c=J(l);if(null==M||null==g&&null==f&&null==v)for(i in n){if(!e(n[i].el).is(":hidden")&&"canvas"==n[i].type)if((y=Z(n[i].el)).x<c.x&&y.x+n[i].width>c.x&&y.y<c.y&&y.y+n[i].height>c.y&&l.target==n[i].el){M=i;break}}if(null!=M){if(o[M].disabled)return;l.preventDefault(),t=!0;var y=Z(n[M].el),w={x:c.x-y.x,y:c.y-y.y};if(w.x>-1&&w.x<n[M].width&&w.y>-1&&w.y<n[M].height){n[M].snaptogridx>0&&(w=Q(w,M)),1==p[M]&&(w.y=n[M].imgheight/2);var x=F(M,w);if(null!=x){if(-1==n[M].mode)return void R(x[0],x[1]);(null!=g&&x[0]<1&&g!=x[1]||null!=f&x[0]>=5&&x[0]<10&&f!=x[1]||null!=v&&x[0]>=10&&x[0]<11&&v!=x[1])&&(x=null)}null==x?(G("pendown"),1==n[M].mode?(r[M].push([w.x,w.y]),b={mode:1,num:r[M].length-1}):2==n[M].mode?(d[M].push([w.x,w.y]),b={mode:2,num:d[M].length-1}):0==n[M].mode||.7==n[M].mode?null==g?(a[M].push([[w.x,w.y]]),g=a[M].length-1):a[M][g].push([w.x,w.y]):.5==n[M].mode?null==g?(a[M].push([[w.x,w.y]]),g=a[M].length-1):(a[M][g].push([w.x,w.y]),g=null,b=null):n[M].mode>=5&&n[M].mode<10?null==f?(h[M].push([[w.x,w.y]]),f=h[M].length-1,s[M][f]=n[M].mode,t=!1):(h[M][f].push([w.x,w.y]),h[M][f].length==P[n[M].mode]?(b={mode:n[M].mode,num:f,subnum:P[n[M].mode]-1},f=null):t=!1):n[M].mode>=10&&n[M].mode<11&&(null==v?(m[M].push([[w.x,w.y]]),v=m[M].length-1,u[M][v]=n[M].mode,t=!1):(m[M][v].push([w.x,w.y]),2==m[M][v].length?b={mode:n[M].mode,num:v,subnum:1}:3==m[M][v].length&&(b={mode:n[M].mode,num:v,subnum:2},v=null)))):0==x[0]||.5==x[0]?null==g?(G("move"),b={mode:n[M].mode,num:x[1],subnum:x[2]},T=a[M][x[1]][x[2]],x[2]==a[M][x[1]].length-1&&0==n[M].mode?g=x[1]:0==x[2]&&0==n[M].mode&&(g=x[1],a[M][g].reverse(),b.subnum=a[M][g].length-1),N=!0):x[1]==g&&x[2]==a[M][x[1]].length-1?(a[M][g].length<2&&a[M].splice(g,1),g=null):n[M].dotline>1&&x[1]==g&&0==x[2]?(a[M][g].push(a[M][g][0]),g=null):(G("pendown"),a[M][g].push([w.x,w.y])):1==x[0]?(G("move"),b={mode:1,num:x[1]}):2==x[0]?(G("move"),b={mode:2,num:x[1]}):x[0]>=5&&x[0]<10?null==f&&(G("move"),b={mode:x[0],num:x[1],subnum:x[2]},T=h[M][x[1]][x[2]],N=!0):x[0]>=10&&x[0]<11&&null==v&&(G("move"),b={mode:x[0],num:x[1],subnum:x[2]},T=m[M][x[1]][x[2]],N=!0),O()}else null!=g&&(a[M][g].length<2&&a[M].splice(g,1),G("pen")),null!=f&&(h[M][f].length<P[n[M].mode]&&(h[M].splice(f,1),s[M].splice(f,1)),G("pen")),null!=v&&(m[M][v].length<3&&(m[M].splice(v,1),u[M].splice(v,1)),G("pen")),g=null,f=null,v=null,b=null,O(),M=null}}function F(e,t){if(I){var i=Math.max(15*window.innerWidth/screen.width,15);i*=i}else if(-1==n[e].mode)i=50;else i=25;if(0==n[e].mode||.5==n[e].mode||-1==n[e].mode)for(var l=a[e].length-1;l>=0;l--)for(var o=a[e][l].length-1;o>=0;o--){if(Math.pow(a[e][l][o][0]-t.x,2)+Math.pow(a[e][l][o][1]-t.y,2)<i)return[-1==n[e].mode?0:n[e].mode,l,o]}if(1==n[e].mode||-1==n[e].mode)for(l=r[e].length-1;l>=0;l--)if(Math.pow(r[e][l][0]-t.x,2)+Math.pow(r[e][l][1]-t.y,2)<i)return[1,l];if(2==n[e].mode||-1==n[e].mode)for(l=d[e].length-1;l>=0;l--)if(Math.pow(d[e][l][0]-t.x,2)+Math.pow(d[e][l][1]-t.y,2)<i)return[2,l];if(n[e].mode>=5&&n[e].mode<10||-1==n[e].mode)for(l=h[e].length-1;l>=0;l--)for(o=h[e][l].length-1;o>=0;o--){if(s[e][l]==n[e].mode||-1==n[e].mode)if(Math.pow(h[e][l][o][0]-t.x,2)+Math.pow(h[e][l][o][1]-t.y,2)<i)return[s[e][l],l,o]}if(n[e].mode>=10&&n[e].mode<11||-1==n[e].mode)for(l=m[e].length-1;l>=0;l--)for(o=m[e][l].length-1;o>=0;o--){if(u[e][l]==n[e].mode||-1==n[e].mode)if(Math.pow(m[e][l][o][0]-t.x,2)+Math.pow(m[e][l][o][1]-t.y,2)<i)return[u[e][l],l,o]}return null}var Y=null;function U(i){var l=J(i);if(t=!1,null!=M){if(o[M].disabled)return;var c=Z(n[M].el),y={x:l.x-c.x,y:l.y-c.y};n[M].snaptogridx>0&&(y=Q(y,M));var w=y.x>-1&&y.x<n[M].width&&y.y>-1&&y.y<n[M].height;1==N&&(n[M].mode>=5&&n[M].mode<10?(h[M].push([[y.x,y.y]]),f=h[M].length-1,s[M][f]=n[M].mode):n[M].mode>=10&&n[M].mode<11&&(m[M].push([[y.x,y.y]]),v=m[M].length-1,u[M][v]=n[M].mode)),null!=Y&&l.x==Y.x&&l.y==Y.y&&null!=g&&null==b&&(a[M][g].length<2&&a[M].splice(g,1),g=null,b=null,O()),null!=g&&null==b&&(.5==n[M].mode&&a[M][g].length>1||.7==n[M].mode)&&(g=null,dragobj=null,O()),null!=f&&h[M][f].length<P[n[M].mode]&&(L||!w?(h[M].splice(f,1),s[M].splice(f,1),f=null,O()):null==F(M,y)&&(h[M][f].push([y.x,y.y]),h[M][f].length==P[n[M].mode]&&(f=null),O())),null!=v&&1==m[M][v].length&&(L||!w?(m[M].splice(v,1),u[M].splice(v,1),v=null,O()):null==F(M,y)&&(m[M][v].push([y.x,y.y]),O())),G(null==g&&null==f?"move":"pen"),void 0!==i&&i.preventDefault()}if(Y=l,null!=M&&null!=b){c=Z(n[M].el);y.x>-1&&y.x<n[M].width&&y.y>-1&&y.y<n[M].height?(0==b.mode&&n[M].dotline>1&&(0!=b.subnum&&b.subnum!=a[M][b.num].length-1||Math.pow(a[M][b.num][0][0]-a[M][b.num][a[M][b.num].length-1][0],2)+Math.pow(a[M][b.num][0][1]-a[M][b.num][a[M][b.num].length-1][1],2)<25&&(0==b.subnum?(a[M][b.num][a[M][b.num].length-1][0]=a[M][b.num][0][0],a[M][b.num][a[M][b.num].length-1][1]=a[M][b.num][0][1]):(a[M][b.num][0][0]=a[M][b.num][a[M][b.num].length-1][0],a[M][b.num][0][1]=a[M][b.num][a[M][b.num].length-1][1]),g=null,O())),b=null):(1==p[M]&&(y.y=n[M].imgheight/2),1==b.mode?r[M].splice(b.num,1):2==b.mode?d[M].splice(b.num,1):.5==b.mode?a[M].splice(b.num,1):0==b.mode?a[M][b.num][b.subnum]=T:b.mode>=5&&b.mode<10?(h[M].splice(b.num,1),s[M].splice(b.num,1),f=null):b.mode>=10&&b.mode<11&&(m[M].splice(b.num,1),u[M].splice(b.num,1),v=null),b=null,O())}L=!1,I?B=window.setTimeout((function(){I=!1,$(),e(document).on("mousemove.imathasdraw",V),e(".drawcanvas").on("touchstart.imathasdraw",(function(e){I=!0,H(e)})),e(document).on("mousedown.imathasdraw",H)}),350):($(),e(document).on("mousemove.imathasdraw",V),e(".drawcanvas").on("touchstart.imathasdraw",(function(e){I=!0,H(e)})),e(document).on("mousedown.imathasdraw",H))}var X=-1;function V(l){var s=null;N=!1;var u=J(l);for(i in n){if(!e(n[i].el).is(":hidden")&&"canvas"==n[i].type)if((c=Z(n[i].el)).x<u.x&&c.x+n[i].width>u.x&&c.y<u.y&&c.y+n[i].height>u.y&&l.target==n[i].el){s=i;break}}if(null!=s){if(o[s].disabled)return;X=s;var c=Z(n[s].el),y={x:u.x-c.x,y:u.y-c.y};if(n[s].snaptogridx>0&&(y=Q(y,s)),1==p[s]&&(y.y=n[s].imgheight/2),y.x>-1&&y.x<n[s].width&&y.y>-1&&y.y<n[s].height)if(null==b)if(null==g)null==(x=F(s,y))?G("pen",s):-1!=n[s].mode&&G("move",s)}else null!=X&&-1!=X&&(null!=M?O():(M=X,O(),M=null),X=-1);if(null!=M){if(l.originalEvent.touches&&l.originalEvent.touches.length>1)return L=!0,!0;void 0!==l&&l.preventDefault();c=Z(n[M].el),y={x:u.x-c.x,y:u.y-c.y};if(n[M].snaptogridx>0&&(y=Q(y,M)),1==p[M]&&(y.y=n[M].imgheight/2),y.x>-1&&y.x<n[M].width&&y.y>-1&&y.y<n[M].height){if(null==b){if(t&&-1==n[M].mode)return void(null!=(x=F(M,y))&&R(x[0],x[1]));if(null!=g)if(!t||0!=n[M].mode&&.7!=n[M].mode)if(t&&.5==n[M].mode){if(0==(w=a[M][g].length-1))Math.pow(a[M][g][w][0]-y.x,2)+Math.pow(a[M][g][w][1]-y.y,2)>25?(a[M][g].push([y.x,y.y]),O()):O(y.x,y.y);else a[M][g][w]=[y.x,y.y],O()}else O(y.x,y.y);else{var w=a[M][g].length-1;Math.pow(a[M][g][w][0]-y.x,2)+Math.pow(a[M][g][w][1]-y.y,2)>25?(a[M][g].push([y.x,y.y]),O()):O(y.x,y.y)}else if(null!=f)t?O():O(y.x,y.y);else if(null!=v)t?O():O(y.x,y.y);else{var x;null==(x=F(M,y))?(G("pen"),q.hasOwnProperty(n[M].mode)&&null!==s&&O(y.x,y.y)):(O(),-1!=n[M].mode&&G("move"))}}else G("move"),0==b.mode||.5==b.mode?a[M][b.num][b.subnum]=[y.x,y.y]:1==b.mode?r[M][b.num]=[y.x,y.y]:2==b.mode?d[M][b.num]=[y.x,y.y]:b.mode>=5&&b.mode<10?h[M][b.num][b.subnum]=[y.x,y.y]:b.mode>=10&&b.mode<11&&(m[M][b.num][b.subnum]=[y.x,y.y]),O();return!1}null==v||t||O()}else null!=s&&-1!=X&&(M=s,q.hasOwnProperty(n[M].mode)&&O(y.x,y.y),M=null)}function G(e,t){n[t=t||M].cursor!=e&&("move"==e?n[t].el.style.cursor=e:"pen"==e?n[t].el.style.cursor="url("+staticroot+"/img/penup.svg) 0 0, auto":"pendown"==e&&(n[t].el.style.cursor="url("+staticroot+"/img/pendown.svg) 0 20, auto"),n[t].cursor=e)}function J(e){if(e=e||window.event,I){var t=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0];return{x:t.pageX,y:t.pageY}}if(e.pageX||e.pageY)return{x:e.pageX,y:e.pageY};var n=document.documentElement,i=document.body;if(n&&(n.scrollTop||n.scrollLeft))var l=n.scrollLeft,o=n.scrollTop;else if(i)l=i.scrollLeft,o=i.scrollTop;else l=0,o=0;return{x:e.clientX+l,y:e.clientY+o}}function Q(e,t){var i=e.x-n[t].imgborder+n[t].xmin*n[t].pixperx,l=e.y-n[t].imgborder-n[t].ymax*n[t].pixpery;return{x:i=Math.round(Math.round(i/(n[t].pixperx*n[t].snaptogridx))*n[t].pixperx*n[t].snaptogridx+n[t].imgborder-n[t].xmin*n[t].pixperx),y:l=Math.round(Math.round(l/(n[t].pixpery*n[t].snaptogridy))*n[t].pixpery*n[t].snaptogridy+n[t].imgborder+n[t].ymax*n[t].pixpery)}}function K(e,t){var n=Z(e),i=J(t);return{x:i.x-n.x,y:i.y-n.y}}function Z(t){if(t.className.match(/hidden/))return{x:-1e4,y:-1e4};var n=e(t).offset();return{x:n.left,y:n.top}}function $(){e(document).off("mousedown.imathasdraw").off("mousemove.imathasdraw").off("mouseup.imathasdraw"),e(document).off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw"),e(".drawcanvas").off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw")}function ee(t){$(),e(document).on("mousemove.imathasdraw",V),e(".drawcanvas").on("touchstart.imathasdraw",(function(e){I=!0,H(e)})),e(document).on("mousedown.imathasdraw",H);try{CanvasRenderingContext2D.prototype.dashedLine=function(e,t,i,l,o){null==o&&(o=10),t<0&&t!=l?(e-=t*(i-e)/(l-t),t=0):t>n[M].imgheight&&t!=l&&(e+=(n[M].imgheight-t)*(i-e)/(l-t),t=n[M].imgheight),this.beginPath(),this.moveTo(e,t);var a=i-e,r=l-t,d=Math.sqrt(a*a+r*r)/o,h=a/d,s=r/d;d=Math.floor(d);for(var m=0;m++<d&&t>-1&&t<n[M].imgheight+1&&e>-1&&e<n[M].imgwidth+1;)e+=h,t+=s,this[m%2==0?"moveTo":"lineTo"](e,t);this[m%2==0?"moveTo":"lineTo"](i,l),this.stroke(),this.closePath()}}catch(e){}for(var i in canvases)if(void 0===t||t==i){var l=null;if(null!=drawla[i]&&drawla[i].length>2){if(a[canvases[i][0]]=drawla[i][0],r[canvases[i][0]]=drawla[i][1],d[canvases[i][0]]=drawla[i][2],s[canvases[i][0]]=[],h[canvases[i][0]]=[],drawla[i].length>3&&drawla[i][3].length>0)for(var o=0;o<drawla[i][3].length;o++){s[canvases[i][0]][o]=drawla[i][3][o][0],h[canvases[i][0]][o]=[];for(var g=0;g<P[s[canvases[i][0]][o]];g++)h[canvases[i][0]][o].push(drawla[i][3][o].slice(1+2*g,3+2*g))}if(u[canvases[i][0]]=[],m[canvases[i][0]]=[],drawla[i].length>4&&drawla[i][4].length>0)for(o=0;o<drawla[i][4].length;o++)u[canvases[i][0]][o]=drawla[i][4][o][0],m[canvases[i][0]][o]=[drawla[i][4][o].slice(1,3),drawla[i][4][o].slice(3,5),drawla[i][4][o].slice(5)];drawla[i].length>5&&(l=drawla[i][5])}else null!=drawla[i]&&"[[]]"==JSON.stringify(drawla[i])&&k(canvases[i][0],!0);var c="";canvases[i][1].match(/initPicture/)?c=canvases[i][1]:""!==canvases[i][1]&&(c=imasroot+"/filter/graph/imgs/"+canvases[i][1]),""!==canvases[i][13]?S(canvases[i],l,c):j(canvases[i][0],"canvas"+canvases[i][0],c,"qn"+canvases[i][0],canvases[i][2],canvases[i][3],canvases[i][4],canvases[i][5],canvases[i][6],canvases[i][7],canvases[i][8],canvases[i][9],canvases[i][10],canvases[i][11],canvases[i][12])}}"undefined"!=typeof initstack?initstack.push(ee):e((function(){ee()}));var te={idnums:[],curslider:{el:null,startpos:[0,0],outnode:null}};function ne(t){for(var n,i=0;i<te.idnums.length;i++)void 0!==t&&t!=te.idnums[i]||(ie(n=te.idnums[i]),e("#slid1"+n).on("touchstart.normslider mousedown.normslider",le),e("#slid2"+n).on("touchstart.normslider mousedown.normslider",le))}function ie(e){var t,n,i,l,o=document.getElementById("qn"+e).value;(l=o.match(/\(-oo,([\-\d\.]+)\)U\(([\-\d\.]+),oo\)/))?(t=3,n=l[1],i=l[2]):(l=o.match(/\(-oo,([\-\d\.]+)\)/))?(t=0,n=l[1],i=2.5):(l=o.match(/\(([\-\d\.]+),oo\)/))?(t=1,n=l[1],i=2.5):(l=o.match(/\(([\-\d\.]+),([\-\d\.]+)\)/))?(t=2,n=l[1],i=l[2]):(t=0,n=-1.5,i=2.5),document.getElementById("slid1"+e).style.left=60*n+250-6+"px",document.getElementById("slid2"+e).style.left=60*i+250-6+"px",document.getElementById("shaderegions"+e).selectedIndex=t,te.curslider.type=document.getElementById("shaderegions"+e).value,de(e)}function le(t){(t=t||window.event).originalEvent.touches&&t.originalEvent.touches.length>0?(I=!0,e(document).on("touchmove.normslider",oe),e(document).on("touchend.normslider",ae)):(e(document).on("mousemove.normslider",oe),e(document).on("mouseup.normslider",ae)),te.curslider.el=t.target||t.srcElement,te.curslider.id=te.curslider.el.id.substring(5),te.curslider.type=document.getElementById("shaderegions"+te.curslider.id).value,te.curslider.outnode=document.getElementById(te.outputid),te.curslider.startpos=K(te.curslider.el,t),te.curslider.el.parentNode.style.cursor="pointer";Z(te.curslider.el.parentNode);return t.preventDefault&&t.preventDefault(),!1}function oe(e){var t=te.curslider.id;e=e||window.event;var n=K(te.curslider.el.parentNode,e);if(!(n.x<5||n.x>te.curslider.el.parentNode.offsetWidth-5||n.y<5||n.y>te.curslider.el.parentNode.offsetHeight-5)){var i=6*Math.round((n.x-te.curslider.startpos.x-10)/6)+10;return te.curslider.el.style.left=i+"px",re(t),e.preventDefault&&e.preventDefault(),!1}}function ae(t){null!==te.curslider.el&&(I=!1,e(document).off("touchmove.normslider touchend.normslider"),e(document).off("mousemove.normslider mouseup.normslider"),te.curslider.el.parentNode.style.cursor="",te.curslider.el=null)}function re(t){var n=parseInt(document.getElementById("slid1"+t).style.left)+6,i=parseInt(document.getElementById("slid2"+t).style.left)+6,l=Math.min(n,i),o=Math.max(n,i);"2O"==te.curslider.type?document.getElementById("normleft"+t).style.width=l+1+"px":"1L"==te.curslider.type?document.getElementById("normleft"+t).style.width=n+1+"px":"2B"==te.curslider.type&&(document.getElementById("normleft"+t).style.left=l+"px",document.getElementById("normleft"+t).style.width=o-l+1+"px"),"2O"==te.curslider.type?document.getElementById("normright"+t).style.width=500-o+"px":"1R"==te.curslider.type&&(document.getElementById("normright"+t).style.width=500-n+"px");var a=((n-10)/60-4).toFixed(1),r=((i-10)/60-4).toFixed(1),d=document.getElementById("slid1txt"+t);d.innerHTML=a,d.style.left=n-6+"px";var h=document.getElementById("slid2txt"+t);h.innerHTML=r,h.style.left=i-6+"px";var s=Math.min(a,r),m=Math.max(a,r);if("2O"==te.curslider.type)var u="(-oo,"+s+")U("+m+",oo)";else if("2B"==te.curslider.type)u="("+s+","+m+")";else if("1L"==te.curslider.type)u="(-oo,"+a+")";else if("1R"==te.curslider.type)u="("+a+",oo)";document.getElementById("qn"+t).value=u,e("#qn"+t).trigger("input").trigger("change")}function de(e){var t=document.getElementById("shaderegions"+e).value;te.curslider.type=t;var n=parseInt(document.getElementById("slid1"+e).style.left)+6,i=parseInt(document.getElementById("slid2"+e).style.left)+6,l=Math.min(n,i),o=Math.max(n,i);"1R"==t||"1L"==t?(document.getElementById("slid2"+e).style.display="none",document.getElementById("slid2txt"+e).style.display="none","1R"==t?(document.getElementById("normleft"+e).style.display="none",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normright"+e).style.width=500-n+"px"):(document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.display="",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normleft"+e).style.width=n+"px")):"2O"==t?(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normright"+e).style.width=500-o+"px",document.getElementById("normleft"+e).style.width=l+"px"):"2B"==t&&(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.left=l+"px",document.getElementById("normleft"+e).style.width=o-l+"px"),re(e)}function he(e,t,n,i,l,o,a){if(l==n)e.moveTo(0,l),e.dashedLine(0,l,o,l);else{var r=(l-n)/((i-t)*(i-t)),d=-2*r*t,h=0;l>n&&(h=a);var s=r*t*t+n-h,m=Math.sqrt(d*d-4*r*s),u=(-d-m)/(2*r),g=(-d+m)/(2*r);s+=h;if(g<u){var c=u;u=g,g=c}for(var p=t,f=n,v=0;p>u-5&&p>-5;)v%2==0?e.moveTo(p,f):e.lineTo(p,f),f=r*(p-=Math.min(Math.sqrt(64/(1+Math.pow(2*r*(p-t),2))),Math.sqrt(8/Math.abs(r))))*p+d*p+s,v++;for(p=t,f=n,v=0;p<g+5&&p<o+5;)v%2==0?e.moveTo(p,f):e.lineTo(p,f),f=r*(p+=Math.min(Math.sqrt(64/(1+Math.pow(2*r*(p-t),2))),Math.sqrt(8/Math.abs(r))))*p+d*p+s,v++}e.stroke()}function se(e,t,n,i,l,o,a,r,d){if(e.beginPath(),l==n)e.moveTo(0,l),e.lineTo(r,l),a<n?(e.lineTo(r,0),e.lineTo(0,0)):(e.lineTo(r,d),e.lineTo(0,d));else{var h=(l-n)/((i-t)*(i-t)),s=-2*h*t,m=0;l>n&&(m=d);var u=h*t*t+n-m,g=Math.sqrt(s*s-4*h*u),c=(-s-g)/(2*h),p=h*c*c+s*c+(u+=m),f=(-s+g)/(2*h),v=p;if(f<c){var y=c;c=f,f=y}var w=2*h*(c-t),x=p-w*c,b=-w,T=(x-(v-b*f))/(b-w),M=w*T+x;if(h<0&&a<h*o*o+s*o+u||h>0&&a>h*o*o+s*o+u)e.moveTo(c,p),e.quadraticCurveTo(T,M,f,v);else{var E=d;Math.abs(p-d)<2&&(E=0),e.moveTo(0,p),e.lineTo(c,p),e.quadraticCurveTo(T,M,f,v),e.lineTo(r,v),e.lineTo(r,E),e.lineTo(0,E)}}e.closePath()}return"undefined"!=typeof initstack&&initstack.push(ne),{reset:function(){$(),n.length=0,l.length=0,o.length=0,a.length=0,r.length=0,d.length=0,h.length=0,s.length=0,m.length=0,u.length=0,c.length=0,p.length=0,M=null,g=null,b=null,f=null,v=null},initCanvases:ee,clearcanvas:k,clearlastline:function(e){a[e].length>0&&(a[e].length=a[e].length-1),M=e,O(),M=null,g=null,b=null},settool:function(e,t,i){for(var l=document.getElementById("drawtools"+t),o=l.getElementsByTagName("span"),a=0;a<o.length;a++)o[a].className="";for(o=l.getElementsByTagName("img"),a=0;a<o.length;a++)o[a].className="";e.className="sel",function(e,t){n[e].mode=t}(t,i),M=t,O()},addnormslider:function(e,t){-1==arraysearch(e,te.idnums)?(te.idnums.push(e),!0===t&&ne(e)):ne(e)},chgnormtype:de,adda11ydraw:A,changea11ydraw:function(t,i){var l=e(t).val(),o=n[i].moderef[l];e(t).closest("li").find(".a11ydrawinstr").text(o.input),W()},encodea11ydraw:W,updatea11ydraw:function(t){var n=0,i=t.value.trim();"("==i.charAt(0)&&")"==i.slice(-1)||(n|=1);var l=i.slice(1,-1).split(/\)\s*,\s*\(/),o=t.getAttribute("data-n");o.match(/\d/)&&l.length!=parseInt(o)&&(n|=2);for(var a=0;a<l.length;a++){var r=l[a].split(/,/);2!=r.length&&(n|=1);for(var d=0;d<r.length;d++)0==r[d].trim().length&&(n|=1)}if("noticetext"==t.parentNode.parentNode.lastChild.className&&t.parentNode.parentNode.removeChild(t.parentNode.parentNode.lastChild),n){t.setAttribute("aria-invalid",!0);var h=document.createElement("span");h.id=uniqid("a11ydrawerr"),h.className="noticetext",1&~n?(h.innerHTML="<br>"+_("Error: Incorrect number of points. Expecting ")+o,setariastatus(_("Error: Incorrect number of points"))):(h.innerHTML="<br>"+_("Error: Invalid format for points. Give points as open parenthesis number comma number close parenthesis. Separate points with a comma."),setariastatus(_("Error: Invalid format for points"))),t.parentNode.parentNode.appendChild(h),t.setAttribute("aria-describedby",h.id)}else t.removeAttribute("aria-invalid"),t.removeAttribute("aria-describedby"),setariastatus("");W(parseInt(e(t).closest(".a11ydraw").attr("id").substring(8)))},removea11ydraw:function(t){setariastatus(_("Removed drawing element"));var n=e(t).closest("ul");e(t).parent().remove(),n.find("li").each((function(t,n){var i=_("Drawing element ")+(t+1);e(n).find(".draweln").html(i)})),n.prev().focus(),W(n.attr("id").substring(8))}}}(jQuery);!function(){"use strict";function e(e,t,n){var i=t[0],l=t[1],o=n[0]-i,a=n[1]-l;if(0!==o||0!==a){var r=((e[0]-i)*o+(e[1]-l)*a)/(o*o+a*a);r>1?(i=n[0],l=n[1]):r>0&&(i+=o*r,l+=a*r)}return(o=e[0]-i)*o+(a=e[1]-l)*a}function t(n,i,l,o,a){for(var r,d=o,h=i+1;h<l;h++){var s=e(n[h],n[i],n[l]);s>d&&(r=h,d=s)}d>o&&(r-i>1&&t(n,i,r,o,a),a.push(n[r]),l-r>1&&t(n,r,l,o,a))}function n(e,n){var i=e.length-1,l=[e[0]];return t(e,0,i,n,l),l.push(e[i]),l}window.pathsimplify=function(e,t,i){if(e.length<=2)return e;var l=void 0!==t?t*t:1;return e=n(e=i?e:function(e,t){for(var n,i,l,o,a,r=e[0],d=[r],h=1,s=e.length;h<s;h++)n=e[h],l=r,o=void 0,a=void 0,o=(i=n)[0]-l[0],a=i[1]-l[1],o*o+a*a>t&&(d.push(n),r=n);return r!==n&&d.push(n),d}(e,l),l)}}();
var ehcurel=null,ehclosetimer=0,ehddclosetimer=0,curehdd=null,eecurel=null;function showeh(e){if(null==eecurel){unhideeh(0);var t=document.getElementById(e),l=document.getElementById("eh");if(e!=ehcurel){ehcurel=e;var d=jQuery(t).offset();l.style.display="block",l.style.left=d.left+"px",l.style.top=d.top+t.offsetHeight+"px",document.getElementById("ehdd").style.display="none"}else l.style.display="none",ehcurel=null;e.match(/mqinput/)?MQ(t).focus():t.focus()}}function reshrinkeh(e){null==eecurel&&e==ehcurel&&(document.getElementById("ehdd").style.display="block",document.getElementById("eh").style.display="none",ehcurel=null,curehdd=e,unhideeh(0))}function unhideeh(e){ehcancelclosetimer()}function hideeh(e){null==ehcurel?ehddclosetimer=window.setTimeout((function(){curehdd=null,document.getElementById("ehdd").style.display="none"}),250):ehclosetimer=window.setTimeout(reallyhideeh,250)}function reallyhideeh(){document.getElementById("eh").style.display="none",ehcurel=null}function ehcancelclosetimer(){ehclosetimer&&(window.clearTimeout(ehclosetimer),ehclosetimer=null)}function hideAllEhTips(){ehclosetimer&&(window.clearTimeout(ehclosetimer),ehclosetimer=null),ehddclosetimer&&(window.clearTimeout(ehddclosetimer),ehddclosetimer=null),curehdd=null,document.getElementById("ehdd").style.display="none",document.getElementById("eh").style.display="none"}function showehdd(e,t,l){if((null==eecurel||eecurel!=e)&&null!=document.getElementById("tips"+l)){if(ehddclosetimer&&e!=curehdd&&(window.clearTimeout(ehddclosetimer),ehddclosetimer=null),e!=ehcurel){var d=document.getElementById("ehdd"),n=document.getElementById(e),o=jQuery(n).offset();document.getElementById("ehddtext").innerHTML=t,document.getElementById("eh").innerHTML=document.getElementById("tips"+l).innerHTML,d.style.display="block",d.style.left=o.left+"px",d.style.top=o.top+n.offsetHeight+"px"}curehdd=e}}function updateehpos(){if(curehdd||ehcurel){var e=document.getElementById("eh"),t=document.getElementById("ehdd"),l=document.getElementById(curehdd||ehcurel),d=jQuery(l).offset();e.style.left=d.left+"px",e.style.top=d.top+l.offsetHeight+"px",t.style.left=d.left+"px",t.style.top=d.top+l.offsetHeight+"px"}}
