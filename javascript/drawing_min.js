var canvases=new Array,drawla=new Array,imathasDraw=function($){var clickcnt,lastdrawmouseup,mouseintarget,normslider,drawexport,mouseisdown=!1,targets=new Array,imgs=new Array,targetOuts=new Array,a11ytargets=new Array,lines=new Array,dots=new Array,odots=new Array,tplines=new Array,tptypes=new Array,ineqlines=new Array,ineqtypes=new Array,curLine=null,drawstyle=[],drawlocky=[],curTPcurve=null,curIneqcurve=null,ineqcolors=["rgb(0,0,255)","rgb(255,0,0)","rgb(0,255,0)"],ineqacolors=["rgba(0,0,255,.4)","rgba(255,0,0,.4)","rgba(0,255,0,.4)"],asymcolor="rgb(0,200,0)",dragObj=null,oldpointpos=null,curTarget=null,curCursor=null,nocanvaswarning=!1,hasTouch=!1,didMultiTouch=!1,clickmightbenewcurve=!1,hasTouchTimer=null,tpModeN={5:2,5.2:2,5.3:2,5.4:2,6:2,6.1:2,6.3:2,6.5:2,6.6:2,7:2,7.2:2,7.4:2,7.5:2,8:2,8.2:2,8.3:2,8.4:2,8.5:3,8.6:3,9:2,9.1:2,10:3,10.2:3,10.3:3,10.4:3},tpHasAsymp={7.4:1,7.5:1,8.2:1,8.5:1,8.6:1};function reset(){clearAllDrawListners(),targets.length=0,imgs.length=0,targetOuts.length=0,a11ytargets.length=0,lines.length=0,dots.length=0,odots.length=0,tplines.length=0,tptypes.length=0,ineqlines.length=0,ineqtypes.length=0,drawstyle.length=0,drawlocky.length=0,curIneqcurve=curTPcurve=dragObj=curLine=curTarget=null}function clearcanvas(e){lines[e].length=0,dots[e].length=0,odots[e].length=0,tplines[e].length=0,tptypes[e].length=0,ineqlines[e].length=0,ineqtypes[e].length=0,curTarget=e,drawTarget(),dragObj=curLine=curTarget=null}function clearlastline(e){0<lines[e].length&&(lines[e].length=lines[e].length-1),curTarget=e,drawTarget(),dragObj=curLine=curTarget=null}function addA11yTarget(e,t){var r,a,n,i,s,g,l,u,o,c,d,T,p,h,m,y,w,f,v,b,q=e[0];for(a11ytargets.push(q),r=e[1].substr(9).split(","),a=e[2],n=e[3],(i=e[4])==(s=e[5])&&(i=-1,s=1),g=e[6],l=e[7],u=e[8],null==(o=document.getElementById("a11ydraw"+q))&&(c=document.getElementById("canvas"+q))&&(d=$("<div>").append($("<p>",{text:_("Drawn Elements:")})),(o=document.createElement("ul")).setAttribute("id","allydraw"+q),d.append(o),$(c).replaceWith(d)),targetOuts[q]=document.getElementById("qn"+q),targets[q]={el:o,xmin:a,xmax:n,ymin:i,ymax:s,imgborder:g,imgwidth:l,imgheight:u},targets[q].pixperx=(l-2*g)/(n-a),targets[q].pixpery=i==s?1:(u-2*g)/(s-i),"inequality"==r[0]?(T=r.shift(),0==r.length?r=["line"]:"both"==r[0]&&(r=["line","parab"])):"twopoint"==r[0]?(T=r.shift(),0==r.length&&(r=["line","parab","abs","circle","dot"])):"numberline"==r[0]?(T="basic",r.shift()):T="basic",targets[q].afgroup=T,p={inequality:{line:[{mode:10,descr:_("Linear inequality with solid line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")},{mode:10.2,descr:_("Linear inequality with dashed line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")}],parab:[{mode:10.3,descr:_("Parabolic inequality with solid line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")},{mode:10.4,descr:_("Parabolic inequality with dashed line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")}]},twopoint:{line:[{mode:5,descr:_("Line"),inN:2,input:_("Enter two points on the line")}],lineseg:[{mode:5.3,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],ray:[{mode:5.2,descr:_("Ray"),inN:2,input:_("Enter the starting point of the ray and another point on the ray")}],parab:[{mode:6,descr:_("Parabola"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],horizparab:[{mode:6.1,descr:_("Parabola opening right or left"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],cubic:[{mode:6.3,descr:_("Cubic"),inN:2,input:_("Enter the inflection point, then another point on the cubic")}],cuberoot:[{mode:6.6,descr:_("Cube root"),inN:2,input:_("Enter the inflection point of the cube root, then another point on the graph")}],abs:[{mode:8,descr:_("Absolute value"),inN:2,input:_("Enter the corner point of the absolute value, then another point on the graph")}],rational:[{mode:8.2,descr:_("Rational"),inN:2,input:_("Enter the point where the vertical and horizontal asymptote cross, then a point on the graph")}],exp:[{mode:8.3,descr:_("Exponential"),inN:2,input:_("Enter two points on the graph")}],log:[{mode:8.4,descr:_("Logarithm"),inN:2,input:_("Enter two points on the graph")}],genexp:[{mode:8.5,descr:_("Shifted Exponential"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],genlog:[{mode:8.6,descr:_("Shifted Logarithm"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],circle:[{mode:7,descr:_("Circle"),inN:2,input:_("Enter the center point of the circle, then a point on the graph")}],ellipse:[{mode:7.2,descr:_("Ellipse"),inN:2,input:_("Enter the center point of the ellipse, then a point offset from the center by the horizontal radius and vertical radius")}],hyperbola:[{mode:7.4,descr:_("Vertical hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the co-vertex and y is the y-coordinate of the vertex")},{mode:7.5,descr:_("Horizontal hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the vertex and y is the y-coordinate of the co-vertex")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],trig:[{mode:9,descr:_("Cosine"),inN:2,input:_("Enter a point at the start of a phase, then a point half a phase further")},{mode:9.2,descr:_("Sine"),inN:2,input:_("Enter a point at the start of a phase, then a point a quarter phase further")}],vector:[{mode:5.4,descr:_("Vector"),inN:2,input:_("Enter the starting and ending point of the vector")}]},basic:{line:[{mode:0,descr:_("Lines"),inN:"list",input:_("Enter list of points to connect with lines")}],lineseg:[{mode:.5,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],freehand:[{mode:.7,descr:_("Freehand"),inN:"list",input:_("Enter list of points to connect with lines")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],polygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter list of points to place dots connected with lines"),dotline:1}],closedpolygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter list of points to place dots connected with lines"),dotline:2}]}},m=[],y=[],w=[],v=0;v<r.length;v++)if(p[T].hasOwnProperty(r[v]))for(0==v&&(h=p[T][r[v]][0].mode),b=0;b<p[T][r[v]].length;b++)w[p[T][r[v]][b].mode]=p[T][r[v]][b],m.push(p[T][r[v]][b].mode),f='<option value="'+p[T][r[v]][b].mode+'"',f+=' data-af="'+r[v]+'">'+p[T][r[v]][b].descr+"</option>",y.push(f);if(targets[q].defmode=h,targets[q].inputmodes=m,targets[q].selects=y,targets[q].moderef=w,null==t&&lines.hasOwnProperty(q)){for(v=0;v<lines[q].length;v++)adda11ydraw(q,0,pixcoordstopointlist(lines[q][v],q));for(v=0;v<dots[q].length;v++)adda11ydraw(q,1,pixcoordstopointlist(dots[q][v],q));for(v=0;v<odots[q].length;v++)adda11ydraw(q,2,pixcoordstopointlist(odots[q][v],q));for(v=0;v<tplines[q].length;v++)adda11ydraw(q,tptypes[q][v],pixcoordstopointlist(tplines[q][v][0],q)+","+pixcoordstopointlist(tplines[q][v][1],q));for(v=0;v<ineqlines[q].length;v++)adda11ydraw(q,ineqtypes[q][v],pixcoordstopointlist(ineqlines[q][v][0],q)+","+pixcoordstopointlist(ineqlines[q][v][1],q)+","+pixcoordstopointlist(ineqlines[q][v][2],q))}else if(null!=t)for(v=0;v<t.length;v++)adda11ydraw(q,t[v][0],t[v][1].replace(/\[/g,"(").replace(/\]/g,")"))}function adda11ydraw(e,t,r){var a,n=targets[e],i=t||n.defmode,s=r||"";n.afgroup;for(j in html='<select aria-label="'+_("Drawing element type")+'" onchange="imathasDraw.changea11ydraw(this,\''+e+"')\">",n.selects)html+=n.selects[j];html+="</select><br/>",html+='<span class="a11ydrawinstr"></span><br/>',html+='<input type="text" aria-label="'+_("Point list")+'" value="'+s+'" onblur="imathasDraw.updatea11ydraw(this)"/>',html+='<button type="button" class="imgbutton" onclick="imathasDraw.removea11ydraw(this)">',html+=_("Remove")+"</button>",a=$("<li>",{class:"a11ydrawrow"}).html(html),$(n.el).append(a),a.find("select").val(i),a.find(".a11ydrawinstr").text(n.moderef[i].input),r||a.find("select").focus()}function removea11ydraw(e){$(e).parent().remove(),encodea11ydraw()}function changea11ydraw(e,t){var r=$(e).val(),a=targets[t].moderef[r];$(e).parent().find(".a11ydrawinstr").text(a.input),encodea11ydraw()}function updatea11ydraw(e){encodea11ydraw()}function pixcoordstopointlist(e,t){var r=targets[t],a=(e[0]-r.imgborder)/r.pixperx+r.xmin,n=(r.imgheight-e[1]-r.imgborder)/r.pixpery+r.ymin;return"("+(a=Math.round(100*a)/100)+","+(n=Math.round(100*n)/100)+")"}function encodea11ydraw(){var i,tarnum,thistarg,lines,dots,odots,tplines,tpineq,saveinput,afgroup;for(i=0;i<a11ytargets.length;i++)tarnum=a11ytargets[i],thistarg=targets[tarnum],lines=[],dots=[],odots=[],tplines=[],tpineq=[],saveinput=[],afgroup=targets[tarnum].afgroup,$("#a11ydraw"+tarnum).find(".a11ydrawrow").each(function(i,el){var outpts,mode=$(el).find("select").val(),input=$(el).find("input").val();for(saveinput.push("["+mode+',"'+input+'"]'),input=input.replace(/[\(\)]/g,"").split(/\s*,\s*/),outpts=[],i=1;i<input.length;i+=2){try{input[i-1]=eval(prepWithMath(mathjs(input[i-1])))}catch(e){input[i-1]=NaN}try{input[i]=eval(prepWithMath(mathjs(input[i])))}catch(e){input[i]=NaN}input[i-1]=(input[i-1]-thistarg.xmin)*thistarg.pixperx+thistarg.imgborder,input[i]=thistarg.imgheight-(input[i]-thistarg.ymin)*thistarg.pixpery-thistarg.imgborder,outpts.push(Math.round(input[i-1])+","+Math.round(input[i]))}1==mode?dots.push("("+outpts.join("),(")+")"):2==mode?odots.push("("+outpts.join("),(")+")"):mode<1?lines.push("("+outpts.join("),(")+")"):5<=mode&&mode<10&&2==outpts.length?tplines.push("("+mode+","+outpts.join(",")+")"):10<=mode&&3==outpts.length&&tpineq.push("("+mode+","+outpts.join(",")+")")}),targetOuts[tarnum].value=lines.join(";")+";;"+dots.join(",")+";;"+odots.join(",")+";;"+tplines.join(",")+";;"+tpineq.join(",")+";;"+saveinput.join(","),$(targetOuts[tarnum]).trigger("input").trigger("change")}function addTarget(t,e,r,a,n,i,s,g,l,u,o,c,d,T,p){var h,m,y=document.getElementById(e);$(y).is(":hidden")&&$(y).on("mouseover.imathasdrawwait touchstart.imathasdrawwait",function(){$(y).off("mouseover.imathasdrawwait touchstart.imathasdrawwait"),initCanvases(t)}),y.style.userSelect="none",y.style.webkitUserSelect="none",y.style.MozUserSelect="none",h=getPosition(y),targets[t]={el:y,left:h.x,top:h.y,width:y.offsetWidth,height:y.offsetHeight,xmin:n,xmax:i,ymin:s,ymax:g,imgborder:l,imgwidth:u,imgheight:o,mode:c,dotline:d},"string"==typeof p&&-1!=p.indexOf(":")?(p=p.split(":"),targets[t].snaptogridx=1*p[0],targets[t].snaptogridy=1*p[1]):(targets[t].snaptogridx=1*p,targets[t].snaptogridy=1*p),targets[t].pixperx=(u-2*l)/(i-n),targets[t].pixpery=s==g?1:(o-2*l)/(g-s),targetOuts[t]=document.getElementById(a),null==lines[t]&&(lines[t]=new Array),null==dots[t]&&(dots[t]=new Array),null==odots[t]&&(odots[t]=new Array),null==tplines[t]&&(tplines[t]=new Array),null==tptypes[t]&&(tptypes[t]=new Array),null==ineqlines[t]&&(ineqlines[t]=new Array),null==ineqtypes[t]&&(ineqtypes[t]=new Array),drawstyle[t]=5<=c?1:0,drawlocky[t]=T,r.match(/initPicture/)?(0==$(y).closest(".drawcanvasholder").length&&($(y).removeClass("drawcanvas").wrap($("<div>",{class:"drawcanvas",style:"position:relative;width:"+u+"px;height:"+o+"px"})).wrap($("<div>",{class:"drawcanvasholder",style:"position:absolute;top:0;left:0;z-index:2"})),$(y).closest(".drawcanvas").prepend($("<div>",{class:"canvasbg",style:"position:absolute;top:0;left:0"}).append($("<embed>",{"data-nomag":1,type:"image/svg+xml",align:"middle",width:u,height:o,script:r}).attr("width",u).attr("height",o)))),imgs[t]=null,m=curTarget,curTarget=t,drawTarget(),setTimeout(function(){window.drawPics($(y).closest(".drawcanvas")[0])},30),curTarget=m):""!==r?(imgs[t]=new Image,imgs[t].onload=function(){var e=curTarget;curTarget=t,drawTarget(),curTarget=e},imgs[t].src=r):(imgs[t]=null,m=curTarget,curTarget=t,drawTarget(),curTarget=m)}function settool(e,t,r){var a,n=document.getElementById("drawtools"+t),i=n.getElementsByTagName("span");for(a=0;a<i.length;a++)i[a].className="";for(i=n.getElementsByTagName("img"),a=0;a<i.length;a++)i[a].className="";e.className="sel",setDrawMode(t,r),curTarget=t,drawTarget()}function setDrawMode(e,t){targets[e].mode=t}function setDotLine(e,t){targets[e].dotline=t}function drawTarget(e,t){var r,a,n,i,s,g,l,u,o,c,d,T,p,h,m,y,w,f,v,b,q,x,M,O,L,j,P,E,I,_,k,$,B,N,C,S,A,D,W,R,z,H,U,F,Y,X,V,Q,G,J,K,Z,ee,te;try{r=targets[curTarget].el.getContext("2d")}catch(e){nocanvaswarning||(nocanvaswarning=!0,alert("Your browser does not support drawing answer entry.  Please try again using Internet Explorer 6+ (Windows), FireFox 1.5+ (Win/Mac), Safari 1.3+ (Mac), Opera 9+ (Win/Mac), or Camino (Mac)"))}for(r.fillStyle="rgb(0,0,255)",r.lineWidth=2,r.strokeStyle="rgb(0,0,255)",r.clearRect(0,0,targets[curTarget].imgwidth,targets[curTarget].imgheight),null!==imgs[curTarget]&&r.drawImage(imgs[curTarget],0,0),r.beginPath(),a=0;a<ineqlines[curTarget].length;a++){for(n=a%3,r.strokeStyle=ineqcolors[n],r.fillStyle=ineqcolors[n],u=l=g=s=i=null,3==ineqlines[curTarget][a].length?(s=ineqlines[curTarget][a][1][0],l=ineqlines[curTarget][a][1][1],g=ineqlines[curTarget][a][2][0],u=ineqlines[curTarget][a][2][1]):2==ineqlines[curTarget][a].length?(s=ineqlines[curTarget][a][1][0],l=ineqlines[curTarget][a][1][1],g=e,u=t):curIneqcurve==a&&null!=e&&1==ineqlines[curTarget][a].length&&(s=e,l=t),null!=g&&(r.save(),r.fillStyle=ineqacolors[n],r.beginPath(),ineqtypes[curTarget][a]<=10.2?(s!=ineqlines[curTarget][a][0][0]&&(i=(l-ineqlines[curTarget][a][0][1])/(s-ineqlines[curTarget][a][0][0])),Math.abs(s-ineqlines[curTarget][a][0][0])<1||100<Math.abs(i)?(r.moveTo(ineqlines[curTarget][a][0][0],0),r.lineTo(ineqlines[curTarget][a][0][0],targets[curTarget].imgheight),s<g?(r.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight),r.lineTo(targets[curTarget].imgwidth,0)):(r.lineTo(0,targets[curTarget].imgheight),r.lineTo(0,0))):(o=i*(g-s)+l,c=ineqlines[curTarget][a][0][1]-i*ineqlines[curTarget][a][0][0],d=ineqlines[curTarget][a][0][1]+i*(targets[curTarget].imgwidth-ineqlines[curTarget][a][0][0]),r.moveTo(0,c),r.lineTo(targets[curTarget].imgwidth,d),o<u?(r.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight),r.lineTo(0,targets[curTarget].imgheight)):(r.lineTo(targets[curTarget].imgwidth,0),r.lineTo(0,0))),r.closePath()):shadeParabola(r,ineqlines[curTarget][a][0][0],ineqlines[curTarget][a][0][1],s,l,g,u,targets[curTarget].imgwidth,targets[curTarget].imgheight),r.fill(),r.restore()),r.beginPath(),null!=s&&(ineqtypes[curTarget][a]<=10.2?(s!=ineqlines[curTarget][a][0][0]&&(i=(l-ineqlines[curTarget][a][0][1])/(s-ineqlines[curTarget][a][0][0])),Math.abs(s-ineqlines[curTarget][a][0][0])<1||100<Math.abs(i)?10.2==ineqtypes[curTarget][a]?null!=dragObj&&10<=dragObj.mode&&dragObj.mode<11&&dragObj.num==a&&0==dragObj.subnum?(r.dashedLine(ineqlines[curTarget][a][1][0],ineqlines[curTarget][a][1][1],ineqlines[curTarget][a][1][0],targets[curTarget].imgheight),r.dashedLine(ineqlines[curTarget][a][1][0],ineqlines[curTarget][a][1][1],ineqlines[curTarget][a][1][0],0)):(r.dashedLine(ineqlines[curTarget][a][0][0],ineqlines[curTarget][a][0][1],ineqlines[curTarget][a][0][0],targets[curTarget].imgheight),r.dashedLine(ineqlines[curTarget][a][0][0],ineqlines[curTarget][a][0][1],ineqlines[curTarget][a][0][0],0)):(r.moveTo(ineqlines[curTarget][a][0][0],0),r.lineTo(ineqlines[curTarget][a][0][0],targets[curTarget].imgheight),r.stroke()):(c=ineqlines[curTarget][a][0][1]-i*ineqlines[curTarget][a][0][0],d=ineqlines[curTarget][a][0][1]+i*(targets[curTarget].imgwidth-ineqlines[curTarget][a][0][0]),10.2==ineqtypes[curTarget][a]?null!=dragObj&&10<=dragObj.mode&&dragObj.mode<11&&dragObj.num==a&&0==dragObj.subnum?(r.dashedLine(ineqlines[curTarget][a][1][0],ineqlines[curTarget][a][1][1],targets[curTarget].imgwidth,d),r.dashedLine(ineqlines[curTarget][a][1][0],ineqlines[curTarget][a][1][1],0,c)):(r.dashedLine(ineqlines[curTarget][a][0][0],ineqlines[curTarget][a][0][1],targets[curTarget].imgwidth,d),r.dashedLine(ineqlines[curTarget][a][0][0],ineqlines[curTarget][a][0][1],0,c)):(r.moveTo(0,c),r.lineTo(targets[curTarget].imgwidth,d),r.stroke()))):10.3==ineqtypes[curTarget][a]?(s!=ineqlines[curTarget][a][0][0]&&(l==ineqlines[curTarget][a][0][1]?(r.moveTo(0,l),r.lineTo(targets[curTarget].imgwidth,l)):(T=(l-ineqlines[curTarget][a][0][1])/((s-ineqlines[curTarget][a][0][0])*(s-ineqlines[curTarget][a][0][0])),y=l>ineqlines[curTarget][a][0][1]?(p=Math.sqrt((targets[curTarget].imgheight-ineqlines[curTarget][a][0][1])/T)+ineqlines[curTarget][a][0][0],h=-1*Math.sqrt((targets[curTarget].imgheight-ineqlines[curTarget][a][0][1])/T)+ineqlines[curTarget][a][0][0],m=ineqlines[curTarget][a][0][1]-(targets[curTarget].imgheight-ineqlines[curTarget][a][0][1]),targets[curTarget].imgheight):(p=Math.sqrt((0-ineqlines[curTarget][a][0][1])/T)+ineqlines[curTarget][a][0][0],h=-1*Math.sqrt((0-ineqlines[curTarget][a][0][1])/T)+ineqlines[curTarget][a][0][0],m=2*ineqlines[curTarget][a][0][1],0),v=(w=p+2/3*(ineqlines[curTarget][a][0][0]-p))+(h-p)/3,b=f=y+2/3*(m-y),r.moveTo(p,y),r.bezierCurveTo(w,f,v,b,h,y))),r.stroke()):s!=ineqlines[curTarget][a][0][0]&&dashedParabola(r,ineqlines[curTarget][a][0][0],ineqlines[curTarget][a][0][1],s,l,targets[curTarget].imgwidth,targets[curTarget].imgheight)),r.beginPath(),q=0;q<ineqlines[curTarget][a].length;q++)2==q?(r.arc(ineqlines[curTarget][a][q][0],ineqlines[curTarget][a][q][1],4,0,2*Math.PI,!0),r.fill()):r.fillRect(ineqlines[curTarget][a][q][0]-3,ineqlines[curTarget][a][q][1]-3,6,6);1==ineqlines[curTarget][a].length&&null!=s&&r.fillRect(s-3,l-3,6,6),r.beginPath()}for(r.fillStyle="rgb(0,0,255)",1==drawlocky[curTarget]?r.lineWidth=4:r.lineWidth=2,r.strokeStyle="rgb(0,0,255)",a=0;a<tplines[curTarget].length;a++){if(5<=tptypes[curTarget][a]&&tptypes[curTarget][a]<6)l=s=i=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&(5.3==tptypes[curTarget][a]||5.4==tptypes[curTarget][a]?(r.moveTo(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1]),r.lineTo(s,l),5.4==tptypes[curTarget][a]&&(x=[s-tplines[curTarget][a][0][0],l-tplines[curTarget][a][0][1]],1e-4<(O=Math.sqrt(x[0]*x[0]+x[1]*x[1]))&&(M=[-(x=[x[0]/O,x[1]/O])[1],x[0]],r.moveTo(s-15*x[0]-4*M[0],l-15*x[1]-5*M[1]),r.lineTo(s,l),r.moveTo(s-15*x[0]+4*M[0],l-15*x[1]+5*M[1]),r.lineTo(s,l)))):(s!=tplines[curTarget][a][0][0]&&(i=(l-tplines[curTarget][a][0][1])/(s-tplines[curTarget][a][0][0])),Math.abs(s-tplines[curTarget][a][0][0])<1||100<Math.abs(i)?5.2==tptypes[curTarget][a]?(r.moveTo(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1]),l>tplines[curTarget][a][0][1]?r.lineTo(tplines[curTarget][a][0][0],targets[curTarget].imgheight):r.lineTo(tplines[curTarget][a][0][0],0)):(r.moveTo(tplines[curTarget][a][0][0],0),r.lineTo(tplines[curTarget][a][0][0],targets[curTarget].imgheight)):(c=tplines[curTarget][a][0][1]-i*tplines[curTarget][a][0][0],d=tplines[curTarget][a][0][1]+i*(targets[curTarget].imgwidth-tplines[curTarget][a][0][0]),c=tplines[curTarget][a][0][1]-i*tplines[curTarget][a][0][0],d=tplines[curTarget][a][0][1]+i*(targets[curTarget].imgwidth-tplines[curTarget][a][0][0]),5.2==tptypes[curTarget][a]?(r.moveTo(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1]),s>tplines[curTarget][a][0][0]?r.lineTo(targets[curTarget].imgwidth,d):r.lineTo(0,c)):(r.moveTo(0,c),r.lineTo(targets[curTarget].imgwidth,d)))));else if(6==tptypes[curTarget][a]||6.1==tptypes[curTarget][a])s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&(6==tptypes[curTarget][a]?l==tplines[curTarget][a][0][1]?(r.moveTo(0,l),r.lineTo(targets[curTarget].imgwidth,l)):s==tplines[curTarget][a][0][0]?(r.moveTo(s,tplines[curTarget][a][0][1]),l>tplines[curTarget][a][0][1]?r.lineTo(s,targets[curTarget].imgheight):r.lineTo(s,0)):(T=(l-tplines[curTarget][a][0][1])/((s-tplines[curTarget][a][0][0])*(s-tplines[curTarget][a][0][0])),y=l>tplines[curTarget][a][0][1]?(p=Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][a][0][1])/T)+tplines[curTarget][a][0][0],h=-1*Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][a][0][1])/T)+tplines[curTarget][a][0][0],m=tplines[curTarget][a][0][1]-(targets[curTarget].imgheight-tplines[curTarget][a][0][1]),targets[curTarget].imgheight):(p=Math.sqrt((0-tplines[curTarget][a][0][1])/T)+tplines[curTarget][a][0][0],h=-1*Math.sqrt((0-tplines[curTarget][a][0][1])/T)+tplines[curTarget][a][0][0],m=2*tplines[curTarget][a][0][1],0),v=(w=p+2/3*(tplines[curTarget][a][0][0]-p))+(h-p)/3,b=f=y+2/3*(m-y),r.moveTo(p,y),r.bezierCurveTo(w,f,v,b,h,y)):6.1==tptypes[curTarget][a]&&(s==tplines[curTarget][a][0][0]?(r.moveTo(s,0),r.lineTo(s,targets[curTarget].imgheight)):l==tplines[curTarget][a][0][1]?(r.moveTo(tplines[curTarget][a][0][0],l),s>tplines[curTarget][a][0][0]?r.lineTo(targets[curTarget].imgwidth,l):r.lineTo(0,l)):(T=(s-tplines[curTarget][a][0][0])/((l-tplines[curTarget][a][0][1])*(l-tplines[curTarget][a][0][1])),j=s>tplines[curTarget][a][0][0]?(p=Math.sqrt((targets[curTarget].imgwidth-tplines[curTarget][a][0][0])/T)+tplines[curTarget][a][0][1],h=-1*Math.sqrt((targets[curTarget].imgwidth-tplines[curTarget][a][0][0])/T)+tplines[curTarget][a][0][1],L=tplines[curTarget][a][0][0]-(targets[curTarget].imgwidth-tplines[curTarget][a][0][0]),targets[curTarget].imgwidth):(p=Math.sqrt((0-tplines[curTarget][a][0][0])/T)+tplines[curTarget][a][0][1],h=-1*Math.sqrt((0-tplines[curTarget][a][0][0])/T)+tplines[curTarget][a][0][1],L=2*tplines[curTarget][a][0][0],0),b=(f=p+2/3*(tplines[curTarget][a][0][1]-p))+(h-p)/3,v=w=j+2/3*(L-j),r.moveTo(j,p),r.bezierCurveTo(w,f,v,b,j,h))));else if(6.5==tptypes[curTarget][a]){if(s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&s!=tplines[curTarget][a][0][0])if(l==tplines[curTarget][a][0][1])r.moveTo(tplines[curTarget][a][0][0],l),s>tplines[curTarget][a][0][0]?r.lineTo(targets[curTarget].imgwidth,l):r.lineTo(0,l);else for(P=s<tplines[curTarget][a][0][0]?-1:1,T=(l-tplines[curTarget][a][0][1])/Math.sqrt(P*(s-tplines[curTarget][a][0][0])),r.moveTo(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1]),I=tplines[curTarget][a][0][0],E=tplines[curTarget][a][0][1];I+=3*P,r.lineTo(I,T*Math.sqrt(P*(I-tplines[curTarget][a][0][0]))+tplines[curTarget][a][0][1]),0<I&&I<targets[curTarget].imgwidth&&0<E&&E<targets[curTarget].imgheight;);}else if(6.3==tptypes[curTarget][a]){if(s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&s!=tplines[curTarget][a][0][0])if(l==tplines[curTarget][a][0][1])r.moveTo(0,l),r.lineTo(targets[curTarget].imgwidth,l);else for(T=(l-tplines[curTarget][a][0][1])/safepow(s-tplines[curTarget][a][0][0],3),I=E=0;I<targets[curTarget].imgwidth+4;I+=1)(E=T*safepow(I-tplines[curTarget][a][0][0],3)+tplines[curTarget][a][0][1])<-100&&(E=-100),E>targets[curTarget].imgheight+100&&(E=targets[curTarget].imgheight+100),0==I?r.moveTo(I,E):r.lineTo(I,E)}else if(6.6==tptypes[curTarget][a]){if(s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&s!=tplines[curTarget][a][0][0])if(l==tplines[curTarget][a][0][1])r.moveTo(0,l),r.lineTo(targets[curTarget].imgwidth,l);else for(T=(l-tplines[curTarget][a][0][1])/safepow(s-tplines[curTarget][a][0][0],1/3),I=E=0;I<targets[curTarget].imgwidth+4;I+=1)(E=T*safepow(I-tplines[curTarget][a][0][0],1/3)+tplines[curTarget][a][0][1])<-100&&(E=-100),E>targets[curTarget].imgheight+100&&(E=targets[curTarget].imgheight+100),0==I?r.moveTo(I,E):r.lineTo(I,E)}else if(7<=tptypes[curTarget][a]&&tptypes[curTarget][a]<8){if(s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&(s!=tplines[curTarget][a][0][0]||l!=tplines[curTarget][a][0][1]))if(7==tptypes[curTarget][a])_=Math.sqrt((s-tplines[curTarget][a][0][0])*(s-tplines[curTarget][a][0][0])+(l-tplines[curTarget][a][0][1])*(l-tplines[curTarget][a][0][1])),r.arc(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],_,0,2*Math.PI,!0);else if(7.2==tptypes[curTarget][a])k=Math.abs(s-tplines[curTarget][a][0][0]),$=Math.abs(l-tplines[curTarget][a][0][1]),(curTPcurve==a||null!=dragObj&&dragObj.num==a)&&(r.strokeStyle="rgb(0,255,255)",r.lineWidth=1,r.dashedLine(s,l,s-2*(s-tplines[curTarget][a][0][0]),l,5),r.dashedLine(s,l,s,l-2*(l-tplines[curTarget][a][0][1]),5),r.dashedLine(s,l-2*(l-tplines[curTarget][a][0][1]),s-2*(s-tplines[curTarget][a][0][0]),l-2*(l-tplines[curTarget][a][0][1]),5),r.dashedLine(s-2*(s-tplines[curTarget][a][0][0]),l,s-2*(s-tplines[curTarget][a][0][0]),l-2*(l-tplines[curTarget][a][0][1]),5),r.lineWidth=2),r.strokeStyle="rgb(0,0,255)",r.save(),r.beginPath(),r.translate(tplines[curTarget][a][0][0]-k,tplines[curTarget][a][0][1]-$),r.scale(k,$),r.arc(1,1,1,0,2*Math.PI,!1),r.restore();else if(7.4==tptypes[curTarget][a]){for(B=Math.abs(s-tplines[curTarget][a][0][0]),N=Math.abs(l-tplines[curTarget][a][0][1]),C=Math.abs(N/B),r.strokeStyle=asymcolor,r.dashedLine(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],targets[curTarget].imgwidth,tplines[curTarget][a][0][1]+C*(targets[curTarget].imgwidth-tplines[curTarget][a][0][0])),r.dashedLine(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],targets[curTarget].imgwidth,tplines[curTarget][a][0][1]-C*(targets[curTarget].imgwidth-tplines[curTarget][a][0][0])),r.dashedLine(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],0,tplines[curTarget][a][0][1]-C*tplines[curTarget][a][0][0]),r.dashedLine(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],0,tplines[curTarget][a][0][1]+C*tplines[curTarget][a][0][0]),(curTPcurve==a||null!=dragObj&&dragObj.num==a)&&(r.strokeStyle="rgb(0,255,255)",r.lineWidth=1,r.dashedLine(s,l,s-2*(s-tplines[curTarget][a][0][0]),l,5),r.dashedLine(s,l,s,l-2*(l-tplines[curTarget][a][0][1]),5),r.dashedLine(s,l-2*(l-tplines[curTarget][a][0][1]),s-2*(s-tplines[curTarget][a][0][0]),l-2*(l-tplines[curTarget][a][0][1]),5),r.dashedLine(s-2*(s-tplines[curTarget][a][0][0]),l,s-2*(s-tplines[curTarget][a][0][0]),l-2*(l-tplines[curTarget][a][0][1]),5),r.lineWidth=2),r.beginPath(),r.strokeStyle="rgb(0,0,255)",I=0;I<targets[curTarget].imgwidth+4;I+=3)(E=tplines[curTarget][a][0][1]+Math.sqrt((Math.pow(I-tplines[curTarget][a][0][0],2)/(B*B)+1)*N*N))<-100&&(E=-100),E>targets[curTarget].imgheight+100&&(E=targets[curTarget].imgheight+100),0==I?r.moveTo(I,E):r.lineTo(I,E);for(r.stroke(),r.beginPath(),I=0;I<targets[curTarget].imgwidth+4;I+=3)(E=tplines[curTarget][a][0][1]-Math.sqrt((Math.pow(I-tplines[curTarget][a][0][0],2)/(B*B)+1)*N*N))<-100&&(E=-100),E>targets[curTarget].imgheight+100&&(E=targets[curTarget].imgheight+100),0==I?r.moveTo(I,E):r.lineTo(I,E)}else if(7.5==tptypes[curTarget][a]){for(N=Math.abs(s-tplines[curTarget][a][0][0]),B=Math.abs(l-tplines[curTarget][a][0][1]),C=Math.abs(B/N),r.strokeStyle=asymcolor,r.dashedLine(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],targets[curTarget].imgwidth,tplines[curTarget][a][0][1]+C*(targets[curTarget].imgwidth-tplines[curTarget][a][0][0])),r.dashedLine(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],targets[curTarget].imgwidth,tplines[curTarget][a][0][1]-C*(targets[curTarget].imgwidth-tplines[curTarget][a][0][0])),r.dashedLine(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],0,tplines[curTarget][a][0][1]-C*tplines[curTarget][a][0][0]),r.dashedLine(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1],0,tplines[curTarget][a][0][1]+C*tplines[curTarget][a][0][0]),(curTPcurve==a||null!=dragObj&&dragObj.num==a)&&(r.strokeStyle="rgb(0,255,255)",r.lineWidth=1,r.dashedLine(s,l,s-2*(s-tplines[curTarget][a][0][0]),l,5),r.dashedLine(s,l,s,l-2*(l-tplines[curTarget][a][0][1]),5),r.dashedLine(s,l-2*(l-tplines[curTarget][a][0][1]),s-2*(s-tplines[curTarget][a][0][0]),l-2*(l-tplines[curTarget][a][0][1]),5),r.dashedLine(s-2*(s-tplines[curTarget][a][0][0]),l,s-2*(s-tplines[curTarget][a][0][0]),l-2*(l-tplines[curTarget][a][0][1]),5),r.lineWidth=2),r.beginPath(),r.strokeStyle="rgb(0,0,255)",E=0;E<targets[curTarget].imgwidth+4;E+=3)(I=tplines[curTarget][a][0][0]+Math.sqrt((Math.pow(E-tplines[curTarget][a][0][1],2)/(B*B)+1)*N*N))<-100&&(I=-100),I>targets[curTarget].imgwidth+100&&(I=targets[curTarget].imgwidth+100),0==E?r.moveTo(I,E):r.lineTo(I,E);for(r.stroke(),r.beginPath(),E=0;E<targets[curTarget].imgwidth+4;E+=3)(I=tplines[curTarget][a][0][0]-Math.sqrt((Math.pow(E-tplines[curTarget][a][0][1],2)/(B*B)+1)*N*N))<-100&&(I=-100),I>targets[curTarget].imgwidth+100&&(I=targets[curTarget].imgwidth+100),0==E?r.moveTo(I,E):r.lineTo(I,E)}}else if(8==tptypes[curTarget][a])l=s=i=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&(s!=tplines[curTarget][a][0][0]&&(i=(l-tplines[curTarget][a][0][1])/(s-tplines[curTarget][a][0][0]),s<tplines[curTarget][a][0][0]&&(i*=-1)),Math.abs(s-tplines[curTarget][a][0][0])<1||100<Math.abs(i)?(r.moveTo(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1]),l>tplines[curTarget][a][0][1]?r.lineTo(tplines[curTarget][a][0][0],targets[curTarget].imgheight):r.lineTo(tplines[curTarget][a][0][0],0)):(c=tplines[curTarget][a][0][1]+i*tplines[curTarget][a][0][0],d=tplines[curTarget][a][0][1]+i*(targets[curTarget].imgwidth-tplines[curTarget][a][0][0]),r.moveTo(0,c),r.lineTo(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1]),r.lineTo(targets[curTarget].imgwidth,d)));else if(8.3==tptypes[curTarget][a]){if(s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&s!=tplines[curTarget][a][0][0])if(l==tplines[curTarget][a][0][1])r.moveTo(0,l),r.lineTo(targets[curTarget].imgwidth,l);else if(0<(A=(S=targets[curTarget].ymax*targets[curTarget].pixpery+targets[curTarget].imgborder)-tplines[curTarget][a][0][1])*(D=S-l)&&s!=tplines[curTarget][a][0][0])for(W=safepow(D/A,1/(s-tplines[curTarget][a][0][0])),T=D/safepow(W,s),r.moveTo(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1]),I=E=0;I<targets[curTarget].imgwidth+4;I+=3)(E=S-T*safepow(W,I))<-100&&(E=-100),E>targets[curTarget].imgheight+100&&(E=targets[curTarget].imgheight+100),0==I?r.moveTo(I,E):r.lineTo(I,E)}else if(8.4==tptypes[curTarget][a]){if(s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&s!=tplines[curTarget][a][0][0]&&l!=tplines[curTarget][a][0][1]&&0<(z=(R=-targets[curTarget].xmin*targets[curTarget].pixperx+targets[curTarget].imgborder)-tplines[curTarget][a][0][0])*(H=R-s)&&l!=tplines[curTarget][a][0][1])for(W=safepow(H/z,1/(l-tplines[curTarget][a][0][1])),T=H/safepow(W,l),r.moveTo(tplines[curTarget][a][0][0],tplines[curTarget][a][0][1]),E=E=0;E<targets[curTarget].imgheight+4;E+=3)(I=R-T*safepow(W,E))<-100&&(I=-100),I>targets[curTarget].imgwidth+100&&(I=targets[curTarget].imgwidth+100),0==E?r.moveTo(I,E):r.lineTo(I,E)}else if(8.5==tptypes[curTarget][a]){if(g=u=s=l=null,3==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1],g=tplines[curTarget][a][2][0],u=tplines[curTarget][a][2][1]):2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1],g=e,u=t):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),U=tplines[curTarget][a][0][1],r.strokeStyle=asymcolor,r.dashedLine(5,U,targets[curTarget].imgwidth,U),r.beginPath(),r.strokeStyle="rgb(0,0,255)",null!=g&&g!=s)if(u==l)r.moveTo(0,u),r.lineTo(targets[curTarget].imgwidth,u);else if(0<(D=U-l)*(F=U-u)&&g!=s)for(W=safepow(F/D,1/(g-s)),T=F/safepow(W,g),r.moveTo(s,l),I=E=0;I<targets[curTarget].imgwidth+4;I+=3)(E=U-T*safepow(W,I))<-100&&(E=-100),E>targets[curTarget].imgheight+100&&(E=targets[curTarget].imgheight+100),0==I?r.moveTo(I,E):r.lineTo(I,E)}else if(8.6==tptypes[curTarget][a]){if(g=u=s=l=null,3==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1],g=tplines[curTarget][a][2][0],u=tplines[curTarget][a][2][1]):2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1],g=e,u=t):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),Y=tplines[curTarget][a][0][0],r.strokeStyle=asymcolor,r.dashedLine(Y,5,Y,targets[curTarget].imgheight),r.beginPath(),r.strokeStyle="rgb(0,0,255)",null!=g&&g!=s&&u!=l&&0<(H=s-Y)*(X=g-Y))for(W=safepow(X/H,1/(u-l)),T=X/safepow(W,u),r.moveTo(s,l),E=I=0;E<targets[curTarget].imgheight+4;E+=3)(I=Y+T*safepow(W,E))<-100&&(I=-100),I>targets[curTarget].imgwidth+100&&(I=targets[curTarget].imgwidth+100),0==E?r.moveTo(I,E):r.lineTo(I,E)}else if(8.2==tptypes[curTarget][a]){if(s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),r.strokeStyle=asymcolor,r.dashedLine(5,tplines[curTarget][a][0][1],targets[curTarget].imgwidth,tplines[curTarget][a][0][1]),r.dashedLine(tplines[curTarget][a][0][0],5,tplines[curTarget][a][0][0],targets[curTarget].imgheight),r.beginPath(),r.strokeStyle="rgb(0,0,255)",null!=s&&s!=tplines[curTarget][a][0][0]&&l!=tplines[curTarget][a][0][1]){for(T=(l-tplines[curTarget][a][0][1])*(s-tplines[curTarget][a][0][0]),I=tplines[curTarget][a][0][0]-1;-4<I;I-=3)(E=T/(I-tplines[curTarget][a][0][0])+tplines[curTarget][a][0][1])<-100&&(E=-100),E>targets[curTarget].imgheight+100&&(E=targets[curTarget].imgheight+100),I==tplines[curTarget][a][0][0]-1?r.moveTo(I,E):r.lineTo(I,E);for(I=tplines[curTarget][a][0][0]+1;I<targets[curTarget].imgwidth+4;I+=3)(E=T/(I-tplines[curTarget][a][0][0])+tplines[curTarget][a][0][1])<-100&&(E=-100),E>targets[curTarget].imgheight+100&&(E=targets[curTarget].imgheight+100),I==tplines[curTarget][a][0][0]+1?r.moveTo(I,E):r.lineTo(I,E);r.stroke()}}else if((9==tptypes[curTarget][a]||9.1==tptypes[curTarget][a])&&(s=l=null,2==tplines[curTarget][a].length?(s=tplines[curTarget][a][1][0],l=tplines[curTarget][a][1][1]):curTPcurve==a&&null!=e&&1==tplines[curTarget][a].length&&(s=e,l=t),null!=s&&s!=tplines[curTarget][a][0][0]))if(l==tplines[curTarget][a][0][1])r.moveTo(0,l),r.lineTo(targets[curTarget].imgwidth,l);else for(9==tptypes[curTarget][a]?(V=-1*Math.abs(l-tplines[curTarget][a][0][1])/2,Q=(l+tplines[curTarget][a][0][1])/2,T=Math.PI/Math.abs(s-tplines[curTarget][a][0][0]),G=l<tplines[curTarget][a][0][1]?s:tplines[curTarget][a][0][0]):9.1==tptypes[curTarget][a]&&(V=-1*Math.abs(l-tplines[curTarget][a][0][1]),Q=tplines[curTarget][a][0][1],T=.5*Math.PI/Math.abs(s-tplines[curTarget][a][0][0]),G=l<tplines[curTarget][a][0][1]?s:s+2*Math.abs(s-tplines[curTarget][a][0][0])),I=E=0;I<targets[curTarget].imgwidth+4;I+=3)E=V*Math.cos(T*(I-G))+Q,0==I?r.moveTo(I,E):r.lineTo(I,E);r.stroke(),r.beginPath()}for(null===curTPcurve&&tpHasAsymp.hasOwnProperty(targets[curTarget].mode)&&(r.strokeStyle="rgb(200,200,200)",8.5==targets[curTarget].mode?r.dashedLine(5,t,targets[curTarget].imgwidth,t):8.6==targets[curTarget].mode?r.dashedLine(e,5,e,targets[curTarget].imgwidth):8.2==targets[curTarget].mode?(r.dashedLine(5,t,targets[curTarget].imgwidth,t),r.dashedLine(e,5,e,targets[curTarget].imgheight)):7.4!=targets[curTarget].mode&&7.5!=targets[curTarget].mode||(r.dashedLine(e,t,targets[curTarget].imgwidth,t+(targets[curTarget].imgwidth-e)),r.dashedLine(e,t,targets[curTarget].imgwidth,t-(targets[curTarget].imgwidth-e)),r.dashedLine(e,t,0,t-e),r.dashedLine(e,t,0,t+e)),r.beginPath(),r.strokeStyle="rgb(0,0,255)"),r.fillStyle="rgba(0,0,255,.5)",a=0;a<lines[curTarget].length;a++){for(r.beginPath(),q=0;q<lines[curTarget][a].length;q++)0==q?(r.moveTo(lines[curTarget][a][q][0],lines[curTarget][a][q][1]),J=lines[curTarget][a][q][0],K=lines[curTarget][a][q][1]):(r.lineTo(lines[curTarget][a][q][0],lines[curTarget][a][q][1]),Z=lines[curTarget][a][q][0],ee=lines[curTarget][a][q][1]);if(a==curLine&&null!=e&&(r.lineTo(e,t),Z=e,ee=t),te=.02*targets[curTarget].imgwidth,1==drawlocky[curTarget]&&Z>.98*targets[curTarget].imgwidth?(r.moveTo(Z,ee),r.lineTo(Z-te,ee+te),r.moveTo(Z,ee),r.lineTo(Z-te,ee-te)):1==drawlocky[curTarget]&&J>.98*targets[curTarget].imgwidth&&(r.moveTo(J,K),r.lineTo(J-te,K+te),r.moveTo(J,K),r.lineTo(J-te,K-te)),1==drawlocky[curTarget]&&Z<.02*targets[curTarget].imgwidth?(r.moveTo(Z,ee),r.lineTo(Z+te,ee+te),r.moveTo(Z,ee),r.lineTo(Z+te,ee-te)):1==drawlocky[curTarget]&&J<.02*targets[curTarget].imgwidth&&(r.moveTo(J,K),r.lineTo(J+te,K+te),r.moveTo(J,K),r.lineTo(J+te,K-te)),r.stroke(),1<targets[curTarget].dotline){if(lines[curTarget][a].length-1<1)continue;if(Math.pow(Z-J,2)+Math.pow(ee-K,2)<25){for(r.moveTo(lines[curTarget][a][0][0],lines[curTarget][a][0][1]),q=1;q<lines[curTarget][a].length;q++)r.lineTo(lines[curTarget][a][q][0],lines[curTarget][a][q][1]);r.closePath(),r.fill()}}}for(r.fillStyle="rgb(0,0,255)",r.beginPath(),a=0;a<dots[curTarget].length;a++)r.moveTo(dots[curTarget][a][0]+5,dots[curTarget][a][1]),r.arc(dots[curTarget][a][0],dots[curTarget][a][1],5,0,2*Math.PI,!0);if(r.fill(),0<targets[curTarget].dotline){for(r.beginPath(),a=0;a<lines[curTarget].length;a++)for(q=0;q<lines[curTarget][a].length;q++)(0==q||25<Math.pow(lines[curTarget][a][q][0]-lines[curTarget][a][q-1][0],2)+Math.pow(lines[curTarget][a][q][1]-lines[curTarget][a][q-1][1],2))&&(r.moveTo(lines[curTarget][a][q][0]+5,lines[curTarget][a][q][1]),r.arc(lines[curTarget][a][q][0],lines[curTarget][a][q][1],5,0,2*Math.PI,!0));r.fill()}for(r.fillStyle="rgb(255,255,255)",r.beginPath(),a=0;a<odots[curTarget].length;a++)r.moveTo(odots[curTarget][a][0]+5,odots[curTarget][a][1]),r.arc(odots[curTarget][a][0],odots[curTarget][a][1],4,0,2*Math.PI,!0);for(targets[curTarget].mode<3?r.fill():r.stroke(),r.lineWidth=2,r.beginPath(),a=0;a<odots[curTarget].length;a++)r.moveTo(odots[curTarget][a][0]+5,odots[curTarget][a][1]),r.arc(odots[curTarget][a][0],odots[curTarget][a][1],4,0,2*Math.PI,!0);for(r.stroke(),a=0;a<tplines[curTarget].length;a++)if(tptypes[curTarget][a]==targets[curTarget].mode){for(r.fillStyle="rgb(255,0,0)",q=0;q<tplines[curTarget][a].length;q++)r.fillRect(tplines[curTarget][a][q][0]-3,tplines[curTarget][a][q][1]-3,6,6);tplines[curTarget][a].length<tpModeN[targets[curTarget].mode]&&null!=e&&curTPcurve==a&&r.fillRect(e-3,t-3,6,6),r.fillStyle="rgb(0,0,255)"}encodeDraw()}function deleteCurve(e,t){1==e?dots[curTarget].splice(t,1):2==e?odots[curTarget].splice(t,1):0<=e&&e<1?lines[curTarget].splice(t,1):5<=e&&e<10?(tplines[curTarget].splice(t,1),tptypes[curTarget].splice(t,1),curTPcurve=null):10<=e&&e<11&&(ineqlines[curTarget].splice(t,1),ineqtypes[curTarget].splice(t,1),curIneqcurve=null),drawTarget()}function encodeDraw(){var e,t,r,a,n,i,s="",g=[];for(e=0;e<lines[curTarget].length;e++)for(lines[curTarget][e].length,g=0==targets[curTarget].dotline?pathsimplify(lines[curTarget][e]):lines[curTarget][e],0!=e&&(s+=";"),t=0;t<g.length;t++)0!=t&&(s+=","),s+="("+g[t][0]+","+g[t][1]+")";for(s+=";;",e=0;e<dots[curTarget].length;e++)0!=e&&(s+=","),s+="("+dots[curTarget][e][0]+","+dots[curTarget][e][1]+")";for(s+=";;",e=0;e<odots[curTarget].length;e++)0!=e&&(s+=","),s+="("+odots[curTarget][e][0]+","+odots[curTarget][e][1]+")";for(s+=";;",r=[],a="",e=0;e<tplines[curTarget].length;e++)if(tplines[curTarget][e].length==tpModeN[tptypes[curTarget][e]]){for(a="("+tptypes[curTarget][e],t=0;t<tplines[curTarget][e].length;t++)a+=","+tplines[curTarget][e][t][0]+","+tplines[curTarget][e][t][1];r.push(a+")")}for(s+=r.join(","),s+=";;",n=[],e=0;e<ineqlines[curTarget].length;e++)2<ineqlines[curTarget][e].length&&n.push("("+ineqtypes[curTarget][e]+","+ineqlines[curTarget][e][0][0]+","+ineqlines[curTarget][e][0][1]+","+ineqlines[curTarget][e][1][0]+","+ineqlines[curTarget][e][1][1]+","+ineqlines[curTarget][e][2][0]+","+ineqlines[curTarget][e][2][1]+")");s+=n.join(","),targetOuts[curTarget].value!=s&&(i=""!=targetOuts[curTarget].value||";;;;;;;;"!=s,targetOuts[curTarget].value=s,i&&$(targetOuts[curTarget]).trigger("input").trigger("change"))}function drawMouseDown(e){var t,r,a,n;if(clickcnt++,clearAllDrawListners(),hasTouch&&1<e.originalEvent.touches.length)return didMultiTouch=!0,$(document).on("touchend.imathasdraw",drawMouseUp),!0;if(hasTouch?(window.clearTimeout(hasTouchTimer),$(document).off("mousemove.imathasdraw"),$(".drawcanvas").on("touchstart.imathasdraw",function(e){hasTouch=!0,drawMouseDown(e)}),$(".drawcanvas").on("touchmove.imathasdraw",drawMouseMove),$(document).on("touchend.imathasdraw",drawMouseUp),$(document).on("touchcancel.imathasdraw",drawMouseUp)):($(document).on("mousemove.imathasdraw",drawMouseMove),$(document).on("mouseup.imathasdraw",drawMouseUp)),t=mouseCoords(e),null==curTarget||null==curLine&&null==curTPcurve&&null==curIneqcurve)for(i in targets)if(!$(targets[i].el).is(":hidden")&&(r=getPosition(targets[i].el)).x<t.x&&r.x+targets[i].width>t.x&&r.y<t.y&&r.y+targets[i].height>t.y&&e.target==targets[i].el){curTarget=i;break}if(null!=curTarget)if(e.preventDefault(),mouseisdown=!0,r=getPosition(targets[curTarget].el),-1<(a={x:t.x-r.x,y:t.y-r.y}).x&&a.x<targets[curTarget].width&&-1<a.y&&a.y<targets[curTarget].height){if(0<targets[curTarget].snaptogridx&&(a=snaptogrid(a,curTarget)),1==drawlocky[curTarget]&&(a.y=targets[curTarget].imgheight/2),null!=(n=findnearpoint(curTarget,a))){if(-1==targets[curTarget].mode)return void deleteCurve(n[0],n[1]);null!=curLine&&n[0]<1&&curLine!=n[1]?n=null:null!=curTPcurve&5<=n[0]&&n[0]<10&&curTPcurve!=n[1]?n=null:null!=curIneqcurve&&10<=n[0]&&n[0]<11&&curIneqcurve!=n[1]&&(n=null)}null==n?(setCursor("pendown"),1==targets[curTarget].mode?(dots[curTarget].push([a.x,a.y]),dragObj={mode:1,num:dots[curTarget].length-1}):2==targets[curTarget].mode?(odots[curTarget].push([a.x,a.y]),dragObj={mode:2,num:odots[curTarget].length-1}):0==targets[curTarget].mode||.7==targets[curTarget].mode?null==curLine?(lines[curTarget].push([[a.x,a.y]]),curLine=lines[curTarget].length-1):lines[curTarget][curLine].push([a.x,a.y]):.5==targets[curTarget].mode?null==curLine?(lines[curTarget].push([[a.x,a.y]]),curLine=lines[curTarget].length-1):(lines[curTarget][curLine].push([a.x,a.y]),dragObj=curLine=null):5<=targets[curTarget].mode&&targets[curTarget].mode<10?null==curTPcurve?(tplines[curTarget].push([[a.x,a.y]]),curTPcurve=tplines[curTarget].length-1,tptypes[curTarget][curTPcurve]=targets[curTarget].mode,mouseisdown=!1):(tplines[curTarget][curTPcurve].push([a.x,a.y]),tplines[curTarget][curTPcurve].length==tpModeN[targets[curTarget].mode]&&(dragObj={mode:targets[curTarget].mode,num:curTPcurve,subnum:1},curTPcurve=null)):10<=targets[curTarget].mode&&targets[curTarget].mode<11&&(null==curIneqcurve?(ineqlines[curTarget].push([[a.x,a.y]]),curIneqcurve=ineqlines[curTarget].length-1,ineqtypes[curTarget][curIneqcurve]=targets[curTarget].mode,mouseisdown=!1):(ineqlines[curTarget][curIneqcurve].push([a.x,a.y]),2==ineqlines[curTarget][curIneqcurve].length?dragObj={mode:targets[curTarget].mode,num:curIneqcurve,subnum:1}:3==ineqlines[curTarget][curIneqcurve].length&&(dragObj={mode:targets[curTarget].mode,num:curIneqcurve,subnum:2},curIneqcurve=null)))):0==n[0]||.5==n[0]?null==curLine?(setCursor("move"),dragObj={mode:targets[curTarget].mode,num:n[1],subnum:n[2]},oldpointpos=lines[curTarget][n[1]][n[2]],n[2]==lines[curTarget][n[1]].length-1&&0==targets[curTarget].mode?curLine=n[1]:0==n[2]&&0==targets[curTarget].mode&&(curLine=n[1],lines[curTarget][curLine].reverse(),dragObj.subnum=lines[curTarget][curLine].length-1),clickmightbenewcurve=!0):n[1]==curLine&&n[2]==lines[curTarget][n[1]].length-1?(lines[curTarget][curLine].length<2&&lines[curTarget].splice(curLine,1),curLine=null):1<targets[curTarget].dotline&&n[1]==curLine&&0==n[2]?(lines[curTarget][curLine].push(lines[curTarget][curLine][0]),curLine=null):(setCursor("pendown"),lines[curTarget][curLine].push([a.x,a.y])):1==n[0]?(setCursor("move"),dragObj={mode:1,num:n[1]}):2==n[0]?(setCursor("move"),dragObj={mode:2,num:n[1]}):5<=n[0]&&n[0]<10?null==curTPcurve&&(setCursor("move"),dragObj={mode:n[0],num:n[1],subnum:n[2]},oldpointpos=tplines[curTarget][n[1]][n[2]],clickmightbenewcurve=!0):10<=n[0]&&n[0]<11&&null==curIneqcurve&&(setCursor("move"),dragObj={mode:n[0],num:n[1],subnum:n[2]},oldpointpos=ineqlines[curTarget][n[1]][n[2]],clickmightbenewcurve=!0),drawTarget()}else null!=curLine&&(lines[curTarget][curLine].length<2&&lines[curTarget].splice(curLine,1),setCursor("pen")),null!=curTPcurve&&(tplines[curTarget][curTPcurve].length<tpModeN[targets[curTarget].mode]&&(tplines[curTarget].splice(curTPcurve,1),tptypes[curTarget].splice(curTPcurve,1)),setCursor("pen")),null!=curIneqcurve&&(ineqlines[curTarget][curIneqcurve].length<3&&(ineqlines[curTarget].splice(curIneqcurve,1),ineqtypes[curTarget].splice(curIneqcurve,1)),setCursor("pen")),dragObj=curIneqcurve=curTPcurve=curLine=null,drawTarget(),curTarget=null}function findnearpoint(e,t){var r,a,n;if(hasTouch?(r=Math.max(15*window.innerWidth/screen.width,15),r*=r):r=-1==targets[e].mode?50:25,0==targets[e].mode||.5==targets[e].mode||-1==targets[e].mode)for(a=lines[e].length-1;0<=a;a--)for(n=lines[e][a].length-1;0<=n;n--)if(Math.pow(lines[e][a][n][0]-t.x,2)+Math.pow(lines[e][a][n][1]-t.y,2)<r)return[-1==targets[e].mode?0:targets[e].mode,a,n];if(1==targets[e].mode||-1==targets[e].mode)for(a=dots[e].length-1;0<=a;a--)if(Math.pow(dots[e][a][0]-t.x,2)+Math.pow(dots[e][a][1]-t.y,2)<r)return[1,a];if(2==targets[e].mode||-1==targets[e].mode)for(a=odots[e].length-1;0<=a;a--)if(Math.pow(odots[e][a][0]-t.x,2)+Math.pow(odots[e][a][1]-t.y,2)<r)return[2,a];if(5<=targets[e].mode&&targets[e].mode<10||-1==targets[e].mode)for(a=tplines[e].length-1;0<=a;a--)for(n=tplines[e][a].length-1;0<=n;n--)if((tptypes[e][a]==targets[e].mode||-1==targets[e].mode)&&Math.pow(tplines[e][a][n][0]-t.x,2)+Math.pow(tplines[e][a][n][1]-t.y,2)<r)return[tptypes[e][a],a,n];if(10<=targets[e].mode&&targets[e].mode<11||-1==targets[e].mode)for(a=ineqlines[e].length-1;0<=a;a--)for(n=ineqlines[e][a].length-1;0<=n;n--)if((ineqtypes[e][a]==targets[e].mode||-1==targets[e].mode)&&Math.pow(ineqlines[e][a][n][0]-t.x,2)+Math.pow(ineqlines[e][a][n][1]-t.y,2)<r)return[ineqtypes[e][a],a,n];return null}function drawMouseUp(e){var t,r,a,n=mouseCoords(e);mouseisdown=!1,null!=curTarget&&(t=getPosition(targets[curTarget].el),r={x:n.x-t.x,y:n.y-t.y},0<targets[curTarget].snaptogridx&&(r=snaptogrid(r,curTarget)),a=-1<r.x&&r.x<targets[curTarget].width&&-1<r.y&&r.y<targets[curTarget].height,1==clickmightbenewcurve&&(5<=targets[curTarget].mode&&targets[curTarget].mode<10?(tplines[curTarget].push([[r.x,r.y]]),curTPcurve=tplines[curTarget].length-1,tptypes[curTarget][curTPcurve]=targets[curTarget].mode):10<=targets[curTarget].mode&&targets[curTarget].mode<11&&(ineqlines[curTarget].push([[r.x,r.y]]),curIneqcurve=ineqlines[curTarget].length-1,ineqtypes[curTarget][curIneqcurve]=targets[curTarget].mode)),null!=lastdrawmouseup&&n.x==lastdrawmouseup.x&&n.y==lastdrawmouseup.y&&null!=curLine&&null==dragObj&&(lines[curTarget][curLine].length<2&&lines[curTarget].splice(curLine,1),dragObj=curLine=null,drawTarget()),null!=curLine&&null==dragObj&&(.5==targets[curTarget].mode&&1<lines[curTarget][curLine].length?(curLine=null,dragobj=null,drawTarget()):.7==targets[curTarget].mode&&(curLine=null,dragobj=null,drawTarget())),null!=curTPcurve&&1==tplines[curTarget][curTPcurve].length&&(didMultiTouch||!a?(tplines[curTarget].splice(curTPcurve,1),tptypes[curTarget].splice(curTPcurve,1),curTPcurve=null,drawTarget()):null==findnearpoint(curTarget,r)&&(tplines[curTarget][curTPcurve].push([r.x,r.y]),curTPcurve=null,drawTarget())),null!=curIneqcurve&&1==ineqlines[curTarget][curIneqcurve].length&&(didMultiTouch||!a?(ineqlines[curTarget].splice(curIneqcurve,1),ineqtypes[curTarget].splice(curIneqcurve,1),curIneqcurve=null,drawTarget()):null==findnearpoint(curTarget,r)&&(ineqlines[curTarget][curIneqcurve].push([r.x,r.y]),drawTarget())),setCursor(null==curLine&&null==curTPcurve?"move":"pen"),void 0!==e&&e.preventDefault()),lastdrawmouseup=n,null!=curTarget&&null!=dragObj&&(t=getPosition(targets[curTarget].el),-1<r.x&&r.x<targets[curTarget].width&&-1<r.y&&r.y<targets[curTarget].height?(0==dragObj.mode&&1<targets[curTarget].dotline&&(0!=dragObj.subnum&&dragObj.subnum!=lines[curTarget][dragObj.num].length-1||Math.pow(lines[curTarget][dragObj.num][0][0]-lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][0],2)+Math.pow(lines[curTarget][dragObj.num][0][1]-lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][1],2)<25&&(0==dragObj.subnum?(lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][0]=lines[curTarget][dragObj.num][0][0],lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][1]=lines[curTarget][dragObj.num][0][1]):(lines[curTarget][dragObj.num][0][0]=lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][0],lines[curTarget][dragObj.num][0][1]=lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][1]),curLine=null,drawTarget())),dragObj=null):(1==drawlocky[curTarget]&&(r.y=targets[curTarget].imgheight/2),1==dragObj.mode?dots[curTarget].splice(dragObj.num,1):2==dragObj.mode?odots[curTarget].splice(dragObj.num,1):.5==dragObj.mode?lines[curTarget].splice(dragObj.num,1):0==dragObj.mode?lines[curTarget][dragObj.num][dragObj.subnum]=oldpointpos:5<=dragObj.mode&&dragObj.mode<10?(tplines[curTarget].splice(dragObj.num,1),tptypes[curTarget].splice(dragObj.num,1),curTPcurve=null):10<=dragObj.mode&&dragObj.mode<11&&(ineqlines[curTarget].splice(dragObj.num,1),ineqtypes[curTarget].splice(dragObj.num,1),curIneqcurve=null),dragObj=null,drawTarget())),didMultiTouch=!1,hasTouch?hasTouchTimer=window.setTimeout(function(){hasTouch=!1,clearAllDrawListners(),$(document).on("mousemove.imathasdraw",drawMouseMove),$(".drawcanvas").on("touchstart.imathasdraw",function(e){hasTouch=!0,drawMouseDown(e)}),$(document).on("mousedown.imathasdraw",drawMouseDown)},350):(clearAllDrawListners(),$(document).on("mousemove.imathasdraw",drawMouseMove),$(".drawcanvas").on("touchstart.imathasdraw",function(e){hasTouch=!0,drawMouseDown(e)}),$(document).on("mousedown.imathasdraw",drawMouseDown))}function drawMouseMove(e){var t,r,a,n,s,g=null;for(i in clickmightbenewcurve=!1,t=mouseCoords(e),targets)if(!$(targets[i].el).is(":hidden")&&(r=getPosition(targets[i].el)).x<t.x&&r.x+targets[i].width>t.x&&r.y<t.y&&r.y+targets[i].height>t.y&&e.target==targets[i].el){g=i;break}if(null!=g?(r=getPosition(targets[mouseintarget=g].el),a={x:t.x-r.x,y:t.y-r.y},0<targets[g].snaptogridx&&(a=snaptogrid(a,g)),1==drawlocky[g]&&(a.y=targets[g].imgheight/2),-1<a.x&&a.x<targets[g].width&&-1<a.y&&a.y<targets[g].height&&null==dragObj&&null==curLine&&(null==(n=findnearpoint(g,a))?setCursor("pen",g):-1!=targets[g].mode&&setCursor("move",g))):null!=mouseintarget&&-1!=mouseintarget&&(null!=curTarget?drawTarget():(curTarget=mouseintarget,drawTarget(),curTarget=null),mouseintarget=-1),null!=curTarget){if(e.originalEvent.touches&&1<e.originalEvent.touches.length)return didMultiTouch=!0;if(void 0!==e&&e.preventDefault(),r=getPosition(targets[curTarget].el),a={x:t.x-r.x,y:t.y-r.y},0<targets[curTarget].snaptogridx&&(a=snaptogrid(a,curTarget)),1==drawlocky[curTarget]&&(a.y=targets[curTarget].imgheight/2),-1<a.x&&a.x<targets[curTarget].width&&-1<a.y&&a.y<targets[curTarget].height){if(null==dragObj){if(mouseisdown&&-1==targets[curTarget].mode)return void(null!=(n=findnearpoint(curTarget,a))&&deleteCurve(n[0],n[1]));null!=curLine?!mouseisdown||0!=targets[curTarget].mode&&.7!=targets[curTarget].mode?mouseisdown&&.5==targets[curTarget].mode?0==(s=lines[curTarget][curLine].length-1)?25<Math.pow(lines[curTarget][curLine][s][0]-a.x,2)+Math.pow(lines[curTarget][curLine][s][1]-a.y,2)?(lines[curTarget][curLine].push([a.x,a.y]),drawTarget()):drawTarget(a.x,a.y):(lines[curTarget][curLine][s]=[a.x,a.y],drawTarget()):drawTarget(a.x,a.y):(s=lines[curTarget][curLine].length-1,25<Math.pow(lines[curTarget][curLine][s][0]-a.x,2)+Math.pow(lines[curTarget][curLine][s][1]-a.y,2)?(lines[curTarget][curLine].push([a.x,a.y]),drawTarget()):drawTarget(a.x,a.y)):null!=curTPcurve?mouseisdown?drawTarget():drawTarget(a.x,a.y):null!=curIneqcurve?mouseisdown?drawTarget():drawTarget(a.x,a.y):null==(n=findnearpoint(curTarget,a))?(setCursor("pen"),tpHasAsymp.hasOwnProperty(targets[curTarget].mode)&&null!==g&&drawTarget(a.x,a.y)):(drawTarget(),-1!=targets[curTarget].mode&&setCursor("move"))}else setCursor("move"),0==dragObj.mode||.5==dragObj.mode?lines[curTarget][dragObj.num][dragObj.subnum]=[a.x,a.y]:1==dragObj.mode?dots[curTarget][dragObj.num]=[a.x,a.y]:2==dragObj.mode?odots[curTarget][dragObj.num]=[a.x,a.y]:5<=dragObj.mode&&dragObj.mode<10?tplines[curTarget][dragObj.num][dragObj.subnum]=[a.x,a.y]:10<=dragObj.mode&&dragObj.mode<11&&(ineqlines[curTarget][dragObj.num][dragObj.subnum]=[a.x,a.y]),drawTarget();return!1}null==curIneqcurve||mouseisdown||drawTarget()}else null!=g&&-1!=mouseintarget&&(curTarget=g,tpHasAsymp.hasOwnProperty(targets[curTarget].mode)&&drawTarget(a.x,a.y),curTarget=null)}function setCursor(e,t){targets[t=t||curTarget].cursor!=e&&(targets[t].el.style.cursor="move"==e?e:"url("+imasroot+"/img/"+e+".cur), auto",targets[t].cursor=e)}function mouseCoords(e){var t,r,a,n,i;return e=e||window.event,hasTouch?{x:(t=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0]).pageX,y:t.pageY}:e.pageX||e.pageY?{x:e.pageX,y:e.pageY}:(r=document.documentElement,a=document.body,i=r&&(r.scrollTop||r.scrollLeft)?(n=r.scrollLeft,r.scrollTop):a?(n=a.scrollLeft,a.scrollTop):n=0,{x:e.clientX+n,y:e.clientY+i})}function snaptogrid(e,t){var r=e.x-targets[t].imgborder+targets[t].xmin*targets[t].pixperx,a=e.y-targets[t].imgborder-targets[t].ymax*targets[t].pixpery;return{x:r=Math.round(Math.round(r/(targets[t].pixperx*targets[t].snaptogridx))*targets[t].pixperx*targets[t].snaptogridx+targets[t].imgborder-targets[t].xmin*targets[t].pixperx),y:a=Math.round(Math.round(a/(targets[t].pixpery*targets[t].snaptogridy))*targets[t].pixpery*targets[t].snaptogridy+targets[t].imgborder+targets[t].ymax*targets[t].pixpery)}}function getMouseOffset(e,t){var r=getPosition(e),a=mouseCoords(t);return{x:a.x-r.x,y:a.y-r.y}}function getPosition(e){if(e.className.match(/hidden/))return{x:-1e4,y:-1e4};var t=$(e).offset();return{x:t.left,y:t.top}}function clearAllDrawListners(){$(document).off("mousedown.imathasdraw").off("mousemove.imathasdraw").off("mouseup.imathasdraw"),$(document).off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw"),$(".drawcanvas").off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw")}function initCanvases(e){var t,r,a,n,i;clearAllDrawListners(),$(document).on("mousemove.imathasdraw",drawMouseMove),$(".drawcanvas").on("touchstart.imathasdraw",function(e){hasTouch=!0,drawMouseDown(e)}),$(document).on("mousedown.imathasdraw",drawMouseDown);try{CanvasRenderingContext2D.prototype.dashedLine=function(e,t,r,a,n){var i,s,g,l,u,o;for(null==n&&(n=10),this.beginPath(),this.moveTo(e,t),s=a-t,l=(i=r-e)/(g=Math.sqrt(i*i+s*s)/n),u=s/g,g=Math.floor(g),o=0;o++<g&&-1<t&&t<targets[curTarget].imgheight+1&&-1<e&&e<targets[curTarget].imgwidth+1;)e+=l,t+=u,this[o%2==0?"moveTo":"lineTo"](e,t);this[o%2==0?"moveTo":"lineTo"](r,a),this.stroke(),this.closePath()}}catch(e){}for(t in canvases)if(void 0===e||e==t){if((r=null)!=drawla[t]&&2<drawla[t].length){if(lines[canvases[t][0]]=drawla[t][0],dots[canvases[t][0]]=drawla[t][1],odots[canvases[t][0]]=drawla[t][2],tptypes[canvases[t][0]]=[],tplines[canvases[t][0]]=[],3<drawla[t].length&&0<drawla[t][3].length)for(a=0;a<drawla[t][3].length;a++)for(tptypes[canvases[t][0]][a]=drawla[t][3][a][0],tplines[canvases[t][0]][a]=[],n=0;n<tpModeN[tptypes[canvases[t][0]][a]];n++)tplines[canvases[t][0]][a].push(drawla[t][3][a].slice(1+2*n,3+2*n));if(ineqtypes[canvases[t][0]]=[],ineqlines[canvases[t][0]]=[],4<drawla[t].length&&0<drawla[t][4].length)for(a=0;a<drawla[t][4].length;a++)ineqtypes[canvases[t][0]][a]=drawla[t][4][a][0],ineqlines[canvases[t][0]][a]=[drawla[t][4][a].slice(1,3),drawla[t][4][a].slice(3,5),drawla[t][4][a].slice(5)];5<drawla[t].length&&(r=drawla[t][5])}"a11ydraw"==canvases[t][1].substr(0,8)?addA11yTarget(canvases[t],r):(i="",canvases[t][1].match(/initPicture/)?i=canvases[t][1]:""!==canvases[t][1]&&(i=imasroot+"/filter/graph/imgs/"+canvases[t][1]),addTarget(canvases[t][0],"canvas"+canvases[t][0],i,"qn"+canvases[t][0],canvases[t][2],canvases[t][3],canvases[t][4],canvases[t][5],canvases[t][6],canvases[t][7],canvases[t][8],canvases[t][9],canvases[t][10],canvases[t][11],canvases[t][12]))}}function addnormslider(e,t){-1==arraysearch(e,normslider.idnums)?(normslider.idnums.push(e),!0===t&&slideronpageload(e)):slideronpageload(e)}function slideronpageload(e){var t,r;for(r=0;r<normslider.idnums.length;r++)void 0!==e&&e!=normslider.idnums[r]||(initnormslider(t=normslider.idnums[r]),$("#slid1"+t).on("touchstart.normslider mousedown.normslider",onsliderstart),$("#slid2"+t).on("touchstart.normslider mousedown.normslider",onsliderstart))}function initnormslider(e){var t,r,a,n,i=document.getElementById("qn"+e).value;a=(n=i.match(/\(-oo,([\-\d\.]+)\)U\(([\-\d\.]+),oo\)/))?(t=3,r=n[1],n[2]):(n=i.match(/\(-oo,([\-\d\.]+)\)/))?(t=0,r=n[1],2.5):(n=i.match(/\(([\-\d\.]+),oo\)/))?(r=n[t=1],2.5):(n=i.match(/\(([\-\d\.]+),([\-\d\.]+)\)/))?(t=2,r=n[1],n[2]):(t=0,r=-1.5,2.5),document.getElementById("slid1"+e).style.left=60*r+250-6+"px",document.getElementById("slid2"+e).style.left=60*a+250-6+"px",document.getElementById("shaderegions"+e).selectedIndex=t,normslider.curslider.type=document.getElementById("shaderegions"+e).value,chgnormtype(e)}function onsliderstart(e){(e=e||window.event).originalEvent.touches&&0<e.originalEvent.touches.length?(hasTouch=!0,$(document).on("touchmove.normslider",onsliderchange),$(document).on("touchend.normslider",onsliderstop)):($(document).on("mousemove.normslider",onsliderchange),$(document).on("mouseup.normslider",onsliderstop)),normslider.curslider.el=e.target||e.srcElement,normslider.curslider.id=normslider.curslider.el.id.substring(5),normslider.curslider.type=document.getElementById("shaderegions"+normslider.curslider.id).value,normslider.curslider.outnode=document.getElementById(normslider.outputid),normslider.curslider.startpos=getMouseOffset(normslider.curslider.el,e),normslider.curslider.el.parentNode.style.cursor="pointer";getPosition(normslider.curslider.el.parentNode);return e.preventDefault&&e.preventDefault(),!1}function onsliderchange(e){var t,r,a=normslider.curslider.id;if(e=e||window.event,!((t=getMouseOffset(normslider.curslider.el.parentNode,e)).x<5||t.x>normslider.curslider.el.parentNode.offsetWidth-5||t.y<5||t.y>normslider.curslider.el.parentNode.offsetHeight-5))return r=6*Math.round((t.x-normslider.curslider.startpos.x-10)/6)+10,normslider.curslider.el.style.left=r+"px",normupdatevalues(a),e.preventDefault&&e.preventDefault(),!1}function onsliderstop(e){null!==normslider.curslider.el&&(hasTouch=!1,$(document).off("touchmove.normslider touchend.normslider"),$(document).off("mousemove.normslider mouseup.normslider"),normslider.curslider.el.parentNode.style.cursor="",normslider.curslider.el=null)}function normupdatevalues(e){var t,r,a,n,i,s,g,l=parseInt(document.getElementById("slid1"+e).style.left)+6,u=parseInt(document.getElementById("slid2"+e).style.left)+6,o=Math.min(l,u),c=Math.max(l,u);"2O"==normslider.curslider.type?document.getElementById("normleft"+e).style.width=o+1+"px":"1L"==normslider.curslider.type?document.getElementById("normleft"+e).style.width=l+1+"px":"2B"==normslider.curslider.type&&(document.getElementById("normleft"+e).style.left=o+"px",document.getElementById("normleft"+e).style.width=c-o+1+"px"),"2O"==normslider.curslider.type?document.getElementById("normright"+e).style.width=500-c+"px":"1R"==normslider.curslider.type&&(document.getElementById("normright"+e).style.width=500-l+"px"),t=((l-10)/60-4).toFixed(1),r=((u-10)/60-4).toFixed(1),(a=document.getElementById("slid1txt"+e)).innerHTML=t,a.style.left=l-6+"px",(n=document.getElementById("slid2txt"+e)).innerHTML=r,n.style.left=u-6+"px",i=Math.min(t,r),s=Math.max(t,r),"2O"==normslider.curslider.type?g="(-oo,"+i+")U("+s+",oo)":"2B"==normslider.curslider.type?g="("+i+","+s+")":"1L"==normslider.curslider.type?g="(-oo,"+t+")":"1R"==normslider.curslider.type&&(g="("+t+",oo)"),document.getElementById("qn"+e).value=g,$("#qn"+e).trigger("input").trigger("change")}function chgnormtype(e){var t,r,a,n,i=document.getElementById("shaderegions"+e).value;normslider.curslider.type=i,t=parseInt(document.getElementById("slid1"+e).style.left)+6,r=parseInt(document.getElementById("slid2"+e).style.left)+6,a=Math.min(t,r),n=Math.max(t,r),"1R"==i||"1L"==i?(document.getElementById("slid2"+e).style.display="none",document.getElementById("slid2txt"+e).style.display="none","1R"==i?(document.getElementById("normleft"+e).style.display="none",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normright"+e).style.width=500-t+"px"):(document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.display="",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normleft"+e).style.width=t+"px")):"2O"==i?(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normright"+e).style.width=500-n+"px",document.getElementById("normleft"+e).style.width=a+"px"):"2B"==i&&(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.left=a+"px",document.getElementById("normleft"+e).style.width=n-a+"px"),normupdatevalues(e)}function dashedParabola(e,t,r,a,n,i,s){var g,l,u,o,c,d,T,p,h,m,y,w,f;if(n==r)e.moveTo(0,n),e.dashedLine(0,n,i,n);else{for(u=0,r<n&&(u=s),o=(g=(n-r)/((a-t)*(a-t)))*t*t+r-u,g*(d=(-(l=-2*g*t)-(c=Math.sqrt(l*l-4*g*o)))/(2*g))*d+l*d+(o+=u),(T=(-l+c)/(2*g))<d&&(p=d,d=T,T=p),m=(h=8)*h,T-d,y=t,w=r,f=0;d-5<y&&-5<y;)f%2==0?e.moveTo(y,w):e.lineTo(y,w),w=g*(y-=Math.min(Math.sqrt(m/(1+Math.pow(2*g*(y-t),2))),Math.sqrt(h/Math.abs(g))))*y+l*y+o,f++;for(y=t,w=r,f=0;y<T+5&&y<i+5;)f%2==0?e.moveTo(y,w):e.lineTo(y,w),w=g*(y+=Math.min(Math.sqrt(m/(1+Math.pow(2*g*(y-t),2))),Math.sqrt(h/Math.abs(g))))*y+l*y+o,f++}e.stroke()}function shadeParabola(e,t,r,a,n,i,s,g,l){var u,o,c,d,T,p,h,m,y,w,f,v,b,q,x,M;e.beginPath(),n==r?(e.moveTo(0,n),e.lineTo(g,n),s<r?(e.lineTo(g,0),e.lineTo(0,0)):(e.lineTo(g,l),e.lineTo(0,l))):(c=0,r<n&&(c=l),d=(u=(n-r)/((a-t)*(a-t)))*t*t+r-c,h=u*(p=(-(o=-2*u*t)-(T=Math.sqrt(o*o-4*u*d)))/(2*u))*p+o*p+(d+=c),(m=(-o+T)/(2*u))<p&&(w=p,p=m,m=w),x=(f=2*u*(p-t))*(q=((v=(y=h)-f*p)-(y-(b=-f)*m))/(b-f))+v,u<0&&s<u*i*i+o*i+d||0<u&&u*i*i+o*i+d<s?(e.moveTo(p,h),e.quadraticCurveTo(q,x,m,y)):(M=l,Math.abs(h-l)<2&&(M=0),e.moveTo(0,h),e.lineTo(p,h),e.quadraticCurveTo(q,x,m,y),e.lineTo(g,y),e.lineTo(g,M),e.lineTo(0,M))),e.closePath()}return clickcnt=0,lastdrawmouseup=null,mouseintarget=-1,"undefined"!=typeof initstack?initstack.push(initCanvases):$(function(){initCanvases()}),normslider={idnums:[],curslider:{el:null,startpos:[0,0],outnode:null}},"undefined"!=typeof initstack&&initstack.push(slideronpageload),drawexport={reset:reset,initCanvases:initCanvases,clearcanvas:clearcanvas,clearlastline:clearlastline,settool:settool,addnormslider:addnormslider,chgnormtype:chgnormtype,adda11ydraw:adda11ydraw,changea11ydraw:changea11ydraw,encodea11ydraw:encodea11ydraw,updatea11ydraw:updatea11ydraw,removea11ydraw:removea11ydraw},drawexport}(jQuery);!function(){"use strict";function n(e,t){var r=e.length-1,a=[e[0]];return function e(t,r,a,n,i){var s,g,l,u,o,c,d,T,p,h,m,y=n;for(g=r+1;g<a;g++)u=t[g],o=t[r],c=t[a],m=h=p=T=d=void 0,T=o[0],p=o[1],h=c[0]-T,m=c[1]-p,0===h&&0===m||(1<(d=((u[0]-T)*h+(u[1]-p)*m)/(h*h+m*m))?(T=c[0],p=c[1]):0<d&&(T+=h*d,p+=m*d)),y<(l=(h=u[0]-T)*h+(m=u[1]-p)*m)&&(s=g,y=l);n<y&&(1<s-r&&e(t,r,s,n,i),i.push(t[s]),1<a-s&&e(t,s,a,n,i))}(e,0,r,t,a),a.push(e[r]),a}window.pathsimplify=function(e,t,r){if(e.length<=2)return e;var a=void 0!==t?t*t:1;return e=n(e=r?e:function(e,t){var r,a,n,i,s,g,l,u=e[0],o=[u];for(a=1,n=e.length;a<n;a++)r=e[a],s=u,g=(i=r)[0]-s[0],l=i[1]-s[1],t<g*g+l*l&&(o.push(r),u=r);return u!==r&&o.push(r),o}(e,a),a)}}();
