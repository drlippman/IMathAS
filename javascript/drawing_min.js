var canvases=new Array,drawla=new Array,imathasDraw=function(e){var t=!1,n=new Array,l=new Array,o=new Array,a=new Array,r=new Array,h=new Array,s=new Array,d=new Array,m=new Array,u=new Array,g=null,p=[],c=[],f=null,v=null,y=["rgb(0,0,255)","rgb(255,0,0)","rgb(0,255,0)"],w=["rgba(0,0,255,.4)","rgba(255,0,0,.4)","rgba(0,255,0,.4)"],x="rgb(0,200,0)",b=null,T=null,M=null,E=!1,I=!1,N=!1,L=!1,B=null,P=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),q={5:2,5.1:2,5.2:2,5.3:2,5.4:2,6:2,6.1:2,6.2:2,6.3:2,6.5:2,6.6:2,6.7:3,7:2,7.2:2,7.4:2,7.5:2,8:2,8.2:2,8.3:2,8.4:2,8.5:3,8.6:3,9:2,9.1:2,9.2:3,10:3,10.2:3,10.3:3,10.4:3},S={7.4:1,7.5:1,8.2:1,8.5:1,8.6:1};function k(e,t){o[e]&&o[e].disabled&&!t||a.hasOwnProperty(e)&&(a[e].length=0,r[e].length=0,h[e].length=0,s[e].length=0,d[e].length=0,m[e].length=0,u[e].length=0,M=e,"canvas"==n[e].type&&D(),M=null,g=null,b=null)}function A(t,i,l){var g=t[0],p=t[13].split(","),c=!0;"noprev"==p[p.length-1]&&(c=!1,p.pop());var f=t[2],v=t[3],y=t[4],w=t[5];y==w&&(y=-1,w=1);var x=t[6],b=t[7],T=t[8],M=document.getElementById("a11ydraw"+g);if(null==M){var E=document.getElementById("canvas"+g);if(E&&!c){var I=e("<div>").append(e("<p>",{text:_("Drawn Elements:")}));(M=document.createElement("ul")).setAttribute("id","allydraw"+g),I.append(M),e(E).replaceWith(I)}}o[g]=document.getElementById("qn"+g);var N,L=!!document.getElementById("a11ydrawnew"+g);o[g].disabled&&(L&&(document.getElementById("a11ydrawnew"+g).disabled=!0),e(".a11ydrawadd[data-qn="+g+"]").prop("disabled",!0)),n[g]={type:"a11y",el:M,vispreview:c,xmin:f,xmax:v,ymin:y,ymax:w,imgborder:x,imgwidth:b,imgheight:T},c&&(n[g].canv=document.getElementById("canvas"+g)),n[g].pixperx=(b-2*x)/(v-f),n[g].pixpery=y==w?1:(T-2*x)/(w-y),n[g].isnumberline="numberline"==p[0],"inequality"==p[0]?(N=p.shift(),0==p.length?p=["line"]:"both"==p[0]&&(p=["line","parab"])):"twopoint"==p[0]?(N=p.shift(),0==p.length&&(p=["line","parab","abs","circle","dot"])):"numberline"==p[0]?(N="numberline",p.shift()):N="basic",n[g].afgroup=N;var B={inequality:{line:[{mode:10,descr:_("Linear inequality with solid line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")},{mode:10.2,descr:_("Linear inequality with dashed line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")}],parab:[{mode:10.3,descr:_("Parabolic inequality with solid line"),inN:3,input:_("Enter the vertex, then another point on the parabola, then a third point in the shaded region")},{mode:10.4,descr:_("Parabolic inequality with dashed line"),inN:3,input:_("Enter the vertex, then another point on the parabola, then a third point in the shaded region")}],abs:[{mode:10.5,descr:_("Absolute value inequality with solid line"),inN:3,input:_("Enter the corner point of the absolute value, then another point on the graph, then a third point in the shaded region")},{mode:10.6,descr:_("Absolute value inequality with dashed line"),inN:3,input:_("Enter the corner point of the absolute value, then another point on the graph, then a third point in the shaded region")}]},twopoint:{line:[{mode:5,descr:_("Line"),inN:2,input:_("Enter two points on the line")}],dashedline:[{mode:5.1,descr:_("Dashed Line"),inN:2,input:_("Enter two points on the dashed line")}],lineseg:[{mode:5.3,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],ray:[{mode:5.2,descr:_("Ray"),inN:2,input:_("Enter the starting point of the ray and another point on the ray")}],parab:[{mode:6,descr:_("Parabola"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],"3pointparab":[{mode:6.7,descr:_("Parabola"),inN:3,input:_("Enter three points on the parabola")}],horizparab:[{mode:6.1,descr:_("Parabola opening right or left"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],halfparab:[{mode:6.2,descr:_("Half Parabola"),inN:2,input:_("Enter the vertex, then another point on the half parabola")}],cubic:[{mode:6.3,descr:_("Cubic"),inN:2,input:_("Enter the inflection point, then another point on the cubic")}],sqrt:[{mode:6.5,descr:_("Square root"),inN:2,input:_("Enter the starting point of the square root, then another point on the graph")}],cuberoot:[{mode:6.6,descr:_("Cube root"),inN:2,input:_("Enter the inflection point of the cube root, then another point on the graph")}],abs:[{mode:8,descr:_("Absolute value"),inN:2,input:_("Enter the corner point of the absolute value, then another point on the graph")}],rational:[{mode:8.2,descr:_("Rational"),inN:2,input:_("Enter the point where the vertical and horizontal asymptote cross, then a point on the graph")}],exp:[{mode:8.3,descr:_("Exponential"),inN:2,input:_("Enter two points on the graph")}],log:[{mode:8.4,descr:_("Logarithm"),inN:2,input:_("Enter two points on the graph")}],genexp:[{mode:8.5,descr:_("Shifted Exponential"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],genlog:[{mode:8.6,descr:_("Shifted Logarithm"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],circle:[{mode:7,descr:_("Circle"),inN:2,input:_("Enter the center point of the circle, then a point on the graph")}],ellipse:[{mode:7.2,descr:_("Ellipse"),inN:2,input:_("Enter the center point of the ellipse, then a point offset from the center by the horizontal radius and vertical radius")}],hyperbola:[{mode:7.4,descr:_("Vertical hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the co-vertex and y is the y-coordinate of the vertex")},{mode:7.5,descr:_("Horizontal hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the vertex and y is the y-coordinate of the co-vertex")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],trig:[{mode:9,descr:_("Cosine"),inN:2,input:_("Enter a point at the start of a phase, then a point half a phase further")},{mode:9.1,descr:_("Sine"),inN:2,input:_("Enter a point at the start of a phase, then a point a quarter phase further")}],tan:[{mode:9.2,descr:_("Tangent"),inN:3,input:_("Enter the inflection point of the tangent, then a point on a vertical asymptote, then a point on the graph")}],vector:[{mode:5.4,descr:_("Vector"),inN:2,input:_("Enter the starting and ending point of the vector")}]},basic:{line:[{mode:0,descr:_("Lines"),inN:"list",input:_("Enter a list of points to connect with lines")}],lineseg:[{mode:.5,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],freehand:[{mode:.7,descr:_("Freehand"),inN:"list",input:_("Enter a list of points to connect with lines")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],polygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter a list of points for dots to connect with lines"),dotline:1}],closedpolygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter a list of points for dots to connect with lines"),dotline:2}]},numberline:{lineseg:[{mode:.5,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending values of the line segment, separated by a comma")},{mode:.8,descr:_("Ray to the left"),inN:1,input:_("Enter the value the ray goes left from")},{mode:.9,descr:_("Ray to the right"),inN:1,input:_("Enter the value the ray goes right from")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the value of the solid dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the value of the open dot")}]}};null==a[g]&&(a[g]=new Array),null==r[g]&&(r[g]=new Array),null==h[g]&&(h[g]=new Array),null==s[g]&&(s[g]=new Array),null==d[g]&&(d[g]=new Array),null==m[g]&&(m[g]=new Array),null==u[g]&&(u[g]=new Array);for(var P,q,S=[],k=[],A=[],O=0;O<p.length;O++)if(B[N].hasOwnProperty(p[O])){0==O&&(P=B[N][p[O]][0].mode);for(var R=0;R<B[N][p[O]].length;R++)A[B[N][p[O]][R].mode]=B[N][p[O]][R],S.push(B[N][p[O]][R].mode),q='<option value="'+B[N][p[O]][R].mode+'"',q+=' data-af="'+p[O]+'">'+B[N][p[O]][R].descr+"</option>",k.push(q)}if(L&&(document.getElementById("a11ydrawnew"+g).innerHTML=k),n[g].defmode=P,n[g].inputmodes=S,n[g].selects=k,n[g].moderef=A,L||!c)if(null==i&&a.hasOwnProperty(g)){for(O=0;O<a[g].length;O++)C(g,0,W(a[g][O],g));for(O=0;O<r[g].length;O++)C(g,1,W(r[g][O],g));for(O=0;O<h[g].length;O++)C(g,2,W(h[g][O],g));for(O=0;O<s[g].length;O++)C(g,d[g][O],W(s[g][O][0],g)+","+W(s[g][O][1],g));for(O=0;O<m[g].length;O++)C(g,u[g][O],W(m[g][O][0],g)+","+W(m[g][O][1],g)+","+W(m[g][O][2],g))}else if(null!=i)for(O=0;O<i.length;O++)C(g,i[O][0],i[O][1].replace(/\[/g,"(").replace(/\]/g,")"));c&&j(n[g].canv,g,l,b,T,!0)}function C(t,i,l){var a=n[t],r=i||document.getElementById("a11ydrawnew"+t).value,h=l||"",s=(a.afgroup,a.el.getElementsByTagName("li").length+1),d=o[t].disabled?" disabled ":"",m='<span class="sr-only draweln">'+_("Drawing element ")+s+"</span>";html=m,html+=a.moderef[r].descr+".<br/>",html+='<label><span class="a11ydrawinstr"></span><br/>',html+='<input type="text" value="'+h+'" data-n="'+a.moderef[r].inN+'" '+d,html+='onblur="imathasDraw.updatea11ydraw(this)"/></label>',html+='<button type="button" class="imgbutton" onclick="imathasDraw.removea11ydraw(this)"'+d+">",html+=_("Remove")+" "+m+"</button>";var u=e("<li>",{class:"a11ydrawrow","data-mode":r}).html(html);e(a.el).append(u),u.find(".a11ydrawinstr").text(a.moderef[r].input),l||u.find("input").focus()}function W(e,t){var i,l,o=n[t];return i=(e[0]-o.imgborder)/o.pixperx+o.xmin,l=(o.imgheight-e[1]-o.imgborder)/o.pixpery+o.ymin,"("+(i=Math.round(100*i)/100)+","+(l=Math.round(100*l)/100)+")"}function O(t){void 0===t&&(t=-1);var i=M;for(var l in n)if(!(t>-1&&t!=l)){var g=n[l];if("a11y"==g.type){t>-1&&t==l&&(M=l),a[l].length=0,r[l].length=0,h[l].length=0,s[l].length=0,d[l].length=0,m[l].length=0,u[l].length=0;var p=[],c=[],f=[],v=[],y=[],w=[];n[l].afgroup;e("#a11ydraw"+l).find(".a11ydrawrow").each(function(t,i){var o=e(i).find("input").val(),x=i.getAttribute("data-mode"),b=e(i).find("input").attr("data-n");.8!=x&&.9!=x||b++,w.push("["+x+',"'+o+'"]');var T=[],M=[];if(n[l].isnumberline&&!o.match(/\(/)){var E=g.imgheight-(0-g.ymin)*g.pixpery-g.imgborder;o=o.split(/\s*,\s*/);for(t=0;t<o.length;t+=1){if("oo"===o[t])o[t]=g.xmax;else if("-oo"===o[t])o[t]=g.xmin;else try{o[t]=evalMathParser(o[t])}catch(e){o[t]=NaN}if(o[t]=(o[t]-g.xmin)*g.pixperx+g.imgborder,.8==x&&1==o.length){T.push(Math.round(0)+","+Math.round(E)),M.push([0,E])}if(T.push(Math.round(o[t])+","+Math.round(E)),M.push([o[t],E]),.9==x&&1==o.length){var _=g.imgwidth;T.push(Math.round(_)+","+Math.round(E)),M.push([_,E])}}}else{o=o.replace(/[\(\)]/g,"").split(/\s*,\s*/);for(t=1;t<o.length;t+=2){if("oo"===o[t-1])o[t-1]=g.xmax;else if("-oo"===o[t-1])o[t-1]=g.xmin;else try{o[t-1]=evalMathParser(o[t-1])}catch(e){o[t-1]=NaN}try{o[t]=evalMathParser(o[t])}catch(e){o[t]=NaN}o[t-1]=(o[t-1]-g.xmin)*g.pixperx+g.imgborder,o[t]=g.imgheight-(o[t]-g.ymin)*g.pixpery-g.imgborder,T.push(Math.round(o[t-1])+","+Math.round(o[t])),M.push([o[t-1],o[t]])}}"list"!==b&&b!=T.length||(1==x?(c.push("("+T.join("),(")+")"),r[l].push(M)):2==x?(f.push("("+T.join("),(")+")"),h[l].push(M)):x<1?(p.push("("+T.join("),(")+")"),a[l].push(M)):x>=5&&x<10?(v.push("("+x+","+T.join(",")+")"),s[l].push(M),d[l].push(x)):x>=10&&(y.push("("+x+","+T.join(",")+")"),m[l].push(M),u[l].push(x)))}),o[l].value=p.join(";")+";;"+c.join(",")+";;"+f.join(",")+";;"+v.join(",")+";;"+y.join(",")+";;"+w.join(","),e(o[l]).trigger("input").trigger("change")}}t>-1&&n[t].vispreview&&D(null,null,!0),M=i}function R(t,i,l,g,f,v,y,w,x,b,T,M,E,_,I){var N=document.getElementById(i);e(N).is(":hidden")&&e(N).on("mouseover.imathasdrawwait touchstart.imathasdrawwait",function(){e(N).off("mouseover.imathasdrawwait touchstart.imathasdrawwait"),te(t)}),N.style.userSelect="none",N.style.webkitUserSelect="none",N.style.MozUserSelect="none";var L=$(N);n[t]={type:"canvas",el:N,left:L.x,top:L.y,width:N.offsetWidth,height:N.offsetHeight,xmin:f,xmax:v,ymin:y,ymax:w,imgborder:x,imgwidth:b,imgheight:T,mode:M,dotline:E},"string"==typeof I&&-1!=I.indexOf(":")?(I=I.split(":"),n[t].snaptogridx=1*I[0],n[t].snaptogridy=1*I[1]):(n[t].snaptogridx=1*I,n[t].snaptogridy=1*I),n[t].pixperx=(b-2*x)/(v-f),n[t].pixpery=y==w?1:(T-2*x)/(w-y),o[t]=document.getElementById(g),null==a[t]&&(a[t]=new Array),null==r[t]&&(r[t]=new Array),null==h[t]&&(h[t]=new Array),null==s[t]&&(s[t]=new Array),null==d[t]&&(d[t]=new Array),null==m[t]&&(m[t]=new Array),null==u[t]&&(u[t]=new Array),p[t]=M>=5?1:0,c[t]=_,j(N,t,l,b,T,!1)}function j(t,n,i,o,a,r){if(i.match(/initPicture/)){0==e(t).closest(".drawcanvasholder").length&&(e(t).removeClass("drawcanvas").wrap(e("<div>",{class:"drawcanvas",style:"position:relative;width:"+o+"px;height:"+a+"px"})).wrap(e("<div>",{class:"drawcanvasholder",style:"position:absolute;top:0;left:0;z-index:2"})),e(t).closest(".drawcanvas").prepend(e("<div>",{class:"canvasbg",style:"position:absolute;top:0;left:0"}).append(e("<embed>",{"data-nomag":1,type:"image/svg+xml",align:"middle",width:o,height:a,script:i}).attr("width",o).attr("height",a)))),l[n]=null;var h=M;M=n,D(null,null,r),setTimeout(function(){window.drawPics(e(t).closest(".drawcanvas")[0])},30),M=h}else if(""!==i)l[n]=new Image,l[n].onload=function(){var e=M;M=n,D(null,null,r),M=e},l[n].src=i;else{l[n]=null;h=M;M=n,D(null,null,r),M=h}}function D(t,i,p){try{if(n[M].canv)var T=n[M].canv.getContext("2d");else T=n[M].el.getContext("2d")}catch(e){E||(E=!0,alert("Your browser does not support drawing answer entry.  Please try again using Internet Explorer 6+ (Windows), FireFox 1.5+ (Win/Mac), Safari 1.3+ (Mac), Opera 9+ (Win/Mac), or Camino (Mac)"))}T.fillStyle="rgb(0,0,255)",T.lineWidth=2,T.strokeStyle="rgb(0,0,255)",T.clearRect(0,0,n[M].imgwidth,n[M].imgheight),null!==l[M]&&T.drawImage(l[M],0,0),T.beginPath();for(var _=0;_<m[M].length;_++){var I=_%3;T.strokeStyle=y[I],T.fillStyle=y[I];var N=null,L=null,B=null,P=null,k=null;if(3==m[M][_].length?(L=m[M][_][1][0],P=m[M][_][1][1],B=m[M][_][2][0],k=m[M][_][2][1]):2==m[M][_].length?(L=m[M][_][1][0],P=m[M][_][1][1],B=t,k=i):v==_&&null!=t&&1==m[M][_].length&&(L=t,P=i),null!=B){if(T.save(),T.fillStyle=w[I],T.beginPath(),u[M][_]<=10.2){if(L!=m[M][_][0][0])N=(P-m[M][_][0][1])/(L-m[M][_][0][0]);if(Math.abs(L-m[M][_][0][0])<1||Math.abs(N)>100)T.moveTo(m[M][_][0][0],0),T.lineTo(m[M][_][0][0],n[M].imgheight),B>L?(T.lineTo(n[M].imgwidth,n[M].imgheight),T.lineTo(n[M].imgwidth,0),T.closePath()):(T.lineTo(0,n[M].imgheight),T.lineTo(0,0),T.closePath());else{var A=N*(B-L)+P,C=m[M][_][0][1]-N*m[M][_][0][0],W=m[M][_][0][1]+N*(n[M].imgwidth-m[M][_][0][0]);T.moveTo(0,C),T.lineTo(n[M].imgwidth,W),k>A?(T.lineTo(n[M].imgwidth,n[M].imgheight),T.lineTo(0,n[M].imgheight),T.closePath()):(T.lineTo(n[M].imgwidth,0),T.lineTo(0,0),T.closePath())}}else if(u[M][_]<=10.4)me(T,m[M][_][0][0],m[M][_][0][1],L,P,B,k,n[M].imgwidth,n[M].imgheight);else if(Math.abs(L-m[M][_][0][0])>1){N=(P-m[M][_][0][1])/(L-m[M][_][0][0]);L<m[M][_][0][0]&&(N*=-1);A=N*Math.abs(B-m[M][_][0][0])+m[M][_][0][1],C=m[M][_][0][1]+N*m[M][_][0][0],W=m[M][_][0][1]+N*(n[M].imgwidth-m[M][_][0][0]);k>A?(T.moveTo(n[M].imgwidth,n[M].imgheight),T.lineTo(0,n[M].imgheight)):(T.moveTo(n[M].imgwidth,0),T.lineTo(0,0)),T.lineTo(0,C),T.lineTo(m[M][_][0][0],m[M][_][0][1]),T.lineTo(n[M].imgwidth,W)}T.fill(),T.restore()}if(T.beginPath(),null!=L)if(u[M][_]<=10.2){if(L!=m[M][_][0][0])N=(P-m[M][_][0][1])/(L-m[M][_][0][0]);if(Math.abs(L-m[M][_][0][0])<1||Math.abs(N)>100)10.2==u[M][_]?null!=b&&b.mode>=10&&b.mode<11&&b.num==_&&0==b.subnum?(T.dashedLine(m[M][_][1][0],m[M][_][1][1],m[M][_][1][0],n[M].imgheight),T.dashedLine(m[M][_][1][0],m[M][_][1][1],m[M][_][1][0],0)):(T.dashedLine(m[M][_][0][0],m[M][_][0][1],m[M][_][0][0],n[M].imgheight),T.dashedLine(m[M][_][0][0],m[M][_][0][1],m[M][_][0][0],0)):(T.moveTo(m[M][_][0][0],0),T.lineTo(m[M][_][0][0],n[M].imgheight),T.stroke());else{C=m[M][_][0][1]-N*m[M][_][0][0],W=m[M][_][0][1]+N*(n[M].imgwidth-m[M][_][0][0]);10.2==u[M][_]?null!=b&&b.mode>=10&&b.mode<11&&b.num==_&&0==b.subnum?(T.dashedLine(m[M][_][1][0],m[M][_][1][1],n[M].imgwidth,W),T.dashedLine(m[M][_][1][0],m[M][_][1][1],0,C)):(T.dashedLine(m[M][_][0][0],m[M][_][0][1],n[M].imgwidth,W),T.dashedLine(m[M][_][0][0],m[M][_][0][1],0,C)):(T.moveTo(0,C),T.lineTo(n[M].imgwidth,W),T.stroke())}}else if(u[M][_]<=10.4)if(10.3==u[M][_]){if(L!=m[M][_][0][0])if(P==m[M][_][0][1])T.moveTo(0,P),T.lineTo(n[M].imgwidth,P);else{var O=(P-m[M][_][0][1])/((L-m[M][_][0][0])*(L-m[M][_][0][0]));if(P>m[M][_][0][1])var R=Math.sqrt((n[M].imgheight-m[M][_][0][1])/O)+m[M][_][0][0],j=-1*Math.sqrt((n[M].imgheight-m[M][_][0][1])/O)+m[M][_][0][0],D=m[M][_][0][1]-(n[M].imgheight-m[M][_][0][1]),z=n[M].imgheight;else R=Math.sqrt((0-m[M][_][0][1])/O)+m[M][_][0][0],j=-1*Math.sqrt((0-m[M][_][0][1])/O)+m[M][_][0][0],D=2*m[M][_][0][1],z=0;var F=(Z=R+2/3*(m[M][_][0][0]-R))+(j-R)/3,Y=$=z+2/3*(D-z);T.moveTo(R,z),T.bezierCurveTo(Z,$,F,Y,j,z)}T.stroke()}else L!=m[M][_][0][0]&&de(T,m[M][_][0][0],m[M][_][0][1],L,P,n[M].imgwidth,n[M].imgheight);else if(L!=m[M][_][0][0]){N=(P-m[M][_][0][1])/(L-m[M][_][0][0]);L<m[M][_][0][0]&&(N*=-1);C=m[M][_][0][1]+N*m[M][_][0][0],W=m[M][_][0][1]+N*(n[M].imgwidth-m[M][_][0][0]);10.6==u[M][_]?(null!=b&&b.mode>=10&&b.mode<11&&b.num==_&&b.subnum,T.dashedLine(m[M][_][0][0],m[M][_][0][1],n[M].imgwidth,W),T.dashedLine(m[M][_][0][0],m[M][_][0][1],0,C)):(T.moveTo(0,C),T.lineTo(m[M][_][0][0],m[M][_][0][1]),T.lineTo(n[M].imgwidth,W),T.stroke())}if(u[M][_]==n[M].mode){T.beginPath();for(var U=0;U<m[M][_].length;U++)2==U?(T.arc(m[M][_][U][0],m[M][_][U][1],4,0,2*Math.PI,!0),T.fill()):T.fillRect(m[M][_][U][0]-3,m[M][_][U][1]-3,6,6);1==m[M][_].length&&null!=L&&T.fillRect(L-3,P-3,6,6)}T.beginPath()}T.fillStyle="rgb(0,0,255)",1==c[M]?T.lineWidth=4:T.lineWidth=2,T.strokeStyle="rgb(0,0,255)";for(_=0;_<s[M].length;_++){if(d[M][_]>=5&&d[M][_]<6){var X;N=null,L=null,P=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L)if(5.3==d[M][_]||5.4==d[M][_]){if(T.moveTo(s[M][_][0][0],s[M][_][0][1]),T.lineTo(L,P),5.4==d[M][_]){var V=[L-s[M][_][0][0],P-s[M][_][0][1]],G=Math.sqrt(V[0]*V[0]+V[1]*V[1]);G>1e-4&&(X=[-(V=[V[0]/G,V[1]/G])[1],V[0]],T.moveTo(L-15*V[0]-4*X[0],P-15*V[1]-5*X[1]),T.lineTo(L,P),T.moveTo(L-15*V[0]+4*X[0],P-15*V[1]+5*X[1]),T.lineTo(L,P))}}else{if(L!=s[M][_][0][0])N=(P-s[M][_][0][1])/(L-s[M][_][0][0]);if(Math.abs(L-s[M][_][0][0])<1||Math.abs(N)>100)5.1==d[M][_]?T.dashedLine(s[M][_][0][0],0,s[M][_][0][0],n[M].imgheight):5.2==d[M][_]?(T.moveTo(s[M][_][0][0],s[M][_][0][1]),P>s[M][_][0][1]?T.lineTo(s[M][_][0][0],n[M].imgheight):T.lineTo(s[M][_][0][0],0)):(T.moveTo(s[M][_][0][0],0),T.lineTo(s[M][_][0][0],n[M].imgheight));else{C=s[M][_][0][1]-N*s[M][_][0][0],W=s[M][_][0][1]+N*(n[M].imgwidth-s[M][_][0][0]),C=s[M][_][0][1]-N*s[M][_][0][0],W=s[M][_][0][1]+N*(n[M].imgwidth-s[M][_][0][0]);5.1==d[M][_]?(T.dashedLine(s[M][_][0][0],s[M][_][0][1],n[M].imgwidth,W),T.dashedLine(s[M][_][0][0],s[M][_][0][1],0,C)):5.2==d[M][_]?(T.moveTo(s[M][_][0][0],s[M][_][0][1]),L>s[M][_][0][0]?T.lineTo(n[M].imgwidth,W):T.lineTo(0,C)):(T.moveTo(0,C),T.lineTo(n[M].imgwidth,W))}}}else if(6==d[M][_]||6.1==d[M][_]||6.2==d[M][_]){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L)if(6==d[M][_])if(P==s[M][_][0][1])T.moveTo(0,P),T.lineTo(n[M].imgwidth,P);else if(L==s[M][_][0][0])T.moveTo(L,s[M][_][0][1]),P>s[M][_][0][1]?T.lineTo(L,n[M].imgheight):T.lineTo(L,0);else{O=(P-s[M][_][0][1])/((L-s[M][_][0][0])*(L-s[M][_][0][0]));if(P>s[M][_][0][1])R=Math.sqrt((n[M].imgheight-s[M][_][0][1])/O)+s[M][_][0][0],j=-1*Math.sqrt((n[M].imgheight-s[M][_][0][1])/O)+s[M][_][0][0],D=s[M][_][0][1]-(n[M].imgheight-s[M][_][0][1]),z=n[M].imgheight;else R=Math.sqrt((0-s[M][_][0][1])/O)+s[M][_][0][0],j=-1*Math.sqrt((0-s[M][_][0][1])/O)+s[M][_][0][0],D=2*s[M][_][0][1],z=0;F=(Z=R+2/3*(s[M][_][0][0]-R))+(j-R)/3,Y=$=z+2/3*(D-z);T.moveTo(R,z),T.bezierCurveTo(Z,$,F,Y,j,z)}else if(6.1==d[M][_])if(L==s[M][_][0][0])T.moveTo(L,0),T.lineTo(L,n[M].imgheight);else if(P==s[M][_][0][1])T.moveTo(s[M][_][0][0],P),L>s[M][_][0][0]?T.lineTo(n[M].imgwidth,P):T.lineTo(0,P);else{O=(L-s[M][_][0][0])/((P-s[M][_][0][1])*(P-s[M][_][0][1]));if(L>s[M][_][0][0]){R=Math.sqrt((n[M].imgwidth-s[M][_][0][0])/O)+s[M][_][0][1],j=-1*Math.sqrt((n[M].imgwidth-s[M][_][0][0])/O)+s[M][_][0][1];var J=s[M][_][0][0]-(n[M].imgwidth-s[M][_][0][0]),Q=n[M].imgwidth}else R=Math.sqrt((0-s[M][_][0][0])/O)+s[M][_][0][1],j=-1*Math.sqrt((0-s[M][_][0][0])/O)+s[M][_][0][1],J=2*s[M][_][0][0],Q=0;Y=($=R+2/3*(s[M][_][0][1]-R))+(j-R)/3,F=Z=Q+2/3*(J-Q);T.moveTo(Q,R),T.bezierCurveTo(Z,$,F,Y,Q,j)}else if(6.2==d[M][_])if(P==s[M][_][0][1])T.moveTo(s[M][_][0][0],P),T.lineTo(L<s[M][_][0][0]?0:n[M].imgwidth,P);else if(L==s[M][_][0][0])T.moveTo(L,s[M][_][0][1]),P>s[M][_][0][1]?T.lineTo(L,n[M].imgheight):T.lineTo(L,0);else{O=(P-s[M][_][0][1])/((L-s[M][_][0][0])*(L-s[M][_][0][0])),s[M][_][0][0];if(P>s[M][_][0][1]){var K=Math.sqrt((n[M].imgheight-s[M][_][0][1])/O);z=n[M].imgheight}else K=Math.sqrt((0-s[M][_][0][1])/O),z=0;L<s[M][_][0][0]&&(K*=-1);var Z=s[M][_][0][0]+1/3*K,$=s[M][_][0][1];F=s[M][_][0][0]+2/3*K,Y=s[M][_][0][1]+1/3*O*K*K;T.moveTo(s[M][_][0][0],s[M][_][0][1]),T.bezierCurveTo(Z,$,F,Y,s[M][_][0][0]+K,z)}}else if(6.7==d[M][_]){P=null,L=null,k=null,B=null;if(3==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1],B=s[M][_][2][0],k=s[M][_][2][1]):2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1],B=t,k=i):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=B&&ee!=L&&L!=B){var ee=s[M][_][0][0];if((Me=s[M][_][0][1])==P&&k==P)T.moveTo(0,k),T.lineTo(n[M].imgwidth,k);else{var te=-(ce=(P-Me)/(L-ee)-(fe=(ee*(k-P)+L*(Me-k)+B*(P-Me))/((ee-L)*(ee-B)*(L-B)))*(ee+L))/(2*fe),ne=(4*fe*(Me-fe*ee*ee-ce*ee)-ce*ce)/(4*fe);if(fe>0)R=Math.sqrt((n[M].imgheight-ne)/fe)+te,j=-1*Math.sqrt((n[M].imgheight-ne)/fe)+te,D=ne-(n[M].imgheight-ne),z=n[M].imgheight;else R=Math.sqrt((0-ne)/fe)+te,j=-1*Math.sqrt((0-ne)/fe)+te,D=2*ne,z=0;F=(Z=R+2/3*(te-R))+(j-R)/3,Y=$=z+2/3*(D-z);T.moveTo(R,z),T.bezierCurveTo(Z,$,F,Y,j,z)}}}else if(6.5==d[M][_]){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L&&L!=s[M][_][0][0])if(P==s[M][_][0][1])T.moveTo(s[M][_][0][0],P),L>s[M][_][0][0]?T.lineTo(n[M].imgwidth,P):T.lineTo(0,P);else{var ie=L<s[M][_][0][0]?-1:1;O=(P-s[M][_][0][1])/Math.sqrt(ie*(L-s[M][_][0][0]));T.moveTo(s[M][_][0][0],s[M][_][0][1]),oe=s[M][_][0][0],le=s[M][_][0][1];do{oe+=3*ie,le=O*Math.sqrt(ie*(oe-s[M][_][0][0]))+s[M][_][0][1],T.lineTo(oe,le)}while(oe>0&&oe<n[M].imgwidth&&le>0&&le<n[M].imgheight)}}else if(6.3==d[M][_]){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L&&L!=s[M][_][0][0])if(P==s[M][_][0][1])T.moveTo(0,P),T.lineTo(n[M].imgwidth,P);else{O=(P-s[M][_][0][1])/safepow(L-s[M][_][0][0],3);for(var le=0,oe=0;oe<n[M].imgwidth+4;oe+=1)(le=O*safepow(oe-s[M][_][0][0],3)+s[M][_][0][1])<-100&&(le=-100),le>n[M].imgheight+100&&(le=n[M].imgheight+100),0==oe?T.moveTo(oe,le):T.lineTo(oe,le)}}else if(6.6==d[M][_]){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L&&L!=s[M][_][0][0])if(P==s[M][_][0][1])T.moveTo(0,P),T.lineTo(n[M].imgwidth,P);else for(O=(P-s[M][_][0][1])/safepow(L-s[M][_][0][0],1/3),le=0,oe=0;oe<n[M].imgwidth+4;oe+=1)(le=O*safepow(oe-s[M][_][0][0],1/3)+s[M][_][0][1])<-100&&(le=-100),le>n[M].imgheight+100&&(le=n[M].imgheight+100),0==oe?T.moveTo(oe,le):T.lineTo(oe,le)}else if(d[M][_]>=7&&d[M][_]<8){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L&&(L!=s[M][_][0][0]||P!=s[M][_][0][1]))if(7==d[M][_]){var ae=Math.abs(L-s[M][_][0][0]),re=Math.abs(P-s[M][_][0][1]),he=ae/n[M].pixperx,se=re/n[M].pixpery,ue=Math.sqrt(he*he+se*se);T.save(),T.beginPath();var ge=ue*n[M].pixperx,pe=ue*n[M].pixpery;T.translate(s[M][_][0][0]-ge,s[M][_][0][1]-pe),T.scale(ge,pe),T.arc(1,1,1,0,2*Math.PI,!1),T.restore()}else if(7.2==d[M][_]){ge=Math.abs(L-s[M][_][0][0]),pe=Math.abs(P-s[M][_][0][1]);(f==_||null!=b&&b.num==_)&&(T.strokeStyle="rgb(0,255,255)",T.lineWidth=1,T.dashedLine(L,P,L-2*(L-s[M][_][0][0]),P,5),T.dashedLine(L,P,L,P-2*(P-s[M][_][0][1]),5),T.dashedLine(L,P-2*(P-s[M][_][0][1]),L-2*(L-s[M][_][0][0]),P-2*(P-s[M][_][0][1]),5),T.dashedLine(L-2*(L-s[M][_][0][0]),P,L-2*(L-s[M][_][0][0]),P-2*(P-s[M][_][0][1]),5),T.lineWidth=2),T.strokeStyle="rgb(0,0,255)",T.save(),T.beginPath(),T.translate(s[M][_][0][0]-ge,s[M][_][0][1]-pe),T.scale(ge,pe),T.arc(1,1,1,0,2*Math.PI,!1),T.restore()}else if(7.4==d[M][_]){var ce=Math.abs(L-s[M][_][0][0]),fe=Math.abs(P-s[M][_][0][1]),ve=Math.abs(fe/ce);T.strokeStyle=x,T.dashedLine(s[M][_][0][0],s[M][_][0][1],n[M].imgwidth,s[M][_][0][1]+ve*(n[M].imgwidth-s[M][_][0][0])),T.dashedLine(s[M][_][0][0],s[M][_][0][1],n[M].imgwidth,s[M][_][0][1]-ve*(n[M].imgwidth-s[M][_][0][0])),T.dashedLine(s[M][_][0][0],s[M][_][0][1],0,s[M][_][0][1]-ve*s[M][_][0][0]),T.dashedLine(s[M][_][0][0],s[M][_][0][1],0,s[M][_][0][1]+ve*s[M][_][0][0]),(f==_||null!=b&&b.num==_)&&(T.strokeStyle="rgb(0,255,255)",T.lineWidth=1,T.dashedLine(L,P,L-2*(L-s[M][_][0][0]),P,5),T.dashedLine(L,P,L,P-2*(P-s[M][_][0][1]),5),T.dashedLine(L,P-2*(P-s[M][_][0][1]),L-2*(L-s[M][_][0][0]),P-2*(P-s[M][_][0][1]),5),T.dashedLine(L-2*(L-s[M][_][0][0]),P,L-2*(L-s[M][_][0][0]),P-2*(P-s[M][_][0][1]),5),T.lineWidth=2),T.beginPath(),T.strokeStyle="rgb(0,0,255)";for(oe=0;oe<n[M].imgwidth+4;oe+=3)(le=s[M][_][0][1]+Math.sqrt((Math.pow(oe-s[M][_][0][0],2)/(ce*ce)+1)*fe*fe))<-100&&(le=-100),le>n[M].imgheight+100&&(le=n[M].imgheight+100),0==oe?T.moveTo(oe,le):T.lineTo(oe,le);T.stroke(),T.beginPath();for(oe=0;oe<n[M].imgwidth+4;oe+=3)(le=s[M][_][0][1]-Math.sqrt((Math.pow(oe-s[M][_][0][0],2)/(ce*ce)+1)*fe*fe))<-100&&(le=-100),le>n[M].imgheight+100&&(le=n[M].imgheight+100),0==oe?T.moveTo(oe,le):T.lineTo(oe,le)}else if(7.5==d[M][_]){fe=Math.abs(L-s[M][_][0][0]),ce=Math.abs(P-s[M][_][0][1]),ve=Math.abs(ce/fe);T.strokeStyle=x,T.dashedLine(s[M][_][0][0],s[M][_][0][1],n[M].imgwidth,s[M][_][0][1]+ve*(n[M].imgwidth-s[M][_][0][0])),T.dashedLine(s[M][_][0][0],s[M][_][0][1],n[M].imgwidth,s[M][_][0][1]-ve*(n[M].imgwidth-s[M][_][0][0])),T.dashedLine(s[M][_][0][0],s[M][_][0][1],0,s[M][_][0][1]-ve*s[M][_][0][0]),T.dashedLine(s[M][_][0][0],s[M][_][0][1],0,s[M][_][0][1]+ve*s[M][_][0][0]),(f==_||null!=b&&b.num==_)&&(T.strokeStyle="rgb(0,255,255)",T.lineWidth=1,T.dashedLine(L,P,L-2*(L-s[M][_][0][0]),P,5),T.dashedLine(L,P,L,P-2*(P-s[M][_][0][1]),5),T.dashedLine(L,P-2*(P-s[M][_][0][1]),L-2*(L-s[M][_][0][0]),P-2*(P-s[M][_][0][1]),5),T.dashedLine(L-2*(L-s[M][_][0][0]),P,L-2*(L-s[M][_][0][0]),P-2*(P-s[M][_][0][1]),5),T.lineWidth=2),T.beginPath(),T.strokeStyle="rgb(0,0,255)";for(le=0;le<n[M].imgwidth+4;le+=3)(oe=s[M][_][0][0]+Math.sqrt((Math.pow(le-s[M][_][0][1],2)/(ce*ce)+1)*fe*fe))<-100&&(oe=-100),oe>n[M].imgwidth+100&&(oe=n[M].imgwidth+100),0==le?T.moveTo(oe,le):T.lineTo(oe,le);T.stroke(),T.beginPath();for(le=0;le<n[M].imgwidth+4;le+=3)(oe=s[M][_][0][0]-Math.sqrt((Math.pow(le-s[M][_][0][1],2)/(ce*ce)+1)*fe*fe))<-100&&(oe=-100),oe>n[M].imgwidth+100&&(oe=n[M].imgwidth+100),0==le?T.moveTo(oe,le):T.lineTo(oe,le)}}else if(8==d[M][_]){N=null,L=null,P=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L){if(L!=s[M][_][0][0]){N=(P-s[M][_][0][1])/(L-s[M][_][0][0]);L<s[M][_][0][0]&&(N*=-1)}if(Math.abs(L-s[M][_][0][0])<1||Math.abs(N)>100)T.moveTo(s[M][_][0][0],s[M][_][0][1]),P>s[M][_][0][1]?T.lineTo(s[M][_][0][0],n[M].imgheight):T.lineTo(s[M][_][0][0],0);else{C=s[M][_][0][1]+N*s[M][_][0][0],W=s[M][_][0][1]+N*(n[M].imgwidth-s[M][_][0][0]);T.moveTo(0,C),T.lineTo(s[M][_][0][0],s[M][_][0][1]),T.lineTo(n[M].imgwidth,W)}}}else if(8.3==d[M][_]){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L&&L!=s[M][_][0][0])if(P==s[M][_][0][1])T.moveTo(0,P),T.lineTo(n[M].imgwidth,P);else{var ye=n[M].ymax*n[M].pixpery+n[M].imgborder,we=ye-s[M][_][0][1];if(we*(Ee=ye-P)>0&&L!=s[M][_][0][0]){var xe=safepow(Ee/we,1/(L-s[M][_][0][0]));O=Ee/safepow(xe,L);T.moveTo(s[M][_][0][0],s[M][_][0][1]);for(le=0,oe=0;oe<n[M].imgwidth+4;oe+=3)(le=ye-O*safepow(xe,oe))<-100&&(le=-100),le>n[M].imgheight+100&&(le=n[M].imgheight+100),0==oe?T.moveTo(oe,le):T.lineTo(oe,le)}}}else if(8.4==d[M][_]){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L&&L!=s[M][_][0][0]&&P!=s[M][_][0][1]){var be=-n[M].xmin*n[M].pixperx+n[M].imgborder,Te=be-s[M][_][0][0];if(Te*(Ie=be-L)>0&&P!=s[M][_][0][1]){xe=safepow(Ie/Te,1/(P-s[M][_][0][1])),O=Ie/safepow(xe,P);T.moveTo(s[M][_][0][0],s[M][_][0][1]);for(le=0,le=0;le<n[M].imgheight+4;le+=3)(oe=be-O*safepow(xe,le))<-100&&(oe=-100),oe>n[M].imgwidth+100&&(oe=n[M].imgwidth+100),0==le?T.moveTo(oe,le):T.lineTo(oe,le)}}}else if(8.5==d[M][_]){P=null,L=null,k=null,B=null;3==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1],B=s[M][_][2][0],k=s[M][_][2][1]):2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1],B=t,k=i):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i);var Me=s[M][_][0][1];if(T.strokeStyle=x,T.dashedLine(5,Me,n[M].imgwidth,Me),T.beginPath(),T.strokeStyle="rgb(0,0,255)",null!=B&&B!=L)if(k==P)T.moveTo(0,k),T.lineTo(n[M].imgwidth,k);else{var Ee,_e=Me-k;if((Ee=Me-P)*_e>0&&B!=L){xe=safepow(_e/Ee,1/(B-L)),O=_e/safepow(xe,B);T.moveTo(L,P);for(le=0,oe=0;oe<n[M].imgwidth+4;oe+=3)(le=Me-O*safepow(xe,oe))<-100&&(le=-100),le>n[M].imgheight+100&&(le=n[M].imgheight+100),0==oe?T.moveTo(oe,le):T.lineTo(oe,le)}}}else if(8.6==d[M][_]){P=null,L=null,k=null,B=null;3==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1],B=s[M][_][2][0],k=s[M][_][2][1]):2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1],B=t,k=i):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i);ee=s[M][_][0][0];if(T.strokeStyle=x,T.dashedLine(ee,5,ee,n[M].imgheight),T.beginPath(),T.strokeStyle="rgb(0,0,255)",null!=B&&B!=L&&k!=P){var Ie,Ne=B-ee;if((Ie=L-ee)*Ne>0){xe=safepow(Ne/Ie,1/(k-P)),O=Ne/safepow(xe,k);T.moveTo(L,P);for(oe=0,le=0;le<n[M].imgheight+4;le+=3)(oe=ee+O*safepow(xe,le))<-100&&(oe=-100),oe>n[M].imgwidth+100&&(oe=n[M].imgwidth+100),0==le?T.moveTo(oe,le):T.lineTo(oe,le)}}}else if(8.2==d[M][_]){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),T.strokeStyle=x,T.dashedLine(5,s[M][_][0][1],n[M].imgwidth,s[M][_][0][1]),T.dashedLine(s[M][_][0][0],5,s[M][_][0][0],n[M].imgheight),T.beginPath(),T.strokeStyle="rgb(0,0,255)",null!=L&&L!=s[M][_][0][0]&&P!=s[M][_][0][1]){for(O=(P-s[M][_][0][1])*(L-s[M][_][0][0]),oe=s[M][_][0][0]-1;oe>-4;oe-=3)(le=O/(oe-s[M][_][0][0])+s[M][_][0][1])<-100&&(le=-100),le>n[M].imgheight+100&&(le=n[M].imgheight+100),oe==s[M][_][0][0]-1?T.moveTo(oe,le):T.lineTo(oe,le);for(oe=s[M][_][0][0]+1;oe<n[M].imgwidth+4;oe+=3)(le=O/(oe-s[M][_][0][0])+s[M][_][0][1])<-100&&(le=-100),le>n[M].imgheight+100&&(le=n[M].imgheight+100),oe==s[M][_][0][0]+1?T.moveTo(oe,le):T.lineTo(oe,le);T.stroke()}}else if(9==d[M][_]||9.1==d[M][_]){P=null,L=null;if(2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1]):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i),null!=L&&L!=s[M][_][0][0])if(P==s[M][_][0][1])T.moveTo(0,P),T.lineTo(n[M].imgwidth,P);else{if(9==d[M][_])var Le=-1*Math.abs(P-s[M][_][0][1])/2,Be=(P+s[M][_][0][1])/2,Pe=(O=Math.PI/Math.abs(L-s[M][_][0][0]),P<s[M][_][0][1]?L:s[M][_][0][0]);else if(9.1==d[M][_])Le=-1*Math.abs(P-s[M][_][0][1]),Be=s[M][_][0][1],O=.5*Math.PI/Math.abs(L-s[M][_][0][0]),Pe=P<s[M][_][0][1]?L:L+2*Math.abs(L-s[M][_][0][0]);for(le=0,oe=0;oe<n[M].imgwidth+4;oe+=3)le=Le*Math.cos(O*(oe-Pe))+Be,0==oe?T.moveTo(oe,le):T.lineTo(oe,le)}}else if(9.2==d[M][_]){P=null,L=null,k=null,B=null;3==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1],B=s[M][_][2][0],k=s[M][_][2][1]):2==s[M][_].length?(L=s[M][_][1][0],P=s[M][_][1][1],B=t,k=i):f==_&&null!=t&&1==s[M][_].length&&(L=t,P=i);ee=s[M][_][0][0],Me=s[M][_][0][1];var qe=[];if(null!=L&&Math.abs(L-ee)>2){T.strokeStyle=x;Be=Me,Pe=ee;for(var Se=2*Math.round(Math.abs(L-ee)),ke=0;L+Se*ke<n[M].imgwidth;)T.dashedLine(L+Se*ke,0,L+Se*ke,n[M].imgheight),qe.push(L+Se*ke),ke++;for(ke=-1;L+Se*ke>0;)T.dashedLine(L+Se*ke,0,L+Se*ke,n[M].imgheight),qe.push(L+Se*ke),ke--;if(T.beginPath(),T.strokeStyle="rgb(0,0,255)",null!=B&&B!=L&&B!=ee&&k!=Me&&Math.round(Math.abs(2*(B-ee)))%Se!=0){O=Math.PI/Se,Le=(k-Me)/Math.tan(O*(B-ee));qe.push(n[M].imgwidth+1),qe.sort(function(e,t){return e-t});for(var Ae,Ce=0,We=0;We<qe.length;We++){Ae=qe[We],We>0&&(Ce=qe[We-1]+1);for(oe=Ce;oe<Ae;oe+=1)le=Le*Math.tan(O*(oe-Pe))+Be,(We>0&&oe==Ce||We<qe.length-1&&Ae-oe<=1)&&(le>Me&&le<n[M].imgheight?le=n[M].imgheight:le<Me&&le>0&&(le=0)),oe==Ce?T.moveTo(oe,le):T.lineTo(oe,le)}}}}T.stroke(),T.beginPath()}var Oe,Re,je,De;null===f&&S.hasOwnProperty(n[M].mode)&&(T.strokeStyle="rgb(200,200,200)",8.5==n[M].mode?T.dashedLine(5,i,n[M].imgwidth,i):8.6==n[M].mode?T.dashedLine(t,5,t,n[M].imgwidth):8.2==n[M].mode?(T.dashedLine(5,i,n[M].imgwidth,i),T.dashedLine(t,5,t,n[M].imgheight)):7.4!=n[M].mode&&7.5!=n[M].mode||(T.dashedLine(t,i,n[M].imgwidth,i+(n[M].imgwidth-t)),T.dashedLine(t,i,n[M].imgwidth,i-(n[M].imgwidth-t)),T.dashedLine(t,i,0,i-t),T.dashedLine(t,i,0,i+t)),T.beginPath(),T.strokeStyle="rgb(0,0,255)"),T.fillStyle="rgba(0,0,255,.5)";for(_=0;_<a[M].length;_++){T.beginPath();for(U=0;U<a[M][_].length;U++)0==U?(T.moveTo(a[M][_][U][0],a[M][_][U][1]),Oe=a[M][_][U][0],Re=a[M][_][U][1]):(T.lineTo(a[M][_][U][0],a[M][_][U][1]),je=a[M][_][U][0],De=a[M][_][U][1]);_==g&&null!=t&&(T.lineTo(t,i),je=t,De=i);var ze=.02*n[M].imgwidth;if(1==c[M]&&je>.98*n[M].imgwidth?(T.moveTo(je,De),T.lineTo(je-ze,De+ze),T.moveTo(je,De),T.lineTo(je-ze,De-ze)):1==c[M]&&Oe>.98*n[M].imgwidth&&(T.moveTo(Oe,Re),T.lineTo(Oe-ze,Re+ze),T.moveTo(Oe,Re),T.lineTo(Oe-ze,Re-ze)),1==c[M]&&je<.02*n[M].imgwidth?(T.moveTo(je,De),T.lineTo(je+ze,De+ze),T.moveTo(je,De),T.lineTo(je+ze,De-ze)):1==c[M]&&Oe<.02*n[M].imgwidth&&(T.moveTo(Oe,Re),T.lineTo(Oe+ze,Re+ze),T.moveTo(Oe,Re),T.lineTo(Oe+ze,Re-ze)),T.stroke(),n[M].dotline>1){if(a[M][_].length-1<1)continue;if(Math.pow(je-Oe,2)+Math.pow(De-Re,2)<25){T.moveTo(a[M][_][0][0],a[M][_][0][1]);for(U=1;U<a[M][_].length;U++)T.lineTo(a[M][_][U][0],a[M][_][U][1]);T.closePath(),T.fill()}}}T.fillStyle="rgb(0,0,255)",T.beginPath();for(_=0;_<r[M].length;_++)T.moveTo(r[M][_][0]+5,r[M][_][1]),T.arc(r[M][_][0],r[M][_][1],5,0,2*Math.PI,!0);if(T.fill(),n[M].dotline>0){T.beginPath();for(_=0;_<a[M].length;_++)for(U=0;U<a[M][_].length;U++)(0==U||Math.pow(a[M][_][U][0]-a[M][_][U-1][0],2)+Math.pow(a[M][_][U][1]-a[M][_][U-1][1],2)>25)&&(T.moveTo(a[M][_][U][0]+5,a[M][_][U][1]),T.arc(a[M][_][U][0],a[M][_][U][1],5,0,2*Math.PI,!0));T.fill()}T.fillStyle="rgb(255,255,255)",T.beginPath();for(_=0;_<h[M].length;_++)T.moveTo(h[M][_][0]+5,h[M][_][1]),T.arc(h[M][_][0],h[M][_][1],4,0,2*Math.PI,!0);n[M].mode<3?T.fill():T.stroke(),T.lineWidth=2,T.beginPath();for(_=0;_<h[M].length;_++)T.moveTo(h[M][_][0]+5,h[M][_][1]),T.arc(h[M][_][0],h[M][_][1],4,0,2*Math.PI,!0);T.stroke();for(_=0;_<s[M].length;_++)if(d[M][_]==n[M].mode){T.fillStyle="rgb(255,0,0)";for(U=0;U<s[M][_].length;U++)T.fillRect(s[M][_][U][0]-3,s[M][_][U][1]-3,6,6);s[M][_].length<q[n[M].mode]&&null!=t&&f==_&&T.fillRect(t-3,i-3,6,6),T.fillStyle="rgb(0,0,255)"}!0!==p&&function(){for(var t="",i=[],l=0;l<a[M].length;l++){a[M][l].length;i=0==n[M].dotline?pathsimplify(a[M][l]):a[M][l],0!=l&&(t+=";");for(var g=0;g<i.length;g++)0!=g&&(t+=","),t+="("+H(i[g][0],4)+","+H(i[g][1],4)+")"}t+=";;";for(l=0;l<r[M].length;l++)0!=l&&(t+=","),t+="("+H(r[M][l][0],4)+","+H(r[M][l][1],4)+")";t+=";;";for(l=0;l<h[M].length;l++)0!=l&&(t+=","),t+="("+H(h[M][l][0],4)+","+H(h[M][l][1],4)+")";t+=";;";var p=[],c="";for(l=0;l<s[M].length;l++)if(s[M][l].length==q[d[M][l]]){c="("+d[M][l];for(g=0;g<s[M][l].length;g++)c+=","+H(s[M][l][g][0],4)+","+H(s[M][l][g][1],4);p.push(c+")")}t+=p.join(","),t+=";;";var f=[];for(l=0;l<m[M].length;l++)m[M][l].length>2&&f.push("("+u[M][l]+","+H(m[M][l][0][0],4)+","+H(m[M][l][0][1],4)+","+H(m[M][l][1][0],4)+","+H(m[M][l][1][1],4)+","+H(m[M][l][2][0],4)+","+H(m[M][l][2][1],4)+")");if(t+=f.join(","),o[M].value!=t){var v=""!=o[M].value||";;;;;;;;"!=t;o[M].value=t,v&&e(o[M]).trigger("input").trigger("change")}}()}function z(e,t){1==e?r[M].splice(t,1):2==e?h[M].splice(t,1):e>=0&&e<1?a[M].splice(t,1):e>=5&&e<10?(s[M].splice(t,1),d[M].splice(t,1),f=null):e>=10&&e<11&&(m[M].splice(t,1),u[M].splice(t,1),v=null),D()}function H(e,t){return Math.round(e)}function F(l){if(ee(),I&&l.originalEvent.touches.length>1)return N=!0,e(document).on("touchend.imathasdraw",X),!0;I?(window.clearTimeout(B),e(document).off("mousemove.imathasdraw"),e(".drawcanvas").on("touchstart.imathasdraw",function(e){I=!0,F(e)}),e(".drawcanvas").on("touchmove.imathasdraw",G),e(document).on("touchend.imathasdraw",X),e(document).on("touchcancel.imathasdraw",X)):(e(document).on("mousemove.imathasdraw",G),e(document).on("mouseup.imathasdraw",X));var p=Q(l);if(null==M||null==g&&null==f&&null==v)for(i in n){if(!e(n[i].el).is(":hidden")&&"canvas"==n[i].type)if((y=$(n[i].el)).x<p.x&&y.x+n[i].width>p.x&&y.y<p.y&&y.y+n[i].height>p.y&&l.target==n[i].el){M=i;break}}if(null!=M){if(o[M].disabled)return;l.preventDefault(),t=!0;var y=$(n[M].el),w={x:p.x-y.x,y:p.y-y.y};if(w.x>-1&&w.x<n[M].width&&w.y>-1&&w.y<n[M].height){n[M].snaptogridx>0&&(w=K(w,M)),1==c[M]&&(w.y=n[M].imgheight/2);var x=Y(M,w);if(null!=x){if(-1==n[M].mode)return void z(x[0],x[1]);(null!=g&&x[0]<1&&g!=x[1]||null!=f&x[0]>=5&&x[0]<10&&f!=x[1]||null!=v&&x[0]>=10&&x[0]<11&&v!=x[1])&&(x=null)}null==x?(J("pendown"),1==n[M].mode?(r[M].push([w.x,w.y]),b={mode:1,num:r[M].length-1}):2==n[M].mode?(h[M].push([w.x,w.y]),b={mode:2,num:h[M].length-1}):0==n[M].mode||.7==n[M].mode?null==g?(a[M].push([[w.x,w.y]]),g=a[M].length-1):a[M][g].push([w.x,w.y]):.5==n[M].mode?null==g?(a[M].push([[w.x,w.y]]),g=a[M].length-1):(a[M][g].push([w.x,w.y]),g=null,b=null):n[M].mode>=5&&n[M].mode<10?null==f?(s[M].push([[w.x,w.y]]),f=s[M].length-1,d[M][f]=n[M].mode,t=!1):(s[M][f].push([w.x,w.y]),s[M][f].length==q[n[M].mode]?(b={mode:n[M].mode,num:f,subnum:q[n[M].mode]-1},f=null):t=!1):n[M].mode>=10&&n[M].mode<11&&(null==v?(m[M].push([[w.x,w.y]]),v=m[M].length-1,u[M][v]=n[M].mode,t=!1):(m[M][v].push([w.x,w.y]),2==m[M][v].length?b={mode:n[M].mode,num:v,subnum:1}:3==m[M][v].length&&(b={mode:n[M].mode,num:v,subnum:2},v=null)))):0==x[0]||.5==x[0]?null==g?(J("move"),b={mode:n[M].mode,num:x[1],subnum:x[2]},T=a[M][x[1]][x[2]],x[2]==a[M][x[1]].length-1&&0==n[M].mode?g=x[1]:0==x[2]&&0==n[M].mode&&(g=x[1],a[M][g].reverse(),b.subnum=a[M][g].length-1),L=!0):x[1]==g&&x[2]==a[M][x[1]].length-1?(a[M][g].length<2&&a[M].splice(g,1),g=null):n[M].dotline>1&&x[1]==g&&0==x[2]?(a[M][g].push(a[M][g][0]),g=null):(J("pendown"),a[M][g].push([w.x,w.y])):1==x[0]?(J("move"),b={mode:1,num:x[1]}):2==x[0]?(J("move"),b={mode:2,num:x[1]}):x[0]>=5&&x[0]<10?null==f&&(J("move"),b={mode:x[0],num:x[1],subnum:x[2]},T=s[M][x[1]][x[2]],L=!0):x[0]>=10&&x[0]<11&&null==v&&(J("move"),b={mode:x[0],num:x[1],subnum:x[2]},T=m[M][x[1]][x[2]],L=!0),D()}else null!=g&&(a[M][g].length<2&&a[M].splice(g,1),J("pen")),null!=f&&(s[M][f].length<q[n[M].mode]&&(s[M].splice(f,1),d[M].splice(f,1)),J("pen")),null!=v&&(m[M][v].length<3&&(m[M].splice(v,1),u[M].splice(v,1)),J("pen")),g=null,f=null,v=null,b=null,D(),M=null}}function Y(e,t){if(I){var i=Math.max(15*window.innerWidth/screen.width,15);i*=i}else if(-1==n[e].mode)i=50;else i=25;if(0==n[e].mode||.5==n[e].mode||-1==n[e].mode)for(var l=a[e].length-1;l>=0;l--)for(var o=a[e][l].length-1;o>=0;o--){if(Math.pow(a[e][l][o][0]-t.x,2)+Math.pow(a[e][l][o][1]-t.y,2)<i)return[-1==n[e].mode?0:n[e].mode,l,o]}if(1==n[e].mode||-1==n[e].mode)for(l=r[e].length-1;l>=0;l--)if(Math.pow(r[e][l][0]-t.x,2)+Math.pow(r[e][l][1]-t.y,2)<i)return[1,l];if(2==n[e].mode||-1==n[e].mode)for(l=h[e].length-1;l>=0;l--)if(Math.pow(h[e][l][0]-t.x,2)+Math.pow(h[e][l][1]-t.y,2)<i)return[2,l];if(n[e].mode>=5&&n[e].mode<10||-1==n[e].mode)for(l=s[e].length-1;l>=0;l--)for(o=s[e][l].length-1;o>=0;o--){if(d[e][l]==n[e].mode||-1==n[e].mode)if(Math.pow(s[e][l][o][0]-t.x,2)+Math.pow(s[e][l][o][1]-t.y,2)<i)return[d[e][l],l,o]}if(n[e].mode>=10&&n[e].mode<11||-1==n[e].mode)for(l=m[e].length-1;l>=0;l--)for(o=m[e][l].length-1;o>=0;o--){if(u[e][l]==n[e].mode||-1==n[e].mode)if(Math.pow(m[e][l][o][0]-t.x,2)+Math.pow(m[e][l][o][1]-t.y,2)<i)return[u[e][l],l,o]}return null}var U=null;function X(i){var l=Q(i);if(t=!1,null!=M){if(o[M].disabled)return;var p=$(n[M].el),y={x:l.x-p.x,y:l.y-p.y};n[M].snaptogridx>0&&(y=K(y,M));var w=y.x>-1&&y.x<n[M].width&&y.y>-1&&y.y<n[M].height;1==L&&(n[M].mode>=5&&n[M].mode<10?(s[M].push([[y.x,y.y]]),f=s[M].length-1,d[M][f]=n[M].mode):n[M].mode>=10&&n[M].mode<11&&(m[M].push([[y.x,y.y]]),v=m[M].length-1,u[M][v]=n[M].mode)),null!=U&&l.x==U.x&&l.y==U.y&&null!=g&&null==b&&(a[M][g].length<2&&a[M].splice(g,1),g=null,b=null,D()),null!=g&&null==b&&(.5==n[M].mode&&a[M][g].length>1||.7==n[M].mode)&&(g=null,dragobj=null,D()),null!=f&&s[M][f].length<q[n[M].mode]&&(N||!w?(s[M].splice(f,1),d[M].splice(f,1),f=null,D()):null==Y(M,y)&&(s[M][f].push([y.x,y.y]),s[M][f].length==q[n[M].mode]&&(f=null),D())),null!=v&&1==m[M][v].length&&(N||!w?(m[M].splice(v,1),u[M].splice(v,1),v=null,D()):null==Y(M,y)&&(m[M][v].push([y.x,y.y]),D())),J(null==g&&null==f?"move":"pen"),void 0!==i&&i.preventDefault()}if(U=l,null!=M&&null!=b){p=$(n[M].el);y.x>-1&&y.x<n[M].width&&y.y>-1&&y.y<n[M].height?(0==b.mode&&n[M].dotline>1&&(0!=b.subnum&&b.subnum!=a[M][b.num].length-1||Math.pow(a[M][b.num][0][0]-a[M][b.num][a[M][b.num].length-1][0],2)+Math.pow(a[M][b.num][0][1]-a[M][b.num][a[M][b.num].length-1][1],2)<25&&(0==b.subnum?(a[M][b.num][a[M][b.num].length-1][0]=a[M][b.num][0][0],a[M][b.num][a[M][b.num].length-1][1]=a[M][b.num][0][1]):(a[M][b.num][0][0]=a[M][b.num][a[M][b.num].length-1][0],a[M][b.num][0][1]=a[M][b.num][a[M][b.num].length-1][1]),g=null,D())),b=null):(1==c[M]&&(y.y=n[M].imgheight/2),1==b.mode?r[M].splice(b.num,1):2==b.mode?h[M].splice(b.num,1):.5==b.mode?a[M].splice(b.num,1):0==b.mode?a[M][b.num][b.subnum]=T:b.mode>=5&&b.mode<10?(s[M].splice(b.num,1),d[M].splice(b.num,1),f=null):b.mode>=10&&b.mode<11&&(m[M].splice(b.num,1),u[M].splice(b.num,1),v=null),b=null,D())}N=!1,I?B=window.setTimeout(function(){I=!1,ee(),e(document).on("mousemove.imathasdraw",G),e(".drawcanvas").on("touchstart.imathasdraw",function(e){I=!0,F(e)}),e(document).on("mousedown.imathasdraw",F)},350):(ee(),e(document).on("mousemove.imathasdraw",G),e(".drawcanvas").on("touchstart.imathasdraw",function(e){I=!0,F(e)}),e(document).on("mousedown.imathasdraw",F))}var V=-1;function G(l){var d=null;L=!1;var u=Q(l);for(i in n){if(!e(n[i].el).is(":hidden")&&"canvas"==n[i].type)if((p=$(n[i].el)).x<u.x&&p.x+n[i].width>u.x&&p.y<u.y&&p.y+n[i].height>u.y&&l.target==n[i].el){d=i;break}}if(null!=d){if(o[d].disabled)return;V=d;var p=$(n[d].el),y={x:u.x-p.x,y:u.y-p.y};if(n[d].snaptogridx>0&&(y=K(y,d)),1==c[d]&&(y.y=n[d].imgheight/2),y.x>-1&&y.x<n[d].width&&y.y>-1&&y.y<n[d].height)if(null==b)if(null==g)null==(x=Y(d,y))?J("pen",d):-1!=n[d].mode&&J("move",d)}else null!=V&&-1!=V&&(null!=M?D():(M=V,D(),M=null),V=-1);if(null!=M){if(l.originalEvent.touches&&l.originalEvent.touches.length>1)return N=!0,!0;void 0!==l&&l.preventDefault();p=$(n[M].el),y={x:u.x-p.x,y:u.y-p.y};if(n[M].snaptogridx>0&&(y=K(y,M)),1==c[M]&&(y.y=n[M].imgheight/2),y.x>-1&&y.x<n[M].width&&y.y>-1&&y.y<n[M].height){if(null==b){if(t&&-1==n[M].mode)return void(null!=(x=Y(M,y))&&z(x[0],x[1]));if(null!=g)if(!t||0!=n[M].mode&&.7!=n[M].mode)if(t&&.5==n[M].mode){if(0==(w=a[M][g].length-1))Math.pow(a[M][g][w][0]-y.x,2)+Math.pow(a[M][g][w][1]-y.y,2)>25?(a[M][g].push([y.x,y.y]),D()):D(y.x,y.y);else a[M][g][w]=[y.x,y.y],D()}else D(y.x,y.y);else{var w=a[M][g].length-1;Math.pow(a[M][g][w][0]-y.x,2)+Math.pow(a[M][g][w][1]-y.y,2)>25?(a[M][g].push([y.x,y.y]),D()):D(y.x,y.y)}else if(null!=f)t?D():D(y.x,y.y);else if(null!=v)t?D():D(y.x,y.y);else{var x;null==(x=Y(M,y))?(J("pen"),S.hasOwnProperty(n[M].mode)&&null!==d&&D(y.x,y.y)):(D(),-1!=n[M].mode&&J("move"))}}else J("move"),0==b.mode||.5==b.mode?a[M][b.num][b.subnum]=[y.x,y.y]:1==b.mode?r[M][b.num]=[y.x,y.y]:2==b.mode?h[M][b.num]=[y.x,y.y]:b.mode>=5&&b.mode<10?s[M][b.num][b.subnum]=[y.x,y.y]:b.mode>=10&&b.mode<11&&(m[M][b.num][b.subnum]=[y.x,y.y]),D();return!1}null==v||t||D()}else null!=d&&-1!=V&&(M=d,S.hasOwnProperty(n[M].mode)&&D(y.x,y.y),M=null)}function J(e,t){if(n[t=t||M].cursor!=e){var i=P?"png":"svg";"move"==e?n[t].el.style.cursor=e:"pen"==e?n[t].el.style.cursor="url("+staticroot+"/img/penup."+i+") 0 0, auto":"pendown"==e&&(n[t].el.style.cursor="url("+staticroot+"/img/pendown."+i+") 0 20, auto"),n[t].cursor=e}}function Q(e){if(e=e||window.event,I){var t=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0];return{x:t.pageX,y:t.pageY}}if(e.pageX||e.pageY)return{x:e.pageX,y:e.pageY};var n=document.documentElement,i=document.body;if(n&&(n.scrollTop||n.scrollLeft))var l=n.scrollLeft,o=n.scrollTop;else if(i)l=i.scrollLeft,o=i.scrollTop;else l=0,o=0;return{x:e.clientX+l,y:e.clientY+o}}function K(e,t){var i=e.x-n[t].imgborder+n[t].xmin*n[t].pixperx,l=e.y-n[t].imgborder-n[t].ymax*n[t].pixpery;return{x:i=Math.round(Math.round(i/(n[t].pixperx*n[t].snaptogridx))*n[t].pixperx*n[t].snaptogridx+n[t].imgborder-n[t].xmin*n[t].pixperx),y:l=Math.round(Math.round(l/(n[t].pixpery*n[t].snaptogridy))*n[t].pixpery*n[t].snaptogridy+n[t].imgborder+n[t].ymax*n[t].pixpery)}}function Z(e,t){var n=$(e),i=Q(t);return{x:i.x-n.x,y:i.y-n.y}}function $(t){if(t.className.match(/hidden/))return{x:-1e4,y:-1e4};var n=e(t).offset();return{x:n.left,y:n.top}}function ee(){e(document).off("mousedown.imathasdraw").off("mousemove.imathasdraw").off("mouseup.imathasdraw"),e(document).off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw"),e(".drawcanvas").off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw")}function te(t){ee(),e(document).on("mousemove.imathasdraw",G),e(".drawcanvas").on("touchstart.imathasdraw",function(e){I=!0,F(e)}),e(document).on("mousedown.imathasdraw",F);try{CanvasRenderingContext2D.prototype.dashedLine=function(e,t,i,l,o){null==o&&(o=10),t<0&&t!=l?(e-=t*(i-e)/(l-t),t=0):t>n[M].imgheight&&t!=l&&(e+=(n[M].imgheight-t)*(i-e)/(l-t),t=n[M].imgheight),this.beginPath(),this.moveTo(e,t);var a=i-e,r=l-t,h=Math.sqrt(a*a+r*r)/o,s=a/h,d=r/h;h=Math.floor(h);for(var m=0;m++<h&&t>-1&&t<n[M].imgheight+1&&e>-1&&e<n[M].imgwidth+1;)e+=s,t+=d,this[m%2==0?"moveTo":"lineTo"](e,t);this[m%2==0?"moveTo":"lineTo"](i,l),this.stroke(),this.closePath()}}catch(e){}for(var i in canvases)if(void 0===t||t==i){var l=null;if(null!=drawla[i]&&drawla[i].length>2){if(a[canvases[i][0]]=drawla[i][0],r[canvases[i][0]]=drawla[i][1],h[canvases[i][0]]=drawla[i][2],d[canvases[i][0]]=[],s[canvases[i][0]]=[],drawla[i].length>3&&drawla[i][3].length>0)for(var o=0;o<drawla[i][3].length;o++){d[canvases[i][0]][o]=drawla[i][3][o][0],s[canvases[i][0]][o]=[];for(var g=0;g<q[d[canvases[i][0]][o]];g++)s[canvases[i][0]][o].push(drawla[i][3][o].slice(1+2*g,3+2*g))}if(u[canvases[i][0]]=[],m[canvases[i][0]]=[],drawla[i].length>4&&drawla[i][4].length>0)for(o=0;o<drawla[i][4].length;o++)u[canvases[i][0]][o]=drawla[i][4][o][0],m[canvases[i][0]][o]=[drawla[i][4][o].slice(1,3),drawla[i][4][o].slice(3,5),drawla[i][4][o].slice(5)];drawla[i].length>5&&(l=drawla[i][5])}else null!=drawla[i]&&"[[]]"==JSON.stringify(drawla[i])&&k(canvases[i][0],!0);var p="";canvases[i][1].match(/initPicture/)?p=canvases[i][1]:""!==canvases[i][1]&&(p=imasroot+"/filter/graph/imgs/"+canvases[i][1]),""!==canvases[i][13]?A(canvases[i],l,p):R(canvases[i][0],"canvas"+canvases[i][0],p,"qn"+canvases[i][0],canvases[i][2],canvases[i][3],canvases[i][4],canvases[i][5],canvases[i][6],canvases[i][7],canvases[i][8],canvases[i][9],canvases[i][10],canvases[i][11],canvases[i][12])}}"undefined"!=typeof initstack?initstack.push(te):e(function(){te()});var ne={idnums:[],curslider:{el:null,startpos:[0,0],outnode:null}};function ie(t){for(var n,i=0;i<ne.idnums.length;i++)void 0!==t&&t!=ne.idnums[i]||(le(n=ne.idnums[i]),e("#slid1"+n).on("touchstart.normslider mousedown.normslider",oe),e("#slid2"+n).on("touchstart.normslider mousedown.normslider",oe))}function le(e){var t,n,i,l,o=document.getElementById("qn"+e).value;(l=o.match(/\(-oo,([\-\d\.]+)\)U\(([\-\d\.]+),oo\)/))?(t=3,n=l[1],i=l[2]):(l=o.match(/\(-oo,([\-\d\.]+)\)/))?(t=0,n=l[1],i=2.5):(l=o.match(/\(([\-\d\.]+),oo\)/))?(t=1,n=l[1],i=2.5):(l=o.match(/\(([\-\d\.]+),([\-\d\.]+)\)/))?(t=2,n=l[1],i=l[2]):(t=0,n=-1.5,i=2.5),document.getElementById("slid1"+e).style.left=60*n+250-6+"px",document.getElementById("slid2"+e).style.left=60*i+250-6+"px",document.getElementById("shaderegions"+e).selectedIndex=t,ne.curslider.type=document.getElementById("shaderegions"+e).value,se(e)}function oe(t){(t=t||window.event).originalEvent.touches&&t.originalEvent.touches.length>0?(I=!0,e(document).on("touchmove.normslider",ae),e(document).on("touchend.normslider",re)):(e(document).on("mousemove.normslider",ae),e(document).on("mouseup.normslider",re)),ne.curslider.el=t.target||t.srcElement,ne.curslider.id=ne.curslider.el.id.substring(5),ne.curslider.type=document.getElementById("shaderegions"+ne.curslider.id).value,ne.curslider.outnode=document.getElementById(ne.outputid),ne.curslider.startpos=Z(ne.curslider.el,t),ne.curslider.el.parentNode.style.cursor="pointer";$(ne.curslider.el.parentNode);return t.preventDefault&&t.preventDefault(),!1}function ae(e){var t=ne.curslider.id;e=e||window.event;var n=Z(ne.curslider.el.parentNode,e);if(!(n.x<5||n.x>ne.curslider.el.parentNode.offsetWidth-5||n.y<5||n.y>ne.curslider.el.parentNode.offsetHeight-5)){var i=6*Math.round((n.x-ne.curslider.startpos.x-10)/6)+10;return ne.curslider.el.style.left=i+"px",he(t),e.preventDefault&&e.preventDefault(),!1}}function re(t){null!==ne.curslider.el&&(I=!1,e(document).off("touchmove.normslider touchend.normslider"),e(document).off("mousemove.normslider mouseup.normslider"),ne.curslider.el.parentNode.style.cursor="",ne.curslider.el=null)}function he(t){var n=parseInt(document.getElementById("slid1"+t).style.left)+6,i=parseInt(document.getElementById("slid2"+t).style.left)+6,l=Math.min(n,i),o=Math.max(n,i);"2O"==ne.curslider.type?document.getElementById("normleft"+t).style.width=l+1+"px":"1L"==ne.curslider.type?document.getElementById("normleft"+t).style.width=n+1+"px":"2B"==ne.curslider.type&&(document.getElementById("normleft"+t).style.left=l+"px",document.getElementById("normleft"+t).style.width=o-l+1+"px"),"2O"==ne.curslider.type?document.getElementById("normright"+t).style.width=500-o+"px":"1R"==ne.curslider.type&&(document.getElementById("normright"+t).style.width=500-n+"px");var a=((n-10)/60-4).toFixed(1),r=((i-10)/60-4).toFixed(1),h=document.getElementById("slid1txt"+t);h.innerHTML=a,h.style.left=n-6+"px";var s=document.getElementById("slid2txt"+t);s.innerHTML=r,s.style.left=i-6+"px";var d=Math.min(a,r),m=Math.max(a,r);if("2O"==ne.curslider.type)var u="(-oo,"+d+")U("+m+",oo)";else if("2B"==ne.curslider.type)u="("+d+","+m+")";else if("1L"==ne.curslider.type)u="(-oo,"+a+")";else if("1R"==ne.curslider.type)u="("+a+",oo)";document.getElementById("qn"+t).value=u,e("#qn"+t).trigger("input").trigger("change")}function se(e){var t=document.getElementById("shaderegions"+e).value;ne.curslider.type=t;var n=parseInt(document.getElementById("slid1"+e).style.left)+6,i=parseInt(document.getElementById("slid2"+e).style.left)+6,l=Math.min(n,i),o=Math.max(n,i);"1R"==t||"1L"==t?(document.getElementById("slid2"+e).style.display="none",document.getElementById("slid2txt"+e).style.display="none","1R"==t?(document.getElementById("normleft"+e).style.display="none",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normright"+e).style.width=500-n+"px"):(document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.display="",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normleft"+e).style.width=n+"px")):"2O"==t?(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normright"+e).style.width=500-o+"px",document.getElementById("normleft"+e).style.width=l+"px"):"2B"==t&&(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.left=l+"px",document.getElementById("normleft"+e).style.width=o-l+"px"),he(e)}function de(e,t,n,i,l,o,a){if(l==n)e.moveTo(0,l),e.dashedLine(0,l,o,l);else{var r=(l-n)/((i-t)*(i-t)),h=-2*r*t,s=0;l>n&&(s=a);var d=r*t*t+n-s,m=Math.sqrt(h*h-4*r*d),u=(-h-m)/(2*r),g=(-h+m)/(2*r);d+=s;if(g<u){var p=u;u=g,g=p}for(var c=t,f=n,v=0;c>u-5&&c>-5;)v%2==0?e.moveTo(c,f):e.lineTo(c,f),f=r*(c-=Math.min(Math.sqrt(64/(1+Math.pow(2*r*(c-t),2))),Math.sqrt(8/Math.abs(r))))*c+h*c+d,v++;for(c=t,f=n,v=0;c<g+5&&c<o+5;)v%2==0?e.moveTo(c,f):e.lineTo(c,f),f=r*(c+=Math.min(Math.sqrt(64/(1+Math.pow(2*r*(c-t),2))),Math.sqrt(8/Math.abs(r))))*c+h*c+d,v++}e.stroke()}function me(e,t,n,i,l,o,a,r,h){if(e.beginPath(),l==n)e.moveTo(0,l),e.lineTo(r,l),a<n?(e.lineTo(r,0),e.lineTo(0,0)):(e.lineTo(r,h),e.lineTo(0,h));else{var s=(l-n)/((i-t)*(i-t)),d=-2*s*t,m=0;l>n&&(m=h);var u=s*t*t+n-m,g=Math.sqrt(d*d-4*s*u),p=(-d-g)/(2*s),c=s*p*p+d*p+(u+=m),f=(-d+g)/(2*s),v=c;if(f<p){var y=p;p=f,f=y}var w=2*s*(p-t),x=c-w*p,b=-w,T=(x-(v-b*f))/(b-w),M=w*T+x;if(s<0&&a<s*o*o+d*o+u||s>0&&a>s*o*o+d*o+u)e.moveTo(p,c),e.quadraticCurveTo(T,M,f,v);else{var E=h;Math.abs(c-h)<2&&(E=0),e.moveTo(0,c),e.lineTo(p,c),e.quadraticCurveTo(T,M,f,v),e.lineTo(r,v),e.lineTo(r,E),e.lineTo(0,E)}}e.closePath()}return"undefined"!=typeof initstack&&initstack.push(ie),{reset:function(){ee(),n.length=0,l.length=0,o.length=0,a.length=0,r.length=0,h.length=0,s.length=0,d.length=0,m.length=0,u.length=0,p.length=0,c.length=0,M=null,g=null,b=null,f=null,v=null},initCanvases:te,clearcanvas:k,clearlastline:function(e){a[e].length>0&&(a[e].length=a[e].length-1),M=e,D(),M=null,g=null,b=null},settool:function(e,t,i){for(var l=document.getElementById("drawtools"+t),o=l.getElementsByTagName("span"),a=0;a<o.length;a++)o[a].className="";for(o=l.getElementsByTagName("img"),a=0;a<o.length;a++)o[a].className="";e.className="sel",function(e,t){n[e].mode=t}(t,i),M=t,D()},addnormslider:function(e,t){-1==arraysearch(e,ne.idnums)?(ne.idnums.push(e),!0===t&&ie(e)):ie(e)},chgnormtype:se,adda11ydraw:C,changea11ydraw:function(t,i){var l=e(t).val(),o=n[i].moderef[l];e(t).closest("li").find(".a11ydrawinstr").text(o.input),O()},encodea11ydraw:O,updatea11ydraw:function(t){var i,l=parseInt(e(t).closest(".a11ydraw").attr("id").substring(8)),o=0,a=t.value.trim();if(n[l].isnumberline)i=a.split(/\s*,\s*/);else{"("==a.charAt(0)&&")"==a.slice(-1)||(o|=1),i=a.slice(1,-1).split(/\)\s*,\s*\(/);for(var r=0;r<i.length;r++){var h=i[r].split(/,/);2!=h.length&&(o|=1);for(var s=0;s<h.length;s++)0==h[s].trim().length&&(o|=1)}}var d=t.getAttribute("data-n");if(d.match(/\d/)&&i.length!=parseInt(d)&&(o|=2),"noticetext"==t.parentNode.parentNode.lastChild.className&&t.parentNode.parentNode.removeChild(t.parentNode.parentNode.lastChild),o){t.setAttribute("aria-invalid",!0);var m=document.createElement("span");m.id=uniqid("a11ydrawerr"),m.className="noticetext",1&~o?(m.innerHTML="<br>"+_("Error: Incorrect number of points. Expecting ")+d,setariastatus(_("Error: Incorrect number of points"))):(m.innerHTML="<br>"+_("Error: Invalid format for points. Give points as open parenthesis number comma number close parenthesis. Separate points with a comma."),setariastatus(_("Error: Invalid format for points"))),t.parentNode.parentNode.appendChild(m),t.setAttribute("aria-describedby",m.id)}else t.removeAttribute("aria-invalid"),t.removeAttribute("aria-describedby"),setariastatus("");O(l)},removea11ydraw:function(t){setariastatus(_("Removed drawing element"));var n=e(t).closest("ul");e(t).parent().remove(),n.find("li").each(function(t,n){var i=_("Drawing element ")+(t+1);e(n).find(".draweln").html(i)}),n.prev().focus(),O(n.attr("id").substring(8))}}}(jQuery);!function(){"use strict";function e(e,t){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i}function t(e,t,n){var i=t[0],l=t[1],o=n[0]-i,a=n[1]-l;if(0!==o||0!==a){var r=((e[0]-i)*o+(e[1]-l)*a)/(o*o+a*a);r>1?(i=n[0],l=n[1]):r>0&&(i+=o*r,l+=a*r)}return(o=e[0]-i)*o+(a=e[1]-l)*a}function n(e,i,l,o,a){for(var r,h=o,s=i+1;s<l;s++){var d=t(e[s],e[i],e[l]);d>h&&(r=s,h=d)}h>o&&(r-i>1&&n(e,i,r,o,a),a.push(e[r]),l-r>1&&n(e,r,l,o,a))}function i(e,t){var i=e.length-1,l=[e[0]];return n(e,0,i,t,l),l.push(e[i]),l}window.pathsimplify=function(t,n,l){if(t.length<=2)return t;var o=void 0!==n?n*n:1;return t=i(t=l?t:function(t,n){for(var i,l=t[0],o=[l],a=1,r=t.length;a<r;a++)e(i=t[a],l)>n&&(o.push(i),l=i);return l!==i&&o.push(i),o}(t,o),o)}}();