var canvases=new Array,drawla=new Array,imathasDraw=function($){var mouseisdown=!1,targets=new Array,imgs=new Array,targetOuts=new Array,lines=new Array,dots=new Array,odots=new Array,tplines=new Array,tptypes=new Array,ineqlines=new Array,ineqtypes=new Array,curLine=null,drawstyle=[],drawlocky=[],curTPcurve=null,curIneqcurve=null,ineqcolors=["rgb(0,0,255)","rgb(255,0,0)","rgb(0,255,0)"],ineqacolors=["rgba(0,0,255,.4)","rgba(255,0,0,.4)","rgba(0,255,0,.4)"],asymcolor="rgb(0,200,0)",dragObj=null,oldpointpos=null,curTarget=null,curCursor=null,nocanvaswarning=!1,hasTouch=!1,didMultiTouch=!1,clickmightbenewcurve=!1,hasTouchTimer=null,tpModeN={5:2,5.1:2,5.2:2,5.3:2,5.4:2,6:2,6.1:2,6.2:2,6.3:2,6.5:2,6.6:2,7:2,7.2:2,7.4:2,7.5:2,8:2,8.2:2,8.3:2,8.4:2,8.5:3,8.6:3,9:2,9.1:2,10:3,10.2:3,10.3:3,10.4:3},tpHasAsymp={7.4:1,7.5:1,8.2:1,8.5:1,8.6:1};function reset(){clearAllDrawListners(),targets.length=0,imgs.length=0,targetOuts.length=0,lines.length=0,dots.length=0,odots.length=0,tplines.length=0,tptypes.length=0,ineqlines.length=0,ineqtypes.length=0,drawstyle.length=0,drawlocky.length=0,curTarget=null,curLine=null,dragObj=null,curTPcurve=null,curIneqcurve=null}function clearcanvas(e,t){targetOuts[e]&&targetOuts[e].disabled&&!t||lines.hasOwnProperty(e)&&(lines[e].length=0,dots[e].length=0,odots[e].length=0,tplines[e].length=0,tptypes[e].length=0,ineqlines[e].length=0,ineqtypes[e].length=0,curTarget=e,"canvas"==targets[e].type&&drawTarget(),curTarget=null,curLine=null,dragObj=null)}function clearlastline(e){lines[e].length>0&&(lines[e].length=lines[e].length-1),curTarget=e,drawTarget(),curTarget=null,curLine=null,dragObj=null}function addA11yTarget(e,t,r){var a=e[0],n=e[13].split(","),i=!0;"noprev"==n[n.length-1]&&(i=!1,n.pop());var s=e[2],l=e[3],u=e[4],g=e[5];u==g&&(u=-1,g=1);var o=e[6],c=e[7],d=e[8],T=document.getElementById("a11ydraw"+a);if(null==T){var p=document.getElementById("canvas"+a);if(p&&!i){var h=$("<div>").append($("<p>",{text:_("Drawn Elements:")}));(T=document.createElement("ul")).setAttribute("id","allydraw"+a),h.append(T),$(p).replaceWith(h)}}targetOuts[a]=document.getElementById("qn"+a);var m,y=!!document.getElementById("a11ydrawnew"+a);targetOuts[a].disabled&&(y&&(document.getElementById("a11ydrawnew"+a).disabled=!0),$(".a11ydrawadd[data-qn="+a+"]").prop("disabled",!0)),targets[a]={type:"a11y",el:T,vispreview:i,xmin:s,xmax:l,ymin:u,ymax:g,imgborder:o,imgwidth:c,imgheight:d},i&&(targets[a].canv=document.getElementById("canvas"+a)),targets[a].pixperx=(c-2*o)/(l-s),targets[a].pixpery=u==g?1:(d-2*o)/(g-u),"inequality"==n[0]?(m=n.shift(),0==n.length?n=["line"]:"both"==n[0]&&(n=["line","parab"])):"twopoint"==n[0]?(m=n.shift(),0==n.length&&(n=["line","parab","abs","circle","dot"])):"numberline"==n[0]?(m="basic",n.shift()):m="basic",targets[a].afgroup=m;var v={inequality:{line:[{mode:10,descr:_("Linear inequality with solid line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")},{mode:10.2,descr:_("Linear inequality with dashed line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")}],parab:[{mode:10.3,descr:_("Parabolic inequality with solid line"),inN:3,input:_("Enter the vertex, then another point on the parabola, then a third point in the shaded region")},{mode:10.4,descr:_("Parabolic inequality with dashed line"),inN:3,input:_("Enter the vertex, then another point on the parabola, then a third point in the shaded region")}],abs:[{mode:10.5,descr:_("Absolute value inequality with solid line"),inN:3,input:_("Enter the corner point of the absolute value, then another point on the graph, then a third point in the shaded region")},{mode:10.6,descr:_("Absolute value inequality with dashed line"),inN:3,input:_("Enter the corner point of the absolute value, then another point on the graph, then a third point in the shaded region")}]},twopoint:{line:[{mode:5,descr:_("Line"),inN:2,input:_("Enter two points on the line")}],dashline:[{mode:5.1,descr:_("Dashed Line"),inN:2,input:_("Enter two points on the dashed line")}],lineseg:[{mode:5.3,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],ray:[{mode:5.2,descr:_("Ray"),inN:2,input:_("Enter the starting point of the ray and another point on the ray")}],parab:[{mode:6,descr:_("Parabola"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],horizparab:[{mode:6.1,descr:_("Parabola opening right or left"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],halfparab:[{mode:6.2,descr:_("Half Parabola"),inN:2,input:_("Enter the vertex, then another point on the half parabola")}],cubic:[{mode:6.3,descr:_("Cubic"),inN:2,input:_("Enter the inflection point, then another point on the cubic")}],sqrt:[{mode:6.5,descr:_("Square root"),inN:2,input:_("Enter the starting point of the square root, then another point on the graph")}],cuberoot:[{mode:6.6,descr:_("Cube root"),inN:2,input:_("Enter the inflection point of the cube root, then another point on the graph")}],abs:[{mode:8,descr:_("Absolute value"),inN:2,input:_("Enter the corner point of the absolute value, then another point on the graph")}],rational:[{mode:8.2,descr:_("Rational"),inN:2,input:_("Enter the point where the vertical and horizontal asymptote cross, then a point on the graph")}],exp:[{mode:8.3,descr:_("Exponential"),inN:2,input:_("Enter two points on the graph")}],log:[{mode:8.4,descr:_("Logarithm"),inN:2,input:_("Enter two points on the graph")}],genexp:[{mode:8.5,descr:_("Shifted Exponential"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],genlog:[{mode:8.6,descr:_("Shifted Logarithm"),inN:3,input:_("Enter a point on the asymptote, then enter two points on the graph")}],circle:[{mode:7,descr:_("Circle"),inN:2,input:_("Enter the center point of the circle, then a point on the graph")}],ellipse:[{mode:7.2,descr:_("Ellipse"),inN:2,input:_("Enter the center point of the ellipse, then a point offset from the center by the horizontal radius and vertical radius")}],hyperbola:[{mode:7.4,descr:_("Vertical hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the co-vertex and y is the y-coordinate of the vertex")},{mode:7.5,descr:_("Horizontal hyperbola"),inN:2,input:_("Enter the center point of the hyperbola, then a point (x,y) where x is the x-coordinate of the vertex and y is the y-coordinate of the co-vertex")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],trig:[{mode:9,descr:_("Cosine"),inN:2,input:_("Enter a point at the start of a phase, then a point half a phase further")},{mode:9.1,descr:_("Sine"),inN:2,input:_("Enter a point at the start of a phase, then a point a quarter phase further")}],vector:[{mode:5.4,descr:_("Vector"),inN:2,input:_("Enter the starting and ending point of the vector")}]},basic:{line:[{mode:0,descr:_("Lines"),inN:"list",input:_("Enter a list of points to connect with lines")}],lineseg:[{mode:.5,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],freehand:[{mode:.7,descr:_("Freehand"),inN:"list",input:_("Enter a list of points to connect with lines")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],polygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter a list of points for dots to connect with lines"),dotline:1}],closedpolygon:[{mode:0,descr:_("Polygon"),inN:"list",input:_("Enter a list of points for dots to connect with lines"),dotline:2}]}};null==lines[a]&&(lines[a]=new Array),null==dots[a]&&(dots[a]=new Array),null==odots[a]&&(odots[a]=new Array),null==tplines[a]&&(tplines[a]=new Array),null==tptypes[a]&&(tptypes[a]=new Array),null==ineqlines[a]&&(ineqlines[a]=new Array),null==ineqtypes[a]&&(ineqtypes[a]=new Array);for(var f,w,b=[],q=[],x=[],M=0;M<n.length;M++)if(v[m].hasOwnProperty(n[M])){0==M&&(f=v[m][n[M]][0].mode);for(var O=0;O<v[m][n[M]].length;O++)x[v[m][n[M]][O].mode]=v[m][n[M]][O],b.push(v[m][n[M]][O].mode),w='<option value="'+v[m][n[M]][O].mode+'"',w+=' data-af="'+n[M]+'">'+v[m][n[M]][O].descr+"</option>",q.push(w)}if(y&&(document.getElementById("a11ydrawnew"+a).innerHTML=q),targets[a].defmode=f,targets[a].inputmodes=b,targets[a].selects=q,targets[a].moderef=x,y||!i)if(null==t&&lines.hasOwnProperty(a)){for(M=0;M<lines[a].length;M++)adda11ydraw(a,0,pixcoordstopointlist(lines[a][M],a));for(M=0;M<dots[a].length;M++)adda11ydraw(a,1,pixcoordstopointlist(dots[a][M],a));for(M=0;M<odots[a].length;M++)adda11ydraw(a,2,pixcoordstopointlist(odots[a][M],a));for(M=0;M<tplines[a].length;M++)adda11ydraw(a,tptypes[a][M],pixcoordstopointlist(tplines[a][M][0],a)+","+pixcoordstopointlist(tplines[a][M][1],a));for(M=0;M<ineqlines[a].length;M++)adda11ydraw(a,ineqtypes[a][M],pixcoordstopointlist(ineqlines[a][M][0],a)+","+pixcoordstopointlist(ineqlines[a][M][1],a)+","+pixcoordstopointlist(ineqlines[a][M][2],a))}else if(null!=t)for(M=0;M<t.length;M++)adda11ydraw(a,t[M][0],t[M][1].replace(/\[/g,"(").replace(/\]/g,")"));i&&initBackground(targets[a].canv,a,r,c,d,!0)}function adda11ydraw(e,t,r){var a=targets[e],n=t||document.getElementById("a11ydrawnew"+e).value,i=r||"",s=(a.afgroup,a.el.getElementsByTagName("li").length+1),l=targetOuts[e].disabled?" disabled ":"",u='<span class="sr-only draweln">'+_("Drawing element ")+s+"</span>";html=u,html+=a.moderef[n].descr+".<br/>",html+='<label><span class="a11ydrawinstr"></span><br/>',html+='<input type="text" value="'+i+'" data-n="'+a.moderef[n].inN+'" '+l,html+='onblur="imathasDraw.updatea11ydraw(this)"/></label>',html+='<button type="button" class="imgbutton" onclick="imathasDraw.removea11ydraw(this)"'+l+">",html+=_("Remove")+" "+u+"</button>";var g=$("<li>",{class:"a11ydrawrow","data-mode":n}).html(html);$(a.el).append(g),g.find(".a11ydrawinstr").text(a.moderef[n].input),r||g.find("input").focus()}function removea11ydraw(e){setariastatus(_("Removed drawing element"));var t=$(e).closest("ul");$(e).parent().remove(),t.find("li").each((function(e,t){var r=_("Drawing element ")+(e+1);$(t).find(".draweln").html(r)})),t.prev().focus(),encodea11ydraw(t.attr("id").substring(8))}function changea11ydraw(e,t){var r=$(e).val(),a=targets[t].moderef[r];$(e).closest("li").find(".a11ydrawinstr").text(a.input),encodea11ydraw()}function updatea11ydraw(e){var t=0,r=e.value.trim();"("==r.charAt(0)&&")"==r.slice(-1)||(t|=1);var a=r.slice(1,-1).split(/\)\s*,\s*\(/),n=e.getAttribute("data-n");n.match(/\d/)&&a.length!=parseInt(n)&&(t|=2);for(var i=0;i<a.length;i++){var s=a[i].split(/,/);2!=s.length&&(t|=1);for(var l=0;l<s.length;l++)0==s[l].trim().length&&(t|=1)}if("noticetext"==e.parentNode.parentNode.lastChild.className&&e.parentNode.parentNode.removeChild(e.parentNode.parentNode.lastChild),t){e.setAttribute("aria-invalid",!0);var u=document.createElement("span");u.id=uniqid("a11ydrawerr"),u.className="noticetext",1&~t?(u.innerHTML="<br>"+_("Error: Incorrect number of points. Expecting ")+n,setariastatus(_("Error: Incorrect number of points"))):(u.innerHTML="<br>"+_("Error: Invalid format for points. Give points as open parenthesis number comma number close parenthesis. Separate points with a comma."),setariastatus(_("Error: Invalid format for points"))),e.parentNode.parentNode.appendChild(u),e.setAttribute("aria-describedby",u.id)}else e.removeAttribute("aria-invalid"),e.removeAttribute("aria-describedby"),setariastatus("");encodea11ydraw(parseInt($(e).closest(".a11ydraw").attr("id").substring(8)))}function pixcoordstopointlist(e,t){var r,a,n=targets[t];return r=(e[0]-n.imgborder)/n.pixperx+n.xmin,a=(n.imgheight-e[1]-n.imgborder)/n.pixpery+n.ymin,"("+(r=Math.round(100*r)/100)+","+(a=Math.round(100*a)/100)+")"}function encodea11ydraw(qn){void 0===qn&&(qn=-1);var oldCurTarget=curTarget;for(var tarnum in targets)if(!(qn>-1&&qn!=tarnum)){var thistarg=targets[tarnum];if("a11y"==thistarg.type){qn>-1&&qn==tarnum&&(curTarget=tarnum),lines[tarnum].length=0,dots[tarnum].length=0,odots[tarnum].length=0,tplines[tarnum].length=0,tptypes[tarnum].length=0,ineqlines[tarnum].length=0,ineqtypes[tarnum].length=0;var enclines=[],encdots=[],encodots=[],enctplines=[],enctpineq=[],saveinput=[],afgroup=targets[tarnum].afgroup;$("#a11ydraw"+tarnum).find(".a11ydrawrow").each((function(i,el){var input=$(el).find("input").val(),mode=el.getAttribute("data-mode"),expectedn=$(el).find("input").attr("data-n");saveinput.push("["+mode+',"'+input+'"]'),input=input.replace(/[\(\)]/g,"").split(/\s*,\s*/);for(var outpts=[],outptsraw=[],i=1;i<input.length;i+=2){if("oo"===input[i-1])input[i-1]=thistarg.imgwidth-2*thistarg.imgborder-1;else if("-oo"===input[i-1])input[i-1]=1;else try{input[i-1]=eval(prepWithMath(mathjs(input[i-1])))}catch(e){input[i-1]=NaN}try{input[i]=eval(prepWithMath(mathjs(input[i])))}catch(e){input[i]=NaN}input[i-1]=(input[i-1]-thistarg.xmin)*thistarg.pixperx+thistarg.imgborder,input[i]=thistarg.imgheight-(input[i]-thistarg.ymin)*thistarg.pixpery-thistarg.imgborder,outpts.push(Math.round(input[i-1])+","+Math.round(input[i])),outptsraw.push([input[i-1],input[i]])}"list"!==expectedn&&expectedn!=outpts.length||(1==mode?(encdots.push("("+outpts.join("),(")+")"),dots[tarnum].push(outptsraw)):2==mode?(encodots.push("("+outpts.join("),(")+")"),odots[tarnum].push(outptsraw)):mode<1?(enclines.push("("+outpts.join("),(")+")"),lines[tarnum].push(outptsraw)):mode>=5&&mode<10?(enctplines.push("("+mode+","+outpts.join(",")+")"),tplines[tarnum].push(outptsraw),tptypes[tarnum].push(mode)):mode>=10&&(enctpineq.push("("+mode+","+outpts.join(",")+")"),ineqlines[tarnum].push(outptsraw),ineqtypes[tarnum].push(mode)))})),targetOuts[tarnum].value=enclines.join(";")+";;"+encdots.join(",")+";;"+encodots.join(",")+";;"+enctplines.join(",")+";;"+enctpineq.join(",")+";;"+saveinput.join(","),$(targetOuts[tarnum]).trigger("input").trigger("change")}}qn>-1&&targets[qn].vispreview&&drawTarget(null,null,!0),curTarget=oldCurTarget}function addTarget(e,t,r,a,n,i,s,l,u,g,o,c,d,T,p){var h=document.getElementById(t);$(h).is(":hidden")&&$(h).on("mouseover.imathasdrawwait touchstart.imathasdrawwait",(function(){$(h).off("mouseover.imathasdrawwait touchstart.imathasdrawwait"),initCanvases(e)})),h.style.userSelect="none",h.style.webkitUserSelect="none",h.style.MozUserSelect="none";var m=getPosition(h);targets[e]={type:"canvas",el:h,left:m.x,top:m.y,width:h.offsetWidth,height:h.offsetHeight,xmin:n,xmax:i,ymin:s,ymax:l,imgborder:u,imgwidth:g,imgheight:o,mode:c,dotline:d},"string"==typeof p&&-1!=p.indexOf(":")?(p=p.split(":"),targets[e].snaptogridx=1*p[0],targets[e].snaptogridy=1*p[1]):(targets[e].snaptogridx=1*p,targets[e].snaptogridy=1*p),targets[e].pixperx=(g-2*u)/(i-n),targets[e].pixpery=s==l?1:(o-2*u)/(l-s),targetOuts[e]=document.getElementById(a),null==lines[e]&&(lines[e]=new Array),null==dots[e]&&(dots[e]=new Array),null==odots[e]&&(odots[e]=new Array),null==tplines[e]&&(tplines[e]=new Array),null==tptypes[e]&&(tptypes[e]=new Array),null==ineqlines[e]&&(ineqlines[e]=new Array),null==ineqtypes[e]&&(ineqtypes[e]=new Array),drawstyle[e]=c>=5?1:0,drawlocky[e]=T,initBackground(h,e,r,g,o,!1)}function initBackground(e,t,r,a,n,i){if(r.match(/initPicture/)){0==$(e).closest(".drawcanvasholder").length&&($(e).removeClass("drawcanvas").wrap($("<div>",{class:"drawcanvas",style:"position:relative;width:"+a+"px;height:"+n+"px"})).wrap($("<div>",{class:"drawcanvasholder",style:"position:absolute;top:0;left:0;z-index:2"})),$(e).closest(".drawcanvas").prepend($("<div>",{class:"canvasbg",style:"position:absolute;top:0;left:0"}).append($("<embed>",{"data-nomag":1,type:"image/svg+xml",align:"middle",width:a,height:n,script:r}).attr("width",a).attr("height",n)))),imgs[t]=null;var s=curTarget;curTarget=t,drawTarget(null,null,i),setTimeout((function(){window.drawPics($(e).closest(".drawcanvas")[0])}),30),curTarget=s}else if(""!==r)imgs[t]=new Image,imgs[t].onload=function(){var e=curTarget;curTarget=t,drawTarget(null,null,i),curTarget=e},imgs[t].src=r;else{imgs[t]=null;s=curTarget;curTarget=t,drawTarget(null,null,i),curTarget=s}}function settool(e,t,r){for(var a=document.getElementById("drawtools"+t),n=a.getElementsByTagName("span"),i=0;i<n.length;i++)n[i].className="";n=a.getElementsByTagName("img");for(i=0;i<n.length;i++)n[i].className="";e.className="sel",setDrawMode(t,r),curTarget=t,drawTarget()}function setDrawMode(e,t){targets[e].mode=t}function setDotLine(e,t){targets[e].dotline=t}function drawTarget(e,t,r){try{if(targets[curTarget].canv)var a=targets[curTarget].canv.getContext("2d");else a=targets[curTarget].el.getContext("2d")}catch(e){nocanvaswarning||(nocanvaswarning=!0,alert("Your browser does not support drawing answer entry.  Please try again using Internet Explorer 6+ (Windows), FireFox 1.5+ (Win/Mac), Safari 1.3+ (Mac), Opera 9+ (Win/Mac), or Camino (Mac)"))}a.fillStyle="rgb(0,0,255)",a.lineWidth=2,a.strokeStyle="rgb(0,0,255)",a.clearRect(0,0,targets[curTarget].imgwidth,targets[curTarget].imgheight),null!==imgs[curTarget]&&a.drawImage(imgs[curTarget],0,0),a.beginPath();for(var n=0;n<ineqlines[curTarget].length;n++){var i=n%3;a.strokeStyle=ineqcolors[i],a.fillStyle=ineqcolors[i];var s=null,l=null,u=null,g=null,o=null;if(3==ineqlines[curTarget][n].length?(l=ineqlines[curTarget][n][1][0],g=ineqlines[curTarget][n][1][1],u=ineqlines[curTarget][n][2][0],o=ineqlines[curTarget][n][2][1]):2==ineqlines[curTarget][n].length?(l=ineqlines[curTarget][n][1][0],g=ineqlines[curTarget][n][1][1],u=e,o=t):curIneqcurve==n&&null!=e&&1==ineqlines[curTarget][n].length&&(l=e,g=t),null!=u){if(a.save(),a.fillStyle=ineqacolors[i],a.beginPath(),ineqtypes[curTarget][n]<=10.2){if(l!=ineqlines[curTarget][n][0][0])s=(g-ineqlines[curTarget][n][0][1])/(l-ineqlines[curTarget][n][0][0]);if(Math.abs(l-ineqlines[curTarget][n][0][0])<1||Math.abs(s)>100)a.moveTo(ineqlines[curTarget][n][0][0],0),a.lineTo(ineqlines[curTarget][n][0][0],targets[curTarget].imgheight),u>l?(a.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight),a.lineTo(targets[curTarget].imgwidth,0),a.closePath()):(a.lineTo(0,targets[curTarget].imgheight),a.lineTo(0,0),a.closePath());else{var c=s*(u-l)+g,d=ineqlines[curTarget][n][0][1]-s*ineqlines[curTarget][n][0][0],T=ineqlines[curTarget][n][0][1]+s*(targets[curTarget].imgwidth-ineqlines[curTarget][n][0][0]);a.moveTo(0,d),a.lineTo(targets[curTarget].imgwidth,T),o>c?(a.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight),a.lineTo(0,targets[curTarget].imgheight),a.closePath()):(a.lineTo(targets[curTarget].imgwidth,0),a.lineTo(0,0),a.closePath())}}else if(ineqtypes[curTarget][n]<=10.4)shadeParabola(a,ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],l,g,u,o,targets[curTarget].imgwidth,targets[curTarget].imgheight);else if(Math.abs(l-ineqlines[curTarget][n][0][0])>1){s=(g-ineqlines[curTarget][n][0][1])/(l-ineqlines[curTarget][n][0][0]);l<ineqlines[curTarget][n][0][0]&&(s*=-1);c=s*Math.abs(u-ineqlines[curTarget][n][0][0])+ineqlines[curTarget][n][0][1],d=ineqlines[curTarget][n][0][1]+s*ineqlines[curTarget][n][0][0],T=ineqlines[curTarget][n][0][1]+s*(targets[curTarget].imgwidth-ineqlines[curTarget][n][0][0]);o>c?(a.moveTo(targets[curTarget].imgwidth,targets[curTarget].imgheight),a.lineTo(0,targets[curTarget].imgheight)):(a.moveTo(targets[curTarget].imgwidth,0),a.lineTo(0,0)),a.lineTo(0,d),a.lineTo(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1]),a.lineTo(targets[curTarget].imgwidth,T)}a.fill(),a.restore()}if(a.beginPath(),null!=l)if(ineqtypes[curTarget][n]<=10.2){if(l!=ineqlines[curTarget][n][0][0])s=(g-ineqlines[curTarget][n][0][1])/(l-ineqlines[curTarget][n][0][0]);if(Math.abs(l-ineqlines[curTarget][n][0][0])<1||Math.abs(s)>100)10.2==ineqtypes[curTarget][n]?null!=dragObj&&dragObj.mode>=10&&dragObj.mode<11&&dragObj.num==n&&0==dragObj.subnum?(a.dashedLine(ineqlines[curTarget][n][1][0],ineqlines[curTarget][n][1][1],ineqlines[curTarget][n][1][0],targets[curTarget].imgheight),a.dashedLine(ineqlines[curTarget][n][1][0],ineqlines[curTarget][n][1][1],ineqlines[curTarget][n][1][0],0)):(a.dashedLine(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],ineqlines[curTarget][n][0][0],targets[curTarget].imgheight),a.dashedLine(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],ineqlines[curTarget][n][0][0],0)):(a.moveTo(ineqlines[curTarget][n][0][0],0),a.lineTo(ineqlines[curTarget][n][0][0],targets[curTarget].imgheight),a.stroke());else{d=ineqlines[curTarget][n][0][1]-s*ineqlines[curTarget][n][0][0],T=ineqlines[curTarget][n][0][1]+s*(targets[curTarget].imgwidth-ineqlines[curTarget][n][0][0]);10.2==ineqtypes[curTarget][n]?null!=dragObj&&dragObj.mode>=10&&dragObj.mode<11&&dragObj.num==n&&0==dragObj.subnum?(a.dashedLine(ineqlines[curTarget][n][1][0],ineqlines[curTarget][n][1][1],targets[curTarget].imgwidth,T),a.dashedLine(ineqlines[curTarget][n][1][0],ineqlines[curTarget][n][1][1],0,d)):(a.dashedLine(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],targets[curTarget].imgwidth,T),a.dashedLine(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],0,d)):(a.moveTo(0,d),a.lineTo(targets[curTarget].imgwidth,T),a.stroke())}}else if(ineqtypes[curTarget][n]<=10.4)if(10.3==ineqtypes[curTarget][n]){if(l!=ineqlines[curTarget][n][0][0])if(g==ineqlines[curTarget][n][0][1])a.moveTo(0,g),a.lineTo(targets[curTarget].imgwidth,g);else{var p=(g-ineqlines[curTarget][n][0][1])/((l-ineqlines[curTarget][n][0][0])*(l-ineqlines[curTarget][n][0][0]));if(g>ineqlines[curTarget][n][0][1])var h=Math.sqrt((targets[curTarget].imgheight-ineqlines[curTarget][n][0][1])/p)+ineqlines[curTarget][n][0][0],m=-1*Math.sqrt((targets[curTarget].imgheight-ineqlines[curTarget][n][0][1])/p)+ineqlines[curTarget][n][0][0],y=ineqlines[curTarget][n][0][1]-(targets[curTarget].imgheight-ineqlines[curTarget][n][0][1]),v=targets[curTarget].imgheight;else h=Math.sqrt((0-ineqlines[curTarget][n][0][1])/p)+ineqlines[curTarget][n][0][0],m=-1*Math.sqrt((0-ineqlines[curTarget][n][0][1])/p)+ineqlines[curTarget][n][0][0],y=2*ineqlines[curTarget][n][0][1],v=0;var f=(j=h+2/3*(ineqlines[curTarget][n][0][0]-h))+(m-h)/3,w=E=v+2/3*(y-v);a.moveTo(h,v),a.bezierCurveTo(j,E,f,w,m,v)}a.stroke()}else l!=ineqlines[curTarget][n][0][0]&&dashedParabola(a,ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],l,g,targets[curTarget].imgwidth,targets[curTarget].imgheight);else if(l!=ineqlines[curTarget][n][0][0]){s=(g-ineqlines[curTarget][n][0][1])/(l-ineqlines[curTarget][n][0][0]);l<ineqlines[curTarget][n][0][0]&&(s*=-1);d=ineqlines[curTarget][n][0][1]+s*ineqlines[curTarget][n][0][0],T=ineqlines[curTarget][n][0][1]+s*(targets[curTarget].imgwidth-ineqlines[curTarget][n][0][0]);10.6==ineqtypes[curTarget][n]?(null!=dragObj&&dragObj.mode>=10&&dragObj.mode<11&&dragObj.num==n&&dragObj.subnum,a.dashedLine(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],targets[curTarget].imgwidth,T),a.dashedLine(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1],0,d)):(a.moveTo(0,d),a.lineTo(ineqlines[curTarget][n][0][0],ineqlines[curTarget][n][0][1]),a.lineTo(targets[curTarget].imgwidth,T),a.stroke())}if(ineqtypes[curTarget][n]==targets[curTarget].mode){a.beginPath();for(var b=0;b<ineqlines[curTarget][n].length;b++)2==b?(a.arc(ineqlines[curTarget][n][b][0],ineqlines[curTarget][n][b][1],4,0,2*Math.PI,!0),a.fill()):a.fillRect(ineqlines[curTarget][n][b][0]-3,ineqlines[curTarget][n][b][1]-3,6,6);1==ineqlines[curTarget][n].length&&null!=l&&a.fillRect(l-3,g-3,6,6)}a.beginPath()}a.fillStyle="rgb(0,0,255)",1==drawlocky[curTarget]?a.lineWidth=4:a.lineWidth=2,a.strokeStyle="rgb(0,0,255)";for(n=0;n<tplines[curTarget].length;n++){if(tptypes[curTarget][n]>=5&&tptypes[curTarget][n]<6){var q;s=null,l=null,g=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l)if(5.3==tptypes[curTarget][n]||5.4==tptypes[curTarget][n]){if(a.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),a.lineTo(l,g),5.4==tptypes[curTarget][n]){var x=[l-tplines[curTarget][n][0][0],g-tplines[curTarget][n][0][1]],M=Math.sqrt(x[0]*x[0]+x[1]*x[1]);M>1e-4&&(q=[-(x=[x[0]/M,x[1]/M])[1],x[0]],a.moveTo(l-15*x[0]-4*q[0],g-15*x[1]-5*q[1]),a.lineTo(l,g),a.moveTo(l-15*x[0]+4*q[0],g-15*x[1]+5*q[1]),a.lineTo(l,g))}}else{if(l!=tplines[curTarget][n][0][0])s=(g-tplines[curTarget][n][0][1])/(l-tplines[curTarget][n][0][0]);if(Math.abs(l-tplines[curTarget][n][0][0])<1||Math.abs(s)>100)5.1==tptypes[curTarget][n]?a.dashedLine(tplines[curTarget][n][0][0],0,tplines[curTarget][n][0][0],targets[curTarget].imgheight):5.2==tptypes[curTarget][n]?(a.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),g>tplines[curTarget][n][0][1]?a.lineTo(tplines[curTarget][n][0][0],targets[curTarget].imgheight):a.lineTo(tplines[curTarget][n][0][0],0)):(a.moveTo(tplines[curTarget][n][0][0],0),a.lineTo(tplines[curTarget][n][0][0],targets[curTarget].imgheight));else{d=tplines[curTarget][n][0][1]-s*tplines[curTarget][n][0][0],T=tplines[curTarget][n][0][1]+s*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0]),d=tplines[curTarget][n][0][1]-s*tplines[curTarget][n][0][0],T=tplines[curTarget][n][0][1]+s*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0]);5.1==tptypes[curTarget][n]?(a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],targets[curTarget].imgwidth,T),a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],0,d)):5.2==tptypes[curTarget][n]?(a.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),l>tplines[curTarget][n][0][0]?a.lineTo(targets[curTarget].imgwidth,T):a.lineTo(0,d)):(a.moveTo(0,d),a.lineTo(targets[curTarget].imgwidth,T))}}}else if(6==tptypes[curTarget][n]||6.1==tptypes[curTarget][n]||6.2==tptypes[curTarget][n]){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l)if(6==tptypes[curTarget][n])if(g==tplines[curTarget][n][0][1])a.moveTo(0,g),a.lineTo(targets[curTarget].imgwidth,g);else if(l==tplines[curTarget][n][0][0])a.moveTo(l,tplines[curTarget][n][0][1]),g>tplines[curTarget][n][0][1]?a.lineTo(l,targets[curTarget].imgheight):a.lineTo(l,0);else{p=(g-tplines[curTarget][n][0][1])/((l-tplines[curTarget][n][0][0])*(l-tplines[curTarget][n][0][0]));if(g>tplines[curTarget][n][0][1])h=Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][n][0][1])/p)+tplines[curTarget][n][0][0],m=-1*Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][n][0][1])/p)+tplines[curTarget][n][0][0],y=tplines[curTarget][n][0][1]-(targets[curTarget].imgheight-tplines[curTarget][n][0][1]),v=targets[curTarget].imgheight;else h=Math.sqrt((0-tplines[curTarget][n][0][1])/p)+tplines[curTarget][n][0][0],m=-1*Math.sqrt((0-tplines[curTarget][n][0][1])/p)+tplines[curTarget][n][0][0],y=2*tplines[curTarget][n][0][1],v=0;f=(j=h+2/3*(tplines[curTarget][n][0][0]-h))+(m-h)/3,w=E=v+2/3*(y-v);a.moveTo(h,v),a.bezierCurveTo(j,E,f,w,m,v)}else if(6.1==tptypes[curTarget][n])if(l==tplines[curTarget][n][0][0])a.moveTo(l,0),a.lineTo(l,targets[curTarget].imgheight);else if(g==tplines[curTarget][n][0][1])a.moveTo(tplines[curTarget][n][0][0],g),l>tplines[curTarget][n][0][0]?a.lineTo(targets[curTarget].imgwidth,g):a.lineTo(0,g);else{p=(l-tplines[curTarget][n][0][0])/((g-tplines[curTarget][n][0][1])*(g-tplines[curTarget][n][0][1]));if(l>tplines[curTarget][n][0][0]){h=Math.sqrt((targets[curTarget].imgwidth-tplines[curTarget][n][0][0])/p)+tplines[curTarget][n][0][1],m=-1*Math.sqrt((targets[curTarget].imgwidth-tplines[curTarget][n][0][0])/p)+tplines[curTarget][n][0][1];var O=tplines[curTarget][n][0][0]-(targets[curTarget].imgwidth-tplines[curTarget][n][0][0]),L=targets[curTarget].imgwidth}else h=Math.sqrt((0-tplines[curTarget][n][0][0])/p)+tplines[curTarget][n][0][1],m=-1*Math.sqrt((0-tplines[curTarget][n][0][0])/p)+tplines[curTarget][n][0][1],O=2*tplines[curTarget][n][0][0],L=0;w=(E=h+2/3*(tplines[curTarget][n][0][1]-h))+(m-h)/3,f=j=L+2/3*(O-L);a.moveTo(L,h),a.bezierCurveTo(j,E,f,w,L,m)}else if(6.2==tptypes[curTarget][n])if(g==tplines[curTarget][n][0][1])a.moveTo(tplines[curTarget][n][0][0],g),a.lineTo(l<tplines[curTarget][n][0][0]?0:targets[curTarget].imgwidth,g);else if(l==tplines[curTarget][n][0][0])a.moveTo(l,tplines[curTarget][n][0][1]),g>tplines[curTarget][n][0][1]?a.lineTo(l,targets[curTarget].imgheight):a.lineTo(l,0);else{p=(g-tplines[curTarget][n][0][1])/((l-tplines[curTarget][n][0][0])*(l-tplines[curTarget][n][0][0])),tplines[curTarget][n][0][0];if(g>tplines[curTarget][n][0][1]){var P=Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][n][0][1])/p);v=targets[curTarget].imgheight}else P=Math.sqrt((0-tplines[curTarget][n][0][1])/p),v=0;l<tplines[curTarget][n][0][0]&&(P*=-1);var j=tplines[curTarget][n][0][0]+1/3*P,E=tplines[curTarget][n][0][1];f=tplines[curTarget][n][0][0]+2/3*P,w=tplines[curTarget][n][0][1]+1/3*p*P*P;a.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),a.bezierCurveTo(j,E,f,w,tplines[curTarget][n][0][0]+P,v)}}else if(6.5==tptypes[curTarget][n]){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l&&l!=tplines[curTarget][n][0][0])if(g==tplines[curTarget][n][0][1])a.moveTo(tplines[curTarget][n][0][0],g),l>tplines[curTarget][n][0][0]?a.lineTo(targets[curTarget].imgwidth,g):a.lineTo(0,g);else{var I=l<tplines[curTarget][n][0][0]?-1:1;p=(g-tplines[curTarget][n][0][1])/Math.sqrt(I*(l-tplines[curTarget][n][0][0]));a.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),N=tplines[curTarget][n][0][0],_=tplines[curTarget][n][0][1];do{N+=3*I,_=p*Math.sqrt(I*(N-tplines[curTarget][n][0][0]))+tplines[curTarget][n][0][1],a.lineTo(N,_)}while(N>0&&N<targets[curTarget].imgwidth&&_>0&&_<targets[curTarget].imgheight)}}else if(6.3==tptypes[curTarget][n]){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l&&l!=tplines[curTarget][n][0][0])if(g==tplines[curTarget][n][0][1])a.moveTo(0,g),a.lineTo(targets[curTarget].imgwidth,g);else{p=(g-tplines[curTarget][n][0][1])/safepow(l-tplines[curTarget][n][0][0],3);for(var _=0,N=0;N<targets[curTarget].imgwidth+4;N+=1)(_=p*safepow(N-tplines[curTarget][n][0][0],3)+tplines[curTarget][n][0][1])<-100&&(_=-100),_>targets[curTarget].imgheight+100&&(_=targets[curTarget].imgheight+100),0==N?a.moveTo(N,_):a.lineTo(N,_)}}else if(6.6==tptypes[curTarget][n]){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l&&l!=tplines[curTarget][n][0][0])if(g==tplines[curTarget][n][0][1])a.moveTo(0,g),a.lineTo(targets[curTarget].imgwidth,g);else for(p=(g-tplines[curTarget][n][0][1])/safepow(l-tplines[curTarget][n][0][0],1/3),_=0,N=0;N<targets[curTarget].imgwidth+4;N+=1)(_=p*safepow(N-tplines[curTarget][n][0][0],1/3)+tplines[curTarget][n][0][1])<-100&&(_=-100),_>targets[curTarget].imgheight+100&&(_=targets[curTarget].imgheight+100),0==N?a.moveTo(N,_):a.lineTo(N,_)}else if(tptypes[curTarget][n]>=7&&tptypes[curTarget][n]<8){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l&&(l!=tplines[curTarget][n][0][0]||g!=tplines[curTarget][n][0][1]))if(7==tptypes[curTarget][n]){var B=Math.abs(l-tplines[curTarget][n][0][0]),k=Math.abs(g-tplines[curTarget][n][0][1]),$=B/targets[curTarget].pixperx,C=k/targets[curTarget].pixpery,A=Math.sqrt($*$+C*C);a.save(),a.beginPath();var D=A*targets[curTarget].pixperx,S=A*targets[curTarget].pixpery;a.translate(tplines[curTarget][n][0][0]-D,tplines[curTarget][n][0][1]-S),a.scale(D,S),a.arc(1,1,1,0,2*Math.PI,!1),a.restore()}else if(7.2==tptypes[curTarget][n]){D=Math.abs(l-tplines[curTarget][n][0][0]),S=Math.abs(g-tplines[curTarget][n][0][1]);(curTPcurve==n||null!=dragObj&&dragObj.num==n)&&(a.strokeStyle="rgb(0,255,255)",a.lineWidth=1,a.dashedLine(l,g,l-2*(l-tplines[curTarget][n][0][0]),g,5),a.dashedLine(l,g,l,g-2*(g-tplines[curTarget][n][0][1]),5),a.dashedLine(l,g-2*(g-tplines[curTarget][n][0][1]),l-2*(l-tplines[curTarget][n][0][0]),g-2*(g-tplines[curTarget][n][0][1]),5),a.dashedLine(l-2*(l-tplines[curTarget][n][0][0]),g,l-2*(l-tplines[curTarget][n][0][0]),g-2*(g-tplines[curTarget][n][0][1]),5),a.lineWidth=2),a.strokeStyle="rgb(0,0,255)",a.save(),a.beginPath(),a.translate(tplines[curTarget][n][0][0]-D,tplines[curTarget][n][0][1]-S),a.scale(D,S),a.arc(1,1,1,0,2*Math.PI,!1),a.restore()}else if(7.4==tptypes[curTarget][n]){var W=Math.abs(l-tplines[curTarget][n][0][0]),R=Math.abs(g-tplines[curTarget][n][0][1]),H=Math.abs(R/W);a.strokeStyle=asymcolor,a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],targets[curTarget].imgwidth,tplines[curTarget][n][0][1]+H*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0])),a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],targets[curTarget].imgwidth,tplines[curTarget][n][0][1]-H*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0])),a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],0,tplines[curTarget][n][0][1]-H*tplines[curTarget][n][0][0]),a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],0,tplines[curTarget][n][0][1]+H*tplines[curTarget][n][0][0]),(curTPcurve==n||null!=dragObj&&dragObj.num==n)&&(a.strokeStyle="rgb(0,255,255)",a.lineWidth=1,a.dashedLine(l,g,l-2*(l-tplines[curTarget][n][0][0]),g,5),a.dashedLine(l,g,l,g-2*(g-tplines[curTarget][n][0][1]),5),a.dashedLine(l,g-2*(g-tplines[curTarget][n][0][1]),l-2*(l-tplines[curTarget][n][0][0]),g-2*(g-tplines[curTarget][n][0][1]),5),a.dashedLine(l-2*(l-tplines[curTarget][n][0][0]),g,l-2*(l-tplines[curTarget][n][0][0]),g-2*(g-tplines[curTarget][n][0][1]),5),a.lineWidth=2),a.beginPath(),a.strokeStyle="rgb(0,0,255)";for(N=0;N<targets[curTarget].imgwidth+4;N+=3)(_=tplines[curTarget][n][0][1]+Math.sqrt((Math.pow(N-tplines[curTarget][n][0][0],2)/(W*W)+1)*R*R))<-100&&(_=-100),_>targets[curTarget].imgheight+100&&(_=targets[curTarget].imgheight+100),0==N?a.moveTo(N,_):a.lineTo(N,_);a.stroke(),a.beginPath();for(N=0;N<targets[curTarget].imgwidth+4;N+=3)(_=tplines[curTarget][n][0][1]-Math.sqrt((Math.pow(N-tplines[curTarget][n][0][0],2)/(W*W)+1)*R*R))<-100&&(_=-100),_>targets[curTarget].imgheight+100&&(_=targets[curTarget].imgheight+100),0==N?a.moveTo(N,_):a.lineTo(N,_)}else if(7.5==tptypes[curTarget][n]){R=Math.abs(l-tplines[curTarget][n][0][0]),W=Math.abs(g-tplines[curTarget][n][0][1]),H=Math.abs(W/R);a.strokeStyle=asymcolor,a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],targets[curTarget].imgwidth,tplines[curTarget][n][0][1]+H*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0])),a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],targets[curTarget].imgwidth,tplines[curTarget][n][0][1]-H*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0])),a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],0,tplines[curTarget][n][0][1]-H*tplines[curTarget][n][0][0]),a.dashedLine(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1],0,tplines[curTarget][n][0][1]+H*tplines[curTarget][n][0][0]),(curTPcurve==n||null!=dragObj&&dragObj.num==n)&&(a.strokeStyle="rgb(0,255,255)",a.lineWidth=1,a.dashedLine(l,g,l-2*(l-tplines[curTarget][n][0][0]),g,5),a.dashedLine(l,g,l,g-2*(g-tplines[curTarget][n][0][1]),5),a.dashedLine(l,g-2*(g-tplines[curTarget][n][0][1]),l-2*(l-tplines[curTarget][n][0][0]),g-2*(g-tplines[curTarget][n][0][1]),5),a.dashedLine(l-2*(l-tplines[curTarget][n][0][0]),g,l-2*(l-tplines[curTarget][n][0][0]),g-2*(g-tplines[curTarget][n][0][1]),5),a.lineWidth=2),a.beginPath(),a.strokeStyle="rgb(0,0,255)";for(_=0;_<targets[curTarget].imgwidth+4;_+=3)(N=tplines[curTarget][n][0][0]+Math.sqrt((Math.pow(_-tplines[curTarget][n][0][1],2)/(W*W)+1)*R*R))<-100&&(N=-100),N>targets[curTarget].imgwidth+100&&(N=targets[curTarget].imgwidth+100),0==_?a.moveTo(N,_):a.lineTo(N,_);a.stroke(),a.beginPath();for(_=0;_<targets[curTarget].imgwidth+4;_+=3)(N=tplines[curTarget][n][0][0]-Math.sqrt((Math.pow(_-tplines[curTarget][n][0][1],2)/(W*W)+1)*R*R))<-100&&(N=-100),N>targets[curTarget].imgwidth+100&&(N=targets[curTarget].imgwidth+100),0==_?a.moveTo(N,_):a.lineTo(N,_)}}else if(8==tptypes[curTarget][n]){s=null,l=null,g=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l){if(l!=tplines[curTarget][n][0][0]){s=(g-tplines[curTarget][n][0][1])/(l-tplines[curTarget][n][0][0]);l<tplines[curTarget][n][0][0]&&(s*=-1)}if(Math.abs(l-tplines[curTarget][n][0][0])<1||Math.abs(s)>100)a.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),g>tplines[curTarget][n][0][1]?a.lineTo(tplines[curTarget][n][0][0],targets[curTarget].imgheight):a.lineTo(tplines[curTarget][n][0][0],0);else{d=tplines[curTarget][n][0][1]+s*tplines[curTarget][n][0][0],T=tplines[curTarget][n][0][1]+s*(targets[curTarget].imgwidth-tplines[curTarget][n][0][0]);a.moveTo(0,d),a.lineTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]),a.lineTo(targets[curTarget].imgwidth,T)}}}else if(8.3==tptypes[curTarget][n]){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l&&l!=tplines[curTarget][n][0][0])if(g==tplines[curTarget][n][0][1])a.moveTo(0,g),a.lineTo(targets[curTarget].imgwidth,g);else{var z=targets[curTarget].ymax*targets[curTarget].pixpery+targets[curTarget].imgborder,U=z-tplines[curTarget][n][0][1];if(U*(G=z-g)>0&&l!=tplines[curTarget][n][0][0]){var F=safepow(G/U,1/(l-tplines[curTarget][n][0][0]));p=G/safepow(F,l);a.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]);for(_=0,N=0;N<targets[curTarget].imgwidth+4;N+=3)(_=z-p*safepow(F,N))<-100&&(_=-100),_>targets[curTarget].imgheight+100&&(_=targets[curTarget].imgheight+100),0==N?a.moveTo(N,_):a.lineTo(N,_)}}}else if(8.4==tptypes[curTarget][n]){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l&&l!=tplines[curTarget][n][0][0]&&g!=tplines[curTarget][n][0][1]){var Y=-targets[curTarget].xmin*targets[curTarget].pixperx+targets[curTarget].imgborder,X=Y-tplines[curTarget][n][0][0];if(X*(K=Y-l)>0&&g!=tplines[curTarget][n][0][1]){F=safepow(K/X,1/(g-tplines[curTarget][n][0][1])),p=K/safepow(F,g);a.moveTo(tplines[curTarget][n][0][0],tplines[curTarget][n][0][1]);for(_=0,_=0;_<targets[curTarget].imgheight+4;_+=3)(N=Y-p*safepow(F,_))<-100&&(N=-100),N>targets[curTarget].imgwidth+100&&(N=targets[curTarget].imgwidth+100),0==_?a.moveTo(N,_):a.lineTo(N,_)}}}else if(8.5==tptypes[curTarget][n]){g=null,l=null,o=null,u=null;3==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1],u=tplines[curTarget][n][2][0],o=tplines[curTarget][n][2][1]):2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1],u=e,o=t):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t);var V=tplines[curTarget][n][0][1];if(a.strokeStyle=asymcolor,a.dashedLine(5,V,targets[curTarget].imgwidth,V),a.beginPath(),a.strokeStyle="rgb(0,0,255)",null!=u&&u!=l)if(o==g)a.moveTo(0,o),a.lineTo(targets[curTarget].imgwidth,o);else{var G,J=V-o;if((G=V-g)*J>0&&u!=l){F=safepow(J/G,1/(u-l)),p=J/safepow(F,u);a.moveTo(l,g);for(_=0,N=0;N<targets[curTarget].imgwidth+4;N+=3)(_=V-p*safepow(F,N))<-100&&(_=-100),_>targets[curTarget].imgheight+100&&(_=targets[curTarget].imgheight+100),0==N?a.moveTo(N,_):a.lineTo(N,_)}}}else if(8.6==tptypes[curTarget][n]){g=null,l=null,o=null,u=null;3==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1],u=tplines[curTarget][n][2][0],o=tplines[curTarget][n][2][1]):2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1],u=e,o=t):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t);var Q=tplines[curTarget][n][0][0];if(a.strokeStyle=asymcolor,a.dashedLine(Q,5,Q,targets[curTarget].imgheight),a.beginPath(),a.strokeStyle="rgb(0,0,255)",null!=u&&u!=l&&o!=g){var K,Z=u-Q;if((K=l-Q)*Z>0){F=safepow(Z/K,1/(o-g)),p=Z/safepow(F,o);a.moveTo(l,g);for(N=0,_=0;_<targets[curTarget].imgheight+4;_+=3)(N=Q+p*safepow(F,_))<-100&&(N=-100),N>targets[curTarget].imgwidth+100&&(N=targets[curTarget].imgwidth+100),0==_?a.moveTo(N,_):a.lineTo(N,_)}}}else if(8.2==tptypes[curTarget][n]){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),a.strokeStyle=asymcolor,a.dashedLine(5,tplines[curTarget][n][0][1],targets[curTarget].imgwidth,tplines[curTarget][n][0][1]),a.dashedLine(tplines[curTarget][n][0][0],5,tplines[curTarget][n][0][0],targets[curTarget].imgheight),a.beginPath(),a.strokeStyle="rgb(0,0,255)",null!=l&&l!=tplines[curTarget][n][0][0]&&g!=tplines[curTarget][n][0][1]){for(p=(g-tplines[curTarget][n][0][1])*(l-tplines[curTarget][n][0][0]),N=tplines[curTarget][n][0][0]-1;N>-4;N-=3)(_=p/(N-tplines[curTarget][n][0][0])+tplines[curTarget][n][0][1])<-100&&(_=-100),_>targets[curTarget].imgheight+100&&(_=targets[curTarget].imgheight+100),N==tplines[curTarget][n][0][0]-1?a.moveTo(N,_):a.lineTo(N,_);for(N=tplines[curTarget][n][0][0]+1;N<targets[curTarget].imgwidth+4;N+=3)(_=p/(N-tplines[curTarget][n][0][0])+tplines[curTarget][n][0][1])<-100&&(_=-100),_>targets[curTarget].imgheight+100&&(_=targets[curTarget].imgheight+100),N==tplines[curTarget][n][0][0]+1?a.moveTo(N,_):a.lineTo(N,_);a.stroke()}}else if(9==tptypes[curTarget][n]||9.1==tptypes[curTarget][n]){g=null,l=null;if(2==tplines[curTarget][n].length?(l=tplines[curTarget][n][1][0],g=tplines[curTarget][n][1][1]):curTPcurve==n&&null!=e&&1==tplines[curTarget][n].length&&(l=e,g=t),null!=l&&l!=tplines[curTarget][n][0][0])if(g==tplines[curTarget][n][0][1])a.moveTo(0,g),a.lineTo(targets[curTarget].imgwidth,g);else{if(9==tptypes[curTarget][n])var ee=-1*Math.abs(g-tplines[curTarget][n][0][1])/2,te=(g+tplines[curTarget][n][0][1])/2,re=(p=Math.PI/Math.abs(l-tplines[curTarget][n][0][0]),g<tplines[curTarget][n][0][1]?l:tplines[curTarget][n][0][0]);else if(9.1==tptypes[curTarget][n])ee=-1*Math.abs(g-tplines[curTarget][n][0][1]),te=tplines[curTarget][n][0][1],p=.5*Math.PI/Math.abs(l-tplines[curTarget][n][0][0]),re=g<tplines[curTarget][n][0][1]?l:l+2*Math.abs(l-tplines[curTarget][n][0][0]);for(_=0,N=0;N<targets[curTarget].imgwidth+4;N+=3)_=ee*Math.cos(p*(N-re))+te,0==N?a.moveTo(N,_):a.lineTo(N,_)}}a.stroke(),a.beginPath()}var ae,ne,ie,se;null===curTPcurve&&tpHasAsymp.hasOwnProperty(targets[curTarget].mode)&&(a.strokeStyle="rgb(200,200,200)",8.5==targets[curTarget].mode?a.dashedLine(5,t,targets[curTarget].imgwidth,t):8.6==targets[curTarget].mode?a.dashedLine(e,5,e,targets[curTarget].imgwidth):8.2==targets[curTarget].mode?(a.dashedLine(5,t,targets[curTarget].imgwidth,t),a.dashedLine(e,5,e,targets[curTarget].imgheight)):7.4!=targets[curTarget].mode&&7.5!=targets[curTarget].mode||(a.dashedLine(e,t,targets[curTarget].imgwidth,t+(targets[curTarget].imgwidth-e)),a.dashedLine(e,t,targets[curTarget].imgwidth,t-(targets[curTarget].imgwidth-e)),a.dashedLine(e,t,0,t-e),a.dashedLine(e,t,0,t+e)),a.beginPath(),a.strokeStyle="rgb(0,0,255)"),a.fillStyle="rgba(0,0,255,.5)";for(n=0;n<lines[curTarget].length;n++){a.beginPath();for(b=0;b<lines[curTarget][n].length;b++)0==b?(a.moveTo(lines[curTarget][n][b][0],lines[curTarget][n][b][1]),ae=lines[curTarget][n][b][0],ne=lines[curTarget][n][b][1]):(a.lineTo(lines[curTarget][n][b][0],lines[curTarget][n][b][1]),ie=lines[curTarget][n][b][0],se=lines[curTarget][n][b][1]);n==curLine&&null!=e&&(a.lineTo(e,t),ie=e,se=t);var le=.02*targets[curTarget].imgwidth;if(1==drawlocky[curTarget]&&ie>.98*targets[curTarget].imgwidth?(a.moveTo(ie,se),a.lineTo(ie-le,se+le),a.moveTo(ie,se),a.lineTo(ie-le,se-le)):1==drawlocky[curTarget]&&ae>.98*targets[curTarget].imgwidth&&(a.moveTo(ae,ne),a.lineTo(ae-le,ne+le),a.moveTo(ae,ne),a.lineTo(ae-le,ne-le)),1==drawlocky[curTarget]&&ie<.02*targets[curTarget].imgwidth?(a.moveTo(ie,se),a.lineTo(ie+le,se+le),a.moveTo(ie,se),a.lineTo(ie+le,se-le)):1==drawlocky[curTarget]&&ae<.02*targets[curTarget].imgwidth&&(a.moveTo(ae,ne),a.lineTo(ae+le,ne+le),a.moveTo(ae,ne),a.lineTo(ae+le,ne-le)),a.stroke(),targets[curTarget].dotline>1){if(lines[curTarget][n].length-1<1)continue;if(Math.pow(ie-ae,2)+Math.pow(se-ne,2)<25){a.moveTo(lines[curTarget][n][0][0],lines[curTarget][n][0][1]);for(b=1;b<lines[curTarget][n].length;b++)a.lineTo(lines[curTarget][n][b][0],lines[curTarget][n][b][1]);a.closePath(),a.fill()}}}a.fillStyle="rgb(0,0,255)",a.beginPath();for(n=0;n<dots[curTarget].length;n++)a.moveTo(dots[curTarget][n][0]+5,dots[curTarget][n][1]),a.arc(dots[curTarget][n][0],dots[curTarget][n][1],5,0,2*Math.PI,!0);if(a.fill(),targets[curTarget].dotline>0){a.beginPath();for(n=0;n<lines[curTarget].length;n++)for(b=0;b<lines[curTarget][n].length;b++)(0==b||Math.pow(lines[curTarget][n][b][0]-lines[curTarget][n][b-1][0],2)+Math.pow(lines[curTarget][n][b][1]-lines[curTarget][n][b-1][1],2)>25)&&(a.moveTo(lines[curTarget][n][b][0]+5,lines[curTarget][n][b][1]),a.arc(lines[curTarget][n][b][0],lines[curTarget][n][b][1],5,0,2*Math.PI,!0));a.fill()}a.fillStyle="rgb(255,255,255)",a.beginPath();for(n=0;n<odots[curTarget].length;n++)a.moveTo(odots[curTarget][n][0]+5,odots[curTarget][n][1]),a.arc(odots[curTarget][n][0],odots[curTarget][n][1],4,0,2*Math.PI,!0);targets[curTarget].mode<3?a.fill():a.stroke(),a.lineWidth=2,a.beginPath();for(n=0;n<odots[curTarget].length;n++)a.moveTo(odots[curTarget][n][0]+5,odots[curTarget][n][1]),a.arc(odots[curTarget][n][0],odots[curTarget][n][1],4,0,2*Math.PI,!0);a.stroke();for(n=0;n<tplines[curTarget].length;n++)if(tptypes[curTarget][n]==targets[curTarget].mode){a.fillStyle="rgb(255,0,0)";for(b=0;b<tplines[curTarget][n].length;b++)a.fillRect(tplines[curTarget][n][b][0]-3,tplines[curTarget][n][b][1]-3,6,6);tplines[curTarget][n].length<tpModeN[targets[curTarget].mode]&&null!=e&&curTPcurve==n&&a.fillRect(e-3,t-3,6,6),a.fillStyle="rgb(0,0,255)"}!0!==r&&encodeDraw()}function deleteCurve(e,t){1==e?dots[curTarget].splice(t,1):2==e?odots[curTarget].splice(t,1):e>=0&&e<1?lines[curTarget].splice(t,1):e>=5&&e<10?(tplines[curTarget].splice(t,1),tptypes[curTarget].splice(t,1),curTPcurve=null):e>=10&&e<11&&(ineqlines[curTarget].splice(t,1),ineqtypes[curTarget].splice(t,1),curIneqcurve=null),drawTarget()}function roundToDec(e,t){return Math.round(e)}function encodeDraw(){for(var e="",t=[],r=0;r<lines[curTarget].length;r++){lines[curTarget][r].length;t=0==targets[curTarget].dotline?pathsimplify(lines[curTarget][r]):lines[curTarget][r],0!=r&&(e+=";");for(var a=0;a<t.length;a++)0!=a&&(e+=","),e+="("+roundToDec(t[a][0],4)+","+roundToDec(t[a][1],4)+")"}e+=";;";for(r=0;r<dots[curTarget].length;r++)0!=r&&(e+=","),e+="("+roundToDec(dots[curTarget][r][0],4)+","+roundToDec(dots[curTarget][r][1],4)+")";e+=";;";for(r=0;r<odots[curTarget].length;r++)0!=r&&(e+=","),e+="("+roundToDec(odots[curTarget][r][0],4)+","+roundToDec(odots[curTarget][r][1],4)+")";e+=";;";var n=[],i="";for(r=0;r<tplines[curTarget].length;r++)if(tplines[curTarget][r].length==tpModeN[tptypes[curTarget][r]]){i="("+tptypes[curTarget][r];for(a=0;a<tplines[curTarget][r].length;a++)i+=","+roundToDec(tplines[curTarget][r][a][0],4)+","+roundToDec(tplines[curTarget][r][a][1],4);n.push(i+")")}e+=n.join(","),e+=";;";var s=[];for(r=0;r<ineqlines[curTarget].length;r++)ineqlines[curTarget][r].length>2&&s.push("("+ineqtypes[curTarget][r]+","+roundToDec(ineqlines[curTarget][r][0][0],4)+","+roundToDec(ineqlines[curTarget][r][0][1],4)+","+roundToDec(ineqlines[curTarget][r][1][0],4)+","+roundToDec(ineqlines[curTarget][r][1][1],4)+","+roundToDec(ineqlines[curTarget][r][2][0],4)+","+roundToDec(ineqlines[curTarget][r][2][1],4)+")");if(e+=s.join(","),targetOuts[curTarget].value!=e){var l=""!=targetOuts[curTarget].value||";;;;;;;;"!=e;targetOuts[curTarget].value=e,l&&$(targetOuts[curTarget]).trigger("input").trigger("change")}}var clickcnt=0;function drawMouseDown(e){if(clickcnt++,clearAllDrawListners(),hasTouch&&e.originalEvent.touches.length>1)return didMultiTouch=!0,$(document).on("touchend.imathasdraw",drawMouseUp),!0;hasTouch?(window.clearTimeout(hasTouchTimer),$(document).off("mousemove.imathasdraw"),$(".drawcanvas").on("touchstart.imathasdraw",(function(e){hasTouch=!0,drawMouseDown(e)})),$(".drawcanvas").on("touchmove.imathasdraw",drawMouseMove),$(document).on("touchend.imathasdraw",drawMouseUp),$(document).on("touchcancel.imathasdraw",drawMouseUp)):($(document).on("mousemove.imathasdraw",drawMouseMove),$(document).on("mouseup.imathasdraw",drawMouseUp));var t=mouseCoords(e);if(null==curTarget||null==curLine&&null==curTPcurve&&null==curIneqcurve)for(i in targets){if(!$(targets[i].el).is(":hidden")&&"canvas"==targets[i].type)if((r=getPosition(targets[i].el)).x<t.x&&r.x+targets[i].width>t.x&&r.y<t.y&&r.y+targets[i].height>t.y&&e.target==targets[i].el){curTarget=i;break}}if(null!=curTarget){if(targetOuts[curTarget].disabled)return;e.preventDefault(),mouseisdown=!0;var r=getPosition(targets[curTarget].el),a={x:t.x-r.x,y:t.y-r.y};if(a.x>-1&&a.x<targets[curTarget].width&&a.y>-1&&a.y<targets[curTarget].height){targets[curTarget].snaptogridx>0&&(a=snaptogrid(a,curTarget)),1==drawlocky[curTarget]&&(a.y=targets[curTarget].imgheight/2);var n=findnearpoint(curTarget,a);if(null!=n){if(-1==targets[curTarget].mode)return void deleteCurve(n[0],n[1]);(null!=curLine&&n[0]<1&&curLine!=n[1]||null!=curTPcurve&n[0]>=5&&n[0]<10&&curTPcurve!=n[1]||null!=curIneqcurve&&n[0]>=10&&n[0]<11&&curIneqcurve!=n[1])&&(n=null)}null==n?(setCursor("pendown"),1==targets[curTarget].mode?(dots[curTarget].push([a.x,a.y]),dragObj={mode:1,num:dots[curTarget].length-1}):2==targets[curTarget].mode?(odots[curTarget].push([a.x,a.y]),dragObj={mode:2,num:odots[curTarget].length-1}):0==targets[curTarget].mode||.7==targets[curTarget].mode?null==curLine?(lines[curTarget].push([[a.x,a.y]]),curLine=lines[curTarget].length-1):lines[curTarget][curLine].push([a.x,a.y]):.5==targets[curTarget].mode?null==curLine?(lines[curTarget].push([[a.x,a.y]]),curLine=lines[curTarget].length-1):(lines[curTarget][curLine].push([a.x,a.y]),curLine=null,dragObj=null):targets[curTarget].mode>=5&&targets[curTarget].mode<10?null==curTPcurve?(tplines[curTarget].push([[a.x,a.y]]),curTPcurve=tplines[curTarget].length-1,tptypes[curTarget][curTPcurve]=targets[curTarget].mode,mouseisdown=!1):(tplines[curTarget][curTPcurve].push([a.x,a.y]),tplines[curTarget][curTPcurve].length==tpModeN[targets[curTarget].mode]?(dragObj={mode:targets[curTarget].mode,num:curTPcurve,subnum:tpModeN[targets[curTarget].mode]-1},curTPcurve=null):mouseisdown=!1):targets[curTarget].mode>=10&&targets[curTarget].mode<11&&(null==curIneqcurve?(ineqlines[curTarget].push([[a.x,a.y]]),curIneqcurve=ineqlines[curTarget].length-1,ineqtypes[curTarget][curIneqcurve]=targets[curTarget].mode,mouseisdown=!1):(ineqlines[curTarget][curIneqcurve].push([a.x,a.y]),2==ineqlines[curTarget][curIneqcurve].length?dragObj={mode:targets[curTarget].mode,num:curIneqcurve,subnum:1}:3==ineqlines[curTarget][curIneqcurve].length&&(dragObj={mode:targets[curTarget].mode,num:curIneqcurve,subnum:2},curIneqcurve=null)))):0==n[0]||.5==n[0]?null==curLine?(setCursor("move"),dragObj={mode:targets[curTarget].mode,num:n[1],subnum:n[2]},oldpointpos=lines[curTarget][n[1]][n[2]],n[2]==lines[curTarget][n[1]].length-1&&0==targets[curTarget].mode?curLine=n[1]:0==n[2]&&0==targets[curTarget].mode&&(curLine=n[1],lines[curTarget][curLine].reverse(),dragObj.subnum=lines[curTarget][curLine].length-1),clickmightbenewcurve=!0):n[1]==curLine&&n[2]==lines[curTarget][n[1]].length-1?(lines[curTarget][curLine].length<2&&lines[curTarget].splice(curLine,1),curLine=null):targets[curTarget].dotline>1&&n[1]==curLine&&0==n[2]?(lines[curTarget][curLine].push(lines[curTarget][curLine][0]),curLine=null):(setCursor("pendown"),lines[curTarget][curLine].push([a.x,a.y])):1==n[0]?(setCursor("move"),dragObj={mode:1,num:n[1]}):2==n[0]?(setCursor("move"),dragObj={mode:2,num:n[1]}):n[0]>=5&&n[0]<10?null==curTPcurve&&(setCursor("move"),dragObj={mode:n[0],num:n[1],subnum:n[2]},oldpointpos=tplines[curTarget][n[1]][n[2]],clickmightbenewcurve=!0):n[0]>=10&&n[0]<11&&null==curIneqcurve&&(setCursor("move"),dragObj={mode:n[0],num:n[1],subnum:n[2]},oldpointpos=ineqlines[curTarget][n[1]][n[2]],clickmightbenewcurve=!0),drawTarget()}else null!=curLine&&(lines[curTarget][curLine].length<2&&lines[curTarget].splice(curLine,1),setCursor("pen")),null!=curTPcurve&&(tplines[curTarget][curTPcurve].length<tpModeN[targets[curTarget].mode]&&(tplines[curTarget].splice(curTPcurve,1),tptypes[curTarget].splice(curTPcurve,1)),setCursor("pen")),null!=curIneqcurve&&(ineqlines[curTarget][curIneqcurve].length<3&&(ineqlines[curTarget].splice(curIneqcurve,1),ineqtypes[curTarget].splice(curIneqcurve,1)),setCursor("pen")),curLine=null,curTPcurve=null,curIneqcurve=null,dragObj=null,drawTarget(),curTarget=null}}function findnearpoint(e,t){if(hasTouch){var r=Math.max(15*window.innerWidth/screen.width,15);r*=r}else if(-1==targets[e].mode)r=50;else r=25;if(0==targets[e].mode||.5==targets[e].mode||-1==targets[e].mode)for(var a=lines[e].length-1;a>=0;a--)for(var n=lines[e][a].length-1;n>=0;n--){if(Math.pow(lines[e][a][n][0]-t.x,2)+Math.pow(lines[e][a][n][1]-t.y,2)<r)return[-1==targets[e].mode?0:targets[e].mode,a,n]}if(1==targets[e].mode||-1==targets[e].mode)for(a=dots[e].length-1;a>=0;a--)if(Math.pow(dots[e][a][0]-t.x,2)+Math.pow(dots[e][a][1]-t.y,2)<r)return[1,a];if(2==targets[e].mode||-1==targets[e].mode)for(a=odots[e].length-1;a>=0;a--)if(Math.pow(odots[e][a][0]-t.x,2)+Math.pow(odots[e][a][1]-t.y,2)<r)return[2,a];if(targets[e].mode>=5&&targets[e].mode<10||-1==targets[e].mode)for(a=tplines[e].length-1;a>=0;a--)for(n=tplines[e][a].length-1;n>=0;n--){if(tptypes[e][a]==targets[e].mode||-1==targets[e].mode)if(Math.pow(tplines[e][a][n][0]-t.x,2)+Math.pow(tplines[e][a][n][1]-t.y,2)<r)return[tptypes[e][a],a,n]}if(targets[e].mode>=10&&targets[e].mode<11||-1==targets[e].mode)for(a=ineqlines[e].length-1;a>=0;a--)for(n=ineqlines[e][a].length-1;n>=0;n--){if(ineqtypes[e][a]==targets[e].mode||-1==targets[e].mode)if(Math.pow(ineqlines[e][a][n][0]-t.x,2)+Math.pow(ineqlines[e][a][n][1]-t.y,2)<r)return[ineqtypes[e][a],a,n]}return null}var lastdrawmouseup=null;function drawMouseUp(e){var t=mouseCoords(e);if(mouseisdown=!1,null!=curTarget){if(targetOuts[curTarget].disabled)return;var r=getPosition(targets[curTarget].el),a={x:t.x-r.x,y:t.y-r.y};targets[curTarget].snaptogridx>0&&(a=snaptogrid(a,curTarget));var n=a.x>-1&&a.x<targets[curTarget].width&&a.y>-1&&a.y<targets[curTarget].height;1==clickmightbenewcurve&&(targets[curTarget].mode>=5&&targets[curTarget].mode<10?(tplines[curTarget].push([[a.x,a.y]]),curTPcurve=tplines[curTarget].length-1,tptypes[curTarget][curTPcurve]=targets[curTarget].mode):targets[curTarget].mode>=10&&targets[curTarget].mode<11&&(ineqlines[curTarget].push([[a.x,a.y]]),curIneqcurve=ineqlines[curTarget].length-1,ineqtypes[curTarget][curIneqcurve]=targets[curTarget].mode)),null!=lastdrawmouseup&&t.x==lastdrawmouseup.x&&t.y==lastdrawmouseup.y&&null!=curLine&&null==dragObj&&(lines[curTarget][curLine].length<2&&lines[curTarget].splice(curLine,1),curLine=null,dragObj=null,drawTarget()),null!=curLine&&null==dragObj&&(.5==targets[curTarget].mode&&lines[curTarget][curLine].length>1||.7==targets[curTarget].mode)&&(curLine=null,dragobj=null,drawTarget()),null!=curTPcurve&&tplines[curTarget][curTPcurve].length<tpModeN[targets[curTarget].mode]&&(didMultiTouch||!n?(tplines[curTarget].splice(curTPcurve,1),tptypes[curTarget].splice(curTPcurve,1),curTPcurve=null,drawTarget()):null==findnearpoint(curTarget,a)&&(tplines[curTarget][curTPcurve].push([a.x,a.y]),tplines[curTarget][curTPcurve].length==tpModeN[targets[curTarget].mode]&&(curTPcurve=null),drawTarget())),null!=curIneqcurve&&1==ineqlines[curTarget][curIneqcurve].length&&(didMultiTouch||!n?(ineqlines[curTarget].splice(curIneqcurve,1),ineqtypes[curTarget].splice(curIneqcurve,1),curIneqcurve=null,drawTarget()):null==findnearpoint(curTarget,a)&&(ineqlines[curTarget][curIneqcurve].push([a.x,a.y]),drawTarget())),setCursor(null==curLine&&null==curTPcurve?"move":"pen"),void 0!==e&&e.preventDefault()}if(lastdrawmouseup=t,null!=curTarget&&null!=dragObj){r=getPosition(targets[curTarget].el);a.x>-1&&a.x<targets[curTarget].width&&a.y>-1&&a.y<targets[curTarget].height?(0==dragObj.mode&&targets[curTarget].dotline>1&&(0!=dragObj.subnum&&dragObj.subnum!=lines[curTarget][dragObj.num].length-1||Math.pow(lines[curTarget][dragObj.num][0][0]-lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][0],2)+Math.pow(lines[curTarget][dragObj.num][0][1]-lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][1],2)<25&&(0==dragObj.subnum?(lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][0]=lines[curTarget][dragObj.num][0][0],lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][1]=lines[curTarget][dragObj.num][0][1]):(lines[curTarget][dragObj.num][0][0]=lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][0],lines[curTarget][dragObj.num][0][1]=lines[curTarget][dragObj.num][lines[curTarget][dragObj.num].length-1][1]),curLine=null,drawTarget())),dragObj=null):(1==drawlocky[curTarget]&&(a.y=targets[curTarget].imgheight/2),1==dragObj.mode?dots[curTarget].splice(dragObj.num,1):2==dragObj.mode?odots[curTarget].splice(dragObj.num,1):.5==dragObj.mode?lines[curTarget].splice(dragObj.num,1):0==dragObj.mode?lines[curTarget][dragObj.num][dragObj.subnum]=oldpointpos:dragObj.mode>=5&&dragObj.mode<10?(tplines[curTarget].splice(dragObj.num,1),tptypes[curTarget].splice(dragObj.num,1),curTPcurve=null):dragObj.mode>=10&&dragObj.mode<11&&(ineqlines[curTarget].splice(dragObj.num,1),ineqtypes[curTarget].splice(dragObj.num,1),curIneqcurve=null),dragObj=null,drawTarget())}didMultiTouch=!1,hasTouch?hasTouchTimer=window.setTimeout((function(){hasTouch=!1,clearAllDrawListners(),$(document).on("mousemove.imathasdraw",drawMouseMove),$(".drawcanvas").on("touchstart.imathasdraw",(function(e){hasTouch=!0,drawMouseDown(e)})),$(document).on("mousedown.imathasdraw",drawMouseDown)}),350):(clearAllDrawListners(),$(document).on("mousemove.imathasdraw",drawMouseMove),$(".drawcanvas").on("touchstart.imathasdraw",(function(e){hasTouch=!0,drawMouseDown(e)})),$(document).on("mousedown.imathasdraw",drawMouseDown))}var mouseintarget=-1;function drawMouseMove(e){var t=null;clickmightbenewcurve=!1;var r=mouseCoords(e);for(i in targets){if(!$(targets[i].el).is(":hidden")&&"canvas"==targets[i].type)if((a=getPosition(targets[i].el)).x<r.x&&a.x+targets[i].width>r.x&&a.y<r.y&&a.y+targets[i].height>r.y&&e.target==targets[i].el){t=i;break}}if(null!=t){if(targetOuts[t].disabled)return;mouseintarget=t;var a=getPosition(targets[t].el),n={x:r.x-a.x,y:r.y-a.y};if(targets[t].snaptogridx>0&&(n=snaptogrid(n,t)),1==drawlocky[t]&&(n.y=targets[t].imgheight/2),n.x>-1&&n.x<targets[t].width&&n.y>-1&&n.y<targets[t].height)if(null==dragObj)if(null==curLine)null==(l=findnearpoint(t,n))?setCursor("pen",t):-1!=targets[t].mode&&setCursor("move",t)}else null!=mouseintarget&&-1!=mouseintarget&&(null!=curTarget?drawTarget():(curTarget=mouseintarget,drawTarget(),curTarget=null),mouseintarget=-1);if(null!=curTarget){if(e.originalEvent.touches&&e.originalEvent.touches.length>1)return didMultiTouch=!0,!0;void 0!==e&&e.preventDefault();a=getPosition(targets[curTarget].el),n={x:r.x-a.x,y:r.y-a.y};if(targets[curTarget].snaptogridx>0&&(n=snaptogrid(n,curTarget)),1==drawlocky[curTarget]&&(n.y=targets[curTarget].imgheight/2),n.x>-1&&n.x<targets[curTarget].width&&n.y>-1&&n.y<targets[curTarget].height){if(null==dragObj){if(mouseisdown&&-1==targets[curTarget].mode)return void(null!=(l=findnearpoint(curTarget,n))&&deleteCurve(l[0],l[1]));if(null!=curLine)if(!mouseisdown||0!=targets[curTarget].mode&&.7!=targets[curTarget].mode)if(mouseisdown&&.5==targets[curTarget].mode){if(0==(s=lines[curTarget][curLine].length-1))Math.pow(lines[curTarget][curLine][s][0]-n.x,2)+Math.pow(lines[curTarget][curLine][s][1]-n.y,2)>25?(lines[curTarget][curLine].push([n.x,n.y]),drawTarget()):drawTarget(n.x,n.y);else lines[curTarget][curLine][s]=[n.x,n.y],drawTarget()}else drawTarget(n.x,n.y);else{var s=lines[curTarget][curLine].length-1;Math.pow(lines[curTarget][curLine][s][0]-n.x,2)+Math.pow(lines[curTarget][curLine][s][1]-n.y,2)>25?(lines[curTarget][curLine].push([n.x,n.y]),drawTarget()):drawTarget(n.x,n.y)}else if(null!=curTPcurve)mouseisdown?drawTarget():drawTarget(n.x,n.y);else if(null!=curIneqcurve)mouseisdown?drawTarget():drawTarget(n.x,n.y);else{var l;null==(l=findnearpoint(curTarget,n))?(setCursor("pen"),tpHasAsymp.hasOwnProperty(targets[curTarget].mode)&&null!==t&&drawTarget(n.x,n.y)):(drawTarget(),-1!=targets[curTarget].mode&&setCursor("move"))}}else setCursor("move"),0==dragObj.mode||.5==dragObj.mode?lines[curTarget][dragObj.num][dragObj.subnum]=[n.x,n.y]:1==dragObj.mode?dots[curTarget][dragObj.num]=[n.x,n.y]:2==dragObj.mode?odots[curTarget][dragObj.num]=[n.x,n.y]:dragObj.mode>=5&&dragObj.mode<10?tplines[curTarget][dragObj.num][dragObj.subnum]=[n.x,n.y]:dragObj.mode>=10&&dragObj.mode<11&&(ineqlines[curTarget][dragObj.num][dragObj.subnum]=[n.x,n.y]),drawTarget();return!1}null==curIneqcurve||mouseisdown||drawTarget()}else null!=t&&-1!=mouseintarget&&(curTarget=t,tpHasAsymp.hasOwnProperty(targets[curTarget].mode)&&drawTarget(n.x,n.y),curTarget=null)}function setCursor(e,t){targets[t=t||curTarget].cursor!=e&&("move"==e?targets[t].el.style.cursor=e:"pen"==e?targets[t].el.style.cursor="url("+staticroot+"/img/penup.svg) 0 0, auto":"pendown"==e&&(targets[t].el.style.cursor="url("+staticroot+"/img/pendown.svg) 0 20, auto"),targets[t].cursor=e)}function mouseCoords(e){if(e=e||window.event,hasTouch){var t=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0];return{x:t.pageX,y:t.pageY}}if(e.pageX||e.pageY)return{x:e.pageX,y:e.pageY};var r=document.documentElement,a=document.body;if(r&&(r.scrollTop||r.scrollLeft))var n=r.scrollLeft,i=r.scrollTop;else if(a)n=a.scrollLeft,i=a.scrollTop;else n=0,i=0;return{x:e.clientX+n,y:e.clientY+i}}function snaptogrid(e,t){var r=e.x-targets[t].imgborder+targets[t].xmin*targets[t].pixperx,a=e.y-targets[t].imgborder-targets[t].ymax*targets[t].pixpery;return{x:r=Math.round(Math.round(r/(targets[t].pixperx*targets[t].snaptogridx))*targets[t].pixperx*targets[t].snaptogridx+targets[t].imgborder-targets[t].xmin*targets[t].pixperx),y:a=Math.round(Math.round(a/(targets[t].pixpery*targets[t].snaptogridy))*targets[t].pixpery*targets[t].snaptogridy+targets[t].imgborder+targets[t].ymax*targets[t].pixpery)}}function getMouseOffset(e,t){var r=getPosition(e),a=mouseCoords(t);return{x:a.x-r.x,y:a.y-r.y}}function getPosition(e){if(e.className.match(/hidden/))return{x:-1e4,y:-1e4};var t=$(e).offset();return{x:t.left,y:t.top}}function clearAllDrawListners(){$(document).off("mousedown.imathasdraw").off("mousemove.imathasdraw").off("mouseup.imathasdraw"),$(document).off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw"),$(".drawcanvas").off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw").off("touchcancel.imathasdraw")}function initCanvases(e){clearAllDrawListners(),$(document).on("mousemove.imathasdraw",drawMouseMove),$(".drawcanvas").on("touchstart.imathasdraw",(function(e){hasTouch=!0,drawMouseDown(e)})),$(document).on("mousedown.imathasdraw",drawMouseDown);try{CanvasRenderingContext2D.prototype.dashedLine=function(e,t,r,a,n){null==n&&(n=10),t<0&&t!=a?(e-=t*(r-e)/(a-t),t=0):t>targets[curTarget].imgheight&&t!=a&&(e+=(targets[curTarget].imgheight-t)*(r-e)/(a-t),t=targets[curTarget].imgheight),this.beginPath(),this.moveTo(e,t);var i=r-e,s=a-t,l=Math.sqrt(i*i+s*s)/n,u=i/l,g=s/l;l=Math.floor(l);for(var o=0;o++<l&&t>-1&&t<targets[curTarget].imgheight+1&&e>-1&&e<targets[curTarget].imgwidth+1;)e+=u,t+=g,this[o%2==0?"moveTo":"lineTo"](e,t);this[o%2==0?"moveTo":"lineTo"](r,a),this.stroke(),this.closePath()}}catch(e){}for(var t in canvases)if(void 0===e||e==t){var r=null;if(null!=drawla[t]&&drawla[t].length>2){if(lines[canvases[t][0]]=drawla[t][0],dots[canvases[t][0]]=drawla[t][1],odots[canvases[t][0]]=drawla[t][2],tptypes[canvases[t][0]]=[],tplines[canvases[t][0]]=[],drawla[t].length>3&&drawla[t][3].length>0)for(var a=0;a<drawla[t][3].length;a++){tptypes[canvases[t][0]][a]=drawla[t][3][a][0],tplines[canvases[t][0]][a]=[];for(var n=0;n<tpModeN[tptypes[canvases[t][0]][a]];n++)tplines[canvases[t][0]][a].push(drawla[t][3][a].slice(1+2*n,3+2*n))}if(ineqtypes[canvases[t][0]]=[],ineqlines[canvases[t][0]]=[],drawla[t].length>4&&drawla[t][4].length>0)for(a=0;a<drawla[t][4].length;a++)ineqtypes[canvases[t][0]][a]=drawla[t][4][a][0],ineqlines[canvases[t][0]][a]=[drawla[t][4][a].slice(1,3),drawla[t][4][a].slice(3,5),drawla[t][4][a].slice(5)];drawla[t].length>5&&(r=drawla[t][5])}else null!=drawla[t]&&"[[]]"==JSON.stringify(drawla[t])&&clearcanvas(canvases[t][0],!0);var i="";canvases[t][1].match(/initPicture/)?i=canvases[t][1]:""!==canvases[t][1]&&(i=imasroot+"/filter/graph/imgs/"+canvases[t][1]),""!==canvases[t][13]?addA11yTarget(canvases[t],r,i):addTarget(canvases[t][0],"canvas"+canvases[t][0],i,"qn"+canvases[t][0],canvases[t][2],canvases[t][3],canvases[t][4],canvases[t][5],canvases[t][6],canvases[t][7],canvases[t][8],canvases[t][9],canvases[t][10],canvases[t][11],canvases[t][12])}}"undefined"!=typeof initstack?initstack.push(initCanvases):$((function(){initCanvases()}));var normslider={idnums:[],curslider:{el:null,startpos:[0,0],outnode:null}};function addnormslider(e,t){-1==arraysearch(e,normslider.idnums)?(normslider.idnums.push(e),!0===t&&slideronpageload(e)):slideronpageload(e)}function slideronpageload(e){for(var t,r=0;r<normslider.idnums.length;r++)void 0!==e&&e!=normslider.idnums[r]||(initnormslider(t=normslider.idnums[r]),$("#slid1"+t).on("touchstart.normslider mousedown.normslider",onsliderstart),$("#slid2"+t).on("touchstart.normslider mousedown.normslider",onsliderstart))}function initnormslider(e){var t,r,a,n,i=document.getElementById("qn"+e).value;(n=i.match(/\(-oo,([\-\d\.]+)\)U\(([\-\d\.]+),oo\)/))?(t=3,r=n[1],a=n[2]):(n=i.match(/\(-oo,([\-\d\.]+)\)/))?(t=0,r=n[1],a=2.5):(n=i.match(/\(([\-\d\.]+),oo\)/))?(t=1,r=n[1],a=2.5):(n=i.match(/\(([\-\d\.]+),([\-\d\.]+)\)/))?(t=2,r=n[1],a=n[2]):(t=0,r=-1.5,a=2.5),document.getElementById("slid1"+e).style.left=60*r+250-6+"px",document.getElementById("slid2"+e).style.left=60*a+250-6+"px",document.getElementById("shaderegions"+e).selectedIndex=t,normslider.curslider.type=document.getElementById("shaderegions"+e).value,chgnormtype(e)}function onsliderstart(e){(e=e||window.event).originalEvent.touches&&e.originalEvent.touches.length>0?(hasTouch=!0,$(document).on("touchmove.normslider",onsliderchange),$(document).on("touchend.normslider",onsliderstop)):($(document).on("mousemove.normslider",onsliderchange),$(document).on("mouseup.normslider",onsliderstop)),normslider.curslider.el=e.target||e.srcElement,normslider.curslider.id=normslider.curslider.el.id.substring(5),normslider.curslider.type=document.getElementById("shaderegions"+normslider.curslider.id).value,normslider.curslider.outnode=document.getElementById(normslider.outputid),normslider.curslider.startpos=getMouseOffset(normslider.curslider.el,e),normslider.curslider.el.parentNode.style.cursor="pointer";getPosition(normslider.curslider.el.parentNode);return e.preventDefault&&e.preventDefault(),!1}function onsliderchange(e){var t=normslider.curslider.id;e=e||window.event;var r=getMouseOffset(normslider.curslider.el.parentNode,e);if(!(r.x<5||r.x>normslider.curslider.el.parentNode.offsetWidth-5||r.y<5||r.y>normslider.curslider.el.parentNode.offsetHeight-5)){var a=6*Math.round((r.x-normslider.curslider.startpos.x-10)/6)+10;return normslider.curslider.el.style.left=a+"px",normupdatevalues(t),e.preventDefault&&e.preventDefault(),!1}}function onsliderstop(e){null!==normslider.curslider.el&&(hasTouch=!1,$(document).off("touchmove.normslider touchend.normslider"),$(document).off("mousemove.normslider mouseup.normslider"),normslider.curslider.el.parentNode.style.cursor="",normslider.curslider.el=null)}function normupdatevalues(e){var t=parseInt(document.getElementById("slid1"+e).style.left)+6,r=parseInt(document.getElementById("slid2"+e).style.left)+6,a=Math.min(t,r),n=Math.max(t,r);"2O"==normslider.curslider.type?document.getElementById("normleft"+e).style.width=a+1+"px":"1L"==normslider.curslider.type?document.getElementById("normleft"+e).style.width=t+1+"px":"2B"==normslider.curslider.type&&(document.getElementById("normleft"+e).style.left=a+"px",document.getElementById("normleft"+e).style.width=n-a+1+"px"),"2O"==normslider.curslider.type?document.getElementById("normright"+e).style.width=500-n+"px":"1R"==normslider.curslider.type&&(document.getElementById("normright"+e).style.width=500-t+"px");var i=((t-10)/60-4).toFixed(1),s=((r-10)/60-4).toFixed(1),l=document.getElementById("slid1txt"+e);l.innerHTML=i,l.style.left=t-6+"px";var u=document.getElementById("slid2txt"+e);u.innerHTML=s,u.style.left=r-6+"px";var g=Math.min(i,s),o=Math.max(i,s);if("2O"==normslider.curslider.type)var c="(-oo,"+g+")U("+o+",oo)";else if("2B"==normslider.curslider.type)c="("+g+","+o+")";else if("1L"==normslider.curslider.type)c="(-oo,"+i+")";else if("1R"==normslider.curslider.type)c="("+i+",oo)";document.getElementById("qn"+e).value=c,$("#qn"+e).trigger("input").trigger("change")}function chgnormtype(e){var t=document.getElementById("shaderegions"+e).value;normslider.curslider.type=t;var r=parseInt(document.getElementById("slid1"+e).style.left)+6,a=parseInt(document.getElementById("slid2"+e).style.left)+6,n=Math.min(r,a),i=Math.max(r,a);"1R"==t||"1L"==t?(document.getElementById("slid2"+e).style.display="none",document.getElementById("slid2txt"+e).style.display="none","1R"==t?(document.getElementById("normleft"+e).style.display="none",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normright"+e).style.width=500-r+"px"):(document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.display="",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normleft"+e).style.width=r+"px")):"2O"==t?(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normright"+e).style.width=500-i+"px",document.getElementById("normleft"+e).style.width=n+"px"):"2B"==t&&(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.left=n+"px",document.getElementById("normleft"+e).style.width=i-n+"px"),normupdatevalues(e)}function dashedParabola(e,t,r,a,n,i,s){if(n==r)e.moveTo(0,n),e.dashedLine(0,n,i,n);else{var l=(n-r)/((a-t)*(a-t)),u=-2*l*t,g=0;n>r&&(g=s);var o=l*t*t+r-g,c=Math.sqrt(u*u-4*l*o),d=(-u-c)/(2*l),T=(-u+c)/(2*l);o+=g;if(T<d){var p=d;d=T,T=p}for(var h=t,m=r,y=0;h>d-5&&h>-5;)y%2==0?e.moveTo(h,m):e.lineTo(h,m),m=l*(h-=Math.min(Math.sqrt(64/(1+Math.pow(2*l*(h-t),2))),Math.sqrt(8/Math.abs(l))))*h+u*h+o,y++;for(h=t,m=r,y=0;h<T+5&&h<i+5;)y%2==0?e.moveTo(h,m):e.lineTo(h,m),m=l*(h+=Math.min(Math.sqrt(64/(1+Math.pow(2*l*(h-t),2))),Math.sqrt(8/Math.abs(l))))*h+u*h+o,y++}e.stroke()}function shadeParabola(e,t,r,a,n,i,s,l,u){if(e.beginPath(),n==r)e.moveTo(0,n),e.lineTo(l,n),s<r?(e.lineTo(l,0),e.lineTo(0,0)):(e.lineTo(l,u),e.lineTo(0,u));else{var g=(n-r)/((a-t)*(a-t)),o=-2*g*t,c=0;n>r&&(c=u);var d=g*t*t+r-c,T=Math.sqrt(o*o-4*g*d),p=(-o-T)/(2*g),h=g*p*p+o*p+(d+=c),m=(-o+T)/(2*g),y=h;if(m<p){var v=p;p=m,m=v}var f=2*g*(p-t),w=h-f*p,b=-f,q=(w-(y-b*m))/(b-f),x=f*q+w;if(g<0&&s<g*i*i+o*i+d||g>0&&s>g*i*i+o*i+d)e.moveTo(p,h),e.quadraticCurveTo(q,x,m,y);else{var M=u;Math.abs(h-u)<2&&(M=0),e.moveTo(0,h),e.lineTo(p,h),e.quadraticCurveTo(q,x,m,y),e.lineTo(l,y),e.lineTo(l,M),e.lineTo(0,M)}}e.closePath()}"undefined"!=typeof initstack&&initstack.push(slideronpageload);var drawexport={reset:reset,initCanvases:initCanvases,clearcanvas:clearcanvas,clearlastline:clearlastline,settool:settool,addnormslider:addnormslider,chgnormtype:chgnormtype,adda11ydraw:adda11ydraw,changea11ydraw:changea11ydraw,encodea11ydraw:encodea11ydraw,updatea11ydraw:updatea11ydraw,removea11ydraw:removea11ydraw};return drawexport}(jQuery);!function(){"use strict";function e(e,t,r){var a=t[0],n=t[1],i=r[0]-a,s=r[1]-n;if(0!==i||0!==s){var l=((e[0]-a)*i+(e[1]-n)*s)/(i*i+s*s);l>1?(a=r[0],n=r[1]):l>0&&(a+=i*l,n+=s*l)}return(i=e[0]-a)*i+(s=e[1]-n)*s}function t(r,a,n,i,s){for(var l,u=i,g=a+1;g<n;g++){var o=e(r[g],r[a],r[n]);o>u&&(l=g,u=o)}u>i&&(l-a>1&&t(r,a,l,i,s),s.push(r[l]),n-l>1&&t(r,l,n,i,s))}function r(e,r){var a=e.length-1,n=[e[0]];return t(e,0,a,r,n),n.push(e[a]),n}window.pathsimplify=function(e,t,a){if(e.length<=2)return e;var n=void 0!==t?t*t:1;return e=r(e=a?e:function(e,t){for(var r,a,n,i,s,l=e[0],u=[l],g=1,o=e.length;g<o;g++)r=e[g],n=l,i=void 0,s=void 0,i=(a=r)[0]-n[0],s=a[1]-n[1],i*i+s*s>t&&(u.push(r),l=r);return l!==r&&u.push(r),u}(e,n),n)}}();