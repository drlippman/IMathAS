"use strict";function makeMathFunction(t,r,e,n,a){if(r=r||"",e=e||[],n=n||"",a=void 0!==a&&a,""===t.trim())return!1;try{var o=new MathParser(r,e,n,a);return o.parse(t),function(t){try{return o.evaluate(t)}catch(t){return Math.sqrt(-1)}}}catch(r){return console.error("Parse error on: "+t+". Error: "+r.message),!1}}function evalMathParser(t,r){if(r=void 0!==r&&r,""===t.trim())return Math.sqrt(-1);try{var e=new MathParser("",[],"",r);return e.parse(t),e.evaluate()}catch(r){return console.error("Parse error on: "+t+". Error: "+r.message),Math.sqrt(-1)}}function MathParser(t,r,e,n){this.functions=[],this.variables=[],this.funcvariables=[],this.operators={},this.tokens=[],this.operatorStack=[],this.operandStack=[],this.AST=[],this.regex="",this.funcregex="",this.numvarregex="",this.variableValues={},this.origstr="",this.docomplex=n,this.allowEscinot=!0,""!==t&&(this.variables=t.split("|").map(function(t){return t.trim()}).filter(function(t){return t.length>0})),""!==e&&(this.funcvariables=e.split("|").map(function(t){return t.trim()}).filter(function(t){return t.length>0})),this.variables.push("pi","e"),n&&(this.docomplex=!0,this.variables.push("i")),this.variables.sort(function(t,r){return r.length-t.length}),this.allowEscinot=-1===this.variables.indexOf("E"),r.length>0?this.functions=r:this.functions="funcvar,arcsinh,arccosh,arctanh,arcsech,arccsch,arccoth,arcsin,arccos,arctan,arcsec,arccsc,arccot,root,sqrt,sign,sinh,cosh,tanh,sech,csch,coth,abs,sin,cos,tan,sec,csc,cot,exp,log,div,ln".split(",");var a=this.functions.concat(this.variables,["degree","degrees"]);a.sort(function(t,r){return r.length-t.length}),this.regex=new RegExp("^("+a.map(function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}).join("|")+")"),this.funcregex=new RegExp("("+this.functions.map(function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}).join("|")+")","i"),this.numvarregex=new RegExp("^(\\d+\\.?\\d*|"+this.variables.map(function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}).join("|")+")"),this.initializeOperators()}function factorial(t){if(t<0)return!1;if(0===t)return 1;for(var r=t-1;r>0;r--)t*=r;return t}function nthroot(t,r){if(0===t)return 0;if(Math.floor(r)!==r)return safepow(t,1/r);if(r%2==0&&t<0)throw new Error("Can't take even root of negative value");if(0===r)throw new Error("Can't take 0th root");return t<0?-1*Math.exp(1/r*Math.log(Math.abs(t))):Math.exp(1/r*Math.log(Math.abs(t)))}function funcvar(t,r){return r*Math.sin(r+t)}function safepow(t,r){if(0===t)return 0===r?(console.error("0^0 is undefined"),NaN):0;if("number"!=typeof t||"number"!=typeof r)return console.error("cannot evaluate powers with nonnumeric values"),NaN;if(t<0&&Math.floor(r)!==r){for(var e=3;e<50;e+=2)if(Math.abs(Math.round(e*r)-e*r)<1e-6)return Math.round(e*r)%2==0?Math.exp(r*Math.log(Math.abs(t))):-1*Math.exp(r*Math.log(Math.abs(t)));return console.error("invalid power for negative base"),NaN}return Math.pow(t,r)}function sec(t){var r=Math.cos(t);return Math.abs(r)<1e-16?NaN:1/r}function csc(t){var r=Math.sin(t);return Math.abs(r)<1e-16?NaN:1/r}function cot(t){var r=Math.tan(t);return Math.abs(r)<1e-16?NaN:1/r}function sech(t){var r=Math.cosh(t);return Math.abs(r)<1e-16?NaN:1/r}function csch(t){var r=Math.sinh(t);return Math.abs(r)<1e-16?NaN:1/r}function coth(t){var r=Math.tanh(t);return Math.abs(r)<1e-16?NaN:1/r}function asec(t){if(Math.abs(t)<1e-16)return NaN;var r=Math.round(1/t*1e12)/1e12;return Math.acos(r)}function acsc(t){if(Math.abs(t)<1e-16)return NaN;var r=Math.round(1/t*1e12)/1e12;return Math.asin(r)}function acot(t){return Math.abs(t)<1e-16?NaN:Math.atan(1/t)}function asech(t){if(Math.abs(t)<1e-16)return NaN;var r=Math.round(1/t*1e12)/1e12;return Math.acosh(r)}function acsch(t){if(Math.abs(t)<1e-16)return NaN;var r=Math.round(1/t*1e12)/1e12;return Math.asinh(r)}function acoth(t){if(Math.abs(t)<1e-16)return NaN;var r=Math.round(1/t*1e12)/1e12;return Math.atanh(r)}function cplx_subt(t,r){return[t[0]-r[0],t[1]-r[1]]}function cplx_mult(t,r){return[t[0]*r[0]-t[1]*r[1],t[0]*r[1]+t[1]*r[0]]}function cplx_div(t,r){var e=r[0]*r[0]+r[1]*r[1];if(0===e)throw new Error("Cannot divide by zero in complex division");return[(t[0]*r[0]+t[1]*r[1])/e,(t[1]*r[0]-t[0]*r[1])/e]}function cplx_sqrt(t){return cplx_nthroot(t,2)}function cplx_nthroot(t,r){var e=safepow(t[0]*t[0]+t[1]*t[1],r/(2*r)),n=Math.atan2(t[1],t[0]);return[e*Math.cos(n/r),e*Math.sin(n/r)]}function cplx_log(t,r=Math.E){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]),n=Math.atan2(t[1],t[0]);return[Math.log(e)/Math.log(r),n/Math.log(r)]}function cplx_exp(t){var r=Math.exp(t[0]);return[r*Math.cos(t[1]),r*Math.sin(t[1])]}function cplx_abs(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function cplx_sin(t){return[Math.sin(t[0])*Math.cosh(t[1]),Math.cos(t[0])*Math.sinh(t[1])]}function cplx_cos(t){return[Math.cos(t[0])*Math.cosh(t[1]),-1*Math.sin(t[0])*Math.sinh(t[1])]}function cplx_tan(t){return cplx_div(cplx_sin(t),cplx_cos(t))}function cplx_sec(t){return cplx_div([1,0],cplx_cos(t))}function cplx_csc(t){return cplx_div([1,0],cplx_sin(t))}function cplx_cot(t){return cplx_div(cplx_cos(t),cplx_sin(t))}function cplx_sinh(t){return[Math.sinh(t[0])*Math.cos(t[1]),Math.cosh(t[0])*Math.sin(t[1])]}function cplx_cosh(t){return[Math.cosh(t[0])*Math.cos(t[1]),Math.sinh(t[0])*Math.sin(t[1])]}function cplx_tanh(t){return cplx_div(cplx_sinh(t),cplx_cosh(t))}function cplx_sech(t){return cplx_div([1,0],cplx_cosh(t))}function cplx_csch(t){return cplx_div([1,0],cplx_sinh(t))}function cplx_coth(t){return cplx_div(cplx_cosh(t),cplx_sinh(t))}function cplx_asin(t){var r=[t[0]*t[0]-t[1]*t[1],2*t[0]*t[1]],e=cplx_nthroot([1-r[0],-1*r[1]],2),n=cplx_log([e[0]-t[1],e[1]+t[0]]);return[n[1],-1*n[0]]}function cplx_acos(t){var r=[t[0]*t[0]-t[1]*t[1],2*t[0]*t[1]],e=cplx_nthroot([r[0]-1,r[1]],2),n=cplx_log([e[0]+t[0],e[1]+t[1]]);return[n[1],-1*n[0]]}function cplx_atan(t){var r=cplx_log(cplx_div([-1*t[0],1-t[1]],[t[0],1+t[1]]));return[2*r[1],-2*r[0]]}function cplx_asinh(t){var r=cplx_sqrt([t[0]*t[0]-t[1]*t[1]+1,2*t[0]*t[1]]);return cplx_log([t[0]+r[0],t[1]+r[1]])}function cplx_acosh(t){var r=cplx_sqrt([t[0]*t[0]-t[1]*t[1]-1,2*t[0]*t[1]]);return cplx_log([t[0]+r[0],t[1]+r[1]])}function cplx_atanh(t){return cplx_mult([.5,1],cplx_log(cplx_div([1+t[0],t[1]],[1-t[0],-1*t[1]])))}function cplx_asec(t){var r=[t[0]*t[0]-t[1]*t[1],2*t[0]*t[1]],e=cplx_nthroot([1-r[0],-1*r[1]],2),n=cplx_log(cplx_div([1+e[0],e[1]],t));return[n[1],-1*n[0]]}function cplx_acsc(t){var r=[t[0]*t[0]-t[1]*t[1],2*t[0]*t[1]],e=cplx_nthroot([r[0]-1,r[1]],2),n=cplx_log(cplx_div([e[0],1+e[1]],t));return[n[1],-1*n[0]]}function cplx_acot(t){var r=cplx_log(cplx_div([t[0],t[1]+1],[t[0],t[1]-1]));return[2*r[1],-2*r[0]]}function cplx_asech(t){return cplx_acosh(cplx_div([1,0],t))}function cplx_acsch(t){return cplx_asinh(cplx_div([1,0],t))}function cplx_acoth(t){return cplx_mult([.5,1],cplx_log(cplx_div([t[0]+1,t[1]],[t[0]-1,t[1]])))}function cplx_factorial(t){if(0===t[1])return[factorial(t[0]),0];throw new Error("Complex factorial not fully implemented")}function cplx_funcvar(t,r){return Array.isArray(t)||(t=[t,0]),Array.isArray(r)||(r=[r,0]),cplx_mult(r,cplx_sin([r[0]+t[0],r[1]+t[1]]))}MathParser.prototype.initializeOperators=function(){var t=this;this.operators={"+":{precedence:11,assoc:"left",evalfunc:function(r,e){return t.docomplex?[r[0]+e[0],r[1]+e[1]]:r+e}},"-":{precedence:11,assoc:"left",evalfunc:function(r,e){return t.docomplex?[r[0]-e[0],r[1]-e[1]]:r-e}},"*":{precedence:12,assoc:"left",evalfunc:function(r,e){return t.docomplex?[r[0]*e[0]-r[1]*e[1],r[0]*e[1]+r[1]*e[0]]:r*e}},"/":{precedence:12,assoc:"left",evalfunc:function(r,e){if(t.docomplex){if(Math.abs(e[0])<1e-50&&Math.abs(e[1])<1e-50)throw new Error("Division by zero");var n=e[0]*e[0]+e[1]*e[1];return[(r[0]*e[0]+r[1]*e[1])/n,(r[1]*e[0]-r[0]*e[1])/n]}if(Math.abs(e)<1e-50)throw new Error("Division by zero");return r/e}},"^":{precedence:18,assoc:"right",evalfunc:function(r,e){if(t.docomplex){if(0===e[1]){var n=safepow(r[0]*r[0]+r[1]*r[1],e[0]/2),a=Math.atan2(r[1],r[0]);return[n*Math.cos(a*e[0]),n*Math.sin(a*e[0])]}var o=Math.atan2(r[1],r[0]),c=(n=safepow(r[0]*r[0]+r[1]*r[1],e[0]/2)*Math.exp(-e[1]*o),e[0]*o+.5*e[1]*Math.log(r[0]*r[0]+r[1]*r[1]));return[n*Math.cos(c),n*Math.sin(c)]}return safepow(r,e)}},"!":{precedence:20,assoc:"right"},"~":{precedence:16,assoc:"left"},not:{precedence:16,assoc:"right"},"&&":{precedence:8,assoc:"left",evalfunc:function(t,r){return t&&r}},"||":{precedence:7,assoc:"left",evalfunc:function(t,r){return t||r}},"#a":{precedence:8,assoc:"right",evalfunc:function(t,r){return t&&r}},"#x":{precedence:7,assoc:"right",evalfunc:function(t,r){return!!(t^r)}},"#o":{precedence:7,assoc:"right",evalfunc:function(t,r){return t||r}},"#m":{precedence:7,assoc:"right",evalfunc:function(t,r){return t&&!r}},"#i":{precedence:6,assoc:"right",evalfunc:function(t,r){return!t||r}},"#b":{precedence:6,assoc:"right",evalfunc:function(t,r){return t&&r||!t&&!r}},"<":{precedence:6,assoc:"left",evalfunc:function(t,r){return t<r?1:0}},">":{precedence:6,assoc:"left",evalfunc:function(t,r){return t>r?1:0}},"<=":{precedence:6,assoc:"left",evalfunc:function(t,r){return t<=r?1:0}},">=":{precedence:6,assoc:"left",evalfunc:function(t,r){return t>=r?1:0}},"(":!0,")":!0}},MathParser.prototype.parse=function(t){return this.origstr=t,t=(t=(t=(t=(t=(t=t.replace(/Math\./g,"")).replace(/(ar|arg)(sinh|cosh|tanh|sech|csch|coth)/g,"arc$2")).replace(/[\\[\]`]/g,"").replace(/[\[\]]/g,"()")).replace(/\|\|/g,"###DOUBLE_PIPE###")).replace(/\|([^\|]+?)\|/g,function(t,r){return-1!==r.indexOf("###DOUBLE_PIPE###")?t:"abs("+r+")"})).replace(/###DOUBLE_PIPE###/g,"||"),this.tokenize(t),this.handleImplicit(),this.buildTree(),this.AST},MathParser.prototype.evaluate=function(t){void 0===t&&(t={});for(var r=0;r<this.variables.length;r++){var e=this.variables[r];if(!("pi"===e||"e"===e||this.docomplex&&"i"===e)){if(!(e in t))throw new Error("Missing value for variable "+e);if("number"!=typeof t[e])throw new Error("Invalid input value for variable "+e)}}if(this.variableValues=t,0===this.AST.length)return"";var n=this.evalNode(this.AST);return this.docomplex&&!Array.isArray(n)&&(n=[n,0]),n},MathParser.prototype.evaluateQuiet=function(t){try{return this.evaluate(t)}catch(t){return Math.sqrt(-1)}},MathParser.prototype.tokenize=function(t){for(var r=[],e=(t=t.replace(this.funcregex,function(t){return t.toLowerCase()})).length,n="",a=0;a<e;a++){var o=t[a];if(!/\s/.test(o))if(/[\d.]/.test(o)){var c;if(c=this.allowEscinot?/^(\d*\.?\d*(E[+-]?\d+(?!\.))?)/:/^(\d*\.?\d*)/,"."===(s=t.substring(a).match(c))[1])continue;r.push({type:"number",symbol:parseFloat(s[1])}),n="number",a+=s[1].length-1}else if(-1!==["|","&","#","<",">"].indexOf(o)&&this.operators[t.substring(a,a+2)])r.push({type:"operator",symbol:t.substring(a,a+2)}),a++,n="operator";else if(this.operators[o])r.push({type:"operator",symbol:o}),n="operator";else{var s;if(!(s=t.substring(a).match(this.regex)))throw new Error("Don't know how to handle symbol: "+o);var i=s[1];if(-1!==this.funcvariables.indexOf(i)&&a+i.length<t.length&&"("===t[a+i.length]?(r.push({type:"function",symbol:"funcvar",input:null,index:{type:"variable",symbol:i}}),n="function"):-1!==this.variables.indexOf(i)?(r.push({type:"variable",symbol:i}),n="variable"):"div"===i?(r.push({type:"operator",symbol:"/"}),n="operator"):("log"===i?r.push({type:"function",symbol:"log",input:null,index:{type:"number",symbol:10}}):"ln"===i?r.push({type:"function",symbol:"log",input:null,index:{type:"number",symbol:Math.E}}):"degree"===i||"degrees"===i?r.push({type:"number",symbol:Math.PI/180}):r.push({type:"function",symbol:i,input:null}),n="function"),a+=i.length-1,"function"===n&&a<e-2){var h=t[a+1];if("log"===i&&"_"===h)(l=t.substring(a+2).match(this.numvarregex))?(r[r.length-1].index={type:isNaN(l[1])?"variable":"number",symbol:l[1]},a+=l[1].length+1):"("===t[a+2]&&(r[r.length-1].symbol+="_",a+=1);else if("^"===h){(l=t.substring(a+2).match(/^(-?\d+|\((-?\d+)\))/))&&(r[r.length-1].symbol+="^"+(l[2]||l[1]),a+=l[1].length+1)}else if("root"===i)if("("===h)r[r.length-1].symbol+="(";else{var l;if(!(l=t.substring(a+1).match(/^[\(\[]*(-?\d+)[\)\]]*/)))throw new Error("Invalid root index");r[r.length-1]={type:"function",symbol:"nthroot",input:null,index:{type:"number",symbol:parseInt(l[1])}},a+=l[0].length}}}}return this.tokens=r,r},MathParser.prototype.handleImplicit=function(){for(var t=[],r={type:"",symbol:""},e=0;e<this.tokens.length;e++){var n=this.tokens[e];"number"!==r.type&&"variable"!==r.type&&"!"!==r.symbol&&")"!==r.symbol||"number"!==n.type&&"variable"!==n.type&&"function"!==n.type&&"("!==n.symbol?"function"===r.type&&"("!==n.symbol?(t.push({type:"operator",symbol:"("}),t.push(n),t.push({type:"operator",symbol:")"})):t.push(n):(t.push({type:"operator",symbol:"*"}),t.push(n)),r=n}this.tokens=t},MathParser.prototype.buildTree=function(){this.operatorStack=[],this.operandStack=[];for(var t=null,r=0;r<this.tokens.length;r++){var e=this.tokens[r];if(")"===e.symbol)this.handleSubExpression(r);else if("number"===e.type||"variable"===e.type)this.operandStack.push(e);else if("function"===e.type)this.operatorStack.push(e);else if("("===e.symbol)this.operatorStack.push(e);else if("!"===e.symbol){if(this.isUnary(e,t))e.symbol="not",this.operatorStack.push(e),r+1<this.tokens.length&&"*"===this.tokens[r+1].symbol&&this.tokens.splice(r+1,1);else{if(0===this.operandStack.length)throw new Error("Syntax error: ! without something to apply it to");var n=this.operandStack.pop();this.operandStack.push({type:"function",symbol:"factorial",input:n})}}else if("operator"===e.type){if(this.isUnary(e,t))"+"===e.symbol?(e.type="",e.symbol=""):"-"===e.symbol&&(e.symbol="~");else for(;this.operatorStack.length>0;){var a=this.operatorStack[this.operatorStack.length-1],o=this.operators[a.symbol],c=this.operators[e.symbol];if("boolean"==typeof o||"boolean"==typeof c)break;if(!(c.precedence<o.precedence||c.precedence===o.precedence&&"left"===c.assoc))break;var s=this.operatorStack.pop(),i=this.handleExpression(s);this.operandStack.push(i)}""!==e.symbol&&this.operatorStack.push(e)}""!==e.symbol&&(t=e)}for(;this.operatorStack.length>0;){s=this.operatorStack.pop(),i=this.handleExpression(s);this.operandStack.push(i)}if(this.operandStack.length>1)throw new Error("Syntax error - expression didn't terminate");this.AST=this.operandStack.pop()},MathParser.prototype.isUnary=function(t,r){return-1!==["-","+","!"].indexOf(t.symbol)&&(0===this.operandStack.length&&0===this.operatorStack.length||"operator"===r.type&&")"!==r.symbol&&"!"!==r.symbol)},MathParser.prototype.handleExpression=function(t){if("function"===t.type||"("===t.symbol)throw new Error("Syntax error - parentheses mismatch");if("~"===t.symbol||"not"===t.symbol){if(void 0===(r=this.operandStack.pop()))throw new Error("Syntax error - unary negative with nothing following");return t.left=r,t}var r,e=this.operandStack.pop();if(void 0===(r=this.operandStack.pop())||void 0===e)throw new Error("Syntax error");return t.left=r,t.right=e,t},MathParser.prototype.handleSubExpression=function(t){for(var r,e=!1;r=this.operatorStack.pop();){if("("===r.symbol){e=!0;break}var n=this.handleExpression(r);this.operandStack.push(n)}if(!e)throw new Error("Syntax error - parentheses mismatch");if(this.operatorStack.length>0&&"function"===this.operatorStack[this.operatorStack.length-1].type){n=this.operatorStack.pop();var a=this.operandStack.pop();if("log_"===n.symbol){if(void 0===a)throw new Error("Syntax error - missing index");return n.symbol="log",n.index=a,this.operatorStack.push(n),void(t+1<this.tokens.length&&"*"===this.tokens[t+1].symbol&&this.tokens.splice(t+1,1))}if("root("===n.symbol){if(void 0===a)throw new Error("Syntax error - missing index");return n.symbol="nthroot",n.index=a,this.operatorStack.push(n),void(t+1<this.tokens.length&&"*"===this.tokens[t+1].symbol&&this.tokens.splice(t+1,1))}if(void 0===a)throw new Error("Syntax error - missing function input");if(n.input=a,-1!==n.symbol.indexOf("^")){var o=n.symbol.split("^"),c=o[0],s=o[1];if("-1"!==s||!window["a"+c]&&!Math["a"+c]){n.symbol=c;var i={type:"operator",symbol:"^",left:n,right:{type:"number",symbol:parseInt(s)}};return void this.operandStack.push(i)}n.symbol="arc"+c}this.operandStack.push(n)}},MathParser.prototype.evalNode=function(t){if(!t)throw new Error("Cannot evaluate an empty expression");if("number"===t.type)return this.docomplex?Array.isArray(t.symbol)?[parseFloat(t.symbol[0]),parseFloat(t.symbol[1])]:[parseFloat(t.symbol),0]:parseFloat(t.symbol);if("variable"===t.type){if(t.symbol in this.variableValues)return this.docomplex&&"number"==typeof this.variableValues[t.symbol]?[parseFloat(this.variableValues[t.symbol]),0]:this.variableValues[t.symbol];if("pi"===t.symbol)return this.docomplex?[Math.PI,0]:Math.PI;if("e"===t.symbol)return this.docomplex?[Math.E,0]:Math.E;if(this.docomplex&&"i"===t.symbol)return[0,1];throw new Error("Variable found without a provided value")}if("function"===t.type){var r,e=this.evalNode(t.input);t.index&&(r=this.evalNode(t.index));var n=t.symbol;if(!this.docomplex)switch(n){case"sqrt":if(e<0)throw new Error("Invalid input to "+n);break;case"log":if(e<=0)throw new Error("Invalid input to "+n);if(r<=0)throw new Error("Invalid base to "+n);break;case"arcsin":case"arccos":var a=Math.round(1e12*e)/1e12;if(a<-1||a>1)throw new Error("Invalid input to "+n);break;case"factorial":if(Math.round(e)!==Math.floor(e)||e<0)throw new Error("invalid factorial input "+e);if(e>150)throw new Error("too big of factorial input "+e)}return n=n.replace("arc","a"),this.docomplex&&(n="cplx_"+n,Array.isArray(e)||(e=[e,0])),t.index?this.callFunction(n,e,r):this.callFunction(n,e)}if("~"===t.symbol){if(this.docomplex){var o=this.evalNode(t.left);return Array.isArray(o)?[-1*o[0],-1*o[1]]:-1*o}return-1*this.evalNode(t.left)}if("not"===t.symbol)return!this.evalNode(t.left);if(this.operators[t.symbol])return(0,this.operators[t.symbol].evalfunc)(this.evalNode(t.left),this.evalNode(t.right));throw new Error("Syntax error")},MathParser.prototype.callFunction=function(t){var r=null;if(-1!==["sqrt","sin","cos","tan","asin","acos","atan","sinh","cosh","tanh","asinh","acosh","atanh","exp","abs","sign"].indexOf(t)?r=Math[t]:-1!==["factorial","nthroot","sec","csc","cot","asec","acsc","acot","sech","csch","coth","asech","acsch","acoth","funcvar","cplx_sqrt","cplx_sin","cplx_cos","cplx_tan","cplx_log","cplx_exp","cplx_abs","cplx_asin","cplx_acos","cplx_atan","cplx_sinh","cplx_cosh","cplx_tanh","cplx_asinh","cplx_acosh","cplx_atanh","cplx_sec","cplx_csc","cplx_cot","cplx_sech","cplx_csch","cplx_coth","cplx_asec","cplx_acsc","cplx_acot","cplx_asech","cplx_acsch","cplx_acoth","cplx_nthroot","cplx_factorial","cplx_funcvar"].indexOf(t)?r=window[t]:"log"===t?r=function(t,r){return r=void 0===r?Math.E:r,Math.log(t)/Math.log(r)}:"ln"===t&&(r=Math.log),null!==r){var e=[];return arguments.length>1&&(e=Array.prototype.slice.call(arguments,1)),r.apply(null,e)}throw new Error("Unknown function: "+t)},MathParser.prototype.isMultiple=function(t,r){if(0===r)return!1;var e=Math.abs(t)/Math.abs(r);return Math.abs(Math.floor(e+1e-10)-e)<1e-8},Math.sinh||(Math.sinh=function(t){return(Math.exp(t)-Math.exp(-t))/2}),Math.cosh||(Math.cosh=function(t){return(Math.exp(t)+Math.exp(-t))/2}),Math.tanh||(Math.tanh=function(t){if(t===1/0)return 1;if(t===-1/0)return-1;var r=Math.exp(t),e=Math.exp(-t);return(r-e)/(r+e)}),Math.asinh||(Math.asinh=function(t){return Math.log(t+Math.sqrt(t*t+1))}),Math.acosh||(Math.acosh=function(t){return t<1?NaN:Math.log(t+Math.sqrt(t*t-1))}),Math.atanh||(Math.atanh=function(t){return t<=-1||t>=1?NaN:.5*Math.log((1+t)/(1-t))});var pi=Math.PI,ln=Math.log,e=Math.E,arcsin=Math.asin,arccos=Math.acos,arctan=Math.atan,logten=function(t){return Math.LOG10E*Math.log(t)};function nthlogten(t,r){return Math.log(r)/Math.log(t)}var sinn=function(t,r){return Math.pow(Math.sin(r),t)},cosn=function(t,r){return Math.pow(Math.cos(r),t)},tann=function(t,r){return Math.pow(Math.tan(r),t)},cscn=function(t,r){return 1/Math.pow(Math.sin(r),t)},secn=function(t,r){return 1/Math.pow(Math.cos(r),t)},cotn=function(t,r){return 1/Math.pow(Math.tan(r),t)},lnn=function(t,r){return Math.pow(Math.log(r),t)},funcstoindexarr="sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root|arcsin|arccos|arctan|arcsec|arccsc|arccot|arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|argsinh|argcosh|argtanh|argsech|argcsch|argcoth|arsinh|arcosh|artanh|arsech|arcsch|arcoth|pi".split("|");function functoindex(t){for(var r=0;r<funcstoindexarr.length;r++)if(funcstoindexarr[r]==t)return"@"+r+"@";return t}function indextofunc(t,r){return funcstoindexarr[r]}function matchtolower(t){return t.toLowerCase()}function mathjs(t,r){if(t=(t=(t=(t=(t=(t=(t=t.replace(/(\+\s*-|-\s*\+)/g,"-").replace(/-\s*-/g,"+")).replace(/\[/g,"(").replace(/\]/g,")")).replace(/\b00+\./g,"0.")).replace(/root\s*(\d+)/,"root($1)")).replace(/\|(.*?)\|/g,"abs($1)")).replace(/(Sin|Cos|Tan|Sec|Csc|Cot|Arc|Abs|Log|Exp|Ln|Sqrt)/gi,matchtolower)).replace(/(sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|exp|sin|cos|tan|sec|csc|cot|abs|root)/g,functoindex),null!=r&&""!=r){var e=r.split("|");e.push("pi"),e.sort(function(t,r){return r.length-t.length}),r=e.join("|"),t=t.replace(new RegExp("("+r+")","gi"),function(t,r){for(var n=0;n<e.length;n++)if(e[n]==r)return"(@v"+n+"@)";return r})}else t=t.replace(/pi/g,"(pi)");var n,a,o,c,s,i;for(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/([0-9])E([\-0-9])/g,"$1(EE)$2")).replace(/\*?\s*degrees?/g,"*((pi)/180)")).replace(/div/,"/")).replace(/e/g,"(E)")).replace(/@(\d+)@/g,indextofunc)).replace(/log_([a-zA-Z\d\.]+|\(([a-zA-Z\/\d\.]+)\))\s*\(/g,"nthlog($1,")).replace(/log/g,"logten")).replace(/(sin|cos|tan|sec|csc|cot|sinh|cosh|tanh|sech|csch|coth)\^(-1|\(-1\))/g,"arc$1")).replace(/(sin|cos|tan|sec|csc|cot|ln)\^(\d+|\(\d+\))\s*\(/g,"$1n($2,")).replace(/root\s*\(([a-zA-Z\/\d\.]+)\)\s*\(/g,"nthroot(($1),")).replace(/([0-9]\.?)\s+([0-9])/g,"$1*$2")).replace(/#/g,"")).replace(/\s/g,""),null!=r&&""!=r&&(t=t.replace(/@v(\d+)@/g,function(t,r){return e[r]})),t=(t=(t=(t=t.replace(/([0-9]\.?)([\(a-zA-Z])/g,"$1*$2")).replace(/(!)([0-9\(a-zA-Z])/g,"$1*$2")).replace(/\)([\(0-9a-zA-Z]|\.\d+)/g,")*$1")).replace(/([0-9])\*\(EE\)\*?([\-0-9])/g,"$1e$2");-1!=(n=t.lastIndexOf("^"));){if(0==n)return"Error: missing argument";if(a=n-1,(c=t.charAt(a))>="0"&&c<="9"||"."==c){for(a--;a>=0&&(c=t.charAt(a))>="0"&&c<="9";)a--;if("."==c)for(a--;a>=0&&(c=t.charAt(a))>="0"&&c<="9";)a--}else if(")"==c){for(i=1,a--;a>=0&&i>0;)"("==(c=t.charAt(a))?i--:")"==c&&i++,a--;for(;a>=0&&((c=t.charAt(a))>="a"&&c<="z"||c>="A"&&c<="Z");)a--}else{if(!(c>="a"&&c<="z"||c>="A"&&c<="Z"))return"Error: incorrect syntax in "+t+" at position "+a;for(a--;a>=0&&((c=t.charAt(a))>="a"&&c<="z"||c>="A"&&c<="Z");)a--}if(n==t.length-1)return"Error: missing argument";if(o=n+1,c=t.charAt(o),s=t.charAt(o+1),c>="0"&&c<="9"||"-"==c&&"("!=s||"."==c){for(o++;o<t.length&&(c=t.charAt(o))>="0"&&c<="9";)o++;if("."==c)for(o++;o<t.length&&(c=t.charAt(o))>="0"&&c<="9";)o++}else if("("==c||"-"==c&&"("==s)for("-"==c&&o++,i=1,o++;o<t.length&&i>0;)"("==(c=t.charAt(o))?i++:")"==c&&i--,o++;else{if(!(c>="a"&&c<="z"||c>="A"&&c<="Z"))return"Error: incorrect syntax in "+t+" at position "+o;for(o++;o<t.length&&((c=t.charAt(o))>="a"&&c<="z"||c>="A"&&c<="Z");)o++;if("("==c&&t.slice(n+1,o).match(/^(sinn|cosn|tann|secn|cscn|cotn|sin|cos|tan|sec|csc|cot|logten|nthlogten|log|ln|exp|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|sqrt|abs|nthroot|factorial|safepow)$/))for(i=1,o++;o<t.length&&i>0;)"("==(c=t.charAt(o))?i++:")"==c&&i--,o++}t=t.slice(0,a+1)+"safepow("+t.slice(a+1,n)+","+t.slice(n+1,o)+")"+t.slice(o)}return t}